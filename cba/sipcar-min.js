var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
var _destructuring=[].push.apply([],[].concat($jscomp.arrayFromIterable([])));Ext.define("Sipcar.controller.DatiUtente",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"LbEnte",selector:this.selContainer+"#LbEnte"},{ref:"LbNomeUtente",selector:this.selContainer+"#LbNomeUtente"},{ref:"Lingua",selector:this.selContainer+"#Lingua"},{ref:"LbPreferenze",selector:this.selContainer+"#LbPreferenze"},{ref:"BtnHelpMenu",selector:this.selContainer+"#BtnHelpMenu"},{ref:"BtnFaqMenu",selector:this.selContainer+
"#BtnFaqMenu"},{ref:"BtnCircolariMenu",selector:this.selContainer+"#BtnCircolariMenu"},{ref:"BtnEsciMenu",selector:this.selContainer+"#BtnEsciMenu"},{ref:"CbOrganizzazione",selector:this.selContainer+"#CbOrganizzazione"},{ref:"BtnModificaOrg",selector:this.selContainer+"#BtnModificaOrg"},{ref:"LbVersioni",selector:this.selContainer+"#LbVersioni"},{ref:"BtnGestionePwd",selector:this.selContainer+"#BtnGestionePwd"},{ref:"BtnCambiaPwd",selector:this.selContainer+"#BtnCambiaPwd"},{ref:"BtnBackupDb",selector:this.selContainer+
"#BtnBackupDb"}]);this.control(this.selContainer+"#BtnHelpMenu",{click:this.clickBtnHelpMenu});this.control(this.selContainer+"#BtnGestionePwd",{click:this.clickBtnGestionePwd});this.control(this.selContainer+"#BtnBackupDb",{click:this.clickBtnBackupDb});this.control(this.selContainer+"#Lingua",{afterrender:this.afterrenderLingua});this.control(this.selContainer+"#BtnEsciMenu",{click:this.clickBtnEsciMenu});this.control(this.selContainer+"#CbOrganizzazione",{select:this.selectCbOrganizzazione});this.control(this.selContainer+
"#LbPreferenze",{afterrender:this.afterrenderLbPreferenze});this.control(this.selContainer+"#BtnCambiaPwd",{click:this.clickBtnCambiaPwd});this.control(this.selContainer+"#LbVersioni",{afterrender:this.afterrenderLbVersioni})},afterrenderLbVersioni:function(a){a.getEl().on("click",function(){Ext.create("winCBA",{permesso:"S",closable:!0,name:"Sipcar.view.VersioneModuli",titolo:"VERSIONI_MODULI",dimensione:5,configItem:{permesso:"S"}}).show()})},clickBtnGestionePwd:function(){Ext.create("winCBA",{permesso:"S",
closable:!0,maximized:!0,name:"Generali.gestPwdNew.view.VideataPassword",dimensione:1,titolo:"GESTIONE_PWD"}).show()},clickBtnBackupDb:function(){this.view.up("window").close();Ext.create("winCBA",{permesso:"S",closable:!0,maximized:!1,name:"Generali.gestBckBackup.view.GestioneBackup",dimensione:1,titolo:"GESTIONE_BACKUP"}).show()},clickBtnCambiaPwd:function(){Ext.create("winCBA",{permesso:"S",closable:!0,maximizable:!1,name:"Generali.gestPwdNew.view.ModificaPwd",titolo:traduci("MODIFICA_PWD"),altezzaWin:210,
larghezzaWin:400}).show()},afterrenderLbPreferenze:function(a){var b=this;a.getEl().on("click",function(){Ext.create("winCBA",{permesso:"S",name:"Sipcar.view.PersonUtente",titolo:"PREFERENZE_OPERATORE",dimensione:3,configItem:{permesso:"S",controllerMenu:b.cbaConfig.controllerMenu}}).show()})},selectCbOrganizzazione:function(a,b,c){this.cbaConfig.controllerMenu.setOrganizzazioneSessione(b)},clickBtnEsciMenu:function(){Messaggio("ATTENZIONE","MSG_LOGOUT","YESNO","WARNING",!1,function(){doLogout()},
!1,!1)},afterrenderLingua:function(a){a.setText('<span class="cbaLabel">'+traduci("LINGUA")+' </span><img src="'+Ext.BLANK_IMAGE_URL+'" class="icon-'+CBA.parametriGenerali.lingua+'" style="vertical-align:middle;width: 16px; height: 16px"/>',!1)},clickBtnHelpMenu:function(a){showHelp()},onLaunch:function(){if("T"===CBA.parametriGenerali.amministratore||"T"===CBA.parametriGenerali.autorizzatore||"T"===CBA.parametriGenerali.amministratoreOrg)this.getBtnGestionePwd().setHidden(!1),this.getBtnBackupDb().setHidden(!1);
!0===CBA.parametriGenerali.ldapEnabled&&this.getBtnCambiaPwd().hide();var a=this.getCbOrganizzazione(),b=a.getStore(),c=b.getCount(),d=this.getLbEnte(),e=this.getLbNomeUtente();a.setVisible(1<c);a.setValue(getIdOrg());d.setVisible(1==c);d.setText(b.getAt(0).get("valore"));e.setText('<div> <img src="'+Ext.BLANK_IMAGE_URL+'" class="icon-user" style="vertical-align:middle; width: 20px;"/> <span>'+CBA.parametriGenerali.nomeUtente+"</span></div>",!1)},destroy:function(){this.callParent()}});
Ext.define("Sipcar.controller.Login",{extend:"Ext.app.Controller",refs:[{ref:"MyViewport",selector:"#MyViewport"},{ref:"Dominio",selector:"#Dominio"},{ref:"UserName",selector:"#UserName"},{ref:"Password",selector:"#Password"},{ref:"BtnLogin",selector:"#BtnLogin"},{ref:"CntBtnLogin",selector:"#CntBtnLogin"},{ref:"LblPwdDimenticata",selector:"#LblPwdDimenticata"},{ref:"BtnOauthAzure",selector:"#BtnOauthAzure"},{ref:"pnlDati",selector:"#pnlDati"},{ref:"BtnEntra",selector:"#BtnEntra"},{ref:"TbLogin",
selector:"#TbLogin"},{ref:"Login",selector:"#Login"},{ref:"LbErrore",selector:"#LbErrore"},{ref:"CbEnte",selector:"#CbEnte"},{ref:"CbOrg",selector:"#CbOrg"},{ref:"CardUser",selector:"#CardUser"},{ref:"ImgSipcar",selector:"#ImgSipcar"},{ref:"MenuApplicativi",selector:"#MenuApplicativi"},{ref:"ToolInfo",selector:"#ToolInfo"},{ref:"Menu",selector:"#Menu"},{ref:"CntAvvisi",selector:"#CntAvvisi"}],onAfterrenderLblPwdDimenticata:function(a){var b=this;a.getEl().on("click",function(){Ext.create("winCBA",
{permesso:"S",closable:!0,maximizable:!1,titolo:"RECUPERO_PWD",larghezzaWin:400,altezzaWin:150,name:[{xtype:"panel",bodyPadding:10,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"Nome Utente",labelClsExtra:"cbaLabel",itemId:"TxtUserNameReset",reference:"TxtUserNameReset",enableKeyEvents:!0,listeners:{keydown:function(a,d){13!=d.getKey()||a.stopKeyEvent||b.resetPwd(a,function(){a.up("window").close();b.getLblPwdDimenticata().hide()});a.stopKeyEvent=!1}}}],dockedItems:[{xtype:"toolbar",
dock:"bottom",itemId:"TbLogin",reference:"TbLogin",layout:{pack:"center",type:"hbox"},items:[{xtype:"button",itemId:"BtnResetPwd",reference:"BtnResetPwd",width:100,scale:"large",text:traduci("CONFERMA"),handler:function(a){var c=a.up("panel").queryById("TxtUserNameReset");b.resetPwd(c,function(){c.up("window").close();b.getLblPwdDimenticata().hide()})}}]}]}]}).show()})},resetPwd:function(a,b){var c=a.getValue();c?Ext.Ajax.request({method:"GET",params:{username:c},url:"/cba/gen/auth/resetPwd",success:function(a){a=
Ext.JSON.decode(a.responseText);a.success?Messaggio("INFO",a.message[0].testo,"OK","INFO"):msgShowError("",a.message);b&&b()}}):(msgShowError("","Nome Utente non valido"),a.stopKeyEvent=!0)},onTextfieldKeyup:function(a,b,c){13==b.getKey()&&this.getBtnLogin().isVisible()&&this.getCntBtnLogin().isVisible()&&!this.getBtnLogin().isDisabled()&&0==this.getPassword().stopKeyEvent&&(this.getBtnLogin().focus(),this.login());this.getPassword().stopKeyEvent=!1},onButtonClickLogin:function(a,b,c){this.login()},
changeVisibility:function(a,b){this.getPassword().inputEl.dom.type="visibility"==b.id?"text":"password";a.triggers.visibility.setVisible("visibilityOff"==b.id);a.triggers.visibilityOff.setVisible("visibility"==b.id)},onButtonClickEntra:function(a,b,c){b=this.getCbOrg();if(a=b.getValue()){c=b.getStore();b=trovaRecord(c,"valore",b.getRawValue());var d=c=0;b&&(c=b.get("extra"),d=b.get("idOrganizzazione"));this.setEntePwdSessione(a,c,d)}else msgShowError("","MSG_ERRORE_ENTE_LOGIN")},creaTaskJWT:function(){var a=
new Ext.util.TaskRunner;CBA.task_jwt=a.newTask({run:function(){var a=localStorage.getItem("cba_jwt_refresh_token"),c=parseJwt(a),a=1E3*(c.exp-2),c=+c.jwtD;if(Date.now()>a)abort_and_redirect_to_login();else{var d=localStorage.getItem("cba_jwt_token");parseJwt(d);c=6E4*(5>c?c-1:5);d=Date.now()-CBAServerTimeGAP;a-d<=c&&(CBA.task_jwt_win||(CBA.task_jwt_win=Ext.create("Ext.window.Window",{title:"ATTENZIONE",width:500,minHeight:120,closable:!1,bodyPadding:5,defaultAlign:"br-br",layout:{type:"vbox",align:"center"},
alwaysOnTop:!0,items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",width:32,height:32,cls:"icon-warning",margin:"0 5px 0 0"},{xtype:"label",cls:"cbaLabel",style:{fontSize:"18px",fontWeigth:"bold"},html:traduci("NOTIFICA_USCITA_PROGRAMMA")+" "+moment(a).format("HH:mm")}]},{xtype:"button",width:140,margin:"10 0 0 0",text:traduci("CONTINUA_UTILIZZO"),cls:49==CBA.moduli.moduloAttivo?"cba-css-button-light":"cba-button-25",handler:function(){StdSipcar.promiseGetRequest("/cba/gen/auth/user/selectEntePwd",
{force_refresh_token:!0,idEnte:CBA.parametriGenerali.codEntePwd});CBA.task_jwt_win.close();CBA.task_jwt_win=null}}]})),CBA.task_jwt_win.show(),CBA.task_jwt_win.toFront())}},interval:3E4});CBA.task_jwt.start()},onComboboxExpand:function(a,b){a.cbaConfig.lockAutoEnter=!0},onComboboxChange:function(a,b,c,d){var e=this;if(Ext.isEmpty(b))return e.getCbOrg().getStore().clearData(),e.getCbOrg().setValue(""),!1;Ext.isEmpty(e.codProfilo)||(e.getCbOrg().getStore().clearData(),e.getCbOrg().clearValue(),e.getCbOrg().getStore().getProxy().timeout=
3E5,e.getCbOrg().getStore().load({params:{codProfilo:e.codProfilo,codEnte:b},callback:function(a,b,c){c&&!Ext.isEmpty(a)&&(e.getCbOrg().setValue(a[0].get("codice")),1!==a.length||!0!==e.unicoEnte&&!e.parametriGet?(e.getCntBtnLogin().hide(),e.getBtnOauthAzure().hide(),e.getBtnEntra().show()):(a=e.getBtnEntra(),a.fireEvent("click",a)))}}))},onComboboxCollapse:function(a,b){a.cbaConfig.lockAutoEnter=!1},onComboboxSpecialkey:function(a,b,c){b.getKey()==Ext.event.Event.ENTER&&this.getCbOrg().focus()},
onMenuShowMenuApplicativi:function(a,b){a.updateLayout()},onComboboxOrgSpecialkey:function(a,b,c){a.cbaConfig.lockAutoEnter||b.getKey()!=Ext.event.Event.ENTER||(a=this.getBtnEntra(),a.fireEvent("click",a))},aggiungiTabCbaLocalStorage:function(){var a="cba_tab_"+ +new Date;sessionStorage.setItem("TabHash",a);var b=JSON.parse(localStorage.getItem("CbaTabsOpen")||"{}");b[a]=isSecondWinCss()?"T":"F";localStorage.setItem("CbaTabsOpen",JSON.stringify(b))},onLaunch:function(){var a=this;this.auth_configuration=
null;var b=this,c=!1,d=b.getCntBtnLogin(),e=b.getBtnOauthAzure(),f=getParametriGet(),h="",g=!1,l=!1,m=localStorage.getItem("cbaCurrentTimeStamp")||Date.now(),k=Date.now(),n=!1,p="T"==sessionStorage.getItem("cbaRedirectToLogin");sessionStorage.removeItem("cbaRedirectToLogin");Ext.isObject(f)&&(h=f.cdc,sessionStorage.setItem("isSecondWinCss",f.isSecondWinCss));p||(n=2E3<k-m,!n&&sessionStorage.getItem("cbaLastUnload")&&(c=!0,sessionStorage.removeItem("cbaLastUnload")));if(!c||!sessionStorage.getItem("TabHash"))if(p||
n||!sessionStorage.getItem("TabHash")||(g=l=!0),areOpenedOnlySecondaryTabs()||0<countOpenedTabs(!0)&&!isSecondWinCss())g=!0;"T"==h||c||l||!n||(channel_cba.postMessage(new CBAMessageChannel(type_message_channel.REDIRECT_TO_LOGIN)),localStorage.removeItem("CbaTabsOpen"),g=!1,abort_and_redirect_to_login(!1));if(g)return sessionStorage.clear(),this.blockWindow(),!1;this.aggiungiTabCbaLocalStorage();isSecondWinCss()||setInterval(function(){localStorage.setItem("cbaCurrentTimeStamp",Date.now())},2);Ext.Ajax.request({method:"GET",
params:{hideInizioAttesa:!0},url:"/cba/gen/auth/serverDateHour",success:function(a){a=Ext.JSON.decode(a.responseText);if(a.success)if(a=a.data?Ext.Date.parse(a.data,"c"):null){var b=moment();a=moment.duration(b.diff(a));b=a.asMinutes();CBAServerTimeGAP=a.asMilliseconds();5<=Math.abs(b)&&msgShowWarning("Attenzione","Verificare la differenza oraria del server e del client.<br>Rilevata differenza superiore a 5 minuti")}else msgShowError("","ERROR_DATA");else msgShowError("",a.message)}});b.storeUtente=
Ext.create("Sipcar.store.utente");Ext.isObject(f)?(b.parametriGet=f,history.replaceState&&history.replaceState({},"","/cba/login.html")):(localStorage.removeItem("cartella_old"),localStorage.removeItem("ricovero_old"),localStorage.removeItem("idProfiloPwdDeCss"),localStorage.removeItem("idProfiloCss"));this.getUserName().setValue("");this.getPassword().setValue("");this.getPassword().stopKeyEvent=!1;b.getUserName().focus();f=b.getBtnEntra();c=b.getLbErrore();d.hide();e.hide();this.getUserName().hide();
this.getPassword().hide();f.hide();c.hide();Localizer.localize(b.getMyViewport());if(Ext.isIE8m)return c.update('<span class="erroreLogin">'+traduci("MSG_ERRORE_VERSIONE_IE9")+"<span>"),c.show(),!1;f=Ext.getVersion();if(f.isLessThan("6.2.1.167")||f.isGreaterThan("6.2.1.167"))return c.update('<span class="erroreLogin">'+traduci("MSG_ERRORE_VERSIONE_EXTJS")+"<span>"),c.show(),!1;"T"==localStorage.getItem("cbaErroreConnessione")&&(localStorage.setItem("cbaLogoutEseguito","T"),localStorage.removeItem("access_token_dm7"));
localStorage.setItem("cbaErroreConnessione","F");"F"==localStorage.getItem("cbaLogoutEseguito")?(setTitleDocument(localStorage.cbaNomeUtente),this.caricaApplicativi(localStorage.getItem("cbaCodEntePwd"),localStorage.getItem("cbaidProfiloPwdDe"),localStorage.getItem("idOrganizzazione"))):Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/configuration-login",success:function(c){c=Ext.JSON.decode(c.responseText).data.configurations;var f=c.Azure;a.auth_configuration=c;e.setVisible(f);d.setVisible(!f);
a.getUserName().setVisible(!f);a.getPassword().setVisible(!f);(f&&oauthCodeInUrl()||b.parametriGet&&!f)&&b.login()}});b.getVersioniLibrerie();Ext.Ajax.request({method:"GET",url:"/cba/gen/config/ldap/get",success:function(a){a=Ext.JSON.decode(a.responseText);Ext.apply(CBA.parametriGenerali,{ldapEnabled:a.data});CBA.parametriGenerali.ldapEnabled&&(a=b.getDominio(),a.bindStore(Ext.create("Sipcar.store.domini")),a.setHidden(!1),a.getStore().load({callback:function(a,b,c){c&&(Ext.isEmpty(a)||cmb.setValue(a[0]))}}))}});
Ext.Ajax.request({method:"GET",url:"/cba/gen/config/personPwd/get",success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(CBA.parametriGenerali&&CBA.parametriGenerali.personPwd&&delete CBA.parametriGenerali.personPwd,Ext.apply(CBA.parametriGenerali,{personPwd:a.data})):msgShowError(a.message)}});Ext.Ajax.request({method:"GET",url:"/cba/gen/config/comunicazioni/list",success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){if(!Ext.isEmpty(c.data)){Ext.each(c.data,function(a){b.creaPannelloComunicazione(a)});
var d=setInterval(function(){clearInterval(d);a.getCntAvvisi()&&a.getCntAvvisi().removeAll()},2E4)}}else msgShowError("ERRORE",c.message)}});Ext.Ajax.request({method:"GET",url:"/cba/gen/config/installationType/get",success:function(a){a=Ext.JSON.decode(a.responseText);Ext.apply(CBA.parametriGenerali,{installationType:a.data})}})},creaPannelloComunicazione:function(a){a=Ext.create("Ext.container.Container",{xtype:"container",layout:{type:"vbox",align:"stretch"},minHeight:100,padding:10,style:{"background-color":"rgba(0,0,0,0.87)",
"border-radius":"2px","text-align":"center"},items:[{xtype:"label",text:a.comunicazione,flex:1,style:{"font-size":"15px",color:"white"}},{xtype:"tbfill"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"tbfill"},{xtype:"label",text:"OK",margin:"0 10 0 0",style:{color:"rgb(255, 64, 129)","font-size":"14px"},listeners:{afterrender:function(a){a.getEl().on("click",function(b){a.up("container").up("container").destroy()})}}}]}]});this.getCntAvvisi().add(a)},getVersioniLibrerie:function(){var a=
this;Ext.Ajax.request({method:"GET",url:"/cba/gen/systeminfo",params:{parametro:"java.runtime.version"},success:function(b){b=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",align:"stretch"},bodyPadding:10,items:[{xtype:"label",margin:"0 0 20 0",html:'<div> <img src="generali/images/login/logo-extjs.png" style="height: 24px;"/> <span class="cbaVersioniLibrerie">v.'+Ext.getVersion().version+"</span></div>"},{xtype:"label",margin:"0 0 20 0",html:'<div> <img src="generali/images/login/logo-jasper.png" style="height: 24px;"/> <span class="cbaVersioniLibrerie">v.6.7.0</span></div>'},
{xtype:"label",html:'<div> <img src="generali/images/login/logo-java.png" style="height: 40px;"/> <span class="cbaVersioniLibrerie">v.'+b.responseText+"</span></div>"}]});creaToolTip(a.getToolInfo().id,"","VERSIONI_LIBRERIE_TT",200,300,b)}})},login:function(){var a=this,b=a.getUserName().getValue();Ext.isEmpty(a.getDominio().getValue())||(b=a.getDominio().getValue()+"\\"+b);var c=a.getPassword().getValue(),d="F",e,f="",h=CBATipoAuth.SIPCAR2;a.getPassword().setValue("********");if(oauthCodeInUrl()){var f=
(new URLSearchParams(window.location.search)).get("code"),h=sessionStorage.getItem("auth_type"),g=new URL(window.location.href);g.searchParams["delete"]("code");g.searchParams["delete"]("session_state");history.replaceState(null,"",g.toString())}else a.parametriGet&&(d="T",b=a.parametriGet.username,c=a.parametriGet.password,e=a.parametriGet.cdc);g=a.storeUtente.getProxy();g.actionMethods.read="POST";g.extraParams={username:"T"==d?b:btoa(b),password:"T"==d?c:btoa(c),encrypt:d,cdc:e,code:f,source:"sipcar2",
oAuthType:h};a.storeUtente.load({callback:function(b,c,d){if(d){var e=b[0].getData();localStorage.setItem("cba_jwt_token",e.token);localStorage.setItem("cba_jwt_refresh_token",e.refreshToken);a.pwdCambiataCorrettamente=!0;if(!e.codProfilo)return msgShowError("","MSG_ERRORE_PROFILO"),!1;if(!0===e.aggiornaPwd){var f=Ext.create("winCBA",{titolo:"Aggiorna Password",name:"Generali.gestPwdNew.view.AggiornaPassword",maximizable:!1,larghezzaWin:400,altezzaWin:200,configItem:{codUtente:e.codUtente,dataAttivazionePwd:e.dataAttivazionePwd}});
f.on("close",function(){f.configItem.esitoPwd&&a.concludiProceduraLogin(e)});f.show()}else a.concludiProceduraLogin(e)}else delete a.parametriGet,msgShowError("",c.error,function(){a.getPassword().selectText();a.getPassword().stopKeyEvent=!0;a.getPassword().focus()})}})},concludiProceduraLogin:function(a){var b=this;b.codProfilo=a.codProfilo;var c=b.getCbEnte(),d=c.getStore();d.getProxy().actionMethods.read="GET";d.getProxy().extraParams.codProfilo=a.codProfilo;d.getProxy().timeout=3E5;d.load({callback:function(a,
d,h){a[0].getData();Ext.isEmpty(a)||(1===a.length&&(b.unicoEnte=!0),a=b.parametriGet&&b.parametriGet.codEntePwd?b.parametriGet.codEntePwd:a[0].get("codice"),c.setValue(a),b.getCardUser().getLayout().setActiveItem("CardEnte"),c.focus())}});setTitleDocument(a.nomeUtente)},caricaApplicativi:function(a,b,c){var d;if("F"==localStorage.getItem("cbaLogoutEseguito"))Ext.apply(CBA.parametriGenerali,{codEntePwd:localStorage.getItem("cbaCodEntePwd"),idOrganizzazione:localStorage.getItem("idOrganizzazione"),
codUtente:localStorage.getItem("cbaCodUtente"),amministratore:localStorage.getItem("cbaAmministratore"),autorizzatore:localStorage.getItem("cbaAutorizzatore"),amministratoreOrg:localStorage.getItem("cbaAmministratoreOrg"),nomeUtente:localStorage.getItem("cbaNomeUtente"),codProfilo:localStorage.getItem("cbaCodProfilo"),lingua:localStorage.getItem("cbaLingua"),idProfiloPwdDe:localStorage.getItem("cbaidProfiloPwdDe"),idProfiloCss:"null"==localStorage.getItem("idProfiloCss")?null:localStorage.getItem("idProfiloCss"),
idProfiloPwdDeCss:"null"==localStorage.getItem("idProfiloPwdDeCss")?null:localStorage.getItem("idProfiloPwdDeCss"),consenso:localStorage.getItem("consenso"),docPers:localStorage.getItem("docPers"),ricoveriCss:localStorage.getItem("ricoveriCss"),filtriAttivi:localStorage.getItem("filtriAttivi"),filtroRepartoCss:localStorage.getItem("filtroRepartoCss"),filtroServiziCss:localStorage.getItem("filtroServiziCss"),filtroMedico:localStorage.getItem("filtroMedico"),armadioFarma:localStorage.getItem("armadioFarma"),
etichetteFarma:localStorage.getItem("etichetteFarma"),cssAttivita:localStorage.getItem("cssAttivita")}),d=CBA.parametriGenerali.lingua;else{d=CBA.parametriGenerali.lingua;var e=this.storeUtente.getAt(0);e.get("lingua")&&(d=e.get("lingua").toLowerCase());Ext.apply(CBA.parametriGenerali,{codEntePwd:a,idOrganizzazione:c,idProfiloPwdDe:b,idProfiloPwdDeCss:"",idProfiloCss:"",codUtente:e.get("codUtente"),amministratore:e.get("amministratore"),autorizzatore:e.get("autorizzatore"),amministratoreOrg:e.get("amministratoreOrg"),
nomeUtente:e.get("nomeUtente"),codProfilo:e.get("codProfilo"),lingua:d,consenso:"T"==e.get("consenso")?e.get("consenso"):"F",docPers:"T"==e.get("docPers")?e.get("docPers"):"F",ricoveriCss:"T"==e.get("ricoveriCss")?e.get("ricoveriCss"):"F",armadioFarma:"T"==e.get("armadioFarma")?e.get("armadioFarma"):"F",etichetteFarma:"T"==e.get("etichetteFarma")?e.get("etichetteFarma"):"F",cssAttivita:"T"==e.get("cssAttivita")?e.get("cssAttivita"):"F",cssProdottiMedicazioni:"T"==e.get("cssProdottiMedicazioni")?e.get("cssProdottiMedicazioni"):
"F",filtriAttivi:"",filtroRepartoCss:"",filtroServiziCss:Ext.isEmpty(CBA.parametriGenerali.filtroServiziCss)?"":CBA.parametriGenerali.filtroServiziCss,filtroMedico:""})}localStorage.setItem("cbaCodUtente",CBA.parametriGenerali.codUtente);localStorage.setItem("cbaAmministratore",CBA.parametriGenerali.amministratore);localStorage.setItem("cbaAutorizzatore",CBA.parametriGenerali.autorizzatore);localStorage.setItem("cbaAmministratoreOrg",CBA.parametriGenerali.amministratoreOrg);localStorage.setItem("cbaCodEntePwd",
CBA.parametriGenerali.codEntePwd);localStorage.setItem("idOrganizzazione",CBA.parametriGenerali.idOrganizzazione);localStorage.setItem("cbaNomeUtente",CBA.parametriGenerali.nomeUtente);localStorage.setItem("cbaLingua",CBA.parametriGenerali.lingua);localStorage.setItem("cbaCodProfilo",CBA.parametriGenerali.codProfilo);localStorage.setItem("cbaidProfiloPwdDe",CBA.parametriGenerali.idProfiloPwdDe);localStorage.setItem("idProfiloCss",CBA.parametriGenerali.idProfiloCss);localStorage.setItem("idProfiloPwdDeCss",
CBA.parametriGenerali.idProfiloPwdDeCss);localStorage.setItem("consenso",CBA.parametriGenerali.consenso);localStorage.setItem("docPers",CBA.parametriGenerali.docPers);localStorage.setItem("ricoveriCss",CBA.parametriGenerali.ricoveriCss);localStorage.setItem("filtriAttivi",CBA.parametriGenerali.filtriAttivi);localStorage.setItem("filtroRepartoCss",CBA.parametriGenerali.filtroRepartoCss);localStorage.setItem("filtroServiziCss",CBA.parametriGenerali.filtroServiziCss);localStorage.setItem("filtroMedico",
CBA.parametriGenerali.filtroMedico);localStorage.setItem("armadioFarma",CBA.parametriGenerali.armadioFarma);localStorage.setItem("etichetteFarma",CBA.parametriGenerali.etichetteFarma);localStorage.setItem("cssAttivita",CBA.parametriGenerali.cssAttivita);localStorage.setItem("cssProdottiMedicazioni",CBA.parametriGenerali.cssProdottiMedicazioni);getModuliAbilitati();a=Sipcar.app.getController("Menu");a.creaOrganizzazioni();CBA.parametriGenerali.produzione?(Localizer.loadLocaleStrings("/cba/lingue/generali-"+
d+".js"),loadScript("/cba/lingue/ext-lang-"+d+".js")):(Localizer.loadLocaleStrings("/cba/generali/lingue/"+d+".js"),loadScript("/cba/generali/lingue/ext-lang-"+d+".js"));localStorage.setItem("cbaLogoutEseguito","F");a.getTabApplicativi().hide();Localizer.localize(this.getMenu());this.getMyViewport().getLayout().setActiveItem("Menu");this.creaTaskJWT()},getMenuSipcar:function(){var a=this,b=a.getMenuApplicativi(),c=Sipcar.app.getController("Menu"),d=c.getTabApplicativi(),e=c.getCardApplicativo();b.removeAll();
d.removeAll();e.removeAll();a.storeModuli=Ext.create("Ext.data.ArrayStore",{fields:"codice valore area ordine abilitato urlParametriGenerali".split(" "),data:[[44,"Contabilit&agrave; Economica","Amministrazione",1,CBA.moduli.modulo44.abilitato,"/cba/amm/cp/ws/prszn/genparams"],[51,"Contabilit&agrave; Analitica","Amministrazione",2,CBA.moduli.modulo51.abilitato,"/cba/amm/an/ws/prszn/genparams"],[52,"Inventario Beni","Amministrazione",3,CBA.moduli.modulo52.abilitato,"/cba/amm/ib/ws/prszn/genparams"],
[53,"Cespiti","Amministrazione",4,CBA.moduli.modulo53.abilitato,"/cba/amm/ces/ws/prszn/genparams"],[54,"Budget","Amministrazione",5,CBA.moduli.modulo54.abilitato,"/cba/amm/gb/ws/prszn/genparams"],[56,"Cassa Economato","Amministrazione",6,CBA.moduli.modulo56.abilitato,"/cba/amm/ce/ws/prszn/genparams"],[57,"Ordini Fornitore","Economato",1,CBA.moduli.modulo57.abilitato,"/cba/eco/of/ws/prszn/genparams"],[62,"Farmacia","Economato",2,CBA.moduli.modulo62.abilitato,"/cba/eco/far/ws/prszn/genparams"],[58,
"Magazzino","Economato",3,CBA.moduli.modulo58.abilitato,"/cba/eco/mag/ws/prszn/genparams"],[59,"Servizio Manutenzione","Economato",4,CBA.moduli.modulo59.abilitato,"/cba/eco/mn/ws/prszn/genparams"],[60,"Richieste da Reparto","Economato",5,CBA.moduli.modulo60.abilitato,"/cba/eco/rc/ws/prszn/genparams"],[61,"Menu Pasti","Economato",6,CBA.moduli.modulo61.abilitato,"/cba/eco/pa/ws/prszn/genparams"],[43,"Contabilit&agrave; Utenti","Utenti",1,CBA.moduli.modulo43.abilitato,"/cba/osp/co/ws/AnagraficaOspiti/genparams"],
[50,"Contabilit&agrave; Alunni","Utenti",2,CBA.moduli.modulo50.abilitato,"/cba/osp/co/ws/AnagraficaOspiti/genparams"],[46,"Denaro Utenti","Utenti",3,CBA.moduli.modulo46.abilitato,"/cba/osp/den/ws/denaro/genparams"],[48,"Lista d'attesa","Utenti",4,CBA.moduli.modulo48.abilitato,"/cba/osp/la/ws/listaAttesa/genparams"],[55,"Scheda FAR","Utenti",5,CBA.moduli.modulo55.abilitato,"/cba/osp/far/ws/schedaFAR/genparams"],[64,"RSA Aperta Lombardia","Utenti",6,CBA.moduli.modulo64.abilitato,"/cba/osp/rap/ws/rsaAperta/genparams"],
[49,"Cartella","Css",1,CBA.moduli.modulo49.abilitato,"/cba/css/cs/ws/prszn/genparams"],[69,"ParlaConNoi","Css",2,CBA.moduli.modulo69.abilitato,"/cba/css/cm/ws/collegaMenti/genparams"],[45,"Rilevazione Presenze","Personale",1,CBA.moduli.modulo45.abilitato,"/cba/per/prz/ws/tabgen/genparams"],[63,"Turni di Lavoro","Personale",2,CBA.moduli.modulo63.abilitato,"/cba/per/trn/ws/tabgen/genparams"],[-1,"Analisi dati","Analisi",1,CBA.moduli.moduloAnalisiDati.abilitato]],autoDestroy:!0});a.storeModuli.load({callback:function(f,
h,g){if(g){var l=[],m,k=0,n;Ext.each(f,function(f){var h=f.getData(),g={idModulo:h.codice,desModulo:h.valore,area:h.area,urlParametriGenerali:h.urlParametriGenerali},k=f.get("area");-1===l.indexOf(k)&&(l.push(k),m=Ext.create("Ext.menu.Menu"),b.add({xtype:"menuitem",height:-1!=f.get("codice")?90:30,width:100,text:"Analisi"==f.get("area")?"Analisi":"",cls:"menuItemSipcar",menu:m,listeners:{afterrender:function(a){"Analisi"!=k&&(a=a.getEl(),a.setStyle("background-image",'url("/cba/generali/images/sfondi/menu_logo_'+
k.toLowerCase()+'.png")'),a.setStyle("background-repeat","no-repeat"),a.setStyle("background-position","center"))}}}));m.add({xtype:"menuitem",cls:"menuItemSipcar",text:g.desModulo,itemId:"menuitem"+g.idModulo,cbaConfig:g,disabled:!f.get("abilitato"),handler:function(){if(g.idModulo!=localStorage.getItem("moduloAttivo")&&1<countOpenedTabs())return msgShowWarning("ATTENZIONE","BLOCCO_TAB_SECONDARI_APERI"),!1;var b={};b.tabApplicativi=d;b.cardApplicativo=e;b.controllerMenu=c;var f=c.getTabApplicativi(),
h=!1;this.controlParam&&(b.forzaChiusura=!0,delete this.controlParam);0<f.items.length&&f.items.items.forEach(function(a){a.cbaConfig.idModulo&&a.cbaConfig.idModulo==g.idModulo&&(h=!0,b.forzaChiusura||d.setActiveTab("tab"+g.idModulo))});if(h&&!b.forzaChiusura)return!1;if(49==g.idModulo&&Ext.isEmpty(CBA.parametriGenerali.idProfiloCss)&&Ext.isEmpty(CBA.parametriGenerali.idProfiloPwdDeCss)){var r=Ext.create("Generali.gestPwdNew.store.ProfiliPwdDeCss");r.load({params:{idProfiloPwdDe:CBA.parametriGenerali.idProfiloPwdDe},
callback:function(c,d,e){e&&(Ext.isEmpty(c)?msgShowError("","MSG_NESSUNA_TIPCART"):(g.existFiltroMedici=a.getFiltroMedici(),g.existFiltroServizi=a.getFiltroServizi(),(d=CBA.parametriGenerali.filtriAttivi.filtroReparti)&&d.valore&&(g.elencoFiltroRep=d.extra.trim()),1!==c.length||g.existFiltroMedici||g.existFiltroServizi||g.elencoFiltroRep&&1!=g.elencoFiltroRep.split("\n").length?a.impostaProfiloCss(g,r,b):(CBA.parametriGenerali.idProfiloPwdDeCss=c[0].getData().id,CBA.parametriGenerali.idProfiloCss=
c[0].getData().idProfiloCss,Ext.isEmpty(CBA.parametriGenerali.idProfiloCss)||Ext.isEmpty(CBA.parametriGenerali.idProfiloPwdDeCss)||a.proceduraCreazioneModulo(g,b))))}})}else a.proceduraCreazioneModulo(g,b)}})});b.items.each(function(a){var b=0;a.menu.items.each(function(a){a.isDisabled()||(b++,-1!=a.cbaConfig.idModulo&&(n=a,k++))});0===b&&a.hide()});Ext.apply(CBA,{totModuliAbilitati:k,unicoModuloAbilitato:n})}}})},getFiltroMedici:function(){var a=!1;Ext.Ajax.request({url:"/cba/gen/auth/user/existFiltroMedici",
async:!1,method:"GET",success:function(b){b=Ext.decode(b.responseText);b.success?b.data&&(a=b.data):msgShowError("",b.message)}});return a},getFiltroServizi:function(){var a=!1;Ext.Ajax.request({url:"/cba/gen/auth/perGenerali/abilitaServizi/get",async:!1,method:"GET",success:function(b){b=Ext.decode(b.responseText);b.success?b.data&&b.data&&(b=CBA.parametriGenerali.filtriAttivi.filtroServizi)&&b.valore&&(a=b.valore.trim()):msgShowError("",b.message)}});return a},addIconaEP:function(a){var b=Ext.create({xtype:"container",
margin:"5 0 0 0",itemId:"CntIconaEP",reference:"CntIconaEP",width:30,height:30,hidden:!0,items:[{xtype:"image",src:"/cba/css/generali/images/generali/CTAelencopazienti.svg",width:30,height:30}]});a.insert(1,b)},ricercaUtentiCartella:function(a){var b=this,c=Sipcar.app.getController("Menu").getCardApplicativo().getLayout().getActiveItem().down("panel");c&&(c.setTitle(traduci("FILTRO_UTENTE")),c.getPlaceholder().on("afterrender",function(a){creaToolTip(a.getId(),!1,!1,!1,!1,[{xtype:"image",src:"/cba/css/generali/images/generali/expand.png",
height:32,width:32}],!1,!1,!0);b.addIconaEP(a)}),c.show(),Ext.defer(function(){var b=c.add(Ext.create("GeneraliCS.anagrafica.view.Cerca",{cbaConfig:{fromFiltroUtente:!0}}));a&&b.controller.cerca()},20))},caricaGeneraliArea:function(a){if(CBA.parametriGenerali.produzione){var b=Sipcar.app.getController("Menu").getCardApplicativo();this.areeCaricate||(this.areeCaricate=[]);-1==this.areeCaricate.indexOf(a)?(loadScript("generali"+a+"-min.js",function(){"Personale"===a&&StdPersonale.getPersonGen().then(function(a){StdPersonale.setButtonMenu(a);
StdPersonale.addButtonPortale(a);StdPersonale.addButtonCompleanni(a);StdPersonale.showMsgaggiornaPrsz(a);StdPersonale.addPagheWebOnline(b.queryById("tbdettab45"))})["catch"](function(a){return msgShowError("",a)})}),this.areeCaricate.push(a)):"Personale"===a&&StdPersonale.getPersonGen().then(function(a){StdPersonale.setButtonMenu(a);StdPersonale.addButtonPortale(a);StdPersonale.addButtonCompleanni(a);StdPersonale.showMsgaggiornaPrsz(a);StdPersonale.addPagheWebOnline(b.queryById("tbdettab45"))})["catch"](function(a){return msgShowError("",
a)})}},startModulo:function(a){var b=this,c=a.idModulo,d=CBA.moduli["modulo"+a.idModulo];if(!d.abilitato)return Messaggio("Attenzione","MSG_MODULO_NON_ABILITATO","OK","WARNING",function(){Sipcar.app.getController("Menu").logout()}),!1;if(CBA.parametriGenerali.produzione){b.caricaGeneraliArea(a.area);var e=[57,58,59,60,62];d.loaded?49==c?b.ricercaUtentiCartella(!0):e.includes(c)&&StdEconomato.startModuloEconomato():(b.setLinguaArea(d,a.area),loadScript("modulo"+c+"-min.js",function(){d.loaded=!0;49==
c?(b.caricaGeneraliArea("Utenti"),b.caricaGeneraliArea("Economato"),b.ricercaUtentiCartella(!0)):55==c?b.caricaGeneraliArea("Css"):43==c||50==c?b.caricaGeneraliArea("Amministrazione"):e.includes(c)?(b.caricaGeneraliArea("Amministrazione"),StdEconomato.initComponentiEco()):69===c&&b.caricaGeneraliArea("Utenti")}))}else{b.setLinguaArea(d,a.area);if(43==c||50==c||55==c)loadScript("ospiti/generali/personalizzazioni/personalizzazioni.js"),loadScript("ospiti/contabilitaUtenti/gestioneFatture/gestioneFatture.js");
49==c?loadScript("css/generali/standard/autoresizeMenu.js",function(){loadScript("css/generali/cba-css-utils/requires-desktop-css.js",function(){loadScript("css/generali/standard/standardCSS.js",function(){loadScript("ospiti/generali/personalizzazioni/personalizzazioni.js",function(){loadScript("css/generali/standard/ControllerTranscodifica.js",function(){loadScript("css/generali/standard/ControllerGenSchedeVal.js",function(){b.ricercaUtentiCartella(!0)})})})})})}):55==c&&loadScript("css/generali/standard/componentiCSS.js",
function(){loadScript("css/generali/standard/standardCSS.js",function(){})})}if(49==c){var f=Sipcar.app.getController("Menu").getCardApplicativo().getLayout().getActiveItem().down("panel");f&&(f.setTitle(traduci("FILTRO_UTENTE")),f.show())}this.setParametriGenApplicativo({idModulo:a.idModulo,modulo:d,urlMenu:49!=a.idModulo?"/cba/gen/ws/general/menuItem/src/withPermission":"/cba/gen/ws/pwd/menuprofilibottoni/newgetmenu",urlParametriGenerali:a.urlParametriGenerali})},setLinguaArea:function(a,b){var c=
"";CBA.parametriGenerali.produzione?("Css"==b&&Localizer.loadLocaleStrings("/cba/lingue/utenti-"+CBA.parametriGenerali.lingua+".js"),c="/cba/lingue/"+b.toLowerCase()+"-"):"Utenti"==b?c="/cba/ospiti/generali/lingue/":"Amministrazione"==b?c="/cba/amministrazione/generali/lingue/":"Personale"==b?c="/cba/personale/generali/lingue/":"Economato"==b?c="/cba/economato/generali/lingue/":"Css"==b&&(Localizer.loadLocaleStrings("/cba/ospiti/generali/lingue/"+CBA.parametriGenerali.lingua+".js"),c="/cba/css/generali/lingue/");
Ext.apply(a,{urlLingue:c+CBA.parametriGenerali.lingua+".js"});Localizer.loadLocaleStrings(a.urlLingue);50==CBA.moduli.moduloAttivo?(c=a.urlLingue.split("/"),c[c.length-1]="alunni-"+CBA.parametriGenerali.lingua+".js",Localizer.caricaLingua(CBA.parametriGenerali.lingua,c.join("/"))):([43,55].includes(CBA.moduli.moduloAttivo)&&(c=CBA.parametriGenerali.produzione?"/cba/lingue/css-":"/cba/css/generali/lingue/",Localizer.loadLocaleStrings(c+CBA.parametriGenerali.lingua+".js")),43==CBA.moduli.moduloAttivo&&
(c=CBA.parametriGenerali.produzione?"/cba/lingue/amministrazione-":"/cba/amministrazione/generali/lingue/",Localizer.loadLocaleStrings(c+CBA.parametriGenerali.lingua+".js")))},setParametriGenApplicativo:function(a){if(this.loginApplicativo(a.idModulo)&&this.checkDbVersion(a.idModulo)){a.urlParametriGenerali&&Ext.Ajax.request({url:a.urlParametriGenerali,async:!1,params:{codEnte:CBA.parametriGenerali.codEntePwd,codProfilo:CBA.parametriGenerali.codProfilo},method:"GET",success:function(b){b=Ext.decode(b.responseText);
b.success?(b.data.serverDate&&(b.data.serverDate=Ext.Date.parse(b.data.serverDate,"c")),Ext.apply(a.modulo,b.data),b.data.csPerGenerali&&b.data.csPerGenerali.asAbilitata&&"T"==b.data.csPerGenerali.asAbilitata&&(Ext.Ajax.request({url:"/cba/css/cs/ws/archsost/ricalcolahashver",method:"GET",success:function(a){a=Ext.decode(a.responseText);a.success||msgShowError("",a.message)}}),Ext.Ajax.request({url:"/cba/css/cs/ws/archsost/impostazioni/getbyprofilo",async:!1,method:"GET",params:{idProfilo:CBA.parametriGenerali.idProfiloCss},
success:function(a){a=Ext.decode(a.responseText);a.success?"T"==a.data.aperturaPnlFirmaStart&&Ext.Ajax.request({url:"/cba/gen/ws/archsost/widget/numero",method:"GET",success:function(a){a=Ext.decode(a.responseText);if(!a.success)msgShowError("",a.message);else if(0<a.data.codice)var b=setInterval(function(){Ext.isEmpty(Ext.ClassManager.getNameByAlias("widget.CSSButtonsPanel"))||(Ext.create("winCBA",{titolo:"titolo",name:"CS.archsost.view.ArchSostMain",maximizable:!1,dimensione:7}).show(),clearInterval(b))},
200)}}):msgShowError("",a.message)}}))):msgShowError("",b.message)}});var b=Sipcar.app.getController("Menu");b.getTabApplicativi().getActiveTab().add(b.creaMenu(a))}},setEntePwdSessione:function(a,b,c){var d=this;Ext.Ajax.request({url:"/cba/gen/auth/user/selectEntePwd",method:"GET",params:{idEnte:a},success:function(e){e=Ext.decode(e.responseText);e.success?d.caricaApplicativi(a,b,c):msgShowError("",e.message)}})},impostaProfiloCss:function(a,b,c){var d=this,e=175;a.elencoFiltroRep&&(e+=75);a.existFiltroServizi&&
(e+=300);var f=Ext.create("winCBA",{titolo:"Seleziona Tipologia Cartella",name:"Sipcar.view.SelTipologiaCartella",maximizable:!1,larghezzaWin:450,altezzaWin:e,configItem:{cbStore:b,filtroMedici:a.existFiltroMedici,elencoReparti:a.elencoFiltroRep,filtroServizi:a.existFiltroServizi}});f.on("close",function(){Ext.isEmpty(f.configItem.idProfiloCss)||Ext.isEmpty(f.configItem.idProfiloPwdDeCss)||(CBA.parametriGenerali.idProfiloCss=f.configItem.idProfiloCss,CBA.parametriGenerali.idProfiloPwdDeCss=f.configItem.idProfiloPwdDeCss,
d.proceduraCreazioneModulo(a,c))});f.show()},checkDbVersion:function(a){var b=!1;Ext.Ajax.request({url:"/cba/gen/auth/webApp/check/dbvers",params:{moduleId:a},method:"GET",async:!1,success:function(a){a=Ext.decode(a.responseText);a.success?a.data?b=!0:Messaggio("ATTENZIONE",a.message[0].testo,"OK","WARNING",function(){Sipcar.app.getController("Menu").logout()}):msgShowError("",a.message)}});return b},logoutApplicativo:function(a){var b="/cba/gen/auth/webApp/disable";43!=a&&(b=!1);b&&Ext.Ajax.request({url:b,
method:"GET",params:{moduleId:a},async:!1,success:function(a){}})},loginApplicativo:function(a){var b=!0;this.logoutApplicativo(a);Ext.Ajax.request({async:!1,url:"/cba/gen/auth/webApp/enable",method:"GET",params:{moduleId:a},success:function(a){a=Ext.decode(a.responseText);a.success?b=!1:msgShowError("",a.message)}});return!b},cambiaSfondo:function(a){var b="";switch(a){case "Utenti":b="logo-sipcarUtenti";break;case "Personale":b="logo-sipcarPersonale";break;case "Amministrazione":b="logo-sipcarAmministrazione";
break;case "Economato":b="logo-sipcarEconomato";break;case "Generali":b="logo-sipcar"}return b},cambiaTab:function(a){if(Ext.isEmpty(a))return!1;var b=a.up();if(1<b.items.length){var c=b.items.length-1;this.getIndexTab(a)<c?b.setActiveTab(b.items.items[c]):b.setActiveTab(b.items.items[c-1])}else CBA.taskNotifiche&&CBA.taskNotifiche.destroy()},getIndexTab:function(a){var b=-1;if(!Ext.isEmpty(a))for(var c=a.up(),d=!1,e=0;e<c.items.length&&!d;e++)c.items.items[e].id==a.id&&(b=e,d=!0);return b},proceduraCreazioneModulo:function(a,
b){var c=this,d=b.tabApplicativi,e=b.cardApplicativo,f=b.controllerMenu;inizioAttesa();Ext.defer(function(){if(-1==a.idModulo)window.open(CBA.parametriGenerali.pathPentaho);else{var h="tab"+a.idModulo,g="det"+h;d.isVisible()||d.show();var l=d.queryById(h);if(l&&!b.forzaChiusura)d.setActiveTab(h);else{if(l&&b.forzaChiusura)return delete b.forzaChiusura,l.config.forzaChiusura=!0,l.close(),c.proceduraCreazioneModulo(a,b),!1;d.add({xtype:"panel",title:a.desModulo,closable:!0,itemId:h,cbaConfig:a,listeners:{destroy:function(a){f.gestisciMenuLayoutPortlet();
c.logoutApplicativo(a.cbaConfig.idModulo);e.remove("det"+a.itemId);d.items.getCount()||(d.hide(),f.cambiaTema("Generali"))},beforeclose:function(a){49==a.config.cbaConfig.idModulo&&(a.config.forzaChiusura?delete a.config.forzaChiusura:(localStorage.removeItem("idProfiloPwdDeCss"),localStorage.removeItem("idProfiloCss"),CBA.parametriGenerali.idProfiloPwdDeCss="",CBA.parametriGenerali.idProfiloCss=""),delete CBA.moduli.modulo49.ricercaRapida,f.getBtnOpenTab().hide());c.cambiaTab(a);var b=e.getLayout().getActiveItem();
return controllaDirtyForm(b,a)}}});d.setActiveTab(h);h={};h=49==a.idModulo?{xtype:"panel",border:0,bodyCls:c.cambiaSfondo(a.area),itemId:g,layout:{type:"border",align:"stretch"},flex:1,items:[{xtype:"panel",floatable:!0,region:"west",hidden:!0,itemId:"pnl"+g,flex:1,maxWidth:300,collapsible:!0,collapseDirection:"left",layout:{type:"vbox",align:"stretch"}},{xtype:"container",border:0,region:"center",flex:1,itemId:"cnt"+g,layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",itemId:"pnlAna"+g,height:44,
bodyPadding:3,hidden:!0,layout:{type:"hbox",align:"stretch"},items:[]},{xtype:"tabpanel",itemId:"tb"+g,flex:1}]}],cbaConfig:a}:{xtype:"panel",border:0,itemId:g,layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"tabpanel",bodyCls:c.cambiaSfondo(a.area),itemId:"tb"+g,flex:1,listeners:{tabchange:function(a,b){return f.aggiornaHlpTopics(a,b)}}}],cbaConfig:a};h=e.add(h);e.getLayout().setActiveItem(g);49==a.idModulo&&h.down("tabpanel").tabBar.hide();c.startModulo(a)}49!==a.idModulo&&fineAttesa()}},
30)},blockWindow:function(){this.getCardUser().hide();this.getTbLogin().hide();this.getLogin().down("#formLogin").add({xtype:"container",style:{textAlign:"center"},html:'\n      <h3 style="color: grey">Sipcar 2.0 risulta aperto in un altro tab del browser<br>\n      Chiudi questa pagina per tornare ad operare.</h3>\n      '})},init:function(a){var b=this;this.control({"textfield#Password":{keyup:this.onTextfieldKeyup},"button#BtnLogin":{click:this.onButtonClickLogin},"button#BtnOauthAzure":{click:function(){return b.onButtonClickOauthAzure(b)}},
"button#BtnEntra":{click:this.onButtonClickEntra},"combobox#CbEnte":{expand:this.onComboboxExpand,collapse:this.onComboboxCollapse,specialkey:this.onComboboxSpecialkey,change:this.onComboboxChange},"combobox#CbOrg":{specialkey:this.onComboboxOrgSpecialkey},"menu#MenuApplicativi":{show:this.onMenuShowMenuApplicativi},"label#LblPwdDimenticata":{afterrender:this.onAfterrenderLblPwdDimenticata}})},onButtonClickOauthAzure:function(a){sessionStorage.setItem("auth_type",CBATipoAuth.AZURE);a=a.auth_configuration.Azure;
var b=new URL(a["authorization.endpoint"]);b.searchParams.append("client_id",a["client.id"]);b.searchParams.append("response_type","code");b.searchParams.append("redirect_uri",a["redirect.uri"]);b.searchParams.append("response_mode","query");b.searchParams.append("scope",a.scope);b.searchParams.append("prompt",a.prompt);window.location.replace(b.toString())}});
Ext.define("Sipcar.controller.Menu",{extend:"Ext.app.Controller",requires:["CbaUtils.componenti.desktop.SearchFlash"],refs:[{ref:"TabApplicativi",selector:"#TabApplicativi"},{ref:"CardApplicativo",selector:"#CardApplicativo"},{ref:"BtnMenuSipcar",selector:"#BtnMenuSipcar"},{ref:"MenuOpzioni",selector:"#MenuOpzioni"},{ref:"MenuLayoutPortlet",selector:"#MenuLayoutPortlet"},{ref:"CntSearchFlash",selector:"#CntSearchFlash"},{ref:"BtnOpenTab",selector:"#BtnOpenTab"},{ref:"Menu",selector:"#Menu"},{ref:"TbMenu",
selector:"#TbMenu"},{ref:"CtnMenuOpzioni",selector:"#CtnMenuOpzioni"},{ref:"CntTabBar",selector:"#CntTabBar"}],aggiornaHlpTopics:function(a,b){var c=null;b&&b.cbaConfig&&b.cbaConfig.idTopic&&(c=b.cbaConfig.idTopic);CBA.moduli["modulo"+CBA.moduli.moduloAttivo].idTopic=c},clickBtnHelp:function(a){var b=this;CBA.moduli["modulo"+CBA.moduli.moduloAttivo].idTopic?Ext.Ajax.request({url:"/cba/gen/ws/hlp/tpc/byParent/list",method:"GET",params:{parentId:CBA.moduli["modulo"+CBA.moduli.moduloAttivo].idTopic},
success:function(c){c=Ext.decode(c.responseText);c.success?Ext.isEmpty(c.data)?showHelp(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].idTopic,!0):b.creaMenuVociHelp(a,c.data):msgShowError("",c.message)}}):showHelp(null,!0)},creaMenuVociHelp:function(a,b){var c=Ext.create("Ext.menu.Menu",{showSeparator:!1,itemId:"MenuStoreOrg",items:[]});Ext.each(b,function(a){c.add([{xtype:"menuitem",text:a.valore,cbaConfig:{idTopic:a.codice,descrizione:a.valore},handler:function(a){showHelp(a.cbaConfig.idTopic,!0)}}])});
c.showBy(a,!1,[0,0])},onSplitbuttonClickBtnMenuSipcar:function(a,b,c){a.showMenu()},onTabpanelBeforeTabChangeTabApplicativi:function(a,b,c,d){var e=this;if(b.cbaConfig.idModulo!=localStorage.getItem("moduloAttivo")&&1<countOpenedTabs())return msgShowWarning("ATTENZIONE","BLOCCO_TAB_SECONDARI_APERI"),!1;this.cambiaTema(b.cbaConfig.area);var f=Sipcar.app.getController("Login");d=trovaRecord(f.storeModuli,"codice",b.cbaConfig.idModulo);c&&(f=trovaRecord(f.storeModuli,"codice",c.cbaConfig.idModulo),"undefined"!=
typeof currOspite&&currOspite&&f.set("currOspite",currOspite),"undefined"!=typeof currRicovero&&currRicovero&&f.set("currRicovero",currRicovero));d.get("currOspite")&&(currOspite=d.get("currOspite"));d.get("currRicovero")&&(currRicovero=d.get("currRicovero"));this.getCntSearchFlash().setVisible(49!=d.get("codice"));this.getBtnOpenTab().setVisible(49==d.get("codice"));if(!Ext.isEmpty(c)&&49==d.get("codice"))if(c=this.getTabApplicativi(),Ext.isEmpty(c.down("#MenuStoreOrg"))||c.down("#MenuStoreOrg").destroy(),
b.loadFunction)insertTipologiaCss(this);else var h=setInterval(function(){b.loadFunction&&(insertTipologiaCss(e),clearInterval(h))},200);c=a.up("toolbar");d=Sipcar.app.getMenuController().getCardApplicativo().up("container");if("css"==b.cbaConfig.area.toLowerCase()){var g=a.up("viewport"),l=Ext.Function.interval(function(){Ext.each(document.styleSheets,function(a){a.href&&-1!=a.href.indexOf("cba-css-all")&&(g.updateLayout(),clearInterval(l))})},20);c.addCls("shadowMenuCartella");d.addCls("shadowMenuCartella")}else c.removeCls("shadowMenuCartella"),
d.removeCls("shadowMenuCartella");a=this.getCardApplicativo();c="dettab"+b.cbaConfig.idModulo;a.queryById(c)&&a.getLayout().setActiveItem(c)},onTabpanelBeforeTabChange:function(a,b,c,d){45==CBA.moduli.moduloAttivo&&Ext.each(b.query("panel[collapsible=true]"),function(a){if(!a.config.collapsed){var b=a.up();b&&"accordion"!=b.getLayout().type&&a.expand()}});49==CBA.moduli.moduloAttivo&&this.getCardApplicativo().getLayout().getActiveItem().down("#pnlAnadettab49").setVisible(b.cbaConfig.utenteObbligatorio);
this.gestisciMenuLayoutPortlet(b.cbaConfig.nomeForm)},onSplitbuttonClick:function(a,b,c){a.showMenu()},gestisciMenuLayoutPortlet:function(a){var b=this.getMenuLayoutPortlet();a?b.setVisible(Ext.Array.contains(this.listaVideatePortlet,a)):b.hide();b.toolTip.close()},onTabpanelTabChange:function(a,b,c,d){var e=this;CBA.moduli.moduloAttivo=b.cbaConfig.idModulo;localStorage.setItem("moduloAttivo",CBA.moduli.moduloAttivo);var f=null;c&&c.cbaConfig&&(f=c.cbaConfig.idModulo);e.getTabApplicativi().down("#CntChangeOrg").setVisible(49!=
CBA.moduli.moduloAttivo);Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/user/setActiveSipcarModule",params:{idModulo:CBA.moduli.moduloAttivo},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(a=e.getCardApplicativo().getLayout().getActiveItem().down("tabpanel").getActiveTab(),e.gestisciMenuLayoutPortlet(a?a.cbaConfig.nomeForm:""),a=e.getTabApplicativi(),Ext.isEmpty(c)&&49!=b.cbaConfig.idModulo?e.changeOrg():49==f?(Ext.isEmpty(a.down("#CntTipologia"))||a.down("#CntTipologia").destroy(),
Ext.isEmpty(a.down("#MenuStoreTip"))||a.down("#MenuStoreTip").destroy(),e.changeOrg()):49!=b.cbaConfig.idModulo&&Ext.isEmpty(a.down("#CntChangeOrg"))&&e.changeOrg()):msgShowError("",a.message)}})},creaOrganizzazioni:function(){var a=this;Ext.isDefined(a.storeOrganizzaizoni)||(a.organizzazione=null,a.storeOrganizzaizoni=Ext.create("Sipcar.store.organizzazioni",{autoDestroy:!1}));a.storeOrganizzaizoni.load({params:{idOrganizzazione:CBA.parametriGenerali.idOrganizzazione},callback:function(b,c,d){if(d)if(Ext.isEmpty(b))msgShowError("",
"MSG_ORG_NON_ASSOCIATA");else{var e=Ext.create("Sipcar.view.SalvaPortlet");c=a.getMenuLayoutPortlet();c.toolTip=creaToolTip(c.getEl(),"","IMPOSTAZIONI_PORTLET",230,330,e,!0,function(b){var c=a.getCardApplicativo().getLayout().getActiveItem().down("tabpanel").down("#WebPortal").controller,d=Sipcar.app.getController("Login"),d=trovaRecord(d.storeModuli,"codice",getModuloAttivo());e.controller.controllerWebPortal=c;e.controller.setNumColonne();Ext.isDefined(a.titleLayoutFascicolo)||(a.titleLayoutFascicolo=
traduci("LAYOUT_FASCICOLO"));b.setTitle(a.titleLayoutFascicolo+" "+d.get("valore"))});a.setOrganizzazioneSessione(b[0]);Sipcar.app.getController("Login").getMenuSipcar();var f=0,h=Ext.Function.interval(function(){250>f?"function"===typeof initRefreshSession&&(initRefreshSession(),clearInterval(h)):clearInterval(h);f++},20)}else msgShowError("",c.getError()),a.logout()}})},setOrganizzazioneSessione:function(a){var b=this;b.organizzazione=a;Ext.apply(CBA.parametriGenerali,{codEnte:101,desEnte:b.organizzazione.get("valore"),
partitaIva:getExtraFieldOrg("pIva")});Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/user/selectOrganization",params:{idOrganizzazione:b.organizzazione.get("codice")},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b.callBack_setOrg():msgShowError("",a.message)}})},callBack_setOrg:function(){var a=CBA.parametriGenerali.idOrganizzazione,b=CBA.parametriGenerali.codEntePwd;Ext.isEmpty(a)||Ext.isEmpty(b)||Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/user/getFilters",params:{codEnte:b,
idOrganizzazione:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(a=a.data,Ext.isEmpty(a)||(CBA.parametriGenerali.filtriAttivi=a)):msgShowError("",a.message)}});a=this.getTabApplicativi().getActiveTab();b=this.getBtnMenuSipcar().menu;a&&(this.getTabApplicativi().items.each(function(a){a.close()}),b.queryById("menuitem"+a.cbaConfig.idModulo).handler());a=Sipcar.app.getController("Login");a.parametriGet?(eseguiModulo(a.parametriGet.idModulo),delete a.parametriGet):1==CBA.totModuliAbilitati&&
CBA.unicoModuloAbilitato&&eseguiModulo(CBA.unicoModuloAbilitato.cbaConfig.idModulo)},creaMenu:function(a){function b(a){return{xtype:"menuitem",cls:"menuItemSipcar",text:a.titolo,idMenu:a.id,itemId:"btn"+a.codVideataPwd,tooltip:a.descrizione,cbaConfig:a,iconCls:a.iconCls,hidden:"F"==a.visibile,handler:function(b){a.protezionePwd?Ext.widget("passwordCBA",{callBackSbloccoPwd:function(c){c&&h.creaTab(m,a,b)}}).show():h.creaTab(m,a,b)}}}function c(a,b,f,g){if(69===CBA.moduli.moduloAttivo&&!StdSipcar.doSecureLogin(function(){c(a,
b,f,g)}))return!1;var h=1,k=Ext.create("Ext.toolbar.Toolbar",{border:0});g.add(k);Ext.each(f,function(c,d){if("N"!=c.permesso){var g={itemId:"btn"+c.codVideataPwd,enableToggle:!0,iconCls:c.iconCls,scale:"large",text:c.titolo,tooltip:49==CBA.moduli.moduloAttivo?"":c.descrizione,hidden:"F"==c.visibile,toggleGroup:"bottoniMenu",cbaConfig:c};c.children?(Ext.apply(g,{xtype:"splitbutton",menu:{xtype:"menu",items:[],ignoreParentClicks:!0},handler:function(){this.showMenu()}}),e(a,c.children,g.menu)):(a.inserisciRecordStoreFlash(a,
b,c,g.itemId),Ext.apply(g,{xtype:"button",handler:function(b){c.protezionePwd?Ext.widget("passwordCBA",{callBackSbloccoPwd:function(d){d&&a.creaTab(m,c,b)}}).show():a.creaTab(m,c,b||this)}}));49==CBA.moduli.moduloAttivo&&Ext.apply(g,{listeners:{afterrender:function(a){var b=0,c=Ext.Function.interval(function(){100>b?"function"==typeof inizializzaBtnMenuCss&&(inizializzaBtnMenuCss(a,k,d==f.length-1),clearInterval(c)):clearInterval(c);b++},20)}}});delete g.cbaConfig.children;k.insert(h,g);h++}});49!=
CBA.moduli.moduloAttivo&&k.add({xtype:"tbfill"},{xtype:"button",itemId:"BtnHelp",iconCls:CBA.parametriGenerali.tema_zucchetti?"icon-help-white-new":"icon-help32",html:traduci("HELP_TEXT"),border:0,cls:"btnLarge",scale:"large",hidden:45==CBA.moduli.moduloAttivo,handler:function(b){return a.clickBtnHelp(b)}});if(43==CBA.moduli.moduloAttivo||44==CBA.moduli.moduloAttivo||48==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo||55==CBA.moduli.moduloAttivo||57==CBA.moduli.moduloAttivo||58==CBA.moduli.moduloAttivo||
59==CBA.moduli.moduloAttivo||60==CBA.moduli.moduloAttivo||62==CBA.moduli.moduloAttivo||49==CBA.moduli.moduloAttivo||45==CBA.moduli.moduloAttivo)if(isSecondWinCss()){var r=a.getTabApplicativi().getActiveTab();r.setTitle(r.getTitle()+" "+traduci("TAB_SECONDARO_CSS"))}else d(k.getWidth());45==CBA.moduli.moduloAttivo&&CBA.moduli.modulo45.installato&&CBA.moduli.modulo45.abilitato&&Ext.Ajax.request({method:"GET",url:"/cba/per/prz/ws/quad/cntr/sched",params:{codEntePwd:CBA.parametriGenerali.codEntePwd},
success:function(a){}})}function d(a){var b=null,c=new Ext.util.TaskRunner;CBA.taskNotifiche||(CBA.taskNotifiche=c.newTask({fireOnStart:!0,run:function(){var a={idOrganizzazione:getIdOrg(),idOperatore:CBA.parametriGenerali.codUtente,idGruppo:getIdGruppo(),read:"F",hideInizioAttesa:!0,dataDal:moment().add(-7,"days").startOf("day").toDate(),dataAl:moment().add(30,"days").endOf("day").toDate()};a.idGruppo||delete a.idGruppo;Ext.getCmp(d.getId())?Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/general/ntf/count",
params:a,success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(b=a.data,d&&(d.cbaConfig.countNtf=b),0==b.extra&&(b.extra=""),Ext.isDefined(d.primaVolta)||(d.primaVolta=!0,setTimeout(function(){setBadgeText(d,b.extra)},1500)),setBadgeText(d,b.extra)):msgShowError("",a.message)}}):CBA.taskNotifiche.destroy()},interval:6E5}));c="";switch(CBA.moduli.moduloAttivo){case 43:case 46:case 48:case 50:case 55:c="utenti";break;case 49:c="css";break;case 45:case 63:c="personale";break;case 44:case 51:case 52:case 53:case 54:case 56:c=
"amministrazione";break;case 57:case 58:case 59:case 60:case 62:c="economato"}var d=Ext.create("Ext.button.Button",{iconCls:h.cambiaIconaNtf(c),scale:"large",cls:"btnLarge",width:60,margin:"0 15 0 0",itemId:"BtnAlert",border:0,tooltip:traduci("NOTIFICHE"),cbaConfig:{posY:a-310,posX:0,countNtf:b},handler:function(a){CBA.taskNotifiche.stop();Ext.create("winCBA",{name:"Generali.notifiche.view.Notifiche",titolo:"NOTIFICHE",dimensione:4,closable:!0,configItem:{permesso:"S",tipo:null,countNtf:a.cbaConfig.countNtf},
listeners:{beforeclose:function(a){CBA.taskNotifiche.start()},afterrender:function(b){b.setPosition(a.cbaConfig.posY,a.cbaConfig.posX)}}})}});h.getCntTabBar().insert(0,d);49==CBA.moduli.moduloAttivo||isSecondWinCss()||CBA.taskNotifiche.start()}function e(a,c,d){var f=!1,g;Ext.each(c,function(c){"T"===c.separatoreMenu&&0==f&&(d.items.push({xtype:"menuseparator"}),f=!0);if("N"!=c.permesso){if(c.children){var h;h=c?{xtype:"menuitem",cls:"menuItemSipcar",text:c.titolo,idMenu:c.id,hidden:"F"==c.visibile,
menu:{xtype:"menu",idMenu:c.idPadre,items:[],ignoreParentClicks:!0,hidden:"F"==c.visibile}}:{menu:{xtype:"menu",idMenu:0,items:[],ignoreParentClicks:!0,hidden:"F"==c.visibile}};e(a,c.children,h.menu);d.items.push(h)}else g=b(c),d.items.push(g),a.inserisciRecordStoreFlash(a,n,c,g.itemId);f=!1}})}var f=this,h=this,g=h.getTabApplicativi().getActiveTab(),l=h.getCardApplicativo(),m=l.getLayout().getActiveItem().down("tabpanel"),k=this.getTabApplicativi();Ext.isEmpty(k.down("#CntTipologia"))||k.down("#CntTipologia").destroy();
inizioAttesa();var n=h.getCntSearchFlash().down("#CbSearchFlash").getStore(),k=n.query("idModulo",a.idModulo);n.remove(k.getRange());if(!CBA.parametriGenerali.produzione){var k=[44,51,52,53,54,56],p=[49,57,58,59,60,62];45==a.idModulo?(k=Ext.Loader.getPath("GeneraliPE"),Ext.Loader.loadScript({url:k+"/StdPersonale.js",onLoad:function(){return Ext.Loader.loadScript({url:"personale/presenze/Std45.js",onLoad:function(){StdPersonale.getPersonGen().then(function(a){StdPersonale.setButtonMenu(a);StdPersonale.addButtonPortale(a);
StdPersonale.addButtonCompleanni(a);StdPersonale.showMsgaggiornaPrsz(a);StdPersonale.addPagheWebOnline(l.queryById("tbdettab45"));StdPersonale.showPromemoriaFestivita(a)})["catch"](function(a){return msgShowError("",a)})}})}})):k.includes(a.idModulo)?(k=Ext.Loader.getPath("GeneraliAM"),Ext.Loader.loadScript({url:k+"/StdAmministrazione.js"})):p.includes(a.idModulo)&&(k=Ext.Loader.getPath("GeneraliEC"),Ext.Loader.loadScript({url:k+"/StdEconomato.js",onLoad:function(){StdEconomato.initComponentiEco()}}));
[43,46,48,49,50,55,64].includes(a.idModulo)&&(k=Ext.Loader.getPath("GeneraliOSP"),Ext.Loader.loadScript({url:k+"/StdUtenti.js"}),[43,50].includes(a.idModulo)&&(k=Ext.Loader.getPath("GeneraliAM"),Ext.Loader.loadScript({url:k+"/StdAmministrazione.js"})))}44==a.idModulo&&Ext.Ajax.request({url:"/cba/amm/cp/ws/prszn/eseIsOpen",method:"GET",async:!1,success:function(a){a=Ext.decode(a.responseText);a.success||msgShow("",a.message)}});49==a.idModulo&&Ext.Ajax.request({url:"/cba/css/cs/ws/teanapers/getbyutentepwd",
method:"GET",async:!1,params:{idUtentePwd:CBA.parametriGenerali.codUtente},success:function(a){a=Ext.decode(a.responseText);if(a.success){if(Ext.isEmpty(a.data.tipo))return msgShowError("","MSG_FIG_PROF"),fineAttesa(),!1;CBA.moduli.modulo49.operatore=a.data}else msgShowError("",a.message)}});if(49!=a.idModulo||CBA.moduli.modulo49&&CBA.moduli.modulo49.operatore&&!Ext.isEmpty(CBA.moduli.modulo49.operatore)){k={idOrganizzazione:h.organizzazione.get("codice"),idModulo:a.idModulo,codEnte:CBA.parametriGenerali.codEnte,
regioni:CBA.moduli.modulo43.regioni,idProfiloPwdDe:Ext.isEmpty(CBA.parametriGenerali.idProfiloPwdDe)?0:CBA.parametriGenerali.idProfiloPwdDe,idProfiloCss:Ext.isEmpty(CBA.parametriGenerali.idProfiloCss)?0:CBA.parametriGenerali.idProfiloCss,idProfiloPwdDeCss:Ext.isEmpty(CBA.parametriGenerali.idProfiloPwdDeCss)?0:CBA.parametriGenerali.idProfiloPwdDeCss};if(49===a.idModulo&&CBA.moduli.modulo49){var p="T"===localStorage.getItem("cartella_old"),q=JSON.parse(localStorage.getItem("ricovero_old"));p&&(this.getBtnMenuSipcar().setHidden(!0),
this.getTabApplicativi().activeTab.setClosable(!1));p&&q&&Ext.isObject(q)&&(localStorage.removeItem("cartella_old"),localStorage.removeItem("ricovero_old"),CBA.parametriGenerali.idProfiloPwdDe=q.idProfiloPwdDe,CBA.parametriGenerali.idProfiloCss=q.idProfilo,k.idProfiloPwdDe=q.idProfiloPwdDe,k.idProfiloCss=q.idProfilo,CBA.moduli.modulo49.cartella_old=p,CBA.moduli.modulo49.ricovero_old=q,Ext.getBody().dom.style.filter="grayscale(100%)",Ext.apply(k,{soloUtente:"T"}))}Ext.Ajax.request({url:a.urlMenu,method:"GET",
async:!1,params:k,success:function(b){var d=Ext.decode(b.responseText);if(d.success&&d.children){b=d.children;if(49==a.idModulo){var e=l.getLayout().getActiveItem().down("panel");e&&(e=e.down("#ParametriRicerca"))&&e.up().controller.cerca();h.getRegione();Ext.isDefined(CBA.moduli.modulo49.tipoPai)&&delete CBA.moduli.modulo49.tipoPai;Ext.isDefined(CBA.moduli.modulo49.psicheAbilitata)&&delete CBA.moduli.modulo49.psicheAbilitata;Ext.isDefined(CBA.moduli.modulo49.diariDaCompletare)&&delete CBA.moduli.modulo49.diariDaCompletare;
Ext.isDefined(CBA.moduli.modulo49.sintesiAbilitata)&&delete CBA.moduli.modulo49.sintesiAbilitata;var k=0,m=Ext.Function.interval(function(){if(100>k){if("function"==typeof initCssPanelAnagrafica&&"function"==typeof inizializzaRicercaRapidaCss&&"function"==typeof inizializzaVideateDiari&&"function"==typeof getImpostazPsiche&&"function"==typeof cssImpostazioniConsegne&&"function"==typeof getImpostazNoteAnnullamento&&"function"==typeof getImpostazDiariDaCompletare&&"function"==typeof getImpostazSintesi){var a=
f.getCardApplicativo().getLayout().getActiveItem().down("#pnlAnadettab49");initCssPanelAnagrafica(a);inizializzaRicercaRapidaCss(d,h.getTabApplicativi());inizializzaVideateDiari(d,h.getTabApplicativi());cssImpostazioniConsegne();getImpostazPsiche(CBA.parametriGenerali.idProfiloCss).then(function(a){CBA.moduli.modulo49.psicheAbilitata=a&&"T"==a.attivaCampi})["catch"](function(a){return a&&msgShowError("",a)});getImpostazNoteAnnullamento(CBA.parametriGenerali.idProfiloCss).then(function(a){CBA.moduli.modulo49.noteAnnullamentoAbilitata=
a&&"T"==a.noteAnnullamento})["catch"](function(a){return a&&msgShowError("",a)});getImpostazDiariDaCompletare(CBA.parametriGenerali.idProfiloCss).then(function(a){CBA.moduli.modulo49.diariDaCompletare=a})["catch"](function(a){return a&&msgShowError("",a)});getImpostazSintesi(CBA.parametriGenerali.idProfiloCss).then(function(a){CBA.moduli.modulo49.sintesiAbilitata=a})["catch"](function(a){return a&&msgShowError("",a)});var a=Ext.create("GeneraliCS.store.ImpPatologieProblemi"),b=Ext.create("GeneraliCS.store.ImpEventiAvversi"),
c=Ext.create("GeneraliCS.store.ImpEsamiRicette"),e=null,g=null,l={idProfilo:CBA.parametriGenerali.idProfiloCss};ajaxCall(a,l,function(a){e=a[0].data}).then(function(){return ajaxCall(b,l,function(a){g=a[0].data})}).then(function(){return ajaxCall(c,l,function(a){h.ciclaVideateModulo49(d,e,g,a[0].data)})})["catch"](function(a){msgShowError("",a)});f.getTabApplicativi().getActiveTab().loadFunction=!0;clearInterval(m)}}else clearInterval(m);k++},20)}var p=Ext.create("Generali.store.PermessiVideateGen");
p.load({params:{codModulo:a.idModulo,idProfiloPwdDe:CBA.parametriGenerali.idProfiloPwdDe},callback:function(b,c,d){d?0<b.length&&(CBA.moduli["modulo"+a.idModulo].storeVideateGen=p):msgShowError("",c.getError())}});c(h,n,b,g,a.idModulo)}else msgShowError("",d.message);fineAttesa()}})}},ciclaVideateModulo49:function(a,b,c,d){a.children.forEach(function(a){1!=a.tipoBottone&&2!=a.tipoBottone||a.portletList.forEach(function(a){if(!Ext.isEmpty(a.listaVideate)){var e=[];a.listaVideate.forEach(function(a){if(b){var f=
b.tipoRemota,g=b.tipoFamiliare;80013===a.voceMenu.id&&2===f&&(a.voceMenu.nomeForm="CS.anamnesi.patologicaRemota.view.PatologicaRemota",a.voceMenu.nascondiTestata=!1);80015===a.voceMenu.id&&2==g&&(a.voceMenu.nomeForm="CS.anamnesi.familiare.view.FamiliareMain2",a.voceMenu.nascondiTestata=!1)}c&&(f=c.tipoEventiAvversi,80036===a.voceMenu.id&&2===f&&(a.voceMenu.nomeForm="CS.eventi.eventiAvversi.view.EventiAvversi"));d&&2===d.tipoEsame&&(80035===a.voceMenu.id&&(a.voceMenu.titolo="Accertamenti",a.voceMenu.nomeForm=
"CS.accertamenti.view.AccertamentiKos"),80044===a.voceMenu.id&&(a.voceMenu.titolo="Altri referti",a.voceMenu.nomeForm="CS.accertamenti.view.AltriReferti",a.voceMenu.nascondiTestata=!0));"S"==a.tipoPermesso&&e.push(a)});a.listaVideate.forEach(function(a){"L"==a.tipoPermesso&&e.push(a)});a.listaVideate.forEach(function(a){"S"!=a.tipoPermesso&&"L"!=a.tipoPermesso&&e.push(a)});a.listaVideate=e}})})},logout:function(){Ext.Ajax.request({url:"/cba/gen/auth/logout",async:!1,success:function(a){localStorage.setItem("cbaLogoutEseguito",
"T");localStorage.removeItem("access_token_dm7");window.location="/cba/login.html"}})},cambiaTema:function(a){a=a.toLowerCase();Ext.util.CSS.swapStyleSheet("theme","/cba/resources/neptune51/"+(CBA.parametriGenerali.tema_zucchetti?"css"===a?"css-zucchetti":"zucchetti":"cba-"+a)+"-all"+(CBA.parametriGenerali.produzione?"":"-debug")+".css");this.getCntTabBar().down("#BtnAlert")&&this.getCntTabBar().down("#BtnAlert").setIconCls(this.cambiaIconaNtf(a))},cambiaIconaNtf:function(a){if(CBA.parametriGenerali.tema_zucchetti)return"icon-alarm-new";
var b="";switch(a){case "utenti":b="icon-alarm-utenti";break;case "css":b="icon-alarm-CSS";break;case "personale":b="icon-alarm-personale";break;case "amministrazione":b="icon-alarm-amministrazione";break;case "economato":b="icon-alarm-economato"}return b},onLaunch:function(){CBA.parametriGenerali.cmpTbMenu=this.getTbMenu();this.creaChangeOrg()},creaTab:function(a,b,c){if("PRZCalcolatrice"==b.progetto)showCalc({modal:!1});else{if("function"==typeof requiredUserOnPortlet&&Ext.Array.contains([49],b.idModuloPrg)&&
!requiredUserOnPortlet(b))return!1;"function"==typeof applyStyleCartellaMenuButton&&49==b.idModuloPrg&&applyStyleCartellaMenuButton(c);var d=this,e="tab_"+b.progetto;if(49==b.idModuloPrg)var f=a.getActiveTab();if(a.queryById(e)){if(a.setActiveTab(e),49==b.idModuloPrg&&f&&f!=a.getActiveTab()&&f.destroy(),"CSFunzioniServizio"==b.progetto&&d.cnt_doGestione.inizializzaParametriNtf(),"DOGestione"==b.progetto&&c.cbaConfig)d.cnt_doGestione.onLaunch()}else{var h=a.add({itemId:e,title:b.text.replace("<br>",
" "),closable:"ANALISI_DATI"==b.nomeForm?!1:!0,layout:"fit",cbaConfig:b,listeners:{beforeclose:function(a){if(a.can_close&&!a.can_close())return!1;CBA.moduli["modulo"+CBA.moduli.moduloAttivo].idTopic=null;return controllaDirtyForm(a)},close:function(a){d.gestisciMenuLayoutPortlet()}}});a.setActiveTab(e);if(!Ext.isEmpty(b.nomeForm)){e=Ext.Date.now();c=Ext.create(b.nomeForm,{cbaConfig:b,itemId:(b.progetto||"_")+e,bottoneFunzione:c});if("DOGestione"==b.progetto||"CSFunzioniServizio"==b.progetto)d.cnt_doGestione=
c.controller;h.add(c)}49==b.idModuloPrg&&f&&f!=a.getActiveTab()&&f.destroy()}}},init:function(a){this.control({"splitbutton#BtnMenuSipcar":{click:this.onSplitbuttonClickBtnMenuSipcar},"#CardApplicativo tabpanel":{beforetabchange:this.onTabpanelBeforeTabChange},"tabpanel#TabApplicativi":{beforetabchange:this.onTabpanelBeforeTabChangeTabApplicativi,tabchange:this.onTabpanelTabChange},"button#MenuOpzioni":{click:this.onClickMenuOpzioni},"button#BtnOpenTab":{click:this.onClickBtnOpenTab}});this.listaVideatePortlet=
["GeneraliPE.fascicolo.view.Fascicolo","GeneraliOSP.fascicoloNoApp.view.Fascicolo"]},onClickBtnOpenTab:function(a){49==CBA.moduli.moduloAttivo&&(localStorage.removeItem("idProfiloPwdDeCss"),localStorage.removeItem("idProfiloCss"));openSecondaryWin()},onClickMenuOpzioni:function(a){var b=Ext.create("winCBA",{name:"Sipcar.view.DatiUtente",titolo:"INFO",dimensione:"PopUpSmall",maximizable:!1,closable:!0,configItem:{controllerMenu:this}});b.setWidth(500);b.setHeight(250);b.showAt(a.getXY())},getRegione:function(){var a=
Ext.isEmpty(CBA.parametriGenerali.idProfiloCss)?-1:CBA.parametriGenerali.idProfiloCss;Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/pwd/profili/regione",params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success&&(Ext.isEmpty(a.data)||Ext.apply(CBA.moduli.modulo49,{regione:a.data}))}})},inserisciRecordStoreFlash:function(a,b,c,d){b.add({idModulo:c.idModuloPrg,id:c.id,idButton:d,descrizione:c.titolo})},creaChangeOrg:function(){var a=this;a.storeChangeOrg=Ext.create("Sipcar.store.CboxOrganizzazioni");
var b=Ext.create("Ext.Container",{itemId:"CntChangeOrg",layout:{type:"hbox",align:"center",pack:"end"},items:[{xtype:"label",style:{"font-size":"20px","font-family":"Oswald"}},{xtype:"button",cls:"btnLarge",itemId:"BtnChangeOrg",formBind:!0,margin:"10 5 0 5",width:40,hidden:!0,iconCls:"icon-change-org",scale:"large",listeners:{click:function(b){if(Ext.isDefined(a.menu)&&"MenuStoreOrg"===a.menu.getItemId())return a.menu.show(),!1;a.menu=Ext.create("Ext.menu.Menu",{showSeparator:!1,itemId:"MenuStoreOrg",
items:[]});a.storeChangeOrg.getData().items.forEach(function(b){a.menu.add([{xtype:"menuitem",text:b.get("valore"),cbaConfig:{idOrganizzazione:b.get("codice"),idProfiloPwdDe:b.get("extra")},handler:function(a){if(1<countOpenedTabs())return msgShowWarning("ATTENZIONE","BLOCCO_TAB_SECONDARI_APERI"),!1;Ext.isEmpty(a.cbaConfig)||(localStorage.setItem("idOrganizzazione",a.cbaConfig.idOrganizzazione),localStorage.setItem("cbaidProfiloPwdDe",a.cbaConfig.idProfiloPwdDe),localStorage.setItem("idProfiloPwdDeCss",
""),localStorage.setItem("idProfiloCss",""),a=encodeURI(CBA.parametriGenerali.nomeUtente.replace("/\\/g","\\")),window.location.replace(window.location.origin+"/cba/?loginParams="+a+"&0"))}}])});a.menu.showBy(b,!1,[0,0])}}}]});a.getCntTabBar().insert(1,b)},changeOrg:function(){var a=this,b=a.getTabApplicativi();Ext.Ajax.request({url:"/cba/gen/ws/pwd/utentipwd/get",method:"GET",async:!1,params:{codUtente:CBA.parametriGenerali.codUtente},success:function(b){a.utentePwd=Ext.JSON.decode(b.responseText)}});
a.storeChangeOrg.load({params:{codEnte:CBA.parametriGenerali.codEntePwd,codProfilo:CBA.parametriGenerali.codProfilo},callback:function(c,d,e){if(e&&!Ext.isEmpty(c)){var f=null;a.storeChangeOrg.clearFilter();a.storeChangeOrg.filter(function(a){return a.get("codice")==CBA.parametriGenerali.idOrganizzazione?(f=a,!1):!0});c=b.down("#CntChangeOrg");c.down("label").setText(f.get("valore"));c.down("button").setHidden(0==a.storeChangeOrg.data.length)}}})}});
Ext.define("Sipcar.controller.PersonUtente",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CbLingua",selector:this.selContainer+"#CbLingua"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"Utente",selector:this.selContainer+"#Utente"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"}]);this.control(this.selContainer+"#CbLingua",{change:this.changeCbLingua,afterrender:this.afterrenderCbLingua})},
onLaunch:function(a,b){var c=this,d=c.getForm();d.permesso=c.cbaConfig.permesso;d.boxBottoni=this.getBoxBottoni();d.aggiornaStore=function(a){};d.impostaDati=function(a){};d.verificaCampiForm=function(a){a=[];d.isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)};var e=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(a){c.salvaCampi(d,a)},esci_callback:function(){d.up("window").close()},annulla_callback:function(){},nuovo_callback:function(){},
elimina_callback:function(){},verificaCampiForm_callback:function(){return!0}}});inserisciBottoni(d.boxBottoni,e);d.boxBottoni.queryById("btnNuovo").hide();d.boxBottoni.queryById("btnElimina").hide();d.boxBottoni.queryById("btnAnnulla").hide();if("L"!=d.permesso)d.on("dirtychange",function(a,b){controller_abilitaBottoni(d)});"L"==d.permesso&&(containerSolaLettura(d),controller_bottoniSolaLettura(d.boxBottoni));c.getCbLingua().tpl=Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item {img}" style="height: 20px">{valore}</div>',
"</tpl>")},changeCbLingua:function(a,b,c,d){a.inputEl&&(a.inputEl.removeCls("icon-it"),a.inputEl.removeCls("icon-de"),a.inputEl.removeCls("icon-en"),a.inputEl.addCls("icon-"+b.toLowerCase()))},afterrenderCbLingua:function(a,b){this.getForm().getForm().setValues({lingua:CBA.parametriGenerali.lingua.toUpperCase()});creaToolTipInfo(a,"TOOLTIP_CAMBIO_LINGUA","MSG_CAMBIO_LINGUA_TITOLO")},salvaCampi:function(a,b){var c=a.getForm().getFieldValues(),d=a.up("window");if(!a.verificaCampiForm(c))return!1;var e=
!0;Ext.Ajax.request({url:"/cba/gen/auth/user/setlanguage",method:"GET",params:{lang:c.lingua},async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(a.getForm().setValues({lingua:c.lingua}),a.getForm().reset(),Messaggio("Attenzione","MSG_CAMBIO_LINGUA","YESNOCANCEL","QUESTION","",function(){doLogout();d.close()},function(a){a&&d.close()},function(a){a&&d.close()})):msgShowError("",b.message);e=b.success},failure:function(a){}});e||controller_abilitaBottoni(a);return e},destroy:function(){this.callParent()}});
Ext.define("Sipcar.controller.SalvaPortlet",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"LayoutFas",selector:a+"#LayoutFas"},{ref:"RgLayout",selector:a+"#RgLayout"},{ref:"Colonna1",selector:a+"#Colonna1"},{ref:"Colonna2",selector:a+"#Colonna2"},{ref:"Colonna3",selector:a+"#Colonna3"},{ref:"BtnSalva",selector:a+"#BtnSalva"},{ref:"BtnRipristina",selector:a+"#BtnRipristina"}]);this.control(a+"#LayoutFas",{afterrender:this.afterRenderLayoutFas});
this.control(a+"#RgLayout",{change:this.changeRgLayout});this.control(a+"#BtnSalva",{click:this.clickBtnSalva});this.control(a+"#BtnRipristina",{click:this.clickBtnRipristina})},clickBtnRipristina:function(){var a=this;Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/prefs/delete",params:{programId:a.controllerWebPortal.cbaConfig.idModulo,userId:CBA.parametriGenerali.codUtente},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(a.controllerWebPortal.getAuthModules(),a.setNumColonne()):
msgShowError("",b.message)}})},clickBtnSalva:function(a){for(var b=this,c=[],d,e,f=0;f<b.regionPortlet.items.getCount();f++)if(a=b.regionPortlet.items.items[f],0<a.items.getCount())for(var h=e=0;h<a.items.getCount();h++)e++,d=a.items.items[h],c.push({id:d.cbaConfig.idUserPrefs,codUtente:CBA.parametriGenerali.codUtente,colonna:f+1,ordine:e,codVideata:d.cbaConfig.codVideata,collapsed:d.collapsed?Ext.String.capitalize(d.collapsed[0]):null});Ext.Ajax.request({method:"POST",url:"/cba/gen/auth/prefs/save",
jsonData:Ext.JSON.encode(c),params:{programId:b.controllerWebPortal.cbaConfig.idModulo},success:function(a){a=Ext.JSON.decode(a.responseText);var c="",d=[];a.success?(Ext.each(a.data,function(a){var c=b.regionPortlet.down("#Portlet_"+a.codVideata);c.cbaConfig&&(c.cbaConfig.idUserPrefs=a.id)}),c="MSG_SALVATAGGIO_DATI",msgAdd(d,a.message)):msgAddError(d,a.message);msgShow(c,d)}})},setNumColonne:function(){this.regionPortlet=this.controllerWebPortal.getContainerPortlet();this.getRgLayout().setValue({numCol:this.regionPortlet.items.getCount()})},
afterRenderLayoutFas:function(){this.getColonna1().bodyEl.insertHtml("afterEnd",'<div class="icon-1colonna" style="height:32px; width: 32px; margin: 5px 0px 5px 15px;"></div>');this.getColonna2().bodyEl.insertHtml("afterEnd",'<div class="icon-2colonne" style="height:32px; width: 32px; margin: 0px 0px 5px 15px;"></div>');this.getColonna3().bodyEl.insertHtml("afterEnd",'<div class="icon-3colonne" style="height:32px; width: 32px; margin: 0px 0px 5px 15px;"></div>')},changeRgLayout:function(a,b){var c=
this.regionPortlet.items.getCount(),d=parseFloat(b.numCol),e;if(d>c)for(e=c+1;e<=d;e++)this.regionPortlet.down("#Col-"+e)||this.regionPortlet.add({itemId:"Col-"+e});else if(d<c)for(e=d+1;e<=c;e++)this.regionPortlet.down("#Col-"+d).add(this.regionPortlet.down("#Col-"+e).items.items),this.regionPortlet.down("#Col-"+e).destroy()},onLaunch:function(){},destroy:function(){this.callParent()}});
Ext.define("Sipcar.controller.SelTipologiaCartella",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CbProfiloCss",selector:a+"#CbProfiloCss"},{ref:"BtnEntraTip",selector:a+"#BtnEntraTip"},{ref:"CheckFiltroMedico",selector:a+"#CheckFiltroMedico"},{ref:"CbFiltroRep",selector:a+"#CbFiltroRep"},{ref:"CbFiltroSede",selector:a+"#CbFiltroSede"},{ref:"FsSediRep",selector:a+"#FsSediRep"},{ref:"FsFilterServizi",selector:a+
"#FsFilterServizi"}]);this.control(a+"#CbProfiloCss",{keypress:this.onKeyPress});this.control(a+"#BtnEntraTip",{click:this.onClickBtnEntraTip});this.control(a+"#CbFiltroSede",{change:this.onChangeCbSede})},onChangeCbSede:function(a,b,c){if(!b)return!1;this.getCbFiltroRep().setValue("");svuotaStore(this.storeReparti);this.buildStoreReparti(b,this.storeReparti);this.getCbFiltroRep().bindStore(this.storeReparti);this.getCbFiltroRep().setReadOnly(!1);this.current_filtriRepartiCss&&1==this.current_filtriRepartiCss.split(";").length?
this.getCbFiltroRep().setValue(this.current_filtriRepartiCss.split(";")[0].split(",")[1]):1==this.storeReparti.getData().length&&(this.getCbFiltroRep().setValue(this.storeReparti.getData().getAt(0).data.codice),this.getCbFiltroRep().setReadOnly(!0))},onClickBtnEntraTip:function(){var a=this.getCbProfiloCss().getValue();if(!Ext.isEmpty(a)){this.cbaConfig.filtroMedici?0<=this.cbaConfig.filtroMedici?CBA.parametriGenerali.filtroMedico=getBoolValue(this.getCheckFiltroMedico().getValue()):0>this.cbaConfig.filtroMedici&&
(CBA.parametriGenerali.filtroMedico=-1):CBA.parametriGenerali.filtroMedico="";this.cbaConfig.idProfiloCss=a;this.cbaConfig.idProfiloPwdDeCss=this.getCbProfiloCss().getStore().findRecord("idProfiloCss",a,0,!1,!0,!0).getData().id;var a=this.lookup("GridServiziCu").getSelectionModel().getSelected(),b="";!Ext.isEmpty(a)&&0<a.items.length&&(a.items.forEach(function(a){b+=a.get("codice")+","}),Ext.String.endsWith(b,",")&&(b=b.substring(0,b.length-1)),CBA.parametriGenerali.filtroServiziCss=b);a=this.getCbFiltroSede().getStore().getData();
!Ext.isEmpty(a)&&0<a.items.length&&(this.salvaSedeRep=!0);this.salvaFiltroRepartoCssInSessione(this.getCbFiltroSede().getValue())}},onKeyPress:function(a,b){if(b.getKey()===Ext.event.Event.ENTER)this.onClickBtnEntraTip()},salvaFiltroRepartoCssInSessione:function(a){var b=this;b.salvaSedeRep?(a=b.buildFiltri(a),Ext.Ajax.request({url:"/cba/gen/auth/user/selectRepartoCss",method:"GET",params:{sedeRep:a},success:function(a){a=Ext.decode(a.responseText);a.success?(CBA.parametriGenerali.filtroRepartoCss=
a.data,b.getView().up("window").close()):msgShowError("",a.message)}})):b.getView().up("window").close()},buildFiltri:function(a){if(!a)return"";var b=this.getCbFiltroRep().getValue(),c="";b?c=a+","+b:(b=this.getCbFiltroRep().getStore().getData().items,Ext.each(b,function(b){c+=a+","+b.get("codice")+";"}));return c},onLaunch:function(){var a=this.cbaConfig.cbStore,b=a.getData().items[0].get("idProfiloCss"),c=this.lookup("LblMsgFiltroSedeRep");localStorage.getItem("current_filtriRepartiCss")&&sessionStorage.setItem("current_filtriRepartiCss",
localStorage.getItem("current_filtriRepartiCss"));localStorage.removeItem("current_filtriRepartiCss");this.current_filtriRepartiCss=sessionStorage.getItem("current_filtriRepartiCss");1<countOpenedTabs()&&!this.current_filtriRepartiCss&&(this.current_filtriRepartiCss=CBA.parametriGenerali.filtroRepartoCss);if(this.current_filtriRepartiCss){var d=this.current_filtriRepartiCss.split(";")[0].split(",")[0];d&&this.lookup("CbFiltroSede").setValue(d);this.lookup("CbFiltroSede").setDisabled(!0);this.lookup("CbFiltroRep").setDisabled(!0);
c.show();isSecondWinCss()?c.setText(traduci("CSS_MSG_FILTRO_SEDE_REP_SECONDARY_WIN")):c.setText(traduci("CSS_MSG_FILTRO_SEDE_REP_MULTI_TAB"))}this.storeReparti=Ext.create("Ext.data.Store",{fields:[{name:"codice"},{name:"descrizione"}]});this.storeSedi=Ext.create("Ext.data.Store",{fields:[{name:"codice"},{name:"descrizione"}]});this.cbaConfig.filtroMedici&&(this.getCheckFiltroMedico().setValue(!0),this.getCheckFiltroMedico().show(),0>this.cbaConfig.filtroMedici&&this.getCheckFiltroMedico().setDisabled(!0));
this.cbaConfig.elencoReparti&&(this.getFsSediRep().show(),(this.listaReparti=this.cbaConfig.elencoReparti.split("\n"))&&0<this.listaReparti.length&&(this.buildStoreSedi(this.storeSedi),this.getCbFiltroSede().bindStore(this.storeSedi),1==this.storeSedi.getData().length&&(this.getCbFiltroSede().setValue(this.storeSedi.getData().getAt(0).data.codice),this.getCbFiltroSede().setReadOnly(!0))));if(this.cbaConfig.filtroServizi){var e=this.lookup("GridServiziCu");e.getStore().load({params:{idOrganizzazione:CBA.parametriGenerali.idOrganizzazione},
callback:function(a,b,c){c?Ext.isEmpty(a)||e.getSelectionModel().selectAll():msgShowError("",b.getError())}});this.getFsFilterServizi().show();Ext.isEmpty(CBA.parametriGenerali.filtriAttivi.filtroServizi)||(CBA.parametriGenerali.filtroServiziCss=CBA.parametriGenerali.filtriAttivi.filtroServizi.valore)}this.getCbProfiloCss().setStore(a);this.getCbProfiloCss().setValue(b);this.getCbProfiloCss().focus()},buildStoreSedi:function(){var a=this,b=[];Ext.each(a.listaReparti,function(c){c=c.split(";");var d=
{};d.codice=c[0].split(",")[0];d.descrizione=c[1].split(",")[0];a.findSede(b,d.codice)||b.push(d)});a.storeSedi.loadData(b)},buildStoreReparti:function(a){var b=[];Ext.each(this.listaReparti,function(c){c=c.split(";");obj={};codiciSedeRep=c[0].split(",");itemSede=codiciSedeRep[0];obj.codice=codiciSedeRep[1];obj.descrizione=c[1].split(",")[1];itemSede==a&&b.push(obj)});this.storeReparti.loadData(b)},findSede:function(a,b){if(Ext.isEmpty(a))return!1;var c=0,d=!1;for(c;c<a.length&&!d;c++)a[c].codice==
b&&(d=!0);return d},destroy:function(){this.callParent()}});
Ext.define("Sipcar.controller.VersioneModuli",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TreeRep",selector:this.selContainer+"#TreeRep"},{ref:"LblDataRilascio",selector:this.selContainer+"#LblDataRilascio"},{ref:"LblType",selector:this.selContainer+"#LblType"}])},aggiornaStore:function(a){var b=this,c=b.getTreeRep();c.getStore().load({params:{},callback:function(a,e,f){if(f){var d=null;c.getRootNode().cascadeBy(function(a){999===
a.get("id")&&(d=a,a.parentNode.removeChild(a))});Ext.isEmpty(d)||(a=traduci("VERSIONE_INSTALLATA")+": "+d.get("modulo")+" "+d.get("versione"),e=traduci("DATA_VERSIONE")+": "+d.get("data"),b.getLblType().setText(a),b.getLblDataRilascio().setText(e));c.expandAll()}else msgShowError("",e.getError())}})},onLaunch:function(){this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("Sipcar.store.CboxOrganizzazioni",{extend:"Generali.data.StoreCodiceValore",proxy:{url:"/cba/gen/ws/pwd/listbyprofilopwdde/cbox"},autoLoad:!1});
Ext.define("Sipcar.store.CboxServiziConFiltro",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",method:"GET",url:"/cba/gen/auth/perGenerali/serviziDisponibili/list",api:{read:"/cba/gen/auth/perGenerali/serviziDisponibili/list"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("Sipcar.store.VersioneModuli",{extend:"Ext.data.TreeStore",fields:[{name:"modulo"},{name:"versione"},{name:"data"},{name:"idPadre"},{name:"id"},{name:"colore"}],autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:"/cba/gen/ws/general/menuItem/getParamModules",reader:{type:"json",messageProperty:"message",rootProperty:"children"}},autoDestroy:!0});
Ext.define("Sipcar.store.domini",{extend:"Ext.data.Store",fields:[],proxy:{type:"ajax",url:"/cba/gen/config/ldap/domainList",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("Sipcar.store.organizzazioni",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:"/cba/gen/ws/general/orgnew/loggedUser/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("Sipcar.store.utente",{extend:"Ext.data.Store",fields:[{name:"codUtente"},{name:"codProfilo"},{name:"dataAttivazionePwd"},{name:"nomeUtente"},{name:"amministratore"},{name:"loginAutomatico"},{name:"abilitato"},{name:"autorizzatore"},{name:"lingua"},{name:"codPenna"},{name:"aggiornaPwd"}],proxy:{type:"ajax",url:"/cba/gen/auth/login",timeout:3E5,reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("Sipcar.view.DatiUtente",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},bodyPadding:5,items:[{xtype:"container",layout:"hbox",margin:"0 0 15 0",items:[{xtype:"label",itemId:"LbEnte",reference:"LbEnte",cls:"ente",fieldLabel:"ENTE",hidden:!0,flex:1},{xtype:"combobox",puoiCancellare:!1,itemId:"CbOrganizzazione",reference:"CbOrganizzazione",displayField:"valore",queryMode:"local",store:this.cbaConfig.controllerMenu.storeOrganizzaizoni,
valueField:"codice",hidden:!0,flex:1}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:1,margin:"0 0 15 0",items:[{xtype:"container",layout:"vbox",width:120,items:[{xtype:"label",itemId:"LbNomeUtente",reference:"LbNomeUtente",cls:"utente",margin:"0 0 10 0"},{xtype:"label",itemId:"Lingua",reference:"Lingua",margin:"0 0 10 0"},{xtype:"label",cls:"cbaLabelLink",itemId:"LbPreferenze",reference:"LbPreferenze",overCls:"cbaLabelLinkOver",text:"PREFERENZE_OPERATORE"},{xtype:"label",cls:"cbaLabelLink",
itemId:"LbVersioni",reference:"LbVersioni",overCls:"cbaLabelLinkOver",text:"VERSIONI_MODULI"}]},{xtype:"container",layout:"hbox",width:100,items:[{xtype:"button",itemId:"BtnCambiaPwd",reference:"BtnCambiaPwd",scale:"large",iconCls:"icon-key",style:"background:transparent;border:none",tooltip:"MODIFICA_PWD"},{xtype:"button",itemId:"BtnBackupDb",reference:"BtnBackupDb",scale:"large",iconCls:"icon-database",style:"background:transparent;border:none",tooltip:"GESTIONE_BACKUP",hidden:!0}]}]}],dockedItems:[{xtype:"toolbar",
dock:"bottom",padding:"5 3 5 3",items:[{xtype:"button",itemId:"BtnGestionePwd",reference:"BtnGestionePwd",iconCls:"icon-locked-padlock",hidden:!0,text:"GESTIONE_PWD",scale:"large",flex:10,margin:"0 2 0 0"},{xtype:"button",itemId:"BtnHelpMenu",reference:"BtnHelpMenu",iconCls:"icon-help32",html:"HELP",scale:"large",flex:9,margin:"0 2 0 0"},{xtype:"button",itemId:"BtnFaqMenu",reference:"BtnFaqMenu",iconCls:"icon-faq32",text:"FAQ",scale:"large",flex:9,margin:"0 2 0 0"},{xtype:"button",itemId:"BtnCircolariMenu",
reference:"BtnCircolariMenu",iconCls:"icon-circolari32",text:"CIRCOLARI",scale:"large",flex:10,margin:"0 2 0 0"},{xtype:"button",itemId:"BtnEsciMenu",reference:"BtnEsciMenu",iconCls:"icon-logout32",text:"LOGOUT",scale:"large",flex:9,margin:"0 1 0 0"}]}]}]});this.callParent(arguments)}});
Ext.define("Sipcar.view.MyViewport",{extend:"Ext.container.Viewport",itemId:"MyViewport",reference:"MyViewport",layout:{type:"card"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Login",reference:"Login",layout:{align:"center",type:"vbox"},items:[{xtype:"form",height:275,itemId:"formLogin",reference:"formLogin",margin:"200 0 0 0",width:400,layout:{align:"stretch",type:"vbox"},title:"AUTENTICAZIONE",items:[{xtype:"container",padding:5,layout:{type:"hbox"},items:[{xtype:"container",
flex:1,height:90,items:[{xtype:"image",height:85,width:202,imgCls:"icon-logo-cba-zucchetti",margin:"0 0 0 15"}]}]},{xtype:"container",flex:1,itemId:"CardUser",reference:"CardUser",layout:{type:"card"},items:[{xtype:"container",itemId:"pnlDati",reference:"pnlDati",padding:5,layout:{align:"stretch",type:"vbox"},items:[{xtype:"combobox",itemId:"Dominio",reference:"Dominio",fieldLabel:"DOMINIO",labelClsExtra:"cbaLabel",displayField:"valore",valueField:"valore",hidden:!0,editable:!1,queryMode:"local"},
{xtype:"textfield",itemId:"UserName",reference:"UserName",fieldLabel:"UTENTE",labelClsExtra:"cbaLabel",name:"username"},{xtype:"textfield",itemId:"Password",reference:"Password",fieldLabel:"PASSWORD",labelClsExtra:"cbaLabel",name:"password",inputType:"password",enableKeyEvents:!0,listeners:{afterrender:function(a){a.inputEl.set({autocomplete:"new-password"});a.triggers.visibility.getEl().dom.title="Visualizza";a.triggers.visibilityOff.getEl().dom.title="Nascondi"}},triggers:{visibility:{cls:"icon-visibility",
handler:function(){Sipcar.app.getController("Login").changeVisibility(this,this.triggers.visibility)}},visibilityOff:{cls:"icon-visibility-off",hidden:!0,handler:function(){Sipcar.app.getController("Login").changeVisibility(this,this.triggers.visibilityOff)}}}}]},{xtype:"container",border:0,itemId:"CardEnte",reference:"CardEnte",padding:5,layout:{type:"anchor"},items:[{xtype:"combobox",anchor:"98%",itemId:"CbEnte",reference:"CbEnte",fieldLabel:"ENTE",labelClsExtra:"cbaLabel",labelWidth:100,editable:!0,
displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/gen/auth/entinew/getbyprof"}}),valueField:"codice"},{xtype:"combobox",anchor:"98%",itemId:"CbOrg",reference:"CbOrg",fieldLabel:"ORGANIZZAZIONE",labelClsExtra:"cbaLabel",labelWidth:100,editable:!0,store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/gen/auth/entinew/getbyprof"}}),displayField:"valore",queryMode:"local",valueField:"codice"}]}]}],dockedItems:[{xtype:"toolbar",
dock:"bottom",itemId:"TbLogin",reference:"TbLogin",layout:{pack:"center",type:"hbox"},items:[{xtype:"label",hidden:!0,itemId:"LbErrore",reference:"LbErrore",text:"ERRORE"},{xtype:"toolbar",border:0,padding:0,hidden:!0,itemId:"CntBtnLogin",reference:"CntBtnLogin",layout:{pack:"center",type:"vbox"},items:[{xtype:"button",itemId:"BtnLogin",reference:"BtnLogin",width:120,iconCls:"icon-login",scale:"large",text:"LOGIN"},{xtype:"label",hidden:!0,cls:"cbaLabelLink",itemId:"LblPwdDimenticata",reference:"LblPwdDimenticata",
overCls:"cbaLabelLinkOver",text:"PWD_DIMENTICATA"}]},{xtype:"button",hidden:!0,itemId:"BtnOauthAzure",reference:"BtnOauthAzure",width:120,iconCls:"icon-microsoft-authenticator",scale:"large",text:"MS"},{xtype:"button",hidden:!0,itemId:"BtnEntra",reference:"BtnEntra",width:120,iconCls:"icon-entra",scale:"large",text:"ENTRA"}]}],tools:[{xtype:"tool",type:"info",itemId:"ToolInfo"}]},{xtype:"tbfill"},{xtype:"container",itemId:"CntAvvisi",reference:"CntAvvisi",layout:{type:"vbox",align:"stretch"},width:550,
maxHeight:600}]},{xtype:"container",itemId:"Menu",reference:"Menu",layout:{align:"stretch",type:"vbox"},items:[{xtype:"toolbar",itemId:"TbMenu",reference:"TbMenu",cls:"tbMenu",itemId:"TbMenu",reference:"TbMenu",items:[{xtype:"splitbutton",width:130,height:80,scale:"large",itemId:"BtnMenuSipcar",reference:"BtnMenuSipcar",scale:"large",iconCls:"icon-menu",menu:{xtype:"menu",itemId:"MenuApplicativi",reference:"MenuApplicativi",ignoreParentClicks:!0,showSeparator:!1}},{xtype:"container",flex:1,items:[{xtype:"tabpanel",
border:0,itemId:"TabApplicativi",reference:"TabApplicativi",bodyBorder:!1,tabBar:{items:[{xtype:"tbfill"},{xtype:"container",itemId:"CntTabBar",reference:"CntTabBar",layout:{type:"hbox",align:"stretch"}}]}}]},{xtype:"container",itemId:"CtnMenuOpzioni",reference:"CtnMenuOpzioni",layout:{type:"vbox",pack:"center",align:"end"},items:[{xtype:"button",itemId:"MenuOpzioni",reference:"MenuOpzioni",scale:"medium",iconCls:CBA.parametriGenerali.tema_zucchetti?"icon-shortcut-new":"icon-shortCut",cls:"x-btn x-unselectable x-box-item x-toolbar-item x-btn-default-toolbar-medium",
style:"cursor: pointer"},{xtype:"searchFlash",itemId:"CntSearchFlash",reference:"CntSearchFlash",hidden:!0},{xtype:"button",itemId:"MenuLayoutPortlet",reference:"MenuLayoutPortlet",scale:"medium",cls:"x-btn x-unselectable x-box-item x-toolbar-item x-btn-default-toolbar-medium",iconCls:"icon-layout",style:"cursor: pointer",hidden:!0},{xtype:"button",itemId:"BtnOpenTab",reference:"BtnOpenTab",scale:"medium",cls:"x-btn x-unselectable x-box-item x-toolbar-item x-btn-default-toolbar-medium",icon:CBA.parametriGenerali.tema_zucchetti?
"/cba/css/generali/images/generali/apri-new.svg":"/cba/css/generali/images/generali/apri.svg",hidden:!0}]}]},{xtype:"container",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"panel",flex:1,itemId:"CardApplicativo",reference:"CardApplicativo",layout:{type:"card"},bodyCls:"logo-sipcar"}]}]}]});this.callParent(arguments)}});
Ext.define("Sipcar.view.PersonUtente",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{align:"stretch",type:"hbox"},items:[{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"combobox",puoiCancellare:!1,itemId:"CbLingua",reference:"CbLingua",store:Ext.create("Ext.data.ArrayStore",{fields:["codice","valore","img"],data:[["IT",traduci("LINGUA_IT"),"icon-it"],["DE",traduci("LINGUA_DE"),
"icon-de"],["EN",traduci("LINGUA_EN"),"icon-en"]],autoLoad:!0}),labelWidth:70,width:350,fieldLabel:"LINGUA",labelClsExtra:"cbaLabel",name:"lingua",displayField:"valore",valueField:"codice"}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni"}]}]});this.callParent(arguments)}});
Ext.define("Sipcar.view.SalvaPortlet",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox",align:"center"},items:[{xtype:"form",flex:1,noModificaDati:!0,border:0,padding:10,trackResetOnLoad:!0,items:[{xtype:"fieldset",width:200,itemId:"LayoutFas",reference:"LayoutFas",items:[{xtype:"radiogroup",itemId:"RgLayout",reference:"RgLayout",columns:1,items:[{xtype:"radiofield",itemId:"Colonna1",
reference:"Colonna1",name:"numCol",boxLabel:"1"+traduci("COLONNA"),inputValue:"1"},{xtype:"radiofield",itemId:"Colonna2",reference:"Colonna2",name:"numCol",boxLabel:"2"+traduci("COLONNE"),inputValue:"2"},{xtype:"radiofield",itemId:"Colonna3",reference:"Colonna3",name:"numCol",boxLabel:"3"+traduci("COLONNE"),inputValue:"3"}]}]}]},{xtype:"container",layout:{type:"hbox"},padding:5,items:[{xtype:"button",itemId:"BtnRipristina",reference:"BtnRipristina",cls:"cba-button-25",iconCls:"icon-annulla",text:"RIPRISTINA_PORTLET",
width:150},{xtype:"container",width:10},{xtype:"button",itemId:"BtnSalva",reference:"BtnSalva",cls:"cba-button-25",iconCls:"icon-save",text:"SALVA_PORTLET",width:150}]}]}]});this.callParent(arguments)}});
Ext.define("Sipcar.view.SelTipologiaCartella",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",cls:"cbaCssPnlPopup",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",itemId:"Panel",reference:"Panel",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"combobox",margin:"10 10 10 10",name:"codProfiloCss",itemId:"CbProfiloCss",reference:"CbProfiloCss",
fieldLabel:"Tipologia cartella",labelClsExtra:"cbaLabel",labelWidth:85,allowBlank:!1,displayField:"descProfiloCss",queryMode:"local",valueField:"idProfiloCss"},{xtype:"container",layout:{type:"hbox",align:"stretch"},padding:"5 10 5 10",items:[{xtype:"checkbox",margin:"0 10 0 0",itemId:"CheckFiltroMedico",reference:"CheckFiltroMedico",fieldLabel:"CSS_FILTRO_MEDICO",labelClsExtra:"cbaLabel",labelWidth:85,inputValue:"T",uncheckedValue:"F",checked:!1,hidden:!0,disabled:!1},{xtype:"fieldset",itemId:"FsSediRep",
reference:"FsSediRep",title:"CSS_FILTRO_SEDE_REPARTO",layout:{type:"vbox",align:"stretch"},flex:1,hidden:!0,items:[{xtype:"combobox",itemId:"CbFiltroSede",reference:"CbFiltroSede",emptyText:"Sede",labelClsExtra:"cbaLabel",displayField:"descrizione",queryMode:"local",valueField:"codice",flex:1},{xtype:"combobox",itemId:"CbFiltroRep",reference:"CbFiltroRep",emptyText:"Reparto",labelClsExtra:"cbaLabel",displayField:"descrizione",queryMode:"local",valueField:"codice",flex:1},{xtype:"label",reference:"LblMsgFiltroSedeRep",
cls:"cbaLabel",hidden:!0}]}]},{xtype:"fieldset",itemId:"FsFilterServizi",reference:"FsFilterServizi",title:"Servizi",margin:"0 10 5 10",layout:{type:"vbox",align:"stretch"},width:250,hidden:!0,items:[{xtype:"gridpanel",padding:"0 0 5 0",width:200,height:300,itemId:"GridServiziCu",reference:"GridServiziCu",store:Ext.create("Sipcar.store.CboxServiziConFiltro"),columns:[{xtype:"gridcolumn",dataIndex:"codice",hidden:!0},{xtype:"gridcolumn",flex:1,dataIndex:"valore",text:"SERVIZIO"}],hideHeaders:!0,selModel:Ext.create("Ext.selection.CheckboxModel",
{checkOnly:!0})}],listeners:{afterrender:function(a){if(a.titleCmp){var b=traduci(a.title),c=a.titleCmp;Ext.isDefined(a.iconCmp)&&a.iconCmp.destroy();a.iconCmp=Ext.create("Ext.form.field.Checkbox",{checked:!0,style:{"float":"left",position:"absolute"},itemId:"CheckServiziCu",reference:"CheckServiziCu",renderTo:a.legend.getId(),listeners:{afterrender:function(b){b.getEl().on("change",function(){var c=a.down("#GridServiziCu");b.getValue()?c.getSelectionModel().selectAll():c.getSelectionModel().deselectAll()})}}});
c.update(traduci(b));a.titleCmp.setStyle({"margin-left":"26px","margin-top":"2px"})}}}}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{pack:"center",type:"hbox"},items:[{xtype:"button",itemId:"BtnEntraTip",reference:"BtnEntraTip",width:120,iconCls:"icon-entra",scale:"medium",text:"ENTRA"}]}]}]}]});this.callParent(arguments)}});
Ext.define("Sipcar.view.VersioneModuli",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"treepanel",flex:1,border:0,itemId:"TreeRep",reference:"TreeRep",store:Ext.create("Sipcar.store.VersioneModuli"),useArrows:!0,rootVisible:!1,columns:[{xtype:"treecolumn",dataIndex:"modulo",text:"MODULO",flex:1,renderer:function(a,b,c){b.style="background-color: "+c.get("colore");return c.get("modulo")}},{xtype:"gridcolumn",width:100,dataIndex:"versione",
text:"VERSIONE",align:"center",renderer:function(a,b,c){b.style="background-color: "+c.get("colore");return c.get("versione")}},{xtype:"gridcolumn",text:"DATA_VERSIONE",dataIndex:"data",width:100,align:"center",renderer:function(a,b,c){b.style="background-color: "+c.get("colore");return c.get("data")}}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"label",itemId:"LblType",reference:"LblType",flex:1},{xtype:"label",itemId:"LblDataRilascio",reference:"LblDataRilascio",flex:1}]}]}]});this.callParent(arguments)}});
Ext.define("Sipcar.view.Viewport",{extend:"Sipcar.view.MyViewport",renderTo:Ext.getBody()});Ext.Loader.setConfig({enabled:!0});
Ext.application({requires:["Generali.standard.ControlledContainer","Sipcar.view.MyViewport"],views:["MyViewport"],autoCreateViewport:!0,controllers:["Login","Menu"],name:"Sipcar",appFolder:"sipcar/app",launch:function(){Ext.ariaWarn=Ext.emptyFn;CBA.parametriGenerali.produzione||(Ext.Loader.loadScript({url:"cba-utils/requires-all.js"}),Ext.Loader.loadScript({url:"cba-utils/requires-desktop.js"}),Ext.Loader.loadScript({url:"generali/StdSipcar.js"}));Ext.isWebKit&&(Ext._scrollbarSize={width:5,height:5})}});