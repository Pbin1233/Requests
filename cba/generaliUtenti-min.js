var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[c]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var c=0;return $jscomp.iteratorPrototype(function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var c=b[Symbol.iterator];return c?c.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var c,d=[];!(c=b.next()).done;)d.push(c.value);return d};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};
$jscomp.inherits=function(b,c){function d(){}d.prototype=c.prototype;b.prototype=new d;b.prototype.constructor=b;for(var f in c)if(Object.defineProperties){var g=Object.getOwnPropertyDescriptor(c,f);g&&Object.defineProperty(b,f,g)}else b[f]=c[f]};var _destructuring=[].push.apply([],[].concat($jscomp.arrayFromIterable([])));Ext.define("GeneraliOSP.QuoteMassive.controller.QuoteMassive",{extend:"Generali.standard.stampe.Controller",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Paginatore",selector:b+"#Paginatore"},{ref:"ParametriRicerca",selector:b+"#ParametriRicerca"},{ref:"TabPrincipale",selector:b+"#TabPrincipale"},{ref:"BtnIndietro",selector:b+"#BtnIndietro"},{ref:"BtnAvanti",selector:b+"#BtnAvanti"},{ref:"BtnElabora",selector:b+"#BtnElabora"},{ref:"PageParametri",selector:b+
"#PageParametri"},{ref:"PageSedeReparto",selector:b+"#PageSedeReparto"},{ref:"PageUtenti",selector:b+"#PageUtenti"},{ref:"PagePaganti",selector:b+"#PagePaganti"},{ref:"PageAnteprima",selector:b+"#PageAnteprima"},{ref:"DataDeco",selector:b+"#DataDeco"},{ref:"ChkPresentiAllaDecorrenza",selector:b+"#ChkPresentiAllaDecorrenza"},{ref:"ChkEntratiDopoDecorrenza",selector:b+"#ChkEntratiDopoDecorrenza"},{ref:"quotaSanPres",selector:b+"#quotaSanPres"},{ref:"quotaAlbPres",selector:b+"#quotaAlbPres"},{ref:"quotaSanAss",
selector:b+"#quotaSanAss"},{ref:"quotaAlbAss",selector:b+"#quotaAlbAss"},{ref:"TreeServiziClass",selector:b+"#TreeServiziClass"},{ref:"TreeSedeReparto",selector:b+"#TreeSedeReparto"},{ref:"FiltraSoloAttivi",selector:b+"#FiltraSoloAttivi"},{ref:"FiltraPerSede",selector:b+"#FiltraPerSede"},{ref:"GridUtenti",selector:b+"#GridUtenti"},{ref:"GridPaganti",selector:b+"#GridPaganti"},{ref:"GridCategoria",selector:b+"#GridCategoria"},{ref:"TipoPagantePagePaganti",selector:b+"#TipoPagantePagePaganti"},{ref:"PnlRiepilogo",
selector:b+"#PnlRiepilogo"},{ref:"CntAnteprima",selector:b+"#CntAnteprima"},{ref:"PnlFiltri",selector:b+"#PnlFiltri"},{ref:"RBTipoQuota",selector:b+"#RBTipoQuota"}]);this.control(b+"#Paginatore",{beforetabchange:this.beforetabchangePaginatore,tabchange:this.tabchangePaginatore,render:this.rendertabPaginatore});this.control(b+"#TreeServiziClass",{checkchange:this.checkchangeTreeServiziClass,beforeitemcontextmenu:this.beforeitemcontextmenuServiziClass,beforeedit:this.beforeeditTreeServiziClass});this.control(b+
"#TreeSedeReparto",{load:this.loadTreeSedeReparto,checkchange:this.checkchangeTreeSedeReparto,beforeitemcontextmenu:this.beforeitemcontextmenuSedeReparto});this.control(b+"#FiltraSoloAttivi",{change:this.filtraSoloAttivi});this.control(b+"#FiltraPerSede",{change:this.filtraPerSede});this.control(b+"#BtnAvanti",{click:this.avanti});this.control(b+"#BtnIndietro",{click:this.indietro});this.control(b+"#BtnElabora",{click:this.elab});this.control(b+"#GridCategoria",{selectionchange:this.selectionchangeGridCategoria});
this.control(b+"#TipoPagantePagePaganti",{selectionchange:this.selectionchangeTipoPagantePagePaganti})},checkchangeTreeServiziClass:function(b,c,d){treeCheckchange(b,c,d)},beforeitemcontextmenuServiziClass:function(b,c,d,f,g,h){return getPopupMenuTree(g,b)},checkchangeTreeSedeReparto:function(b,c,d){treeCheckchange(b,c,d)},beforeitemcontextmenuSedeReparto:function(b,c,d,f,g,h){return getPopupMenuTree(g,b)},selectionchangeGridCategoria:function(b,c,d){this.filtraPaganti(!0)},selectionchangeTipoPagantePagePaganti:function(){this.filtraPaganti(!0)},
tabchangePaginatore:function(b,c,d,f){this.getBtnElabora().setDisabled("PagePaganti"!=c.itemId)},rendertabPaginatore:function(){this.disabilitaClickTab()},beforetabchangePaginatore:function(b,c,d,f){return b.cambiaTab},beforeeditTreeServiziClass:function(b,c){if(!c.record.isLeaf())return!1},elab:function(){var b=this;Messaggio("ATTENZIONE","PAG_MSG_CONFIRM_AGGIORNA_QUOTE","YESNO","QUESTION",null,function(){b.elabora()})},elabora:function(){var b=this,c=[],d=b.getGridUtenti();0!=d.getSelectionModel().getCount()&&
Ext.each(d.getSelectionModel().getSelection(),function(b){c.push(b.get("codOspite"))});var c=c.toString(),f=[],d=b.getGridPaganti();Ext.each(d.getSelectionModel().getSelection(),function(b){f.push(b.get("codFocl"))});f=f.toString();d=getListCheckedTree(b.getTreeServiziClass(),!0,"idRisposta",null,null,b.getFiltraSoloAttivi().value?!1:!0);Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/AnagraficaOspiti/paganti/aggiornaQuoteMassivo",params:{dataDecorrenza:b.getDataDeco().getValue(),tipoQuota:b.getRBTipoQuota().getValue(),
importoSanPres:b.getQuotaSanPres().getValue(),importoSocPres:b.getQuotaAlbPres().getValue(),importoSanAss:b.getQuotaSanAss().getValue(),importoSocAss:b.getQuotaAlbAss().getValue(),elencoUtenti:c,elencoPaganti:f,elencoClassificazioni:d,includiEntrateSucc:null!=b.getChkEntratiDopoDecorrenza().getValue()?getBoolValue(b.getChkEntratiDopoDecorrenza().getValue()):"F"},success:function(c){var d=Ext.JSON.decode(c.responseText);c=[];if(d.success){b.getBtnElabora().setDisabled(!0);titolo=traduci("MSG_SALVATAGGIO_DATI");
msgAdd(c,d.message);var f=getPathServer()+d.data.filePath,g=f.split("\\").pop().split("/").pop(),d=d.data.fileType?d.data.fileType.toLowerCase():"",f="pdf"==d||-1!=Ext.Array.indexOf(getEstensioniImg(),d)?{itemId:"iframePdf",reference:"iframePdf",html:'<iframe width="100%" height="100%" src="'+f+'" onload="fineAttesa()"></iframe>'}:creaItemDownload("icon-"+d,f,g,g);b.getPaginatore().getLayout().next();b.getCntAnteprima().removeAll();b.getCntAnteprima().add(f)}else titolo=traduci("MSG_ERRORI_TROVATI"),
msgAddError(c,d.message);msgShow(titolo,c)}})},disabilitaClickTab:function(){var b=this.getPaginatore();b.items.each(function(c){if(!Ext.isDefined(c.tab.giaCreato))c.tab.on("click",function(){c.tab.giaCreato=!0;b.cambiaTab=!1})})},selectAllRows:function(b){b.rendered&&(b.getSelectionModel().selectAll(!0),b.getView().focusRow(0))},filtraSoloAttivi:function(b,c,d,f){this.getTreeServiziClass().getStore().clearFilter();c&&this.getTreeServiziClass().getStore().filter({filterFn:function(b){return!["testoAnnullato non_attivi"].includes(b.data.cls)}})},
filtraPerSede:function(b,c,d,f){this.getTreeSedeReparto().setDisabled(!c);this.svuotaStoreUtenti()},svuotaStoreUtenti:function(){this.cbaConfig.pageUtenti&&svuotaStore(this.getGridUtenti().getStore())},loadTreeSedeReparto:function(b,c,d,f,g,h){Ext.each(c,function(b){b.parentNode.isRoot()&&b.isLeaf()&&(delete b.data.checked,b.set("cls","cba-disabled-element"))})},avanti:function(){this.naviga("next")},indietro:function(){this.getPnlRiepilogo().down("#ExportCnt")&&this.getPnlRiepilogo().down("#ExportCnt").hide();
this.naviga("prev")},naviga:function(b){var c=this.getPaginatore(),d=c.getLayout(),c=c.getActiveTab(),f=this.getDataDeco(),g=this.getRBTipoQuota().getValue().tipoQuota;this.getPaginatore().cambiaTab=!0;if(b){if("next"!=b||c!=this.getPagePaganti()){if("next"==b&&c==this.getParametriRicerca()){validaForm(this.getPnlFiltri());if(!f.isValid())return msgShowWarning("","MSG_DATADECORRENZA_NON_VALIDA"),!1;if("M"==g||"T"==g)if(f=f.getValue(),g=giornoInizioMese(f),f.getTime()!=g.getTime())return msgShowWarning("",
"DATADECORRENZA_QUOTE_INIZIOMESE"),!1;if(!(this.getQuotaSanPres().isValid()&&this.getQuotaSanAss().isValid()&&this.getQuotaAlbPres().isValid()&&this.getQuotaAlbAss().isValid()))return msgShowWarning("","PAG_QUOTE_OBB"),!1}else if("next"==b&&c==this.getPageUtenti()&&0==this.getGridUtenti().getSelection().getSelected||"next"==b&&c==this.getPagePaganti()&&0==this.getGridPaganti().getSelection().getSelected)return msgShowWarning("","MSG_DATI_MANCANTI_ELAB"),!1;d[b]()}"next"==b&&c==this.getPageSedeReparto()?
this.loadUtenti():"next"==b&&c==this.getPageUtenti()?(this.loadPagantiFascicolo(),this.getBtnAvanti().setDisabled(!0)):this.abilitaPulsanti(!0)}else this.abilitaPulsanti(!0);return!0},loadUtenti:function(){inizioAttesa();var b=this,c=b.getGridUtenti(),d=b.getTreeServiziClass(),f=b.getTreeSedeReparto(),g=b.getFiltraPerSede(),h="";if(b.cbaConfig.tipoDocFattura&&b.cbaConfig.pagePaganti){var k=b.getGridPaganti();Ext.each(k.getSelectionModel().getSelection(),function(b){h+=","+b.get("codFocl")});""!=h&&
(h=h.substr(1))}k=getListCheckedTree(d,!0,"idRisposta",null,null,b.getFiltraSoloAttivi().value?!1:!0);c.getStore().clearData();b.abilitaPulsanti(!1);c.getStore().load({params:{dataDal:b.getDataDeco().getValue(),dataAl:b.getChkEntratiDopoDecorrenza().getValue()?new Date("01-01-2100"):b.getDataDeco().getValue(),servizi:"("+getListCheckedTree(d,b.cbaConfig.soloServizi?!0:!1,"idServizio","'")+")",classificazioni:k,sedi:g?g.getValue()?"("+getListCheckedTree(f,!1,"idSede")+")":"":"",reparti:g?g.getValue()?
"("+getListCheckedTree(f,!0,"idReparto")+")":"":"",filtraPerSede:getBoolValue(g?g.getValue():!1),listaPaganti:"("+h+")",tipoClassificazione:1},callback:function(d,f,g){g?Ext.isEmpty(d)?msgShowWarning("","MSG_STAMPA_NESSUN_UTENTE"):(Ext.suspendLayouts(),b.selectAllRows(c),Ext.resumeLayouts()):msgShowError("",f.getError());b.abilitaPulsanti(!0);fineAttesa()}})},loadPagantiFascicolo:function(){inizioAttesa();var b=this,c=b.getGridPaganti(),d=b.getTreeServiziClass(),f=[];b.getGridCategoria().getStore().load();
b.getTipoPagantePagePaganti().getStore().load();Ext.each(b.getGridUtenti().getSelectionModel().getSelection(),function(b){(b=b.get("idRicovero"))&&!Ext.Array.contains(f,b)&&f.push(b)});svuotaStore(c.getStore());b.abilitaPulsanti(!1);d={dataDal:b.getDataDeco().getValue(),dataAl:b.getChkEntratiDopoDecorrenza().getValue()?new Date("01-01-2100"):b.getDataDeco().getValue(),ricoveri:f.toString(),servizi:getListCheckedTree(d,!0,"idServizio"),classificazioni:getListCheckedTree(d,!0,"idRisposta",null,null,
b.getFiltraSoloAttivi().value?!1:!0)};Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/rette/paganti/list",params:d,success:function(d){d=Ext.JSON.decode(d.responseText);d.success?Ext.isEmpty(d.data)?msgShowWarning("","MSG_STAMPA_NESSUN_PAGANTE"):(Ext.suspendLayouts(),c.getStore().loadData(d.data),b.selectAllRows(c),Ext.resumeLayouts()):msgShowError("",d.message);b.abilitaPulsanti(!0);fineAttesa()}});b.filtraPaganti()},filtraPaganti:function(){var b=this.getGridCategoria(),c=this.getTipoPagantePagePaganti(),
d=[],f=[],g=0<b.getSelectionModel().getCount()&&b.getSelectionModel().getCount()!=b.getStore().getTotalCount();g&&Ext.each(b.getSelectionModel().getSelection(),function(b){d.push(b.get("codice"))});var h=0<c.getSelectionModel().getCount()&&c.getSelectionModel().getCount()!=c.getStore().getTotalCount();h&&Ext.each(c.getSelectionModel().getSelection(),function(b){f.push(b.get("codice"))});this.getGridPaganti().getStore().clearFilter();this.getGridPaganti().getStore().filter([{filterFn:function(b){var c=
!0,k=!0;g&&(c=0==d.length||0<=Ext.Array.indexOf(d,b.get("codCategoria")));h&&(k=0==f.length||0<=Ext.Array.indexOf(f,b.get("tipoPagante")));return c&&k}}])},loadTreeServClass:function(){var b=this.getTreeServiziClass(),c={tipo:1,tipoStampa:this.cbaConfig.id};b.on("beforeload",function(b){b.clearFilter()},b,{single:!0});var d=this.getFiltraSoloAttivi();b.getStore().load({params:c,callback:function(c,g,h){h?(d.fireEvent("change",d,d.getValue()),b.expandAll()):msgShowError("",g.getError())}})},abilitaPulsanti:function(b){var c=
this.getPaginatore().getLayout();b?(this.getBtnIndietro().setDisabled(!c.getPrev()),this.getBtnAvanti().setDisabled(!c.getNext()||"PagePaganti"==this.getPaginatore().getActiveTab().getItemId()),this.taskElaborazione&&this.taskElaborazione.start()):(this.getBtnIndietro().setDisabled(!0),this.getBtnAvanti().setDisabled(!0),this.taskElaborazione&&this.taskElaborazione.stop())},onLaunch:function(){var b=this;ImpostaUrl([b.getGridUtenti().getStore(),b.getTreeServiziClass().getStore()]);b.loadTreeServClass();
b.getTreeSedeReparto().getStore().load({callback:function(c,d,f){f?b.getTreeSedeReparto().expandAll():msgShowError("",d.getError())}});b.naviga()}});
Ext.define("GeneraliOSP.QuoteMassive.view.QuoteMassive",{extend:"Generali.standard.ControlledContainer",initComponent:function(){this.larghezza=580;this.larghezza_dicitura=170;Ext.applyIf(this,{items:[{xtype:"tabpanel",itemId:"Paginatore",reference:"Paginatore",flex:1,tabBar:{height:48,items:[{xtype:"tbfill"},{xtype:"toolbar",border:0,items:[{xtype:"button",itemId:"BtnIndietro",reference:"BtnIndietro",iconCls:"icon-indietro",scale:"large",tooltip:"INDIETRO",disabled:!0},{xtype:"tbspacer",width:10},
{xtype:"button",itemId:"BtnAvanti",reference:"BtnAvanti",iconCls:"icon-avanti",tooltip:"AVANTI",scale:"large"},{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-elabora32",scale:"large",text:traduci("ELABORA"),disabled:!0}]}]},items:[{xtype:"panel",tabConfig:{title:"PARAMETRI_GENERALI",height:44},itemId:"ParametriRicerca",reference:"ParametriRicerca",layout:{align:"stretch",type:"hbox"},bodyPadding:5,title:"",items:[{xtype:"container",padding:5,width:350,layout:{align:"stretch",
type:"vbox"},itemId:"PnlFiltri",reference:"PnlFiltri",autoScroll:!0,items:[{xtype:"container",layout:{align:"stretch",type:"hbox"},margin:"10 0 10 0",items:[{xtype:"image",cls:"icon-info",margin:"0 5 0 0"},{xtype:"label",html:traduci("INFO_AGGIORNAQUOTEMASSIVO"),height:"70px"}]},{xtype:"fieldset",margin:"0 0 8 0",title:"Tipo Quota",itemId:"TipoQuota",reference:"TipoQuota",items:[{xtype:"radiogroup",itemId:"RBTipoQuota",reference:"RBTipoQuota",vertical:!0,columns:2,margin:"0 0 0 5",items:[{formId:this.getItemId()+
"-form",boxLabel:decodeTipoQuota("G",!0),name:"tipoQuota",inputValue:"G",checked:!0},{formId:this.getItemId()+"-form",boxLabel:decodeTipoQuota("M",!0),name:"tipoQuota",inputValue:"M"},{formId:this.getItemId()+"-form",boxLabel:decodeTipoQuota("N",!0),name:"tipoQuota",inputValue:1,inputValue:"N"},{formId:this.getItemId()+"-form",boxLabel:decodeTipoQuota("T",!0),name:"tipoQuota",inputValue:"T"}]}]},{xtype:"datefield",itemId:"DataDeco",reference:"DataDeco",cls:"cbaLabel",fieldLabel:"DATA_DECORRENZA",
allowBlank:!1,value:new Date},{xtype:"fieldset",layout:"anchor",height:80,items:[{xtype:"checkboxfield",itemId:"ChkPresentiAllaDecorrenza",reference:"ChkPresentiAllaDecorrenza",cls:"cbaLabel",checked:!0,boxLabel:"QUOTE_MAS_PRES",inputValue:"T",uncheckedValue:"F",disabled:!0},{xtype:"checkboxfield",itemId:"ChkEntratiDopoDecorrenza",reference:"ChkEntratiDopoDecorrenza",cls:"cbaLabel",boxLabel:'<div style="width:100%;white-space:normal;">'+traduci("QUOTE_MAS_SUCC")+"</div>",inputValue:"T",uncheckedValue:"F"}]},
{xtype:"fieldset",title:traduci("QUOTE"),items:[{xtype:"container",layout:{align:"stretch",type:"hbox"},margin:"0 0 0 10",items:[{xtype:"container",layout:{align:"fit",type:"vbox"},items:[{xtype:"label",text:"PRESENZA",margin:"0 0 0 130"},{xtype:"numberfield",fieldLabel:"QUOTA_SAN",name:"quotaSanPres",itemId:"quotaSanPres",reference:"quotaSanPres",labelClsExtra:"cbaLabel",margin:"3 0 0 0",maxLength:7,allowBlank:!1,enforceMaxLength:!0,width:190,labelWidth:110},{xtype:"numberfield",fieldLabel:"QUOTA_ALB",
name:"quotaAlbPres",itemId:"quotaAlbPres",reference:"quotaAlbPres",labelClsExtra:"cbaLabel",margin:"5 0 0 0",maxLength:7,allowBlank:!1,enforceMaxLength:!0,width:190,labelWidth:110}]},{xtype:"container",layout:{align:"stretch",type:"vbox"},margin:"0 0 0 10",items:[{xtype:"label",text:"ASSENZA",margin:"0 0 0 10"},{xtype:"numberfield",name:"quotaSanAss",itemId:"quotaSanAss",reference:"quotaSanAss",labelClsExtra:"cbaLabel",margin:"3 0 5 0",maxLength:7,allowBlank:!1,enforceMaxLength:!0,width:75},{xtype:"numberfield",
name:"quotaAlbAss",itemId:"quotaAlbAss",reference:"quotaAlbAss",labelClsExtra:"cbaLabel",margin:"0 0 10 0",maxLength:7,allowBlank:!1,enforceMaxLength:!0,width:75}]}]}]}]},{xtype:"container",itemId:"CntTreeServizi",reference:"CntTreeServizi",fieldDefaults:{margin:"2 4 4 2"},layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},margin:"3 0 0 5",items:[{xtype:"checkboxfield",itemId:"FiltraSoloAttivi",reference:"FiltraSoloAttivi",fieldLabel:"",
boxLabel:"FILTRA_SOLO_ATTIVI",cls:"cbaLabel",inputValue:"T",uncheckedValue:"F",listeners:{render:{fn:function(b,c){b.setValue(!0)},scope:this}}},{xtype:"treepanel",flex:1,border:0,margin:"0 10 0 0",itemId:"TreeServiziClass",reference:"TreeServiziClass",rootVisible:!1,useArrows:!0,store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),columns:[{xtype:"treecolumn",dataIndex:"text",text:"SERVIZI_CLASSIFICAZIONI",flex:1}],viewConfig:{loadMask:!1},plugins:{ptype:"cellediting",clicksToEdit:1}}]}]}]},
{xtype:"panel",itemId:"PageSedeReparto",reference:"PageSedeReparto",tabConfig:{title:"SELEZIONE_SEDE_REPARTO",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"checkboxfield",itemId:"FiltraPerSede",reference:"FiltraPerSede",cls:"cbaLabel",fieldLabel:"",boxLabel:"FILTRA_PER_SEDE",inputValue:"T",uncheckedValue:"F"},{xtype:"treepanel",flex:1,border:0,itemId:"TreeSedeReparto",reference:"TreeSedeReparto",title:"",rootVisible:!1,useArrows:!0,disabled:!0,store:Ext.create("GeneraliOSP.store.SedeReparto"),
viewConfig:{loadMask:!1}}]},{xtype:"panel",itemId:"PageUtenti",reference:"PageUtenti",tabConfig:{title:"ELENCO_UTENTI",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"gridpanel",itemId:"GridUtenti",reference:"GridUtenti",flex:1,store:Ext.create("GeneraliOSP.stampe.store.UtentiStampa"),columns:[{xtype:"gridcolumn",dataIndex:"nominativo",text:"COGNOME_NOME",flex:1},{xtype:"datecolumn",align:"center",style:"text-align:center",dataIndex:"dataNascita",text:"DATA_NASCITA",format:"d/m/Y",
width:90}],viewConfig:{loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",cbaConfig:{searchField:"nominativo",ricercaIniziaPer:!0}}]}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"simple"})}]},{xtype:"panel",itemId:"PagePaganti",reference:"PagePaganti",tabConfig:{title:"PAGANTI",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},height:120,margin:"0 0 20 0",items:[{xtype:"gridpanel",
itemId:"TipoPagantePagePaganti",reference:"TipoPagantePagePaganti",width:200,margin:"0 20 0 0",store:Ext.create("GeneraliOSP.store.TipiPaganti",{autoLoad:!0}),columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"TIPI_PAGANTE",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})},{xtype:"gridpanel",itemId:"GridCategoria",reference:"GridCategoria",store:Ext.create("Generali.store.Categoria"),flex:1,columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"CATEGORIA",
flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})}]},{xtype:"gridpanel",itemId:"GridPaganti",reference:"GridPaganti",flex:1,store:Ext.create("GeneraliOSP.stampe.store.Paganti"),columns:[{xtype:"gridcolumn",dataIndex:"ragioneSociale",text:"RAGIONE_SOCIALE",width:300},{xtype:"gridcolumn",dataIndex:"codiceFiscale",text:traduci("CODICE_FISCALE")+"/"+traduci("PARTITA_IVA"),flex:1}],viewConfig:{loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",
cbaConfig:{searchField:"ragioneSociale",ricercaIniziaPer:!0}}]}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"simple"})}]},{xtype:"panel",tabConfig:{title:traduci("RIEPILOGO"),height:44},itemId:"PnlRiepilogo",reference:"PnlRiepilogo",layout:{type:"hbox",align:"stretch"},border:0,bodyPadding:5,items:[{xtype:"container",itemId:"CntAnteprima",reference:"CntAnteprima",layout:"fit",flex:1}]}]}]});this.callParent(arguments)}});
var StdUtenti=function(){var b;b=StdSipcar.call(this)||this;b._flussi=new Map([[1,["FAR_EMILIA",traduci("FR_EMILIA_FAR")]],[2,["RSA_APERTA_LOMBARDIA",traduci("FR_LOMBARDIA_RSA_APERTA")]],[3,["CURE_PALLIATIVE_RES_LOMBARDIA",traduci("FR_LOMBARDIA_CURE_PALLIATIVE_RESIDENZIALI")]],[4,["CURE_PALLIATIVE_DOM_LOMBARDIA",traduci("FR_LOMBARDIA_CURE_PALLIATIVE_DOMICILIARI")]],[5,["CURE_PALLIATIVE_RES_VENETO",traduci("FR_VENETO_CURE_PALLIATIVE_RESIDENZIALI")]],[6,["FAR_VENETO",traduci("FR_VENETO_FAR")]],[7,["SOSIA_LOMBARDIA",
traduci("FR_LOMBARDIA_SOSIA")]],[8,["SDORIA_LOMBARDIA",traduci("FR_LOMBARDIA_SDORIA")]],[9,["SCDI_LOMBARDIA",traduci("FR_LOMBARDIA_SCHEDA_CDI")]],[10,["ODC_VENETO",traduci("FR_VENETO_ODC_URT")]],[11,["SPA_ALTOADIGE",traduci("FR_ALTOADIGE_SPA")]],[12,["FILEC_MARCHE",traduci("FR_MARCHE_FILEC")]],[13,["SDO_ALTOADIGE",traduci("FR_ALTOADIGE_SDO")]],[14,["SDOFIM_ALTOADIGE",traduci("FR_ALTOADIGE_SDOFIM")]],[15,["SDERIA_ALTOADIGE",traduci("FR_ALTOADIGE_SDERIA")]],[16,["FILER_MARCHE",traduci("FR_MARCHE_FILER")]],
[17,["LIS_TRENTINO",traduci("FR_TRENTINO_LIS")]]]);b.recImpostazioniServizio=null;b.map_modulo_servizio=new Map;b.expired_after=3E4;return b};$jscomp.inherits(StdUtenti,StdSipcar);StdUtenti.prototype.clearMap=function(){this.map_modulo_servizio.clear()};StdUtenti.prototype.getMapValue=function(b){if(this.map_modulo_servizio.has(b)&&this.map_modulo_servizio.get(b).expiredAt>Date.now())return this.map_modulo_servizio.get(b).value};
StdUtenti.prototype.setMapValue=function(b,c){this.map_modulo_servizio.set(b,{value:c,expiredAt:Date.now()+this.expired_after});return c};StdUtenti.prototype.getFlussoRegionaleConst=function(b){return this._flussi.get(b)[0]};StdUtenti.prototype.getFlussoRegionaleDesc=function(b){return this._flussi.get(b)[1]};StdUtenti.prototype.loadFlussiRegionaliConst=function(b){b=void 0===b?{}:b;this._flussi.forEach(function(c,d){b["_"+c[0]]=d})};
StdUtenti.apriWindowLettiLiberi=function(b){var c=b.formatoData&&""!=b.formatoData?b.formatoData:"d/m/Y",c=traduci("LETTI_LIBERI")+" ("+FormattaData(b.ggDecorrenza,c)+")",d=Ext.create("winCBA",{name:"GeneraliOSP.fascicoloNoApp.view.LettiLiberi",titolo:c,dimensione:1,closable:!0,configItem:{permesso:b.permesso,ggDecorrenza:b.ggDecorrenza,usaDataDimPrev:b.usaDataDimPrev,salva:function(c){b.cb_salva&&b.cb_salva(c);d.close()}}}).show()};
StdUtenti.prototype.getImpostazioniServizio=function(b,c){var d=this,f=[b,c].join("#"),g=this.getMapValue(f);return g?Promise.resolve(g):new Promise(function(g,k){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/prszn/servizio/impostazioni",params:{idServizio:c},success:function(h){h=Ext.JSON.decode(h.responseText);h.success?(d.recImpostazioniServizio=h.data,d.recImpostazioniServizio||(d.recImpostazioniServizio={}),Object.assign(d.recImpostazioniServizio,{idModulo:b,idServizio:c}),50==CBA.moduli.moduloAttivo&&
(d.recImpostazioniServizio.abilitaAccompagnatore="F",d.recImpostazioniServizio.abilitaOraResidenziale="F",d.recImpostazioniServizio.gestioneStrutturaAssenza="F"),d.setMapValue(f,d.recImpostazioniServizio),g(d.recImpostazioniServizio)):k(h.message[0].testo)}})})};
StdUtenti.setTipoMov=function(b){var c=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/sinottico/groupTipoMov"}});b._TipoMovRes=new Map([]);c.load({params:{soloSelezionabili:!1},callback:function(c,f,g){g?c.forEach(function(c){var d=c.get("codice"),f="";switch(d){case "I":f="bgViolet";break;case "O":f="bgOrange";break;case "D":f="bgOrange";break;case "E":f="bgAzure";break;case "U":f="bgAzure";break;case "A":f="bgYellow"}b._TipoMovRes[d]=[c.get("valore"),f]}):msgShowError("ERRORE",
"lista tipoMovResidenziale")}})};StdUtenti.createTooltipRilevatoCalendario=function(b){addToolTipCol(b,'<b><span style="color:blue">'+traduci("PIANIFICATO")+'</span><br> <span style="color:green">'+traduci("EROGATO")+'</span><br><span style="color:orange">'+traduci("NON_EROGATO")+"</span></b>")};
StdUtenti.renderRilevatoCalendario=function(b,c,d){null==b&&(b=0);null==c&&(c=0);null==d&&(d=0);return'<b><span style="color:blue">'+formatFloat(b)+'</span> <span style="color:green">'+formatFloat(c)+'</span> <span style="color:orange">'+formatFloat(d)+"</span></b>"};
StdUtenti.getCodFoclAssDistr=function(b,c,d){var f=b.codAsl;if(f&&""!=f){var f=b.comune,g=Ext.create("GeneraliOSP.personalizzazioni.store.DistrettoAslPagante");ImpostaUrl([g]);g.load({params:{idServizio:c,codAsl:b.codAsl,codAsst:b.codAsst,codIstatComune:f,codRegione:d},callback:function(b,c,d){d?(b=b[0],currOspite.codFoclAssDistr=b?b.get("codFocl"):null):msgShowError("",c.getError())}})}};
StdUtenti.checkNumStrutture=function(b,c,d,f,g){var h=!0,k=!1;0==b||1<b?k=0==b?"FR_MSG_TRACCIATO_UNA_STRUTTURA":"FR_MSG_TRACCIATO_PIU_STRUTTURE":g&&(k=g);k&&(h=!1,Messaggio("ATTENZIONE",k,"OK","INFO",function(){d&&d.setDisabled(!0);f&&f.setDisabled(!1)}),c&&c.setActiveTab(c.down("#PageParametri")));return h};StdUtenti.abiCabFromIBAN=function(b){return b?b.substring(5,15):""};StdUtenti.isBankChanged=function(b,c){return b&&c&&this.abiCabFromIBAN(b)!=this.abiCabFromIBAN(c)};CBA.StdUtenti=new StdUtenti;
Ext.define("GeneraliOSP.anagraficaSrc.controller.AnagraficaLightSearch",{extend:"Generali.standard.ViewController",init:function(){this.callParent(arguments);this.addRef([])},validate:function(){var b=[];this.lookup("Form").query("field{isValid()==false}").forEach(function(c){msgAddError(b,c.getFieldLabel()+traduci("CAMPO_OBBLIGATORIO"))});return msgShow("",b)},clickBtnExit:function(){this.getView().up("window").close()},clickBtnNuovo:function(){var b=this.cbaConfig;(void 0===b.externalFn?function(){return null}:
b.externalFn)(null);this.getView().up("window").close()},clickBtnConferma:function(){var b=this;if(this.validate()){var c=this.lookup("Form").getForm().getFieldValues(),d=this.cbaConfig,f=void 0===d.externalFn?function(){return null}:d.externalFn;"CU_INT_ANA_SISS"==CBA.parametriGenerali.tipoIntegrazioneAnagrafica?IntegrazioneSissWay.launchSissWay(c,function(c){f(c);b.getView().up("window").close()}):["CU_INT_ANA_ALTOADIGE","CU_INT_ANA_PEDERZOLI"].includes(CBA.parametriGenerali.tipoIntegrazioneAnagrafica)&&
(Ext.create("winCBA",{name:"GeneraliOSP.integrazioni.view.GridResult",titolo:"NOMINATIVI_TROVATI_ANAG_EXT",dimensione:1,configItem:{searchParam:c,close_cb:function(b){var c=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite"),d=b.get("indResidenza");d&&!d.dataDecorrenza&&(d.dataDecorrenza=b.get("dataNascita"));b=c.insert(0,b);f(b[0])}}}).show(),this.getView().up("window").close())}},onLaunch:function(){this.lookup("Form").isValid()}});
Ext.define("GeneraliOSP.anagraficaSrc.view.AnagraficaLightSearch",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"form",reference:"Form",layout:{type:"vbox",align:"stretch"},bodyPadding:4,flex:1,items:[{xtype:"fieldset",title:"RICERCA_PER",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"textfield",name:"cognome",reference:"Cognome",fieldLabel:"COGNOME",
validator:function(c){return c||b.fiscalCodValid?!0:traduci("MSG_CAMPO_OBBLIGATORIO")}},{xtype:"textfield",name:"nome",reference:"Nome",fieldLabel:"NOME",validator:function(c){return c||b.fiscalCodValid?!0:traduci("MSG_CAMPO_OBBLIGATORIO")}},{xtype:"textfield",reference:"CodFisc",name:"codFisc",fieldLabel:"CODICE_FISCALE",validator:function(c){b.fiscalCodValid=!1;if(!c)return!0;if(c=/(^([A-Za-z]{6}[0-9lmnpqrstuvLMNPQRSTUV]{2}[abcdehlmprstABCDEHLMPRST]{1}[0-9lmnpqrstuvLMNPQRSTUV]{2}[A-Za-z]{1}[0-9lmnpqrstuvLMNPQRSTUV]{3}[A-Za-z]{1})$|^([0-9]{11})$)/.test(c))b.fiscalCodValid=
!0;b.lookupController().lookup("Nome").isValid();b.lookupController().lookup("Cognome").isValid();return c||traduci("MSG_CF_CHAR_NON_VALIDO")}}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbfill"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",cls:"cbaBtnFunzione cba-button-25",text:"CERCA",handler:"clickBtnConferma"},{xtype:"button",margin:"0 0 0 25",cls:"cbaBtnFunzione cba-button-25",text:"NUOVO_UTENTE",handler:"clickBtnNuovo"},{xtype:"button",margin:"0 10 0 25",
cls:"cbaBtnFunzione cba-button-25",text:"ESCI",handler:"clickBtnExit"}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.booking.controller.Event",{extend:"Generali.standard.ViewController",uses:["GeneraliOSP.integrazioni.AnagraficaSearchUtils"],init:function(){var b=this;this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"CntCercaOspite",selector:this.selContainer+"#CntCercaOspite"},{ref:"GridRicerca",selector:this.selContainer+"#GridRicerca"},{ref:"CntEvent",selector:this.selContainer+"#CntEvent"},{ref:"CntSedeRepStanza",selector:this.selContainer+"#CntSedeRepStanza"},{ref:"BtnLettiLiberi",
selector:this.selContainer+"#BtnLettiLiberi"},{ref:"Ricovero",selector:this.selContainer+"#Ricovero"},{ref:"LaRichiestaServizi",selector:this.selContainer+"#LaRichiestaServizi"},{ref:"FldDatiPrenot",selector:this.selContainer+"#FldDatiPrenot"},{ref:"Nominativo",selector:this.selContainer+"#Nominativo"},{ref:"LblInfo",selector:this.selContainer+"#LblInfo"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"DataAl",selector:this.selContainer+"#DataAl"},{ref:"editResOraDal",selector:this.selContainer+
"#editResOraDal"},{ref:"editResOraAl",selector:this.selContainer+"#editResOraAl"},{ref:"EditResSede",selector:this.selContainer+"#EditResSede"},{ref:"EditResReparto",selector:this.selContainer+"#EditResReparto"},{ref:"EditResStanza",selector:this.selContainer+"#EditResStanza"},{ref:"EditResLetto",selector:this.selContainer+"#EditResLetto"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnEditServiziLista",selector:this.selContainer+
"#BtnEditServiziLista"},{ref:"PnlAttivi",selector:this.selContainer+"#PnlAttivi"},{ref:"Attivi",selector:this.selContainer+"#Attivi"},{ref:"NonAttivi",selector:this.selContainer+"#NonAttivi"},{ref:"SenzaServizi",selector:this.selContainer+"#SenzaServizi"},{ref:"StanzaUsoSingolo",selector:this.selContainer+"#StanzaUsoSingolo"}]);this.control(this.selContainer+"#BtnEditServiziLista",{click:this.clickBtnEditServiziLista});this.control(this.selContainer+"#BtnNuovo",{click:function(){b.permissionToOpenAnag()?
AnagraficaSearchUtils.openWinAnagrafica(b.clickNuovo.bind(b)):Messaggio("ATTENZIONE","MSG_NO_PERMESSI_EDIT_ANAG","OK","INFO")}});this.control(this.selContainer+"#Ricovero",{select:this.onRicoveroSelect});this.control(this.selContainer+"#GridRicerca",{select:this.onGridRicercaSelect});this.control(this.selContainer+"#BtnAnnulla",{click:this.onButtonClickAnnulla});this.control(this.selContainer+"#BtnLettiLiberi",{click:this.onBtnLettiLiberiClick});this.control(this.selContainer+"#EditResSede",{select:this.onEditResSedeSelect});
this.control(this.selContainer+"#EditResReparto",{select:this.onEditResRepartoSelect});this.control(this.selContainer+"#EditResStanza",{select:this.onEditResStanzaSelect});this.control(this.selContainer+"#SenzaServizi",{change:this.changeSenzaServizi});this.control(this.selContainer+"#Attivi",{change:this.controllaCheckNonAssociati});this.control(this.selContainer+"#NonAttivi",{change:this.controllaCheckNonAssociati});this.control(this.selContainer+"#DataDal",{select:this.onEditDataDalSelect});this.callParent(arguments)},
controllaCheckNonAssociati:function(){!this.getSenzaServizi().isVisible()||this.getAttivi().checked||this.getNonAttivi().checked?this.getSenzaServizi().setValue("F"):this.getSenzaServizi().setValue("T");this.loadGridRicerca()},changeSenzaServizi:function(){this.getSenzaServizi().checked?(this.getAttivi().setValue("F"),this.getNonAttivi().setValue("F")):this.getAttivi().checked||this.getNonAttivi().checked||this.getAttivi().setValue("T");this.loadGridRicerca()},loadImpServizio:function(b){var c=this;
(b=c.readExtraRecRicovero(2))?CBA.StdUtenti.getImpostazioniServizio(CBA.moduli.moduloAttivo,b).then(function(b){c.abilitaGestOraria(b.abilitaOraResidenziale)})["catch"](function(b){return msgShowError("",b)}):c.abilitaGestOraria(!1)},abilitaGestOraria:function(b){timeDal=this.getEditResOraDal();timeAl=this.getEditResOraAl();null==b&&(b=!1);this.abilitaGestioneOraria=b;timeDal.setHidden(!b);timeAl.setHidden(!b);b?(timeDal.removeCls("x-item-disabled"),timeAl.removeCls("x-item-disabled"),b=moment(new Date).startOf("day"),
b.set("hour",9),b.set("minute",0),b.set("second",0),timeDal.setValue(b.toDate()),b=b.endOf("day"),b.set("hour",9),b.set("minute",0),b.set("second",0),timeAl.setValue(b.toDate())):(timeDal.addCls("x-item-disabled"),timeAl.addCls("x-item-disabled"))},onRicoveroSelect:function(b,c){var d=Ext.isEmpty(c);this.loadImpServizio(c);this.loadDatiRichiesta(c);d?this.impostaLabel("S"):null==c.get("extra")?this.impostaLabel("L"):this.impostaLabel("L1")},loadDatiRichiesta:function(b){var c=this;b&&null!=b.get("extra")?
(b=this.readExtraRecRicovero(1),StdSipcar.promiseGetRequest(getUrlGen()+"/ws/listaAttesa/richieste/get",{idRichiesta:b}).then(function(b){b&&(b=Ext.create("LA.model.Richiesta",b),c.fillPrenotazione(b))})["catch"](function(b){msgShowError("",b)})):(this.getFldDatiPrenot().setDisabled(!0),this.getBtnLettiLiberi().setDisabled(!0))},impostaLabel:function(b){var c="",d=this.getLblInfo();if("S"==b)c="Seleziona un Servizio o clicca sul + per aggiungerne uno nuovo";else if("S0"==b)c="clicca sul + per aggiungerne un nuovo servizio/lista";
else if("L"==b)c="clicca sul + per selezionare una ListaAttesa";else if("I"==b||"L1"==b)c="compila tutti i campi";d.setHtml('<B><font color="blue">'+c+"</font>")},clickBtnEditServiziLista:function(){this.readExtraRecRicovero(3)?this.clickEditListaAttesa():this.clickEditServizi()},clickEditServizi:function(){var b=this,c=trovaRecord(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].storeVideateGen,"codVideata","EditServizi").get("permesso");c&&(b.cerca=b.loadGridRicerca,b.Ricerca={},b.Ricerca.controller=
b,b.Ricerca.cbaConfig={caricaDatiUtente:Ext.emptyFn},Ext.create("winCBA",{permesso:c,name:"GeneraliOSP.fascicoloNoApp.view.EditServizi",titolo:traduci("TITOLO_EDITSERVIZI"),nominativo:b.recOspite.get("nominativo"),altezzaWin:700,larghezzaWin:1024,configItem:{permesso:c,idRicovero:null,codOspite:b.recOspite.get("codOspite"),ricerca:b.Ricerca,classificazionePresente:null,EditDatiAggiuntivi:null,nuovo:!1},listeners:{close:function(c){b.loadStoreEvent(b.recOspite)}}}).show())},clickEditListaAttesa:function(){var b=
this,c=trovaRecord(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].storeVideateGen,"codVideata","EditServizi").get("permesso");if(c){var d=b.readExtraRecRicovero(3);b.cerca=b.loadGridRicerca;b.Ricerca={};b.Ricerca.controller=b;b.Ricerca.cbaConfig={caricaDatiUtente:Ext.emptyFn};b.recListaAttesa=null;Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/ricoveri/get",params:{idRicovero:d},async:!1,success:function(f){f=Ext.JSON.decode(f.responseText);f.success?(currRicovero=f.data,Ext.create("winCBA",
{permesso:c,name:"GeneraliOSP.portlet.view.ListaAttesa",titolo:"WIZARD_LISTA_ATTESA",nominativo:b.recOspite.get("nominativo"),altezzaWin:700,larghezzaWin:1024,configItem:{codOspite:b.recOspite.get("codOspite"),idRicovero:d,idRecord:b.readExtraRecRicovero(1),controllerFascicolo:b,nuovo:!1,permesso:c,ricerca:b.Ricerca,classificazionePresente:null,EditDatiAggiuntivi:null},listeners:{beforeclose:function(c){var d=c.config.configItem.recListaAttesa;c.config.configItem.idRecord&&c.config.configItem.idRecord!=
d.id&&(msgShowError("",traduci("WIZARD_LISTA_ATTESA")+": riselezionare ListaAttesa/Servizio"),b.getRicovero().clearValue());d?b.fillPrenotazione(d):msgShowError("","Selezionare almeno una Lista Attesa ")},close:function(c){b.loadStoreEvent(b.recOspite)}}}).show()):msgShowError("",f.message)}})}},fillPrenotazione:function(b){this.ggPrognosi=b.get("ggPrognosi");b=this.getRicovero().getSelectedRecord().get("date");var c=this.ggPrognosi&&b?moment(b).add("days",this.ggPrognosi).toDate():b;this.getFldDatiPrenot().setDisabled(!1);
this.getBtnLettiLiberi().setDisabled(!1);this.getDataDal().setValue(b);this.getDataAl().setValue(c)},clickNuovo:function(b){var c=this;Ext.isDefined(c.cbaConfig.nuovo)||(c.cbaConfig.nuovo=!0);c.cerca=c.loadGridRicerca;c.Ricerca={};c.Ricerca.controller=c;c.Ricerca.cbaConfig={caricaDatiUtente:Ext.emptyFn};c.cbaConfig.clickNuovo?c.cbaConfig.clickNuovo(b):c.permissionToOpenAnag()?Ext.create("winCBA",{permesso:c.cbaConfig.permesso,name:"GeneraliOSP.fascicoloNoApp.view.EditFascicolo",titolo:"TITOLO_NUOVO_UTENTE",
altezzaWin:700,larghezzaWin:1024,configItem:{controllerFascicolo:c,showTabAggiuntivi:!0,permesso:c.cbaConfig.permesso,nuovo:c.cbaConfig.nuovo,recordIntegrazione:b,desVideata:traduci("ANAGRAFICA")},listeners:{close:function(b){c.getAttivi().setValue("T");c.getSenzaServizi().setValue("F");c.getNonAttivi().setValue("F");c.loadGridRicerca()}}}).show():Messaggio("ATTENZIONE","MSG_NO_PERMESSI_EDIT_ANAG","OK","INFO")},permissionToOpenAnag:function(){var b=!1,c=trovaRecord(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].storeVideateGen,
"codVideata","OSP_Anagrafica").get("permesso"),d=trovaRecord(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].storeVideateGen,"codVideata","EditServizi").get("permesso");"S"==c&&"S"==d&&(b=!0);return b},impostaSRSL_daLettiLiberi:function(b){var c={};this.loadCbSRSL(this.getEditResSede(),c,b.idSede);Ext.apply(c,{sede:b.idSede});this.loadCbSRSL(this.getEditResReparto(),c,b.idReparto);Ext.apply(c,{reparto:b.idReparto});this.loadCbSRSL(this.getEditResStanza(),c,b.idStanza);Ext.apply(c,{stanza:b.idStanza});
this.loadCbSRSL(this.getEditResLetto(),c,b.idLetto)},onBtnLettiLiberiClick:function(){var b=this,c=new Date;null!=b.getDataDal().getValue()&&(c=b.getDataDal().getValue());if(b.abilitaGestioneOraria){var d=moment(b.getEditResOraDal().getValue()),c=moment(c);c.set("hour",d.get("hour"));c.set("minute",d.get("minute"));c=c.toDate()}StdUtenti.apriWindowLettiLiberi({permesso:b.cbaConfig.permesso,ggDecorrenza:c,formatoData:b.abilitaGestioneOraria?"d/m/Y H:i":"d/m/Y",usaDataDimPrev:"T",cb_salva:function(c){b.impostaSRSL_daLettiLiberi({idSede:c.idSede,
idReparto:c.idReparto,idStanza:c.idStanza,idLetto:c.idLetto})}})},onButtonClickAnnulla:function(){boxBottoni=this.getBoxBottoni();this.getCntCercaOspite().setHidden(!1);this.getCntEvent().setHidden(!0);this.getGridRicerca().getSelectionModel().deselectAll();this.getGridRicerca().down("#RicercaNome").setValue(null);boxBottoni.queryById("btnConferma").setDisabled(!1)},onEditDataDalSelect:function(b){0<b.value&&null!=this.ggPrognosi&&(b=b.value,b=this.ggPrognosi&&b?moment(b).add("days",this.ggPrognosi).toDate():
b,this.getDataAl().setValue(b))},onEditResStanzaSelect:function(b,c,d){SvuotaCombo(this.getEditResLetto());0<b.value&&this.loadCbSRSL(this.getEditResLetto(),{sede:this.getEditResSede().getValue(),reparto:this.getEditResReparto().getValue(),stanza:b.value})},onEditResRepartoSelect:function(b,c,d){SvuotaCombo(this.getEditResStanza());SvuotaCombo(this.getEditResLetto());0<b.value&&0<this.getEditResSede().getValue()&&this.loadCbSRSL(this.getEditResStanza(),{sede:this.getEditResSede().getValue(),reparto:b.value,
tipologia:"UB"})},onEditResSedeSelect:function(b,c,d){SvuotaCombo(this.getEditResReparto());SvuotaCombo(this.getEditResStanza());SvuotaCombo(this.getEditResLetto());0<b.value&&this.loadCbSRSL(this.getEditResReparto(),{sede:b.value,tipologia:"UB"})},loadCbSRSL:function(b,c,d){var f=b.getStore();c&&(f.getProxy().extraParams=c);f.load({callback:function(c,f,k){c&&(1==c.length||d)&&(d?b.setValue(d):(b.setValue(c[0].get("codice")),b.fireEvent("select",b)))}})},loadGridRicerca:function(b){var c=this.getGridRicerca(),
d=parseInt(dataAttuale("m")),f=parseInt(dataAttuale("Y"));b=creaData(1,d,f);d=dataFineMese(d,f);c=c.getStore();ImpostaUrl([c]);c.load({params:{tipoServizio:"L",dataDal:b,dataAl:d,attivi:getBoolValue(this.getAttivi().getValue()),nonAttivi:getBoolValue(this.getNonAttivi().getValue()),senzaServizi:getBoolValue(this.getSenzaServizi().getValue()),maxResults:50,pensioni:"F",distinct:"T",servizio:0,classRetta:0,sede:0,reparto:0},callback:function(b,c,d){d||msgShowError("",c.getError())}})},loadStoreEvent:function(b){var c=
this,d=c.getRicovero(),f=d.getStore();ImpostaUrl([f]);f.load({params:{codOspite:b.get("codOspite"),idOrg:getIdOrg(),dataDal:new Date,dataAl:new Date,tipoServizio:48==CBA.moduli.moduloAttivo?"L":null},callback:function(b,f,k){k?0==b.length?c.impostaLabel("S0"):b&&1==b.length?(c.impostaLabel("L"),b=b[0],d.select(b),d.fireEvent("select",d,b)):c.impostaLabel("S"):msgShowError("",f.getError())}});ImpostaUrl([c.getEditResSede().getStore(),c.getEditResReparto().getStore(),c.getEditResStanza().getStore(),
c.getEditResLetto().getStore()]);c.loadCbSRSL(c.getEditResSede())},onGridRicercaSelect:function(b,c,d){b=this.getCntEvent();var f=b.down("#Nominativo");d=b.down("#AltreInfo");f.setText(c.get("nominativo"));this.recOspite=c;f=c.get("dataNascita")?traduci("DATA_NASCITA")+": "+FormattaData(c.get("dataNascita")):"";f=f+(f?"<br>":"")+(c.get("codiceFiscale")?traduci("CODICE_FISCALE")+": "+c.get("codiceFiscale"):"");d.setHtml(f);this.getCntCercaOspite().setHidden(!0);b.show();this.getRicovero().focus();
this.loadStoreEvent(c)},readExtraRecRicovero:function(b){var c=this.getRicovero().getSelection();extraField=c?c.get("extra"):null;if(null==extraField)return null;c=extraField.split("#");return 0<=b&&c.length>=b+1?c[b]:c},readEvent:function(){function b(b,c){var d=moment(b.getValue()),f=moment(c.getValue());d.set("hour",f.get("hour"));d.set("minute",f.get("minute"));d.set("second",0);d.set("millisecond",0);return d=d.toDate()}var c={},c=this.cbaConfig.scheduler.up().controller_main._PRENOTATO,d=this.getDataDal().getValue(),
f=this.getDataAl().getValue();this.abilitaGestioneOraria&&(d=b(this.getDataDal(),this.getEditResOraDal()),f=b(this.getDataAl(),this.getEditResOraAl()));c={idServizioDomanda:this.getRicovero().getValue(),idRicovero:this.readExtraRecRicovero(3),idSede:this.getEditResSede().getValue(),idReparto:this.getEditResReparto().getValue(),idStanza:this.getEditResStanza().getValue(),idLetto:this.getEditResLetto().getValue(),taskTitle:this.getNominativo().text,taskStart:d,taskEnd:f,stato:c,tipoRecord:"P",descServizio:this.getRicovero().getRawValue(),
gestioneOraria:this.abilitaGestioneOraria?"T":"F",usoSingolo:getBoolValue(this.getStanzaUsoSingolo().getValue())};Ext.apply(c,{id:-9999,resourceIdField:c.idSede+"#"+c.idReparto+"#"+c.idStanza+"#"+c.idLetto});return c},checkAddEvent:function(){var b=this.readEvent();this.cbaConfig.controller_scheduler.getScheduler().eventStore.add(b);return!0},validateField:function(){var b=[],c=this.getDataDal(),d=c.getValue(),f=this.getDataAl(),g=f.getValue();d&&g&&this.readExtraRecRicovero(3)&&this.getEditResSede().getValue()&&
this.getEditResReparto().getValue()&&this.getEditResStanza().getValue()&&this.getEditResLetto().getValue()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");c.validate();f.validate();this.getRicovero().validate();this.getEditResSede().validate();this.getEditResReparto().validate();this.getEditResStanza().validate();this.getEditResLetto().validate();d&&g&&d.getTime()>g.getTime()&&msgAddError(b,"MSG_DATADAL_MAGGIORE_DATAAL");0<b.length&&msgShow("",b);return 0===b.length},addBoxBottoni:function(){var b=this,c=
49===CBA.moduli.moduloAttivo,d=c?"controller_PannelloBottoni":"controller_PannelloBottoniVert",f=b.getBoxBottoni(),c=Ext.create("Generali.standard."+d,{cbaConfig:{conferma_callback:function(c){1==b.checkAddEvent()&&f.up("window").close()},annulla_callback:function(){},esci_callback:function(){f.up("window").close()},verificaCampiForm_callback:function(){return b.validateField()},personIcons:c?getIconButtons():null}});inserisciBottoni(f,c);f.queryById("btnNuovo").hide();f.queryById("btnElimina").hide();
f.queryById("btnAnnulla").hide();f.queryById("btnConferma").setDisabled(!1);f.queryById("btnEsci").setDisabled(!1)},onLaunch:function(){this.addBoxBottoni();this.loadGridRicerca()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.booking.controller.Main",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this._PRENOTATO="P";this._CONFERMATO="C";this._ELIMINATO="D";this.callParent(arguments);this.addRef([{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"}])},key_local_storage:"idOrg"+CBA.parametriGenerali.idOrganizzazione+"_Modulo"+CBA.moduli.moduloAttivo+"_operatore"+CBA.parametriGenerali.codUtente+"_SRSBooking",paramsScheduler:{dataDal:new Date,
rangeDay:7,listReparti:"",regoleRaccordi:CBA.moduli.modulo49.installato?"T":"F",idOrg:getIdOrg(),limit:0},readLS:function(){var b=localStorage.getItem(this.key_local_storage);b&&Ext.apply(this.paramsScheduler,{listReparti:b});return b?b:null},loadData:function(){},onLaunch:function(){this.readLS();this.scheduler=Ext.create("GeneraliOSP.booking.view.Scheduler",{controller_main:this,flex:1});this.toolBar=Ext.create("GeneraliOSP.booking.view.Toolbar",{controller_main:this,controller_scheduler:this.scheduler.controller});
ImpostaUrl([this.scheduler.eventStore,this.scheduler.resourceStore]);this.getCntPrincipale().add([this.toolBar,this.scheduler])},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.booking.controller.SceltaCartella",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"CbTipCartella",selector:this.selContainer+"#CbTipCartella"}]);this.control(this.selContainer+"#CbTipCartella",{select:this.selectCbTipCartella});this.callParent(arguments)},selectCbTipCartella:function(b,c,d){this.cbaConfig.idTipCartella=b.value;this.cbaConfig.recSelectedCss=c;this.view.up().close()},onLaunch:function(){var b=
this.getCbTipCartella(),c=b.getStore();this.controller=this;c.loadData(this.cbaConfig.regoleRaccordi);b.validate()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.booking.controller.Scheduler",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Scheduler",selector:this.selContainer+"#Scheduler"}]);this.control(this.selContainer+"#BtnConfermaEvento",{click:this.clickBtnConfermaEvento})},updateEvent:function(b,c){if("D"==c.stato&&0>b.data.id)this.getScheduler().eventStore.remove(b);else if("C"==c.stato&&CBA.moduli.modulo49.installato&&b.get("regoleRaccordi")){var d=
b.get("regoleRaccordi").length;0==d?b.set(c):1==d?(c.idTipCartella=b.get("regoleRaccordi")[0].idEsterno,c.idRegolaRaccordo=b.get("regoleRaccordi")[0].idPadre,b.set(c)):1<d&&this.scegliTipologiaCartella(b,c)}else b.set(c)},scegliTipologiaCartella:function(b,c){var d=Ext.create("winCBA",{name:"GeneraliOSP.booking.view.SceltaCartella",titolo:traduci("RACCORDO_CSS")+" - "+b.get("taskTitle"),altezzaWin:70,larghezzaWin:300,closable:!1,configItem:{labelCmb:traduci("RACCORDO_CSS")+" - "+b.get("taskTitle"),
regoleRaccordi:b.get("regoleRaccordi")}});this.winSceltaCartella=d;d.show();d.on("close",function(d){if(d=this.config.configItem.recSelectedCss)c.idTipCartella=d.get("idEsterno"),c.idRegolaRaccordo=d.get("idPadre");b.set(c)})},aggiornaStore:function(){var b=this.getScheduler(),c=this.controller_main;c.readLS();var d=this.controller_main.paramsScheduler;b.resourceStore.load({params:d,callback:function(b,d,h){var f=c.multiSede=null;Ext.each(b,function(b){null==c.multiSede&&(c.multiSede=!1,f=b.data.idSede);
f!=b.data.idSede&&(c.multiSede=!0)})}});b.eventStore.load({params:d,callback:function(b,c,d){}})},onLaunch:function(){var b=this.getScheduler();ImpostaUrl([b.resourceStore,b.eventStore]);this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.booking.controller.Toolbar",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"RangePeriodo",selector:this.selContainer+"#RangePeriodo"},{ref:"CBServizio",selector:this.selContainer+"#CBServizio"},{ref:"CntSedeRepStanza",selector:this.selContainer+"#CntSedeRepStanza"},{ref:"RegimeRicovero",selector:this.selContainer+"#RegimeRicovero"},{ref:"BtnCerca",selector:this.selContainer+"#BtnCerca"},{ref:"BtnAdd",
selector:this.selContainer+"#BtnAdd"},{ref:"BtnSave",selector:this.selContainer+"#BtnSave"},{ref:"BtnCancel",selector:this.selContainer+"#BtnCancel"},{ref:"LblInModifica",selector:this.selContainer+"#LblInModifica"},{ref:"TxtFilterEvent",selector:this.selContainer+"#TxtFilterEvent"}]);this.control(this.selContainer+"#CBServizio",{change:this.changeCBServizio});this.control(this.selContainer+"#BtnAdd",{click:this.clickBtnAdd});this.control(this.selContainer+"#BtnCerca",{click:this.clickBtnCancel});
this.control(this.selContainer+"#BtnCancel",{click:this.clickBtnCancel});this.control(this.selContainer+"#BtnSave",{click:this.clickBtnSave});this.callParent(arguments)},abilitaToolBarCmp:function(b){this.getRangePeriodo().setDisabled(!b);this.getCntSedeRepStanza().setDisabled(!b);this.getLblInModifica().setHidden(b)},clickBtnCancel:function(){this.abilitaToolBarCmp(!0);this.controller_scheduler.aggiornaStore()},clickBtnSave:function(){this.abilitaToolBarCmp(!0);this.crudManager.sync()},salvaForzato:function(b,
c,d){var f=this,g=this.controller_scheduler.getScheduler();Ext.Ajax.request({method:"POST",jsonData:Ext.JSON.encode(b),url:getUrlGen()+"/ws/genOsp/booking/save",params:{forceStore:d,checkGestioneOrariaServizio:!0},success:function(d){d=Ext.JSON.decode(d.responseText);var h=d.message;d.success?(0<c.length?f.salvaConfermati(c,function(){g.aggiornaStore()}):g.aggiornaStore(),msgShowText("",h)):h&&h[0].testo.includes("?")?(d=h[0].testo.replaceAll("?S","S"),d=d.replaceAll("?P","P"),Messaggio("ATTENZIONE",
d,"YESNO","QUESTION",!1,function(){f.salvaForzato(b,c,!0)})):h&&"$"==h[0]?(h=h.testo(1),msgShowError("",h)):msgShowError("","Errore salvataggio non ben specificato")},failure:function(b){b.result?msgShowError("",b.result.message):msgShowError("","Errore server non gestito")}})},salvaConfermati:function(b,c){var d=[],f={me:this,callback:c};Ext.each(b,function(b){var c=moment(b.taskStart);0==c.get("hour")&&(c.set("hour",9),c.set("minute",0),c.set("second",0));Ext.Ajax.request({method:"GET",url:getUrlGen()+
"/ws/listaAttesa/lista/search",params:{idRicovero:b.idRicovero,regoleRaccordi:CBA.moduli.modulo49.installato?"T":"F"},async:!1,success:function(f){f=Ext.JSON.decode(f.responseText);f.success?f.data[0]&&(f=f.data[0],f.dataAggPun=new Date(f.dataAggPun),f.dataDom=new Date(f.dataDom),f.dataIngresso=new Date(c),f.dataNascita=new Date(f.dataNascita),f.dataRichiesta=new Date(f.dataRichiesta),f.dataRicezioneRichiesta=new Date(f.dataRicezioneRichiesta),f.idTipCartella=b.idTipCartella,f.idRegolaRaccordo=b.idRegolaRaccordo,
f.listaSedi=[],f.listaSedi.push({idStanzeBooking:b.id}),d.push({data:f})):msgShowError("",f.message)}})});Messaggio("CONFERMA","MSG_ELABORA_UT_SEL_BOOKING","YESNO","QUESTION",null,function(){var b;b=LA_preparaDatiPassaggio(d,f);LA_elaboraPassaggio(b,null,f)})},addEventToolBar:function(b){this.controller_scheduler.getScheduler()},clickBtnAdd:function(){var b=Ext.create("winCBA",{name:"GeneraliOSP.booking.view.Event",titolo:"PRENOTAZIONE",dimensione:3,configItem:{permesso:"S",scheduler:this.controller_scheduler.getScheduler(),
controller_scheduler:this.controller_scheduler},closable:!0});b.show();b.on("close",function(b){})},changeCBServizio:function(b,c){var d=this.getRegimeRicovero(),f=d.getStore();d.clearValue();c&&f.load({params:{idServizio:c,scheda:"V",domanda:110}})},changePeriodo:function(b,c){var d=this.controller_scheduler.getScheduler(),f=moment(c).diff(moment(b),"days");d.setStartDate(b);d.setEndDate(moment(c).endOf("day").toDate());Ext.apply(this.controller_main.paramsScheduler,{dataDal:b,rangeDay:f,idOrg:getIdOrg()});
d.aggiornaStore()},setCrudmanager:function(){var b=this,c=b.controller_scheduler.getScheduler(),c=new Sch.data.CrudManager({autoLoad:!0,resourceStore:c.resourceStore,eventStore:c.eventStore,writeAllFields:!0,transport:{load:{url:getUrlGen()+"/ws/genOsp/booking/listResBusy"}}});c.on("haschanges",function(c,f,g){b.abilitaToolBarCmp(!1)});c.on("beforesync",function(c,f,g){b.abilitaToolBarCmp(!0);var d=[],k=[];f.events.added&&f.events.added.forEach(function(b){delete b.$PhantomId;delete b.Cls;var c=b.resourceIdField.split("#");
b.idSede=c[0];b.idReparto=c[1];b.idStanza=c[2];b.idLetto=c[3];d.push(b)});f.events.updated&&f.events.updated.forEach(function(b){delete b.Cls;var c=b.resourceIdField.split("#");b.idSede=c[0];b.idReparto=c[1];b.idStanza=c[2];b.idLetto=c[3];"C"==b.stato?k.push(b):d.push(b)});delete f.events;delete f.requestId;delete f.revision;delete f.type;c=Ext.JSON.encode(d);Ext.apply(f,c);b.salvaForzato(d,k,!1);return!1});b.crudManager=c},onLaunch:function(){var b=this.controller_scheduler.getScheduler();this.getRangePeriodo().changePeriodo=
this.changePeriodo.bind(this);this.getTxtFilterEvent().store=b.eventStore;var b=this.getCBServizio().getStore(),c=this.getRegimeRicovero().getStore(),d=this.getCntSedeRepStanza();ImpostaUrl([b,c]);b.load();d.add(Ext.create("GeneraliOSP.sedeRepStanza.view.SedeRepStanza",{cbaConfig:{nameStore:"GeneraliOSP.store.SedeReparto",key_local_storage:"idOrg"+CBA.parametriGenerali.idOrganizzazione+"_Modulo"+CBA.moduli.moduloAttivo+"_operatore"+CBA.parametriGenerali.codUtente+"_SRSBooking",ctrlUp:this,persMaxWidth:450,
persWidth:450}}));this.setCrudmanager()},onChangeTag:function(){this.controller_scheduler.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.booking.model.Event",{extend:"Sch.model.Event",resourceIdField:"resourceIdField",startDateField:"taskStart",endDateField:"taskEnd",nameField:"taskTitle",fields:[{name:"IconCls"},{name:"id"},{name:"resourceIdField"},{name:"taskTitle"},{name:"sesso"},{name:"taskStart",type:"date"},{name:"taskEnd",type:"date"},{name:"stato"},{name:"noteStanza"},{name:"idSede"},{name:"idReparto"},{name:"idStanza"},{name:"idLetto"},{name:"idRiferimento"},{name:"idRicovero"},{name:"idServizio"},
{name:"descServizio"},{name:"desStanza"},{name:"desLetto"},{name:"tipoMov"},{name:"statoMov"},{name:"codFisc"},{name:"dataNascita",type:"date"},{name:"dataAccessoPrev",type:"date"},{name:"giorniPrognosi"},{name:"regimeRicovero"},{name:"onereDegenza"},{name:"medico"},{name:"ricDal",type:"date"},{name:"ricAl",type:"date"},{name:"idLaRegoleNew"},{name:"idServizioDomanda"},{name:"idTipCartella"},{name:"idRegolaRaccordo"},{name:"gestioneOraria"},{name:"usoSingolo"}]});
Ext.define("GeneraliOSP.booking.model.Resource",{extend:"Sch.model.Resource",idProperty:"id",nameField:"name",fields:[{name:"id",name:"idStanza"},{name:"idStanza"},{name:"idLetto"},{name:"desReparto"},{name:"desStanza"},{name:"desLetto"},{name:"regoleRaccordi"},{name:"idServizioDomanda"},{name:"sortKey",convert:function(b,c){return c.get("desReparto")+"#"+c.get("desStanza")+"#"+c.get("desLetto")}}]});
Ext.define("GeneraliOSP.booking.store.Event",{groupField:"idStanza",sorters:["idSede","idReparto","idStanza","id"],extend:"Sch.data.EventStore",model:"GeneraliOSP.booking.model.Event",proxy:{type:"ajax",urlGen:"/ws/genOsp/booking/listResBusy",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/osp/co/ws/genOsp/booking/listResBusy",create:"",update:"",destroy:""}},autoDestroy:!0,autoLoad:!1});
Ext.define("GeneraliOSP.booking.store.Resource",{extend:"Sch.data.ResourceStore",model:"GeneraliOSP.booking.model.Resource",sorters:["desReparto","desStanza","desLetto"],groupField:"desReparto",proxy:{type:"ajax",urlGen:"/ws/genOsp/booking/listResource",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/osp/co/ws/genOsp/booking/listResource",create:"",update:"",destroy:""}},autoDestroy:!0,autoLoad:!1});
Ext.define("GeneraliOSP.booking.view.Event",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"panel",itemId:"PnlAdd",reference:"PnlAdd",border:0,autoScroll:!0,flex:1,bodyPadding:10,layout:{type:"hbox"},dockedItems:[{xtype:"toolbar",dock:"right",height:50,items:[{xtype:"panel",region:"east",itemId:"BoxBottoni",reference:"BoxBottoni",width:120,title:""}]}],items:[{xtype:"container",flex:1,layout:{type:"hbox"},
items:[{xtype:"container",itemId:"CntCercaOspite",reference:"CntCercaOspite",layout:{type:"vbox"},flex:1,items:[{xtype:"gridpanel",border:0,flex:1,width:250,itemId:"GridRicerca",reference:"GridRicerca",cbaPaged:!0,store:Ext.create("GeneraliOSP.cercaFascicolo.store.Utenti",{autoLoad:!1}),columns:[{xtype:"gridcolumn",dataIndex:"nominativo",text:"RISRIC_NOMINATIVO",flex:1,renderer:function(b,d,f,g,h,k,l){g=f.get("dataNascita")?traduci("DATA_NASCITA")+":"+FormattaData(f.get("dataNascita")):"";g=g+(g?
" <BR> ":"")+(f.get("codiceFiscale")?traduci("CODICE_FISCALE")+":"+f.get("codiceFiscale"):"");d.style="text-align:left !important";""!=g&&null!=g&&(d.tdAttr='data-qtip="'+g+'"');return b}},{xtype:"datecolumn",width:70,align:"center",dataIndex:"dataNascita",text:"DATA_NASCITA",format:"d/m/Y"}],viewConfig:{getRowClass:function(b,d,f,g){if(!1===b.get("attivo"))return"non_attivi"},border:0,loadMask:!1},selModel:Ext.create("Ext.selection.RowModel",{}),dockedItems:[{xtype:"toolbar",dock:"top",itemId:"TBRicerca",
reference:"TBRicerca",items:[{xtype:"cercaGrid",minChars:3,flex:1,labelAlign:"top",fieldLabel:"RIC_NOME",itemId:"RicercaNome",reference:"RicercaNome",cbaConfig:{noIcon:!0,filtroPersonalizzato:function(c,d,f){c=c.getValue();f.getProxy().extraParams={cognome:c?c:""};b.getController().loadGridRicerca()}}},{margin:"0 0 0 0",xtype:"button",cls:"btnLarge",itemId:"BtnNuovo",reference:"BtnNuovo",formBind:!0,iconCls:"nuovoutente",scale:"large",tooltip:"NUOVO_UTENTE"}]},{xtype:"panel",border:0,itemId:"PnlAttivi",
reference:"PnlAttivi",layout:{type:"hbox"},title:"",margin:"0 0 5 0",items:[{xtype:"checkboxfield",cls:"cbaLabel",itemId:"Attivi",reference:"Attivi",margin:"0 2 0 0",name:"attivi",boxLabel:"RIC_ATTIVI",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"NonAttivi",reference:"NonAttivi",margin:"0 2 0 0",name:"nonAttivi",boxLabel:"RIC_NON_ATTIVI",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"SenzaServizi",reference:"SenzaServizi",
name:"senzaServizi",boxLabel:"RIC_SENZA_SERVIZI",inputValue:"T",uncheckedValue:"F"}]}]}]},{xtype:"container",itemId:"CntEvent",reference:"CntEvent",flex:1,hidden:!0,layout:{type:"vbox"},items:[{xtype:"label",itemId:"Nominativo",reference:"Nominativo",cls:"cbaUtente"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"label",itemId:"AltreInfo",reference:"AltreInfo"},{xtype:"fieldset",title:"",margin:"0 0 0 60",height:50,width:150,border:1,items:[{xtype:"label",itemId:"LblInfo",reference:"LblInfo",
margin:"5 0 0 0 ",width:150}]}]},{xtype:"textfield",itemId:"IdRicovero",reference:"IdRicovero",hidden:!0},{xtype:"container",layout:"hbox",items:[{xtype:"combobox",itemId:"Ricovero",reference:"Ricovero",margin:"5 0 0 0",width:400,hideLabel:!0,name:"ricovero",emptyText:"SERVIZIO",displayField:"valore",queryMode:"local",queryParam:"valore",typeAhead:!0,valueField:"codice",allowBlank:!1,store:Ext.create("Generali.data.StoreCodiceValoreDate",{proxy:{url:"/cba/osp/la/ws/listaAttesa/serviziattivi/cbox"},
autoLoad:!1})},{margin:"5 0 0 5",xtype:"button",width:25,itemId:"BtnEditServiziLista",reference:"BtnEditServiziLista",iconCls:"icon-piu",tooltip:traduci("SELEZIONA")+" "+traduci("SERVIZIO")+"/"+traduci("LISTA")}]},{xtype:"fieldset",itemId:"FldDatiPrenot",reference:"FldDatiPrenot",margin:"5 0 0 0",width:400,border:0,disabled:!0,items:[{xtype:"container",layout:"hbox",margin:"5 0 0 0",items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",fieldLabel:"DAL",allowBlank:!1,width:140,labelWidth:30},
{xtype:"timefield",margin:"0 0 0 5",itemId:"editResOraDal",reference:"editResOraDal",width:130,fieldLabel:"ORA_INIZIO",labelClsExtra:"cbaLabel",labelWidth:60,name:"oraDal",format:"H:i",increment:30,hidden:!0,cls:"x-item-disabled"}]},{xtype:"container",layout:"hbox",margin:"5 0 0 0",items:[{xtype:"datefield",itemId:"DataAl",reference:"DataAl",fieldLabel:"AL",allowBlank:!1,width:140,labelWidth:30},{xtype:"timefield",margin:"0 0 0 5",itemId:"editResOraAl",reference:"editResOraAl",width:130,fieldLabel:"ORA_FINE",
labelClsExtra:"cbaLabel",labelWidth:60,name:"oraAl",format:"H:i",increment:30,hidden:!0,cls:"x-item-disabled"},{xtype:"button",margin:"0 0 0 5",cls:49===CBA.moduli.moduloAttivo?"cbaCssBtnFunzione":"cba-button-25",itemId:"BtnLettiLiberi",reference:"BtnLettiLiberi",width:100,iconCls:"icon-lettiLiberi",text:"LETTI_LIBERI"}]},{xtype:"container",itemId:"CntSedeRepStanza",reference:"CntSedeRepStanza",layout:"vbox",margin:"5 0 0 0",items:[{xtype:"combobox",itemId:"EditResSede",reference:"EditResSede",width:380,
fieldLabel:"SEDE",labelClsExtra:"cbaLabel",name:"idSede",allowBlank:!1,displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Sedi"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",itemId:"EditResReparto",reference:"EditResReparto",width:380,fieldLabel:"REPARTO",labelClsExtra:"cbaLabel",name:"idReparto",allowBlank:!1,displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Reparti"),
valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",itemId:"EditResStanza",reference:"EditResStanza",width:380,fieldLabel:"STANZA",allowBlank:!1,labelClsExtra:"cbaLabel",name:"idStanza",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Stanze"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"container",itemId:"CntLetto",reference:"CntLetto",layout:"hbox",margin:"0 0 5 0",
items:[{xtype:"combobox",itemId:"EditResLetto",reference:"EditResLetto",width:200,fieldLabel:"LETTO",allowBlank:!1,labelClsExtra:"cbaLabel",name:"idLetto",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Letti"),valueField:"codice",matchFieldWidth:!1,listConfig:{width:300},listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"StanzaUsoSingolo",reference:"StanzaUsoSingolo",margin:"0 0 0 40",name:"usoSingolo",
fieldLabel:"STANZA_USO_SINGOLO",labelClsExtra:"cbaLabel",labelWidth:115,inputValue:"T",uncheckedValue:"F"}]}]}]}]}]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.booking.view.FilterText",{extend:"Ext.form.TextField",enableKeyEvents:!0,store:null,property:"",triggers:{clear:{cls:"x-form-clear-trigger",handler:function(){this.filter("")},scope:"this"}},onKeyUp:function(b){var c=this.getValue().toLowerCase();this.filter(b.getKey()===b.ESC?"":c)},filter:function(b){var c=this.store;b?c.filter([{property:this.property,value:b,anyMatch:!0}]):(c.clearFilter(),this.setValue(""))},listeners:{keyup:"onKeyUp",buffer:200}});
Ext.define("GeneraliOSP.booking.view.Main",{extend:"CbaUtils.componenti.all.PanelAttivaFunzioniCBA",messaggioAttivazione:"MSG_ATTIVAZIONE_BOOKING",nomeFunzioneDaAttivare:"Booking",codiceFunzione:"CU_BOOKING",uses:["Generali.standard.stampe.Button"],initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntPrincipale",reference:"CntPrincipale",layout:{type:"vbox",align:"stretch"},items:[]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.booking.view.SceltaCartella",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"combobox",itemId:"CbTipCartella",reference:"CbTipCartella",store:Ext.create("Ext.data.Store"),displayField:"descIdEsterno",valueField:"idEsterno",allowBlank:!1,queryMode:"local"}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.booking.view.Scheduler",{extend:"Generali.standard.ControlledContainer",requires:["CbaExtUtils.scheduler.SchedulerGrid","CbaExtUtils.scheduler.plugin.EventTools"],initComponent:function(){var b=this,c=new Date;b._COLOR_FEMALE="#FFC0CB";b._COLOR_MALE="#ADD8E6";b._COLOR_CU2="#DBCFE8";Ext.applyIf(b,{items:[{xtype:"CbaSchedulerGrid",itemId:"Scheduler",reference:"Scheduler",startDate:c,endDate:Sch.util.Date.add(c,Sch.util.Date.DAY,6),enableDragCreation:!1,highlightWeekends:!0,viewPreset:{timeColumnWidth:50,
rowHeight:28,resourceColumnWidth:100,displayDateFormat:"d-m-Y H:i:s",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",align:"center",dateFormat:"D d"},top:{unit:"WEEK",align:"center",renderer:function(b,c,g){return Sch.util.Date.getShortNameOfUnit("WEEK")+"."+Ext.Date.format(b,"W M Y")}}}},columns:[{header:"Stanza",width:100,dataIndex:"idStanza",hidden:!0},{header:"STANZA",dataIndex:"desStanza",renderer:function(b,c,g,h,k,l,n){return g.get("desStanza")?
g.get("desStanza"):"idS:"+g.get("idStanza")}},{header:"LETTO",dataIndex:"desLetto",renderer:function(b,c,g,h,k,l,n){return g.get("desLetto")?g.get("desLetto"):"idL:"+g.get("desLetto")}},{header:"STANZA_LETTO",width:150,hidden:!0,dataIndex:"id",renderer:function(b,c,g,h,k,l,n){b=g.get("desStanza")?g.get("desStanza"):"idS:"+g.get("idStanza");if(g.get("desLetto")||g.get("idLetto"))b+=" - "+(g.get("desLetto")?g.get("desLetto"):"idL:"+g.get("idLetto"));return b}}],resourceStore:Ext.create("GeneraliOSP.booking.store.Resource"),
eventStore:Ext.create("GeneraliOSP.booking.store.Event"),eventRenderer:function(c,f,g,h,k,l){f="";k="F"==c.get("sesso")?"PURPLE":"#34568B";"U"==c.get("tipoRecord")||"R"==c.get("tipoRecord")?f=b._COLOR_CU2:"P"==c.get("stato")?f="#ffe680":"C"==c.get("stato")?f="#d2efcc":"D"==c.get("stato")&&(f="#c7c7c7",k="BLACK");h="F"==c.get("sesso")?b._COLOR_FEMALE:"M"==c.get("sesso")?b._COLOR_MALE:f;g.style="background-color: "+f+"; color: "+k+"; border-color: "+f+"; border-bottom-color: "+h+"; border-bottom-width: 0px";
f=moment(c.get("taskEnd")).diff(moment(c.get("taskStart")),"days");g="R"==c.get("tipoRecord")?"icon-accompany":"F"==c.get("sesso")?"icon-female":"icon-male";h=this.grid.ownerGrid;l=moment(h.getEndDate()).diff(moment(h.getStartDate()),"days");h=c.get("taskTitle");k="T"==c.get("usoSingolo")?"S":"";if(15<l)switch(f){case 1:h="";break;case 2:h=c.get("taskTitle").substring(0,6)+"..."}c=f;1E3<c&&(c="--");return'\n              <div style="display: flex; align-items: center">\n                <img style="height: 19px" class="'+
g+'" src="'+Ext.BLANK_IMAGE_URL+'"></img>\n                <span style="color: #4c4c4c; font-weight: bold; margin: 0 5px;">'+c+'</span>\n                <span style="color: #ffffff; font-style: italic; font-weight: bold; margin: 0px 8px 0px 0px;">'+k+'</span>\n                <span style="font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+h+"</span>\n              </div>"},tipCfg:{width:500},tooltipTpl:new Ext.XTemplate('\n<div>\n\t<div style="display: flex; border: 1px solid; border-color: black; align-items: center;">\n\t\t<div style="margin-left: 10px">\n\t\t\t<tpl for=".">\n\t\t\t\t<tpl>{[this.getImage(values)]}</tpl>\n\t\t\t</tpl>\n\t\t</div>\t\n\t\t<div style="margin-left: 10px; margin-bottom: 3px">\n\t\t\t<div><h3>{taskTitle}</h3></div>\n\t\t\t<div style="display: flex">\n\t\t\t\t<div style="display: flex; flex-direction: row; align-items: center; align-content: normal;">\n\t\t\t\t\t<div class="sch-tooltip-cba-label" style="width: 100px"><nobr>'+
traduci("CODICE_FISCALE")+'</nobr></div>\n\t\t\t\t\t<div class="sch-tooltip-cba-data" style="margin-left: 10px">{codFisc}</div>\n\t\t\t\t\t<div class="sch-tooltip-cba-label" style="width: 100px; margin-left: 10px">'+traduci("DATA_NASCITA")+'</div>\n\t\t\t\t\t<div class="sch-tooltip-cba-data" style="margin-left: 10px">{[this.formatDate(values, \'dataNascita\')]}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t\n\t<div style="display: flex; align-items: center; margin-top: 10px;justify-content: space-around;">\n\t\t<div style="width:250px">\n\t\t\t<div>\n\t\t\t\t<div class="sch-tooltip-cba-label">'+
traduci("SERVIZIO")+'</div>\n\t\t\t\t<div style="sch-tooltip-cba-data;text-align: center; margin-bottom: 3px">{descServizio}</div> \n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="sch-tooltip-cba-label">'+traduci("ONERE_DEGENZA")+'</div>\n\t\t\t\t<div class="sch-tooltip-cba-data" style="text-align: center; margin-bottom: 3px">{onereDegenza}</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="sch-tooltip-cba-label">'+traduci("REGIME_RICOVERO")+'</div> \n\t\t\t\t<div class="sch-tooltip-cba-data" style="text-align: center; margin-bottom: 3px">{regimeRicovero}</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="sch-tooltip-cba-label">'+
traduci("STATO")+'</div>\n\t\t\t\t<div style="sch-tooltip-cba-data;text-align: center; margin-bottom: 3px">{[this.getStato(values)]}</div>       \n\t\t\t</div>\n\t\t</div>  \n\t\t<div style="width: 250px; margin-left: 10px">\n\t\t\t<div>\n\t\t\t\t<div class="sch-tooltip-cba-label">'+traduci("MEDICO_MEDICINA_GEN")+'</div>\n\t\t\t\t<div style="sch-tooltip-cba-data;text-align: center; margin-bottom: 3px">{medico}</div> \n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="sch-tooltip-cba-label">'+traduci("DATA_ACCESSO_PREVISTO")+
'</div>\n\t\t\t\t<div class="sch-tooltip-cba-data" style="text-align: center; margin-bottom: 3px">{[this.formatDate(values, \'dataAccessoPrev\')]}</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="sch-tooltip-cba-label">'+traduci("GIORNI_PROGNOSI")+'</div> \n\t\t\t\t<div class="sch-tooltip-cba-data" style="text-align: center; margin-bottom: 3px">{[this.getGiorniPrognosi(values)]}</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="sch-tooltip-cba-label">'+traduci("DATA_DIMISSIONE_PREVISTA")+
'</div>\n\t\t\t\t<div style="sch-tooltip-cba-data;text-align: center; margin-bottom: 3px">{[this.formatDate(values, \'taskEnd\')]}</div>       \n\t\t\t</div>\n\t\t</div>    \n\t</div>\n\n\t<div style="display: flex;  flex-direction: column; align-items: center;justify-content: space-around;">\n\t\t<div class="sch-tooltip-cba-label">'+traduci("DIAGNOSI_INGRESSO")+'</div> \n\t\t<div style="sch-tooltip-cba-data;text-align: center; margin-bottom: 3px">{diagnosiIngresso}</div>\n\t</div>                                \n</div>',
{getImage:function(b){return'<img style="height: 40px" class="'+("R"==b.tipoRecord?"icon-accompany":"F"==b.sesso?"icon-female":"icon-male")+'" src="'+Ext.BLANK_IMAGE_URL+'"></img>'},formatDate:function(b,c){return FormattaData(b[c])},getGiorniPrognosi:function(b){return"P"==b.tipoRecord?moment(b.taskEnd).diff(moment(b.taskStart),"days"):b.giorniPrognosi},getStato:function(b){var c="";switch(b.stato){case "P":c=traduci("STATO_NON_CONFERMATO");break;case "C":c=traduci("STATO_CONFERMATO");break;case "D":c=
traduci("STATO_ELIMINATO")}return c}}),plugins:[{ptype:"cba_scheduler_eventtools",items:[{text:"ACCETTA",iconCls:"icon-conferma",itemId:"BtnConfermaEvento",reference:"BtnConfermaEvento",visibleFn:function(){var b=this.up().eventRecord,c=0>b.get("id");return!("U"==b.get("tipoRecord")||"R"==b.get("tipoRecord"))&&"C"!=b.get("stato")&&!c},listeners:{click:function(){var c=this.up();c.hide();b.controller.updateEvent(c.eventRecord,{stato:"C"})}}},{text:"ELIMINA",iconCls:"icon-elimina",visibleFn:function(){var b=
this.up().eventRecord,c="U"==b.get("tipoRecord")||"R"==b.get("tipoRecord");return"D"!=b.get("stato")&&!c},listeners:{click:function(){var c=this.up();c.hide();b.controller.updateEvent(c.eventRecord,{stato:"D"})}}},{text:"RIPRISTINA",iconCls:"icon-annulla",visibleFn:function(){var b=this.up().eventRecord,c="U"==b.get("tipoRecord")||"R"==b.get("tipoRecord");return"P"!=b.get("stato")&&!c},listeners:{click:function(){var c=this.up();c.hide();b.controller.updateEvent(c.eventRecord,{stato:"P"})}}}]}],features:[{ftype:"scheduler_grouping",
autoEl:{"data-qtip":"aaa"},groupHeaderTpl:new Ext.XTemplate("<div>{[this.getHeader(values)]}</div>",{getHeader:function(c){var d="";0<c.rows.length&&(d=c.rows[0].get("desReparto"),b.controller_main.multiSede&&(c=" ("+c.rows[0].get("desSede")+")",d+=c,25<d.length&&(d=d.substring(0,20)+"...")));return d}}),hideGroupedHeader:!0,enableGroupingMenu:!1}],listeners:{beforeeventdrag:function(c,f){var d=f.get("stato")==b.controller_main._PRENOTATO&&"P"==f.get("tipoRecord");d||msgShowWarning("ATTENZIONE","MSG_NON_CONSENTITO");
return d}}}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.booking.view.Toolbar",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"toolbar",items:[{xtype:"combobox",margin:"0 5 0 0",labelAlign:"top",labelClsExtra:"cbaLabel",fieldLabel:"SERVIZIO",itemId:"CBServizio",reference:"CBServizio",emptyText:"SERVIZIO",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.TipoServizio"),typeAhead:!0,valueField:"codice",allowBlank:!1,flex:1,hidden:!0},
{xtype:"container",itemId:"CntSedeRepStanza",reference:"CntSedeRepStanza",width:450},{xtype:"combobox",itemId:"RegimeRicovero",reference:"RegimeRicovero",fieldLabel:"REGIME_RICOVERO",labelAlign:"top",labelClsExtra:"cbaLabel",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.RegimeRicovero"),valueField:"codice",hidden:!0,flex:1},{xtype:"rangePeriodo",itemId:"RangePeriodo",reference:"RangePeriodo"},{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",
flex:1,layout:{type:"hbox"},items:[{xtype:"button",text:"NUOVO",itemId:"BtnAdd",reference:"BtnAdd",iconCls:"icon-inserisci"},{xtype:"button",text:"CONFERMA",itemId:"BtnSave",reference:"BtnSave",iconCls:"icon-conferma"},{xtype:"button",text:"RIPRISTINA",itemId:"BtnCancel",reference:"BtnCancel",iconCls:"icon-annulla"}]},{xtype:"label",itemId:"LblInModifica",reference:"LblInModifica",html:'<font style="color:red">'+traduci("MSG_MODIFICHE_DA_CONFERMARE_BOOKING")+"</font>",margin:"5 0 0 5",cls:"cbaLabel",
hidden:!0}]},Ext.create("GeneraliOSP.booking.view.FilterText",{itemId:"TxtFilterEvent",reference:"TxtFilterEvent",emptyText:traduci("UTENTE")+"...",property:"taskTitle"})]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.cercaFascicolo.controller.Cerca",{extend:"Generali.standard.ViewController",uses:["GeneraliOSP.integrazioni.AnagraficaSearchUtils"],init:function(){var b=this,c=this,d="#"+c.containerId+" ";c.callParent(arguments);c.addRef([{ref:"ParametriRicerca",selector:d+"#ParametriRicerca"},{ref:"Form",selector:d+"#Form"},{ref:"Cognome",selector:d+"#Cognome"},{ref:"RisultatiRicerca",selector:d+"#RisultatiRicerca"},{ref:"Servizio",selector:d+"#Servizio"},{ref:"Classificazione",selector:d+
"#Classificazione"},{ref:"Sede",selector:d+"#Sede"},{ref:"Reparto",selector:d+"#Reparto"},{ref:"DataDal",selector:d+"#DataDal"},{ref:"DataAl",selector:d+"#DataAl"},{ref:"Anno",selector:d+"#Anno"},{ref:"Mese",selector:d+"#Mese"},{ref:"Attivi",selector:d+"#Attivi"},{ref:"NonAttivi",selector:d+"#NonAttivi"},{ref:"SenzaServizi",selector:d+"#SenzaServizi"},{ref:"GridRicerca",selector:d+"#GridRicerca"},{ref:"BtnCerca",selector:d+"#BtnCerca"},{ref:"FsAvanzate",selector:d+"#FsAvanzate"},{ref:"BtnNuovo",selector:d+
"#BtnNuovo"},{ref:"PnlAttivi",selector:d+"#PnlAttivi"},{ref:"BtnSeleziona",selector:d+"#BtnSeleziona"},{ref:"BtnEsci",selector:d+"#BtnEsci"},{ref:"ColServizio",selector:d+"#ColServizio"},{ref:"PnlAvanzate",selector:d+"#PnlAvanzate"},{ref:"numFascRif",selector:d+"#numFascRif"},{ref:"pannelloRicerca",selector:d+"#pannelloRicerca"},{ref:"CtnPratica",selector:d+"#CtnPratica"},{ref:"AnnoPratica",selector:d+"#AnnoPratica"},{ref:"NPratica",selector:d+"#NPratica"}]);c.control(d+"#Form",{dirtychange:c.dirtychangeForm});
c.control(d+"#BtnCerca",{click:function(b){return c.cerca()}});c.control(d+"#Sede",{select:c.selectSede});c.control(d+"#Servizio",{select:c.selectServizio});c.control(d+"#Cognome",{change:Ext.Function.createBuffered(function(b){c.cerca();b.focus()},500,c),render:c.renderCognome});c.control(d+"#DataDal",{change:c.changeData});c.control(d+"#DataAl",{change:c.changeData});c.control(d+"#GridRicerca",{select:c._selectGridRicerca,itemdblclick:c._itemdblclickGridRicerca});c.control(d+"#Mese",{change:c.aggiornaDate});
c.control(d+"#Anno",{change:c.aggiornaDate});c.control(d+"#BtnNuovo",{click:function(){b.getView().controller.permissionToOpenAnag()?AnagraficaSearchUtils.openWinAnagrafica(c.clickNuovo.bind(b)):Messaggio("ATTENZIONE","MSG_NO_PERMESSI_EDIT_ANAG","OK","INFO")}});c.control(d+"#BtnSeleziona",{click:c.clickSeleziona});c.control(d+"#BtnEsci",{click:c.clickEsci});c.control(d+"#SenzaServizi",{change:c.changeSenzaServizi});c.control(d+"#Attivi",{change:c.controllaCheckNonAssociati});c.control(d+"#NonAttivi",
{change:c.controllaCheckNonAssociati})},changeData:function(){this.cbaConfig.changeData&&this.cbaConfig.changeData()},controllaCheckNonAssociati:function(){!this.getSenzaServizi().isVisible()||this.getAttivi().checked||this.getNonAttivi().checked?this.getSenzaServizi().setValue("F"):this.getSenzaServizi().setValue("T")},changeSenzaServizi:function(){this.getSenzaServizi().checked?(this.getAttivi().setValue("F"),this.getNonAttivi().setValue("F")):this.getAttivi().checked||this.getNonAttivi().checked||
this.getAttivi().setValue("T")},clickEsci:function(b){b.up("window").close()},clickSeleziona:function(){if(this.cbaConfig.dblclickGridRicerca){var b=this.getGridRicerca(),c=b.getSelectionModel().getSelection()[0];c&&this._itemdblclickGridRicerca(b,c)}},renderCognome:function(b){b.up("window")?Ext.Function.defer(function(){b.focus()},1E3):b.focus()},permissionToOpenAnag:function(){var b=!1,c=trovaRecord(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].storeVideateGen,"codVideata","OSP_Anagrafica").get("permesso"),
d=trovaRecord(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].storeVideateGen,"codVideata","EditServizi").get("permesso");"S"==c&&"S"==d&&(b=!0);return b},clickNuovo:function(b){this.cbaConfig.clickNuovo?this.cbaConfig.clickNuovo(b):this.permissionToOpenAnag()?Ext.create("winCBA",{permesso:this.cbaConfig.permesso,name:"GeneraliOSP.fascicoloNoApp.view.EditFascicolo",titolo:"TITOLO_NUOVO_UTENTE",altezzaWin:700,larghezzaWin:1024,configItem:{permesso:this.cbaConfig.permesso,currOspite:lastOspite,nuovo:this.cbaConfig.nuovo,
recordIntegrazione:b,desVideata:traduci("ANAGRAFICA")}}).show():Messaggio("ATTENZIONE","MSG_NO_PERMESSI_EDIT_ANAG","OK","INFO")},aggiornaDate:function(){var b=this.getAnno(),c=this.getMese(),d=48==getModuloAttivo()?parseInt(dataAttuale("d")):1;this.getDataDal().setValue(creaData(d,c.getValue(),b.getValue()));this.getDataAl().setValue(dataFineMese(c.getValue(),b.getValue()))},dirtychangeForm:function(b,c,d){this.cbaConfig.changeCampiRicerca&&this.cbaConfig.changeCampiRicerca(c)},_selectGridRicerca:function(b,
c){this._itemkeydown||(this.cbaConfig.selectGridRicerca?this.cbaConfig.selectGridRicerca(b,c):this.cbaConfig.select&&this.cbaConfig.select(b,c))},_itemdblclickGridRicerca:function(b,c){this.cbaConfig.dblclickGridRicerca&&this.cbaConfig.dblclickGridRicerca(b,c)},selectSede:function(b){b=b?b.getValue():0;var c=this.getReparto();b?c.getStore().load({params:{sede:b}}):c.setValue(b);c.setVisible(b)},selectServizio:function(b){b=b?b.getValue():0;var c=this.getClassificazione();b?c.getStore().load({params:{type:1,
idServizio:b}}):c.setValue(b);c.setVisible(b)},cerca:function(b,c){var d=this.getCognome().getValue(),f=this.getServizio().getValue(),g=this.getClassificazione().getValue(),h=this.getSede().getValue(),k=this.getReparto().getValue(),l="F";b&&b.pensioni?l=getBoolValue(b.pensioni):this.cbaConfig.pensioni&&(l=getBoolValue(this.cbaConfig.pensioni));var n="T";b&&b.tuttiServizi?n=getBoolValue(!b.distinct):this.cbaConfig.tuttiServizi&&(n=getBoolValue(!this.cbaConfig.tuttiServizi));var p=b&&b.filtroReparti?
b.filtroReparti:"";this.cbaConfig.denaro&&(p=p?p:this.view.up().up().up().controller.getCBCassa().getSelectedRecord().get("reparti"));var q="";50==getModuloAttivo()?q="A":48==getModuloAttivo()&&(q="L");d={codOspite:b&&b.codOspite?b.codOspite:null,cognome:d?d:"",dataDal:b&&b.dataDal?b.dataDal:new Date(this.getDataDal().getValue().setHours(0,0)),dataAl:b&&b.dataAl?b.dataAl:new Date(this.getDataAl().getValue().setHours(23,59)),attivi:getBoolValue(this.getAttivi().getValue()),nonAttivi:getBoolValue(this.getNonAttivi().getValue()),
senzaServizi:getBoolValue(this.getSenzaServizi().getValue()),servizio:f?f:0,classRetta:g?g:0,sede:h?h:0,reparto:k?k:0,tipoServizio:getTipiServizio(this.getServizio().selection?this.getServizio().selection.get("extra").split(",")[1]:q),pensioni:l,distinct:n,filtroReparti:p,numFascRif:this.getNumFascRif().getValue()};this.cbaConfig.denaro&&(f="F",g=null,this.getView().up().up().up().cbaConfig.cassa&&(f=this.getView().up().up().up().cbaConfig.cassa.gestMovCasse,g=this.getView().up().up().up().cbaConfig.cassa.id),
"T"==f&&Ext.apply(d,{cassa:-1*g}));this.cbaConfig.filtroPratica&&Ext.apply(d,{annoPratica:Ext.isEmpty(this.getAnnoPratica().getValue())?0:this.getAnnoPratica().getValue(),numPratica:Ext.isEmpty(this.getNPratica().getValue())?0:this.getNPratica().getValue()});this.cbaConfig.denaro||(CBA.moduli.modulo46&&Ext.apply(CBA.moduli.modulo46,{paramsCerca:this.getForm().getForm().getFieldValues()}),Ext.apply(d,{repartiOsp:this.filtroReparti}));f=this.getGridRicerca();g=f.getStore();f.cbaPaged&&Ext.apply(d,{maxResults:50});
g.cbaConfig.parametri||(g.cbaConfig.parametri={});Ext.apply(g.cbaConfig.parametri,d);svuotaStore(g);Ext.apply(f.cbaConfig.paged,{fromScroll:!1});f.cbaConfig.paged&&(Ext.apply(g.cbaConfig.parametri,{firstResult:0}),this.getPannelloRicerca().setTitle(50==getModuloAttivo()?traduci("ALUNNI"):traduci("UTENTI")));this.aggiornaStore(null,c)},aggiornaStore:function(b,c){var d=this,f=d.getGridRicerca(),g=f.getStore();Ext.Ajax.request({url:g.proxy.url,method:"GET",params:g.cbaConfig.parametri,success:function(b){b=
Ext.JSON.decode(b.responseText);if(b.success)if(b=b.data,Ext.isEmpty(b))c&&d.secondoTentativo&&(delete d.secondoTentativo,d.getNonAttivi().setValue(!0),d.cerca({codOspite:c},c));else{f.getSelectionModel().deselectAll();g.totalCount=b.length;var h;Ext.each(b,function(b){h=Ext.create(g.proxy.model.$className,b);h.set("nominativo",Ext.String.ellipsis(b.nominativo,26));g.add(h)});if(g.cbaConfig.parametri.codOspite){var l=trovaRecord(g,"codOspite",g.cbaConfig.parametri.codOspite);l&&d.getGridRicerca().getSelectionModel().select([l])}d.cbaConfig.afterLoadGridRicerca&&
(f.cbaPaged?msgShowError("","afterLoadGridRicerca non  compatibile con una griglia paginata!"):d.cbaConfig.afterLoadGridRicerca(b,d));f.cbaConfig.paged&&(0==g.cbaConfig.parametri.firstResult||Ext.isEmpty(g.cbaConfig.parametri.firstResult))?d.calcolaNumeroUtenti():f.cbaConfig.paged||(l=g.getTotalCount(),46==getModuloAttivo()&&0<g.count()&&"< MOVIMENTI CASSA >"===g.getAt(0).data.nominativo&&l--,d.getPannelloRicerca().setTitle(50==getModuloAttivo()?traduci("ALUNNI")+": "+l:traduci("UTENTI")+": "+l));
c?d.cbaConfig.callBackCerca(b,c):1==b.length&&d.getGridRicerca().getSelectionModel().select([g.getAt(0)])}else msgShowError("",b.message)}})},calcolaNumeroUtenti:function(){var b=this,c=b.getGridRicerca().getStore();Ext.apply(c.cbaConfig.parametri,{firstResult:-1,hideInizioAttesa:!0});Ext.Ajax.request({url:c.proxy.url,method:"GET",async:!0,params:c.cbaConfig.parametri,success:function(c){c=Ext.JSON.decode(c.responseText);c.success?b.getPannelloRicerca().setTitle(50==getModuloAttivo()?traduci("ALUNNI")+
": "+c.data[0].codOspite:traduci("UTENTI")+": "+c.data[0].codOspite):msgShowError("",c.message)}})},caricaStoreSedi:function(b){null==b&&(b={});this.getSede().getStore().load({params:b})},getPersonNumFascicoloAuto:function(){var b=this;Ext.isDefined(b.numFascicoloAutomatico)||Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/persgen/getbyorg",params:{idOrg:getIdOrg()},async:!1,success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){var d="F",f="";!c.data||"T"!=c.data.numFascicoloAutomatico&&
"S"!=c.data.numFascicoloAutomatico||(d=c.data.numFascicoloAutomatico,f=c.data.numFascicoloFormato);b.numFascicoloAutomatico=d;b.numFascicoloFormato=f;"S"==b.numFascicoloAutomatico?(b.getNumFascRif().setWidth(238),b.getNumFascRif().labelWidth=35,b.getNumFascRif().margin="5 auto auto auto"):(b.getNumFascRif().setWidth(85),b.getNumFascRif().labelWidth=28,b.getNumFascRif().margin="0 0 0 8")}else msgShowError("",c.message)}})},onLaunch:function(){var b=this;b.getPersonNumFascicoloAuto();b._itemkeydown=
!1;b.getParametriRicerca().controller=b;var c=b.getDataDal(),d=b.getDataAl(),f=b.getAnno(),g=b.getMese(),h=parseInt(dataAttuale("m")),k=parseInt(dataAttuale("Y")),l=48==getModuloAttivo()?parseInt(dataAttuale("d")):1;b.getPannelloRicerca().setTitle(50==getModuloAttivo()?traduci("ALUNNI"):traduci("UTENTI"));c.setValue(creaData(l,h,k));d.setValue(dataFineMese(h,k));g.setValue(h);f.setValue(k);var h=b.getGridRicerca().getStore(),k=b.getServizio().getStore(),l=b.getClassificazione().getStore(),n=b.getSede().getStore(),
p=b.getReparto().getStore();ImpostaUrl([k,l,n,p,h]);k.load({params:{type:getTipiServizio()},callback:function(c,d,f){f&&c&&0<c.length&&c.forEach(function(c){c=c.get("extra").split(",");if(!Ext.isEmpty(c)&&!Ext.isEmpty(c[1]))return b.cbaConfig.filtroPratica=!0,b.getCtnPratica().setVisible(b.cbaConfig.filtroPratica),!1})}});b.cbaConfig.denaro&&(h.getProxy().url="/cba/osp/den/ws/genOsp/users/searchOspDu");b.cbaConfig.servizio||b.cbaConfig.sede?b.getFsAvanzate().setExpanded(!0):b.getFsAvanzate().setExpanded(!1);
b.cbaConfig.nuovo&&b.getBtnNuovo().show();b.cbaConfig.seleziona&&(b.getBtnSeleziona().show(),b.getBtnEsci().show());b.cbaConfig.denaro||b.caricaStoreSedi();b.cbaConfig.annoMese&&(g.show(),f.show(),c.hide(),d.hide());b.cbaConfig.hideNumFascicolo&&b.getNumFascRif().hide();b.cbaConfig.tuttiServizi&&(b.getColServizio().dataIndex="desServizio",b.getColServizio().show());c=Sipcar.app.getController("Menu").getTabApplicativi().getActiveTab().queryById("btnRilevazioneCDI");b.cbaConfig.denaro&&b.cbaConfig.caricaParametri&&
b.cbaConfig.caricaParametri(this);b.getGridRicerca().on("beforeitemkeydown",function(){b._itemkeydown=!0});b.getGridRicerca().on("beforeitemkeydown",Ext.Function.createBuffered(function(c){b._itemkeydown=!1;b.getGridRicerca().fireEvent("select",b.getGridRicerca(),b.getGridRicerca().getSelectionModel().getSelection()[0])},500,this));55==getModuloAttivo()?(c=trovaButtonMenu("btnOSP_Anagrafica"),b.cerca({codOspite:c.cbaConfig.codOspite?c.cbaConfig.codOspite:null})):b.cbaConfig.denaro||c&&(!c||c.nonCercare)||
b.cerca();b.getClassificazione().setVisible(b.cbaConfig.filtroClassificazione);b.getSede().setVisible(b.cbaConfig.filtroSede);b.getCtnPratica().setVisible(b.cbaConfig.filtroPratica);CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi||(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi=[]);CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.FlagNonAssociati?b.getSenzaServizi().setVisible("N"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.FlagNonAssociati):(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.FlagNonAssociati=
"N",Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/permesso/videata",params:{idModulo:CBA.moduli.moduloAttivo,idVideata:"FlagNonAssociati"},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?"N"!=c.data&&(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.FlagNonAssociati="V",b.getSenzaServizi().setVisible(!0)):msgShowError("",c.message)}}))}});
Ext.define("GeneraliOSP.cercaFascicolo.model.Utenti",{extend:"Ext.data.Model",fields:[{name:"codOspite"},{name:"nominativo"},{name:"dataNascita",type:"date"},{name:"idRicovero"},{name:"attivo"},{name:"codiceFiscale"},{name:"idServizio"},{name:"desServizio"}]});Ext.define("GeneraliOSP.cercaFascicolo.store.Classificazioni",{extend:"Generali.data.StoreCodiceValoreTipo",proxy:{urlGen:"/ws/genOsp/classificazioni"},autoDestroy:!0});
Ext.define("GeneraliOSP.cercaFascicolo.store.Reparti",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/reparti/search"},autoDestroy:!0});Ext.define("GeneraliOSP.cercaFascicolo.store.Sedi",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/sedi/search"},autoDestroy:!0});Ext.define("GeneraliOSP.cercaFascicolo.store.Utenti",{extend:"Generali.data.StoreJson",model:"GeneraliOSP.cercaFascicolo.model.Utenti",proxy:{urlGen:"/ws/genOsp/users/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.cercaFascicolo.view.Cerca",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"ParametriRicerca",reference:"ParametriRicerca",nonDisabilitare:!0,border:0,layout:{align:"stretch",type:"vbox"},items:[{xtype:"form",itemId:"Form",reference:"Form",noModificaDati:!0,border:0,padding:"5 0 0 10",layout:{align:"stretch",type:"vbox"},trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"textfield",
itemId:"Cognome",reference:"Cognome",width:238,fieldLabel:"RIC_NOME",labelClsExtra:"cbaLabel",labelWidth:35,name:"nome",enableKeyEvents:!0},{xtype:"datefield",itemId:"DataDal",reference:"DataDal",width:145,fieldLabel:"Dal",labelClsExtra:"cbaLabel",labelWidth:35,name:"dal",allowBlank:!1},{xtype:"container",width:285,layout:"column",items:[{xtype:"datefield",itemId:"DataAl",reference:"DataAl",width:145,fieldLabel:"Al",labelClsExtra:"cbaLabel",labelWidth:35,name:"al",allowBlank:!1},{xtype:"textfield",
itemId:"numFascRif",reference:"numFascRif",width:85,labelWidth:28,margin:"0 0 0 8",maxLength:20,enforceMaxLength:!0,fieldLabel:48==CBA.moduli.moduloAttivo?"PROT":"FASC",labelClsExtra:"cbaLabel",flex:1,name:"numFascRif",allowBlank:!0}]},{xtype:"mese",itemId:"Mese",reference:"Mese",hidden:!0,store:Ext.create("Generali.store.Mesi"),labelWidth:35},{xtype:"anno",itemId:"Anno",reference:"Anno",hidden:!0,labelWidth:35},{xtype:"panel",border:0,itemId:"PnlAttivi",reference:"PnlAttivi",layout:{type:"hbox"},
title:"",items:[{xtype:"checkboxfield",cls:"cbaLabel",itemId:"Attivi",reference:"Attivi",margin:"0 2 0 0",name:"attivi",boxLabel:"RIC_ATTIVI",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"NonAttivi",reference:"NonAttivi",margin:"0 2 0 0",name:"nonAttivi",boxLabel:"RIC_NON_ATTIVI",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"SenzaServizi",reference:"SenzaServizi",name:"senzaServizi",boxLabel:"RIC_SENZA_SERVIZI",inputValue:"T",
hidden:!0,uncheckedValue:"F"}]}]},{xtype:"panel",border:0,itemId:"PnlAvanzate",reference:"PnlAvanzate",title:"",items:[{xtype:"fieldset",componentCls:"cbaFieldCercaBox",itemId:"FsAvanzate",reference:"FsAvanzate",collapsible:!0,title:"RIC_AVANZATE",items:[{xtype:"combobox",itemId:"Servizio",reference:"Servizio",width:215,hideLabel:!0,name:"servizio",emptyText:"SERVIZIO",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.TipoServizio"),typeAhead:!0,valueField:"codice"},
{xtype:"combobox",hidden:!0,itemId:"Classificazione",reference:"Classificazione",width:215,hideLabel:!0,name:"classificazione",emptyText:"CLASSIFICAZIONE",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Classificazioni"),typeAhead:!0,valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",itemId:"Sede",reference:"Sede",width:215,hideLabel:!0,name:"sede",emptyText:"SEDE",displayField:"valore",
queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Sedi"),typeAhead:!0,valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",hidden:!0,itemId:"Reparto",reference:"Reparto",width:215,hideLabel:!0,name:"reparto",emptyText:"REPARTO",displayField:"valore",queryMode:"local",queryParam:"",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Reparti"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},
{xtype:"container",itemId:"CtnPratica",reference:"CtnPratica",layout:{type:"hbox"},hidden:!0,margin:"0 0 5 0",items:[{xtype:"textfield",padding:"-4 0 0 0",itemId:"AnnoPratica",reference:"AnnoPratica",width:100,labelWidth:45,maxLength:4,enforceMaxLength:!0,fieldLabel:"FR_PRATICA",labelClsExtra:"cbaLabel",name:"annoPratica",allowBlank:!0,emptyText:"Anno"},{xtype:"label",padding:"3 5 0 5",text:" - ",labelClsExtra:"cbaLabelDati",name:"-"},{xtype:"textfield",itemId:"NPratica",reference:"NPratica",width:100,
maxLength:6,enforceMaxLength:!0,labelClsExtra:"cbaLabel",name:"nPratica",allowBlank:!0,emptyText:"N"}]}]}]},{xtype:"container",border:0,height:45,itemId:"PnlBottoni",reference:"PnlBottoni",layout:{type:"hbox"},items:[{xtype:"button",cls:"btnLarge",itemId:"BtnCerca",reference:"BtnCerca",formBind:!0,margin:"0 5 0 0",width:80,iconCls:"icon-ricerca",scale:"large",text:"CERCA"},{xtype:"button",hidden:!0,cls:"btnLarge",itemId:"BtnNuovo",reference:"BtnNuovo",formBind:!0,iconCls:"nuovoutente",scale:"large",
text:"NUOVO_UTENTE"},{xtype:"button",hidden:!0,cls:"btnLarge",itemId:"BtnSeleziona",reference:"BtnSeleziona",formBind:!0,iconCls:"icon-ok32",scale:"large",text:"SELEZIONA",tooltip:"SELEZIONA_UTENTE"},{xtype:"container",flex:1},{xtype:"button",hidden:!0,itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esci32",scale:"large",cls:"btnLarge",text:"ESCI"}]}]},{xtype:"panel",flex:1,border:0,itemId:"pannelloRicerca",reference:"pannelloRicerca",layout:{type:"fit"},title:"UTENTI: ",items:[{xtype:"gridpanel",
border:0,itemId:"GridRicerca",reference:"GridRicerca",autoScroll:!0,cbaPaged:this.cbaConfig&&this.cbaConfig.cbaPaged?this.cbaConfig.cbaPaged:!1,title:"",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Utenti"),columns:[{xtype:"gridcolumn",dataIndex:"nominativo",text:"RISRIC_NOMINATIVO",flex:1},{xtype:"datecolumn",width:70,align:"center",dataIndex:"dataNascita",text:"DATA_NASCITA",format:"d/m/Y"},{xtype:"gridcolumn",itemId:"ColServizio",reference:"ColServizio",text:"SERVIZIO",width:180,hidden:!0}],
viewConfig:{getRowClass:function(b,c,d,f){if(!1===b.get("attivo"))return"non_attivi"},border:0,loadMask:!1}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.estrattoConto.controller.EditCauzione",{extend:"Generali.standard.stampe.Controller",parametriStampa:{hideMenu:!0},init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"Data",selector:this.selContainer+"#Data"},{ref:"BtnRicevuta",selector:this.selContainer+"#BtnRicevuta"},{ref:"BtnSconto",selector:this.selContainer+"#BtnSconto"},
{ref:"BtnSupplemento",selector:this.selContainer+"#BtnSupplemento"},{ref:"BtnRestituzione",selector:this.selContainer+"#BtnRestituzione"},{ref:"CbCondPag",selector:this.selContainer+"#CbCondPag"},{ref:"CbMovimento",selector:this.selContainer+"#CbMovimento"},{ref:"Importo",selector:this.selContainer+"#Importo"},{ref:"RifFattura",selector:this.selContainer+"#RifFattura"},{ref:"IdRecord",selector:this.selContainer+"#IdRecord"},{ref:"IdRecordEsterno",selector:this.selContainer+"#IdRecordEsterno"}]);this.control(this.selContainer+
"#BtnSconto",{click:this.clickBtnSconto});this.control(this.selContainer+"#BtnSupplemento",{click:this.clickBtnSupplemento});this.control(this.selContainer+"#BtnRestituzione",{click:this.clickBtnRestituzione});this.control(this.selContainer+"#CbMovimento",{change:this.changeCbMovimento})},changeCbMovimento:function(b,c){var d=this.getBoxBottoni();d.down("#BtnSupplemento").setVisible(4==c);d.down("#BtnSconto").setVisible(5==c);d.down("#BtnRestituzione").setVisible(5==c);d.down("#BtnRicevuta").setVisible(4==
c)},clickBtnSupplemento:function(b){this.clickScontoSupplemento(!1)},clickBtnSconto:function(b){this.clickScontoSupplemento(!0)},clickBtnRestituzione:function(b){},clickScontoSupplemento:function(b){var c=this;Ext.create("winCBA",{permesso:"S",name:"GeneraliOSP.portlet.view.EdtScontiSupp",dimensione:1,configItem:{permesso:"S",currRicovero:currRicovero,tipoScontoSupp:b?"C":"S",importo:c.getImporto().getValue(),data:c.getData().getValue(),gestioneCauzione:!0,storePaganti:c.cbaConfig.storePaganti,callbackEsci:function(b){b&&
(c.getIdRecordEsterno().setValue(b),c.salvaForm())}}}).show()},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salvaForm:function(b){var c=this.getForm(),d=c.getForm().getFieldValues();Ext.apply(d,{idRicovero:this.cbaConfig.idRicovero,tipoRecord:"C"});d.idRecordEsterno||(d.idRecordEsterno=null);this.ecLite&&(d.tipoMovimento=2,d.importo=2==this.cbaConfig.recordGrid.get("tipoMovimento")?d.importo:-1*d.importo,d.idRicovero=
0,d.tipoRecord="E",d.idFatturaTestata=this.cbaConfig.recordGrid.get("idFattura"),d.idCassa=this.cbaConfig.recPag.get("codice"),d.idAttivita=this.cbaConfig.recordGrid.get("idAttivita"));controller_salvaRecord(c,d,b)},gestioneForm:function(){var b=this,c=b.getForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=Ext.create("GeneraliOSP.estrattoConto.store.EditCauzione");c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},
annulla_callback:function(){b.aggiornaStore()},verificaCampiForm_callback:function(){return b.verificaCampiForm()},esci_callback:function(){b.cbaConfig.callbackEsci();b.getForm().up("window").close()}}});inserisciBottoni(c.boxBottoni,d);c.boxBottoni.queryById("btnNuovo").hide();c.boxBottoni.queryById("btnElimina").hide();var f=Ext.widget("newButtonStampa",{itemId:"BtnRicevuta",reference:"BtnRicevuta",text:"CU_RICEVUTA",margin:"0 1 0 0",scale:"small",cls:"cba-button-25",iconCls:"icon-stampa"});b.configurePrintButton(f,
"print");var d=Ext.create("Ext.Button",{itemId:"BtnSupplemento",reference:"BtnSupplemento",cls:"cba-button-25",iconCls:"icon-piu20",text:"CU_SUPPLEMENTO",margin:"0 1 0 0",hidden:!0,disabled:!0,tooltip:traduci("CU_SUPPLEMENTO_AUTO")}),g=Ext.create("Ext.Button",{itemId:"BtnSconto",reference:"BtnSconto",cls:"cba-button-25",iconCls:"icon-meno20",text:"CU_SCONTO",margin:"0 1 0 0",hidden:!0,disabled:!0,tooltip:traduci("CU_SCONTO_AUTO")}),h=Ext.create("Ext.Button",{itemId:"BtnRestituzione",reference:"BtnRestituzione",
cls:"cba-button-25",iconCls:"icon-restituzione20",text:"CU_RESTITUZIONE",margin:"0 1 0 0",hidden:!0,disabled:!0,tooltip:traduci("CU_RESTITUZIONE_AUTO")});c.boxBottoni.down().insert(5,f);c.boxBottoni.down().insert(6,d);c.boxBottoni.down().insert(7,g);c.boxBottoni.down().insert(8,h);if("L"!=c.permesso)c.getForm().on("dirtychange",function(b,d){controller_abilitaBottoni(c);f.setDisabled(d);Ext.isEmpty(c.store.getAt(0))&&(c.boxBottoni.down("#btnConferma").setDisabled(!1),c.boxBottoni.down("#btnAnnulla").setDisabled(!0),
c.boxBottoni.down("#btnEsci").setDisabled(!1))});b.ecLite&&b.configEcLite()},configEcLite:function(){var b=this.getForm(),c=this.cbaConfig.recordGrid;b.getForm().loadRecord(c);this.getImporto().setValue(Math.abs(c.get("importo")));this.getIdRecord().setValue(-1);b.isValid()},doPrint:function(b,c){recData=this.getForm().store.getAt(0);if(null==recData)msgShowWarning("",traduci("MSG_DATI_DA_CONFERMARE_TAB"));else{var d=recData.getData();this.ecLite&&(d.desCondPag=this.getCbCondPag().getDisplayValue());
Ext.isDefined(c)&&(this.parametriStampa.params.format=c);showWinStampa(43,CBA.parametriGenerali.codEnte,"CU_StampaRicevuta",{configBtnStampa:this.parametriStampa,eseguiStampa:!0,jsonData:d})}},aggiornaStore:function(b){var c=this,d=c.getForm(),f=d.getForm(),g=d.store;if(c.cbaConfig.idRecord)b=c.cbaConfig.idRecord;else if(!b){clearForm(d);c.ecLite&&c.configEcLite();return}g.load({params:{id:b},callback:function(b,g,l){l?(clearForm(d),Ext.isEmpty(b)||f.loadRecord(b[0]),c.ecLite||(b=c.getIdRecordEsterno().getValue(),
c.getBtnSconto().setDisabled(b),c.getBtnRestituzione().setDisabled(!0),c.getBtnSupplemento().setDisabled(b))):msgShowError("",g.getError())}})},onLaunch:function(){var b=this.getForm().getForm();this.ecLite=this.cbaConfig.ecLite;this.gestioneForm();this.cbaConfig.nuovo?(this.getData().setValue(new Date),b.isValid()):this.aggiornaStore();this.ecLite?(this.storeCondizioniPagamento=Ext.create("Generali.store.CondizioniPagamento"),this.storeCondizioniPagamento.load({params:{tabellaNuova:"T",dataControllo:new Date,
tipoClienteFornitore:"C"},callback:function(b,d,f){f||msgShowError("",d.getError())}}),this.getCbCondPag().bindStore(this.storeCondizioniPagamento)):this.getCbMovimento().focus(!1,500)},destroy:function(){eliminaStore(this.storeForm);this.storeCondizioniPagamento&&eliminaStore(this.storeCondizioniPagamento);this.callParent()}});
Ext.define("GeneraliOSP.estrattoConto.controller.EditEstrattoConto",{extend:"Generali.standard.stampe.Controller",parametriStampa:{hideMenu:!0},init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"Causale",selector:this.selContainer+"#Causale"},{ref:"Conto",selector:this.selContainer+"#Conto"},{ref:"Attivita",selector:this.selContainer+"#Attivita"},
{ref:"CbCondPag",selector:this.selContainer+"#CbCondPag"},{ref:"Data",selector:this.selContainer+"#Data"},{ref:"Id",selector:this.selContainer+"#Id"},{ref:"GridScadenze",selector:this.selContainer+"#GridScadenze"}]);this.control(this.selContainer+"#Data",{change:this.changeData});this.control(this.selContainer+"#CbCondPag",{select:this.onSelectCondPag})},onSelectCondPag:function(b,c,d){b=this.getForm().getForm().findField("condPag_cliFor");c=c.get("idGruppo");b.setValue(c)},changeData:function(b,
c){isValidDate(b)&&(me=this,me.idEsercizio=me.economicaNew?getIdEsercizioByDate(me.idOrganizzazione,c):c.getFullYear(),this.loadPersonFiltroEC(c),this.loadCausale(),this.loadConto(c))},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salvaForm:function(b,c){var d=this,f=d.getForm(),g=f.getForm().getFieldValues();Ext.apply(g,{avere:g.importo,annEse:d.idEsercizio});delete g.importo;var h=[];if(d.cbaConfig.scadenze&&1<d.cbaConfig.scadenze.count()){var k=
0;Ext.each(d.getGridScadenze().getStore().getRange(),function(b){if(Ext.isNumber(b.get("incassoScadenza"))&&0<b.get("incassoScadenza")){var c=f.getForm().getFieldValues();Ext.apply(c,{avere:b.get("incassoScadenza"),idScadenza:b.get("id")});delete c.importo;k+=c.avere;h.push(c)}});if(k!=f.getForm().findField("importo").getValue())return Messaggio("ATTENZIONE",traduci("MSG_SCADENZE_TOT_ERRATO"),"OK","WARNING"),controller_abilitaBottoni(d.getForm()),!1}else d.cbaConfig.scadenze&&1==d.cbaConfig.scadenze.count()&&
Ext.apply(g,{idScadenza:d.cbaConfig.scadenze.getAt(0).get("id")}),h.push(g);0>f.getForm().findField("importo").getValue()?Messaggio("ATTENZIONE",traduci("MSG_INSERT_EC_NEGATIVO"),"YESNO","WARNING",null,function(){d.inserisciMov(b,h);return!0},function(){controller_abilitaBottoni(d.getForm());return!1}):d.inserisciMov(b,h)},inserisciMov:function(b,c){var d=this,f={};Ext.apply(f,{gestScadenze:d.cbaConfig.nuovoIncassoPagamento&&-1<=d.cbaConfig.importoSaldato,tipoContabilita:d.cbaConfig.personContabili.tipoContabilitaAbilitata,
saldoEffettuato:-1==d.cbaConfig.importoSaldato});Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/escont/ec/new",jsonData:c,params:f,success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){msgShow(traduci("MSG_SALVATAGGIO_DATI"),c.message);if(b)d.esciClick();else{var f=d.getForm();f.boxBottoni.queryById("BtnRicevuta").setDisabled(!1);f=f.getForm();f.setValues(f.getFieldValues());f.setValues({id:1});f.reset()}d.aggiornaStore(-1,c.data[0])}else c.message&&msgShowError("",c.message[0].testo)}})},
esciClick:function(){this.cbaConfig.callbackEsci();this.getForm().up("window").close()},gestioneForm:function(){var b=this,c=b.getForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=Ext.create("GeneraliOSP.estrattoConto.store.EditEstrattoConto");c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c,!1)},annulla_callback:function(){b.getForm().getForm().reset();b.ClickBtnRipristina=
!0},verificaCampiForm_callback:function(){return b.verificaCampiForm()},esci_callback:function(){b.cbaConfig.callbackEsci();b.getForm().up("window").close()}}});inserisciBottoni(c.boxBottoni,d);c.boxBottoni.queryById("btnNuovo").hide();c.boxBottoni.queryById("btnElimina").hide();var f=Ext.widget("newButtonStampa",{itemId:"BtnRicevuta",reference:"BtnRicevuta",text:"CU_RICEVUTA",margin:"0 1 0 0",scale:"small",cls:"cba-button-25",iconCls:"icon-stampa"});b.configurePrintButton(f,"print");c.boxBottoni.down().insert(5,
f);if("L"!=c.permesso)c.getForm().on("dirtychange",function(d,h){controller_abilitaBottoni(c);f.setDisabled(h);b.ClickBtnRipristina&&(f.setDisabled(!0),b.ClickBtnRipristina=!1)})},doPrint:function(b,c){Ext.isDefined(c)&&(this.parametriStampa.params.format=c);var d=this.currentRecord;d.dataReg=new Date(d.dataReg);var f=0>this.getForm().getForm().findField("importo").getValue();f&&(d.avere=-d.avere);f={idRicovero:0,tipoRecord:"E",idFatturaTestata:null,idCassa:d.codfocl,data:d.dataReg,tipoMovimento:f?
-2:2,importo:d.avere,note:d.descriz,desCondPag:this.economicaNew?this.getCbCondPag().getDisplayValue():null};showWinStampa(43,CBA.parametriGenerali.codEnte,"CU_StampaRicevuta",{configBtnStampa:this.parametriStampa,eseguiStampa:!0,idPagante:d.codfocl,jsonData:f})},aggiornaStore:function(b,c){this.currentRecord=c},loadConto:function(b){var c=this,d=c.getConto(),f={};c.economicaNew?(d.getStore().getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(f,{idOrganizzazione:c.idOrganizzazione,
idEsercizio:c.idEsercizio,soloPatrimoniali:"T"})):(d.getStore().getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(f,{anno:b.getFullYear()}));d.getStore().load({params:f,callback:function(b,f,k){k?(Ext.isEmpty(c.filtroConto)||-1!=c.filtroConto.indexOf("OFF")||this.filter({filterFn:function(b){return Ext.isEmpty(c.filtroConto)?!0:-1!=c.filtroConto.indexOf(b.data.codice)}}),c.getId().getValue()||Ext.isEmpty(c.idContoPredefinito)||d.setValue(c.idContoPredefinito)):msgShowError("",f.getError())}})},
loadCausale:function(){var b=this,c=this.getCausale();c.getStore().load({params:{tipoContabilita:b.cbaConfig.personContabili.tipoContabilitaAbilitata,tipoDocOspiti:2,idOrganizzazione:b.idOrganizzazione},callback:function(d,f,g){g?(this.filter({filterFn:function(c){var d=Ext.isEmpty(b.filtroCausale)||-1!=b.filtroCausale.indexOf("OFF")?!0:-1!=b.filtroCausale.indexOf(c.data.codice);return b.economicaNew?"I"==c.data.extra.split(",")[2]&&d?!0:!1:d}}),b.getId().getValue()||Ext.isEmpty(b.idCausalePredefinito)||
c.setValue(b.idCausalePredefinito),c.focus(!1,500)):msgShowError("",f.getError())}})},loadPersonFiltroEC:function(b){var c=this;Ext.Ajax.request({url:"/cba/osp/co/ws/prszn/escont/filter",params:{idOrg:c.idOrganizzazione,tipoContabilita:c.cbaConfig.personContabili.tipoContabilitaAbilitata,idEsercizio:c.idEsercizio,data:b},async:!1,method:"GET",success:function(b){if(""!=b.responseText)if(b=Ext.decode(b.responseText),b.success){if(!Ext.isEmpty(b.data[0])){c.filtroCausale=b.data[0];var d=-1!=c.filtroCausale.indexOf(",")?
c.filtroCausale.indexOf(","):c.filtroCausale.length;c.idCausalePredefinito=c.filtroCausale.substring(0,d)}Ext.isEmpty(b.data[1])||(c.filtroConto=b.data[1],b=-1!=c.filtroConto.indexOf(",")?c.filtroConto.indexOf(","):c.filtroConto.length,c.idContoPredefinito=c.filtroConto.substring(0,b))}else msgShowError("",b.message[0].testo)}})},getDatiPagante:function(b,c){c||(c=new Date);var d={};Ext.Ajax.request({url:"/cba/osp/co/ws/rette/pagantiext/src",params:{codFoCl:b,data:c,tipoContabilita:this.cbaConfig.personContabili.tipoContabilitaAbilitata},
method:"GET",async:!1,success:function(b){d=Ext.JSON.decode(b.responseText);d.success?d=d.data:msgShowError("",d.message)}});return d},onLaunch:function(){var b=this,c=b.getForm().getForm(),d=b.cbaConfig.recordGrid,f=c.findField("descriz");b.idOrganizzazione=getIdOrg();if(b.cbaConfig.nuovoDocumento)b.getData().setFieldLabel("CU_DATA_DOC"),c.findField("tipMov").setValue(7),(f=this.getDatiPagante(b.cbaConfig.codfocl,new Date))&&f.tipoPagamento&&c.setValues({condPag:f.tipoPagamento});else if(b.cbaConfig.nuovoIncassoPagamento){var g=
2==d.get("tipMov");b.getData().setFieldLabel(g?"CU_DATA_PAGAMENTO":"CU_DATA_INCASSO");c.findField("importo").setValue((g?d.get("avere"):d.get("dare"))-(0<b.cbaConfig.importoSaldato?b.cbaConfig.importoSaldato:0));c.findField("tipMov").setValue(d.get("tipMov"));var h=d.get("tipNumReg")?d.get("numReg")+"/"+d.get("tipNumReg"):d.get("numReg");f.setValue(Ext.String.format((g?"Pagamento":"Incasso")+" Documento n.{0} del {1}",h,FormattaData(d.get("dataReg"))));c.setValues({numReg:d.get("numReg"),tipNumReg:d.get("tipNumReg")})}b.economicaNew=
"4"==b.cbaConfig.personContabili.tipoContabilitaAbilitata;c.setValues({codfocl:b.cbaConfig.codfocl,dataReg:new Date,annEse:b.economicaNew?b.cbaConfig.personContabili.idEsercizio:(new Date).getFullYear(),idRegistrazione:b.economicaNew&&d?d.get("idRegistrazione"):null});b.getAttivita().allowBlank=!b.economicaNew;b.getAttivita().setVisible(b.economicaNew);b.getCbCondPag().allowBlank=!b.economicaNew;b.getCbCondPag().setVisible(b.economicaNew);b.economicaNew&&(f=Ext.create("Generali.data.StoreCodiceValore",
{proxy:{url:"/cba/osp/co/ws/genAmm/attivita/cbox"}}),b.getAttivita().bindStore(f),f.load({params:{applicaFiltro:"T"},callback:function(f,g,h){h?(b.economicaNew&&d?f=d.get("idAttivita"):(f.length=1,f=f[0].get("codice")),c.setValues({idAttivita:f})):msgShowError("",g.getError())}}),b.storeCondizioniPagamento=Ext.create("Generali.store.CondizioniPagamento"),b.getCbCondPag().bindStore(b.storeCondizioniPagamento),b.storeCondizioniPagamento.load({params:{tabellaNuova:"T",idCliFor:b.cbaConfig.codfocl,dataControllo:new Date,
tipoClienteFornitore:"C"},callback:function(b,f,g){g?(b=d?d.get("condPag"):null,f=d?d.get("condPag_cliFor"):null,Ext.isEmpty(b)||c.setValues({condPag:b}),Ext.isEmpty(f)||c.setValues({condPag_cliFor:f})):msgShowError("",f.getError())}}));b.cbaConfig.scadenze&&1<b.cbaConfig.scadenze.count()&&(b.getGridScadenze().reconfigure(b.cbaConfig.scadenze),b.getGridScadenze().show());b.gestioneForm();c.isValid()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.estrattoConto.controller.TabCauzione",{extend:"Generali.standard.stampe.Controller",parametriStampa:{hideMenu:!0},init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"GridMov",selector:this.selContainer+"#GridMov"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"DataAl",selector:this.selContainer+"#DataAl"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},
{ref:"BtnRicevuta",selector:this.selContainer+"#BtnRicevuta"},{ref:"LbUtente",selector:this.selContainer+"#LbUtente"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"LbCauzioneAltra",selector:this.selContainer+"#LbCauzioneAltra"}]);this.control(this.selContainer+"#GridMov",{itemdblclick:this.itemdblclickGridMov});this.control(this.selContainer+"#DataDal",{change:this.changeData});this.control(this.selContainer+"#DataAl",{change:this.changeData});this.control(this.selContainer+"#BtnNuovo",
{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnElimina:function(){var b=this,c=b.getGridMov(),d=c.getSelectionModel().getSelection()[0];controller_eliminaRecord(c.getStore(),{idImportiUtente:d?d.get("id"):""},function(){b.aggiornaStore()})},itemdblclickGridMov:function(){"L"!=this.cbaConfig.permesso&&this.apriWin(!1)},doPrint:function(b,c){Ext.isDefined(c)&&(this.parametriStampa.params.format=c);if(b==this.getBtnRicevuta()){var d=this.getGridMov().getSelectionModel().getSelection()[0].getData();
showWinStampa(43,CBA.parametriGenerali.codEnte,"CU_StampaRicevuta",{configBtnStampa:this.parametriStampa,eseguiStampa:!0,jsonData:d})}else{d=this.getGridMov();if(0==d.getStore().getCount())return!1;var f=[];("undefined"===typeof d.up("tabpanel").down("#TpEstrattoConto")||null==d.up("tabpanel").down("#TpEstrattoConto")?d.up("tabpanel").down("#GridMov").getStore():d.up("tabpanel").down("#TpEstrattoConto").down("#GridPaganti").getStore()).each(function(b){f.push(b.get("codice"))});showWinStampa(43,CBA.parametriGenerali.codEnte,
"CU_StampaECCauzioni",{configBtnStampa:this.parametriStampa,eseguiStampa:!0,tipoStampaEstrattoConto:1,dataDal:this.getDataDal().getValue(),dataAl:this.getDataAl().getValue(),elencoUtenti:currOspite.codOspite,elencoRicoveri:currRicovero.idRicovero,elencoPaganti:f,includiSaldiZero:!0})}},apriWin:function(b){var c=this,d=c.getGridMov();Ext.create("winCBA",{permesso:"S",name:"GeneraliOSP.estrattoConto.view.EditCauzione",titolo:"CU_NUOVA_CAUZIONE",dimensione:3,configItem:{permesso:"S",idRicovero:currRicovero.idRicovero,
nuovo:b,storePaganti:c.storePaganti,idRecord:b?null:d.getSelectionModel().getSelection()[0].get("id"),callbackEsci:function(){c.aggiornaStore()}}}).show()},clickBtnNuovo:function(){this.apriWin(!0)},changeData:function(b){isValidDate(b)&&this.filtra()},filtra:function(){this.puoiFiltrare&&(this.getDataDal().getValue()>this.getDataAl().getValue()?Messaggio("ATTENZIONE","MSG_DATADAL_MAGGIORE_DATAAL","OK","WARNING"):this.aggiornaStore())},mettiSegnoOperazione:function(){for(var b=0;b<this.getGridMov().getStore().getCount();b++){this.getGridMov().getSelectionModel().getCurrentPosition();
record=this.getGridMov().store.getAt(b);var c=record.get("importo");models=this.getGridMov().getStore().getRange();"5"==record.get("tipoMovimento")&&models[b].set("importo",-c)}},aggiornaStore:function(b){var c=this,d=c.getGridMov();d.getStore().load({params:{idRicovero:currRicovero.idRicovero,tipoRecord:"C",tipoMovimento:"4,5",dataDal:c.getDataDal().getValue(),dataAl:c.getDataAl().getValue(),idAttivita:Ext.isEmpty(c.cbaConfig.personContabili.attivita)?-1:c.cbaConfig.personContabili.attivita},callback:function(b,
g,h){h?(Ext.isEmpty(b)||(d.getSelectionModel().select(0),c.mettiSegnoOperazione()),c.getBtnRicevuta().setDisabled(Ext.isEmpty(b)),c.cbaConfig.wizard&&c.cbaConfig.controllerEditFascicolo&&c.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento()):msgShowError("",g.getError())}})},onLaunch:function(){var b=this;this.puoiFiltrare=!1;this.getDataDal().setValue(currRicovero.dataDal);this.getDataAl().setValue(dataFineMese(12,(new Date).getFullYear()));this.puoiFiltrare=!0;this.filtra();"undefined"!==
typeof currOspite&&null!=currOspite&&b.getLbUtente().setText(currOspite.cognome+" "+currOspite.nome);"undefined"!==typeof b.cbaConfig.controllerEditFascicolo&&"undefined"!==typeof b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite&&b.getLbUtente().setText(b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.cognome+" "+b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.nome);void 0!==b.cbaConfig.controllerEditFascicolo&&"undefined"!==typeof b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite&&
b.getLbUtente().setText(b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.cognome+" "+b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.nome);b.configurePrintButton(this.getBtnRicevuta(),"print");b.storePaganti=null;b.getGridMov().up("tabpanel")?b.storePaganti=gridMov.up("tabpanel").down("#TpEstrattoConto").down("#GridPaganti").getStore():(b.storePaganti=Ext.create("CU.store.PagantiFascicolo"),b.storePaganti.load({params:{idRicovero:currRicovero.idRicovero,tipoContabilita:b.cbaConfig.personContabili.tipoContabilitaAbilitata},
callback:function(b,d,f){f||msgShowError("",d.getError())}}));Ext.Ajax.request({method:"GET",url:"/cba/osp/co/ws/escont/cauzOther/tot",params:{idRicovero:currRicovero.idRicovero},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?(b.getLbCauzioneAltra().setVisible(c.success),b.getLbCauzioneAltra().setValue(formatFloat(c.data,2,!0))):msgShowError("",c.message)}});permettiModificheDopoDimissione()||(b.getBtnNuovo().setDisabled(!0),b.getBtnElimina().setDisabled(!0))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.estrattoConto.controller.TabEstrattoConto",{extend:"Generali.standard.stampe.Controller",parametriStampa:{hideMenu:!0},init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"GridPaganti",selector:this.selContainer+"#GridPaganti"},{ref:"GridMov",selector:this.selContainer+"#GridMov"},{ref:"AnnoEsercizio",selector:this.selContainer+"#AnnoEsercizio"},{ref:"CBEsercizio",
selector:this.selContainer+"#CBEsercizio"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"DataAl",selector:this.selContainer+"#DataAl"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"BtnRicevuta",selector:this.selContainer+"#BtnRicevuta"},{ref:"BtnIncassa",selector:this.selContainer+"#BtnIncassa"},{ref:"BtnStampa",selector:this.selContainer+"#BtnStampa"},{ref:"SaldoPrec",selector:this.selContainer+"#SaldoPrec"},
{ref:"SaldoPrecBox",selector:this.selContainer+"#SaldoPrecBox"}]);this.control(this.selContainer+"#BtnIncassa",{click:this.clickBtnIncassa});this.control(this.selContainer+"#GridMov",{select:this.selectGridMov});this.control(this.selContainer+"#GridPaganti",{select:this.selectGridPaganti});this.control(this.selContainer+"#AnnoEsercizio",{change:this.changeAnnoEsercizio});this.control(this.selContainer+"#CBEsercizio",{change:this.cambioEsercizio});this.control(this.selContainer+"#DataDal",{change:this.changeData});
this.control(this.selContainer+"#DataAl",{change:this.changeData});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},cambioEsercizio:function(b,c,d,f){var g=this;if(!c)return!1;Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/general/esercizioCont/get",params:{id:c},success:function(b){var c=Ext.JSON.decode(b.responseText);c.success?(b=Ext.Date.parse(c.data.dataInizioPeriodo,"Y-m-d H:i:s"),c=Ext.Date.parse(c.data.dataFinePeriodo,
"Y-m-d H:i:s"),g.puoiFiltrare=!1,g.getDataDal().setValue(FormattaData(b)),g.getDataAl().setValue(FormattaData(c)),g.puoiFiltrare=!0,g.filtra()):msgShowError("",c.message)}})},doPrint:function(b,c){Ext.isDefined(c)&&(this.parametriStampa.params.format=c);if(b==this.getBtnRicevuta()){var d=this.getGridPaganti().getSelectionModel().getSelection()[0],f=this.getGridMov().getSelectionModel().getSelection()[0].getData(),g=0<f.dare&&"I"==f.tipoCausale;g&&(f.avere=-f.dare);f={idRicovero:0,tipoRecord:"E",idFatturaTestata:f.idFattura,
idCassa:d.get("codice"),data:f.dataReg,tipoMovimento:g?-2:2,importo:f.avere,note:f.descriz,desCondPag:f.desCondPag};showWinStampa(43,CBA.parametriGenerali.codEnte,"CU_StampaRicevuta",{configBtnStampa:this.parametriStampa,eseguiStampa:!0,idPagante:d.get("codice"),jsonData:f})}else{if(0==this.getGridMov().getStore().getCount())return!1;d=this.getGridPaganti().getSelectionModel().getSelection()[0];showWinStampa(43,CBA.parametriGenerali.codEnte,"CU_StampaECPaganti",{configBtnStampa:this.parametriStampa,
eseguiStampa:!0,winElaborazione:!1,tipoStampaEstrattoConto:1,dataDal:this.getDataDal().getValue(),dataAl:this.getDataAl().getValue(),elencoPaganti:""+d.get("codice"),includiSaldiZero:!0})}},apriWin:function(b,c,d,f){var g=this;if("S"==g.cbaConfig.permesso){var h=g.getGridMov().getSelectionModel().getSelection()[0],k=g.getGridPaganti().getSelectionModel().getSelection()[0];k&&Ext.create("winCBA",{permesso:"S",name:"GeneraliOSP.estrattoConto.view.EditEstrattoConto",titolo:b?"CU_NUOVO_DOC_CONTABILE":
"CU_GESTIONE_INCASSIPAGAMENTI",dimensione:d&&1<d.count()?8:2,configItem:{permesso:"S",nuovoDocumento:b,nuovoIncassoPagamento:c,recordGrid:h,importoSaldato:f,codfocl:k.get("codice"),personContabili:g.cbaConfig.personContabili,scadenze:d,callbackEsci:function(){g.aggiornaStore(k.get("codice"))}}}).show()}},apriWinEcLite:function(){var b=this;if("S"==b.cbaConfig.permesso){var c=b.getGridMov().getSelectionModel().getSelection()[0],d=b.getGridPaganti().getSelectionModel().getSelection()[0];if(d){var f=
Ext.isEmpty(c.get("avere"))?!1:!0,g=f?Math.abs(c.get("avere")):Math.abs(c.get("dare")),h;h=""+((f?traduci("PAGAMENTO"):traduci("INCASSO"))+" "+traduci("FATTURA")+" "+traduci("NUM")+" "+c.get("numReg")+"/"+c.get("tipNumReg")+" "+traduci("DATA")+" "+FormattaData(c.get("dataReg"))+" ");h+=traduci("IMPORTO")+" "+traduci("TOTALE")+" "+formatFloat(Math.abs(g),2,".");Ext.apply(c.data,{idRicovero:0,tipoRecord:"E",data:new Date,tipoMovimento:f?-2:2,importo:f?c.get("avere"):c.get("dare"),note:h,idFatturaTestata:c.get("idFattura"),
idCassa:d.get("codice")});Ext.create("winCBA",{permesso:"S",name:"GeneraliOSP.estrattoConto.view.EditCauzione",titolo:"CU_GESTIONE_INCASSIPAGAMENTI",dimensione:4,configItem:{permesso:"S",recPag:d,recordGrid:c,ecLite:!0,nuovo:!0,personContabili:b.cbaConfig.personContabili,callbackEsci:function(){b.aggiornaStore(d.get("codice"))}}}).show()}}},checkScadenze:function(){var b=this,c=b.getGridMov().getSelectionModel().getSelection()[0],d=b.getGridPaganti().getSelectionModel().getSelection()[0],f=2==c.get("tipMov")?
c.get("avere"):c.get("dare");if(d){var g={};Ext.apply(g,{codfocl:d.get("codice"),dataReg:new Date,annEse:b.economicaNew?c.get("annEse"):c.get("dataReg").getFullYear(),idRegistrazione:b.economicaNew&&c?c.get("idRegistrazione"):null,idAttivita:b.economicaNew&&c?c.get("idAttivita"):null,tipMov:c.get("tipMov"),numReg:c.get("numReg"),tipNumReg:c.get("tipNumReg")});c={};Ext.apply(c,{tipoContabilita:b.cbaConfig.personContabili.tipoContabilitaAbilitata});Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/escont/ec/scadenze",
jsonData:g,params:c,success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success)if(0<c.data.length){var d=0;c.data.forEach(function(b){b.importoScadenza&&!b.dataPagamento&&(d+=b.importoScadenza)});var g=f-d,h=Ext.create("Ext.data.Store",{fields:[{name:"id"},{name:"dataScadenza",type:"date"},{name:"importoScadenza"},{name:"dataPagamento",type:"date"},{name:"incassoScadenza"}],data:0==d?c.data[0]:c.data});0==d?Messaggio("ATTENZIONE",traduci("MSG_SCADENZE_SALDO_PAGATO"),"YESNO","QUESTION",!1,
function(){b.apriWin(!1,!0,h,-1)}):0<d?(h.filter({filterFn:function(b){return!b.data.dataPagamento}}),1==h.count()?b.apriWin(!1,!0,h,g):1<h.count()&&Messaggio("ATTENZIONE",traduci("MSG_SCADENZE_MULTIPLE"),"OK","WARNING",function(){b.apriWin(!1,!0,h,g)})):b.apriWin(!1,!0,!1,-2)}else b.apriWin(!1,!0,!1,-2);else msgShowError("",c.message)}})}},clickBtnIncassa:function(){this.nessunAmm2?this.apriWinEcLite():this.checkScadenze()},clickBtnNuovo:function(){this.apriWin(!0,!1)},clickBtnElimina:function(){var b=
this,c=b.getGridMov(),d=c.getStore(),c=c.getSelectionModel().getSelection()[0];b.nessunAmm2&&(d.getProxy().api.destroy="/cba/osp/co/ws/AnagraficaOspiti/impgest/delete");controller_eliminaRecord(d,{idImportiUtente:c?c.get("idRegistrazione"):""},function(){b.aggiornaStore()})},changeData:function(b,c,d,f){isValidDate(b)&&this.filtra()},filtra:function(){this.puoiFiltrare&&!this.primaVolta&&(this.getDataDal().getValue()>this.getDataAl().getValue()?Messaggio("ATTENZIONE","MSG_DATADAL_MAGGIORE_DATAAL",
"OK","WARNING"):this.economicaNew?this.loadMovimenti():this.loadSaldo())},changeAnnoEsercizio:function(b,c){var d=creaData(1,1,c),f=dataFineMese(12,c);this.puoiFiltrare=!1;var g=this.getDataDal();g.setMaxValue(f);g.setValue(d);d=this.getDataAl();d.setMaxValue(f);d.setValue(f);this.puoiFiltrare=!0;this.filtra()},loadSaldo:function(){var b=this;b.getGridMov();var c=b.getGridPaganti().getSelectionModel().getSelection()[0];if(c){var d=b.getDataDal().getValue(),f=b.getDataAl().getValue();Ext.Ajax.request({url:"/cba/osp/co/ws/escont/pgn/saldo",
params:{paganti:c.get("codice"),dataDal:d,dataAl:f,tipoContabilita:b.cbaConfig.personContabili.tipoContabilitaAbilitata,idEsercizio:b.cbaConfig.personContabili.idEsercizio,idAttivita:Ext.isEmpty(b.cbaConfig.personContabili.attivita)?-1:b.cbaConfig.personContabili.attivita},async:!1,method:"GET",success:function(c){""!=c.responseText&&(c=Ext.decode(c.responseText),c.success&&c.data&&(b.saldoPrecedente=c.data[0].saldo,null==b.saldoPrecedente&&(b.saldoPrecedente=0),b.saldoIniziale=b.saldoPrecedente,
b.getSaldoPrec().setText(formatFloat(b.saldoPrecedente,2,!0)),b.cbaConfig.saldoPrecedenteLbl=b.saldoPrecedente,b.loadMovimenti()))}})}},loadMovimenti:function(){var b=this,c=b.getGridMov(),d=b.getGridPaganti().getSelectionModel().getSelection()[0];d&&c.getStore().load({params:{codfocl:d.get("codice"),dataDal:b.getDataDal().getValue(),dataAl:b.getDataAl().getValue(),tipoContabilita:b.cbaConfig.personContabili.tipoContabilitaAbilitata,idEsercizio:b.economicaNew?b.getCBEsercizio().getValue():b.getAnnoEsercizio().getValue(),
idAttivita:Ext.isEmpty(b.cbaConfig.personContabili.attivita)?-1:b.cbaConfig.personContabili.attivita},callback:function(d,g,h){h?Ext.isEmpty(d)||(b.economicaNew&&(b.saldoPrecedente=d[0].data.numreg?0:d[0].data.dare-d[0].data.avere,b.saldoIniziale=b.saldoPrecedente,b.getSaldoPrec().setText(formatFloat(b.saldoPrecedente,2,!0)),c.getView().refresh()),c.getSelectionModel().select(0)):msgShowError("",g.getError())}})},selectGridPaganti:function(b,c){this.puoiFiltrare&&(this.economicaNew?this.loadMovimenti():
this.loadSaldo());permettiModificheDopoDimissione()||this.getBtnNuovo().setDisabled(!0)},selectGridMov:function(b,c){var d=this.getBtnIncassa(),f=this.getBtnRicevuta(),g=this.getBtnElimina(),h=null!=c.get("dare"),k=null!=c.get("avere"),l=0<c.get("dare")&&"I"==c.get("tipoCausale");this.nessunAmm2?(l=1==c.get("tipMov"),"S"==this.cbaConfig.permesso?(d.setDisabled(!l),g.setDisabled(l)):(d.setDisabled(!0),g.setDisabled(!0)),f.setDisabled(h),this.getBtnStampa().setDisabled(!1),l&&k&&0!=c.get("avere")?(d.setDisabled(!1),
d.setText("Paga")):d.setText("Incassa")):(d.setDisabled("S"!=this.cbaConfig.permesso||!c.get("numReg")||!h||0==c.get("dare")||l),f.setDisabled((!c.get("numReg")||!k||0==c.get("avere"))&&!l),this.getBtnStampa().setDisabled(!1),2==c.get("tipMov")&&0!=c.get("avere")?(d.setDisabled(!1),d.setText("Paga")):d.setText("Incassa"))},aggiornaStore:function(b){var c=this,d=c.getGridPaganti(),f=d.getStore();f.load({params:{idRicovero:currRicovero.idRicovero,tipoContabilita:c.cbaConfig.personContabili.tipoContabilitaAbilitata},
callback:function(g,h,k){if(k){0==g&&c.getBtnNuovo().disable();if(b)var l=trovaRecord(f,"codice",b);d.getSelectionModel().deselectAll();d.getSelectionModel().select(l?[l]:0)}else msgShowError("",h.getError())}})},onLaunch:function(){var b=this;b.getGridPaganti().controller=b;b.economicaNew=4==b.cbaConfig.personContabili.tipoContabilitaAbilitata;b.nessunAmm2=5==b.cbaConfig.personContabili.tipoContabilitaAbilitata;b.idOrganizzazione=getIdOrg();b.getCBEsercizio().setVisible(b.economicaNew);b.getAnnoEsercizio().setVisible(!b.economicaNew);
b.getSaldoPrecBox().setVisible(!b.economicaNew);if(b.economicaNew)b.getCBEsercizio().getStore().load({params:{idOrganizzazione:b.idOrganizzazione},callback:function(c,d,f){f&&getIdEsercizioDefaultByIdOrg(b.idOrganizzazione,function(c){setCombo(b.getCBEsercizio(),c)})}});else{var c=getAnnoEsercizio(),d=b.getAnnoEsercizio(),f=(new Date).getFullYear(),f=f<=c[1]?f:c[1];b.primaVolta=!0;d.setValue(f);d.setMinValue(c[0]);d.setMaxValue(c[1]);b.changeAnnoEsercizio(d,f);b.primaVolta=!1}if(b.cbaConfig.portlet)var g=
b.cbaConfig.portlet.down("grid").getSelectionModel().getSelection()[0];c=g?g.get("codFocl"):null;b.aggiornaStore(c);b.configurePrintButton(this.getBtnRicevuta(),"print");this.getBtnStampa().setDisabled(!0)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.estrattoConto.store.Cauzione",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idRicovero"},{name:"tipoRecord"},{name:"data",type:"date"},{name:"tipoMovimento"},{name:"importo"},{name:"note"},{name:"numFatt"},{name:"dataFatt"},{name:"idAttivita"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/AnagraficaOspiti/impgest/srcbyrcv",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/osp/co/ws/AnagraficaOspiti/impgest/srcbyrcv",create:"/cba/osp/co/ws/AnagraficaOspiti/impgest/new",
update:"/cba/osp/co/ws/AnagraficaOspiti/impgest/update",destroy:"/cba/osp/co/ws/AnagraficaOspiti/impgest/delete"}},autoDestroy:!0});
Ext.define("GeneraliOSP.estrattoConto.store.EditCauzione",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idRicovero"},{name:"tipoRecord"},{name:"data",type:"date"},{name:"tipoMovimento"},{name:"importo"},{name:"note"},{name:"idRecordEsterno"},{name:"condPag"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/AnagraficaOspiti/impgest/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/osp/co/ws/AnagraficaOspiti/impgest/get",create:"/cba/osp/co/ws/AnagraficaOspiti/impgest/new",
update:"/cba/osp/co/ws/AnagraficaOspiti/impgest/update",destroy:"/cba/osp/co/ws/AnagraficaOspiti/impgest/delete"}},autoDestroy:!0});
Ext.define("GeneraliOSP.estrattoConto.store.EditEstrattoConto",{extend:"Ext.data.Store",fields:[{name:"dare"},{name:"avere"},{name:"descriz"},{name:"dataReg",type:"date"},{name:"numReg"},{name:"tipNumReg"},{name:"dataDoc"},{name:"codCau"},{name:"conto"},{name:"tipMov"},{name:"annEse"},{name:"idScadenza"},{name:"idRegistrazione"},{name:"idFattura"},{name:"idAttivita"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/escont/ec/src",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/osp/co/ws/escont/ec/src",
create:"/cba/osp/co/ws/escont/ec/new",update:"/cba/osp/co/ws/escont/ec/update",destroy:"/cba/osp/co/ws/escont/ec/delete"}},autoDestroy:!0});
Ext.define("GeneraliOSP.estrattoConto.store.EstrattoConto",{extend:"Generali.data.StoreJson",fields:[{name:"dare"},{name:"avere"},{name:"descriz"},{name:"dataReg",type:"date"},{name:"numReg"},{name:"tipNumReg"},{name:"desCau"},{name:"tipMov"},{name:"annEse"},{name:"codfocl"},{name:"idRegistrazione"},{name:"idFattura"},{name:"idAttivita"},{name:"condPag"},{name:"desCondPag"},{name:"tipoCausale"}],proxy:{url:"/cba/osp/co/ws/escont/ec/src",api:{read:"/cba/osp/co/ws/escont/ec/src"}}});
Ext.define("GeneraliOSP.estrattoConto.store.Paganti",{extend:"Ext.data.Store",fields:[{name:"codFocl"},{name:"ragioneSociale"},{name:"saldo"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/escont/pgn/src",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.estrattoConto.view.EditCauzione",{extend:"Generali.standard.ControlledContainer",uses:["Generali.standard.stampe.Button"],layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"form",flex:1,padding:10,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 0 10 0"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"label",
itemId:"RifFattura",reference:"RifFattura",hidden:!this.cbaConfig.ecLite,html:""},{xtype:"container",layout:{type:"hbox"},defaults:{margin:"0 5 0 0"},items:[{xtype:"textfield",itemId:"IdRecord",reference:"IdRecord",name:"id",hidden:!0},{xtype:"textfield",name:"idRecordEsterno",itemId:"IdRecordEsterno",reference:"IdRecordEsterno",hidden:!0},{xtype:"datefield",name:"data",itemId:"Data",reference:"Data",fieldLabel:"DATA",allowBlank:!1,labelClsExtra:"cbaLabel",format:"d/m/Y",width:110,margin:"0 20 0 0",
labelAlign:"top"},{xtype:"combobox",itemId:"CbCondPag",reference:"CbCondPag",name:"condPag",fieldLabel:"COND_PAG",labelClsExtra:"cbaLabel",labelAlign:"top",width:250,allowBlank:!this.cbaConfig.ecLite,hidden:!this.cbaConfig.ecLite,queryMode:"local",displayField:"valore",valueField:"codice"},{xtype:"combobox",itemId:"CbMovimento",reference:"CbMovimento",name:"tipoMovimento",width:250,labelAlign:"top",fieldLabel:"CU_MOVIMENTO",labelClsExtra:"cbaLabel",store:Ext.create("Ext.data.Store",{fields:[{name:"codice"},
{name:"valore"}],data:[{codice:5,valore:traduci("CU_RESTITUZIONE")},{codice:4,valore:traduci("CU_VERSAMENTO")}]}),displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:this.cbaConfig.ecLite,hidden:this.cbaConfig.ecLite}]},{xtype:"container",layout:"vbox",items:[{xtype:"fieldset",title:"IMPORTO",items:[{xtype:"numberfield",itemId:"Importo",reference:"Importo",padding:5,width:100,allowBlank:!1,labelClsExtra:"cbaLabel",name:"importo",minValue:0}]}]},{xtype:"textarea",name:"note",fieldLabel:"DESCRIZIONE",
labelClsExtra:"cbaLabel",labelAlign:"top",flex:1,minWidth:275,enforceMaxLength:!0,maxLength:2E3}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",margin:"0 0 5 0"}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.estrattoConto.view.EditEstrattoConto",{extend:"Generali.standard.ControlledContainer",uses:["Generali.standard.stampe.Button"],layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"form",flex:1,padding:10,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox",align:"stretch"},defaults:{margin:"0 0 10 0"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"container",
layout:{type:"hbox"},defaults:{margin:"0 5 0 0"},items:[{xtype:"textfield",itemId:"Id",reference:"Id",name:"id",hidden:!0},{xtype:"textfield",name:"numReg",hidden:!0},{xtype:"textfield",name:"tipNumReg",hidden:!0},{xtype:"textfield",name:"tipMov",hidden:!0},{xtype:"textfield",name:"annEse",hidden:!0},{xtype:"textfield",name:"codfocl",hidden:!0},{xtype:"textfield",name:"idRegistrazione",hidden:!0},{xtype:"datefield",itemId:"Data",reference:"Data",name:"dataReg",allowBlank:!1,labelClsExtra:"cbaLabel",
format:"d/m/Y",width:122,labelAlign:"top"},{xtype:"combobox",itemId:"Attivita",reference:"Attivita",allowBlank:!1,width:150,labelAlign:"top",fieldLabel:"ATTIVITA",labelClsExtra:"cbaLabel",name:"idAttivita",displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"combobox",itemId:"Causale",reference:"Causale",matchFieldWidth:!1,allowBlank:!1,width:145,labelAlign:"top",fieldLabel:"CAUSALE",labelClsExtra:"cbaLabel",name:"codCau",store:Ext.create("Generali.store.CausaleContabilita"),displayField:"valore",
queryMode:"local",valueField:"codice"},{xtype:"combobox",itemId:"Conto",reference:"Conto",allowBlank:!1,width:250,labelAlign:"top",fieldLabel:"CONTO",labelClsExtra:"cbaLabel",name:"conto",store:Ext.create("Generali.store.Conto"),displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"combobox",itemId:"CbCondPag",reference:"CbCondPag",name:"condPag",fieldLabel:"COND_PAG",labelClsExtra:"cbaLabel",labelAlign:"top",width:160,allowBlank:!0,hidden:!0,matchFieldWidth:!1,queryMode:"local",displayField:"valore",
valueField:"codice",listConfig:{width:300,tpl:'<tpl for="."><tpl if="gruppo != null"><hr style="background-color: blue; height: 5px; margin:2px 0 2px; 0"><div style="color:blue;">{gruppo}</div><hr style="background-color: blue; height: 5px; margin:2px 0 2px; 0"><div class="x-boundlist-item">{valore}</div></tpl><tpl if="gruppo == null"><div class="x-boundlist-item">{valore}</div></tpl></tpl>'}},{xtype:"textfield",name:"condPag_cliFor",hidden:!0}]},{xtype:"container",layout:"vbox",items:[{xtype:"fieldset",
title:"IMPORTO",items:[{xtype:"numberfield",padding:5,width:100,allowBlank:!1,labelClsExtra:"cbaLabel",name:"importo"}]}]},{xtype:"gridpanel",itemId:"GridScadenze",reference:"GridScadenze",margin:"0 0 20 0",height:150,width:330,hidden:!0,columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"datecolumn",dataIndex:"dataScadenza",width:90,text:"DATA_SCADENZA",format:"d/m/Y",lockable:!1,sortable:!1,align:"center"},{xtype:"numbercolumn",text:"IMPORTO_SCADENZA",width:120,lockable:!1,sortable:!1,
align:"center",dataIndex:"importoScadenza",renderer:function(b,c,d){return cell_renderer_importo(b,c,d)}},{xtype:"datecolumn",dataIndex:"dataPagamento",format:"d/m/Y",lockable:!1,sortable:!1,align:"center",hidden:!0},{xtype:"numbercolumn",text:"INCASSO",width:120,lockable:!1,sortable:!1,align:"center",dataIndex:"incassoScadenza",editor:{xtype:"numberfield",selectOnFocus:!0},renderer:function(b,c,d){d.get("incassoScadenza")&&0!=d.get("incassoScadenza")||(c.tdCls="bgOrange");c.tdAttr='data-qtip="'+
traduci("CLICK_MODIFICA")+'"';return cell_renderer_importo(b,c,d)}}],viewConfig:{width:330,loadMask:!1},selType:"cellmodel",plugins:[{ptype:"cellediting",clicksToEdit:1,onSpecialKey:function(b,c,d){if(d.getKey()===d.TAB){d.stopEvent();d.position=this.context;if(b)b.onEditorTab(d);c=b.getRefOwner().getSelectionModel();this.completeEdit();return c.onEditorTab(b.editingPlugin,d)}if(d.getKey()===d.UP||d.getKey()===d.DOWN)return d.preventDefault(),!1}}]},{xtype:"textarea",fieldLabel:"DESCRIZIONE",name:"descriz",
enforceMaxLength:!0,maxLength:255,labelClsExtra:"cbaLabel",labelAlign:"top",flex:1}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",margin:"0 0 5 0"}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.estrattoConto.view.TabCauzione",{extend:"Generali.standard.ControlledContainer",uses:["Generali.standard.stampe.Button"],initComponent:function(){var b=this;b.versamento=traduci("CU_VERSAMENTO");b.restituzione=traduci("CU_RESTITUZIONE");Ext.applyIf(b,{items:[{xtype:"gridpanel",flex:1,border:0,itemId:"GridMov",reference:"GridMov",store:Ext.create("GeneraliOSP.estrattoConto.store.Cauzione"),cls:"cba-grid-nowrap",viewConfig:{loadMask:!1},features:[{ftype:"summary",dock:"bottom"}],
dockedItems:[{xtype:"container",layout:{type:"hbox",align:"middle"},padding:2,items:[{xtype:"label",cls:"cbaUtente",itemId:"LbUtente",reference:"LbUtente",margin:"0 20 0 5"},{xtype:"fieldset",cls:CBA.parametriGenerali.tema_zucchetti?"":"bgViolet",layout:{type:"hbox"},defaults:{margin:5},title:"FILTRI",items:[{xtype:"datefield",fieldLabel:"DAL",itemId:"DataDal",reference:"DataDal",labelClsExtra:"cbaLabel",format:"d/m/Y",labelWidth:30,width:140},{xtype:"datefield",fieldLabel:"AL",itemId:"DataAl",reference:"DataAl",
labelClsExtra:"cbaLabel",format:"d/m/Y",labelWidth:30,width:140}]},{xtype:"displayfield",margin:"5 5 5 10",labelWidth:130,fieldLabel:"CU_CAUZIONI_ALTRI",labelClsExtra:"cbaLabel",itemId:"LbCauzioneAltra",reference:"LbCauzioneAltra",hidden:!0}]},{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"newButtonStampa",
itemId:"BtnRicevuta",reference:"BtnRicevuta",iconCls:"icon-ricevuta16",text:"CU_RICEVUTA",disabled:!0,showPreview:!1,scale:"small"},{xtype:"newButtonStampa",itemId:"BtnStampa",reference:"BtnStampa",showPreview:!1,scale:"small"}]}],columns:[{xtype:"datecolumn",dataIndex:"data",text:"DATA",format:"d/m/Y",width:70,align:"center"},{xtype:"gridcolumn",width:120,align:"center",dataIndex:"tipoMovimento",text:"CU_MOVIMENTO",renderer:function(c,d,f){c=4==c?b.versamento:b.restituzione;return cell_renderer_stringa(c,
d)}},{xtype:"gridcolumn",flex:1,align:"center",dataIndex:"note",text:"NOTE",renderer:function(b,d,f){d.tdAttr='data-qtip="'+b+'"';return cell_renderer_stringa(b,d)},summaryRenderer:function(b,d){return'<div class="cbaGrassetto" style= "text-align: right">'+traduci("TOTALE")+"</div>"}},{xtype:"gridcolumn",width:100,align:"center",dataIndex:"importo",text:"IMPORTO",summaryType:"sum",renderer:function(b,d,f){return cell_renderer_importo(b,d)},summaryRenderer:function(b,d){null==b&&(b=0);return'<div class="'+
(0<=b?"":"\tlabelErrore")+'" style= "text-align: right">'+Ext.util.Format.number(b,"0.00,")+"</div>"}}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.estrattoConto.view.TabEstrattoConto",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",layout:"fit",collapsible:!0,collapseDirection:"left",title:"PAGANTE",width:200,items:[{xtype:"gridpanel",itemId:"GridPaganti",reference:"GridPaganti",store:Ext.create("CU.store.PagantiFascicolo"),columns:[{xtype:"gridcolumn",flex:1,dataIndex:"valore"}],viewConfig:{border:0,
loadMask:!1}}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"gridpanel",flex:1,border:0,itemId:"GridMov",reference:"GridMov",store:Ext.create("GeneraliOSP.estrattoConto.store.EstrattoConto"),cls:"cba-grid-nowrap",viewConfig:{loadMask:!1},features:[{ftype:"summary",dock:"bottom"}],dockedItems:[{xtype:"container",layout:{type:"hbox",align:"stretch"},padding:"2 10 2 10",items:[{xtype:"fieldset",cls:CBA.parametriGenerali.tema_zucchetti?"":"bgViolet",layout:{type:"hbox"},
defaults:{margin:5},title:"FILTRI",items:[{xtype:"anno",fieldLabel:"ESERCIZIO",itemId:"AnnoEsercizio",reference:"AnnoEsercizio",labelWidth:60,width:150},{xtype:"combobox",itemId:"CBEsercizio",reference:"CBEsercizio",store:Ext.create("Generali.esercizioCont.store.cboxEsercizioCont",{autoLoad:!1}),labelWidth:70,width:150,fieldLabel:"ESERCIZIO",allowBlank:!1,displayField:"valore",queryMode:"local",valueField:"codice",editable:!1,labelClsExtra:"cbaLabel"},{xtype:"datefield",fieldLabel:"DAL",itemId:"DataDal",
reference:"DataDal",labelClsExtra:"cbaLabel",format:"d/m/Y",labelWidth:30,width:140},{xtype:"datefield",fieldLabel:"AL",itemId:"DataAl",reference:"DataAl",labelClsExtra:"cbaLabel",format:"d/m/Y",labelWidth:30,width:140}]},{xtype:"container",width:44},{xtype:"fieldset",title:"CU_SALDO_PREC",itemId:"SaldoPrecBox",reference:"SaldoPrecBox",layout:{type:"hbox",pack:"middle"},width:150,items:[{xtype:"label",itemId:"SaldoPrec",reference:"SaldoPrec",text:0,margin:"5,0,0,0"}]}]},{xtype:"toolbar",dock:"top",
items:[{xtype:"button",itemId:"BtnIncassa",reference:"BtnIncassa",iconCls:"icon-incasso16",text:"CU_INCASSA",disabled:!0},{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo",disabled:"S"!=b.cbaConfig.permesso,hidden:5==b.cbaConfig.personContabili.tipoContabilitaAbilitata},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-elimina",text:"ELIMINA",disabled:!0,hidden:5!=b.cbaConfig.personContabili.tipoContabilitaAbilitata},{xtype:"newButtonStampa",
itemId:"BtnRicevuta",reference:"BtnRicevuta",iconCls:"icon-ricevuta16",text:"CU_RICEVUTA",disabled:!0,showPreview:!1,scale:"small"},{xtype:"newButtonStampa",itemId:"BtnStampa",reference:"BtnStampa",showPreview:!1,scale:"small"}]}],columns:[{text:"CU_DOCUMENTO",columns:[{xtype:"datecolumn",dataIndex:"dataReg",text:"DATA",format:"d/m/Y",width:70,align:"center",sortable:!1},{xtype:"gridcolumn",dataIndex:"numReg",text:"NUMERO",width:60,align:"center",sortable:!1,renderer:function(b,d,f){b=f.get("tipNumReg")?
b+"/"+f.get("tipNumReg"):b;return cell_renderer_destra(b,d)}}]},{xtype:"gridcolumn",width:100,align:"center",dataIndex:"desCau",text:"CAUSALE",renderer:function(b,d,f){d.tdAttr='data-qtip="'+b+'"';return cell_renderer_stringa(b,d)}},{xtype:"gridcolumn",width:100,align:"center",dataIndex:"desCondPag",text:"COND_PAG"},{xtype:"gridcolumn",flex:1,align:"center",dataIndex:"descriz",text:"DESCRIZIONE",renderer:function(b,d,f){d.tdAttr='data-qtip="'+b+'"';return cell_renderer_stringa(b,d)},summaryRenderer:function(b,
d){return'<div class="cbaGrassetto" style= "text-align: right">'+traduci("TOTALE")+"</div>"}},{xtype:"gridcolumn",width:70,align:"center",dataIndex:"dare",text:"CU_DOC_EMESSI",summaryType:"sum",renderer:function(b,d,f){return cell_renderer_importo(b,d)},summaryRenderer:function(b,d){d.tdCls="cbaGrassetto";return cell_renderer_importo(b,d)}},{xtype:"gridcolumn",width:70,align:"center",dataIndex:"avere",text:"CU_INCASSI",summaryType:"sum",renderer:function(b,d,f){return cell_renderer_importo(b,d)},
summaryRenderer:function(b,d){d.tdCls="cbaGrassetto";return cell_renderer_importo(b,d)}},{xtype:"gridcolumn",width:70,align:"center",dataIndex:"saldo",text:"SALDO",summaryType:"sum",renderer:function(c,d,f,g){b.nessunAmm2=5==b.cbaConfig.personContabili.tipoContabilitaAbilitata;c=f.get("dare")-f.get("avere");c=0<g?c+(Ext.isDefined(b.controller.saldoPrecedente)?b.controller.saldoPrecedente:0):b.nessunAmm2?c+-1*(Ext.isDefined(b.cbaConfig.saldoPrecedenteLbl)?b.cbaConfig.saldoPrecedenteLbl:0):c+(Ext.isDefined(b.cbaConfig.saldoPrecedenteLbl)?
b.cbaConfig.saldoPrecedenteLbl:0);b.controller.saldoPrecedente=Math.round(100*c)/100;0<c&&(d.tdCls="labelErrore");return cell_renderer_importo(c,d)},summaryRenderer:function(b,d){return""}}]}]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.BoxIndirizzi",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"nazione",selector:b+"#nazione"},{ref:"comune",selector:b+"#comune"},{ref:"modifica",selector:b+"#modifica"},{ref:"form",selector:b+"#form"},{ref:"numero",selector:b+"#numero"},{ref:"indirizzo",selector:b+"#indirizzo"},{ref:"interno",selector:b+"#interno"},{ref:"esponente",selector:b+"#esponente"},{ref:"dataDecorrenza",
selector:b+"#dataDecorrenza"},{ref:"cap",selector:b+"#cap"},{ref:"idIndirizzo",selector:b+"#idIndirizzo"},{ref:"cbxTipoIndirizzo",selector:b+"#cbxTipoIndirizzo"},{ref:"cbxCodAsl",selector:b+"#cbxCodAsl"},{ref:"cbxCodAsst",selector:b+"#cbxCodAsst"},{ref:"cbxExCodAsl",selector:b+"#cbxExCodAsl"}]);this.control(b+"#nazione",{change:this.onNazioneChange});this.control(b+"#cbxCodAsl",{select:this.onCodAslSelect});this.control(b+"#comune",{beforequery:this.onFCittaBeforeQuery,select:this.onComuneSelect});
this.control(b+"#modifica",{click:this.onFModificaClick})},impostaAsl:function(b){cbxExCodAsl=this.getCbxExCodAsl();cbxCodAsl=this.getCbxCodAsl();cbxCodAsst=this.getCbxCodAsst();(this.showCodiceAslStorico=this.cbaConfig.visualizzaAsl)?(this.storeAsl=Ext.create("GeneraliOSP.fascicoloNoApp.store.AziendeSanitarie"),this.storeExAsl=this.showCodiceAslStorico?Ext.create("GeneraliOSP.fascicoloNoApp.store.AziendeSanitarie"):null,cbxCodAsl.bindStore(this.storeAsl),cbxCodAsl.show(),this.cbaConfig.visualizzaAsst&&
(this.storeAsst=this.cbaConfig.visualizzaAsst?Ext.create("GeneraliOSP.fascicoloNoApp.store.AziendeSanitarieDettaglio"):null,cbxCodAsst.bindStore(this.storeAsst),cbxCodAsst.show()),this.showCodiceAslStorico&&(this.storeExAsl=Ext.create("GeneraliOSP.fascicoloNoApp.store.AziendeSanitarie"),cbxExCodAsl.bindStore(this.storeExAsl),cbxExCodAsl.show()),ImpostaUrl([this.storeAsl,this.storeExAsl,this.storeAsst])):(cbxCodAsl.hide(),cbxExCodAsl.hide(),cbxCodAsst.hide())},onNazioneChange:function(b,c,d,f){b="0"==
c;c=this.getNumero();d=this.getInterno();f=this.getEsponente();var g=this.getComune(),h=this.getCap(),k=this.getIndirizzo();c.setVisible(b);f.setVisible(b);d.setVisible(b);g.setVisible(b);h.setVisible(b);this.getCbxCodAsl().setVisible(b&&this.cbaConfig.visualizzaAsl);this.getCbxExCodAsl().setVisible(b&&this.showCodiceAslStorico);this.getCbxCodAsst().setVisible(b&&this.cbaConfig.visualizzaAsst);b?(k.readOnly||g.setReadOnly(!1),this.cbaConfig.comuneObbligatorio&&(g.allowBlank=!1)):(g.setReadOnly(!0),
g.allowBlank=!0,c.setValue(null),f.setValue(null),d.setValue(null),g.setValue(null),h.setValue(null),this.getCbxCodAsl().setValue(null),this.getCbxExCodAsl().setValue(null),this.cbaConfig.visualizzaAsl&&(svuotaStore(this.storeAsl),this.cbaConfig.visualizzaAsst&&svuotaStore(this.storeAsst),this.showCodiceAslStorico&&svuotaStore(this.storeExAsl)));g.validateValue(g.getValue())},onFCittaBeforeQuery:function(b,c){if(!b.query)return!1;forceQueryCombo(this.getComune(),2," ")},caricaStoreAsl:function(b,
c,d,f,g){var h=this;h.cbaConfig.visualizzaAsl&&(h.storeAsl.load({params:{codRegione:b},callback:function(d,l,n){n&&!Ext.isEmpty(d)&&(g?h.getCbxCodAsl().setValue(parseInt(c)):setValue(h.getCbxCodAsl(),parseInt(c)),h.cbaConfig.visualizzaAsst&&h.caricaStoreAsst(b,c,f))}}),h.showCodiceAslStorico&&h.storeExAsl.load({params:{codRegione:b,cessato:"T"},callback:function(){setValue(h.getCbxExCodAsl(),parseInt(d))}}))},caricaStoreAsst:function(b,c,d){var f=this;f.storeAsst.load({params:{codRegione:b,codAsl:c},
callback:function(b,h,k){k&&!Ext.isEmpty(b)&&(c?f.getCbxCodAsst().setDisabled(!1):f.getCbxCodAsst().setDisabled(!0),setValue(f.getCbxCodAsst(),d))}})},onCodAslSelect:function(b,c,d){b=null;c=0<c.length?c.data.codice:null;(d=(d=this.getComune().getSelection())?d.data.extra:null)&&2<=d.split(",").length&&(b=d.split(",")[2]);c||(c=this.getCbxCodAsl().getValue());this.caricaStoreAsst(b,c,null)},onComuneSelect:function(b,c,d){c.data?(c=c.data.extra.split(","),this.getCap().setValue(null),b.value&&this.getCap().setValue(c[1]),
this.getCbxCodAsl().setValue(null),this.getCbxExCodAsl().setValue(null),this.cbaConfig.visualizzaAsl&&this.caricaStoreAsl(c[2],c[3],null,c[5],!0)):(this.getCap().setValue(null),this.getCbxCodAsl().setValue(null),this.getCbxExCodAsl().setValue(null))},onFModificaClick:function(b,c,d){Ext.create("winCBA",{permesso:this.cbaConfig.permesso,name:"GeneraliOSP.fascicoloNoApp.view.EditIndirizzi",configItem:{permesso:this.cbaConfig.permesso,codOspite:this.cbaConfig.codOspite,EditDatiAnagrafici:this.cbaConfig.EditDatiAnagrafici},
titolo:"TITOLO_INDIRIZZI",dimensione:2}).show()},abilitaPannello:function(b,c){this.getDataDecorrenza().setReadOnly(!b);this.getIndirizzo().setReadOnly(!b);this.getNumero().setReadOnly(!b);this.getEsponente().setReadOnly(!b);this.getInterno().setReadOnly(!b);this.getComune().setReadOnly(!b);this.getNazione().setReadOnly(!b);this.getCap().setReadOnly(!b);var d=!b||c;this.getModifica().setDisabled(!d)},updateDati:function(b){var c=this;b?(b.dataDecorrenza&&!Ext.isDate(b.dataDecorrenza)&&(b.dataDecorrenza=
Ext.Date.parse(b.dataDecorrenza,"c")),c.getForm().getForm().setValues(b),b.comune&&c.getComune().getStore().load({params:{valore:b.desComune,excom:!0},callback:function(d,f,g){g?(setValue(c.getComune(),b.comune),c.cbaConfig.visualizzaAsl&&(d=d[0].data.extra.split(","),b.is_integrazione?c.caricaStoreAsl(d[2],d[3],null,d[5],!0):c.caricaStoreAsl(d[2],b.codAsl,b.exCodAsl,b.codAsst,!1))):msgShowError("",f.getError())}})):c.svuotaDati()},svuotaDati:function(){clearForm(this.getForm())},updateNazione:function(b){this.getForm().getForm().setValues({nazione:b})},
verificaIndirizzo:function(){var b=[],c=this.getNazione(),d=this.getComune(),f=this.getNumero(),g=this.getIndirizzo(),h=this.getInterno(),k=this.getEsponente();c.getValue()||msgAddError(b,"MSG_IND_ERRORE_NAZIONE");"0"==c.getValue()&&!d.getValue()&&this.cbaConfig.cittaObbligatoria&&msgAddError(b,"MSG_IND_ERRORE_CITTA");f.getValue()&&!g.getValue()&&msgAddError(b,"MSG_IND_ERRORE_INDIRIZZO");h.getValue()&&!f.getValue()?msgAddError(b,"MSG_IND_ERRORE_CIVICO"):k.getValue()&&!f.getValue()&&msgAddError(b,
"MSG_IND_ERRORE_CIVICO");return msgShow("",b)},onLaunch:function(){this.impostaAsl();ImpostaUrl([this.getNazione().getStore(),this.getComune().getStore()]);loadStore(this.getNazione().getStore(),{exnaz:!1});loadStore(this.getComune().getStore(),{excom:!0});this.cbaConfig.nascondiButtonModifica&&this.getModifica().hide();this.cbaConfig.gestioneTipoIndirizzo||this.getCbxTipoIndirizzo().hide();this.cbaConfig.gestioneDataDecorrenza||this.getDataDecorrenza().hide();this.cbaConfig.decorrenzaObbligatorio&&
(this.getDataDecorrenza().allowBlank=!1)},destroy:function(){this.storeTipoIndirizzo&&eliminaStore(this.storeTipoIndirizzo);this.storeAsl&&eliminaStore(this.storeAsl);this.storeExAsl&&eliminaStore(this.storeExAsl);this.storeAsst&&eliminaStore(this.storeAsst);this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.CreaAnagrafica",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"CbIdCategoria",selector:this.selContainer+"#CbIdCategoria"},{ref:"CbxQuintoLivelloCrediti",selector:this.selContainer+"#CbxQuintoLivelloCrediti"},{ref:"CbxIdCondPag",selector:this.selContainer+
"#CbxIdCondPag"},{ref:"TxtIbanCompleto",selector:this.selContainer+"#TxtIbanCompleto"},{ref:"TxtCin",selector:this.selContainer+"#TxtCin"},{ref:"TxtCinEuro",selector:this.selContainer+"#TxtCinEuro"},{ref:"TxtConto",selector:this.selContainer+"#TxtConto"},{ref:"TxtBic",selector:this.selContainer+"#TxtBic"},{ref:"CboxIdBanca",selector:this.selContainer+"#CboxIdBanca"},{ref:"CboxIdSportello",selector:this.selContainer+"#CboxIdSportello"},{ref:"TxtDescrizione",selector:this.selContainer+"#TxtDescrizione"},
{ref:"TxtRidPagante",selector:this.selContainer+"#TxtRidPagante"},{ref:"TxtRidIntestatario",selector:this.selContainer+"#TxtRidIntestatario"},{ref:"TxtRidCodFiscaleIntestatario",selector:this.selContainer+"#TxtRidCodFiscaleIntestatario"},{ref:"TxtRidDelegato",selector:this.selContainer+"#TxtRidDelegato"},{ref:"TxtRidCodFiscaleDelegato",selector:this.selContainer+"#TxtRidCodFiscaleDelegato"},{ref:"TxtRidDataSottoscrizione",selector:this.selContainer+"#TxtRidDataSottoscrizione"},{ref:"DataCondPag",
selector:this.selContainer+"#DataCondPag"},{ref:"infoBtnCondPag",selector:this.selContainer+"#InfoBtnCondPag"}]);this.control(this.selContainer+"#InfoBtnCondPag",{afterrender:this.afterrenderInfoBtnCondPag});this.control(this.selContainer+"#BtnElabora",{click:this.elaboraClick});this.control(this.selContainer+"#BtnEsci",{click:this.esciClick});this.control(this.selContainer+"#CbxIdCondPag",{change:this.changeCbxIdCondPag});this.control(this.selContainer+"#CboxIdBanca",{change:this.changeCboxIdBanca});
this.control(this.selContainer+"#TxtConto",{blur:this.blurTxtConto});this.control(this.selContainer+"#CboxIdSportello",{change:this.changeCboxIdSportello})},afterrenderInfoBtnCondPag:function(b,c){return creaToolTipBubble(b.getId(),"MSG_INFO_CONDPAG_DATAINIZIO","",60,220)},blurTxtConto:function(b,c,d){if(""!=this.getTxtConto().getValue()){for(b=this.getTxtConto().getValue();12>b.length;)b="0"+b;this.getTxtConto().setValue(b)}},changeCbxIdCondPag:function(b,c){var d=this.getCbxIdCondPag(),f=trovaRecord(d.getStore(),
"codice",d.getValue());f&&(d=f.data.extra.split(",")[0],f=f.data.extra.split(",")[1],this.getTxtCin().hide(),this.getTxtCinEuro().hide(),this.getTxtConto().hide(),this.getTxtBic().hide(),this.getCboxIdBanca().hide(),this.getCboxIdSportello().hide(),"T"==d&&(this.getTxtCin().show(),this.getTxtCinEuro().show(),this.getTxtConto().show(),this.getTxtBic().show(),this.getCboxIdBanca().show(),this.getCboxIdSportello().show()),"T"==f&&this.getTxtConto().show())},changeCboxIdBanca:function(b,c){if(!Ext.isNumber(c))return!1;
this.getCboxIdBanca().getValue()&&this.getCboxIdSportello().getStore().load({params:{codAbi:c},callback:function(b,c,g){g||msgShowError("",c.getError())}})},changeCboxIdSportello:function(b,c){if(this.getCboxIdSportello().getValue()&&this.getCboxIdBanca()){var d=this.getCboxIdSportello(),d=trovaRecord(d.getStore(),"codice",d.getValue()),f=this.getCboxIdBanca();strDescrizione=trovaRecord(f.getStore(),"codice",f.getValue()).data.valore+" - "+d.data.valore;this.getTxtDescrizione().setValue(strDescrizione.substr(0,
100))}},checkABICAB:function(b){for(;null!=b&&5>b.length;)b="0"+b;return b},elaboraClick:function(b,c){var d=this;if(!d.getCbxIdCondPag().getValue())return Messaggio("CONFERMA","Selezionare una condizione di pagamento","OK","INFORMATION"),!1;var f=d.cbaConfig.indirizzo,g,h;if(4==d.cbaConfig.personContabili.tipoContabilitaAbilitata||5==d.cbaConfig.personContabili.tipoContabilitaAbilitata)g=d.cbaConfig.comune?d.cbaConfig.comune:currOspite.indResidenza.comune,h=d.cbaConfig.personContabili.idEsercizio;
else if(g=d.cbaConfig.citta,43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo||55==CBA.moduli.moduloAttivo)h=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].serverDate.getFullYear();var k=Ext.isEmpty(d.cbaConfig.codiceFiscale)?null:ControllaCF(d.cbaConfig.codiceFiscale,d.cbaConfig),f={ragioneSociale:d.cbaConfig.ragioneSociale,tipoPagamento:d.getCbxIdCondPag().getValue(),dataCondPag:d.getDataCondPag().getValue(),codiceFiscale:d.cbaConfig.codiceFiscale,indirizzo:f,citta:g,provincia:d.cbaConfig.provincia,
cap:d.cbaConfig.cap,dataIndirizzo:d.cbaConfig.dataIndirizzo,iban:d.getTxtCinEuro().isVisible()?d.getTxtCinEuro().getValue():null,bic:d.getTxtBic().isVisible()?d.getTxtBic().getValue():null,codCIN:d.getTxtCin().isVisible()?d.getTxtCin().getValue():null,codABI:d.getCboxIdBanca().isVisible()&&d.getCboxIdBanca().getValue()?d.checkABICAB(d.getCboxIdBanca().getValue().toString()):null,codCAB:d.getCboxIdSportello().isVisible()&&d.getCboxIdSportello().getValue()?d.checkABICAB(d.getCboxIdSportello().selection.get("extra").split(",")[1]):
null,contoCorrente:d.getTxtConto().isVisible()?d.getTxtConto().getValue():null,desBanca:d.getTxtDescrizione().getValue(),codRID2:d.getTxtRidPagante().isVisible()&&d.getTxtRidPagante().getValue()?d.getTxtRidPagante().getValue():null,codRID:d.getCboxIdSportello().isVisible()&&d.getCboxIdSportello().getValue()?d.getCboxIdSportello().getValue():null,intestatarioRid:d.getTxtRidIntestatario().getValue(),codiceFiscaleRid:d.getTxtRidCodFiscaleIntestatario().getValue(),delegatoRid:d.getTxtRidDelegato().getValue(),
codiceFiscaleDelegatoRid:d.getTxtRidCodFiscaleDelegato().getValue(),dataSottoscrizioneRid:d.getTxtRidDataSottoscrizione().getValue(),codCategoria:d.getCbIdCategoria().getValue(),nazione:d.cbaConfig.nazione,includitracciatoc:"T",tipocontrattoc:"3",personaFisica:k?"T":null,pfCognome:k?d.cbaConfig.cognome:null,pfNome:k?d.cbaConfig.nome:null,pfSesso:k?d.cbaConfig.sesso:null,pfDataNascita:k?d.cbaConfig.dataNascita:null,pfComuneNascita:k?d.cbaConfig.comuneNascita:null,pfNazioneNascita:k?d.cbaConfig.nazioneNascita:
null};g={};Ext.apply(g,{tipoContabilita:d.cbaConfig.personContabili.tipoContabilitaAbilitata,forceStore:Ext.isBoolean(b)&&!0===b?b:!1,forceStoreIBAN:!d.getTxtCin().isVisible()||Ext.isBoolean(c)&&!0===c?!0:!1});d.getCbxQuintoLivelloCrediti().getValue()&&Ext.apply(g,{VLivVendite:d.getCbxQuintoLivelloCrediti().getValue(),AnnoVLivVendite:h});Ext.Ajax.request({method:"POST",url:"/cba/gen/ws/general/anfocl/new",jsonData:f,params:g,success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success)msgShow(traduci("MSG_SALVATAGGIO_DATI"),
"Anagrafica pagante creata correttamente"),d.esciClick();else if(b.message&&b.message[0].testo&&"?"==b.message[0].testo[0]){var c=!d.getTxtCin().isVisible()||0<=b.message[0].testo.indexOf("IBAN")||0<=b.message[0].testo.indexOf("CIN");Ext.Msg.confirm(traduci("WARNING"),b.message[0].testo.slice(1),function(b){"yes"==b&&d.elaboraClick(!0,c)})}else b.message&&msgShowError("",b.message[0].testo)}})},esciClick:function(){this.getBtnEsci().up("window").close()},onLaunch:function(){this.StoreCategCliFor=
Ext.create("Generali.catCliFor.store.cboxCatCliFor");this.getCbIdCategoria().bindStore(this.StoreCategCliFor);this.StoreCategCliFor.load({params:{idOrganizzazione:getIdOrg()},callback:function(){this.filter({filterFn:function(b){return"F"==b.data.extra?!1:!0}})}});this.storePdc=Ext.create("Generali.store.Conto");var b={};if(2==this.cbaConfig.personContabili.tipoContabilitaAbilitata){this.storePdc.getProxy().url="/cba/gen/ws/general/conto/src";var c;43==CBA.moduli.moduloAttivo?c=CBA.moduli.modulo43.serverDate.getFullYear():
50==CBA.moduli.moduloAttivo?c=CBA.moduli.modulo50.serverDate.getFullYear():55==CBA.moduli.moduloAttivo&&(c=CBA.moduli.modulo55.serverDate.getFullYear());Ext.apply(b,{anno:c,riclassificabili:"T"});this.getTxtDescrizione().maxLength=50}else if(4==this.cbaConfig.personContabili.tipoContabilitaAbilitata||5==this.cbaConfig.personContabili.tipoContabilitaAbilitata)this.storePdc.getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(b,{idOrganizzazione:getIdOrg(),idEsercizio:this.cbaConfig.personContabili.idEsercizio}),
this.getTxtDescrizione().maxLength=100,this.getDataCondPag().setVisible(!0),c=CbaDateUtils.startOfYear(new Date),this.getDataCondPag().setValue(c);this.storePdc.getProxy().extraParams=b;this.getCbxQuintoLivelloCrediti().bindStore(this.storePdc);this.storeCondPag=Ext.create("Generali.condizionidipagamento.store.cboxCondPagamento");this.getCbxIdCondPag().bindStore(this.storeCondPag);this.storeCondPag.load();this.getCbxIdCondPag().validate();this.getTxtRidPagante().setVisible(2==this.cbaConfig.personContabili.tipoContabilitaAbilitata)},
destroy:function(){this.StoreCategCliFor&&eliminaStore(this.StoreCategCliFor);this.storePdc&&eliminaStore(this.storePdc);this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.DatiAggiuntivi",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"ContainerDatiAggiuntivi",selector:b+"#ContainerDatiAggiuntivi"},{ref:"GridRicoveri",selector:b+"#GridRicoveri"}]);this.control(b+"#ContainerDatiAggiuntivi",{render:this.renderContainerDatiAggiuntivi});this.control(b+"#GridRicoveri",{select:this.updatePortlet})},openEditServizi:function(b){var c=this,
d=c.cbaConfig.controllerFascicolo;Ext.create("winCBA",{permesso:d.cbaConfig.permessoEditServizi,name:"GeneraliOSP.fascicoloNoApp.view.EditServizi",titolo:traduci("TITOLO_EDITSERVIZI"),nominativo:currOspite.nominativo,altezzaWin:700,larghezzaWin:1024,configItem:{permesso:d.cbaConfig.permessoEditServizi,idRicovero:currRicovero?currRicovero.idRicovero:null,codOspite:d.currentDip,ricerca:d.Ricerca,classificazionePresente:currRicovero?currRicovero.classificazionePresente:null,EditDatiAggiuntivi:c,nuovo:b},
listeners:{close:function(b){c.update(currOspite)}}}).show();b=!1;null!=currRicovero&&(b=48==getModuloAttivo()?"L"!=currRicovero.servizio.tipoServizio:50==getModuloAttivo()?"A"!=currRicovero.servizio.tipoServizio:64==getModuloAttivo()?"B"!=currRicovero.servizio.tipoServizio:"R"!=currRicovero.servizio.tipoServizio&&"G"!=currRicovero.servizio.tipoServizio&&"S"!=currRicovero.servizio.tipoServizio&&"M"!=currRicovero.servizio.tipoServizio&&"D"!=currRicovero.servizio.tipoServizio)&&(b=trovaRecord(Sipcar.app.getController("Login").storeModuli,
"codice",getModuloAttivo(),!1).getData().valore,b=traduci("SERV_NON_SELEZIONABILE",[currRicovero.servizio.descrizione,b]),Messaggio("ATTENZIONE",b,"OK","WARNING"))},renderContainerDatiAggiuntivi:function(b){var c=this;creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET");b.el.on("dblclick",function(){c.cbaConfig.controllerFascicolo&&c.cbaConfig.controllerFascicolo.currentDip?c.openEditServizi(!1):Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")})},update:function(b){var c="",
d="";try{c=b?b.get("codOspite"):"",d=b?b.get("idRicovero"):""}catch(f){c=b.codOspite,d=currOspite&&currOspite.ricovero?currOspite.ricovero.idRicovero:0<b.ricoveriAttivi.length?b.ricoveriAttivi[0].get("idRicovero"):0}this.updateRicovero(c,d)},updateRicovero:function(b,c){var d=this,f="*";48==getModuloAttivo()?f="L":43==getModuloAttivo()&&(f="R,G,S,M,D,L,B");d.getGridRicoveri().getStore().load({params:{codospite:b,tipoServizio:f},callback:function(b,f,k){k?Ext.isEmpty(b)?d.updatePortlet():(b=d.getGridRicoveri(),
k=b.getStore(),f=trovaButtonMenu("btnOSP_Anagrafica"),!f||!f.cbaConfig.cmdName||"CU_DOC_IN_SCADENZA"!=f.cbaConfig.cmdName&&"CU_DOC_SCADUTO"!=f.cbaConfig.cmdName&&"CU_APRI_FASCICOLO"!=f.cbaConfig.cmdName||Ext.isEmpty(f.cbaConfig.idRicovero)?k=trovaRecord(k,"idRicovero",c):(k=trovaRecord(k,"idRicovero",f.cbaConfig.idRicovero),f.cbaConfig.idRicovero=null),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(k?[k]:0)):msgShowError("",f.getError())}})},updatePortlet:function(b,c,d,f){b=this.cbaConfig.controllerFascicolo;
var g=!1;c?(currRicovero=c.data,b.currentAss=c.get("idRicovero"),b.idRicovero=c.get("idRicovero"),b.currentDip=c.get("codOspite"),b.currentServizio=c.get("idServizio"),b.currentServizioDal=c.get("dataDal"),g="L"==currRicovero.servizio.tipoServizio,b.datiPrincipali.controller.aggiornaStatoUtente(c)):currRicovero=null;Ext.each(b.getContainer().query("portlet"),function(b){43==getModuloAttivo()&&b.setVisible(!(("Portlet_Classificazioni"==b.items.items[0].itemId||"Portlet_Denaro"==b.items.items[0].itemId||
"Portlet_Pensioni"==b.items.items[0].itemId||"Portlet_EstrattoConto"==b.items.items[0].itemId)&&g));(b=b.down("#Container"))&&b.controller&&b.controller.updatePortlet&&b.controller.updatePortlet()})},addMenuShortcut:function(){var b=this;StdSipcar.modAggIsEnable(getIdOrg(),"GE_ROBYONECONSOLE",function(c){c=Ext.JSON.decode(c.responseText);c.success&&c.data&&(c=Ext.create("Ext.menu.Menu",{items:[{text:traduci("SINCRONIZZA")+" "+traduci("ANAGRAFICA")+" "+traduci("ROBYONE_ONEDATA"),iconCls:"icon-refresh",
handler:function(c){codOspite=this.up("menu").record.get("codOspite");StdSipcar.forceSync({tipoSipcar:"U",lstIdSipcar:codOspite,reSyncAnag:"T"},b,null)}}]}),b.getGridRicoveri().menuShortcut=c)})},onLaunch:function(){ImpostaUrl([this.getGridRicoveri().getStore()]);this.getContainerDatiAggiuntivi().controller=this;this.addMenuShortcut()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.DatiPrincipali",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"ContainerDatiPrincipali",selector:b+"#ContainerDatiPrincipali"},{ref:"Nominativo",selector:b+"#Nominativo"},{ref:"CicloScolastico",selector:b+"#CicloScolastico"},{ref:"CodFisc",selector:b+"#CodFisc"},{ref:"DatiNascita",selector:b+"#DatiNascita"},{ref:"DatiRes",selector:b+"#DatiRes"},{ref:"gda_StatoUtente",
selector:b+"#gda_StatoUtente"},{ref:"prtFronteSpizio",selector:b+"#prtFronteSpizio"}]);this.control(b+"#ContainerDatiPrincipali",{render:this.renderContainerDatiPrincipali});this.control(b+"#prtFronteSpizio",{click:this.getDataFronteSpizio})},doPrintFronteSpizio:function(b,c,d){var f=b.down("form"),g=f.getValues().tipoFronteSpizio,h=f.getValues().esponiSuAccettazione,k=b.down("#dataStampa").getValue(),l=b.down("#descrizione1").getValue(),n=b.down("#descrizione2").getValue();b=b.down("#vailate").getValue();
var p=f.erroreBloccante,f=f.salvaDescr;d&&!p&&showWinStampa(CBA.moduli.moduloAttivo,CBA.parametriGenerali.codEnte,"CU_Frontespizio",{configBtnStampa:{reportDaEsportare:!1,hideCsv:!0,hideXls:!0,hideExcel:!0,hideText:!0,params:{format:"PDF",elencoRicoveri:d,dataStampa:k,descrizione1:l,descrizione2:n,vailate:b,salvaDescr:f?"T":"F",esponiDataIngresso:h,tipoFronteSpizio:g}},eseguiStampa:!0,elencoUtenti:c,format:"PDF",elencoRicoveri:d,dataStampa:k,descrizione1:l,descrizione2:n,esponiDataIngresso:h})},getDataFronteSpizio:function(){var b=
this,c=b.cbaConfig.controllerFascicolo.currentDip,d=b.cbaConfig.controllerFascicolo.idRicovero,f=null;Ext.Ajax.request({method:"GET",url:"/cba/osp/co/ws/prszn/osperson/vailate",timeout:18E5,success:function(g){g=Ext.JSON.decode(g.responseText);g.success?(f=g.data,g=Ext.create("winCBA",{name:"GeneraliOSP.fascicoloNoApp.view.Frontespizio",titolo:"Stampa Frontespizio",height:"G"==f?300:200,width:350,configItem:{permesso:"S",cliente:f},listeners:{afterrender:function(f,g){f.getEl().on("keydown",function(g,
h,k){g.getKey()===g.ENTER&&(b.doPrintFronteSpizio(f,c,d),f.close())})}},closable:!0}),g.on("close",function(f){b.doPrintFronteSpizio(f,c,d)}),g.show()):msgShowError("",g.message)}})},openEditFascicolo:function(b,c){var d=this.cbaConfig.controllerFascicolo;Ext.create("winCBA",{permesso:d.cbaConfig.permesso,name:"GeneraliOSP.fascicoloNoApp.view.EditFascicolo",titolo:b?"TITOLO_NUOVO_UTENTE":"TITOLO_MODIFICA_UTENTE",nominativo:b?null:"undefined"!==typeof currOspite?currOspite.nominativo:null,altezzaWin:700,
larghezzaWin:1024,configItem:{permesso:d.cbaConfig.permesso,controllerFascicolo:d,nuovo:b,recordIntegrazione:c,desVideata:traduci("ANAGRAFICA")}}).show()},renderContainerDatiPrincipali:function(b){var c=this;creaToolTip(b.down("container").getId(),"MSG_DBLCLICK_PORTLET");b.el.on("dblclick",function(){c.cbaConfig.controllerFascicolo&&c.cbaConfig.controllerFascicolo.currentDip?c.openEditFascicolo(!1):Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")})},updateFoto:function(b){var c=
this.cbaConfig.controllerFascicolo.getContainer().down("#Foto").down("#FotoDip");b?(c.urlSrc=getUrlGen()+"/ws/genOsp/foto/get?codospite="+b,c.urlUpload=getUrlGen()+"/ws/genOsp/foto/upload?codospite="+b,c.urlDelete=getUrlGen()+"/ws/genOsp/foto/delete?codospite="+b,setSrcImage(c,c.urlSrc+"&date="+Ext.Date.now())):(setSrcImage(c,CBA.parametriGenerali.defaultUserPic),Ext.getCmp(c.getId()+"Tooltip")&&setSrcImage(Ext.getCmp(c.getId()+"Tooltip"),CBA.parametriGenerali.defaultUserPic))},updateResidenza:function(b){b?
(b='<span class="cbaLabelDatiUtente">'+traduci("RESIDENZA")+':</span> &nbsp; <span class="cbaGrassetto">'+(b.indirizzo?b.indirizzo:"")+(b.civico?'<span  class="cbaLabelDatiUtente"> '+traduci("PO_DA_NUMERO")+" </span>"+b.civico:"")+(b.esponente?"/"+b.esponente:"")+(b.interno?'<span  class="cbaLabelDatiUtente"> '+traduci("PO_DA_INTERNO")+" </span>"+b.interno:"")+(b.cap?' &nbsp; <span  class="cbaLabelDatiUtente"> '+traduci("PO_DA_CAP")+" </span>"+b.cap:"")+(b.frazione?' &nbsp; <span  class="cbaLabelDatiUtente"> '+
traduci("FRAZIONE")+':</span> &nbsp; <span class="cbaGrassetto">'+b.frazione:"")+(b.desComune?"  &nbsp; "+b.desComune+" ("+b.provincia+")":"")+(b.desNazione?" - "+b.desNazione:""),this.getDatiRes().update(b)):this.getDatiRes().setText("")},update:function(b){this.updateUtente(b?b.get("codOspite"):"")},updateUtente:function(b){var c=this,d=c.cbaConfig.controllerFascicolo;d.currentDip=b;d.abilitaButtonFoto();if(b){var f=[];50==getModuloAttivo()&&Ext.create("CU.store.CicloScolastico").load({callback:function(b,
c,d){f=b}});c.storeOspite.load({params:{id:b},callback:function(d,h,k){if(k){h=d[0];currOspite=d[0].data;c.updateFoto(b);c.getNominativo().setText(h.get("nominativo"));c.getNominativo().removeCls("icon-it");c.getNominativo().removeCls("icon-de");c.getNominativo().removeCls("icon-en");Ext.isEmpty(h.get("lingua"))||c.getNominativo().addCls("icon-"+h.get("lingua").toLowerCase());if(50==getModuloAttivo()&&0<h.data.ricoveriAttivi.length){var g="",n=h.data.ricoveriAttivi[0]?h.data.ricoveriAttivi[0].idCicloScolastico:
null;Ext.each(f,function(b){b.get("codice")==n&&(g='&nbsp;&nbsp;&nbsp; <span class="cbaLabelDatiUtente">'+traduci("CICLO_SCOLASTICO")+'</span> &nbsp; <span class="cbaGrassetto">',g+=b.get("valore"),b=c.getNominativo().text,c.getNominativo().update(b+g))})}c.getCodFisc().update('<span class="cbaLabelDatiUtente">'+c.desCodFisc+'</span> &nbsp; <span class="cbaGrassetto">'+h.get("codiceFiscale"));c.getDatiNascita().update('<span class="cbaLabelDatiUtente">'+c.desNatoIl+'</span> &nbsp; <span class="cbaGrassetto">'+
FormattaData(h.get("dataNascita"))+(h.get("desComuneNascita")?'</span> &nbsp; <span class="cbaLabelDatiUtente"> '+c.desNatoA+'</span> &nbsp; <span class="cbaGrassetto">'+h.get("desComuneNascita")+"&nbsp"+(h.get("desProvinciaNascita")?"("+h.get("desProvinciaNascita")+")":""):"")+(h.get("desNazioneNascita")?'<span class="cbaGrassetto"> - </span>'+h.get("desNazioneNascita")+'<span class="cbaGrassetto"></span>':""));c.updateResidenza(h.get("indResidenza"));(d=trovaButtonMenu("btnOSP_Anagrafica"))&&d.cbaConfig.cmdName&&
"FAR_ANAGRAFICA_CF"==d.cbaConfig.cmdName&&(d.cbaConfig.cmdName=null,c.openEditFascicolo(!1))}else msgShowError("",h.getError())}})}else c.getNominativo().setText(""),c.getCodFisc().setText(""),c.getDatiNascita().setText(""),c.updateResidenza(),c.updateFoto()},aggiornaStatoUtente:function(b){var c=this,d=c.getGda_StatoUtente(),f=c.getPrtFronteSpizio();if(!b)return!1;if(!c.cbaConfig.controllerFascicolo.currentDip)return this.hide(),!1;if(48==getModuloAttivo())return d.hide(),!1;var g=Ext.create("GeneraliOSP.fascicoloNoApp.store.Assenza");
ImpostaUrl(g);g.load({params:{idRicovero:b.get("idRicovero")},callback:function(g,k,l){k=!1;g&&0<g.length&&g[0].data&&(k=g[0].data);d.show();f.frontespizio&&f.show();d.removeCls("utentePresenze");d.removeCls("utenteVacanza");d.removeCls("utenteFamiglia");d.removeCls("utenteOspedale");d.removeCls("utenteDimesso");d.removeCls("utenteFuturo");b.get("dataAl")&&b.get("dataAl")<new Date?(d.addCls("utenteDimesso"),g=traduci("PO_DA_SERVIZIO_TERMINATO_IL")+" "+FormattaData(b.get("dataAl")),b.get("desMotivoDimissione")&&
(g=g+" "+traduci("PO_DA_SERVIZIO_CAUSA")+" "+b.get("desMotivoDimissione")),b.get("descrDimissione")&&(g=g+" - "+b.get("descrDimissione"))):b.get("dataDal")>new Date?(d.addCls("utenteFuturo"),g=traduci("PO_DA_SERVIZIO_FUTURO")+" "+FormattaData(b.get("dataDal"))):k?("O"==k.tipoUscita||"R"==k.tipoUscita?d.addCls("utenteOspedale"):"V"==k.tipoUscita?d.addCls("utenteVacanza"):d.addCls("utenteFamiglia"),g=traduci("PO_DA_ATTUALMENTE_ASSENTE_DAL")+" "+FormattaData(k.dataDal)+" - "+k.desMotivoUscita):(d.addCls("utentePresente"),
g=traduci("PO_DA_ATTUALMENTE_PRESENTE"));c.toolTipVarie&&c.toolTipVarie.destroy();g='<span class="cbaLabelDatiUtente"> '+traduci("STATO")+"</span>:&nbsp; "+g;"undefined"===typeof currRicovero||Ext.isEmpty(currRicovero.desMedicoInterno)&&Ext.isEmpty(currRicovero.desMedicoMMG)&&Ext.isEmpty(currRicovero.responsabileRicovero)||(g+='<P><TABLE><TR><TD colspan="2" align="center"><B>'+traduci("DATI_AGGIUNTIVI").toUpperCase()+"</B></TD></TR>"+(Ext.isEmpty(currRicovero.responsabileRicovero)?"":'<TR><TD><span class="cbaLabelDatiUtente">'+
traduci("RESPONSABILE_RICOVERO")+"</span></TD><TD>"+currRicovero.responsabileRicovero+"</TD></TR>")+(Ext.isEmpty(currRicovero.desMedicoInterno)?"":'<TR><TD><span class="cbaLabelDatiUtente">'+traduci("MEDICO")+" "+traduci("INTERNO")+"</span></TD><TD>"+currRicovero.desMedicoInterno+"</TD></TR>")+(Ext.isEmpty(currRicovero.desMedicoMMG)?"":'<TR><TD><span class="cbaLabelDatiUtente">'+traduci("MEDICO_MEDICINA_GEN")+"</span></TD><TD>"+currRicovero.desMedicoMMG+"</TD></TR>")+"</TABLE>");c.toolTipVarie=setToolTip(d.id,
d.getEl(),g)}})},abilitaTastoFronteSpizio:function(){var b=this.getPrtFronteSpizio();Ext.Ajax.request({method:"GET",url:getUrlGen()+"/auth/extraFn/isEnabled",params:{codiceFunzione:"CU_FRONTESP"},success:function(c){c=Ext.JSON.decode(c.responseText);b.frontespizio=c.success&&c.data?!0:!1}})},onLaunch:function(){this.desCodFisc=traduci("CODICE_FISCALE");this.desNatoIl=traduci("NATO_IL");this.desNatoA=traduci("NATO_A");this.storeOspite=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite");ImpostaUrl([this.storeOspite]);
this.getContainerDatiPrincipali().controller=this;this.abilitaTastoFronteSpizio()},destroy:function(){eliminaStore(this.storeOspite);this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.DatiPrincipaliUtente",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DatiPrincipaliUtente",selector:this.selContainer+"#DatiPrincipaliUtente"},{ref:"pnlDati",selector:this.selContainer+"#pnlDati"},{ref:"gda_Dati1",selector:this.selContainer+"#gda_Dati1"},{ref:"gda_Dati2",selector:this.selContainer+"#gda_Dati2"},{ref:"gda_Dati3",selector:this.selContainer+
"#gda_Dati3"},{ref:"gda_Dati4",selector:this.selContainer+"#gda_Dati4"},{ref:"gda_Dati5",selector:this.selContainer+"#gda_Dati5"},{ref:"gda_Dati6",selector:this.selContainer+"#gda_Dati6"},{ref:"gda_Nome",selector:this.selContainer+"#gda_Nome"},{ref:"gda_StatoUtente",selector:this.selContainer+"#gda_StatoUtente"}]);this.control(this.selContainer+"#DatiPrincipaliUtente",{afterrender:this.onDatiPrincipaliUtenteAfterRender});this.control(this.selContainer+"#DatiPrincipaliUtente",{resize:this.onDatiPrincipaliUtenteResize});
this.control(this.selContainer+"#gda_StatoUtente",{afterrender:this.onGda_StatoUtenteAfterRender1});this.callParent()},onDatiPrincipaliUtenteAfterRender:function(b,c){var d=this;ToolTipPortlet(b.getEl());d.getDatiPrincipaliUtente().el.on("dblclick",function(){"undefined"!=typeof currOspite&&(void 0===currOspite&&(currOspite=lastOspite),Ext.create("winCBA",{permesso:d.cbaConfig.permesso,name:"GeneraliOSP.fascicoloNoApp.view.EditFascicolo",titolo:"TITOLO_MODIFICA_UTENTE",altezzaWin:700,larghezzaWin:1024,
configItem:{permesso:d.cbaConfig.permesso,currOspite:currOspite,nuovo:d.cbaConfig.nuovo,desVideata:traduci("ANAGRAFICA")}}).show())})},onDatiPrincipaliUtenteResize:function(b,c,d,f){this.getGda_StatoUtente().setPosition(this.getDatiPrincipaliUtente().getWidth()-65,0)},onGda_StatoUtenteAfterRender1:function(b,c){b.hide();this.getGda_StatoUtente().setSrc(Ext.BLANK_IMAGE_URL)},updateDatiAnagrafici:function(b,c){this.getGda_Nome().setText("");this.getGda_Dati1().setText("");this.getGda_Dati2().setText("");
this.getGda_Dati3().setText("");this.getGda_Dati4().setText("");this.getGda_Dati5().setText("");this.getGda_Dati6().setText("");if(!Ext.isEmpty(b)){c?this.getGda_Nome().setText(b.nominativo):this.getGda_Nome().setText(b.cognome+" "+b.nome);b.codiceFiscale&&(this.getGda_Dati1().setText(this.desCodFisc),this.getGda_Dati2().setText(b.codiceFiscale));var d;b.dataNascita&&(this.getGda_Dati3().setText(this.desNatoIl),d=FormattaData(b.dataNascita)+(b.desComuneNascita?' <span  class="cbaLabelDatiUtente"> '+
this.desNatoA+" </span> "+b.desComuneNascita:"")+(b.desProvinciaNascita?" ("+b.desProvinciaNascita+")":"")+(b.desNazioneNascita?" - "+b.desNazioneNascita:""),this.getGda_Dati4().update(d));if(d=b.indResidenza)this.getGda_Dati5().setText(traduci("PO_DA_RESIDENZA")),d=(d.indirizzo?d.indirizzo:"")+(d.civico?'<span  class="cbaLabelDatiUtente"> '+traduci("PO_DA_NUMERO")+" </span>"+d.civico:"")+(d.esponente?" /"+d.esponente:"")+(d.interno?'<span  class="cbaLabelDatiUtente"> '+traduci("PO_DA_INTERNO")+" </span>"+
d.interno:"")+(d.cap?'<span  class="cbaLabelDatiUtente"> '+traduci("PO_DA_CAP")+" </span>"+d.cap:"")+(d.desComune?" "+d.desComune+" ("+d.provincia+")":"")+(d.desNazione?" - "+d.desNazione:""),this.getGda_Dati6().update(d)}},aggiorna:function(b){if(!currRicovero)return this.hide(),!1;var c=Ext.getCmp("GridServizi").controller.getGridRicoveri().getStore().getAt(0).data;if(currRicovero.idRicovero!=c.idRicovero)return!1;this.show();this.removeCls("utentePresenze");this.removeCls("utenteVacanza");this.removeCls("utenteFamiglia");
this.removeCls("utenteOspedale");this.removeCls("utenteDimesso");c.dataAl?(this.addCls("utenteDimesso"),b=traduci("PO_DA_SERVIZIO_TERMINATO_IL")+" "+FormattaData(c.dataAl),c.desMotivoDimissione&&(b=b+" "+traduci("PO_DA_SERVIZIO_CAUSA")+" "+c.desMotivoDimissione),c.descrDimissione&&(b=b+" - "+c.descrDimissione)):b?("O"==b.tipoUscita?this.addCls("utenteOspedale"):"F"==b.tipoUscita?this.addCls("utenteFamiglia"):"V"==b.tipoUscita&&this.addCls("utenteVacanza"),b=traduci("PO_DA_ATTUALMENTE_ASSENTE_DAL")+
" "+FormattaData(b.dataDal)+" - "+b.desMotivoUscita):(this.addCls("utentePresente"),b=traduci("PO_DA_ATTUALMENTE_PRESENTE"));setToolTip("gda_StatoUtente",Ext.getCmp("gda_StatoUtente").getEl(),b)},aggiornaDenaro:function(b,c){if(!b)return this.hide(),!1;this.show();var d;this.removeCls("utentePresenze");this.removeCls("utenteVacanza");this.removeCls("utenteFamiglia");this.removeCls("utenteOspedale");this.removeCls("utenteDimesso");b.dataAl?(this.addCls("utenteDimesso"),d=traduci("PO_DA_SERVIZIO_TERMINATO_IL")+
" "+FormattaData(b.dataAl),b.desMotivoDimissione&&(d=d+" "+traduci("PO_DA_SERVIZIO_CAUSA")+" "+b.desMotivoDimissione),b.descrDimissione&&(d=d+" - "+b.descrDimissione)):c?("O"==c.tipoUscita?this.addCls("utenteOspedale"):"F"==c.tipoUscita?this.addCls("utenteFamiglia"):"V"==c.tipoUscita&&this.addCls("utenteVacanza"),d=traduci("PO_DA_ATTUALMENTE_ASSENTE_DAL")+" "+FormattaData(c.dataDal)+" - "+c.desMotivoUscita):(this.addCls("utentePresente"),d=traduci("PO_DA_ATTUALMENTE_PRESENTE"));setToolTip("gda_StatoUtente",
Ext.getCmp("gda_StatoUtente").getEl(),d)},onLaunch:function(){this.desCodFisc=traduci("CODICE_FISCALE");this.desNatoIl=traduci("NATO_IL");this.desNatoA=traduci("NATO_A")}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditDatiAnagrafici",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"Form",selector:c+"#Form"},{ref:"BoxBottoni",selector:c+"#BoxBottoni"},{ref:"aComuneNascita",selector:c+"#aComuneNascita"},{ref:"aNazioneNascita",selector:c+"#aNazioneNascita"},{ref:"aCittadinanza",selector:c+"#aCittadinanza"},{ref:"aReligione",selector:c+
"#aReligione"},{ref:"aStatoCivile",selector:c+"#aStatoCivile"},{ref:"aProfessione",selector:c+"#aProfessione"},{ref:"aGradoIstruzione",selector:c+"#aGradoIstruzione"},{ref:"CbTipoSoggetto",selector:c+"#CbTipoSoggetto"},{ref:"btnModificaCF",selector:c+"#btnModificaCF"},{ref:"btnCalcolatrice",selector:c+"#btnCalcolatrice"},{ref:"btnModificaCS",selector:c+"#btnModificaCS"},{ref:"btnTEAM",selector:c+"#btnTEAM"},{ref:"btnTICKET",selector:c+"#btnTICKET"},{ref:"btnMedici",selector:c+"#btnMedici"},{ref:"aCodiceFiscale",
selector:c+"#aCodiceFiscale"},{ref:"aDataIngresso",selector:c+"#aDataIngresso"},{ref:"aOraIngresso",selector:c+"#aOraIngresso"},{ref:"aCognome",selector:c+"#aCognome"},{ref:"aSesso",selector:c+"#aSesso"},{ref:"aNote",selector:c+"#aNote"},{ref:"btnLingua",selector:c+"#btnLingua"},{ref:"infoBtnLingua",selector:c+"#infoBtnLingua"}]);b.control(c+"#infoBtnLingua",{afterrender:b.afterrenderInfoBtnLingua});b.control(c+"#aComuneNascita",{beforequery:b.on_aComuneNascitaBeforeQuery});b.control(c+"#aNazioneNascita",
{change:b.onANazioneNascitaChange});b.control(c+"#aCittadinanza",{change:b.onACittadinanzaChange});b.control(c+"#CbTipoSoggetto",{change:b.onCbTipoSoggettoChange});b.control(c+"#btnCalcolatrice",{click:b.onCalcClick});b.control(c+"#btnModificaCF",{click:b.onModificaStoricoInfoUtente});b.control(c+"#btnModificaCS",{click:b.onModificaStoricoInfoUtente});b.control(c+"#btnTEAM",{click:b.onBtnTeamClick});b.control(c+"#btnTICKET",{click:b.onBtnTicketClick});b.control(c+"#btnMedici",{click:b.onBtnMediciClick});
b.control(c+"#btnLingua",{click:b.clickBtnLingua});b.on({avanti:function(){return b.avanti()},changeTab:function(){return b.changeTab()},esci:function(){b.getForm().boxBottoni.queryById("btnEsci").handler()}})},afterrenderInfoBtnLingua:function(b,c){return creaToolTipBubble(b.getId(),"MSG_INFO_LINGUA_OSPITE","",45,260)},clickBtnLingua:function(b,c,d){this.winLingua||(this.winLingua=Ext.create("winCBA",{name:"GeneraliOSP.fascicoloNoApp.view.WinLingue",titolo:traduci("GESTIONE_LINGUA"),larghezzaWin:500,
altezzaWin:150,configItem:{controllerMain:this,hideFiltriBase:!0}}));this.winLingua.showAt(b.getX()-250+b.getWidth()/2,b.getY()+b.getHeight())},verificaCampiForm:function(){var b=[];this.getForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow(traduci("DATI_ANAGRAFICI"),b);return 0==b.length?!0:!1},verificaCodFiscale:function(){var b=this,c=[],d=b.getForm().getForm().findField("codiceFiscale").getValue();this.calcolaCodFisc()!=d?(msgAddWarning(c,"MSG_CF_NON_VALIDO"),msgShow("ATTENZIONE",
c,"OK",function(){b.oldCF=b.getACodiceFiscale().getValue();b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&!b.currentDip?b.aggiornaStore():b.changeTab()})):b.oldCF=b.getACodiceFiscale().getValue();return 0==c.length?!0:!1},generaMessaggio:function(b){var c=!1,d=b.message[0].testo.trim().split("\n");1<d.length&&(c=!0,msgShowWarning("ATTENZIONE",d));c||msgShow("MSG_SALVATAGGIO_DATI",b.message)},salva:function(b,c,d){var f=this,g=49===CBA.moduli.moduloAttivo,h=null;if(!f.verificaCampiForm())return!1;
if(f.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&!f.currentDip)if(g)if(!f.cbaConfig.versioneAnagrafica){if(!f.cbaConfig.controllerUltDati.verificaCampiForm()||!f.cbaConfig.controllerTipologieCartella.verificaCampiForm())return!1}else{if(!(1!=f.cbaConfig.versioneAnagrafica||f.cbaConfig.controllerUltDati.verificaCampiForm()&&f.cbaConfig.controllerTipologieCartella.verificaCampiForm()))return!1}else if(!f.cbaConfig.controllerServizi.verificaCampiForm()||!f.cbaConfig.controllerIndirizzi.verificaCampiForm())return!1;
if(f.oldCF!=f.getACodiceFiscale().getValue()&&!f.verificaCodFiscale())return!1;var h="0"!=f.getACittadinanza().getValue()||Ext.isEmpty(f.getCbTipoSoggetto().getValue())?f.getForm().getForm().findField("stp").getValue():"F",h={nome:f.getForm().getForm().findField("nome").getValue(),cognome:f.getForm().getForm().findField("cognome").getValue(),dataNascita:f.getForm().getForm().findField("dataNascita").getValue(),note:f.getForm().getForm().findField("note").getValue(),statoCivile:f.getForm().getForm().findField("statoCivile").getValue(),
gradoIstruzione:f.getForm().getForm().findField("gradoIstruzione").getValue(),sesso:f.getASesso().getValue().sesso,professione:f.getForm().getForm().findField("professione").getValue(),codiceFiscale:f.getForm().getForm().findField("codiceFiscale").getValue(),comuneNascita:f.getForm().getForm().findField("comuneNascita").getValue(),codiceSanitario:f.getForm().getForm().findField("codiceSanitario").getValue(),stp:h,numFigliMaschi:f.getForm().getForm().findField("numFigliMaschi").getValue(),numFigliFemm:f.getForm().getForm().findField("numFigliFemm").getValue(),
nazioneNascita:f.getForm().getForm().findField("nazioneNascita").getValue(),cittadinanza:f.getForm().getForm().findField("cittadinanza").getValue(),idReligione:f.getForm().getForm().findField("idReligione").getValue(),lingua:f.lookup("txtLingua").getValue()},k=f.cbaConfig.controllerUltDati.leggiDatiForm();Ext.apply(h,k);var k=f.currentDip?f.currentDip:null,l=null,n=null;if(f.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&!f.currentDip)if(g)if(f.cbaConfig.versioneAnagrafica)1==f.cbaConfig.versioneAnagrafica&&
(p=f.cbaConfig.controllerTipologieCartella,n=p.getServizioDataDal().getValue(),n.setHours(Ext.util.Format.date(p.getServizioOraIngresso().getValue(),"H"),Ext.util.Format.date(p.getServizioOraIngresso().getValue(),"i")),n={id:"-9999",idProfilo:f.cbaConfig.controllerTipologieCartella.getTipoServizio().getValue(),dal:n});else{var n=f.cbaConfig.controllerTipologieCartella,p=n.getServizioDataDal().getValue(),q=n.getServizioDataAl().getValue();p.setHours(Ext.util.Format.date(n.getServizioOraIngresso().getValue(),
"H"),Ext.util.Format.date(n.getServizioOraIngresso().getValue(),"i"));Ext.isEmpty(q)||q.setHours(Ext.util.Format.date(n.getServizioOraUscita().getValue(),"H"),Ext.util.Format.date(n.getServizioOraUscita().getValue(),"i"));n={id:"-9999",idProfilo:f.cbaConfig.controllerTipologieCartella.getTipoServizio().getValue(),dal:p,al:q,nosologico:f.cbaConfig.controllerTipologieCartella.getForm().getForm().getFieldValues().nosologico}}else p=f.cbaConfig.controllerServizi.getServizioDataDal().getValue(),p.setHours(Ext.util.Format.date(f.cbaConfig.controllerServizi.getServizioOraIngresso().getValue(),
"H"),Ext.util.Format.date(f.cbaConfig.controllerServizi.getServizioOraIngresso().getValue(),"i")),l=f.cbaConfig.controllerServizi.leggiDatiForm()[0];p=f.cbaConfig.controllerIndirizzi.getForm().getForm().getFieldValues();Ext.apply(p,{codOspite:k,idRicovero:null,idIndirizzoAnagrafica:null});Ext.apply(h,{codOspite:k,indResidenza:p,ricovero:l,ricoveroCss:n,anagraficaCss:g?!0:!1});k={};Ext.isEmpty(d)||(Ext.apply(k,{idRegola:d}),Ext.isEmpty(c)||Ext.apply(k,{idEsterno:c}));var r=null;c=Ext.isEmpty(h.codOspite)?
f.getForm().store.getProxy().api.create:f.getForm().store.getProxy().api.update;Ext.Ajax.request({method:"POST",url:c,jsonData:h,async:!1,params:k,success:function(c){c=Ext.JSON.decode(c.responseText);c.success?Ext.isEmpty(c.data)||(b?f.getForm().up("window").close():f.aggiornaStore(c.data.codOspite,c),f.getForm().boxBottoni&&controller_abilitaBottoni(f.getForm()),f.generaMessaggio(c),r=c.data):msgShowError("ERRORE",c.message)}});r?(g&&(r.ricoveroCss&&(f.cbaConfig.controllerEditFascicolo.currRicoveroCSS=
r.ricoveroCss),1==f.cbaConfig.versioneAnagrafica&&(f.cbaConfig.controllerIndirizzi.cbaConfig.codOspite=risposta.data.codOspite,f.cbaConfig.controllerTipologieCartella.cbaConfig.codOspite=risposta.data.codOspite,f.cbaConfig.controllerIndirizzi.salva(!1))),f.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||f.cbaConfig.controllerEditFascicolo.navigaWizard(f.cbaConfig.controllerEditFascicolo.navDirection,!0),h=!0):h=!1;return h},salvaLetto:function(b,c){var d=this;d.cbaConfig.lettoSel=d.cbaConfig.controllerTipologieCartella.getEditResLetti().getSelectedRecord();
d.cbaConfig.repartoSel=d.cbaConfig.controllerTipologieCartella.getEditResReparto().getSelectedRecord();d.cbaConfig.stanzaSel=d.cbaConfig.controllerTipologieCartella.getEditResStanza().getSelectedRecord();Ext.isDefined(c)||(c=!1);Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/genOsp/residenza/new",jsonData:b,params:{forceStore:c},success:function(c){c=Ext.JSON.decode(c.responseText);if(!c.success){if(c.message&&("?"==c.message[0]||c.message[0].testo&&"?"==c.message[0].testo[0])){Messaggio("ATTENZIONE",
c.message[0].testo.slice(1),"YESNO","QUESTION",!1,function(){d.salvaLetto(b,!0)});return}c.message&&"$"==c.message[0]?c.message=c.message.substring(1):msgShowError("ERRORE",c.message[0].testo);return!1}49==CBA.moduli.moduloAttivo&&d.cbaConfig.controllerEditFascicolo.getTabPanel().getActiveTab().up("window").close();return!0}})},caricaDati:function(b){var c=this.getForm();clearForm(c);this.getForm().getForm().setValues({nome:b.nome,cognome:b.cognome,dataNascita:b.dataNascitaFormatted,note:b.note,statoCivile:b.statoCivile,
gradoIstruzione:b.gradoIstruzione,sesso:b.sesso,professione:b.professione,codiceFiscale:b.codiceFiscale,comuneNascita:b.comuneNascita,cognomeAcquisito:b.cognomeAcquisito,codiceSanitario:b.codiceSanitario,stp:b.stp,numFigliMaschi:b.numFigliMaschi,numFigliFemm:b.numFigliFemm,nazioneNascita:b.nazioneNascita,cittadinanza:b.cittadinanza,testamento:b.testamento,idReligione:b.idReligione})},impostaDati:function(b){var c=this.getForm(),d=49===CBA.moduli.moduloAttivo;clearForm(c);b?(this.oldCF=this.getACodiceFiscale().getValue(),
c.loadRecord(b),b.data.comuneNascita&&setCombo(this.getAComuneNascita(),b.data.comuneNascita,b.data.desComuneNascita),this.getBtnModificaCF().show(),this.getBtnModificaCS().show()):(this.oldCF="",this.getForm().getForm().setValues({nazioneNascita:"0",cittadinanza:"0",idReligione:"0"}),c.getForm().findField("codOspite").setValue(-9999),validaForm(this.getForm()),this.getBtnModificaCF().hide(),this.getBtnModificaCS().hide());this.getACognome().focus(!1,100);"L"==this.cbaConfig.permesso||d||(this.getBtnTEAM().setDisabled(!b),
this.getBtnTICKET().setDisabled(!b),this.getBtnMedici().setDisabled(!b))},aggiornaStore:function(b,c){var d=this,f=-9999;b?(f=b,d.currentDip=b):d.currentDip&&(f=d.currentDip);d.storeOspite.load({params:{id:f},callback:function(b,c,f){b&&0<b.length&&(d.impostaDati(b[0]),d.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite=b[0].data,currOspite=b[0].data)}})},annulla:function(){this.aggiornaStore()},calcolaCodFisc:function(){var b=trovaRecord(this.getAComuneNascita().getStore(),"codice",this.getAComuneNascita().getValue()),
b=b?b.data.extra.split(",")[0]:"";return CalcolaCodiceFiscale(this.getForm().getForm().findField("cognome").getValue(),this.getForm().getForm().findField("nome").getValue(),this.getASesso().getValue().sesso,this.getForm().getForm().findField("dataNascita").getValue(),b,this.getForm().getForm().findField("nazioneNascita").getValue())},onBtnMediciClick:function(b,c,d){b=this.cbaConfig.controllerEditFascicolo;creaWin({permesso:49===CBA.moduli.moduloAttivo?this.cbaConfig.permesso:b.cbaConfig.permesso,
urlGen:!0,codOspite:this.currentDip,projectName:"GeneraliOSP.medicoCurante",id:"MedicoCurante",titolo:"GESTIONE_MEDICI",larghezzaWin:900,altezzaWin:350})},onBtnTicketClick:function(b,c,d){b=this.cbaConfig.controllerEditFascicolo;c=49===CBA.moduli.moduloAttivo;b.cbaConfig.nuovo?b.aggiungiDocumento("Esenzione Ticket"):creaWin({dimensioneWindow:2,id:"Documenti",idDB:"Documenti",isLegatoServizio:!1,isPortlet:!0,permesso:c?this.cbaConfig.permesso:b.cbaConfig.permesso,permessoDB:"S",projectName:"GeneraliOSP.portlet",
titolo:"DOCUMENTI_TICKET",isTicket:!0,soloCodiciTEAM:!1,codOspite:this.currentDip,controllerFascicolo:this.cbaConfig.controllerFascicolo})},onBtnTeamClick:function(b,c,d){b=this.cbaConfig.controllerEditFascicolo;c=49===CBA.moduli.moduloAttivo;b.cbaConfig.nuovo?b.aggiungiDocumento("Tessera TEAM"):creaWin({dimensioneWindow:2,id:"Documenti",idDB:"Documenti",isLegatoServizio:!1,isPortlet:!0,permesso:c?this.cbaConfig.permesso:b.cbaConfig.permesso,permessoDB:"S",projectName:"GeneraliOSP.portlet",titolo:"TITOLO_DOCUMENTI_TEAM",
soloCodiciTEAM:!0,codOspite:this.currentDip,controllerFascicolo:this.cbaConfig.controllerFascicolo})},onCalcClick:function(b,c,d){this.getACodiceFiscale().setValue(this.calcolaCodFisc())},onModificaStoricoInfoUtente:function(b,c,d){c=this.cbaConfig.controllerFascicolo;d="btnModificaCF"==b.itemId?this.getForm().getForm().findField("codiceFiscale").getValue():this.getForm().getForm().findField("codiceSanitario").getValue();var f=49===CBA.moduli.moduloAttivo;Ext.create("winCBA",{permesso:f?this.cbaConfig.permesso:
c.cbaConfig.permesso,name:"GeneraliOSP.fascicoloNoApp.view.EditStoricoInfoUtente",titolo:traduci("btnModificaCF"==b.itemId?"TITOLO_STORICO_CODFISC":"TITOLO_STORICO_CODSAN"),dimensione:2,configItem:{permesso:f?this.cbaConfig.permesso:c.cbaConfig.permesso,codOspite:this.currentDip,controllerEditAnagrafica:this,tipo:"btnModificaCF"==b.itemId?1:2,dataRif:this.getForm().getForm().findField("dataNascita").getValue(),valCorrente:d}}).show()},onCbTipoSoggettoChange:function(b,c,d,f){},onACittadinanzaChange:function(b,
c,d,f){this.getCbTipoSoggetto().setVisible("0"!=c);if(Ext.isEmpty(d))return!1;"999"==c&&this.getCbTipoSoggetto().setValue("T")},on_aComuneNascitaBeforeQuery:function(b,c){if(!b.query)return!1;forceQueryCombo(this.getAComuneNascita(),2," ")},onANazioneNascitaChange:function(b,c,d,f){"0"!=c?(this.getAComuneNascita().setValue(null),abilitaCmp(this.getAComuneNascita(),!1),this.getAComuneNascita().allowBlank=!0):(abilitaCmp(this.getAComuneNascita(),!0),this.getAComuneNascita().allowBlank=!1);this.getAComuneNascita().validateValue(this.getAComuneNascita().getValue())},
avanti:function(){var b=this;if(!b.verificaCampiForm()||(b.oldCF!=b.getACodiceFiscale().getValue()||Ext.isEmpty(b.getACodiceFiscale().getValue()))&&!b.verificaCodFiscale())return!1;if(!b.currentDip){var c=!1,d=[],f=getUrlGen()+"/ws/genOsp/users/getByCodFisc";Ext.Ajax.request({method:"GET",url:f,async:!1,params:{codFisc:b.getACodiceFiscale().getValue()},success:function(f){var g=Ext.JSON.decode(f.responseText);g.success?g.data?(f=[],msgAddWarning(f,"CARICARE_CODICE_FISCALE_ESISTENTE"),msgShow("DATI_DUPLICATI",
f,"YESNO",!1,function(){b.currentDip=g.data.codOspite;b.caricaDati(g.data);b.getForm().boxBottoni.queryById("btnAnnulla").show();b.getForm().boxBottoni.queryById("btnConferma").show();b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo=!1;b.cbaConfig.controllerEditFascicolo.currentDip=b.currentDip;b.cbaConfig.controllerEditFascicolo.cbaConfig.insertRicoveroCss=!0;49==CBA.moduli.moduloAttivo&&b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.cbaConfig.useExistCF=!0;b.cbaConfig.controllerEditFascicolo.getProgressWizardFas().setVisible(!1);
b.cbaConfig.controllerIndirizzi.cbaConfig.codOspite=b.currentDip;b.cbaConfig.controllerIndirizzi.aggiornaStore();b.cbaConfig.controllerIndirizzi.getForm().boxBottoni.queryById("btnNuovo").setVisible(!0);b.cbaConfig.controllerIndirizzi.getForm().boxBottoni.queryById("btnElimina").setVisible(!0);b.cbaConfig.controllerIndirizzi.getForm().boxBottoni.queryById("btnConferma").setVisible(!0);b.cbaConfig.controllerIndirizzi.getForm().boxBottoni.queryById("btnAnnulla").setVisible(!0);49!==CBA.moduli.moduloAttivo?
(b.cbaConfig.controllerServizi.cbaConfig.codOspite=b.currentDip,b.cbaConfig.controllerServizi.getCbResidenza().setDisabled(!1),b.cbaConfig.controllerServizi.aggiornaStore(),b.cbaConfig.controllerServizi.getForm().boxBottoni.queryById("btnNuovo").setVisible(!0),b.cbaConfig.controllerServizi.getForm().boxBottoni.queryById("btnElimina").setVisible(!0),b.cbaConfig.controllerServizi.getForm().boxBottoni.queryById("btnConferma").setVisible(!0),b.cbaConfig.controllerServizi.getForm().boxBottoni.queryById("btnAnnulla").setVisible(!0)):
b.cbaConfig.controllerTipologieCartella.cbaConfig.nuovaAnaEsistente=!0;b.cbaConfig.controllerUltDati.cbaConfig.codOspite=b.currentDip;b.cbaConfig.controllerUltDati.aggiornaStore(b.currentDip);b.cbaConfig.controllerUltDati.getForm().boxBottoni.queryById("btnNuovo").setVisible(!0);b.cbaConfig.controllerUltDati.getForm().boxBottoni.queryById("btnElimina").setVisible(!0);b.cbaConfig.controllerUltDati.getForm().boxBottoni.queryById("btnConferma").setVisible(!0);b.cbaConfig.controllerUltDati.getForm().boxBottoni.queryById("btnAnnulla").setVisible(!0);
b.cbaConfig.controllerEditFascicolo.navDirection="next";b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){return!1},!1,!0)):c=!0:(msgAddError(d,g.message),msgShow("",d))}})}return c},changeTab:function(){var b=this,c=b.getForm().up("window");if(b.oldCF!=b.getACodiceFiscale().getValue()&&!b.verificaCodFiscale())return!1;controller_puoiUscire(c,b.getForm(),function(){b.salva(!1)},function(){b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,
!0)},function(){b.aggiornaStore()})},gestioneForm:function(){var b=this,c=49===CBA.moduli.moduloAttivo;b.storeOspite=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite");ImpostaUrl([b.storeOspite]);var d=b.getForm();d.permesso=b.cbaConfig.permesso;d.boxBottoni=b.getBoxBottoni();b.storeForm=d.store=b.storeOspite;d.controller=b;var f=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},
esci_callback:function(){var c=b.getForm().up("window");controller_puoiUscire(c,b.getForm(),function(){b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:c?!0:null,personIcons:c?getIconButtons():null}});inserisciBottoni(d.boxBottoni,f);d.boxBottoni.queryById("btnNuovo").hide();b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&(d.boxBottoni.queryById("btnAnnulla").hide(),d.boxBottoni.queryById("btnConferma").hide());
if("L"!=d.permesso)d.getForm().on("dirtychange",function(c,f){controller_abilitaBottoni(d);d.boxBottoni.queryById("btnEsci").setDisabled(!1);b.cbaConfig.controllerEditFascicolo&&!b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(f),b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(f))});"L"==b.cbaConfig.permesso?(containerSolaLettura(d),controller_bottoniSolaLettura(b.getBoxBottoni())):c&&(b.currentDip?(b.getANote().nonDisabilitare=
!0,containerSolaLettura(d)):(b.getBtnTEAM().setDisabled(!0),b.getBtnTICKET().setDisabled(!0),b.getBtnMedici().setDisabled(!0)))},onLaunch:function(){this.getContainer().controller=this;this.currentDip=this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?!1:this.cbaConfig.controllerFascicolo?this.cbaConfig.controllerFascicolo.currentDip:this.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite;this.storeOspite=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite");ImpostaUrl([this.storeOspite]);
ImpostaUrl([this.getANazioneNascita().getStore(),this.getACittadinanza().getStore(),this.getAStatoCivile().getStore(),this.getAProfessione().getStore(),this.getAGradoIstruzione().getStore(),this.getAComuneNascita().getStore()]);this.getAComuneNascita().getStore().getProxy().extraParams={excom:!0};this.getACodiceFiscale().cbaConfig.erroreBloccante=!1;loadStore(this.getANazioneNascita().getStore(),{exnaz:!0});loadStore(this.getACittadinanza().getStore(),{exnaz:!0});loadStore(this.getAStatoCivile().getStore());
loadStore(this.getAProfessione().getStore());loadStore(this.getAGradoIstruzione().getStore());50==CBA.moduli.moduloAttivo&&(ImpostaUrl([this.getAReligione().getStore()]),this.getAReligione().getStore().load());this.gestioneForm();if(this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo){var b=null;this.cbaConfig.recordIntegrazione&&(b=this.cbaConfig.recordIntegrazione);this.impostaDati(b)}else this.aggiornaStore();this.getForm().boxBottoni.queryById("btnEsci").hide();this.getForm().boxBottoni.queryById("btnElimina").hide()},
destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditDatiAnagraficiCSS",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"Form",selector:c+"#Form"},{ref:"BoxBottoni",selector:c+"#BoxBottoni"},{ref:"aComuneNascita",selector:c+"#aComuneNascita"},{ref:"aNazioneNascita",selector:c+"#aNazioneNascita"},{ref:"aCittadinanza",selector:c+"#aCittadinanza"},{ref:"aStp",selector:c+"#aStp"},
{ref:"btnCalcolatrice",selector:c+"#btnCalcolatrice"},{ref:"aCodiceFiscale",selector:c+"#aCodiceFiscale"},{ref:"aDataIngresso",selector:c+"#aDataIngresso"},{ref:"aOraIngresso",selector:c+"#aOraIngresso"},{ref:"aCognome",selector:c+"#aCognome"},{ref:"aSesso",selector:c+"#aSesso"},{ref:"GridAdt",selector:c+"#GridAdt"},{ref:"ContainerAdt",selector:c+"#ContainerAdt"},{ref:"aStatoCivile",selector:c+"#aStatoCivile"},{ref:"aProfessione",selector:c+"#aProfessione"},{ref:"aGradoIstruzione",selector:c+"#aGradoIstruzione"},
{ref:"aNote",selector:c+"#aNote"},{ref:"aFigliM",selector:c+"#aFigliM"},{ref:"aFigliF",selector:c+"#aFigliF"},{ref:"btnTICKET",selector:c+"#btnTICKET"},{ref:"btnMedici",selector:c+"#btnMedici"},{ref:"fieldSetAltro",selector:c+"#fieldSetAltro"},{ref:"cntBtn",selector:c+"#cntBtn"},{ref:"fieldSetNote",selector:c+"#fieldSetNote"},{ref:"panelDestra",selector:c+"#panelDestra"},{ref:"fieldsetSinistra",selector:c+"#fieldsetSinistra"},{ref:"btnModificaCS",selector:c+"#btnModificaCS"},{ref:"btnTEAM",selector:c+
"#btnTEAM"},{ref:"btnLingua",selector:c+"#btnLingua"},{ref:"infoBtnLingua",selector:c+"#infoBtnLingua"}]);b.control(c+"#btnTICKET",{click:b.onBtnTicketClick});b.control(c+"#btnMedici",{click:b.onBtnMediciClick});b.control(c+"#btnLingua",{click:b.clickBtnLingua});b.control(c+"#aComuneNascita",{beforequery:b.on_aComuneNascitaBeforeQuery});b.control(c+"#aNazioneNascita",{change:b.onANazioneNascitaChange});b.control(c+"#aCittadinanza",{change:b.onACittadinanzaChange});b.control(c+"#aStp",{change:b.onAStpChange});
b.control(c+"#btnCalcolatrice",{click:b.onCalcClick});b.control(c+"#btnModificaCS",{click:b.onModificaStoricoInfoUtente});b.control(c+"#btnTEAM",{click:b.onBtnTeamClick});b.control(c+"#infoBtnLingua",{afterrender:b.afterrenderInfoBtnLingua});b.on({avanti:function(){return b.avanti()},changeTab:function(){return b.changeTab()},esci:function(){b.getForm().boxBottoni.queryById("btnEsci").handler()}})},afterrenderInfoBtnLingua:function(b,c){return creaToolTipBubble(b.getId(),"MSG_INFO_LINGUA_OSPITE",
"",45,260)},verificaCampiForm:function(){var b=[];this.getForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow(traduci("DATI_ANAGRAFICI"),b);return 0==b.length?!0:!1},verificaCodFiscale:function(){this.getForm().getForm().findField("codiceFiscale").getValue();this.calcolaCodFisc();return!0},generaMessaggio:function(b){var c=!1,d=b.message?b.message[0].testo.trim().split("\n"):"";1<d.length&&(c=!0,msgShowWarning("ATTENZIONE",d));c||msgShow("SUCCESSO",b.message)},salva:function(b,
c,d){var f=this,g=49===CBA.moduli.moduloAttivo,h=null;if(!f.verificaCampiForm())return!1;if(f.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&!f.currentDip)if(g){if(f.cbaConfig.controllerTipologieCartella&&!f.cbaConfig.controllerTipologieCartella.verificaCampiForm()||!f.cbaConfig.controllerUltDati.verificaCampiForm())return!1}else if(f.cbaConfig.controllerServizi&&(!f.cbaConfig.controllerServizi.verificaCampiForm()||!f.cbaConfig.controllerIndirizzi.verificaCampiForm()))return!1;if(f.oldCF!=f.getACodiceFiscale().getValue()&&
!f.verificaCodFiscale())return!1;var h={nome:f.getForm().getForm().findField("nome").getValue(),cognome:f.getForm().getForm().findField("cognome").getValue(),dataNascita:f.getForm().getForm().findField("dataNascita").getValue(),sesso:f.getASesso().getValue().sesso,codiceFiscale:f.getForm().getForm().findField("codiceFiscale").getValue(),comuneNascita:f.getForm().getForm().findField("comuneNascita").getValue(),stp:getBoolValue(f.getForm().getForm().findField("stp").getValue()),nazioneNascita:f.getForm().getForm().findField("nazioneNascita").getValue(),
cittadinanza:f.getForm().getForm().findField("cittadinanza").getValue(),note:f.getForm().getForm().findField("note").getValue(),statoCivile:f.getForm().getForm().findField("statoCivile").getValue(),gradoIstruzione:f.getForm().getForm().findField("gradoIstruzione").getValue(),professione:f.getForm().getForm().findField("professione").getValue(),numFigliMaschi:f.getForm().getForm().findField("numFigliMaschi").getValue(),numFigliFemm:f.getForm().getForm().findField("numFigliFemm").getValue(),codiceSanitario:f.getForm().getForm().findField("codiceSanitario").getValue(),
lingua:f.getForm().getForm().findField("lingua").getValue()},k=f.cbaConfig.controllerUltDati.leggiDatiForm();Ext.apply(h,k);var k=f.currentDip?f.currentDip:null,l=null,n=null;if(f.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&!f.currentDip||f.cbaConfig.controllerEditFascicolo.cbaConfig.insertRicoveroCss)if(g){var n=f.cbaConfig.controllerTipologieCartella,p=n.getServizioDataDal().getValue();p.setHours(Ext.util.Format.date(n.getServizioOraIngresso().getValue(),"H"),Ext.util.Format.date(n.getServizioOraIngresso().getValue(),
"i"));n={id:"-9999",idProfilo:f.cbaConfig.controllerTipologieCartella.getTipoServizio().getValue(),dal:p,idSwEsterni:Ext.isEmpty(f.cbaConfig.controllerTipologieCartella.getRispostaAggRicoveri().getSelection())?null:f.cbaConfig.controllerTipologieCartella.getRispostaAggRicoveri().getSelection().data.valore}}else f.cbaConfig.controllerServizi.getServizioDataDal().getValue().setHours(Ext.util.Format.date(f.cbaConfig.controllerServizi.getServizioOraIngresso().getValue(),"H"),Ext.util.Format.date(f.cbaConfig.controllerServizi.getServizioOraIngresso().getValue(),
"i")),l=f.cbaConfig.controllerServizi.leggiDatiForm()[0];if(!g){var q=f.cbaConfig.controllerIndirizzi.getForm().getForm().getFieldValues();Ext.apply(q,{codOspite:k,idRicovero:null,idIndirizzoAnagrafica:null})}Ext.apply(h,{codOspite:k,indResidenza:q,ricovero:l,ricoveroCss:n,anagraficaCss:g?!0:!1});g={};Ext.isEmpty(d)||(Ext.apply(g,{idRegola:d}),Ext.isEmpty(c)||Ext.apply(g,{idEsterno:c}));c="/cba/css/cs/ws/genOsp/users/";var r=null;f.cbaConfig.controllerTipologieCartella.verificaCampiForm()&&(c+=Ext.isEmpty(h.codOspite)?
"new":"update",Ext.Ajax.request({method:"POST",url:c,jsonData:h,async:!1,params:g,success:function(c){c=Ext.JSON.decode(c.responseText);c.success?Ext.isEmpty(c.data)||(b?f.getForm().up("window").close():f.aggiornaStore(c.data.codOspite,c),f.generaMessaggio(c),r=c.data):msgShowError("ERRORE",c.message)}}));if(r){if(f.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||f.cbaConfig.controllerEditFascicolo.cbaConfig.insertRicoveroCss){f.cbaConfig.controllerEditFascicolo.currRicoveroCSS=r.ricoveroCss;c=
{idRicovero:r.ricoveroCss.idRicoveroCollegato,idSede:f.cbaConfig.controllerTipologieCartella.getEditResSede().getValue(),idReparto:f.cbaConfig.controllerTipologieCartella.getEditResReparto().getValue(),idStanza:f.cbaConfig.controllerTipologieCartella.getEditResStanza().getValue(),idLetto:f.cbaConfig.controllerTipologieCartella.getEditResLetti().getValue(),dataDal:f.cbaConfig.controllerTipologieCartella.getServizioDataDal().getValue(),dataAl:null};if(f.cbaConfig.controllerTipologieCartella&&!f.cbaConfig.controllerTipologieCartella.verificaCampiForm())return!1;
if(!Ext.isEmpty(c.idRicovero)&&f.cbaConfig.controllerTipologieCartella.salvaLetto(c))f.cbaConfig.controllerEditFascicolo.cbaConfig.controllerFascicolo.cbaConfig.controllerFascicolo.cerca(),f.cbaConfig.controllerEditFascicolo.cbaConfig.controllerFascicolo.getGridOspiti().up("window").close();else if(Ext.isEmpty(c.idRicovero)&&2==CBA.moduli.modulo49.controllerCercaAnagrafica.versioneAnagrafica)return f.cbaConfig.controllerEditFascicolo.cbaConfig.controllerFascicolo.getPnlMain().up("window").close(),
f.cbaConfig.controllerEditFascicolo.getTabPanel().getActiveTab().up("window").close(),!0}f.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||f.cbaConfig.controllerEditFascicolo.navigaWizard(f.cbaConfig.controllerEditFascicolo.navDirection,!0);h=!0}else h=!1;return h},caricaDati:function(b){var c=this.getForm();clearForm(c);this.getForm().getForm().setValues({nome:b.nome,cognome:b.cognome,dataNascita:b.dataNascitaFormatted,sesso:b.sesso,codiceFiscale:b.codiceFiscale,comuneNascita:b.comuneNascita,
stp:getBoolValue(b.stp),nazioneNascita:b.nazioneNascita,cittadinanza:b.cittadinanza,note:b.note,statoCivile:b.statoCivile,gradoIstruzione:b.gradoIstruzione,professione:b.professione,cognomeAcquisito:b.cognomeAcquisito,numFigliMaschi:b.numFigliMaschi,numFigliFemm:b.numFigliFemm,testamento:b.testamento})},impostaDati:function(b){var c=this,d=c.getForm();b?(c.oldCF=c.getACodiceFiscale().getValue(),c.getBtnModificaCS().show(),b.data.comuneNascita?setCombo(c.getAComuneNascita(),b.data.comuneNascita,b.data.desComuneNascita,
!1,function(){d.loadRecord(b);c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||c.cbaConfig.editVersioneAnagrafica||(containerSolaLettura(c.getFieldsetSinistra()),containerSolaLettura(c.getFieldSetAltro()),containerSolaLettura(c.getCntBtn()))}):(d.loadRecord(b),c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||c.cbaConfig.editVersioneAnagrafica||(containerSolaLettura(c.getFieldsetSinistra()),containerSolaLettura(c.getFieldSetAltro()),containerSolaLettura(c.getCntBtn())))):(c.oldCF="",c.getBtnModificaCS().hide(),
c.getForm().getForm().setValues({nazioneNascita:"0",cittadinanza:"0"}),d.getForm().findField("codOspite").setValue(-9999),validaForm(c.getForm()));c.getACognome().focus(!1,20)},aggiornaStore:function(b,c){var d=this,f=-9999;b?(f=b,d.currentDip=b):d.currentDip&&(f=d.currentDip);d.storeOspite.load({params:{id:f},callback:function(b,c,f){b&&0<b.length&&d.getForm&&(d.impostaDati(b[0]),d.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite=b[0].data,currOspite=b[0].data)}})},annulla:function(){this.aggiornaStore()},
calcolaCodFisc:function(){var b=trovaRecord(this.getAComuneNascita().getStore(),"codice",this.getAComuneNascita().getValue()),b=b?b.data.extra.split(",")[0]:"";return CalcolaCodiceFiscale(this.getForm().getForm().findField("cognome").getValue(),this.getForm().getForm().findField("nome").getValue(),this.getASesso().getValue().sesso,this.getForm().getForm().findField("dataNascita").getValue(),b,this.getForm().getForm().findField("nazioneNascita").getValue())},onBtnTicketClick:function(b,c,d){this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?
this.cbaConfig.controllerEditFascicolo.aggiungiDocumento("Esenzione Ticket"):creaWin({dimensioneWindow:2,id:"Documenti",idDB:"Documenti",isLegatoServizio:!1,isPortlet:!0,permesso:this.cbaConfig.permesso,permessoDB:this.cbaConfig.permesso,projectName:"GeneraliOSP.portlet",titolo:"DOCUMENTI_TICKET",isTicket:!0,soloCodiciTEAM:!1,codOspite:this.currentDip,controllerFascicolo:this.cbaConfig.controllerFascicolo})},onBtnMediciClick:function(b,c,d){creaWin({permesso:this.cbaConfig.permesso,urlGen:!0,codOspite:this.currentDip,
projectName:"GeneraliOSP.medicoCurante",id:"MedicoCurante",titolo:"GESTIONE_MEDICI",larghezzaWin:900,altezzaWin:350})},clickBtnLingua:function(b,c,d){this.winLingua||(this.winLingua=Ext.create("winCBA",{name:"GeneraliOSP.fascicoloNoApp.view.WinLingue",titolo:traduci("GESTIONE_LINGUA"),larghezzaWin:500,altezzaWin:150,configItem:{controllerMain:this,hideFiltriBase:!0}}));this.winLingua.showAt(b.getX()-250+b.getWidth()/2,b.getY()+b.getHeight())},onCalcClick:function(b,c,d){this.getACodiceFiscale().setValue(this.calcolaCodFisc())},
onBtnTeamClick:function(b,c,d){this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?this.cbaConfig.controllerEditFascicolo.aggiungiDocumento("Tessera TEAM"):creaWin({dimensioneWindow:2,id:"Documenti",idDB:"Documenti",isLegatoServizio:!1,isPortlet:!0,permesso:"S",permessoDB:"S",projectName:"GeneraliOSP.portlet",titolo:"TITOLO_DOCUMENTI_TEAM",soloCodiciTEAM:!0,codOspite:this.currentDip,controllerFascicolo:this.cbaConfig.controllerFascicolo})},onModificaStoricoInfoUtente:function(b,c,d){c=this.cbaConfig.controllerFascicolo;
d="btnModificaCF"==b.itemId?this.getForm().getForm().findField("codiceFiscale").getValue():this.getForm().getForm().findField("codiceSanitario").getValue();var f=49===CBA.moduli.moduloAttivo;Ext.create("winCBA",{permesso:f?this.cbaConfig.permesso:c.cbaConfig.permesso,name:"GeneraliOSP.fascicoloNoApp.view.EditStoricoInfoUtente",titolo:traduci("btnModificaCF"==b.itemId?"TITOLO_STORICO_CODFISC":"TITOLO_STORICO_CODSAN"),dimensione:2,configItem:{permesso:f?this.cbaConfig.permesso:c.cbaConfig.permesso,
codOspite:this.currentDip,controllerEditAnagrafica:this,tipo:"btnModificaCF"==b.itemId?1:2,dataRif:this.getForm().getForm().findField("dataNascita").getValue(),valCorrente:d}}).show()},onAStpChange:function(b,c,d,f){c?(this.getACittadinanza().setValue("999"),abilitaCmp(this.getACittadinanza(),!1)):abilitaCmp(this.getACittadinanza(),!0)},onACittadinanzaChange:function(b,c,d,f){"999"==c?this.getAStp().setValue("T"):this.getAStp().setValue("F")},on_aComuneNascitaBeforeQuery:function(b,c){if(!b.query)return!1;
forceQueryCombo(this.getAComuneNascita(),2," ")},onANazioneNascitaChange:function(b,c,d,f){"0"!=c?(this.getAComuneNascita().setValue(null),abilitaCmp(this.getAComuneNascita(),!1),this.getAComuneNascita().allowBlank=!0):(abilitaCmp(this.getAComuneNascita(),!0),this.getAComuneNascita().allowBlank=!1);this.getAComuneNascita().validateValue(this.getAComuneNascita().getValue())},avanti:function(){var b=this;if(!b.verificaCampiForm()||b.oldCF!=b.getACodiceFiscale().getValue()&&!b.verificaCodFiscale())return!1;
if(!b.currentDip){var c=!1,d=[],f=getUrlGen()+"/ws/genOsp/users/getByCodFisc";Ext.Ajax.request({method:"GET",url:f,async:!1,params:{codFisc:b.getACodiceFiscale().getValue()},success:function(f){var g=Ext.JSON.decode(f.responseText);g.success?g.data?(f=[],msgAddWarning(f,"CARICARE_CODICE_FISCALE_ESISTENTE"),msgShow("DATI_DUPLICATI",f,"YESNO",!1,function(){b.currentDip=g.data.codOspite;b.caricaDati(g.data);b.getForm().boxBottoni.queryById("btnAnnulla").show();b.getForm().boxBottoni.queryById("btnConferma").show();
b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo=!1;b.cbaConfig.controllerEditFascicolo.currentDip=b.currentDip;b.cbaConfig.controllerEditFascicolo.getProgressWizardFas().setVisible(!1);b.cbaConfig.controllerEditFascicolo.cbaConfig.insertRicoveroCss=!0;49==CBA.moduli.moduloAttivo&&b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.cbaConfig.useExistCF=!0;49!==CBA.moduli.moduloAttivo&&(b.cbaConfig.controllerIndirizzi.cbaConfig.codOspite=b.currentDip,b.cbaConfig.controllerIndirizzi.aggiornaStore(),
b.cbaConfig.controllerIndirizzi.getForm().boxBottoni.queryById("btnNuovo").setVisible(!0),b.cbaConfig.controllerIndirizzi.getForm().boxBottoni.queryById("btnElimina").setVisible(!0),b.cbaConfig.controllerIndirizzi.getForm().boxBottoni.queryById("btnConferma").setVisible(!0),b.cbaConfig.controllerIndirizzi.getForm().boxBottoni.queryById("btnAnnulla").setVisible(!0),b.cbaConfig.controllerServizi.cbaConfig.codOspite=b.currentDip,b.cbaConfig.controllerServizi.getCbResidenza().setDisabled(!1),b.cbaConfig.controllerServizi.aggiornaStore(),
b.cbaConfig.controllerServizi.getForm().boxBottoni.queryById("btnNuovo").setVisible(!0),b.cbaConfig.controllerServizi.getForm().boxBottoni.queryById("btnElimina").setVisible(!0),b.cbaConfig.controllerServizi.getForm().boxBottoni.queryById("btnConferma").setVisible(!0),b.cbaConfig.controllerServizi.getForm().boxBottoni.queryById("btnAnnulla").setVisible(!0));b.cbaConfig.controllerUltDati.cbaConfig.codOspite=b.currentDip;b.cbaConfig.controllerUltDati.aggiornaStore(b.currentDip);b.cbaConfig.controllerUltDati.getForm().boxBottoni.queryById("btnNuovo").setVisible(!0);
b.cbaConfig.controllerUltDati.getForm().boxBottoni.queryById("btnElimina").setVisible(!0);b.cbaConfig.controllerUltDati.getForm().boxBottoni.queryById("btnConferma").setVisible(!0);b.cbaConfig.controllerUltDati.getForm().boxBottoni.queryById("btnAnnulla").setVisible(!0);b.cbaConfig.controllerEditFascicolo.navDirection="next";b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){return!1},!1,!0)):c=!0:(msgAddError(d,g.message),msgShow("",
d))}})}return c},changeTab:function(){this.getForm().up("window")},gestioneForm:function(){var b=this,c=49===CBA.moduli.moduloAttivo;b.storeOspite=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite");ImpostaUrl([b.storeOspite]);var d=b.getForm();2==CBA.moduli.modulo49.controllerCercaAnagrafica.versioneAnagrafica&&(b.cbaConfig.permesso="S");d.permesso=b.cbaConfig.permesso;d.boxBottoni=b.getBoxBottoni();b.storeForm=d.store=b.storeOspite;d.controller=b;c=Ext.create("Generali.standard.controller_PannelloBottoni",
{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},esci_callback:function(){var c=b.getForm().up("window");controller_puoiUscire(c,b.getForm(),function(){b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:c?!0:null,personIcons:c?getIconButtons():null}});inserisciBottoni(d.boxBottoni,c);d.boxBottoni.queryById("btnNuovo").hide();b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&
(d.boxBottoni.queryById("btnAnnulla").hide(),d.boxBottoni.queryById("btnConferma").hide());if("L"!=d.permesso)d.getForm().on("dirtychange",function(c,g){controller_abilitaBottoni(d);d.boxBottoni.queryById("btnEsci").setDisabled(!1);b.cbaConfig.controllerEditFascicolo&&!b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(g)});"L"==b.cbaConfig.permesso&&(containerSolaLettura(d),controller_bottoniSolaLettura(b.getBoxBottoni()))},checkDatiAdt:function(){var b=
this;Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/anagrafica/mostradatiadt",success:function(c){c=Ext.JSON.decode(c.responseText);c.success?c.data&&b.visualizzaAdt():msgShowError("",c.message)}})},visualizzaAdt:function(){this.getContainerAdt().setHidden(!1);var b={};Ext.apply(b,{tipo:"A"});this.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite&&Ext.apply(b,{id:this.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite});this.getGridAdt().getStore().load({params:b,
callback:function(b,d,f){f||msgShowError("",d.getError())}})},onLaunch:function(){var b=49===CBA.moduli.moduloAttivo;this.getContainer().controller=this;this.currentDip=this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?!1:this.cbaConfig.controllerFascicolo?this.cbaConfig.controllerFascicolo.currentDip:this.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite;this.storeOspite=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite");ImpostaUrl([this.storeOspite]);ImpostaUrl([this.getANazioneNascita().getStore(),
this.getACittadinanza().getStore(),this.getAComuneNascita().getStore(),this.getAStatoCivile().getStore(),this.getAProfessione().getStore(),this.getAGradoIstruzione().getStore()]);this.getAComuneNascita().getStore().getProxy().extraParams={excom:!0};this.getACodiceFiscale().cbaConfig.erroreBloccante=!1;loadStore(this.getANazioneNascita().getStore(),{exnaz:!0});loadStore(this.getACittadinanza().getStore(),{exnaz:!0});loadStore(this.getAStatoCivile().getStore());loadStore(this.getAProfessione().getStore());
loadStore(this.getAGradoIstruzione().getStore());this.gestioneForm();!b||this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||this.cbaConfig.controllerEditFascicolo.cbaConfig.editVersioneAnagrafica||this.checkDatiAdt();this.cbaConfig.controllerEditFascicolo.cbaConfig.insertRicoveroCss&&!this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?(this.nascondiCampiCss(!1),this.aggiornaStore()):this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?(b=null,this.cbaConfig.recordIntegrazione&&(b=this.cbaConfig.recordIntegrazione),
this.impostaDati(b),this.nascondiCampiCss(!1)):this.aggiornaStore();this.getForm().boxBottoni.queryById("btnEsci").hide();this.getForm().boxBottoni.queryById("btnElimina").hide()},nascondiCampiCss:function(b){this.getPanelDestra().setVisible(b);this.getFieldSetNote().setVisible(b);this.getCntBtn().setVisible(b);this.getFieldSetAltro().setVisible(b);this.getAStatoCivile().setVisible(b);this.getAProfessione().setVisible(b);this.getAGradoIstruzione().setVisible(b);this.getANote().setVisible(b);this.getAFigliM().setVisible(b);
this.getAFigliF().setVisible(b);this.getBtnTICKET().setVisible(b);this.getBtnMedici().setVisible(b)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditFascicolo",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:b+"#Container"},{ref:"DatiAnagrafici",selector:b+"#DatiAnagrafici"},{ref:"Indirizzi",selector:b+"#Indirizzi"},{ref:"TabServizi",selector:b+"#TabServizi"},{ref:"TabRicoveri",selector:b+"#TabRicoveri"},{ref:"UlterioriDati",selector:b+"#UlterioriDati"},{ref:"BoxBottoni",selector:b+"#BoxBottoni"},
{ref:"TabPanel",selector:b+"#TabPanel"},{ref:"BtnCreaAnagrafica",selector:b+"#BtnCreaAnagrafica"},{ref:"BtnAvanti",selector:b+"#BtnAvanti"},{ref:"BtnIndietro",selector:b+"#BtnIndietro"},{ref:"BtnEsci",selector:b+"#BtnEsci"},{ref:"ProgressWizardFas",selector:b+"#ProgressWizardFas"},{ref:"TipologieCartella",selector:b+"#TipologieCartella"}]);this.control(b+"#TabPanel",{tabchange:this.tabchangeTabPanel,beforetabchange:this.beforetabchangeTabPanel});this.control(b+"#BtnCreaAnagrafica",{click:this.BtnCreaAnagraficaclick});
this.control(b+"#BtnAvanti",{click:this.clickBtnAvanti});this.control(b+"#BtnIndietro",{click:this.clickBtnIndietro});this.control(b+"#BtnEsci",{click:this.clickBtnEsci})},getTabPanelPosition:function(){var b=this,c=b.getTabPanel(),d=0;b.tabPosition=[];c.items.items.forEach(function(c,g){c.tab.hidden||(b.tabPosition.push(c),c.cbaConfig.posTabCss=g,c.cbaConfig.actualPosTabCss=d,d++)})},navigaWizard:function(b,c){var d=this.getTabPanel(),f=49===CBA.moduli.moduloAttivo;this.navDirection=b;this.navOK=
c;if(null!=d)if(f)f="next"==b?this.tabPosition[d.getActiveTab().cbaConfig.actualPosTabCss+1]:this.tabPosition[d.getActiveTab().cbaConfig.actualPosTabCss-1],d.setActiveTab(f);else{var g=d.items.indexOf(d.getActiveTab()),f=f&&1==this.cbaConfig.versioneAnagrafica&&1==g?"next"==b?g+2:g-1:"next"==b?g+1:g-1;d.setActiveTab(f);this.cbaConfig.changeTab&&(d.getActiveTab().cbaConfig.progressivoTab=f)}},checkRegolebeforeSalva:function(b,c,d,f){var g=Ext.create("Ext.data.Store"),h=null;b?Ext.isEmpty(this.cbaConfig.controllerTipologieCartella.getTipoServizio().getSelectedRecord())||
(h=this.cbaConfig.controllerTipologieCartella.getTipoServizio().getSelectedRecord().data.regole):Ext.isEmpty(this.cbaConfig.controllerServizi.getTipoServizio().getSelectedRecord())||(h=this.cbaConfig.controllerServizi.getTipoServizio().getSelectedRecord().data.regole);if(Ext.isEmpty(h))return d.salva(c);if(1<h.length&&"N"!=h[0].operazioneNuovo){g.loadData(h);var h="Selezionare Servizio",k="Selezionare il servizio per il ricovero appena creato",l="Servizio";b||(h="Selezionare Tipologia Cartella",k=
"Selezionare la tipologia cartella per il ricovero appena creato",l="Tipologia Cartella");Ext.create("winCBA",{permesso:"S",larghezzaWin:380,altezzaWin:200,name:"GeneraliOSP.fascicoloNoApp.view.WinRaccordoServCuCss",titolo:h,maximizable:!1,closable:!0,configItem:{store:g,onSave:function(b,c,f){d.salva(b,c,f)},testoHtml:k,esci:c,lbl:l,callBack:f}}).show()}else return d.salva(c,h[0].idEsterno,h[0].idPadre?h[0].idPadre:h[0].id)},silentSaveExternalId:function(b,c){b&&c&&Ext.Ajax.request({method:"POST",
url:getUrlGen()+"/ws/genOsp/mdw/users/setIdAnagExt",jsonData:Ext.JSON.encode({codice:c,valore:b}),success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.message;b.success?console.info("Importazione anagrafica esterna eseguita con successo!!!!!!!!!!!!!!"):(Messaggio("ATTENZIONE","MSG_INTEGRAZIONE_FALLITA","OK","WARNING"),console.error("Importazione anagrafica fallita!!!: ",c))},failure:function(){Messaggio("ATTENZIONE","MSG_INTEGRAZIONE_FALLITA","OK","WARNING");console.error("Importazione anagrafica fallita!!!: ")}})},
afterSalvaDatiAnagrafici:function(b,c,d,f){this.currentDip=b.currentDip;c.cbaConfig.codOspite=this.currentDip;d.cbaConfig.codOspite=this.currentDip;b=f?this.cbaConfig.controllerTipologieCartella:this.cbaConfig.controllerServizi;b.cbaConfig.codOspite=this.currentDip;c.aggiornaStore(Ext.isDefined(this.cbaConfig.controllerEditFascicolo)?this.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite:this.currentDip);d.aggiornaStore();f&&(this.aggiornaPercCompletamento(null,null),this.getBtnAvanti().setDisabled(!0));
this.getBtnCreaAnagrafica().setDisabled(43!==CBA.moduli.moduloAttivo);CBA.parametriGenerali.tipoIntegrazioneAnagrafica&&(c=this.cbaConfig.recordIntegrazione)&&(c=c.getData()._idAnagExternal)&&this.silentSaveExternalId(c,this.currentDip);b.cbaConfig.showTabAggiuntivi=!0;b.aggiornaStore();currOspite=this.cbaConfig.currOspite},BtnCreaAnagraficaclick:function(b,c,d){b=getPersonContabili(getIdOrg(),new Date,!0,null);4==b.tipoContabilitaAbilitata||5==b.tipoContabilitaAbilitata?c=(Ext.isEmpty(currOspite.indResidenza.indirizzo)?
null:currOspite.indResidenza.indirizzo)+"#"+(Ext.isEmpty(currOspite.indResidenza.civico)?null:currOspite.indResidenza.civico)+"#"+(Ext.isEmpty(currOspite.indResidenza.esponente)?null:currOspite.indResidenza.esponente)+"#"+(Ext.isEmpty(currOspite.indResidenza.interno)?null:currOspite.indResidenza.interno):(c=currOspite.indResidenza.indirizzo,currOspite.indResidenza.civico&&(c+=", "+currOspite.indResidenza.civico,currOspite.indResidenza.esponente&&(c+="/"+currOspite.indResidenza.esponente),currOspite.indResidenza.interno&&
(c+=" Int. "+currOspite.indResidenza.interno)));checkInsertNewPagante(currOspite,c,b)},clickBtnAvanti:function(){var b=this,c=49===CBA.moduli.moduloAttivo,d=b.getTabPanel().items.items[0].down("#Container").controller,f=b.getTabPanel().items.items[1].down("#Container").controller,g=b.getTabPanel().items.items[2].down("#Container").controller,h=b.getTabPanel().getActiveTab().cbaConfig.progressivoTab,k=b.getTabPanel().items.items.length;3===h?(b.cbaConfig.nuovo||c&&b.cbaConfig.insertRicoveroCss)&&(c&&
!b.cbaConfig.versioneAnagrafica?5===k:4===k)?b.checkRegolebeforeSalva(c,!1,d,function(h){b.afterSalvaDatiAnagrafici(d,f,g,c)})&&b.afterSalvaDatiAnagrafici(d,f,g,c):this.navigaWizard("next",!1):this.navigaWizard("next",!1)},salvaLetto:function(b,c){var d=this;d.cbaConfig.lettoSel=d.cbaConfig.controllerTipologieCartella.getEditResLetti().getSelectedRecord();d.cbaConfig.repartoSel=d.cbaConfig.controllerTipologieCartella.getEditResReparto().getSelectedRecord();d.cbaConfig.stanzaSel=d.cbaConfig.controllerTipologieCartella.getEditResStanza().getSelectedRecord();
Ext.isDefined(c)||(c=!1);Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/genOsp/residenza/new",jsonData:b,params:{forceStore:c},success:function(c){c=Ext.JSON.decode(c.responseText);if(!c.success){if(c.message&&("?"==c.message[0]||c.message[0].testo&&"?"==c.message[0].testo[0])){Messaggio("ATTENZIONE",c.message[0].testo.slice(1),"YESNO","QUESTION",!1,function(){d.salvaLetto(b,!0)});return}c.message&&"$"==c.message[0]?c.message=c.message.substring(1):msgShowError("ERRORE",c.message[0].testo);return!1}49==
CBA.moduli.moduloAttivo&&d.cbaConfig.controllerEditFascicolo.getTabPanel().getActiveTab().up("window").close();return!0}})},loadTabSecondari:function(){var b=this;Ext.suspendLayouts();var c=b.getTabPanel().getActiveTab().cbaConfig.progressivoTab;(49==CBA.moduli.moduloAttivo&&!b.cbaConfig.nuovo&&!b.cbaConfig.insertRicoveroCss||49!=CBA.moduli.moduloAttivo&&"S"==b.getPermessoVideataTab("Referenti"))&&b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.Referenti",{flex:1,itemId:"TabSec_EditReferenti"+
Ext.Date.now(),reference:"TabSec_EditReferenti"+Ext.Date.now(),title:traduci("REF_WIZARD"),cbaConfig:{nuovo:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,wizard:!0,progressivoTab:++c,titolo:"EditReferenti"}}));(49==CBA.moduli.moduloAttivo&&!b.cbaConfig.nuovo&&!b.cbaConfig.insertRicoveroCss||49!=CBA.moduli.moduloAttivo&&"S"==b.getPermessoVideataTab("Documenti"))&&b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.Documenti",{flex:1,itemId:"TabSec_EditDocumenti"+
Ext.Date.now(),reference:"TabSec_EditDocumenti"+Ext.Date.now(),title:traduci("DOCUMENTI"),cbaConfig:{codOspite:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,wizard:!0,progressivoTab:++c,titolo:"EditDocumenti"}}));(49==CBA.moduli.moduloAttivo&&!b.cbaConfig.nuovo&&!b.cbaConfig.insertRicoveroCss||49!=CBA.moduli.moduloAttivo&&"S"==b.getPermessoVideataTab("OSP_Residenziale"))&&48!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo&&b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.OSP_Residenziale",
{flex:1,itemId:"TabSec_EditResidenza"+Ext.Date.now(),reference:"TabSec_EditResidenza"+Ext.Date.now(),title:traduci("RES_WIZARD"),cbaConfig:{nuovo:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,recRicovero:currRicovero,wizard:!0,progressivoTab:++c,titolo:"EditResidenza",cartella:49===CBA.moduli.moduloAttivo?!0:!1}}));if(48==CBA.moduli.moduloAttivo)b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.ListaAttesa",{flex:1,itemId:"TabSec_ListaAttesa"+Ext.Date.now(),
reference:"TabSec_ListaAttesa"+Ext.Date.now(),title:traduci("WIZARD_LISTA_ATTESA"),cbaConfig:{nuovo:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,wizard:!0,progressivoTab:++c,titolo:"ListaAttesa"}}));else if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo){var d="RES";"S"==currRicovero.servizio.tipoServizio||"A"==currRicovero.servizio.tipoServizio?d="CDI":"M"==currRicovero.servizio.tipoServizio&&(d="AMB");"S"==b.getPermessoVideataTab("Classificazioni")&&
b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.EdtClassificazioni",{flex:1,itemId:"TabSec_EdtClassificazioni"+Ext.Date.now(),reference:"TabSec_EdtClassificazioni"+Ext.Date.now(),title:traduci("RETTA_PRESTAZIONI"),cbaConfig:{nuovo:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,currRicovero:currRicovero,tipoClRetta:d,hideClassReg:!1,hideClassInt:!1,wizard:!0,progressivoTab:++c,titolo:"EdtClassificazioni"}}));"S"==b.getPermessoVideataTab("EditScontiSupp")&&
b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.EdtScontiSupp",{flex:1,itemId:"TabSec_EdtScontiSupp"+Ext.Date.now(),reference:"TabSec_EdtScontiSupp"+Ext.Date.now(),title:traduci("SCONTI/SUPPLEMENTI"),cbaConfig:{nuovo:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,currRicovero:currRicovero,wizard:!0,progressivoTab:++c,titolo:"EdtScontiSupp"}}));"S"==b.getPermessoVideataTab("Pensioni")&&50!=CBA.moduli.moduloAttivo&&b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.Pensioni",
{flex:1,itemId:"TabSec_EditPensioni"+Ext.Date.now(),reference:"TabSec_EditPensioni"+Ext.Date.now(),title:traduci("PENSIONI"),cbaConfig:{nuovo:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,wizard:!0,progressivoTab:++c,titolo:"EditPensioni"}}));"S"==b.getPermessoVideataTab("EstrattoConto")&&b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.EstrattoConto",{flex:1,itemId:"TabSec_EstrattoConto"+Ext.Date.now(),reference:"TabSec_EstrattoConto"+Ext.Date.now(),
title:traduci("WIZARD_ECONTO_CAUZIONI"),cbaConfig:{nuovo:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,wizard:!0,progressivoTab:++c,titolo:"EstrattoConto",soloCauzioni:!0}}))}49!=CBA.moduli.moduloAttivo||!b.cbaConfig.nuovo&&!b.cbaConfig.nuovaAnaEsistente||"S"!=b.getPermessoVideataTab("OSP_Residenziale")&&"S"!=b.getPermessoVideataTab("Referenti")&&"S"!=b.getPermessoVideataTab("CSSEditAssenze")&&"S"!=b.getPermessoVideataTab("EditServizi")||(b.cbaConfig.nuovaAnaEsistente&&
delete b.cbaConfig.nuovaAnaEsistente,b.cbaConfig.nuovo=!1,b.cbaConfig.refreshUtenteCss=!0,"S"==b.getPermessoVideataTab("EditServizi")&&(c=Ext.create("GeneraliOSP.fascicoloNoApp.view.EditServizi",{cbaConfig:{permesso:"S",codOspite:b.currentDip,controllerEditFascicolo:b,wizard:!0,titolo:traduci("SERVIZI")},title:traduci("SERVIZI")}),b.getTabPanel().add(c),b.cbaConfig.controllerServizi=c.down("#StoricoGridServizi").controller),"S"==b.getPermessoVideataTab("CSSEditAssenze")&&b.cbaConfig.idRicoveroCss&&
b.getTabPanel().add(Ext.create("GeneraliCS.assenze.view.Assenze",{flex:1,itemId:"TabSec_Assenze"+Ext.Date.now(),reference:"TabSec_Assenze"+Ext.Date.now(),title:traduci("ASSENZE"),cbaConfig:{nuovo:!1,idRicoveroCSS:b.cbaConfig.idRicoveroCss,codOspite:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,permesso:b.getPermessoVideataTab("CSSEditAssenze"),controllerEditFascicolo:b,wizard:!0,progressivoTab:6,titolo:traduci("ASSENZE")}})),"S"==b.getPermessoVideataTab("OSP_Residenziale")&&(c=
{codOspite:b.currentDip},b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.OSP_Residenziale",{flex:1,itemId:"TabSec_EditResidenzaNuovoRic",reference:"TabSec_EditResidenzaNuovoRic",title:traduci("RESIDENZA"),cbaConfig:{nuovo:b.currentDip,controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,recRicovero:c,wizard:!0,progressivoTab:7,titolo:"EditResidenza",cartella:49===CBA.moduli.moduloAttivo?!0:!1,refreshOnTabChange:!0}}))),"S"==b.getPermessoVideataTab("Referenti")&&b.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.Referenti",
{flex:1,itemId:"TabSec_EditReferenti"+Ext.Date.now(),reference:"TabSec_EditReferenti"+Ext.Date.now(),title:traduci("REF_WIZARD"),cbaConfig:{nuovo:b.currentDip,cartella:!0,permesso:"S",controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,wizard:!0,progressivoTab:8,titolo:"EditReferenti"}})),b.getBtnAvanti().setDisabled(!1),b.getProgressWizardFas().hide(),Ext.defer(function(){b.getTabPanelPosition()},1E3));Ext.resumeLayouts()},clickBtnIndietro:function(){this.navigaWizard("prev",
!1)},beforetabchangeTabPanel:function(b,c,d,f){b=49===CBA.moduli.moduloAttivo;this.cbaConfig.changeTab=!0;if(this.navOK)return this.navOK=!1,!0;if("EdtClassificazioni"==d.cbaConfig.titolo||"ListaAttesa"==d.cbaConfig.titolo)d=d.down("#Container").controller,d.isDirtyForm()&&(this.cbaConfig.changeTab=d.verificaCampiForm(),this.cbaConfig.changeTab?(d.fireEvent("changeTab"),this.cbaConfig.changeTab=!1):this.navDirection="");else if(void 0!=d.cbaConfig.progressivoTab)switch(d.cbaConfig.progressivoTab){case 0:b=
d.down("#Container").controller;this.cbaConfig.nuovo&&!this.currentDip?this.cbaConfig.changeTab=b.fireEvent("avanti"):d.down("form").getForm().isDirty()&&(this.cbaConfig.changeTab=b.verificaCampiForm(),this.cbaConfig.changeTab?(b.fireEvent("changeTab"),this.cbaConfig.changeTab=!1):this.navDirection="");break;case 1:b=d.down("#Container").controller;this.cbaConfig.nuovo&&!this.currentDip?this.cbaConfig.changeTab=b.verificaCampiForm():d.down("form").getForm().isDirty()&&(this.cbaConfig.changeTab=b.verificaCampiForm(),
this.cbaConfig.changeTab?(b.fireEvent("changeTab"),this.cbaConfig.changeTab=!1):this.navDirection="");break;case 2:b=d.down("#Container").controller;this.cbaConfig.nuovo&&!this.currentDip?this.cbaConfig.changeTab=b.verificaCampiForm():d.down("form").getForm().isDirty()&&(this.cbaConfig.changeTab=b.verificaCampiForm(),this.cbaConfig.changeTab?(b.fireEvent("changeTab"),this.cbaConfig.changeTab=!1):this.navDirection="");break;case 3:b=b||!this.cbaConfig.versioneAnagrafica&&this.cbaConfig.controllerTipologieCartella?
this.cbaConfig.controllerTipologieCartella:this.cbaConfig.controllerServizi;this.cbaConfig.nuovo&&!this.currentDip?this.cbaConfig.changeTab=b.verificaCampiForm():d.down("form").getForm().isDirty()&&(this.cbaConfig.changeTab=b.verificaCampiForm(),this.cbaConfig.changeTab?(b.fireEvent("changeTab"),this.cbaConfig.changeTab=!1):this.navDirection="");break;default:d.down("#Container")&&d.down("form")&&(b=d.down("#Container").controller,Ext.isEmpty(b)&&(b=d.down("form").controller),d.down("form").getForm().isDirty()&&
b&&(this.cbaConfig.changeTab=b.verificaCampiForm(),this.cbaConfig.changeTab?(b.fireEvent("changeTab"),this.cbaConfig.changeTab=!1):this.navDirection=""))}this.cbaConfig.changeTab&&c.cbaConfig.refreshOnTabChange&&(c=c.down("#Container").controller)&&c.aggiornaStore&&c.aggiornaStore();return this.cbaConfig.changeTab},tabchangeTabPanel:function(b,c,d,f){f=49===CBA.moduli.moduloAttivo;var g=this.getTabPanel().items.items[0].down("#Container").controller,h=null;this.cbaConfig.controllerServizi&&this.cbaConfig.controllerServizi.getCbResidenza()&&
(h=this.cbaConfig.controllerServizi.getCbResidenza());if(!f){var k=this.cbaConfig.controllerIndirizzi.down("#Container").controller.getBoxIndirizzi().down("#pnlIndirizzi").controller,l,n="",p="",q="",r="",t=k.getComune().rawValue;null!=k.getDataDecorrenza().getValue()&&(l=FormattaData(k.getDataDecorrenza().getValue()));""!=k.getIndirizzo().rawValue&&(n=k.getIndirizzo().getValue());""!=k.getComune().rawValue&&(q=k.getComune().rawValue.substr(0,t.length-6));""!=k.getNumero().getValue()&&(p=k.getNumero().rawValue);
null!=k.getNazione().getValue()&&(r=k.getNazione().rawValue.substr(0,k.getNazione().rawValue.length-4));if(l=l?l+": ":null)n&&(l+=" "+n),p&&(l+=" "+p),q&&(l+=n||p?", "+q:q),r&&(l+=" - "+r),this.cbaConfig.nuovo&&(h.setEmptyText(l),h.allowBlank=!0);c!==this.getTabServizi()||this.cbaConfig.nuovo||h.getStore().load({params:{codOspite:this.cbaConfig.currOspite.codOspite,tipoIndirizzo:"R"},callback:function(b,c,d){d?h.bindStore(cbResidenza.getStore()):msgShowError("",c.getError())}})}f?(c===this.getTabServizi()&&
this.cbaConfig.useExistCF&&(this.cbaConfig.controllerTipologieCartella.cbaConfig.codOspite=g.currentDip,this.cbaConfig.controllerTipologieCartella.aggiornaStore(),b=this.cbaConfig.controllerTipologieCartella.getBoxBottoni(),b.queryById("btnNuovo").setVisible(!0),b.queryById("btnElimina").setVisible(!0),b.queryById("btnConferma").setVisible(!0),b.queryById("btnAnnulla").setVisible(!0)),this.cbaConfig.nuovo?(this.getBtnAvanti().setDisabled(c.cbaConfig.actualPosTabCss===this.tabPosition.length?!0:!1),
this.getBtnIndietro().setDisabled(0===c.cbaConfig.actualPosTabCss?!0:!1),c.cbaConfig.actualPosTabCss===this.tabPosition.length-1&&g.currentDip&&!this.cbaConfig.useExistCF&&this.getBtnAvanti().setDisabled(!0)):(this.cbaConfig.isEditMatita?this.getBtnAvanti().setDisabled(c.cbaConfig.actualPosTabCss===this.tabPosition.length?!0:!1):this.getBtnAvanti().setDisabled(c.cbaConfig.actualPosTabCss===this.tabPosition.length-1?!0:!1),this.getBtnIndietro().setDisabled(0===c.cbaConfig.actualPosTabCss?!0:!1))):
(this.getBtnAvanti().setDisabled(c.cbaConfig.progressivoTab===b.items.getCount()?!0:!1),this.getBtnIndietro().setDisabled(0===c.cbaConfig.progressivoTab?!0:!1),this.cbaConfig.nuovo&&4>=b.items.getCount()&&(this.getBtnAvanti().setDisabled(!1),this.getBtnIndietro().setDisabled(!0)));(b=c.down("grid"))&&!b.getSelectionModel().getSelection()[0]&&0<b.getStore().getCount()?b.getSelectionModel().select(0):b&&b.controller&&b.controller.afterTabChange?b.controller.afterTabChange():c.controller&&c.controller.afterTabChange&&
c.controller.afterTabChange();this.navDirection="";c.cbaConfig.posTabCss>d.cbaConfig.posTabCss&&this.cbaConfig.nuovo?this.aggiornaPercCompletamento(d,d.itemId):f||this.aggiornaPercCompletamento(d,d.itemId)},clickBtnEsci:function(b){var c=this,d=c.getTabPanel().getActiveTab(),f=d.down("#Container");c.cbaConfig.callbackEsci&&Ext.isFunction(c.cbaConfig.callbackEsci)&&c.cbaConfig.callbackEsci();c.cbaConfig.nuovo?(b=[],c.currentDip?msgAddWarning(b,"TERMINARE_INSERIMENTO_NUOVO_FASCICOLO"):msgAddWarning(b,
"ANNULLARE_INSERIMENTO_NUOVO_FASCICOLO"),msgShow("USCITA_NUOVO_FASCICOLO",b,"YESNO",!1,function(){if(c.currentDip)if(49===CBA.moduli.moduloAttivo){var b=c.cbaConfig.controllerFascicolo.getGridRicerca().getStore();svuotaStore(b);c.cbaConfig.controllerFascicolo.cerca()}else c.refreshDatiVideataFascicolo();f?(c.currentDip||clearForm(f.controller.getForm()),f.controller.fireEvent("esci")):d.up("window").close()},function(){return!1},!1,!0)):(c.refreshDatiVideataFascicolo(),49===CBA.moduli.moduloAttivo&&
(c.cbaConfig.refreshUtenteCss?c.cbaConfig.controllerFascicolo.cerca():"function"==typeof c.cbaConfig.controllerFascicolo.getGridRicerca&&!CBA.moduli.modulo49.cartella_old&&CBA.moduli.modulo49.storeAnagraficaSel.getAt(0)&&(b=c.cbaConfig.controllerFascicolo.getGridRicerca(),c.cbaConfig.controllerFascicolo.getGridRicerca().getStore(),b.cbaConfig.paged.fromScroll=!0,c.cbaConfig.controllerFascicolo.controllaRicoveriDaUscitaAna())),f&&f.controller?f.controller.fireEvent("esci"):d.up("window").close())},
aggiornaPercCompletamento:function(b,c){var d=this,f=d.getProgressWizardFas(),g=0,h=49===CBA.moduli.moduloAttivo;if(h)b&&c?d.gestProgressWizard&&(d.currentDip?(g=3*d.gestProgressWizard.percentTab,Ext.each(d.getTabPanel().items.items,function(b){2<b.cbaConfig.progressivoTab&&0<(10==b.cbaConfig.progressivoTab?b.controller.getTpCauzione().down("grid"):b.down("grid")).getStore().getCount()&&(g+=d.gestProgressWizard.percentTab)})):h&&(g=(b.cbaConfig.actualPosTabCss+1)/d.tabPosition.length)):g=1;else if(d.gestProgressWizard)if(d.currentDip)g=
1/d.getTabPanel().items.length*4,Ext.each(d.getTabPanel().items.items,function(b){3<b.cbaConfig.progressivoTab&&0<(b.down("grid")||b.controller.getTpCauzione().down("grid")).getStore().getCount()&&(g+=1/d.getTabPanel().items.length)});else switch(b.itemId){case "DatiAnagrafici":g=d.gestProgressWizard.percentTab;break;case "UlterioriDati":g=1.5*d.gestProgressWizard.percentTab;break;case "Indirizzi":g=2*d.gestProgressWizard.percentTab;break;default:g=0}h=(100*g).toFixed(h?0:2)+"% Completamento..";f.updateProgress(g,
.99>=g?h:"Fascicolo completo!",!0)},refreshDatiVideataFascicolo:function(){if(49!==CBA.moduli.moduloAttivo){var b=this.cbaConfig.controllerFascicolo?this.cbaConfig.controllerFascicolo.currentDip:null;if(this.currentDip||b){var b=this.currentDip?this.currentDip:b,c=this.cbaConfig.currOspite&&this.cbaConfig.currOspite.ricovero?this.cbaConfig.currOspite.ricovero.idRicovero:-1,d=this.cbaConfig.controllerFascicolo.Ricerca;d.controller.getGridRicerca().getSelectionModel().deselectAll();d.cbaConfig.caricaDatiUtente(b,
c);(this.cbaConfig.nuovo||this.cbaConfig.reload)&&d.controller.cerca()}}},aggiungiDocumento:function(b){var c=49===CBA.moduli.moduloAttivo?6:5;this.getTabPanel().setActiveTab(c);var d,f=0,c=this.getTabPanel().items.items[c].down("#Container").controller;Ext.each(c.getDocTipoDoc().getStore().data.items,function(c){c.data.valore==b&&(d=f);f++});c.nuovo();c.getDocTipoDoc().setValue(c.getDocTipoDoc().getStore().getAt(d).data.codice)},sistemaTabServiziRicoveri:function(b){var c=this,d=c.getTabPanel(),
f=null;"N"!=b.permesso&&(f=[{xtype:"container",itemId:"TabRicoveri",reference:"TabRicoveri",title:traduci("RICOVERI"),layout:{type:"fit"},listeners:{afterrender:function(d){var f=Ext.create("GeneraliOSP.fascicoloNoApp.view.EditServiziV1",{cbaConfig:b});d.add(f);Ext.applyIf(d.cbaConfig,{progressivoTab:3});b.refreshOnTabChange&&Ext.applyIf(d.cbaConfig,{refreshOnTabChange:b.refreshOnTabChange});c.cbaConfig.controllerTipologieCartella=d.down("#StoricoGridServizi").controller}}}],d.insert(4,f));c.getTipologieCartella()&&
c.getTipologieCartella().tab.setHidden(!0);Ext.defer(function(){c.getTabPanelPosition()},500)},getSicpar2Prop:function(b){return new Promise(function(c,d){Ext.Ajax.request({method:"GET",url:"/cba/gen/config/"+b,params:{},success:function(b){b=Ext.JSON.decode(b.responseText);var d=b.data;b.success&&c(d)},failure:function(b){d()}})})},getPermessoVideataTab:function(b){var c="S";49==CBA.moduli.moduloAttivo&&"EditServizi"==b&&(c="N");if(49==CBA.moduli.moduloAttivo&&!this.cbaConfig.editVersioneAnagrafica)c=
"L";else if([43,46,48,50,55,64].includes(CBA.moduli.moduloAttivo)){var d=!1;Ext.each(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].moduli,function(c){c.codVideata==b&&(d=c)});c=d?d.permesso:(d=trovaRecord(this.storePermessi,"codVideata",b))?d.get("permesso"):"N"}else if(49!=CBA.moduli.moduloAttivo||2!=CBA.moduli.modulo49.controllerCercaAnagrafica.versioneAnagrafica){var f=trovaRecord(this.storePermessi,"codVideata",b);f&&(c=f.get("permesso"))}return c},onLaunch:function(){var b=this,c=this,d=c.cbaConfig.controllerFascicolo,
f=c.getTabPanel(),g=49==CBA.moduli.moduloAttivo;c.storePermessi=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].storeVideateGen;c.cbaConfig.useExistCF=!1;c.currRicoveroCSS=null;g&&!c.cbaConfig.nuovo&&(c.currRicoveroCSS={id:c.cbaConfig.currOspite.idRicovero});var h=c.getPermessoVideataTab("OSP_Anagrafica"),k=c.getUlterioriDati(),l=c.getIndirizzi(),n={permesso:h,controllerEditFascicolo:c,controllerFascicolo:d,wizard:!0},p=c.cbaConfig.recordIntegrazione;p&&p.get("indResidenza")&&(n.recordIntegrazioneResidenza=
p.get("indResidenza"));g&&!c.cbaConfig.versioneAnagrafica&&(delete n.controllerFascicolo,this.getIndirizzi().tab.setHidden(c.cbaConfig.nuovo||c.cbaConfig.insertRicoveroCss),this.getTabServizi().tab.setHidden(!0),this.getUlterioriDati().tab.setHidden(c.cbaConfig.insertRicoveroCss));var q=Ext.create("GeneraliOSP.fascicoloNoApp.view.EditUlterioriDati",{cbaConfig:n}),p=q.controller;k.add(q);k.cbaConfig={progressivoTab:1};c.cbaConfig.controllerUltDati=k;n=Ext.create("GeneraliOSP.fascicoloNoApp.view.EditIndirizzi",
{cbaConfig:n});l.add(n);l.cbaConfig={progressivoTab:2};c.cbaConfig.controllerIndirizzi=l;var q=n.down("#StoricoGridIndirizzi").controller,r=c.getPermessoVideataTab(g?"EditRicoveri":"EditServizi"),t=c.getTabServizi(),n={permesso:r,controllerEditFascicolo:c,controllerFascicolo:d,wizard:!0};"N"!=r?(49===CBA.moduli.moduloAttivo&&delete n.controllerFascicolo,g&&1==c.cbaConfig.versioneAnagrafica?(r=Ext.create("GeneraliOSP.fascicoloNoApp.view.EditServiziV1",{cbaConfig:n}),t.add(r),t.cbaConfig={progressivoTab:3},
c.cbaConfig.controllerTipologieCartella=r.down("#StoricoGridServizi").controller):g||(r=Ext.create("GeneraliOSP.fascicoloNoApp.view.EditServizi",{cbaConfig:n}),t.add(r),t.cbaConfig={progressivoTab:3},c.cbaConfig.controllerServizi=r.down("#StoricoGridServizi").controller)):t.tab.setHidden(!0);if(49!=CBA.moduli.moduloAttivo||c.cbaConfig.versioneAnagrafica)f.remove(c.getTipologieCartella());else{c.getProgressWizardFas().setVisible(!1);c.cbaConfig.nuovo&&c.getUlterioriDati().tab.setHidden(!0);t=c.getPermessoVideataTab("EditServizi");
n&&Ext.apply(n,{refreshOnTabChange:c.cbaConfig.CSS_servizi&&"N"!=t});var r=Ext.create("GeneraliOSP.fascicoloNoApp.view.EditServiziCSS",{cbaConfig:{permesso:c.cbaConfig.nuovo||c.cbaConfig.insertRicoveroCss?"S":"L",nuovoDefault:c.cbaConfig.insertRicoveroCss||!1,controllerEditFascicolo:c,refreshOnTabChange:c.cbaConfig.CSS_servizi&&"N"!=t,wizard:!0}}),u=c.getTipologieCartella();u.add(r);u.cbaConfig={progressivoTab:3,refreshOnTabChange:c.cbaConfig.CSS_servizi&&"N"!=t};c.cbaConfig.controllerTipologieCartella=
r.down("#StoricoGridServizi").controller;c.cbaConfig.CSS_servizi&&"N"!=t&&(t=Ext.create("GeneraliOSP.fascicoloNoApp.view.EditServizi",{cbaConfig:{permesso:t,controllerEditFascicolo:c,wizard:!0,titolo:traduci("SERVIZI"),refreshOnTabChange:!0},title:traduci("SERVIZI")}),c.getTabPanel().add(t),c.cbaConfig.controllerServizi=t.down("#StoricoGridServizi").controller);t=c.getPermessoVideataTab("CSSEditAssenze");c.cbaConfig.CSS_assenze&&"N"!=t&&c.getTabPanel().add(Ext.create("GeneraliCS.assenze.view.Assenze",
{flex:1,itemId:"TabSec_Assenze"+Ext.Date.now(),reference:"TabSec_Assenze"+Ext.Date.now(),title:traduci("ASSENZE"),cbaConfig:{nuovo:c.cbaConfig.controllerFascicolo.utenteSelezionato.data.codOspite,controllerFascicolo:c.cbaConfig.controllerFascicolo,permesso:t,controllerEditFascicolo:c,wizard:!0,progressivoTab:11,titolo:traduci("ASSENZE")}}));c.cbaConfig.CSS_permessi&&(c.cbaConfig.nuovo||c.cbaConfig.insertRicoveroCss||c.getTabPanel().add(Ext.create("GeneraliCS.permessi.view.Main",{flex:1,itemId:"TabSec_Permessi"+
Ext.Date.now(),reference:"TabSec_Permessi"+Ext.Date.now(),title:traduci("PERMESSI"),cbaConfig:{controllerEditFascicolo:c,wizard:!0,progressivoTab:13,titolo:traduci("PERMESSI")}})));c.cbaConfig.CSS_consenso&&(c.cbaConfig.nuovo||c.cbaConfig.insertRicoveroCss||c.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.Consenso",{flex:1,itemId:"TabSec_Consenso"+Ext.Date.now(),reference:"TabSec_Consenso"+Ext.Date.now(),title:traduci("CONSENSO_DOSSIER"),cbaConfig:{controllerEditFascicolo:c,permesso:"S",wizard:!0,
progressivoTab:14,titolo:traduci("CONSENSO_DOSSIER")}})));t=c.getPermessoVideataTab("OSP_Residenziale");c.cbaConfig.CSS_residenza&&"N"!=t&&!c.cbaConfig.nuovo&&(r={codOspite:c.cbaConfig.controllerFascicolo.utenteSelezionato.data.codOspite},c.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.OSP_Residenziale",{flex:1,itemId:"TabSec_EditResidenza"+Ext.Date.now(),reference:"TabSec_EditResidenza"+Ext.Date.now(),title:traduci("RESIDENZA"),cbaConfig:{nuovo:c.cbaConfig.controllerFascicolo.utenteSelezionato.data.codOspite,
cartella:!0,permesso:t,recRicovero:r,controllerFascicolo:c.cbaConfig.controllerFascicolo,controllerEditFascicolo:c,wizard:!0,progressivoTab:12,titolo:"EditResidenza",refreshOnTabChange:!0}})));t=c.getPermessoVideataTab("Referenti");!g||c.cbaConfig.nuovo||c.cbaConfig.insertRicoveroCss||"N"==t||(c.getTabPanel().add(Ext.create("GeneraliOSP.portlet.view.Referenti",{flex:1,itemId:"TabSec_EditReferenti"+Ext.Date.now(),reference:"TabSec_EditReferenti"+Ext.Date.now(),title:traduci("REF_WIZARD"),cbaConfig:{nuovo:c.cbaConfig.controllerFascicolo.utenteSelezionato.data.codOspite,
cartella:!0,permesso:2==CBA.moduli.modulo49.controllerCercaAnagrafica.versioneAnagrafica?"S":t,controllerFascicolo:c.cbaConfig.controllerFascicolo,controllerEditFascicolo:c,wizard:!0,progressivoTab:4,titolo:"EditReferenti"}})),Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/importz/ricovero/show",params:{idRicovero:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero},success:function(c){c=Ext.JSON.decode(c.responseText);var d=[];c.success?c.data&&b.getTabPanel().add(Ext.create("GeneraliOSP.fascicoloNoApp.view.ImportRicoveroCss",
{flex:1,title:traduci("IMPORTA_RIC_PREC"),cbaConfig:{nuovo:b.cbaConfig.controllerFascicolo.utenteSelezionato.data.codOspite,cartella:!0,permesso:"S",controllerFascicolo:b.cbaConfig.controllerFascicolo,controllerEditFascicolo:b,wizard:!0}})):msgAddError(d,c.message);msgShow("",d)}}))}g=c.getDatiAnagrafici();d={permesso:h,controllerEditFascicolo:c,controllerFascicolo:d,controllerIndirizzi:q,controllerServizi:c.cbaConfig.controllerServizi,controllerUltDati:p,controllerTipologieCartella:c.cbaConfig.controllerTipologieCartella,
editVersioneAnagrafica:c.cbaConfig.editVersioneAnagrafica,editAnagrafica:c.cbaConfig.editAnagrafica,wizard:!0,recordIntegrazione:c.cbaConfig.recordIntegrazione};49==CBA.moduli.moduloAttivo&&delete d.controllerFascicolo;p="";p=49!=CBA.moduli.moduloAttivo||c.cbaConfig.versioneAnagrafica?Ext.create("GeneraliOSP.fascicoloNoApp.view.EditDatiAnagrafici",{cbaConfig:d}):Ext.create("GeneraliOSP.fascicoloNoApp.view.EditDatiAnagraficiCSS",{cbaConfig:d});g.add(p);g.cbaConfig={progressivoTab:0};c.cbaConfig.controllerDatiAnagrafici=
g;c.cbaConfig.nuovo?43==CBA.moduli.moduloAttivo||64==CBA.moduli.moduloAttivo?c.gestProgressWizard={numeroTab:10,percentTab:.1}:50==CBA.moduli.moduloAttivo?c.gestProgressWizard={numeroTab:9,percentTab:1/9}:48==CBA.moduli.moduloAttivo?c.gestProgressWizard={numeroTab:7,percentTab:1/7}:49==CBA.moduli.moduloAttivo&&(c.gestProgressWizard={numeroTab:8,percentTab:.125}):(c.getProgressWizardFas().setVisible(!1),c.getBtnCreaAnagrafica().setDisabled(43!==CBA.moduli.moduloAttivo));"N"==h&&(g.tab.hide(),k.tab.hide(),
l.tab.hide());c.navDirection="";49==CBA.moduli.moduloAttivo&&c.cbaConfig.editVersioneAnagrafica&&c.cbaConfig.isEditMode?c.sistemaTabServiziRicoveri(n):Ext.defer(function(){c.getTabPanelPosition()},1E3);c.setActiveFirstVisibleTab(f);49==CBA.moduli.moduloAttivo&&(f=this.cbaConfig.desVideata?this.cbaConfig.desVideata:this.cbaConfig.controllerTestata.cbaConfig.desVideata?this.cbaConfig.controllerTestata.cbaConfig.desVideata:this.cbaConfig.controllerTestata.cbaConfig.codVideata,CBA.moduli.modulo49.dizionarioLogVideate[this.$className]=
{desVideata:f},doLogVideata(this.view,{className:this.$className,desVideata:f,logOspite:CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0]?!0:!1}))},setActiveFirstVisibleTab:function(b){var c=!1;Ext.each(b.items.items,function(d){c||d.isHidden()||d.tab.isHidden()||(b.setActiveTab(d),c=!0)})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditIndirizzi",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"StoricoGridIndirizzi",selector:c+"#StoricoGridIndirizzi"},{ref:"boxIndirizzi",selector:c+"#boxIndirizzi"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"Form",selector:c+"#Form"}]);b.control(c+"#StoricoGridIndirizzi",{select:b.onGridSelect});b.on({esci:function(){b.getForm().boxBottoni.queryById("btnEsci").handler()}});
b.on({changeTab:function(){return b.changeTab()}})},onGridSelect:function(b,c,d,f){this.impostaDati(c)},getForm:function(){return this.getBoxIndirizzi().down().controller.getForm()},impostaDati:function(b){this.getStoricoGridIndirizzi().setDisabled(!1);clearForm(this.getForm());b?(this.getForm().getForm().setValues({idIndirizzoAnagrafica:b.get("idIndirizzoAnagrafica")}),0!=b.data.nazione&&(b.data.cap=null,b.data.comune=null,b.data.provincia=null,b.data.desComune=null,b.data.civico=null),this.getBoxIndirizzi().down().controller.updateDati(b.data)):
(this.getStoricoGridIndirizzi().setDisabled(!0),this.getBoxIndirizzi().down().controller.updateNazione("0"),this.getBoxIndirizzi().down().controller.impostaAsl(),validaForm(this.getForm()))},nuovo:function(){controller_nuovoRecord(this.getForm());this.getForm().getForm().setValues({idIndirizzoAnagrafica:-9999,tipoIndirizzo:"R"});var b=this.getBoxIndirizzi().down().controller;this.cbaConfig.codOspite&&b.getCbxTipoIndirizzo().setReadOnly(!1);b.updateNazione("0");if(b=this.cbaConfig.recordIntegrazioneResidenza)b.is_integrazione=
!0,this.getBoxIndirizzi().down().controller.updateDati(b)},verificaCampiForm:function(){var b=[],c=this.getForm();if(!1===this.getBoxIndirizzi().down().controller.verificaIndirizzo())return!1;var d=this.getBoxIndirizzi().down("#dataDecorrenza").getValue(),f=this.cbaConfig.controllerEditFascicolo.getDatiAnagrafici().down("#aDataNascita").getValue();f&&d<f&&msgAddError(b,"MSG_IND_ERRORE_DATA_INFERIORE_NASCITA");c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow(traduci("INDIRIZZI"),
b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=this.getForm().getForm().getFieldValues();delete c.id;Ext.apply(c,{codOspite:this.cbaConfig.codOspite,idIndirizzoAnagrafica:this.getForm().getForm().findField("idIndirizzoAnagrafica").getValue(),id:this.getForm().queryById("idIndirizzo").getValue()});controller_salvaRecord(this.getForm(),c,b,{},!1,!1,"idIndirizzo")&&""!=this.cbaConfig.controllerEditFascicolo.navDirection&&this.cbaConfig.controllerEditFascicolo.navigaWizard(this.cbaConfig.controllerEditFascicolo.navDirection,
!0)},aggiornaIndResidenza:function(){for(var b=$jscomp.makeIterator(this.getStoricoGridIndirizzi().getStore().getData().items),c=b.next();!c.done;c=b.next())if(c=c.value,"R"==c.get("tipoIndirizzo")&&"undefined"!=typeof currOspite){currOspite.indResidenza=c.data;break}},aggiornaStore:function(b){var c=this,d=c.getStoricoGridIndirizzi().getStore();c.getBoxIndirizzi().down().controller.getCbxTipoIndirizzo().setReadOnly(!0);d.load({params:{codospite:null!=c.cbaConfig.codOspite?c.cbaConfig.codOspite:-9999,
tipoIndirizzo:"T"},callback:function(f,g,h){h?Ext.isEmpty(f)?clearForm(c.getForm()):(f=trovaRecord(d,"idIndirizzo",b),g=c.getStoricoGridIndirizzi(),g.getSelectionModel().deselectAll(),g.getSelectionModel().select(f?[f]:0),c.aggiornaIndResidenza()):msgShowError("",g.getError())}})},changeTab:function(){var b=this,c=b.getForm().up("window");controller_puoiUscire(c,b.getForm(),function(){b.salva(!1)},function(){b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,
!0)},function(){b.aggiornaStore()})},afterTabChange:function(){var b=this.getForm(),c=49===CBA.moduli.moduloAttivo;if("L"==b.permesso&&c)return!1;0==this.getStoricoGridIndirizzi().getStore().getCount()&&null==this.getBoxIndirizzi().down("#dataDecorrenza").getValue()&&this.nuovo()},onLaunch:function(){var b=this;m=b;b.getContainer().controller=b;b.getStoricoGridIndirizzi().controller=b;ImpostaUrl([b.getStoricoGridIndirizzi().getStore()]);var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=b.getForm().getForm().findField("idIndirizzoAnagrafica").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.getStoricoGridIndirizzi().getStore(),{id:c},function(){b.aggiornaStore()})},esci_callback:function(){var c=b.getForm().up("window");controller_puoiUscire(c,b.getForm(),function(){b.salva(!0)},function(){c.close()},function(){c.close()})},
verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),c);c=Ext.create("GeneraliOSP.fascicoloNoApp.view.BoxIndirizzi",{itemId:"pnlIndirizzi",reference:"pnlIndirizzi"+Ext.Date.now(),cbaConfig:{nascondiButtonModifica:!0,gestioneTipoIndirizzo:!0,gestioneDataDecorrenza:!0,decorrenzaObbligatorio:!0,comuneObbligatorio:!0,visualizzaAsl:!0,visualizzaAsst:!0}});b.getBoxIndirizzi().add(c);c=b.getForm();c.permesso=b.cbaConfig.permesso;b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&
(c.permesso=b.cbaConfig.permesso);c.boxBottoni=b.getBoxBottoni();c.store=b.getStoricoGridIndirizzi().getStore();c.controller=b;b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?(c.boxBottoni.queryById("btnNuovo").setVisible(!1),c.boxBottoni.queryById("btnElimina").setVisible(!1),c.boxBottoni.queryById("btnConferma").setVisible(!1),c.boxBottoni.queryById("btnAnnulla").setVisible(!1),b.impostaDati()):(b.cbaConfig.codOspite||(b.cbaConfig.codOspite=b.cbaConfig.controllerFascicolo?
b.cbaConfig.controllerFascicolo.currentDip:b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite),b.aggiornaStore());c.boxBottoni.queryById("btnEsci").setVisible(!1);if("L"!=c.permesso)b.getForm().getForm().on("dirtychange",function(c,f){controller_abilitaBottoni(b.getForm());b.getStoricoGridIndirizzi().setDisabled(f);b.cbaConfig.controllerEditFascicolo&&!b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(f),b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(f))});
"L"==c.permesso&&(containerSolaLettura(b.getForm()),controller_bottoniSolaLettura(b.getBoxBottoni()))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditServizi",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"tipoServizio",selector:c+"#tipoServizio"},{ref:"servizioDataAl",selector:c+"#servizioDataAl"},{ref:"StoricoGridServizi",selector:c+"#StoricoGridServizi"},{ref:"cbResidenza",selector:c+"#cbResidenza"},{ref:"motivoDimissione",selector:c+"#motivoDimissione"},{ref:"TabProroghe",
selector:c+"#TabProroghe"},{ref:"LbGiorniPrognosi",selector:c+"#LbGiorniPrognosi"},{ref:"Form",selector:c+"#Form"},{ref:"RegimeRicovero",selector:c+"#RegimeRicovero"},{ref:"ClassePriorita",selector:c+"#ClassePriorita"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"cntCda",selector:c+"#cntCda"},{ref:"NoteDimissione",selector:c+"#NoteDimissione"},{ref:"servizioOraUscita",selector:c+"#servizioOraUscita"},{ref:"parametriRette",selector:c+"#parametriRette"},{ref:"servizioOraIngresso",selector:c+"#servizioOraIngresso"},
{ref:"servizioDataDal",selector:c+"#servizioDataDal"},{ref:"nameLabelNumFasc",selector:c+"#nameLabelNumFasc"},{ref:"prefNumFasc",selector:c+"#prefNumFasc"},{ref:"servizioNumeroFascicolo",selector:c+"#servizioNumeroFascicolo"},{ref:"suffNumFasc",selector:c+"#suffNumFasc"},{ref:"EditServiziRecordId",selector:c+"#EditServiziRecordId"},{ref:"codBiancheria",selector:c+"#codBiancheria"},{ref:"rendLomb",selector:c+"#rendLomb"},{ref:"ggMax",selector:c+"#ggMax"},{ref:"DatiSosia1",selector:c+"#DatiSosia1"},
{ref:"cbRicoveroColl",selector:c+"#cbRicoveroColl"},{ref:"cbSollievo",selector:c+"#cbSollievo"},{ref:"BtnPriorita",selector:c+"#BtnPriorita"},{ref:"IdCicloScolastico",selector:c+"#IdCicloScolastico"},{ref:"recordAccorpato",selector:c+"#recordAccorpato"},{ref:"CBCapitolo",selector:c+"#CBCapitolo"},{ref:"CBArticolo",selector:c+"#CBArticolo"},{ref:"CBConto",selector:c+"#CBConto"},{ref:"CBForzaParamContabili",selector:c+"#CBForzaParamContabili"},{ref:"idParametriRette",selector:c+"#idParametriRette"},
{ref:"idParametriContabilita",selector:c+"#idParametriContabilita"},{ref:"codiceRid",selector:c+"#codiceRid"},{ref:"CntCampiPers",selector:c+"#CntCampiPers"},{ref:"idMotivoIngresso",selector:c+"#idMotivoIngresso"},{ref:"NotePresaInCarico",selector:c+"#NotePresaInCarico"},{ref:"ResponsabileRicovero",selector:c+"#ResponsabileRicovero"},{ref:"ResponsabileRicoveroTxt",selector:c+"#ResponsabileRicoveroTxt"},{ref:"ResponsabileRicoveroBtn",selector:c+"#ResponsabileRicoveroBtn"},{ref:"idIniziativaRichiesta",
selector:c+"#idIniziativaRichiesta"},{ref:"idTipoProvenienza",selector:c+"#idTipoProvenienza"},{ref:"idTipoRicovero",selector:c+"#idTipoRicovero"},{ref:"onereDegenza",selector:c+"#onereDegenza"},{ref:"dataRichiestaRicovero",selector:c+"#dataRichiestaRicovero"},{ref:"dataRicezioneRichiesta",selector:c+"#dataRicezioneRichiesta"},{ref:"GiorniPrognosi",selector:c+"#GiorniPrognosi"},{ref:"DataDimissionePrevista",selector:c+"#DataDimissionePrevista"},{ref:"DataDimissionePrevistaMedica",selector:c+"#DataDimissionePrevistaMedica"},
{ref:"TabPanels",selector:c+"#TabPanels"},{ref:"TabNote",selector:c+"#TabNote"},{ref:"tabDatiCont",selector:c+"#tabDatiCont"},{ref:"PresaInCaricoDati",selector:c+"#PresaInCaricoDati"},{ref:"tabAltreInfo",selector:c+"#tabAltreInfo"},{ref:"tabPers",selector:c+"#tabPers"},{ref:"noCamp",selector:c+"#noCamp"},{ref:"CbSituazionePensionistica",selector:c+"#CbSituazionePensionistica"},{ref:"CbProfessioneIngresso",selector:c+"#CbProfessioneIngresso"},{ref:"CbDataEventoIndiceSv",selector:c+"#CbDataEventoIndiceSv"},
{ref:"FsSosiaLomb",selector:c+"#FsSosiaLomb"},{ref:"DiagnosiIngresso",selector:c+"#DiagnosiIngresso"},{ref:"CntIdc9",selector:c+"#CntIdc9"},{ref:"MedicoMedGen",selector:c+"#MedicoMedGen"},{ref:"MedicoInviante",selector:c+"#MedicoInviante"},{ref:"BtnMedico",selector:c+"#BtnMedico"}]);b.control(c+"#BtnMedico",{click:b.clickBtnMedico});b.control(c+"#GiorniPrognosi",{change:b.onGiorniPrognosiChange});b.control(c+"#NoteDimissione",{change:b.onNoteDimissioneChange});b.control(c+"#servizioNumeroFascicolo",
{change:b.onNumFascChange});b.control(c+"#tipoServizio",{select:b.onTipoServizioSelect,expand:b.expandTipo,collapse:b.collapseTipo});b.control(c+"#servizioDataDal",{change:b.onServizioDataDalChange});b.control(c+"#servizioDataAl",{change:b.onServizioDataAlChange});b.control(c+"#StoricoGridServizi",{select:b.onStoricoGridSelect});b.control(c+"#BtnPriorita",{afterrender:b.onBtnPrioritaafterrender});b.control(c+"#CBCapitolo",{change:b.onCapitoloChange});b.control(c+"#ResponsabileRicoveroBtn",{click:b.onResponsabileRicoveroBtnClick});
b.on({esci:function(){b.getForm().boxBottoni.queryById("btnEsci").handler()}});b.on({changeTab:function(){return b.changeTab()}})},calcolaGiorniPrognosi:function(){var b=0;this.getTabProroghe().down("#Grid").getStore().each(function(c){return b=c.get("giorniAutorizzati")?b+c.get("giorniAutorizzati"):b});var c=this.getGiorniPrognosi().getValue()||0,c=b+c;this.getLbGiorniPrognosi().setHtml("+ "+b+" = "+c);var d=this.getServizioDataDal().getValue();d?(d=new Date(d),d.setDate(d.getDate()+(0<c?c:0)),this.getDataDimissionePrevista().setValue(d)):
this.getDataDimissionePrevista().setValue(null)},onResponsabileRicoveroBtnClick:function(b,c,d){b=this.getEditServiziRecordId().getValue();if(null==b)return!1;c=this.getTipoServizio().getSelectedRecord().get("tipoServizio");Ext.create("winCBA",{name:"GeneraliOSP.fascicoloNoApp.view.ResponsabileRicovero",titolo:traduci("RESPONSABILE_ASSEGNAZIONE"),dimensione:2,configItem:{idRicovero:b,tipoServizio:c,ricoveriCtrl:this}}).show()},onGiorniPrognosiChange:function(b,c,d){this.calcolaGiorniPrognosi()},onNoteDimissioneChange:function(b,
c,d){null!=c&&100<c.length&&(b.setValue(c.substring(0,100)),b=[],msgAddWarning(b,"Raggiunta lunghezza massima del campo note!"),msgShow("",b))},onNumFascChange:function(){this.getServizioNumeroFascicolo().setWidth(80)},collapseTipo:function(b,c){b.store.clearFilter()},expandTipo:function(b,c){b.store.clearFilter();b.store.filter(function(b,c){var d=b.get("tipoServizio");return 48==CBA.moduli.moduloAttivo&&"L"==d||48!=CBA.moduli.moduloAttivo&&"L"!=d})},onStoricoGridSelect:function(b,c,d,f){this.impostaDati(c);
b=this.cbaConfig.codOspite;49!=getModuloAttivo()?("undefined"!==typeof currRicovero&&currRicovero||(currRicovero=this.getForm().getValues(),currRicovero.codOspite=this.cbaConfig.codOspite),currRicovero.dataAl=this.getServizioDataAl().getValue(),b=currRicovero.codOspite):c&&(currRicovero=this.getForm().getValues(),currRicovero.codOspite=this.cbaConfig.codOspite,b=currRicovero.codOspite,currRicovero.servizio=c.get("servizio"));"L"!=this.cbaConfig.permesso&&permettiModificheDopoDimissione()?(containerSolaLettura(this.getForm(),
!1),this.getCbResidenza().getStore().load({params:{codOspite:b,tipoIndirizzo:"R"}}),controller_bottoniSolaLettura(this.getBoxBottoni()),this.getForm().boxBottoni.queryById("btnNuovo").setDisabled(!1),this.getForm().boxBottoni.queryById("btnElimina").setDisabled(!1),this.getMedicoMedGen().setReadOnly(c)):(containerSolaLettura(this.getForm()),controller_bottoniSolaLettura(this.getBoxBottoni()),this.getForm().boxBottoni.queryById("btnNuovo").setDisabled("L"==this.cbaConfig.permesso));"undefined"!==typeof currOspite&&
currOspite&&(currOspite.ricovero=c)},getDefaultTipoServ:function(){var b;switch(getModuloAttivo()){case 48:b="L";break;case 50:b="A";break;case 64:b="B";break;default:b="R"}return b},onTipoServizioSelect:function(b,c){var d=this.getDefaultTipoServ();c&&c.data&&(d=c.get("tipoServizio"));if("L"!=d){if(this.getMotivoDimissione().setValue(""),b.value){this.getMotivoDimissione().getStore().load({params:{idServizio:b.value}});loadStore(this.getIdTipoProvenienza().getStore(),{idServizio:b.value});loadStore(this.getIdMotivoIngresso().getStore(),
{idServizio:b.value});loadStore(this.getIdIniziativaRichiesta().getStore(),{idServizio:b.value});loadStore(this.getIdTipoRicovero().getStore(),{idServizio:b.value});loadStore(this.getOnereDegenza().getStore(),{idServizio:b.value});"G"==d&&(this.loadRegimeRicovero(b.value),this.loadClassePriorita(b.value));if(50==CBA.moduli.moduloAttivo){var f=this.getIdCicloScolastico().getStore();f.getProxy().extraParams.idServizio=b.value;f.load()}this.impostaDatiSosia(c.get("regione"),d)}}else this.loadOnereDegenzaLA();
svuotaStore(this.storeElencoRegole);Ext.isEmpty(c.data)||(f=c.data.regole,Ext.isEmpty(f)||this.storeElencoRegole.loadData(f));this.visualizzaCampi(d);c&&c.data&&this.visualizzaRendLomb(c.get("regione"),d,c.get("tipoFlusso"));0<=!this.getForm().getForm().findField("id").getValue()&&("S"==this.numFascicoloAutomatico&&this.getServizioNumeroFascicolo().setValue(""),this.calcolaNumeroFascicoloAuto());this.abilitaDatiSanitari("G"===d)},loadOnereDegenzaLA:function(){var b=this.getOnereDegenza(),c=Ext.create("Generali.data.StoreCodiceValore",
{proxy:{url:"/cba/osp/la/ws/prszn/infoagg/cbox"}});b.setFieldLabel(traduci("ONERE_DEGENZA")+"/"+traduci("ONERE_EROG_PREST"));b.bindStore(c);loadStore(this.getOnereDegenza().getStore(),{idOrganizzazione:getIdOrg(),domanda:9})},calcolaNumeroFascicoloAuto:function(){var b=this;if("F"!=b.numFascicoloAutomatico&&48!=CBA.moduli.moduloAttivo){var c=b.getStoricoGridServizi().getStore(),d=b.getServizioNumeroFascicolo(),f=!0;if("S"==b.numFascicoloAutomatico){var g=b.getTipoServizio().getValue(),h=null!=c.getAt(0)?
c.getAt(0).get("idServizio"):null;g!=h&&(f=!1)}0!==c.getCount()&&f?null!=d.getValue()&&""!=d.getValue()||Messaggio("ATTENZIONE","MSG_MANTIENI_NUM_FASCICOLO","YESNO","QUESTION","",function(){if("S"==b.numFascicoloAutomatico){var f=c.getAt(0);siglaServ=f.get("servizio")?f.get("servizio").sigla:"";b.impostaNumFascFormatted(f.get("fascicoloRifFormatted"),f.get("fascicoloRif"),siglaServ);setTimeout(function(){b.getCbResidenza().focus()},200)}else d.setValue(c.getAt(0).get("fascicoloRif")),setTimeout(function(){b.getTipoServizio().focus()},
200)},function(){b.generaNumeroFascicolo()}):b.generaNumeroFascicolo()}},generaNumeroFascicolo:function(){var b=this,c=0,d="",f=b.getServizioDataDal().getValue();if(null!=b.getTipoServizio().getValue()){var c=b.getTipoServizio().getValue(),g=trovaRecord(b.getTipoServizio().getStore(),"codice",c);g&&(d=g.get("sigla"))}Ext.Ajax.request({method:"GET",params:{idOrg:getIdOrg(),idServizio:c,dataDal:f},url:getUrlGen()+"/ws/genOsp/numfasc/gen",success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){c=
c.data;var f="";0<c.indexOf("")&&(f=c.split(""),c=f[0],f=f[1]);"S"==b.numFascicoloAutomatico?(b.impostaNumFascFormatted(c,f,d),b.getCbResidenza().focus()):(b.getServizioNumeroFascicolo().setValue(c),b.getTipoServizio().focus())}else msgShowError("",c.message)}})},visualizzaCampi:function(b){var c=this,d="L"==b,f=48==CBA.moduli.moduloAttivo&&"L"==b;c.getCodBiancheria().setVisible(43==CBA.moduli.moduloAttivo&&!d);c.getTabPanels().setActiveTab(c.defaultActiveTab);c.getRegimeRicovero().setVisible("G"==
b);c.getClassePriorita().setVisible("G"==b);c.getMedicoInviante().setVisible("G"==b);c.getCntIdc9().setVisible("G"==b);c.getDiagnosiIngresso().setVisible("G"==b);c.getDataRichiestaRicovero().setVisible(!f);c.getDataRicezioneRichiesta().setVisible(!f);c.getOnereDegenza().setVisible(!f);c.getIdTipoProvenienza().setVisible(!f);c.getIdMotivoIngresso().setVisible(!f);c.getIdIniziativaRichiesta().setVisible(!f);c.getIdTipoRicovero().setVisible(!f);c.getNameLabelNumFasc().setVisible(!d);c.getPrefNumFasc().setVisible(!d);
c.getServizioNumeroFascicolo().setVisible(!d);c.getSuffNumFasc().setVisible(!d);c.getMotivoDimissione().setVisible(!d&&!Ext.isEmpty(c.getServizioDataAl().getValue()));c.getTipoServizio().getValue()&&Ext.Ajax.request({method:"GET",params:{idServizio:c.getTipoServizio().getValue()},url:getUrlGen()+"/ws/genOsp/prszn/servizio/impostazioni",success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(b=b.data?StdSipcar.coalesce(b.data.prognosiProroghe,"F"):"F",c.getTabProroghe().tab.setVisible("T"==
b)):msgShowError("",b.message)}})},onBtnPrioritaafterrender:function(b,c,d){this.getParametriRette().isVisible()&&(c=Ext.create("Generali.clientiFornitori.view.PnlPriorita"),creaToolTip(b.id,"","PRIORITA_PARAMETRI_CONTABILI",235,300,c))},onCapitoloChange:function(b,c){var d=this,f=(new Date).getFullYear();c&&d.getCBArticolo().getStore().load({params:{anno:f,codCapitolo:c?c:0},callback:function(){d.filtraComboArticolo()}})},onServizioDataDalChange:function(b,c,d,f){f=this.getEditServiziRecordId().getValue();
this.calcolaGiorniPrognosi();c&&isValidDate(b)&&(this.personContabili||this.setParametriCont(),this.getForm().getForm().setValues({annoCda:this.personContabili?this.personContabili.idEsercizio:null}),Ext.isEmpty(f)&&!Ext.isEmpty(d)&&c.getFullYear()!=(10==d.length?d.getFullYear():0)&&this.calcolaNumeroFascicoloAuto())},onServizioDataAlChange:function(b,c,d,f){d=this.getDefaultTipoServ();(f=this.getTipoServizio().getSelectedRecord())&&(d=f.get("tipoServizio"));b=c?isValidDate(b):!0;f=this.defaultActiveTab;
!0===b&&(Ext.suspendLayouts(),c?(this.getServizioOraUscita().show(),"L"!=d&&(f=this.getTabNote(),this.getMotivoDimissione().show()),this.getMotivoDimissione().allowBlank=!this.getMotivoDimissione().isVisible(),this.getNoteDimissione().setReadOnly(!1)):(this.getServizioOraUscita().hide(),this.getServizioOraUscita().setValue(""),this.getMotivoDimissione().hide(),this.getNoteDimissione().setReadOnly(!0),this.getMotivoDimissione().allowBlank=!0),Ext.resumeLayouts(!0),this.getMotivoDimissione().validateValue(this.getMotivoDimissione().getValue()),
this.setParametriCont());this.getTabPanels().setActiveTab(f)},creaCampiPers:function(b){if(null!=b&&0!=b.length){var c=this.getCntCampiPers(),d=!1,f;if(0<b.length){for(var g=!1,h=6;10>=h;h++){f={xtype:"textfield",margin:"8 0 0 0",labelClsExtra:"cbaLabel",itemId:"CampoServ"+(h-5),name:"custom"+(h-5),hidden:!0};if(b[h-1]){var k=b[h-1].stato,l=b[h-1].tipocampo,n=b[h-1].descrizione,p=k&&("T"==k||"O"==k),k=k&&"T"==k,q="textfield";g||(g=p);p&&!d&&(d=!0);2==l?q="numberfield":3==l&&(q="datefield");Ext.apply(f,
{xtype:q,fieldLabel:n,hidden:!p,width:240,allowBlank:!k})}c.add(f)}g||this.getNoCamp().setVisible(!0)}else this.getTabPanels().tabBar.items.items[3].setVisible(!1);c.setVisible(d)}},impostaNumFascFormatted:function(b,c,d){this.impostaNumFascFormattedNEW(b,c,d)},impostaNumFascFormattedNEW:function(b,c,d){if(Ext.isEmpty(this.numFascicoloFormato)||c&&isNaN(c))this.getServizioNumeroFascicolo().setValue(b);else if(!Ext.isEmpty(b)){var f,g="";f=this.numFascicoloFormato;var h=f.match(/A+/),k=f.match(/S+/);
h&&1==h[0].length&&(f=f.replace("A","AAAA"));d&&k&&1==k[0].length&&(f=f.replace("S","SSSSSS".substr(0,d.length)));d=f.match(/N+/);c&&d&&1==d[0].length&&(f=f.replace("N","NNNNNNNNNNNNNNNNNNNN".substr(0,c.length)),d=f.match(/N+/));d&&0<=d.index&&(h=d.index+d[0].length,c=b.substr(d.index,h-d.index),f=b.substr(0,d.index),h<b.length&&(g=b.substr(h)),b=parseInt(c),this.getServizioNumeroFascicolo().setValue(b),this.getPrefNumFasc().setText(f),this.getSuffNumFasc().setText(g),g=10+8*c.length,this.getServizioNumeroFascicolo().setWidth(g))}},
impostaNumFascFormattedOLD:function(b,c,d){c=this.numFascicoloFormato;suff=pref="";idxN=c.split("-").indexOf("N");comp=b.split("-");if(comp[idxN]){for(b=0;b<comp.length;b++)b<idxN&&(pref=pref+comp[b]+"-"),b>idxN&&(suff=suff+"-"+comp[b]);this.getServizioNumeroFascicolo().setValue(comp[idxN]);this.getPrefNumFasc().setText(pref);this.getSuffNumFasc().setText(suff);b=10+8*comp[idxN].length;this.getServizioNumeroFascicolo().setWidth(b)}else this.getServizioNumeroFascicolo().setValue(b)},loadRegimeRicovero:function(b){loadStore(this.getRegimeRicovero().getStore(),
{idServizio:b,scheda:"V",domanda:110})},loadClassePriorita:function(b){loadStore(this.getClassePriorita().getStore(),{idServizio:b,scheda:"V",domanda:111})},impostaDati:function(b,c){var d=this.getForm();this.getStoricoGrid().setDisabled(!1);clearForm(d);d.getForm().setValues({descrizioneCodice:traduci("NESSUNA_SELEZIONE")});c&&(this.getPrefNumFasc().setText(""),this.getSuffNumFasc().setText(""));if(b){var f=b.get("servizio").tipoServizio;b.get("dataAl")||this.getServizioDataAl().fireEvent("change");
this.impostaDatiRette(b.get("idRicovero"));this.impostaDatiAlunni(b,b.get("idServizio"));this.impostaParametriRegionali(b);this.getParametriSanitari(b);this.getForm().loadRecord(b);if("S"==this.numFascicoloAutomatico){var g=b.get("servizio")?b.get("servizio").sigla:"";this.impostaNumFascFormatted(b.get("fascicoloRifFormatted"),b.get("fascicoloRif"),g)}this.cbaConfig.wizard||this.getBoxBottoni().queryById("btnElimina").setVisible(!b.get("dataAl"));for(var g={oraInizio:b.get("dataDal"),oraFine:b.data.dataAl?
b.get("dataAl"):""},h=1;5>=h;h++){var k=this.getCntCampiPers().down("#CampoServ"+h),l=b.get("custom"+h);!l||Ext.isEmpty(k)||k.isHidden()||"datefield"!=k.xtype||(""==FormattaData(l)?g["custom"+h]=l:g["custom"+h]=FormattaData(l))}d.getForm().setValues(g);"undefined"!==typeof b.get("idServizio")&&(this.getMotivoDimissione().getStore().load({params:{idServizio:b.get("idServizio")},callback:function(c,f,g){g?d.getForm().setValues({motivoDimissione:b.get("motivoDimissione")}):msgShowError("",f.getError())}}),
loadStore(this.getIdTipoProvenienza().getStore(),{idServizio:b.get("idServizio")}),loadStore(this.getIdMotivoIngresso().getStore(),{idServizio:b.get("idServizio")}),loadStore(this.getIdIniziativaRichiesta().getStore(),{idServizio:b.get("idServizio")}),loadStore(this.getIdTipoRicovero().getStore(),{idServizio:b.get("idServizio")}),"L"!=f?(this.getOnereDegenza().setFieldLabel("M"==f?traduci("ONERE_EROG_PREST"):traduci("ONERE_DEGENZA")),loadStore(this.getOnereDegenza().getStore(),{idServizio:b.get("idServizio")}),
"G"==f&&(this.loadRegimeRicovero(b.get("idServizio")),this.loadClassePriorita(b.get("idServizio")))):this.loadOnereDegenzaLA());43==CBA.moduli.moduloAttivo&&(this.abilitaServizio(!this.cbaConfig.wizard),this.getRecordAccorpato().setValue(b.get("recordAccorpato")));this.visualizzaCampi(f);this.visualizzaRendLomb(b.get("servizio").regione,f,b.get("servizio").tipoFlusso)}else this.getMotivoDimissione().getStore().load({params:{idServizio:0}}),this.setParametriCont(),this.loadConto(),this.getServizioOraUscita().hide(),
this.getMotivoDimissione().hide(),this.visualizzaCampi(this.getDefaultTipoServ()),1!=this.getTipoServizio().getStore().count()||c||(this.getTipoServizio().setValue(this.getTipoServizio().getStore().getRange()[0].data.codice),this.getServizioOraIngresso().setValue(new Date),this.getServizioDataDal().setValue(new Date)),0!=this.getStoricoGridServizi().getStore().data.items.length||c||(this.getTabPanels().setActiveTab(this.defaultActiveTab),this.nuovo()),validaForm(d);this.abilitaDatiSanitari(b&&"G"===
b.get("servizio").tipoServizio);this.getMedicoMedGen().setReadOnly(b)},abilitaDatiSanitari:function(b){var c=this;setTimeout(function(){b?c.getGiorniPrognosi().setReadOnly(!1):(c.getGiorniPrognosi().setValue(""),c.getGiorniPrognosi().setReadOnly(!0));c.getDataDimissionePrevista().setReadOnly(!0);c.getDataDimissionePrevistaMedica().setReadOnly(!0)},200)},nuovo:function(){controller_nuovoRecord(this.getForm(),!1,!1);containerSolaLettura(this.getForm(),!1);controller_abilitaBottoni(this.getForm());this.abilitaServizio(!0);
this.abilitaDatiSanitari(!1);this.setParametriCont();this.getServizioOraIngresso().setValue(new Date);this.getServizioDataDal().setValue(new Date);"T"==this.numFascicoloAutomatico&&this.calcolaNumeroFascicoloAuto();48!=getModuloAttivo()&&64!=getModuloAttivo()&&this.getForm().getForm().setValues({annoCda:this.personContabili?this.personContabili.idEsercizio:null,annoConto:this.personContabili?this.personContabili.idEsercizio:null,descrizioneCodice:traduci("NESSUNA_SELEZIONE")});svuotaStore(this.getIdTipoProvenienza().getStore());
svuotaStore(this.getIdMotivoIngresso().getStore());svuotaStore(this.getIdIniziativaRichiesta().getStore());svuotaStore(this.getIdTipoRicovero().getStore());svuotaStore(this.getOnereDegenza().getStore());svuotaStore(this.getRegimeRicovero().getStore());svuotaStore(this.getClassePriorita().getStore());this.getMedicoMedGen().setReadOnly(!1)},verificaCampiForm:function(){var b=this.getForm().getForm(),c=b.findField("dataDal").getValue(),d=b.findField("dataAl").getValue(),f=[];b.isValid()||msgAddError(f,
"MSG_CAMPI_OBBLIGATORI");c.setHours(Ext.util.Format.date(this.getServizioOraIngresso().getValue(),"H"),Ext.util.Format.date(this.getServizioOraIngresso().getValue(),"i"));d&&d.setHours(Ext.util.Format.date(this.getServizioOraUscita().getValue(),"H"),Ext.util.Format.date(this.getServizioOraUscita().getValue(),"i"));c>d&&d&&msgAddError(f,"MSG_DATADAL_MAGGIORE_DATAAL");return msgShow(traduci("SERVIZI"),f)},leggiDatiForm:function(){var b=this.getForm().getForm().getFieldValues(),c=this.getServizioDataDal().getValue(),
d=null,f=this.getMotivoDimissione().getValue(),g=this.getNoteDimissione().getValue(),h,k,l=[],l=[];c.setHours(Ext.util.Format.date(this.getServizioOraIngresso().getValue(),"H"),Ext.util.Format.date(this.getServizioOraIngresso().getValue(),"i"));this.getServizioDataAl().getValue()&&(d=this.getServizioDataAl().getValue(),d.setHours(Ext.util.Format.date(this.getServizioOraUscita().getValue(),"H"),Ext.util.Format.date(this.getServizioOraUscita().getValue(),"i")));d||(g=f=null);if(43==CBA.moduli.moduloAttivo||
50==CBA.moduli.moduloAttivo)k={id:b.idParametriRette,idParametriContabilita:b.idParametriContabilita,codiceRid:b.codiceRid,annoCda:Ext.isEmpty(b.cda)?null:b.annoCda,cda:b.cda,cda1:b.cda1,conto:b.conto,annoConto:Ext.isEmpty(b.conto)?null:b.annoConto,capitolo:b.capitolo,articolo:b.articolo,forzaParamContabili:b.forzaParamContabili};h={id:b.idRicovero,idRicoveroCollegato:b.idRicoveroCollegato,postoSollievo:getBoolValue(b.postoSollievo),ggAssenzaMax:b.ggAssenzaMax,idTipoProvenienza:b.idTipoProvenienza,
motivoIngresso:b.motivoIngresso,notePresaInCarico:b.notePresaInCarico,iniziativaRichiesta:b.iniziativaRichiesta,tipoRicovero:b.tipoRicovero,dataRichiestaRicovero:Ext.isEmpty(b.dataRichiestaRicovero)?null:b.dataRichiestaRicovero.getTime(),dataRicezioneRichiesta:Ext.isEmpty(b.dataRicezioneRichiesta)?null:b.dataRicezioneRichiesta.getTime(),onereDegenza:b.onereDegenza,sosiaSituazionePens:b.sosiaSituazionePens,sosiaProfessione:b.sosiaProfessione,dataEventoIndice:Ext.isEmpty(b.dataEventoIndice)?null:b.dataEventoIndice.getTime(),
regimeRicovero:b.regimeRicovero,medicoInviante:b.medicoInviante,classePrioritaria:b.classePrioritaria};l.push({tipo:1,dati:h});50==CBA.moduli.moduloAttivo&&(h={orarioAnticipato:getBoolValue(b.orarioAnticipato),orarioProlungato:getBoolValue(b.orarioProlungato),trasporto:getBoolValue(b.trasporto),vaccinazioni:getBoolValue(b.vaccinazioni)},l.push({tipo:2,dati:h}));if("G"===this.getTipoServizio().getSelectedRecord().get("tipoServizio")){h={ggPrognosi:b.ggPrognosi,idGGPrognosi:b.idGGPrognosi,dataDimissionePrevista:b.dataDimissionePrevista,
dataDimissionePrevistaMedica:b.dataDimissionePrevistaMedica,diagnosiIngresso:b.diagnosiIngresso,diagnosiIngressoICD9:b.diagnosiIngressoICD9};var n=[];this.getTabProroghe().down("#Grid").getStore().each(function(b){n.push(b.getData())});0<n.length&&Ext.apply(h,{proroghe:n});l.push({tipo:4,dati:h})}if(!Ext.isEmpty(b.idRicovero)&&"undefined"!=typeof currRicovero&&null!=currRicovero.servizio&&((43==getModuloAttivo()||49==getModuloAttivo())&&!Ext.isEmpty(currRicovero.servizio.tipoFlusso)||55==getModuloAttivo()&&
!Ext.isEmpty(currRicovero.servizio.codiceStruttura))){h=this.getStoricoGridServizi().getSelectionModel().getSelected().items[0].get("dataAl");var p=this.getStoricoGridServizi().getSelectionModel().getSelected().items[0].get("motivoDimissione");if(d!=h||f!=p){var q=currRicovero.servizio.tipoFlusso;h=null;p=[];if([13,14,15].includes(q)){var r=this.getDatiPraticaSdo(b.idRicovero);if(r){"T"==r.isConvalidata&&msgAddWarning(p,traduci("FR_MSG_WARNING_MODIFICA_CONVALIDATA"));var t="";switch(q){case 13:t=
"SDO";break;case 14:t="SDOFIM";break;case 15:t="SDERIA";break;default:tipoServ=""}var q=FormattaData(d),u=r.al?FormattaData(r.al):null;u&&q!=u&&(h=(h?h:"")+"<li>"+traduci("RAP_DATA_CHIUSURA_PRATICA")+" "+t+":<BR>"+u+"</li>");r.motChiusura&&f!=r.motChiusura&&(h=(h?h:"")+"<li>"+traduci("FR_MOTIVO_CHIUSURA_PRATICA")+" "+t+":<BR>"+r.desMotChiusura+"</li>");h&&(h=traduci("FR_MSG_WARNING_CHIUSURA_PRATICA")+"<br>"+r.annoNumPratica+"<ul>"+h+"</ul>",msgAddWarning(p,h))}}h||(msgText=traduci("FR_WARN_CHIUSURA_PRATICA"),
msgAddWarning(p,Ext.isEmpty(f)?msgText.substr(0,msgText.indexOf(".")):msgText));p.length&&msgShow("",p)}}Ext.apply(b,{codOspite:this.cbaConfig.codOspite,dataDal:c,dataAl:d,motivoDimissione:f,descrDimissione:g,fascicoloRif:b.fascicoloRif?b.fascicoloRif:null,altreInfo:l,ultimoAnno:getBoolValue(b.ultimoAnno),consensoTrattamentoDati:getBoolValue(b.consensoTrattamentoDati),recordAccorpato:b.recordAccorpato});delete b.oraInizio;delete b.oraFine;delete b.tipoContabilita;delete b.anno;delete b.orarioAnticipato;
delete b.orarioProlungato;delete b.trasporto;delete b.vaccinazioni;delete b.idRicoveroCollegato;delete b.postoSollievo;delete b.ggAssenzaMax;delete b.idTipoProvenienza;delete b.motivoIngresso;delete b.notePresaInCarico;delete b.responsabileRicovero;delete b.iniziativaRichiesta;delete b.tipoRicovero;delete b.dataRichiestaRicovero;delete b.dataRicezioneRichiesta;delete b.onereDegenza;delete b.regimeRicovero;delete b.medicoInviante;delete b.classePrioritaria;delete b.sosiaSituazionePens;delete b.sosiaProfessione;
delete b.dataEventoIndice;delete b.ggPrognosi;delete b.dataDimissionePrevista;delete b.dataDimissionePrevistaMedica;delete b.idGGPrognosi;delete b.diagnosiIngresso;delete b.diagnosiIngressoICD9;delete b.idParametriRette;delete b.idParametriContabilita;delete b.codiceRid;delete b.annoCda;delete b.cda;delete b.cda1;delete b.conto;delete b.annoConto;delete b.capitolo;delete b.articolo;delete b.idEsercizio;delete b.descrizioneCodice;delete b.fascicoloRifFormatted;delete b.forzaParamContabili;delete b.desAnnoCda;
return l=[b,k]},getDatiPraticaSdo:function(b){var c=null;Ext.Ajax.request({method:"GET",async:!1,url:getUrlGen()+"/ws/genOsp/fr/pratiche/search",params:{idRicovero:b,conValutazioni:"T"},success:function(b){b=Ext.JSON.decode(b.responseText);b.success&&!Ext.isEmpty(b.data)&&(b=b.data[0],c={al:b.al,motChiusura:b.motChiusura,desMotChiusura:b.desMotChiusura,annoNumPratica:b.annoNumPratica,isConvalidata:b.isConvalidata})}});return c},getParametriSanitari:function(b){var c=this;this.getTabProroghe().down("#Grid").getStore().loadData([]);
var d=this.getDiagnosiIngresso();d.getToolbar().hide();d.setStyle("opacity",.7);"G"==b.get("servizio").tipoServizio&&(d={idRicovero:b.get("idRicovero")},b.get("idRicoveroCSS")&&Ext.apply(d,{idRicoveroCSS:b.get("idRicoveroCSS")}),StdUtenti.promiseGetRequest(getUrlGen()+"/ws/genOsp/parametriSanitari/get",parametri=d).then(function(b){c.getForm().getForm().setValues({ggPrognosi:b?b.ggPrognosi:null,idGGPrognosi:b?b.idGGPrognosi:null,dataDimissionePrevista:b.dataDimissionePrevista,dataDimissionePrevistaMedica:b.dataDimissionePrevistaMedica,
diagnosiIngresso:b?b.diagnosiIngresso:null,diagnosiIngressoICD9:b?b.diagnosiIngressoICD9:null});c.getTabProroghe().down("#Grid").getStore().loadData(b&&b.proroghe?b.proroghe:[])})["catch"](function(b){return msgShowError("",b)}))},creaWinSceltaRicoveroCss:function(b){this.storeRicoveriCss.loadData(b);Ext.create("winCBA",{permesso:"S",larghezzaWin:400,altezzaWin:200,name:"GeneraliOSP.fascicoloNoApp.view.WinSincroRicoveroCollegato",titolo:"Selezionare Ricovero di CSS2",maximizable:!1,configItem:{store:this.storeRicoveriCss,
htmlText:"Selezionare il ricovero aperto in CSS2 per l'ospite <i></i> che si desidera chiudere",tipo:2}}).show()},generaMessaggioUpdate:function(b){var c=!1;1<b.length&&(c=!0,msgShowWarning("ATTENZIONE",b));c||msgShow("MSG_SALVATAGGIO_DATI",b)},salva:function(b,c,d){var f=this,g=f.getEditServiziRecordId().getValue(),h=f.leggiDatiForm(),k=h[0],l=h[1],n=[],p=!0,q=f.getForm().up("window"),r=null===g||0>=g?"new":"update",h={};Ext.isEmpty(d)||(Ext.apply(h,{idRegola:d}),Ext.isEmpty(c)||Ext.apply(h,{idEsterno:c}));
if(null==k)return!1;Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/ricoveri/"+r,method:"POST",jsonData:k,async:!1,params:h,success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){if(null===g||0>=g)g=c.data.idRicovero,f.cbaConfig.currentAss=g,"undefined"!==typeof currOspite&&currOspite&&(currOspite.ricovero=c.data);if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo){var d=f.salvaDatiRette(g,l);0<d.length&&(n=n.concat(d),p=!1)}p&&("update"==r?(d=c.data.ricoveriCSS,Ext.isEmpty(d)?
f.generaMessaggioUpdate(c.message):f.creaWinSceltaRicoveroCss(d)):msgAdd(n,c.message),b&&f.cbaConfig.controllerEditFascicolo?(f.cbaConfig.controllerEditFascicolo.refreshDatiVideataFascicolo(),q.close()):(f.aggiornaStore(g,c),49==getModuloAttivo()&&f.cbaConfig.controllerEditFascicolo.cbaConfig.controllerTipologieCartella.aggiornaStore()))}else msgAdd(n,c.message),p=!1}});p?(msgShow("MSG_SALVATAGGIO_DATI",n),f.cbaConfig.wizard&&49!=getModuloAttivo()&&(""==f.cbaConfig.controllerEditFascicolo.navDirection&&
(f.cbaConfig.controllerEditFascicolo.navDirection="next"),f.cbaConfig.controllerEditFascicolo.navigaWizard(f.cbaConfig.controllerEditFascicolo.navDirection,!0))):(controller_abilitaBottoni(f.getForm()),msgShowError("MSG_SALVATAGGIO_DATI",n));return p},getStoricoGrid:function(){return this.getStoricoGridServizi()},abilitaServizio:function(b){this.getTipoServizio().setReadOnly(!b);this.getServizioDataDal().setReadOnly(!b);this.getServizioOraIngresso().setReadOnly(!b)},aggiornaStore:function(b,c){var d=
this,f=d.getStoricoGridServizi().getStore(),g=d.getForm(),h="";48==getModuloAttivo()&&(h="L");f.load({params:{codospite:null!=d.cbaConfig.codOspite?d.cbaConfig.codOspite:-9999,tipoServizio:h},callback:function(h,l,n){if(n)if(Ext.isEmpty(h))d.impostaDati(null,c);else if(d.cbaConfig.controllerEditFascicolo&&d.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&4==d.cbaConfig.controllerEditFascicolo.getTabPanel().items.items.length){d.getCbResidenza().clearValue();d.getResponsabileRicovero().setVisible(!0);
currRicovero=h[0].data;d.cbaConfig.controllerEditFascicolo.currRicovero=h[0].data;d.abilitaServizio(!1);if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo)h=g.getForm().getFieldValues(),h=d.salvaDatiRette(currRicovero.idRicovero,{id:h.idParametriRette,idParametriContabilita:h.idParametriContabilita,codiceRid:h.codiceRid,annoCda:h.annoCda,cda:h.cda,cda1:h.cda1,conto:h.conto,annoConto:h.annoConto,capitolo:h.capitolo,articolo:h.articolo,forzaParamContabili:h.forzaParamContabili}),0<h.length&&
msgShowError("MSG_SALVATAGGIO_DATI",h);h=null;d.getCbResidenza().isDisabled()?(d.getCbResidenza().setDisabled(!1),h=currRicovero.codOspite):h=Ext.isDefined(currRicovero)?currRicovero.codOspite:-9999;d.getCbResidenza().getStore().load({params:{codOspite:h,tipoIndirizzo:"R"}});d.cbaConfig.controllerEditFascicolo.navOK=!0;d.cbaConfig.showTabAggiuntivi&&Ext.isDefined(d.cbaConfig.controllerEditFascicolo)&&d.cbaConfig.controllerEditFascicolo.loadTabSecondari();""==d.cbaConfig.controllerEditFascicolo.navDirection&&
(d.cbaConfig.controllerEditFascicolo.navDirection="next");d.cbaConfig.controllerEditFascicolo.navigaWizard(d.cbaConfig.controllerEditFascicolo.navDirection,!0)}else l=trovaRecord(f,"idRicovero",b),n=d.getStoricoGridServizi(),n.getSelectionModel().deselectAll(),n.getSelectionModel().select(l?[l]:0),Ext.isDefined(d.cbaConfig.tabIndex)&&d.getTabPanels().setActiveTab(d.cbaConfig.tabIndex),d.cbaConfig.controllerEditFascicolo&&d.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite&&(d.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.ricovero=
h[0].data,d.cbaConfig.controllerEditFascicolo.cbaConfig.reload=!0),"undefined"!==typeof currOspite&&currOspite&&(currOspite.ricoveriAttivi=[],Ext.each(h,function(b){Ext.isEmpty(b.get("dataAl"))&&currOspite.ricoveriAttivi.push(b)}));else d.impostaDati(),msgShowError("",l.getError())}})},setParametriCont:function(){if(43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo&&55!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo)return!1;var b=this,c=b.getServizioDataAl(),c=isValidDate(c)?c.getValue():
new Date;b.personContabili=getPersonContabili(getIdOrg(),c,!0,null);if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo||55==CBA.moduli.moduloAttivo)1==b.personContabili.tipoContabilitaAbilitata&&b.getCBCapitolo().getStore().load({params:{anno:(new Date).getFullYear()},callback:function(){b.filtraComboCapitolo()}}),b.getCBConto().setVisible(1!=b.personContabili.tipoContabilitaAbilitata),b.getBtnPriorita().setVisible(1!=b.personContabili.tipoContabilitaAbilitata),b.getCBCapitolo().setVisible(1==
b.personContabili.tipoContabilitaAbilitata),b.getCBArticolo().setVisible(1==b.personContabili.tipoContabilitaAbilitata),b.getForm().getForm().setValues({tipoContabilita:b.personContabili.tipoContabilitaAbilitata,idEsercizio:b.personContabili.idEsercizio})},loadConto:function(b){if(43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo&&55!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo)return!1;var c=this,d={};if(4==c.personContabili.tipoContabilitaAbilitata||5==c.personContabili.tipoContabilitaAbilitata){var f=
c.getForm().getForm().findField("annoConto").getValue()?c.getForm().getForm().findField("annoConto").getValue():c.personContabili.idEsercizio;c.getCBConto().getStore().getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox";Ext.apply(d,{idOrganizzazione:getIdOrg(),idEsercizio:f})}else c.getCBConto().getStore().getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(d,{anno:(new Date).getFullYear()});c.getCBConto().getStore().load({params:d,callback:function(){Ext.isEmpty(b)||c.getForm().getForm().setValues({conto:b})}})},
impostaDatiRette:function(b){var c=this;43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo||!b||0===b||Ext.Ajax.request({url:"/cba/osp/co/ws/AnagraficaOspiti/retteparam/get",method:"GET",params:{idRicovero:b},success:function(b){b=Ext.JSON.decode(b.responseText);c.personContabili||c.setParametriCont();b.success?(c.getForm().getForm().setValues({annoCda:b.data.annoCda?b.data.annoCda:c.personContabili.idEsercizio,desAnnoCda:b.data.desAnnoCda,cda:b.data.cda,descrizioneCodice:b.data.cda?b.data.cda:
traduci("NESSUNA_SELEZIONE"),cda1:b.data.cda1,annoConto:b.data.annoConto?b.data.annoConto:c.personContabili.idEsercizio,capitolo:b.data.capitolo,articolo:b.data.articolo,idParametriRette:b.data.id,idParametriContabilita:b.data.idParametriContabilita,codiceRid:b.data.codiceRid,forzaParamContabili:b.data.forzaParamContabili}),c.loadConto(b.data.conto&&0!=b.data.conto?b.data.conto:null)):msgShowError("",b.message)}})},impostaDatiAlunni:function(b,c){if(50==CBA.moduli.moduloAttivo){var d=b.get("idRicovero");
if(d&&0!==d){var f=this,g=f.getIdCicloScolastico(),h=g.getStore();h.getProxy().extraParams.idServizio=c;h.load();null!=b.get("idCicloScolastico")&&g.setValue(b.get("idCicloScolastico"));Ext.Ajax.request({url:"/cba/osp/co/ws/AnagraficaOspiti/parametriAlunni/get",method:"GET",params:{idRicovero:d},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?Ext.isEmpty(b.data)||f.getForm().getForm().setValues({orarioAnticipato:b.data.orarioAnticipato,orarioProlungato:b.data.orarioProlungato,trasporto:b.data.trasporto,
vaccinazioni:b.data.vaccinazioni}):msgShowError("",b.message)}})}}},salvaDatiRette:function(b,c){var d=this,f=[],g="/cba/osp/co/ws/AnagraficaOspiti/retteparam/",g=""==c.id||0===c.id?g+"insert":g+"update";Ext.apply(c,{idRicovero:b});Ext.Ajax.request({url:g,method:"POST",jsonData:c,async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?d.getForm().getForm().setValues({idParametriRette:b.data.id,idParametriContabilita:b.data.idParametriContabilita}):msgAdd(f,b.message)}});return f},
visualizzaRendLomb:function(b,c,d){var f=this,g=!Ext.isEmpty(d)&&7==d;if("L"!=b)return!1;f.getRendLomb().setVisible(!0);f.getDatiSosia1().setVisible("R"==c);f.getCbRicoveroColl().setVisible("R"==c);f.getCbSollievo().setVisible("R"==c);f.getFsSosiaLomb().setVisible("R"==c);setTimeout(function(){f.getCbRicoveroColl().setReadOnly(g);f.getCbSollievo().setReadOnly(g)},200)},impostaDatiSosia:function(b,c){var d=this;return"L"!=b||"R"!=c?Promise.resolve(!0):this.caricaStore(this.storeCodifiche,{tipoFlusso:7}).then(function(){var b=
d.getCbSituazionePensionistica();b.bindStore(Ext.create("Ext.data.ChainedStore",{source:d.storeCodifiche}));b.getStore().filter({filterFn:function(b){return"SO2"==b.data.extra?!0:!1}});b=d.getCbProfessioneIngresso();b.bindStore(Ext.create("Ext.data.ChainedStore",{source:d.storeCodifiche}));b.getStore().filter({filterFn:function(b){return"SO1"==b.data.extra?!0:!1}});Promise.resolve(!0)})},impostaParametriRegionali:function(b){var c=b.get("codOspite"),d=b.get("idRicovero"),f=b.get("dataDal");b=b.get("servizio");
if([43,48,50,55,64,49].includes(CBA.moduli.moduloAttivo)&&d&&0!==d){var g=this;g.impostaDatiSosia(b.regione,b.tipoServizio).then(function(){Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/parametriRegionali/get",method:"GET",params:{idRicovero:d},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(g.setValueParamReg(b.data),setCombo(g.getCbRicoveroColl(),b.data.idRicoveroCollegato,null,{codOspite:c,idRicovero:d,dataDal:f}),g.getResponsabileRicoveroTxt().setReadOnly(!0),currRicovero&&currRicovero.praticaSDOConvalidata&&
containerSolaLettura(g.getPresaInCaricoDati(),!0)):msgShowError("",b.message)}})})["catch"](function(b){return msgShowError("",b)})}},setValueParamReg:function(b){delete b.id;delete b.dataValutazioneRichiesta;delete b.richiestaSoddisfaRequisiti;Ext.apply(b,{dataRichiestaRicovero:Ext.Date.parse(b.dataRichiestaRicovero,"Y-m-d H:i:s"),dataRicezioneRichiesta:Ext.Date.parse(b.dataRicezioneRichiesta,"Y-m-d H:i:s"),dataEventoIndice:Ext.Date.parse(b.dataEventoIndice,"Y-m-d H:i:s")});this.getForm().getForm().setValues(b)},
changeTab:function(){var b=this,c=b.getForm().up("window");controller_puoiUscire(c,b.getForm(),function(){b.salva(!1)},function(){b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){b.aggiornaStore()})},afterTabChange:function(){0==this.getStoricoGridServizi().getStore().getCount()&&null==this.getTipoServizio().getValue()?this.nuovo():this.getCbResidenza().getStore().load({params:{codOspite:null!=this.cbaConfig.codOspite?
this.cbaConfig.codOspite:-9999,tipoIndirizzo:"R"}})},refreshDatiVideataFascicolo:function(){var b={},c=this.cbaConfig.ricerca;Ext.apply(b,{codospite:"undefined"===typeof this.cbaConfig.controllerEditFascicolo?this.cbaConfig.codOspite:this.cbaConfig.controllerEditFascicolo.currentDip});c.controller.cerca(b)},filtraComboCapitolo:function(){var b=this.getForm().getForm();b.findField("capitolo").getStore().clearFilter();b.findField("capitolo").getStore().filter({filterFn:function(b){return"E"==b.data.extra?
!0:!1}})},filtraComboArticolo:function(){var b=this.getForm().getForm();b.findField("articolo").getStore().clearFilter();b.findField("articolo").getStore().filter({filterFn:function(b){return b.data.codice&&"E"==b.data.extra?!0:!1}})},getPersonNumFascicoloAuto:function(){var b=this;Ext.isDefined(b.numFascicoloAutomatico)||Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/persgen/getbyorg",params:{idOrg:getIdOrg()},success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){var d=
"F",f="";!c.data||"T"!=c.data.numFascicoloAutomatico&&"S"!=c.data.numFascicoloAutomatico||(d=c.data.numFascicoloAutomatico,f=c.data.numFascicoloFormato);b.numFascicoloAutomatico=d;b.numFascicoloFormato=f;c=b.cbaConfig.controllerFascicolo?b.cbaConfig.controllerFascicolo.idRicovero:b.cbaConfig.idRicovero;(b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||null==c&&49!=CBA.moduli.moduloAttivo)&&b.calcolaNumeroFascicoloAuto()}else msgShowError("",c.message)}})},
beforeSalva:function(b){var c=this,d=c.getEditServiziRecordId().getValue();if((null===d||0>=d)&&!Ext.isEmpty(c.storeElencoRegole.getData().items))if(1<c.storeElencoRegole.getData().items.length&&"N"!=c.storeElencoRegole.getData().items[0].data.operazioneNuovo)Ext.create("winCBA",{permesso:"S",larghezzaWin:380,altezzaWin:200,name:"GeneraliOSP.fascicoloNoApp.view.WinRaccordoServCuCss",titolo:"Selezionare Tipologia Cartella",maximizable:!1,closable:!0,configItem:{store:c.storeElencoRegole,onSave:function(b,
d,f){c.salva(b,d,f)},testoHtml:"Selezionare la tipologia cartella per il ricovero appena creato",esci:b,lbl:"Tipologia Cartella"}}).show();else{var d=c.storeElencoRegole.getData().items[0].data.idPadre?c.storeElencoRegole.getData().items[0].data.idPadre:c.storeElencoRegole.getData().items[0].data.id,f=c.storeElencoRegole.getData().items[0].data.idEsterno;c.salva(b,f,d)}else c.salva(b)},clickBtnConfermaServizio:function(b){var c=b.up("panel").down("combobox");c&&(c=c.getSelectedRecord().getData(),
c.idEsterno&&c.id&&this.salva(!1,c.idEsterno,c.idPadre),b.up("window").close())},caricaStore:function(b,c){c=void 0===c?{}:c;return new Promise(function(d,f){b.load({params:c,callback:function(b,c,k){k?d(b):f(c)}})})},clickBtnMedico:function(){var b=this.cbaConfig.controllerEditFascicolo;Ext.create("winCBA",{name:"GeneraliOSP.medicoCurante.view.MedicoCurante",titolo:"GESTIONE_MEDICI",larghezzaWin:900,altezzaWin:350,configItem:{urlGen:!0,codOspite:this.cbaConfig.controllerFascicolo?this.cbaConfig.controllerFascicolo.currentDip:
currOspite.codOspite,permesso:49===CBA.moduli.moduloAttivo?this.cbaConfig.permesso:b?b.cbaConfig.permesso:this.cbaConfig.permesso}}).show()},onLaunch:function(){var b=this;b.getContainer().controller=b;b.getStoricoGridServizi().controller=b;b.getTabProroghe().add(Ext.create("GeneraliOSP.fascicoloNoApp.view.ProrogheGrid",{controllerServizi:b,width:"100%",flex:1,margin:"10 0 0 0"}));b.getPersonNumFascicoloAuto(b);b.storeMedici=Ext.create("GeneraliOSP.medicoCurante.store.Medici");b.getMedicoInviante().bindStore(Ext.create("Ext.data.ChainedStore",
{source:b.storeMedici}));b.getMedicoMedGen().bindStore(Ext.create("Ext.data.ChainedStore",{source:b.storeMedici}));ImpostaUrl([b.storeMedici,b.getTipoServizio().getStore(),b.getCbResidenza().getStore(),b.getMotivoDimissione().getStore(),b.getStoricoGridServizi().getStore(),b.getIdTipoProvenienza().getStore(),b.getIdMotivoIngresso().getStore(),b.getIdIniziativaRichiesta().getStore(),b.getIdTipoRicovero().getStore(),b.getOnereDegenza().getStore(),b.getRegimeRicovero().getStore(),b.getClassePriorita().getStore()]);
b.storeMedici.load({params:{idOrg:getIdOrg()},callback:function(b,c,d){}});Ext.Ajax.request({method:"GET",async:!1,url:getUrlGen()+"/ws/genOsp/personCampiAnag/src",success:function(c){c=Ext.JSON.decode(c.responseText);c.success?(Ext.suspendLayouts(),b.creaCampiPers(c.data),Ext.resumeLayouts()):msgShowError("",c.message)}});b.storeRicoveriCss=Ext.create("Ext.data.Store",{fields:[{name:"idRicovero"},{name:"dal"},{name:"descrizineFormatted",convert:function(b,c){return c.get("desServizio")+" - Dal: "+
FormattaData(c.get("dal"))}}]});b.getStoricoGridServizi().getStore().getProxy().extraParams.aggiornaListaUtenti=!1;var c=b.getForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=b.getStoricoGridServizi().getStore();c.controller=b;b.storeElencoRegole=Ext.create("Ext.data.Store");var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.beforeSalva(c);b.cbaConfig.tabIndex=b.getTabPanels().items.indexOf(b.getTabPanels().getActiveTab());
b.cbaConfig.showTabAggiuntivi&&Ext.isDefined(b.cbaConfig.controllerEditFascicolo)&&b.cbaConfig.controllerEditFascicolo.loadTabSecondari();b.getTabPanels().setActiveTab(b.cbaConfig.tabIndex)},annulla_callback:function(){b.impostaDati(b.getStoricoGrid().getSelectionModel().getSelection()[0],!0)},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var d=c.getForm().findField("idRicovero").getValue();if(!Ext.isEmpty(d)){var g={msg:traduci("MSG_ELIMINARE_SERVIZIO"),type:"strongStr"};controller_eliminaRecord(c.store,
{idRicovero:d},function(){b.aggiornaStore(null,!0)},null,g,"ATTENZIONE")}},esci_callback:function(){var c=b.getForm().up("window");controller_puoiUscire(c,b.getForm(),function(){b.salva(!0);b.cbaConfig.wizard||b.refreshDatiVideataFascicolo()},function(){b.cbaConfig.wizard||b.refreshDatiVideataFascicolo();c.close()},function(){b.cbaConfig.wizard||b.refreshDatiVideataFascicolo();c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),d);
b.getForm().boxBottoni=b.getBoxBottoni();Ext.apply(b.getCntCda().cbaConfig,{tipoContabilita:null});if(43==CBA.moduli.moduloAttivo||49==CBA.moduli.moduloAttivo)b.getCbRicoveroColl().bindStore(Ext.create("GeneraliOSP.store.ricoveriCollegabili")),b.storeCodifiche=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/fr/codifiche/cbox"}});50==CBA.moduli.moduloAttivo&&(b.getIdCicloScolastico().bindStore(Ext.create("CU.store.CicloScolastico")),ImpostaUrl([b.getIdCicloScolastico().getStore()]),
d=b.getIdCicloScolastico().getStore(),d.getProxy().extraParams={scheda:"L",domanda:7},d.load());b.getTipoServizio().getStore().load({params:{type:getTipiServizio()},callback:function(c,d,h){50==CBA.moduli.moduloAttivo&&(ImpostaUrl([b.getIdCicloScolastico().getStore()]),d=b.getIdCicloScolastico().getStore(),null!=b.getTipoServizio().getValue()&&(d.getProxy().extraParams.idServizio=b.getTipoServizio().getValue(),d.load()));1==c.length&&b.getTipoServizio().setValue(c[0].get("codice"))}});b.defaultActiveTab=
0;b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?(c.boxBottoni.queryById("btnNuovo").setVisible(!1),c.boxBottoni.queryById("btnElimina").setVisible(!1),c.boxBottoni.queryById("btnConferma").setVisible(!1),c.boxBottoni.queryById("btnAnnulla").setVisible(!1),b.getCbResidenza().setDisabled(!0),b.getResponsabileRicovero().setVisible(!1),b.impostaDati()):(b.cbaConfig.codOspite||(b.cbaConfig.codOspite=b.cbaConfig.controllerFascicolo?b.cbaConfig.controllerFascicolo.currentDip:
b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite),b.getCbResidenza().getStore().load({params:{codOspite:b.cbaConfig.codOspite,tipoIndirizzo:"R"}}),b.aggiornaStore(b.cbaConfig.idRicovero));b.cbaConfig.controllerEditFascicolo&&c.boxBottoni.queryById("btnEsci").setVisible(!1);b.getServizioOraUscita().hide();b.getMotivoDimissione().hide();43!=getModuloAttivo()&&50!=getModuloAttivo()&&(b.getTabDatiCont().tab.setVisible(!1),b.getParametriRette().setVisible(!1));48==getModuloAttivo()&&
(b.getTabNote().tab.hide(),b.getTabAltreInfo().tab.hide());if("L"!=b.cbaConfig.permesso)b.getForm().getForm().on("dirtychange",function(c,d){controller_abilitaBottoni(b.getForm());b.getServizioNumeroFascicolo().setWidth(80);b.getStoricoGridServizi().setDisabled(d);b.cbaConfig.controllerEditFascicolo&&!b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(d),b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(d))});"L"!=
b.cbaConfig.permesso&&permettiModificheDopoDimissione()||(containerSolaLettura(c),controller_bottoniSolaLettura(b.getBoxBottoni()),b.getForm().boxBottoni.queryById("btnNuovo").setDisabled("L"==b.cbaConfig.permesso))},destroy:function(){eliminaStore(this.storeCodifiche);eliminaStore(this.storeMedici);this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditServiziCSS",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"tipoServizio",selector:c+"#tipoServizio"},{ref:"servizioDataAl",selector:c+"#servizioDataAl"},{ref:"StoricoGridServizi",selector:c+"#StoricoGridServizi"},{ref:"Form",selector:c+"#Form"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"servizioOraUscita",selector:c+
"#servizioOraUscita"},{ref:"servizioOraIngresso",selector:c+"#servizioOraIngresso"},{ref:"ServizioDataDal",selector:c+"#ServizioDataDal"},{ref:"EditServiziRecordId",selector:c+"#EditServiziRecordId"},{ref:"CntFine",selector:c+"#CntFine"},{ref:"editResSede",selector:c+"#editResSede"},{ref:"editResReparto",selector:c+"#editResReparto"},{ref:"editResStanza",selector:c+"#editResStanza"},{ref:"editResLetti",selector:c+"#editResLetti"},{ref:"rispostaAggRicoveri",selector:c+"#rispostaAggRicoveri"},{ref:"GridAdt",
selector:c+"#GridAdt"},{ref:"ContainerAdt",selector:c+"#ContainerAdt"}]);b.control(c+"#editResSede",{});b.control(c+"#editResReparto",{select:b.onEditResRepartoSelect,expand:b.applicaFiltroDisattivi,collapse:b.onCollapseCombo});b.control(c+"#editResStanza",{select:b.onEditResStanzaSelect,expand:b.applicaFiltroDisattivi,collapse:b.onCollapseCombo});b.control(c+"#tipoServizio",{change:b.onTipoServChange,collapse:b.collapseTipo});b.control(c+"#rispostaAggRicoveri",{});b.control(c+"#servizioDataAl",{change:b.onServizioDataAlChange});
b.control(c+"#StoricoGridServizi",{select:b.onStoricoGridSelect});b.on({esci:function(){b.getForm().boxBottoni.queryById("btnEsci").handler()}});b.on({changeTab:function(){return b.changeTab()}})},onEditResStanzaSelect:function(b,c,d){SvuotaCombo(this.getEditResLetti());0<b.value&&(this.getEditResLetti().getStore().getProxy().extraParams={sede:this.getEditResSede().getStore().data.items[0].data.codice,reparto:this.getEditResReparto().getValue(),stanza:b.value},this.getEditResLetti().getStore().load())},
onTipoServChange:function(b,c,d,f){var g=this;g.cbaConfig.controllerEditFascicolo&&g.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&c&&Ext.Ajax.request({method:"GET",url:"css/cs/ws/genOsp/residenza/getCsProfiliReparti",params:{tipo:c},success:function(b){if(""!=b.responseText){var c=Ext.JSON.decode(b.responseText);c?(g.getEditResReparto().setValue(c),g.onEditResRepartoSelect({value:b.responseText})):(Messaggio("MSG_ERRORE_SERVER_GENERICO",b.responseText,"OK","ERROR"),SalvataggioOK=!1)}}})},applicaFiltroDisattivi:function(b){},
onEditResRepartoSelect:function(b,c,d){SvuotaCombo(this.getEditResStanza());SvuotaCombo(this.getEditResLetti());0<b.value&&(this.getEditResStanza().getStore().getProxy().extraParams={reparto:b.value},this.getEditResStanza().getStore().load())},onEditResSedeSelect:function(b,c,d){SvuotaCombo(this.getEditResReparto());SvuotaCombo(this.getEditResStanza());SvuotaCombo(this.getEditResLetti());0<b.value&&(this.getEditResReparto().getStore().getProxy().extraParams={sede:this.getEditResSede().getStore().data.items[0].data.codice},
this.getEditResReparto().getStore().load())},onCollapseCombo:function(b){b.getStore().clearFilter()},collapseTipo:function(b,c){b.store.clearFilter()},onStoricoGridSelect:function(b,c,d,f){this.impostaDati(c);this.cbaConfig.lettoSel&&this.getForm().getForm().setValues({idReparto:this.cbaConfig.repartoSel,idStanza:this.cbaConfig.stanzaSel,idLetto:this.cbaConfig.lettoSel});this.visualizzaAdt(c.id)},onServizioDataAlChange:function(b,c,d,f){d=!0;c&&(d=isValidDate(b));(b=this.getTipoServizio().getValue())&&
(b=trovaRecord(this.getTipoServizio().getStore(),"codice",b))&&b.get("extra");!0===d&&(c?this.getServizioOraUscita().show():(this.getServizioOraUscita().hide(),this.getServizioOraUscita().setValue("")))},onCapitoloChange:function(b,c){if(c){var d=new Date;Ext.getCmp("CBArticolo").getStore().load({params:{anno:d.getFullYear(),codCapitolo:c}})}},impostaDati:function(b){var c=this.getForm();this.getStoricoGridServizi().setDisabled(!1);clearForm(c);b?(this.getForm().loadRecord(b),this.cbaConfig.wizard||
this.getBoxBottoni().queryById("btnElimina").setVisible(!b.data.al),b.data.al||this.getServizioDataAl().fireEvent("change"),c.getForm().setValues({oraInizio:b.data.dal}),b.data.al?(c.getForm().setValues({oraFine:b.data.al}),c.boxBottoni.queryById("btnElimina").setDisabled(!0)):(c.getForm().setValues({oraFine:""}),c.boxBottoni.queryById("btnElimina").setDisabled(!1))):(this.getServizioDataAl().hide(),validaForm(c))},caricaCboxSede:function(){var b=this,c=this.getEditResSede().getStore();c.load({params:{codospite:this.cbaConfig.codOspite},
callback:function(d,f,g){g&&!Ext.isEmpty(d)&&(b.singolaSede=!0,b.singolaSede&&b.getForm().getForm().setValues({idSede:c.data.items[0].get("codice")}))}})},nuovo:function(){var b=this;clearForm(this.getForm());b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||(b.getRispostaAggRicoveri().setVisible(!0),b.getRispostaAggRicoveri().allowBlank=!1,b.getEditResSede().allowBlank=!1,b.getEditResReparto().setVisible(!0),b.getEditResReparto().allowBlank=!1,b.getEditResStanza().setVisible(!0),b.getEditResStanza().allowBlank=
!1,b.getEditResLetti().setVisible(!0),b.getEditResLetti().allowBlank=!1,b.getEditResSede().getStore().load(),b.getEditResReparto().getStore().load({params:{controlloSediOrg:!0}}));controller_nuovoRecord(b.getForm());this.abilitaServizio(!0);b.getTipoServizio().setReadOnly(!1);b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovoBtn=!0;getServerTime().then(function(c){b.getServizioOraIngresso().setValue(new Date(c));b.getServizioDataDal().setValue(new Date(c))});this.singolaSede&&this.getEditResSede().setValue(b.getEditResSede().getStore().data.items[0].get("codice"))},
verificaCampiForm:function(){var b=[],c=this.getForm().getForm();this.getEditResSede().setValue(this.getEditResSede().getStore().data.items[0]);c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");c.findField("dal").getValue()>c.findField("al").getValue()&&c.findField("al").getValue()&&msgAddError(b,"MSG_DATADAL_MAGGIORE_DATAAL");return msgShow(traduci("SERVIZI"),b)},salvaLetto:function(b,c){var d=this;d.cbaConfig.lettoSel=d.getEditResLetti().getSelectedRecord();d.cbaConfig.repartoSel=d.getEditResReparto().getSelectedRecord();
d.cbaConfig.stanzaSel=d.getEditResStanza().getSelectedRecord();Ext.isDefined(c)||(c=!1);Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/genOsp/residenza/new",jsonData:b,params:{forceStore:!0},success:function(c){c=Ext.JSON.decode(c.responseText);if(!c.success){if(c.message&&("?"==c.message[0]||c.message[0].testo&&"?"==c.message[0].testo[0])){Messaggio("ATTENZIONE",c.message[0].testo.slice(1),"YESNO","QUESTION",!1,function(){d.salvaLetto(b,!0)});return}c.message&&"$"==c.message[0]?c.message=c.message.substring(1):
msgShowError("ERRORE",c.message[0].testo);return!1}49==CBA.moduli.moduloAttivo&&(d.cbaConfig.controllerEditFascicolo.cbaConfig.controllerFascicolo.cbaConfig.controllerFascicolo.cerca(),d.cbaConfig.controllerEditFascicolo.cbaConfig.controllerFascicolo.getPnlMain().up("window").close(),d.cbaConfig.controllerEditFascicolo.getTabPanel().getActiveTab().up("window").close());return!0}})},generaMessaggio:function(b){var c="",d="",f=!1,g,h=[];Ext.each(b,function(b){b.success?b.chiudiPrecedente&&(d=b.nominativo+
"\n\t"+b.motivo,f=!0,msgAddWarning(h,d+"</br>")):(c=b.nominativo+"\n\t"+b.motivo,g=!0,msgAddError(h,c+"</br>"))});g||f?msgShow("",h):msgShow("SUCCESSO","OPERAZIONE_ANDATA_A_BUON_FINE")},abilitaServizio:function(b){this.getTipoServizio().setReadOnly(!b);this.getServizioDataDal().setReadOnly(!b);this.getServizioOraIngresso().setReadOnly(!b)},aggiornaStore:function(b){var c=this,d=c.getStoricoGridServizi().getStore(),f=c.getForm();c.getTipoServizio().setReadOnly(!0);clearForm(this.getForm());d.load({params:{codospite:c.cbaConfig.codOspite,
soloTipologieAbilitate:!0},callback:function(g,h,k){k?Ext.isEmpty(g)?clearForm(f):(b||(b=f.getForm().findField("idRicovero").getValue()),h=trovaRecord(d,"idRicovero",b),c.getStoricoGridServizi().getSelectionModel().select(h?h:0),c.cbaConfig.controllerEditFascicolo&&c.cbaConfig.showTabAggiuntivi&&c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&(currRicovero=g[0].data,c.abilitaServizio(!1),c.cbaConfig.controllerEditFascicolo.loadTabSecondari())):msgShowError("",h.getError())}})},changeTab:function(){this.getForm().up("window")},
afterTabChange:function(){0==this.getStoricoGridServizi().getStore().getCount()&&this.nuovo()},refreshDatiVideataFascicolo:function(){var b=null;48==CBA.moduli.moduloAttivo?b=this.cbaConfig.ricerca:43==CBA.moduli.moduloAttivo&&(b=Ext.getCmp("app-options").queryById("ParametriRicerca"));var c={};Ext.apply(c,{codOspite:this.cbaConfig.codOspite});b.controller.cerca(c);this.cbaConfig.controllerEditFascicolo&&!this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&form.boxBottoni.queryById("btnEsci").setDisabled(!1)},
checkDatiAdt:function(){var b=this;Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/anagrafica/mostradatiadt",success:function(c){c=Ext.JSON.decode(c.responseText);c.success?c.data&&b.visualizzaAdt():msgShowError("",c.message)}})},visualizzaAdt:function(b){this.getForm();this.getContainerAdt().setHidden(!1);var c={};Ext.apply(c,{tipo:"C"});b?Ext.apply(c,{id:b}):this.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite&&Ext.apply(c,{id:this.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite});
this.getGridAdt().getStore().load({params:c,callback:function(b,c,g){g||msgShowError("",c.getError())}})},onLaunch:function(){var b=this,c=this;c.getContainer().controller=c;c.getStoricoGridServizi().controller=c;var d=c.getForm();d.permesso=c.cbaConfig.permesso;d.boxBottoni=c.getBoxBottoni();c.storeForm=d.store=c.getStoricoGridServizi().getStore();var f=49===CBA.moduli.moduloAttivo;f&&this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&this.getCntFine().setHidden(!0);f&&!c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&
this.checkDatiAdt();d.controller=c;var g=f?"controller_PannelloBottoni":"controller_PannelloBottoniVert";ImpostaUrl([c.getEditResSede().getStore(),c.getEditResReparto().getStore(),c.getEditResStanza().getStore(),c.getEditResLetti().getStore()]);g=Ext.create("Generali.standard."+g,{cbaConfig:{conferma_callback:function(b){c.salva(b);f||(c.cbaConfig.tabIndex=c.getTabPanels().items.indexOf(c.getTabPanels().getActiveTab()),c.cbaConfig.showTabAggiuntivi&&Ext.isDefined(c.cbaConfig.controllerEditFascicolo)&&
c.cbaConfig.controllerEditFascicolo.loadTabSecondari(),c.getTabPanels().setActiveTab(c.cbaConfig.tabIndex))},annulla_callback:function(){c.aggiornaStore()},nuovo_callback:function(){c.nuovo()},elimina_callback:function(){var b=[c.getStoricoGridServizi().getSelectionModel().getSelection()[0].get("id")];Messaggio("ATTENZIONE","MSG_CONFIRM_ELIMINARE_LE_ASSOCIAZIONI","YESNO","QUESTION",null,function(){Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/ricoveri/elimina",jsonData:Ext.JSON.encode(b),success:function(b){b=
Ext.JSON.decode(b.responseText);b.success?c.aggiornaStore():msgShowError("",b.message)}})})},esci_callback:function(){var b=c.getForm().up("window");controller_puoiUscire(b,c.getForm(),function(){c.cbaConfig.controllerEditFascicolo.getTabPanel().items.items[0].down("#Container").controller.salva(!1)},function(){b.close()},function(){b.close()})},verificaCampiForm_callback:function(){return c.verificaCampiForm()},noText:f?!0:null,personIcons:f?getIconButtons():null}});inserisciBottoni(c.getBoxBottoni(),
g);f&&(d.boxBottoni.queryById("btnElimina").setIconCls(getIconButtons().btnEliminaX),Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/ricoveri/rispostaagg",success:function(b){""!=b.responseText&&(b=Ext.JSON.decode(b.responseText),Ext.isEmpty(b.data)||Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/ricoveri/rispostaaggdesc",params:{id:b.data},success:function(b){c.getRispostaAggRicoveri().getStore().load();var d=Ext.JSON.decode(b.responseText);d.success?Ext.isEmpty(d.data)||c.getRispostaAggRicoveri().setFieldLabel(d.data.descrizione):
Messaggio("MSG_ERRORE_SERVER_GENERICO",b.responseText,"OK","ERROR")}}))}}),d.on("afterrender",function(){d.boxBottoni.queryById("btnNuovo").hide();d.boxBottoni.queryById("btnElimina").hide();d.boxBottoni.queryById("btnConferma").hide();d.boxBottoni.queryById("btnAnnulla").hide();d.boxBottoni.queryById("btnEsci").hide()}));c.getForm().boxBottoni=c.getBoxBottoni();c.getTipoServizio().getStore().getProxy().extraParams={idOperatore:CBA.moduli.modulo49.operatore.id,idOrganizzazione:CBA.parametriGenerali.idOrganizzazione};
Ext.create("CS.consegne.store.Sedi").load({callback:function(c,d,f){f?c&&b.getEditResReparto().getStore().load({params:{sede:c[0].get("codice")}}):msgShowError("",d.getError())}});c.cbaConfig.controllerEditFascicolo&&(c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||c.cbaConfig.controllerEditFascicolo.cbaConfig.insertRicoveroCss)?(this.caricaCboxSede(),c.impostaDati()):(c.getEditResSede().allowBlank=!0,c.getEditResReparto().setVisible(!1),c.getEditResReparto().allowBlank=!0,c.getEditResStanza().setVisible(!1),
c.getEditResStanza().allowBlank=!0,c.getEditResLetti().setVisible(!1),c.getEditResLetti().allowBlank=!0,c.getRispostaAggRicoveri().setVisible(!1),c.getRispostaAggRicoveri().allowBlank=!0,c.cbaConfig.codOspite||(c.cbaConfig.codOspite=c.cbaConfig.controllerFascicolo?c.cbaConfig.controllerFascicolo.currentDip:c.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite),c.aggiornaStore(c.cbaConfig.idRicovero));if("L"!=c.cbaConfig.permesso)c.getForm().getForm().on("dirtychange",function(b,d){controller_abilitaBottoni(c.getForm());
c.getStoricoGridServizi().setDisabled(d)});c.cbaConfig.controllerEditFascicolo&&!c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&d.boxBottoni.queryById("btnEsci").setDisabled(!1);"L"==c.cbaConfig.permesso&&(containerSolaLettura(c.getForm()),bottoniSolaLettura(c.getBoxBottoni().id))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditServiziV1",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"tipoServizio",selector:c+"#tipoServizio"},{ref:"servizioDataAl",selector:c+"#servizioDataAl"},{ref:"StoricoGridServizi",selector:c+"#StoricoGridServizi"},{ref:"Form",selector:c+"#Form"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"servizioOraUscita",selector:c+
"#servizioOraUscita"},{ref:"servizioOraIngresso",selector:c+"#servizioOraIngresso"},{ref:"ServizioDataDal",selector:c+"#ServizioDataDal"},{ref:"EditServiziRecordId",selector:c+"#EditServiziRecordId"},{ref:"CntFine",selector:c+"#CntFine"},{ref:"CntPsiche",selector:c+"#CntPsiche"},{ref:"TxtCodicePsiche",selector:c+"#TxtCodicePsiche"},{ref:"motivoDimissioneCu2",selector:c+"#motivoDimissioneCu2"},{ref:"CntRiscAutoptico",selector:c+"#CntRiscAutoptico"},{ref:"ChkRiscAutoptico",selector:c+"#ChkRiscAutoptico"}]);
b.control(c+"#tipoServizio",{change:b.onTipoServChange,expand:b.expandTipo,collapse:b.collapseTipo});b.control(c+"#servizioDataAl",{change:b.onServizioDataAlChange});b.control(c+"#StoricoGridServizi",{select:b.onStoricoGridSelect});b.control(c+"#NfNosologico",{change:b.onChangeNfNosologico});b.control(c+"#ServizioDataDal",{change:b.onChangeDataDal});b.control(c+"#ChkRiscAutoptico",{change:b.onChangeChkRiscAutoptico});b.on({esci:function(){b.getForm().boxBottoni.queryById("btnEsci").handler()}});b.on({changeTab:function(){return b.changeTab()}})},
onChangeChkRiscAutoptico:function(b,c,d){var f=this;if(f.onLoad)return!1;Messaggio("ATTENZIONE","Modificare il valore del check Riscontro Autoptico?","YESNO","QUESTION",!1,function(){return f.salvaRiscAutoptico(c)})},salvaRiscAutoptico:function(b){Ext.Ajax.request({url:getUrlGen()+"/ws/ricoveri/riscauto/save",method:"GET",params:{codOspite:this.cbaConfig.codOspite,valore:getBoolValue(b),compilatore:CBA.moduli.modulo49.operatore.id},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?msgShow("SUCCESSO",
"OPERAZIONE_ANDATA_A_BUON_FINE"):msgShowError("ERRORE",b.message)}})},onChangeDataDal:function(b,c,d){if(!this.impostazNosologico||"T"!=this.impostazNosologico.impostazioni.annoIngresso||!c||!this.lookup("NfNosologico").getValue())return!1;this.caricaImpoNosologico(c,this.impostazNosologico.idProfilo);this.lookup("LblNosologico").setText(formattaNosologico(this.lookup("NfNosologico").getValue(),c.getFullYear(),this.impostazNosologico.lettera,this.impostazNosologico.impostazioni.numeroCaratteri))},
onChangeNfNosologico:function(b,c,d){if(!c)return this.lookup("LblNosologico").setText(""),!1;if(!this.impostazNosologico||"T"==this.impostazNosologico.impostazioni.annoIngresso&&!this.lookup("ServizioDataDal").getValue())return!1;b=!1;"T"==this.impostazNosologico.impostazioni.annoIngresso&&(b=this.lookup("ServizioDataDal").getValue().getFullYear());this.lookup("LblNosologico").setText(formattaNosologico(c,b,this.impostazNosologico.lettera,this.impostazNosologico.impostazioni.numeroCaratteri))},onTipoServChange:function(b,
c,d,f){this.regolaChisura=null;svuotaStore(this.storeElencoRegole);Ext.isEmpty(c)||(b=b.getSelectedRecord().getData().regole,Ext.isEmpty(b)||(this.storeElencoRegole.loadData(b),this.regolaChisura="C"==b[0].operazioneChiusura),this.caricaImpoNosologico(this.lookup("ServizioDataDal").getValue(),c))},caricaImpoNosologico:function(b,c){var d=this;if(!c||!b)return!1;var f=this.lookup("recordId").getValue(),g={idProfilo:c};(!f||1>f)&&Ext.apply(g,{anno:b.getFullYear()});Ext.Ajax.request({url:getUrlGen()+
"/ws/nosologico/profili/get",method:"GET",params:g,success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){var c=b.data&&"T"==b.data.abilitato;d.lookup("CntNosologico").setHidden(!c);c&&(d.impostazNosologico=b.data,d.impostaMaxValueNosologico(b.data.impostazioni.numeroCaratteri),b.data.nextProgrNosologico&&(d.lookup("NfNosologico").setValue(""),d.lookup("NfNosologico").setValue(b.data.nextProgrNosologico)))}else msgShowError("ERRORE",b.message)}})},impostaMaxValueNosologico:function(b){if(!b)return!1;
for(var c="",d=0;d<b;d++)c+="9";this.lookup("NfNosologico").setMaxValue(c);this.lookup("NfNosologico").setWidth(this.impostaLarghezzaNf(b))},impostaLarghezzaNf:function(b){var c=180;5<b&&(c+=10*(b-5));return c},applicaFiltroDisattivi:function(b){},onEditResRepartoSelect:function(b,c,d){SvuotaCombo(this.getEditResStanza());SvuotaCombo(this.getEditResLetti());0<b.value&&(this.getEditResLetti().getStore().getProxy().url="css/cs/ws/genOsp/letti/searchXPerReparto",this.getEditResLetti().getStore().getProxy().extraParams=
{reparto:b.value},this.getEditResStanza().getStore().load(),this.getEditResLetti().getStore().load())},onCollapseCombo:function(b){b.getStore().clearFilter()},collapseTipo:function(b,c){b.store.clearFilter()},expandTipo:function(b,c){var d=this,f=d.getTipoServizio().getStore();f.clearFilter();f.filter(function(b,c){return(recTrova=trovaRecord(d.storeTipologieAbilitate,"idProfilo",b.get("codice")))&&"T"==recTrova.get("abilitato")})},onStoricoGridSelect:function(b,c,d,f){this.impostaDati(c)},onServizioDataAlChange:function(b,
c,d,f){var g=this;d=!0;c&&(d=isValidDate(b));(b=g.getTipoServizio().getValue())&&(b=trovaRecord(g.getTipoServizio().getStore(),"codice",b))&&b.get("extra");!0===d&&(c?g.getServizioOraUscita().show():(g.getServizioOraUscita().hide(),g.getServizioOraUscita().setValue("")));c=null!=c&&null!=g.lookup("idRicoveroCU").getValue()&&""!=g.lookup("idRicoveroCU").getValue()&&null!=g.regolaChisura&&g.regolaChisura;g.getMotivoDimissioneCu2().setVisible(c);c&&Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/motdim/searchbyricoverocu",
params:{idRicoveroCu:g.lookup("idRicoveroCU").getValue()},success:function(b){b=Ext.JSON.decode(b.responseText);g.getMotivoDimissioneCu2().getStore().loadData(b)}})},onCapitoloChange:function(b,c){if(c){var d=new Date;Ext.getCmp("CBArticolo").getStore().load({params:{anno:d.getFullYear(),codCapitolo:c}})}},impostaDati:function(b){var c=this.getForm();this.getStoricoGridServizi().setDisabled(!1);clearForm(c);b&&(this.cbaConfig.controllerEditFascicolo&&!this.cbaConfig.controllerEditFascicolo.currRicoveroCSS.id&&
(this.cbaConfig.controllerEditFascicolo.currRicoveroCSS.id=b.get("id")),this.getForm().loadRecord(b),b.get("nosologicoFormatted")&&this.lookup("LblNosologico").setText(b.get("nosologicoFormatted")),CBA.moduli.modulo49.psicheAbilitata?this.getTxtCodicePsiche().cbaConfig.valorePsicheDefault=b.get("codicePsiche"):Ext.isEmpty(b.get("codicePsiche"))||(this.getCntPsiche().setVisible(!0),this.getTxtCodicePsiche().setReadOnly(!0)),this.cbaConfig.wizard||this.getBoxBottoni().queryById("btnElimina").setVisible(!b.data.al),
b.data.al||this.getServizioDataAl().fireEvent("change"),c.getForm().setValues({oraInizio:b.data.dal}),b.data.al?(c.getForm().setValues({oraFine:b.data.al}),49!==CBA.moduli.moduloAttivo&&(this.getServizioDataAl().setDisabled(!0),this.getServizioOraUscita().setDisabled(!0)),c.boxBottoni.queryById("btnElimina").setDisabled(!0)):(c.getForm().setValues({oraFine:""}),this.getServizioDataAl().setDisabled(!1),this.getServizioOraUscita().setDisabled(!1),c.boxBottoni.queryById("btnElimina").setDisabled(!1)))},
nuovo:function(){"L"!=this.cbaConfig.permesso&&(controller_nuovoRecord(this.getForm()),this.abilitaServizio(!0),this.getTipoServizio().setReadOnly(!1),this.getServizioOraIngresso().setValue(new Date),this.getServizioDataDal().setValue(new Date))},verificaCampiForm:function(){var b=[];this.getForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow(traduci("SERVIZI"),b)},leggiDatiForm:function(){var b=this.getServizioDataDal().getValue();b.setHours(Ext.util.Format.date(this.getServizioOraIngresso().getValue(),
"H"),Ext.util.Format.date(this.getServizioOraIngresso().getValue(),"i"));var c;this.getServizioDataAl().getValue()&&(c=this.getServizioDataAl().getValue(),c.setHours(Ext.util.Format.date(this.getServizioOraUscita().getValue(),"H"),Ext.util.Format.date(this.getServizioOraUscita().getValue(),"i")));var d=this.getForm().getForm().getFieldValues();delete d.oraInizio;delete d.oraFine;delete d.idRicovero;Ext.apply(d,{codOspite:this.cbaConfig.codOspite,dal:b,al:c});return[d]},salvaServizi:function(b){var c=
this,d=c.getEditServiziRecordId().getValue(),f=c.leggiDatiForm(),g=f[0],h=f[1],k=[],l=!0,n=c.getForm().up("window"),f=null===d||0>=d?"new":"update";Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/ricoveri/"+f,method:"POST",jsonData:g,async:!1,success:function(f){f=Ext.JSON.decode(f.responseText);if(f.success){if(null===d||0>=d)d=f.data.idRicovero,c.cbaConfig.currentAss=d;if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo){var g=c.salvaDatiRette(d,h);0<g.length&&(k=k.concat(g),l=!1)}l&&(msgAdd(k,
f.message),b&&c.cbaConfig.controllerEditFascicolo?(c.cbaConfig.controllerEditFascicolo.refreshDatiVideataFascicolo(),n.close()):c.aggiornaStore(d,f))}else msgAdd(k,f.message),l=!1}});l?(msgShow("MSG_SALVATAGGIO_DATI",k),c.cbaConfig.wizard&&(""==c.cbaConfig.controllerEditFascicolo.navDirection&&(c.cbaConfig.controllerEditFascicolo.navDirection="next"),c.cbaConfig.controllerEditFascicolo.navigaWizard(c.cbaConfig.controllerEditFascicolo.navDirection,!0))):(controller_abilitaBottoni(c.getForm()),msgShowError("MSG_SALVATAGGIO_DATI",
k));return l},salva:function(b,c,d,f){var g=this,h=g.getServizioDataDal().getValue();h.setHours(Ext.util.Format.date(g.getServizioOraIngresso().getValue(),"H"),Ext.util.Format.date(g.getServizioOraIngresso().getValue(),"i"));var k;g.getServizioDataAl().getValue()&&(k=g.getServizioDataAl().getValue(),k.setHours(Ext.util.Format.date(g.getServizioOraUscita().getValue(),"H"),Ext.util.Format.date(g.getServizioOraUscita().getValue(),"i")));var l=g.getForm().getForm().getFieldValues();delete l.oraInizio;
delete l.oraFine;delete l.idRicovero;Ext.apply(l,{codOspite:g.cbaConfig.codOspite,dal:h,al:k,checkNosologico:l.nosologico&&!f?"T":"F"});var n=[],p=!0,q=g.getForm().up("window");f={idProfilo:l.idProfilo,data:l.dal,dataAl:l.al,idServizio:c?c:-1,idRegola:d?d:-1,nosologico:l.nosologico||"-1",checkNosologico:l.nosologico&&!f?"T":"F"};null===l.id||0>=l.id?Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/ricoveri/associa",jsonData:Ext.JSON.encode([g.cbaConfig.codOspite]),params:f,success:function(f){f=
Ext.JSON.decode(f.responseText);f.success?(g.cbaConfig.controllerEditFascicolo&&f.data[0].success&&(g.cbaConfig.controllerEditFascicolo.currRicoveroCSS.id=f.data[0].idRicoveroNew),f.data[0].success||"?"!=f.data[0].motivo[0]?(g.generaMessaggio(f.data),p&&(msgAdd(n,f.message),b&&g.cbaConfig.controllerEditFascicolo?(g.cbaConfig.controllerEditFascicolo.refreshDatiVideataFascicolo(),q.close()):(g.aggiornaStore(null,f),g.cbaConfig.controllerEditFascicolo.cbaConfig.controllerServizi&&g.cbaConfig.controllerEditFascicolo.cbaConfig.controllerServizi.aggiornaStore&&
g.cbaConfig.controllerEditFascicolo.cbaConfig.controllerServizi.aggiornaStore()))):(p=!1,controller_abilitaBottoni(g.getForm()),Messaggio("ATTENZIONE",f.data[0].motivo.slice(1),"YESNO","QUESTION",!1,function(){return g.salva(b,c,d,!0)}))):(p=!1,msgAdd(n,f.message))}}):(delete l.idLetto,delete l.idReparto,delete l.idSede,delete l.idStanza,Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/ricoveri/update",jsonData:l,async:!1,success:function(f){f=Ext.JSON.decode(f.responseText);if(f.success){if(null===
id||0>=id)id=f.data.idRicovero;if(p){msgAdd(n,f.message);var h=f.data.coRicoveroLight;Ext.isEmpty(h)?g.generaMessaggioUpdate(f.message):g.creaWinSceltaRicoveroCu(h);b&&g.cbaConfig.controllerEditFascicolo?(g.cbaConfig.controllerEditFascicolo.refreshDatiVideataFascicolo(),q.close()):g.aggiornaStore(id,f)}}else p=!1,controller_abilitaBottoni(g.getForm()),f.message&&("?"==f.message[0]||f.message[0].testo&&"?"==f.message[0].testo[0])?Messaggio("ATTENZIONE",f.message[0].testo.slice(1),"YESNO","QUESTION",
!1,function(){return g.salva(b,c,d,!0)}):(msgAddError(n,f.message),msgShow("",n))}}))},creaWinSceltaRicoveroCu:function(b){this.storeRicoveriCu.loadData(b);b=CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0].getData().cognome+" "+CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0].getData().nome;var c=200;null!=this.regolaChisura&&(c+=30);Ext.create("winCBA",{permesso:"S",larghezzaWin:400,altezzaWin:c,name:"GeneraliOSP.fascicoloNoApp.view.WinSincroRicoveroCollegato",titolo:"Selezionare Ricovero di Contabilit",
maximizable:!1,configItem:{store:this.storeRicoveriCu,htmlText:"Selezionare il ricovero aperto in Contabilit Utenti per l'ospite <i>"+b+"</i> che si desidera chiudere",tipo:1}}).show()},salvaLetto:function(b){var c=this;delete b.idRicoveroCU;delete b.codOspite;delete b.dal;delete b.idProfilo;Ext.applyIf(b,{idRicovero:c.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.ricovero.idRicovero});Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/genOsp/residenza/new",jsonData:b,success:function(b){b=
Ext.JSON.decode(b.responseText);if(b.success){if(null===id||0>=id)id=b.data.idRicovero;c.cbaConfig.controllerEditFascicolo?c.cbaConfig.controllerEditFascicolo.refreshDatiVideataFascicolo():c.aggiornaStore(id,b)}}})},generaMessaggioUpdate:function(b){var c=!1;1<b.length&&(c=!0,msgShowWarning("ATTENZIONE",b));c||msgShow("SUCCESSO",b)},generaMessaggio:function(b){var c="",d="",f=!1,g,h=[];Ext.each(b,function(b){b.success?b.chiudiPrecedente&&(d=b.nominativo+"\n\t"+b.motivo,f=!0,msgAddWarning(h,d+"</br>")):
(c=b.nominativo+"\n\t"+b.motivo,g=!0,msgAddError(h,c+"</br>"))});g||f?msgShow("",h):msgShow("SUCCESSO","OPERAZIONE_ANDATA_A_BUON_FINE")},abilitaServizio:function(b){this.getTipoServizio().setReadOnly(!b);this.getServizioDataDal().setReadOnly(!b);this.getServizioOraIngresso().setReadOnly(!b)},aggiornaStore:function(b){var c=this,d=c.getStoricoGridServizi().getStore(),f=c.getForm();c.getTipoServizio().setReadOnly(!0);d.load({params:{codospite:c.cbaConfig.codOspite,soloTipologieAbilitate:!0,tutteOrg:"T"},
callback:function(g,h,k){k?Ext.isEmpty(g)?clearForm(f):(b||(b=f.getForm().findField("idRicovero").getValue()),g=trovaRecord(d,"idRicovero",b),h=c.getStoricoGridServizi(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(g?g:0),c.cbaConfig.controllerEditFascicolo&&(c.cbaConfig.showTabAggiuntivi&&c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo||c.cbaConfig.nuovaAnaEsistente)&&(c.abilitaServizio(!1),(g=c.cbaConfig.controllerEditFascicolo.getTabPanel().down("#TabSec_EditResidenzaNuovoRic"))&&
g.destroy(),c.cbaConfig.nuovaAnaEsistente&&(c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovaAnaEsistente=!0),c.cbaConfig.controllerEditFascicolo.loadTabSecondari()),c.visualizzaRiscontroAutoptico()):msgShowError("",h.getError())}})},changeTab:function(){var b=this,c=b.getForm().up("window");controller_puoiUscire(c,b.getForm(),function(){b.salva(!1)},function(){b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){b.aggiornaStore()})},
afterTabChange:function(){0==this.getStoricoGridServizi().getStore().getCount()&&this.nuovo()},refreshDatiVideataFascicolo:function(){var b=null;48==CBA.moduli.moduloAttivo?b=this.cbaConfig.ricerca:43==CBA.moduli.moduloAttivo&&(b=Ext.getCmp("app-options").queryById("ParametriRicerca"));var c={};Ext.apply(c,{codOspite:this.cbaConfig.codOspite});b.controller.cerca(c)},beforeSalva:function(b){var c=this,d=c.getForm().getForm().getFieldValues();if(CBA.moduli.modulo49.psicheAbilitata){var f=c.getTxtCodicePsiche(),
g=f.getValue(),h=f.cbaConfig.valorePsicheDefault;if(!Ext.isEmpty(h)&&g!=h)return Messaggio("ATTENZIONE",Ext.String.format(traduci("MSG_CODICE_PSICHE_MODIFICATO"),h,g||"vuoto"),"YESNO","WARNING",null,function(){f.cbaConfig.valorePsicheDefault=g;c.beforeSalva(b)},function(){}),!1}if(c.getMotivoDimissioneCu2().isVisible()&&null==d.motivoDimissioneCu2)return msgShowWarning("","MSG_MOTIVI_DIM_OBB"),!1;(null===d.id||0>=d.id)&&!Ext.isEmpty(c.storeElencoRegole.getData().items)?1<c.storeElencoRegole.getData().items.length&&
"N"!=c.storeElencoRegole.getData().items[0].data.operazioneNuovo?Ext.create("winCBA",{permesso:"S",larghezzaWin:380,altezzaWin:200,name:"GeneraliOSP.fascicoloNoApp.view.WinRaccordoServCuCss",titolo:"Selezionare Servizio",maximizable:!1,closable:!0,configItem:{store:c.storeElencoRegole,onSave:function(b,d,f){c.salva(b,d,f)},testoHtml:"Selezionare il servizio per il ricovero appena creato",esci:b,lbl:"Servizio"}}).show():(d=c.storeElencoRegole.getData().items[0].data.idPadre?c.storeElencoRegole.getData().items[0].data.idPadre:
c.storeElencoRegole.getData().items[0].data.id,c.salva(b,c.storeElencoRegole.getData().items[0].data.idEsterno,d)):c.salva(b)},getCodicePsiche:function(b){return Ext.isEmpty(b)?Promise.reject("codOspite non valido"):(new Promise(function(c,d){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/ricoveri/psiche/codice",params:{codOspite:b},success:function(b){b=Ext.JSON.decode(b.responseText);var f=b.message,h=b.data;b.success?c(h):(msgShowError("",f),d())}})}))["catch"](function(b){return b&&console.error(b)})},
gestCodicePsiche:function(){var b=this;CBA.moduli.modulo49.psicheAbilitata?(b.getCntPsiche().setVisible(!0),b.getCodicePsiche(b.cbaConfig.codOspite).then(function(c){b.getTxtCodicePsiche().cbaConfig.valorePsicheDefault=c;b.getTxtCodicePsiche().setValue(c)})["catch"](function(b){return StdSipcar.error("Codice psiche non calcolato per il seguente motivo: "+b)})):b.getCntPsiche().setVisible(!1)},onLaunch:function(){var b=this;a=b;b.getContainer().controller=b;b.getStoricoGridServizi().controller=b;var c=
b.getForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=b.getStoricoGridServizi().getStore();var d=49===CBA.moduli.moduloAttivo;b.storeRicoveriCu=Ext.create("Ext.data.Store",{fields:[{name:"idRicovero"},{name:"dal"},{name:"descrizineFormatted",convert:function(b,c){return c.get("desServizio")+" - Dal: "+FormattaData(c.get("dal"))}}]});b.storeElencoRegole=Ext.create("Ext.data.Store");c.controller=b;var f=Ext.create("Generali.standard."+(d?"controller_PannelloBottoni":
"controller_PannelloBottoniVert"),{cbaConfig:{conferma_callback:function(c){if(0==b.beforeSalva())return!0;d||(b.cbaConfig.tabIndex=b.getTabPanels().items.indexOf(b.getTabPanels().getActiveTab()),b.cbaConfig.showTabAggiuntivi&&Ext.isDefined(b.cbaConfig.controllerEditFascicolo)&&b.cbaConfig.controllerEditFascicolo.loadTabSecondari(),b.getTabPanels().setActiveTab(b.cbaConfig.tabIndex))},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo();b.gestCodicePsiche()},elimina_callback:function(){var c=
b.getStoricoGridServizi().getSelectionModel().getSelection()[0].get("id"),f=[c];Messaggio("ATTENZIONE","MSG_CONFIRM_ELIMINARE_LE_ASSOCIAZIONI","YESNO","QUESTION",null,function(){Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/ricoveri/elimina",jsonData:Ext.JSON.encode(f),success:function(f){f=Ext.JSON.decode(f.responseText);if(f.success){var g=[];d&&(Ext.isEmpty(f.message)||(Ext.each(f.message,function(b){2==b.tipo&&msgAddError(g,b.testo)}),msgShow("",g)),f.data&&f.data[0]&&f.data[0].success&&
b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.currRicoveroCSS.id==c&&(b.cbaConfig.controllerEditFascicolo.currRicoveroCSS.id=null));b.aggiornaStore()}else msgShowError("",f.message)}})})},esci_callback:function(){var c=b.getForm().up("window");controller_puoiUscire(c,b.getForm(),function(){b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:d?!0:null,personIcons:d?getIconButtons():null}});
inserisciBottoni(b.getBoxBottoni(),f);d&&c.boxBottoni.queryById("btnElimina").setIconCls(getIconButtons().btnEliminaX);b.getForm().boxBottoni=b.getBoxBottoni();b.storeTipologieAbilitate=Ext.create("Generali.gestPwdNew.store.Tipologie");b.storeTipologieAbilitate.getProxy().extraParams={progr:CBA.moduli.modulo49.operatore.id,codEnte:CBA.parametriGenerali.codEntePwd,codProfilo:CBA.parametriGenerali.codProfilo};b.storeTipologieAbilitate.load();b.getTipoServizio().getStore().load({params:{idOperatore:CBA.moduli.modulo49.operatore.id}});
b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?(c.boxBottoni.queryById("btnNuovo").setVisible(!1),c.boxBottoni.queryById("btnElimina").setVisible(!1),c.boxBottoni.queryById("btnConferma").setVisible(!1),c.boxBottoni.queryById("btnAnnulla").setVisible(!1),b.impostaDati()):(b.cbaConfig.codOspite||(b.cbaConfig.codOspite=b.cbaConfig.controllerFascicolo?b.cbaConfig.controllerFascicolo.currentDip:b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite),
b.getStoricoGridServizi().setDisabled(!1),b.aggiornaStore(b.cbaConfig.idRicovero),CBA.moduli.modulo49.psicheAbilitata&&b.getCntPsiche().setHidden(!1));b.cbaConfig.controllerEditFascicolo&&c.boxBottoni.queryById("btnEsci").setVisible(!1);if("L"!=b.cbaConfig.permesso)b.getForm().getForm().on("dirtychange",function(c,d){controller_abilitaBottoni(b.getForm())});"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getForm()),bottoniSolaLettura(b.getBoxBottoni().id));b.getMotivoDimissioneCu2().setVisible(!1)},
visualizzaRiscontroAutoptico:function(){var b=this;Ext.Ajax.request({url:getUrlGen()+"/ws/ricoveri/visualizzaautoptico",method:"GET",params:{codOspite:b.cbaConfig.codOspite},success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){var d=c.data&&"T"==c.data.valore;b.getCntRiscAutoptico().setHidden(!d);d&&(b.onLoad=!0,b.getChkRiscAutoptico().setValue(c.data.extra),b.onLoad=!1)}else msgShowError("ERRORE",c.message)}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditStoricoInfoUtente",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:b+"#Container"},{ref:"StoricoGrid",selector:b+"#StoricoGrid"},{ref:"BoxBottoni",selector:b+"#BoxBottoni"},{ref:"Form",selector:b+"#Form"},{ref:"Descrizione",selector:b+"#Descrizione"},{ref:"DataDal",selector:b+"#DataDal"},{ref:"Note",selector:b+"#Note"}]);this.control(b+"#StoricoGrid",
{select:this.onGridSelect});this.control(b+"#Descrizione",{afterrender:this.afterrenderDescrizione})},afterrenderDescrizione:function(b){1==this.cbaConfig.tipo?this.getDescrizione().setFieldLabel(traduci("CODICE_FISCALE")):2==this.cbaConfig.tipo&&this.getDescrizione().setFieldLabel(traduci("COD_SAN"))},onGridSelect:function(b,c,d,f){this.impostaDati(c);this.getBoxBottoni().queryById("btnElimina").setDisabled(0<d);containerSolaLettura(this.getForm(),0<d)},impostaDati:function(b){this.getStoricoGrid().setDisabled(!1);
clearForm(this.getForm());b?this.getForm().getForm().setValues({id:b.get("id"),descrizione:b.get("descrizione"),dal:b.get("dal"),note:b.get("note")}):(this.getStoricoGrid().setDisabled(!0),validaForm(this.getForm()))},nuovo:function(){this.getForm().getForm().setValues({id:-9999,tipo:this.cbaConfig.tipo,dal:new Date});controller_nuovoRecord(this.getForm())},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");var c=-9999==this.getForm().getForm().findField("id").getValue()?
this.getStoricoGrid().getStore().getAt(0):this.getStoricoGrid().getStore().getAt(1);c&&this.getDataDal().getValue()<=c.data.dal?msgAddError(b,"MSG_DATA_NON_VALIDA"):this.getDataDal().getValue()<this.cbaConfig.dataRif&&msgAddError(b,"MSG_DATA_NON_VALIDA");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;0==this.getStoricoGrid().getStore().getCount()&&""!=this.cbaConfig.valCorrente&&this.salvaOriginale();var c=this.getForm().getForm().getFieldValues();Ext.apply(c,{codOspite:this.cbaConfig.codOspite,
tipo:this.cbaConfig.tipo,descrizione:2>=this.cbaConfig.tipo?c.descrizione.toUpperCase():c.descrizione});controller_salvaRecord(this.getForm(),c,b)},salvaOriginale:function(){var b=this.getForm().getForm().getFieldValues();Ext.apply(b,{codOspite:this.cbaConfig.codOspite,tipo:this.cbaConfig.tipo,descrizione:this.cbaConfig.valCorrente,dal:this.cbaConfig.dataRif,note:traduci("MSG_VALORE_ORIGINARIO")});controller_salvaRecord(this.getForm(),b,!1)},aggiornaStore:function(b){var c=this,d=c.getStoricoGrid().getStore();
d.load({params:{codospite:c.cbaConfig.codOspite,tipo:c.cbaConfig.tipo},callback:function(f,g,h){h?Ext.isEmpty(f)?clearForm(c.getForm()):(f=trovaRecord(d,"id",b),g=c.getStoricoGrid(),g.getSelectionModel().deselectAll(),g.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}})},onLaunch:function(){var b=this;b.getContainer().controller=b;b.getStoricoGrid().controller=b;ImpostaUrl([b.getStoricoGrid().getStore()]);b.getDescrizione().cbaConfig.erroreBloccante=!1;var c=49===CBA.moduli.moduloAttivo,
c=Ext.create("Generali.standard."+(c?"controller_PannelloBottoni":"controller_PannelloBottoniVert"),{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=b.getForm().getForm().findField("id").getValue();if(!Ext.isEmpty(c)){var f=b.getStoricoGrid().getStore().getAt(1);controller_eliminaRecord(b.getStoricoGrid().getStore(),{idStorico:c,oldValue:f?f.data.descrizione:null},function(){b.aggiornaStore()})}},
esci_callback:function(){var c=b.getForm().up("window");b.cbaConfig.controllerEditAnagrafica.aggiornaStore();controller_puoiUscire(c,b.getForm(),function(){b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:c?!0:null,personIcons:c?getIconButtons():null}});inserisciBottoni(b.getBoxBottoni(),c);c=b.getForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();c.store=b.getStoricoGrid().getStore();c.controller=
b;b.aggiornaStore();if("L"!=b.cbaConfig.permesso)b.getForm().getForm().on("dirtychange",function(c,f){controller_abilitaBottoni(b.getForm());b.getStoricoGrid().setDisabled(f)});"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getForm()),controller_bottoniSolaLettura(b.getBoxBottoni()))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.EditUlterioriDati",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"Form",selector:c+"#Form"},{ref:"BoxBottoni",selector:c+"#BoxBottoni"},{ref:"controllerUlt",selector:c+"#controllerUlt"},{ref:"aCodDistretto",selector:c+"#aCodDistretto"},{ref:"aMaternita",selector:c+"#aMaternita"},{ref:"aPaternita",selector:c+"#aPaternita"},
{ref:"aCognomeAcquisito",selector:c+"#aCognomeAcquisito"},{ref:"aConiugatoCon",selector:c+"#aConiugatoCon"},{ref:"aTestamento",selector:c+"#aTestamento"},{ref:"aVedovoDi",selector:c+"#aVedovoDi"},{ref:"aCodReg",selector:c+"#aCodReg"},{ref:"CntCampiPers",selector:c+"#CntCampiPers"}]);b.on({avanti:function(){return b.avanti()},changeTab:function(c){return b.changeTab(c)},esci:function(){var c=b.getForm().up("window");b.getForm().boxBottoni.queryById("btnEsci").handler();c.close()}})},verificaCampiForm:function(){var b=
[];this.getForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow(traduci("ULTERIORI_DATI"),b);return 0==b.length?!0:!1},leggiDatiForm:function(){return this.getForm().getForm().getFieldValues()},salva:function(b,c){if(!this.verificaCampiForm())return!1;Ext.apply(c,this.leggiDatiForm());delete c.dataNascitaFormatted;delete c.idRicovero;delete c.ricovero;delete c.ricoveroCss;delete c.ricoveriAttivi;delete c.indResidenza;c.anagraficaCss=this.isModulo49;return controller_salvaRecord(this.getForm(),
c,b,!1,!0,!1,"codOspite")?(""!=this.cbaConfig.controllerEditFascicolo.navDirection&&this.cbaConfig.controllerEditFascicolo.navigaWizard(this.cbaConfig.controllerEditFascicolo.navDirection,!0),!0):!1},creaCampiPers:function(b){if(null!=b&&0!=b.length){var c=this.getCntCampiPers(),d=!1,f;Ext.suspendLayouts();for(var g=1;5>=g;g++){f={xtype:"textfield",margin:"8 0 0 0",labelClsExtra:"cbaLabel",itemId:"CampoAnag"+g,name:"custom"+g,hidden:!0};if(b[g-1]){var h=b[g-1].get("stato"),k=b[g-1].get("tipocampo"),
l=b[g-1].get("descrizione"),n=h&&("T"==h||"O"==h),h=h&&"T"==h,p="textfield";n&&!d&&(d=!0);2==k?p="numberfield":3==k&&(p="datefield");Ext.apply(f,{xtype:p,fieldLabel:l,hidden:!n,allowBlank:!h})}c.add(f)}Ext.resumeLayouts();c.setVisible(d);this.getForm().getForm().isValid()}},impostaDati:function(b,c,d){c=this.getForm();clearForm(c);if(b){c.loadRecord(b);var f={};for(c=1;5>=c;c++){d=this.getCntCampiPers().down("#CampoAnag"+c);var g=b.get("custom"+c);!g||Ext.isEmpty(d)||d.isHidden()||"datefield"!=d.xtype||
(f["custom"+c]=g)}}this.getForm().getForm().setValues(f);this.getForm().getForm().isValid()},aggiornaStore:function(b,c){var d=this,f=-9999;b?(f=b,d.currentDip=b):d.currentDip&&(f=d.currentDip);d.storeOspite.load({params:{id:f},callback:function(b,c,f){b&&0<b.length?d.getForm&&(d.impostaDati(b[0]),d.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite=b[0].data):d.impostaDati(null)}})},annulla:function(){this.aggiornaStore()},avanti:function(){return!this.verificaCampiForm()||this.oldCF!=this.getACodiceFiscale().getValue()&&
!this.verificaCodFiscale()?!1:checkOK},changeTab:function(b){var c=this;b=c.getForm().up("window");controller_puoiUscire(b,c.getForm(),function(){c.salva(!1,c.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite)},function(){c.aggiornaStore();c.cbaConfig.controllerEditFascicolo.navigaWizard(c.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){c.aggiornaStore()})},gestioneForm:function(b){var c=this;c.storeOspite=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite");ImpostaUrl([c.storeOspite]);
var d=c.getForm();d.permesso=c.cbaConfig.permesso;d.boxBottoni=c.getBoxBottoni();c.storeForm=d.store=c.storeOspite;d.controller=c;b=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(b){c.salva(b,c.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite)},annulla_callback:function(){c.aggiornaStore()},verificaCampiForm_callback:function(){return c.verificaCampiForm()},noText:c.isModulo49?!0:null,personIcons:c.isModulo49?getIconButtons():null}});inserisciBottoni(d.boxBottoni,
b);d.boxBottoni.queryById("btnNuovo").hide();d.boxBottoni.queryById("btnElimina").hide();d.boxBottoni.queryById("btnEsci").hide();d.boxBottoni.queryById("btnAnnulla").disabled=!0;d.boxBottoni.queryById("btnConferma").disabled=!0;c.cbaConfig.controllerEditFascicolo&&c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&(d.boxBottoni.queryById("btnNuovo").setVisible(!1),d.boxBottoni.queryById("btnElimina").setVisible(!1),d.boxBottoni.queryById("btnConferma").setVisible(!1),d.boxBottoni.queryById("btnAnnulla").setVisible(!1));
"L"!=d.permesso&&(d.getForm().on("dirtychange",function(b,g){0==c.getACodDistretto().getStore().getCount()&&(c.getACodDistretto().clearValue(),c.getACodDistretto().rawValue="",c.getACodDistretto().getPicker().getSelectionModel().doMultiSelect([],!1));controller_abilitaBottoni(d);d.boxBottoni.queryById("btnEsci").setDisabled(!1);c.cbaConfig.controllerEditFascicolo&&!c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&(c.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(g),c.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(g))}),
c.getACodDistretto().on("change",function(b,g){0==c.getACodDistretto().getStore().getCount()&&(c.getACodDistretto().clearValue(),c.getACodDistretto().rawValue="",c.getACodDistretto().getPicker().getSelectionModel().doMultiSelect([],!1),controller_abilitaBottoni(d))}));"L"==d.permesso&&(containerSolaLettura(d),controller_bottoniSolaLettura(c.getBoxBottoni()))},onLaunch:function(){var b=this;b.storeOspite=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite");b.storeCampiPers=Ext.create("GeneraliOSP.personalizzazioni.store.Campi_Pers_Anag");
b.isModulo49=49===CBA.moduli.moduloAttivo;ImpostaUrl([b.storeOspite,b.storeCampiPers]);b.storeCampiPers.load({callback:function(c,d,f){f?b.creaCampiPers(c):msgShowError("",operation.getError())}});b.getContainer().controller=b;b.currentDip=b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?!1:b.cbaConfig.controllerFascicolo?b.cbaConfig.controllerFascicolo.currentDip:b.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite;b.cbaConfig.codOspite=b.currentDip?b.currentDip:null;b.gestioneForm();
b.aggiornaStore()},destroy:function(){svuotaStore(this.storeOspite);this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.Fascicolo",{extend:"Generali.standard.ViewController",init:function(){this.emptyUtente();this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"}])},emptyUtente:function(){this.currentAss=this.idRicovero=this.currentDip=null},abilitaButtonFoto:function(){this.getContainer().down("#Foto").down("#BtnFotoDip").setDisabled(!this.currentDip||"L"==this.cbaConfig.permesso)},
onLaunch:function(){var b=this;b.getContainer().add(Ext.create("Generali.portletController.view.WebPortal",{itemId:"Fascicolo",reference:"Fascicolo"+Ext.Date.now(),cbaConfig:{controllerFascicolo:b,idModulo:CBA.moduli.moduloAttivo,buttonId:"Fascicolo",genModulo:"GeneraliOSP",datiAggiuntivi:!0,foto:!0}}));var c=b.getContainer().down("#DatiPrincipali"),d=b.getContainer().down("#DatiAggiuntivi"),f=Ext.create("GeneraliOSP.fascicoloNoApp.view.DatiPrincipali",{itemId:"DatiPrincipali",reference:"DatiPrincipali"+
Ext.Date.now(),cbaConfig:{controllerFascicolo:b,permesso:b.cbaConfig.permesso,cntdatiAggiuntivi:d}});c.add(f);b.datiPrincipali=f;d.add(Ext.create("GeneraliOSP.fascicoloNoApp.view.DatiAggiuntivi",{itemId:"DatiAggiuntivi",reference:"DatiAggiuntivi"+Ext.Date.now(),cbaConfig:{controllerFascicolo:b,permesso:b.cbaConfig.permessoEditServizi}}));var f=!(55==getModuloAttivo()||64==getModuloAttivo()),g=!(55==getModuloAttivo()||64==getModuloAttivo()),h=55==getModuloAttivo()||64==getModuloAttivo(),k=c.down("#ContainerDatiPrincipali").controller,
l=d.down("#ContainerDatiAggiuntivi").controller;CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi||(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi=[]);if(!CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi){for(var n=["GestioneSconti","GestioneSupplementi"],c=0;c<n.length;c++)CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi[n[c]]=b.cbaConfig.permesso;Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/permesso/videata",params:{idModulo:CBA.moduli.moduloAttivo,
idVideata:n.toString()},success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success)for(var c=0;c<n.length;c++)CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi[n[c]]=b.data[c];else msgShowError("",b.message)}})}c=Ext.create("GeneraliOSP.cercaFascicolo.view.Cerca",{itemId:"Cerca",reference:"Cerca"+Ext.Date.now(),cbaConfig:{cbaPaged:!0,nuovo:!0,filtroClassificazione:f,filtroSede:g,filtroPratica:h,permesso:b.cbaConfig.permesso,controllerFascicolo:b,caricaDatiUtente:function(b,c){this.idRicovero=
c;k.updateUtente(b);l.updateRicovero(b,c)},select:function(b,c){k.update(c);l.update(c)},callBackCerca:function(c,d){if(d)if("undefined"===typeof currOspite)var f=setInterval(function(){"undefined"!==typeof currOspite&&(l.openEditServizi(!0),clearInterval(f))},300);else l.openEditServizi(!0);else Ext.isEmpty(c)&&b.abilitaButtonFoto(),b.emptyUtente(),k.update()},clickNuovo:function(b){k.openEditFascicolo(!0,b)}}});b.getContainer().down("#Ricerca").add(c);b.Ricerca=c},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.Frontespizio",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:b+"#Form"},{ref:"dataStampa",selector:b+"#dataStampa"},{ref:"descrizione1",selector:b+"#descrizione1"},{ref:"descrizione2",selector:b+"#descrizione2"},{ref:"vailate",selector:b+"#vailate"},{ref:"fieldSetTipo",selector:b+"#fieldSetTipo"},{ref:"fieldSetDescrizioni",selector:b+"#fieldSetDescrizioni"},
{ref:"boxBottoni",selector:b+"#bBoxBottoni"}])},verificaCampiForm:function(){var b=[],c=this.getForm();c.getValues();c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},esci:function(){this.getForm();this.getBoxBottoni().up("window").close()},loadData:function(){var b=this;"G"==b.cbaConfig.cliente&&Ext.Ajax.request({method:"GET",url:"/cba/osp/co/ws/prszn/osperson/person",success:function(c){c=Ext.JSON.decode(c.responseText);b.cbaConfig.descr1=c.data.codice;b.cbaConfig.descr2=
c.data.valore;c.success?(b.getDescrizione1().setValue(c.data.codice),b.getDescrizione2().setValue(c.data.valore)):msgShowError("",c.message)}})},gestioneForm:function(){var b=this,c=b.getForm();c.erroreBloccante=!1;c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(d){c.erroreBloccante=!1;"G"!=b.cbaConfig.cliente||b.cbaConfig.descr1==b.getDescrizione1().getValue()&&b.cbaConfig.descr2==
b.getDescrizione2().getValue()||(c.salvaDescr=!0);c.up("window").close()},annulla_callback:function(){c.erroreBloccante=!0;Messaggio("","NESSUN DATO INSERITO ESCO!","OK","WARNING")},verificaCampiForm_callback:function(){return b.verificaCampiForm()},esci_callback:function(){c.erroreBloccante=!0;b.esci()}}});inserisciBottoni(c.boxBottoni,d,!0,"start");c.boxBottoni.queryById("btnNuovo").hide();c.boxBottoni.queryById("btnElimina").hide();c.boxBottoni.queryById("btnAnnulla").hide();var d=c.boxBottoni.queryById("btnEsci"),
f=c.boxBottoni.queryById("btnConferma");d.setDisabled(!1);f.setDisabled(!1)},onLaunch:function(){var b=this.getForm().getForm();"G"==this.cbaConfig.cliente?(this.getDescrizione1().setVisible(!0),this.getDescrizione2().setVisible(!0),this.getFieldSetDescrizioni().setVisible(!0)):"C"==this.cbaConfig.cliente&&this.getFieldSetTipo().setVisible(!0);b.setValues({dataStampa:new Date,esponiSuAccettazione:"T",vailate:this.cbaConfig.cliente});this.gestioneForm()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.ImportRicoveroCss",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:c+"#Container"},{ref:"CntCheck",selector:c+"#CntCheck"},{ref:"BtnImporta",selector:c+"#BtnImporta"},{ref:"DataUltimoRicovero",selector:c+"#DataUltimoRicovero"}]);this.control(c+"#BtnImporta",{click:this.clickBtnImporta});this.on({esci:function(){return b.getContainer().up("window").close()}});
this.on({changeTab:function(){return b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)}})},clickBtnImporta:function(){var b=this,c={};this.getContainer().query("checkbox").forEach(function(b){if(b.getValue()){var d={};Ext.apply(c,(d[b.getName()]=!0,d))}});Ext.apply(c,{compilatore:CBA.moduli.modulo49.operatore.id,idRicovero:this.idRicovero});Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/importz/ricovero/importa",jsonData:c,timeout:18E5,success:function(c){Ext.JSON.decode(c.responseText).success?
Messaggio("OPERAZIONE_COMPLETATA","Importazione eseguita con successo","OK","INFO",function(){b.getBtnImporta().setDisabled(!0);b.abilitoCampi()}):Messaggio("ERRORE","Errore importazione","OK","INFO",function(){b.abilitoCampi()})}})},abilitoCampi:function(){var b=this;Ext.create("GeneraliOSP.fascicoloNoApp.store.ImportRicoveroCss").load({params:{idRicovero:this.idRicovero,idProfiloPwdDeCss:CBA.parametriGenerali.idProfiloPwdDeCss},callback:function(c,d,f){if(f){var g=c[0];if(!Ext.isEmpty(g)){Ext.suspendLayouts();
g.get("dataUltimoRicovero")&&b.getDataUltimoRicovero().setText(FormattaData(g.get("dataUltimoRicovero")));var h=b.getCntCheck(),k=b.getBtnImporta();c=["allergie","prescrizioneParam","accertamenti","terapie",2===b.tipoRemota?"anamnesiRemotaV2":"anamnesiRemotaV1",2===b.tipoFamiliare?"anamnesiFamiliareV2":"anamnesiFamiliareV1","anamnesiPers","schedaMhct","attivitaPianifica"];var l=[traduci("ALLERGIE"),traduci("PRESCRIZIONE_PARAM"),traduci("ACCERTAM_NON_EFFETTUATI"),traduci("PRESCRIZIONE_TERAPIE"),traduci("ANAMN_PAT_REMOTA"),
traduci("ANAMNESI_FAMILIARE"),b.titoloAnamnesiPers,traduci("SCHEDA_MHCT"),traduci("PIANIFICAZIONE_ATTIVITA")];h.removeAll();c.map(function(b,c){var d=g.get(b)?"":g.get("msg_"+b)?traduci("MSG_NO_IMPORT"+g.get("msg_"+b)):"";h.add(Ext.create("Ext.form.field.Checkbox",{name:b,boxLabel:d?l[c]+" ("+d+")":l[c],inputValue:"T",uncheckedValue:"F",cls:"cbaCssLabel",labelWidth:0,value:g.get(b),disabled:!g.get(b),listeners:{change:function(b,c){if(c)k.setDisabled(!1);else{var d=!1;h.query("checkbox").forEach(function(b){if(b.getValue())return d=
!0,!1});k.setDisabled(!d)}}}}))});h.query("checkbox").forEach(function(b){if(b.getValue())return k.setDisabled(!1),!1});Ext.resumeLayouts(!0)}}else msgShowError("",d.getError())}})},onLaunch:function(){var b=this;this.permesso=this.cbaConfig.permesso;this.idRicovero=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero;this.idProfilo=CBA.parametriGenerali.idProfiloCss;this.getContainer().controller=this;this.titoloAnamnesiPers=traduci("ANAMNESI_PERS");var c=Ext.create("GeneraliCS.store.ImpPatologieProblemi"),
d=Ext.create("GeneraliCS.store.ImpAnamnesiPers"),f={idProfilo:this.idProfilo};ajaxCall(c,f,function(c){if(c=c[0])b.tipoRemota=c.get("tipoRemota"),b.tipoFamiliare=c.get("tipoFamiliare")}).then(function(){return ajaxCall(d,f,function(c){if(c=c[0])b.titoloAnamnesiPers=c.get("titolo");b.abilitoCampi()})})["catch"](function(b){msgShowError("",b)})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.LettiLiberi",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"LettiLiberi",selector:b+"#LettiLiberi"},{ref:"rdgStanze",selector:b+"#rdgStanze"},{ref:"cerca",selector:b+"#cerca"},{ref:"form",selector:b+"#form"},{ref:"boxBottoni",selector:b+"#boxBottoni"},{ref:"ckgSesso",selector:b+"#ckgSesso"},{ref:"F",selector:b+"#F"},{ref:"M",selector:b+"#M"},{ref:"C",selector:b+
"#C"},{ref:"G",selector:b+"#G"},{ref:"TreeLettiLiberi",selector:b+"#TreeLettiLiberi"},{ref:"CbxSoloLiberi",selector:b+"#CbxSoloLiberi"}]);this.control(b+"#rdgStanze",{change:this.onRdgStanzeChange});this.control(b+"#cerca",{click:this.onBtnCercaClick});this.control(b+"#TreeLettiLiberi",{itemappend:this.itemappendTree,beforeitemcontextmenu:this.beforeitemcontextmenuTree,itemdblclick:this.salva,itemclick:this.itemclickTree})},itemappendTree:function(b,c){c.data.text=traduci(c.data.text)},beforeitemcontextmenuTree:function(b,
c,d,f,g,h){return getPopupMenuTree(g,b)},itemclickTree:function(b,c,d,f,g,h){this.getBoxBottoni().queryById("btnConferma").setDisabled(!c.data.leaf)},esci:function(){this.getLettiLiberi().up("window").close()},salva:function(){var b=this.getTreeLettiLiberi().getSelectionModel().getSelection()[0];b&&b.data.leaf&&this.cbaConfig.salva&&this.cbaConfig.salva(b.data)},verificaCampiForm:function(){return!0},cerca:function(){var b=this.getTreeLettiLiberi(),c="",c=1==this.getRdgStanze().getValue().stanze?
(this.getF().getValue()?"'F'":"")+","+(this.getM().getValue()?"'M'":"")+","+(this.getC().getValue()?"'C'":"")+","+(this.getG().getValue()?"'G'":""):" ";loadStore(b.getStore(),{data:this.cbaConfig.ggDecorrenza,idSede:0,idReparto:0,stanzeAdibite:c,soloLettiLiberi:this.getCbxSoloLiberi().getSubmitValue(),usaDataDimPrev:this.cbaConfig.usaDataDimPrev?this.cbaConfig.usaDataDimPrev:"F"},function(){b.expandAll()})},onBtnCercaClick:function(b,c,d){this.cerca()},onRdgStanzeChange:function(b,c,d,f){this.getCkgSesso().setVisible(1==
c.stanze)},onLaunch:function(){var b=this,c=49===CBA.moduli.moduloAttivo,d=c?"controller_PannelloBottoni":"controller_PannelloBottoniVert";ImpostaUrl([b.getTreeLettiLiberi().getStore()]);c=Ext.create("Generali.standard."+d,{cbaConfig:{conferma_callback:function(){b.salva()},esci_callback:function(){b.getLettiLiberi().up("window").close()},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:c?!0:null,personIcons:c?getIconButtons():null}});inserisciBottoni(b.getBoxBottoni(),c);
b.getBoxBottoni().queryById("btnNuovo").hide();b.getBoxBottoni().queryById("btnElimina").hide();b.getBoxBottoni().queryById("btnAnnulla").hide();this.cerca()},destroy:function(){this.storeLetti&&eliminaStore(this.storeLetti);this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.ProrogheGrid",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Grid",selector:this.selContainer+"#Grid"},{ref:"BtnSalva",selector:this.selContainer+"#BtnSalva"},{ref:"BtnRipristina",selector:this.selContainer+"#BtnRipristina"}]);this.control(this.selContainer+"#BtnRipristina",{click:this.clickBtnRipristina});
this.control(this.selContainer+"#BtnSalva",{click:this.clickBtnSalva});this.control(this.selContainer+"#Grid",{beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,validateedit:this.validateeditGrid})},clickBtnRipristina:function(){var b=this.getGrid().getSelectionModel();Ext.each(b.getSelection(),function(b){b.reject()})},salva:function(){},clickBtnSalva:function(){this.salva()},beforeeditGrid:function(b,c,d){if(!0===b.editing)return!1;d=b.getEditor();var f=d.getForm().findField("f_allegato"),
g=d.down("#BtnElimina");b.file_allegato=c.record.get("file_allegato");b.idAllegato=c.record.get("idAllegato");b.nomeFileAllegato=c.record.get("nomeFileAllegato");g.setVisible(b.nomeFileAllegato);f._onchage||(f._onchage=!0,f.on("change",function(c){var d=c.el.down("input[type=file]").dom.files[0];(new Promise(function(b,c){var f=new FileReader;f.readAsDataURL(d);f.onload=function(){var c=f.result.toString().replace(/^data:(.*,)?/,"");0<c.length%4&&(c+="=".repeat(4-c.length%4));b(c)};f.onerror=function(b){return c(b)}})).then(function(c){g.show();
b.file_allegato=c?c:null;b.nomeFileAllegato=d.name})["catch"](function(c){b.file_allegato=null;msgShowError("",c)})}),g.on("click",function(c){g.hide();b.file_allegato=null;b.nomeFileAllegato=null;StdUtenti.isValidID(b.idAllegato)&&(b.idAllegato=-b.idAllegato)}));this.abilitaBottoniGrid(!1)},editGrid:function(b,c,d){c.record.set({allegato:b.file_allegato,nomeFileAllegato:b.nomeFileAllegato,idAllegato:b.idAllegato});c.store.isRecordUpdated(c.record)&&c.record.set("modificato","T");c.store.commitChanges();
b=this.controllerServizi.getForm();b.isDirty()||"T"!=c.record.get("modificato")||(c=b.getForm().findField("id"),c.setValue("0"+c.getValue()));this.abilitaBottoniGrid(!0)},canceleditGrid:function(b,c,d){c.record.reject();this.abilitaBottoniGrid(!0)},validateeditGrid:function(b,c,d){return msgShow("",[])},abilitaBottoniGrid:function(b){},onLaunch:function(){function b(){var b=f.isModified();c.getBtnSalva().setDisabled(!b);c.getBtnRipristina().setDisabled(!b);c.controllerServizi.calcolaGiorniPrognosi()}
var c=this,d=c.getGrid(),f=d.getStore();d.controller=c;d.getStore().on({datachanged:b,update:b})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.ResponsabileRicovero",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridResponsabili",selector:b+"#GridResponsabili"},{ref:"boxBottoni",selector:b+"#boxBottoni"},{ref:"RespRicForm",selector:b+"#RespRicForm"},{ref:"CBOperatori",selector:b+"#CBOperatori"},{ref:"CBStatoPIC",selector:b+"#CBStatoPIC"},{ref:"RecordId",selector:b+"#RecordId"},{ref:"Note",selector:b+
"#Note"},{ref:"Data",selector:b+"#Data"},{ref:"Ora",selector:b+"#Ora"},{ref:"BtnMap",selector:b+"#BtnMap"}]);this.control(b+"#GridResponsabili",{select:this.onGridResponsabiliSelect});this.control(b+"#BtnMap",{click:this.onBtnMapClick})},onGridResponsabiliSelect:function(b,c){this.impostaDati(c)},onBtnMapClick:function(b){null!=this.mapwin&&this.mapwin.close();b=currOspite.indResidenza.indirizzo+" "+currOspite.indResidenza.civico+" "+currOspite.indResidenza.desComune+" "+currOspite.indResidenza.desNazione;
b=b.replace(/  +/g," ").replace(/,/g,"").replace(/\./g,"");b="'https://maps.google.com/maps?q="+encodeURI(b)+"&z=13&output=embed'";this.mapwin=Ext.create("Ext.Window",{layout:"fit",title:traduci("MAPPA_INDIRIZZO"),html:"<div class='mappa'>        <iframe width='500' height='350' id='map_canvas' frameborder='0' scrolling='no'                 marginwidth='0' marginheight='0' src="+b+"></iframe> </div>"}).show()},nuovo:function(){var b=this.getRespRicForm(),c=new Date;clearForm(b);b.getForm().setValues({id:-9999,
data:c,ora:c,stato:"D"==this.cbaConfig.tipoServizio?1:2})},verificaCampiForm:function(){var b=[],c=this.getRespRicForm().getForm(),d=currRicovero.dataDal,f=this.getGridResponsabili(),g=f.getStore();c.isValid()?(c.findField("data").getValue().setHours(Ext.util.Format.date(this.getOra().getValue(),"H"),Ext.util.Format.date(this.getOra().getValue(),"i")),c.findField("data").getValue()<d?msgAddError(b,"CM_DATA_NON_VALIDA1"):0<g.count()&&(0>c.findField("id").getValue()?0<g.count()&&c.findField("data").getValue()<
g.getAt(0).get("data")&&msgAddError(b,"CM_DATA_NON_VALIDA2"):(f=f.getSelectionModel().getCurrentPosition().rowIdx,d=g.count()>f+1?g.getAt(f+1).get("data"):null,g=0<f?g.getAt(f-1).get("data"):null,null!=d&&c.findField("data").getValue()<=d?msgAddError(b,"CM_DATA_NON_VALIDA3"):null!=g&&c.findField("data").getValue()>=g&&msgAddError(b,"CM_DATA_NON_VALIDA4")))):msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b){var c=this,d=Ext.isEmpty(c.getCBStatoPIC().getValue())?"D"==c.cbaConfig.tipoServizio?
1:2:c.getCBStatoPIC().getValue();if(!c.verificaCampiForm())return!1;var f={id:c.getRecordId().getValue(),idRicovero:c.cbaConfig.idRicovero,nominativo:currOspite.nominativo,data:Ext.isDate(c.getData().getValue())?c.getData().getValue():new Date,idOperatore:c.getCBOperatori().getValue(),note:c.getNote().getValue(),stato:d};f.idOperatore!=CBA.parametriGenerali.codUtente&&["2","3"].includes(d)?Messaggio("ATTENZIONE",{msg:"Si sta effettuando un cambio di stato per conto terzi. <BR> Procedere con questa operazione?",
type:"strongStr"},"YESNO","QUESTION","",function(){controller_salvaRecord(c.getRespRicForm(),f,b,null,!1)},null,function(){controller_abilitaBottoni(c.getRespRicForm())}):controller_salvaRecord(c.getRespRicForm(),f,b)},impostaDati:function(b){form=this.getRespRicForm();this.getGridResponsabili().setDisabled(!1);clearForm(form.id);b&&(this.getRespRicForm().loadRecord(b),form.getForm().setValues({ora:b.get("data")}))},aggiornaStore:function(b){var c=this,d=c.getGridResponsabili().getStore();d.load({params:{idRicovero:c.cbaConfig.idRicovero},
callback:function(f,g,h){h?Ext.isEmpty(f)?(currRicovero.responsabileRicovero="",clearForm(c.getRespRicForm().id)):(b||(b=c.getRecordId().getValue()),g=trovaRecord(d,"id",b),h=c.getGridResponsabili(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(g?[g]:0),Ext.each(f,function(b){currRicovero.responsabileRicovero=2===b.data.stato?b.data.desOperatore:"";if(2===b.data.stato&&Ext.Date.format(b.data.data,"d/m/Y H:i")<=Ext.Date.format(new Date,"d/m/Y H:i"))return!1})):msgShowError("",g.getError())}});
permettiModificheDopoDimissione()||(containerSolaLettura(c.getRespRicForm()),c.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),c.getBoxBottoni().queryById("btnElimina").setDisabled(!0),c.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),c.getBoxBottoni().queryById("btnConferma").setDisabled(!0),c.getBoxBottoni().queryById("btnEsci").setDisabled(!1))},onLaunch:function(){var b=this,c=b.getCBStatoPIC();c.bindStore(new Ext.data.ArrayStore({fields:["codice","valore"],data:[["1",traduci("STATO_ASSEGNATO")],
["2",traduci("STATO_ACCETTATO")],["3",traduci("STATO_RIFIUTATO")]],autoLoad:!0,autoDestroy:!0}));c.setReadOnly("D"!=b.cbaConfig.tipoServizio);b.getBtnMap().setVisible("D"==b.cbaConfig.tipoServizio);ImpostaUrl([b.getGridResponsabili().getStore()]);var d=b.getRespRicForm();d.boxBottoni=b.getBoxBottoni();d.store=b.getGridResponsabili().getStore();d.controller=b;c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},
nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=b.getRespRicForm().getForm().findField("id").getValue();if(!Ext.isEmpty(c)){var g={msg:traduci("MSG_ELIMINA"),type:"strongStr"};controller_eliminaRecord(d.store,{idResponsabile:c},function(){b.aggiornaStore()},null,g,"ATTENZIONE")}},esci_callback:function(){var c=d.up("window");controller_puoiUscire(c,d,function(){b.cbaConfig.ricoveriCtrl.getForm().getForm().setValues({responsabileRicovero:currRicovero.responsabileRicovero});b.salva(!0)},
function(){b.cbaConfig.ricoveriCtrl.getForm().getForm().setValues({responsabileRicovero:currRicovero.responsabileRicovero});c.close()},function(){b.cbaConfig.ricoveriCtrl.getForm().getForm().setValues({responsabileRicovero:currRicovero.responsabileRicovero});c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),c);b.getCBOperatori().getStore().load({params:{codEnte:CBA.parametriGenerali.codEntePwd,codiceModulo:CBA.moduli.moduloAttivo,
idOrganizzazione:getIdOrg(),soloUtentiIdOrg:"T"}});this.aggiornaStore();if("L"==b.cbaConfig.permesso)containerSolaLettura(d),controller_bottoniSolaLettura(d.boxBottoni);else d.getForm().on("dirtychange",function(c,g){controller_abilitaBottoni(d);b.getGridResponsabili().setDisabled(g)})},destroy:function(){}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.WinLingue",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:b+"#Container"},{ref:"CbLingua",selector:b+"#CbLingua"},{ref:"Form",selector:b+"#Form"},{ref:"BtnConferma",selector:b+"#BtnConferma"},{ref:"BtnAnnulla",selector:b+"#BtnAnnulla"},{ref:"BtnEsci",selector:b+"#BtnEsci"}]);this.control(b+"#CbLingua",{change:this.changeCbLingua,afterrender:this.afterrenderCbLingua});
this.control(b+"#BtnConferma",{click:this.clickBtnConferma});this.control(b+"#BtnAnnulla",{click:this.clickBtnAnnulla});this.control(b+"#BtnEsci",{click:this.clickBtnEsci})},clickBtnEsci:function(b){b.up("window").hide()},clickBtnAnnulla:function(b){this.getCbLingua().setValue(CBA.parametriGenerali.lingua.toUpperCase())},clickBtnConferma:function(b){b=this.cbaConfig.controllerMain;var c=this.getCbLingua().getValue();b.lookup("txtLingua").setValue(c);this.getContainer().up("window").hide()},changeCbLingua:function(b,
c,d,f){b.inputEl&&(b.inputEl.removeCls("icon-it"),b.inputEl.removeCls("icon-de"),b.inputEl.removeCls("icon-en"),b.inputEl.addCls("icon-"+c.toLowerCase()))},afterrenderCbLingua:function(b,c){var d=CBA.parametriGenerali.lingua.toUpperCase();this.cbaConfig.controllerMain&&this.cbaConfig.controllerMain.getForm()&&!Ext.isEmpty(this.cbaConfig.controllerMain.getForm().getForm().getFieldValues().lingua)&&(d=this.cbaConfig.controllerMain.getForm().getForm().getFieldValues().lingua);this.getCbLingua().setValue(d)},
onLaunch:function(){},destroy:function(){}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.WinRaccordoServCuCss",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CbServiziEsterni",selector:b+"#CbServiziEsterni"},{ref:"BtnConfermaServizio",selector:b+"#BtnConfermaServizio"},{ref:"Panel",selector:b+"#Panel"}]);this.control(b+"#BtnConfermaServizio",{click:this.onClickBtnConfermaServizio})},onClickBtnConfermaServizio:function(b){var c=null,d=b.up("panel").down("combobox");
d&&(d=d.getSelectedRecord().getData(),d.idEsterno&&d.idPadre&&(c=this.cbaConfig.onSave(this.cbaConfig.esci,d.idEsterno,d.idPadre)),this.cbaConfig.callBack&&this.cbaConfig.callBack(c),b.up("window").close())},onLaunch:function(){var b=this.cbaConfig.store.getData().items[0].data.idEsterno;this.getPanel().html=this.cbaConfig.testoHtml;this.getCbServiziEsterni().setStore(this.cbaConfig.store);this.getCbServiziEsterni().setValue(b);this.getCbServiziEsterni().fieldLabel=this.cbaConfig.lbl},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.controller.WinSincroRicoveroCollegato",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CbRicoveri",selector:b+"#CbRicoveri"},{ref:"BtnConfermaRicovero",selector:b+"#BtnConfermaRicovero"},{ref:"BtnAnnullaRicovero",selector:b+"#BtnAnnullaRicovero"},{ref:"Panel",selector:b+"#Panel"},{ref:"motivoDimissioneCu2",selector:b+"#motivoDimissioneCu2"}]);this.control(b+"#BtnConfermaRicovero",
{click:this.onClickBtnConfermaRicovero});this.control(b+"#BtnAnnullaRicovero",{click:this.onClickBtnAnnullaRicovero});this.control(b+"#CbRicoveri",{change:this.onChangeCbRicoveri})},onClickBtnConfermaRicovero:function(b){var c=this.getCbRicoveri();c&&(c=c.getSelectedRecord().getData(),this.sincronizzaRicovero(c,"F")&&b.up("window").close())},onClickBtnAnnullaRicovero:function(b){var c=this.getCbRicoveri();c&&(c=c.getSelectedRecord().getData(),this.sincronizzaRicovero(c,"T"),b.up("window").close())},
onChangeCbRicoveri:function(b,c,d,f){var g=this;1==this.cbaConfig.tipo&&null!=c&&Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/motdim/searchbyricoverocu",params:{idRicoveroCu:c},success:function(b){b=Ext.JSON.decode(b.responseText);g.getMotivoDimissioneCu2().getStore().loadData(b)}})},sincronizzaRicovero:function(b,c){delete b.descrizineFormatted;b.dal=new Date(b.dal);b.al=new Date(b.al);if(null!=this.cbaConfig.tipo&&1==this.cbaConfig.tipo&&(b.idMotivoDimissioneCu2=this.getMotivoDimissioneCu2().getValue(),
"F"==c&&null==b.idMotivoDimissioneCu2))return msgShowWarning("","MSG_MOTIVI_DIM_OBB"),!1;Ext.Ajax.request({method:"POST",url:getUrlGen()+"/ws/genOsp/ricoveri/sincroRicovero",jsonData:b,params:{soloNotifica:c,tipoSincro:this.cbaConfig.tipo},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?"F"==c&&msgShow("MSG_SALVATAGGIO_DATI",b.message):msgShow("ERRORE",b.message)}});return!0},onLaunch:function(){var b=this.cbaConfig.store.getData().items[0].data.idRicovero;this.getPanel().html=this.cbaConfig.htmlText;
this.getCbRicoveri().setStore(this.cbaConfig.store);this.getCbRicoveri().setValue(b);null!=this.cbaConfig.tipo&&1==this.cbaConfig.tipo&&this.getMotivoDimissioneCu2().setHidden(!1)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.fascicoloNoApp.model.Ricoveri",{extend:"Ext.data.Model",fields:[{name:"idRicovero"},{name:"codOspite"},{name:"motivoDimissione"},{name:"descrDimissione"},{name:"desMotivoDimissione"},{name:"dataDal",type:"date"},{name:"servDesc",convert:function(b,c){var d=c.data.servizio.descrizione;null!=c.data.dataDal&&(d=d+" dal "+FormattaData(c.data.dataDal));null!=c.data.dataAl&&(d=d+" al "+FormattaData(c.data.dataAl));return d}},{name:"dataAl",type:"date"},{name:"fascicoloRif"},{name:"fascicoloRifFormatted"},
{name:"idServizio"},{name:"servizio"},{name:"codiceRid"},{name:"cda"},{name:"annoCda"},{name:"cda1"},{name:"idParametriContabilita"},{name:"idParametriRette"},{name:"codBiancheria"},{name:"idProvenienza"},{name:"recordAccorpato"},{name:"ggModificaFascicolo"},{name:"notePresaInCarico",mapping:function(b){return Ext.isEmpty(b.parametriRegionali)||Ext.isEmpty(b.parametriRegionali.notePresaInCarico)?"":b.parametriRegionali.notePresaInCarico}},{name:"responsabileRicovero"},{name:"idRicoveroCSS"},{name:"dataDimissionePrevista",
type:"date"}]});Ext.define("GeneraliOSP.fascicoloNoApp.store.Adt",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/anagrafica/datiadt",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Assenza",{extend:"Ext.data.Store",fields:[{name:"idAssenza"},{name:"idRicovero"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"motivoUscita"},{name:"desMotivoUscita"},{name:"codiceOspedale"},{name:"tipoUscita"},{name:"idRicovero"},{name:"idRicovero"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/asstemp/today",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.AziendeSanitarie",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/asl/regione"},autoDestroy:!1,autoLoad:!1});Ext.define("GeneraliOSP.fascicoloNoApp.store.AziendeSanitarieDettaglio",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/asl/dettaglio"},autoDestroy:!1,autoLoad:!1});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Cittadinanza",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/nazioni/search"},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.ClassePriorita",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/risposte/cbox"},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.Comuni",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/comuni/cbox"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Distretti",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/distretti/search"},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.GradoIstruzione",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/gradoist/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.ImportRicoveroCss",{extend:"Ext.data.Store",fields:[{name:"data",type:"date"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/importz/ricovero/get",api:{read:"/cba/css/cs/ws/importz/ricovero/get"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.IndirizziUtente",{extend:"Generali.data.StoreJson",fields:[{name:"codOspite"},{name:"dataDecorrenza",type:"date"},{name:"tipoIndirizzo"},{name:"idIndirizzoAnagrafica"},{name:"indirizzo"},{name:"idIndirizzo"},{name:"cap"},{name:"civico"},{name:"interno"},{name:"esponente"},{name:"desNazione"},{name:"nazione"},{name:"comune"},{name:"desComune"},{name:"provincia"},{name:"codAsl"},{name:"exCodAsl"},{name:"codAsst"}],groupField:"tipoIndirizzo",groupDir:"DESC",
proxy:{urlGen:"/ws/genOsp/userAddress/search",api:{read:"/cba/osp/co/ws/genOsp/userAddress/search",create:"/cba/osp/co/ws/genOsp/userAddress/new",update:"/cba/osp/co/ws/genOsp/userAddress/update",destroy:"/cba/osp/co/ws/genOsp/userAddress/delete"}}});Ext.define("GeneraliOSP.fascicoloNoApp.store.IniziativaRichiesta",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/iniziativaRic/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Letti",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/letti/search",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.LettiLiberi",{extend:"Ext.data.TreeStore",fields:[{name:"idSede"},{name:"idReparto"},{name:"idStanza"},{name:"idLetto"},{name:"stanzaAdibita"},{name:"nodeID"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"children"}],autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:"/cba/osp/co/ws/genOsp/letti/free",urlGen:"/ws/genOsp/letti/free",reader:{type:"json",messageProperty:"message",rootProperty:"children"}},sorters:[{property:"text",
direction:"ASC"}],autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.Lingue",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],data:[["IT",traduci("LINGUA_IT"),"icon-it"],["DE",traduci("LINGUA_DE"),"icon-de"],["EN",traduci("LINGUA_EN"),"icon-en"]],autoLoad:!0,autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.MotivoDimissione",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/motdim/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.MotivoIngresso",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/motivoIngresso/search"},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.Nazioni",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/nazioni/search"},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.OnereDegenza",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/onereDegenza/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Operatori",{extend:"Generali.data.StoreCodiceValore",proxy:{url:"/cba/gen/ws/general/utentiPwd/utentiPwdModuloCbox"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Ospite",{extend:"Ext.data.Store",fields:[{name:"nome"},{name:"cognome"},{name:"dataNascita",type:"date"},{name:"desProfessione"},{name:"sesso"},{name:"codOspite"},{name:"desGradoIstruzione"},{name:"gradoIstruzione"},{name:"desStatoCivile"},{name:"statoCivile"},{name:"codiceFiscale"},{name:"comuneNascita"},{name:"desComuneNascita"},{name:"desProvinciaNascita"},{name:"note"},{name:"maternita"},{name:"paternita"},{name:"vedovoDi"},{name:"coniugatoCon"},{name:"cognomeAcquisito"},
{name:"cittadinanza"},{name:"nazioneNascita"},{name:"codiceRegionale"},{name:"codiceSanitario"},{name:"stp"},{name:"numFigliMaschi"},{name:"numFigliFemm"},{name:"codiceDistretto"},{name:"professione"},{name:"desNazioneNascita"},{name:"indResidenza"},{name:"ricovero"},{name:"ricoveriAttivi"},{name:"testamento"},{name:"nominativo"},{name:"idReligione"},{name:"_idAnagExternal"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/users/get",api:{read:".",create:".",update:"."},reader:{type:"json",idProperty:"codOspite",
messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.PosizioneTicket",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/posizioneTicket/search"},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.Professione",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/profess/search",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Provenienza",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/userAddress/cbox"}});Ext.define("GeneraliOSP.fascicoloNoApp.store.RegimeRicovero",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/risposte/cbox"},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.Religione",{extend:"Generali.data.StoreCodiceValore",proxy:{url:"/cba/osp/co/ws/genOsp/risposte/cbox",extraParams:{scheda:"A",domanda:8}}});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Residenza",{extend:"Ext.data.Store",fields:[{name:"idResidenza"},{name:"idRicovero"},{name:"idSede"},{name:"idReparto"},{name:"idStanza"},{name:"idLetto"},{name:"note"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"desSede"},{name:"codiceSede"},{name:"desStanza"},{name:"desLetto"},{name:"desReparto"},{name:"codiceReparto"},{name:"numeroStanza"},{name:"numeroLetto"}],proxy:{type:"ajax",urlGen:"/cba/css/cs/ws/genOsp/residenza/search",reader:{type:"json",
messageProperty:"message",rootProperty:"data"},api:{read:"/cba/css/cs/ws/genOsp/residenza/search",create:".",update:".",destroy:"."}},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.ResponsabileRicovero",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idRicovero"},{name:"data",type:"date"},{name:"idOperatore"},{name:"note"},{name:"stato"},{name:"desOperatore"},{name:"desStato"},{name:"operatoreCambioStato"},{name:"dataCambioStato"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/ricoveri/resp/search",api:{read:".",create:".",update:".",destroy:"."},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.Ricoveri",{extend:"Generali.data.StoreJson",model:"GeneraliOSP.fascicoloNoApp.model.Ricoveri",proxy:{urlGen:"/ws/genOsp/ricoveri/search",api:{read:".",create:".",update:".",destroy:"."}}});Ext.define("GeneraliOSP.fascicoloNoApp.store.Stanze",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/stanze/search",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.StatoCivile",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/statociv/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.StoricoInfoUtente",{extend:"Ext.data.Store",fields:[{name:"codOspite"},{name:"dal",type:"date"},{name:"id"},{name:"descrizione"},{name:"tipo"},{name:"note"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/storicoInfoUtente/src",api:{read:"/cba/osp/co/ws/genOsp/storicoInfoUtente/src",create:"/cba/osp/co/ws/genOsp/storicoInfoUtente/new",update:"/cba/osp/co/ws/genOsp/storicoInfoUtente/update",destroy:"/cba/osp/co/ws/genOsp/storicoInfoUtente/delete"},reader:{type:"json",
messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.TipoEsenzioneTicket",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/tipoEsenzioneTicket/search"},autoDestroy:!0});Ext.define("GeneraliOSP.fascicoloNoApp.store.TipoProvenienza",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/tipoProvenienza/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.store.TipoRicovero",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/tipoRicovero/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.fascicoloNoApp.view.BoxIndirizzi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){this.storeTipoIndirizzo=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["R",traduci("RESIDENZA")],["D",traduci("DOMICILIO")]],autoLoad:!0,autoDestroy:!0});Ext.applyIf(this,{items:[{xtype:"form",itemId:"form",reference:"form",layout:{type:"vbox"},trackResetOnLoad:!0,border:0,items:[{xtype:"combobox",itemId:"cbxTipoIndirizzo",reference:"cbxTipoIndirizzo",fieldLabel:"INDIRIZZO_TYPE",
labelClsExtra:"cbaLabel",name:"tipoIndirizzo",readOnly:"true",store:this.storeTipoIndirizzo,displayField:"valore",valueField:"codice"},{xtype:"container",width:400,margin:"0 0 5 0",defaults:{margin:{top:0,right:11,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"dataDecorrenza",reference:"dataDecorrenza",width:210,fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",name:"dataDecorrenza",format:"d/m/Y"},{xtype:"combobox",margin:"0 0 0 0",hidden:!0,itemId:"cbxExCodAsl",reference:"cbxExCodAsl",
padding:"",matchFieldWidth:!1,listConfig:{minWidth:120,maxHeight:400,minHeight:100},width:179,fieldLabel:"IND_EX_ASL",labelClsExtra:"cbaLabel",labelWidth:50,displayField:"valore",queryMode:"local",queryParam:"valore",typeAhead:!0,valueField:"codice",name:"exCodAsl"}]},{xtype:"combobox",itemId:"nazione",reference:"nazione",width:400,fieldLabel:"IND_NAZIONE",labelClsExtra:"cbaLabel",name:"nazione",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Nazioni"),
typeAhead:!0,valueField:"codice"},{xtype:"textfield",itemId:"indirizzo",reference:"indirizzo",width:400,fieldLabel:"IND_INDIRIZZO",labelClsExtra:"cbaLabel",labelStyle:"",name:"indirizzo",maxLength:200,enforceMaxLength:!0},{xtype:"container",height:30,width:400,defaults:{margin:{top:0,right:11,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"numberfield",itemId:"numero",reference:"numero",width:166,fieldLabel:"IND_NCIVICO",labelClsExtra:"cbaLabel",name:"civico",allowDecimals:!1,useThousandSeparator:!1,
maxLength:10,enforceMaxLength:!0},{xtype:"textfield",itemId:"esponente",reference:"esponente",width:106,fieldLabel:"IND_ESP",labelClsExtra:"cbaLabel",labelWidth:40,name:"esponente",maxLength:5,enforceMaxLength:!0},{xtype:"textfield",itemId:"interno",reference:"interno",width:106,fieldLabel:"IND_INT",labelClsExtra:"cbaLabel",labelWidth:40,name:"interno",maxLength:5,enforceMaxLength:!0}]},{xtype:"container",flex:1,width:408,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{align:"stretch",type:"hbox"},
items:[{xtype:"container",width:400,layout:{type:"vbox"},items:[{xtype:"combobox",itemId:"comune",reference:"comune",width:400,fieldLabel:"CITTA",labelClsExtra:"cbaLabel",name:"comune",displayField:"valore",minChars:3,queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Comuni"),valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[4] == 'T'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore}</div>',
"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"container",flex:1,width:400,layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"cap",reference:"cap",width:176,fieldLabel:"IND_CAP",labelClsExtra:"cbaLabel",name:"cap",maxLength:10,maskRe:/[0-9]/},{xtype:"combobox",margin:"0 0 0 10",hidden:!0,itemId:"cbxCodAsl",reference:"cbxCodAsl",padding:"",matchFieldWidth:!1,listConfig:{minWidth:179,maxHeight:400,minHeight:100},width:214,fieldLabel:"L"==CBA.moduli.modulo43.regioni?
"IND_ATS":"IND_ASL",labelClsExtra:"cbaLabel",labelWidth:30,displayField:"valore",queryMode:"local",queryParam:"valore",typeAhead:!0,valueField:"codice",name:"codAsl"}]},{xtype:"combobox",hidden:!0,disabled:!0,itemId:"cbxCodAsst",reference:"cbxCodAsst",margin:"5 0 0 0",padding:"",matchFieldWidth:!1,width:400,fieldLabel:"DISTRETTO",labelClsExtra:"cbaLabel",displayField:"valore",queryMode:"local",queryParam:"valore",typeAhead:!0,valueField:"codice",name:"codAsst"}]},{xtype:"container",layout:{type:"vbox"},
items:[{xtype:"button",itemId:"modifica",reference:"modifica",iconCls:"icon-edit",scale:"large",text:"",tooltip:"Modifica"}]}]},{xtype:"textfield",hidden:!0,itemId:"idIndirizzo",reference:"idIndirizzo",name:"idIndirizzo"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.CreaAnagrafica",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,flex:1,bodyPadding:10,layout:{type:"vbox"},dockedItems:[{xtype:"toolbar",dock:"top",height:48,items:[{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-ok32",scale:"large",text:"CONFERMA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-annulla32",scale:"large",text:"ANNULLA"}]}],
items:[{xtype:"combobox",itemId:"CbIdCategoria",reference:"CbIdCategoria",valueField:"codice",displayField:"valore",queryMode:"local",width:400,fieldLabel:"CATEGORIA",name:"idCategoria",labelClsExtra:"cbaLabel"},{xtype:"combobox",itemId:"CbxQuintoLivelloCrediti",reference:"CbxQuintoLivelloCrediti",minChars:0,width:400,fieldLabel:"CREDITI",labelClsExtra:"cbaLabel",name:"quintoLivelloCrediti",displayField:"valore",queryParam:"descrizione",valueField:"codice"},{xtype:"container",layout:{type:"hbox",
align:"stretch"},items:[{xtype:"combobox",width:400,fieldLabel:"CONDIZIONI_DI_PAGAMENTO",labelClsExtra:"cbaLabel",allowBlank:!1,itemId:"CbxIdCondPag",reference:"CbxIdCondPag",name:"idCondPagamento",displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"datefield",name:"dataCondPag",itemId:"DataCondPag",reference:"DataCondPag",maxLength:10,enforceMaxLength:!0,width:240,fieldLabel:"DATA_CONDIZIONE_PAGAMENTO",labelClsExtra:"cbaLabel",labelWidth:130,margin:"0 0 0 20",hidden:!0},{xtype:"image",
margin:"5 0 0 3",imgCls:"icon-info",itemId:"InfoBtnCondPag",reference:"InfoBtnCondPag"}]},{xtype:"fieldset",margin:"20 0 0 0",title:"IBAN",width:767,layout:{type:"column"},fieldDefaults:{margin:"0 5 5 0"},items:[{xtype:"textfield",maxLength:4,enforceMaxLength:!0,labelAlign:"top",width:70,fieldLabel:"CIN_EUR",name:"cinEuro",itemId:"TxtCinEuro",reference:"TxtCinEuro",labelClsExtra:"cbaLabel"},{xtype:"textfield",maxLength:1,enforceMaxLength:!0,labelAlign:"top",width:30,fieldLabel:"CIN",name:"cin",itemId:"TxtCin",
reference:"TxtCin",labelClsExtra:"cbaLabel"},{xtype:"combobox",enableRegEx:!0,itemId:"CboxIdBanca",reference:"CboxIdBanca",width:200,labelAlign:"top",fieldLabel:"ABI",name:"abiSportello",listConfig:{width:300,loadMask:!1},labelClsExtra:"cbaLabel",minChars:2,displayField:"clcDescrizione",queryParam:"clcDescrizione",store:Ext.create("Generali.banche.store.cboxBancheABICAB",{autoLoad:!0}),valueField:"codice",queryMode:"local"},{xtype:"combobox",itemId:"CboxIdSportello",reference:"CboxIdSportello",width:200,
listConfig:{width:300,loadMask:!1},labelAlign:"top",fieldLabel:"CAB",name:"idSportello",labelClsExtra:"cbaLabel",minChars:2,displayField:"clcDescrizione",queryParam:"clcDescrizione",store:Ext.create("Generali.banche.store.cboxSportelliABICAB"),valueField:"codice",queryMode:"local"},{xtype:"textfield",width:120,labelAlign:"top",fieldLabel:"CONTO",name:"conto",itemId:"TxtConto",reference:"TxtConto",maxLength:12,enforceMaxLength:!0,labelClsExtra:"cbaLabel"},{xtype:"textfield",width:250,labelAlign:"top",
fieldLabel:"IBAN_COMPLETO",name:"ibanCompleto",itemId:"TxtIbanCompleto",reference:"TxtIbanCompleto",maxLength:35,enforceMaxLength:!0,labelClsExtra:"cbaLabel",hidden:!0},{xtype:"textfield",width:250,labelAlign:"top",fieldLabel:"DESCRIZIONE",name:"descrizione",itemId:"TxtDescrizione",reference:"TxtDescrizione",enforceMaxLength:!0,labelClsExtra:"cbaLabel"},{xtype:"textfield",width:110,labelAlign:"top",itemId:"TxtBic",reference:"TxtBic",fieldLabel:"BIC",name:"bic",maxLength:11,enforceMaxLength:!0,labelClsExtra:"cbaLabel"},
{xtype:"textfield",maxLength:60,enforceMaxLength:!0,labelAlign:"top",width:150,fieldLabel:"SDD_COD_RID_F",name:"codRID2",itemId:"TxtRidPagante",reference:"TxtRidPagante",labelClsExtra:"cbaLabel",hidden:!0}]},{xtype:"fieldset",margin:"20 0 0 0",title:"SDD",itemId:"FsRid",reference:"FsRid",layout:{type:"column"},fieldDefaults:{margin:"0 5 5 0"},items:[{xtype:"textfield",maxLength:60,enforceMaxLength:!0,labelAlign:"top",width:150,fieldLabel:"INTESTATARIO_SDD",name:"intestatarioRid",itemId:"TxtRidIntestatario",
reference:"TxtRidIntestatario",labelClsExtra:"cbaLabel"},{xtype:"textfield",maxLength:16,enforceMaxLength:!0,labelAlign:"top",width:160,fieldLabel:traduci("COD_FISC")+" "+traduci("INTESTATARIO_SDD"),name:"codiceFiscaleRid",itemId:"TxtRidCodFiscaleIntestatario",reference:"TxtRidCodFiscaleIntestatario",labelClsExtra:"cbaLabel"},{xtype:"textfield",maxLength:140,enforceMaxLength:!0,labelAlign:"top",width:150,fieldLabel:"DELEGATO_SDD",name:"delegatoRid",itemId:"TxtRidDelegato",reference:"TxtRidDelegato",
labelClsExtra:"cbaLabel"},{xtype:"textfield",maxLength:140,enforceMaxLength:!0,labelAlign:"top",width:150,fieldLabel:traduci("COD_FISC")+" "+traduci("DELEGATO_SDD"),name:"codiceFiscaleDelegatoRid",itemId:"TxtRidCodFiscaleDelegato",reference:"TxtRidCodFiscaleDelegato",labelClsExtra:"cbaLabel"},{xtype:"datefield",maxLength:10,enforceMaxLength:!0,labelAlign:"top",width:120,fieldLabel:"DATA_SOTTOSCRIZIONE",name:"dataSottoscrizioneRid",itemId:"TxtRidDataSottoscrizione",reference:"TxtRidDataSottoscrizione",
labelClsExtra:"cbaLabel"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.DatiAggiuntivi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"ContainerDatiAggiuntivi",reference:"ContainerDatiAggiuntivi",layout:{type:"vbox",align:"stretch"},autoScroll:!0,items:[{xtype:"CBAShortcutGrid",itemId:"GridRicoveri",reference:"GridRicoveri",border:0,store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Ricoveri"),columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,
g,h,k){b=d.data.servizio.descrizione;this.menuShortcut&&(b+=" "+this.rendererShortcutColumn());return b},width:342,dataIndex:"idServizio",text:"TIPO_SERVIZIO",flex:2},{xtype:"gridcolumn",width:70,dataIndex:"fascicoloRifFormatted",text:"NUM_FASC",flex:1},{xtype:"datecolumn",width:70,dataIndex:"dataDal",text:"DATA_INIZIO",format:"d/m/Y"},{xtype:"datecolumn",width:70,dataIndex:"dataAl",text:"DATA_FINE",format:"d/m/Y"},{xtype:"gridcolumn",hidden:!0,dataIndex:"idRicovero",text:"IdRicovero"}],viewConfig:{getRowClass:function(b,
c,d,f){if(b.data.dataAl)return"non_attivi"},loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"SINGLE"})}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.DatiPrincipali",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"ContainerDatiPrincipali",reference:"ContainerDatiPrincipali",padding:0,border:0,layout:{align:"stretch",type:"hbox"},flex:1,title:"",items:[{xtype:"container",flex:1,defaults:{margin:"0 0 4 0"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",itemId:"Nominativo",reference:"Nominativo",cls:"cbaUtente"},{xtype:"label",
itemId:"CodFisc",reference:"CodFisc"},{xtype:"label",itemId:"DatiNascita",reference:"DatiNascita"},{xtype:"label",itemId:"DatiRes",reference:"DatiRes"}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"image",x:580,y:0,height:50,itemId:"gda_StatoUtente",reference:"gda_StatoUtente",width:50},{xtype:"button",margin:"10,0,0,0",itemId:"prtFronteSpizio",reference:"prtFronteSpizio",iconCls:"icon-stampa32",scale:"small",text:"frontespizio",hidden:!0,tooltip:"Stampa frontespizio"}]}]},
{xtype:"container",width:50,felx:1,items:[]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.DatiPrincipaliUtente",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"DatiPrincipaliUtente",reference:"DatiPrincipaliUtente",padding:3,layout:{align:"stretch",type:"vbox"},flex:1,title:"",items:[{xtype:"panel",layout:{align:"fit",type:"absolute"},height:250,border:0,itemId:"pnlDati",reference:"pnlDati",items:[{xtype:"label",x:0,y:30,cls:"cbaLabelDatiUtente",itemId:"gda_Dati1",
reference:"gda_Dati1"},{xtype:"label",x:0,y:50,cls:"cbaLabelDatiUtente",itemId:"gda_Dati3",reference:"gda_Dati3"},{xtype:"label",x:0,y:80,cls:"cbaLabelDatiUtente",itemId:"gda_Dati5",reference:"gda_Dati5"},{xtype:"label",x:100,y:80,cls:"cbaFieldDisplay cbaGrassetto",itemId:"gda_Dati6",reference:"gda_Dati6"},{xtype:"label",x:100,y:50,cls:"cbaFieldDisplay cbaGrassetto",itemId:"gda_Dati4",reference:"gda_Dati4"},{xtype:"label",x:100,y:30,cls:"cbaFieldDisplay cbaGrassetto",itemId:"gda_Dati2",reference:"gda_Dati2"},
{xtype:"label",cls:"cbaUtente",itemId:"gda_Nome",reference:"gda_Nome"},{xtype:"image",aggiorna:function(b){if(!currRicovero)return this.hide(),!1;var c=Ext.getCmp("GridServizi").controller.getGridRicoveri().getStore().getAt(0).data;if(currRicovero.idRicovero!=c.idRicovero)return!1;this.show();this.removeCls("utentePresenze");this.removeCls("utenteVacanza");this.removeCls("utenteFamiglia");this.removeCls("utenteOspedale");this.removeCls("utenteDimesso");c.dataAl?(this.addCls("utenteDimesso"),b=traduci("PO_DA_SERVIZIO_TERMINATO_IL")+
" "+FormattaData(c.dataAl),c.desMotivoDimissione&&(b=b+" "+traduci("PO_DA_SERVIZIO_CAUSA")+" "+c.desMotivoDimissione),c.descrDimissione&&(b=b+" - "+c.descrDimissione)):b?("O"==b.tipoUscita?this.addCls("utenteOspedale"):"F"==b.tipoUscita?this.addCls("utenteFamiglia"):"V"==b.tipoUscita&&this.addCls("utenteVacanza"),b=traduci("PO_DA_ATTUALMENTE_ASSENTE_DAL")+" "+FormattaData(b.dataDal)+" - "+b.desMotivoUscita):(this.addCls("utentePresente"),b=traduci("PO_DA_ATTUALMENTE_PRESENTE"));setToolTip("gda_StatoUtente",
this.getEl(),b)},aggiornaDenaro:function(b,c){if(!b)return this.hide(),!1;this.show();var d;this.removeCls("utentePresenze");this.removeCls("utenteVacanza");this.removeCls("utenteFamiglia");this.removeCls("utenteOspedale");this.removeCls("utenteDimesso");b.dataAl?(this.addCls("utenteDimesso"),d=traduci("PO_DA_SERVIZIO_TERMINATO_IL")+" "+FormattaData(b.dataAl),b.desMotivoDimissione&&(d=d+" "+traduci("PO_DA_SERVIZIO_CAUSA")+" "+b.desMotivoDimissione),b.descrDimissione&&(d=d+" - "+b.descrDimissione)):
c?("O"==c.tipoUscita?this.addCls("utenteOspedale"):"F"==c.tipoUscita?this.addCls("utenteFamiglia"):"V"==c.tipoUscita&&this.addCls("utenteVacanza"),d=traduci("PO_DA_ATTUALMENTE_ASSENTE_DAL")+" "+FormattaData(c.dataDal)+" - "+c.desMotivoUscita):(this.addCls("utentePresente"),d=traduci("PO_DA_ATTUALMENTE_PRESENTE"));setToolTip("gda_StatoUtente",this.getEl(),d)},x:580,y:0,height:50,itemId:"gda_StatoUtente",reference:"gda_StatoUtente",width:50}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditDatiAnagrafici",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",autoScroll:!0,flex:1,border:0,itemId:"Form",reference:"Form",cls:b?"css-form-label-blue":null,trackResetOnLoad:!0,items:[{xtype:"container",border:0,defaults:{margin:{top:5,right:5,bottom:5,
left:5}},layout:{align:"stretch",type:"hbox"},items:[{xtype:"panel",flex:1,border:0,layout:{align:"stretch",type:"vbox"},items:[{xtype:"fieldset",flex:1,layout:{align:"stretch",type:"vbox"},title:"DATI_ANAGRAFICI",margin:"5 0 0 0",items:[{xtype:"textfield",hidden:!0,name:"codOspite"},{xtype:"textfield",itemId:"aCognome",reference:"aCognome",width:400,fieldLabel:"COGNOME",labelClsExtra:"cbaLabel",name:"cognome",allowBlank:!1,maxLength:30,enforceMaxLength:!0},{xtype:"textfield",itemId:"aNome",reference:"aNome",
width:400,fieldLabel:"NOME",labelClsExtra:"cbaLabel",name:"nome",allowBlank:!1,maxLength:30,enforceMaxLength:!0},{xtype:"radiogroup",itemId:"aSesso",reference:"aSesso",width:270,fieldLabel:"SESSO",labelClsExtra:"cbaLabel",allowBlank:!1,items:[{xtype:"radiofield",itemId:"aMaschio",reference:"aMaschio",fieldLabel:"",name:"sesso",boxLabel:"MASCHIO",inputValue:"M",cls:b?"cbaCssLabel":null},{xtype:"radiofield",itemId:"aFemmina",reference:"aFemmina",fieldLabel:"",name:"sesso",boxLabel:"FEMMINA",inputValue:"F",
cls:b?"cbaCssLabel":null}]},{xtype:"datefield",itemId:"aDataNascita",reference:"aDataNascita",width:210,maxWidth:210,fieldLabel:"DATA_NASCITA",labelClsExtra:"cbaLabel",name:"dataNascita",allowBlank:!1},{xtype:"combobox",itemId:"aComuneNascita",reference:"aComuneNascita",width:300,fieldLabel:"COMUNE_NASCITA",labelClsExtra:"cbaLabel",name:"comuneNascita",allowBlank:!1,displayField:"valore",minChars:3,queryParam:"valore",valueField:"codice",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Comuni"),
tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[4] == 'T'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore}</div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"combobox",itemId:"aNazioneNascita",reference:"aNazioneNascita",width:300,fieldLabel:"NAZIONE_NASCITA",labelClsExtra:"cbaLabel",name:"nazioneNascita",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",
store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Nazioni"),typeAhead:!0,valueField:"codice"},{xtype:"container",margin:"3 0 5 0",layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"aCittadinanza",reference:"aCittadinanza",width:300,fieldLabel:"CITTADINANZA",labelClsExtra:"cbaLabel",name:"cittadinanza",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Cittadinanza"),typeAhead:!0,valueField:"codice"},{xtype:"button",itemId:"btnLingua",
reference:"btnLingua",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",width:100,margin:"0 0 0 5",text:"LINGUA"},{xtype:"label",itemId:"lblLingua",reference:"lblLingua",margin:"5 0 0 0",allowBlank:!0},{xtype:"image",margin:"5 0 0 3",imgCls:"icon-info",itemId:"infoBtnLingua",reference:"infoBtnLingua"},{xtype:"textfield",itemId:"txtLingua",reference:"txtLingua",hidden:!0,name:"lingua",allowBlank:!0}]},{xtype:"combobox",itemId:"CbTipoSoggetto",reference:"CbTipoSoggetto",width:300,fieldLabel:traduci("TIPO_SOGGETTO"),
labelClsExtra:b?"cbaCssLabel":"cbaLabel",name:"stp",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.TipoSoggetto"),valueField:"codice",hidden:!0},{xtype:"container",margin:"0 0 5 0",width:410,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"textfield",validator:function(b){return ControllaCF(b)},itemId:"aCodiceFiscale",reference:"aCodiceFiscale",width:300,fieldLabel:"CODICE_FISCALE",labelClsExtra:"cbaLabel",name:"codiceFiscale",
allowBlank:!1,enforceMaxLength:!0,maxLength:16},{xtype:"button",itemId:"btnModificaCF",reference:"btnModificaCF",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",width:25,iconCls:"icon-orologio",tooltip:"TITOLO_STORICO_CODFISC"},{xtype:"button",itemId:"btnCalcolatrice",reference:"btnCalcolatrice",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",width:100,iconCls:"icon-calcolatrice",text:"CALCOLA",tooltip:"CALCOLA_CODFISC"}]},{xtype:"container",width:410,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},
items:[{xtype:"textfield",itemId:"aCodSan",reference:"aCodSan",width:300,fieldLabel:"COD_SAN",labelClsExtra:"cbaLabel",name:"codiceSanitario",enforceMaxLength:!0,maxLength:16},{xtype:"button",itemId:"btnModificaCS",reference:"btnModificaCS",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",width:25,iconCls:"icon-orologio",tooltip:"TITOLO_STORICO_CODSAN"},{xtype:"button",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",itemId:"btnTEAM",reference:"btnTEAM",width:100,iconCls:"icon-team",text:"TEAM"}]},{xtype:"combobox",
itemId:"aReligione",reference:"aReligione",margin:"5 0 0 0",width:410,fieldLabel:"RELIGIONE",labelClsExtra:"cbaLabel",name:"idReligione",allowBlank:!0,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Religione"),typeAhead:!0,valueField:"codice",hidden:50!=CBA.moduli.moduloAttivo}]}]},{xtype:"panel",flex:1,border:0,layout:{align:"stretch",type:"vbox"},items:[{hidden:50==CBA.moduli.moduloAttivo,xtype:"fieldset",title:"Altro",flex:1,layout:{type:"vbox",
align:"stretch"},margin:"5 0 7 0",items:[{xtype:"combobox",itemId:"aStatoCivile",reference:"aStatoCivile",width:300,fieldLabel:"STATO_CIVILE",labelClsExtra:"cbaLabel",name:"statoCivile",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.StatoCivile"),valueField:"codice"},{xtype:"combobox",itemId:"aProfessione",reference:"aProfessione",width:300,fieldLabel:"PROFESSIONE_PREVALENTE",labelClsExtra:"cbaLabel",name:"professione",displayField:"valore",
queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Professione"),typeAhead:!0,valueField:"codice"},{xtype:"combobox",itemId:"aGradoIstruzione",reference:"aGradoIstruzione",width:300,fieldLabel:"GRADO_ISTRUZIONE",labelClsExtra:"cbaLabel",name:"gradoIstruzione",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.GradoIstruzione"),typeAhead:!0,valueField:"codice"},{xtype:"container",width:410,defaults:{margin:{top:0,
right:5,bottom:0,left:0}},layout:{type:"hbox"},margin:"0 0 5 0",items:[{xtype:"numberfield",itemId:"aFigliM",reference:"aFigliM",width:140,fieldLabel:"FIGLI_M",labelClsExtra:"cbaLabel",name:"numFigliMaschi",allowDecimals:!1,minValue:0},{xtype:"numberfield",itemId:"aFigliF",reference:"aFigliF",width:140,margin:"0 0 0 20",fieldLabel:"FIGLI_F",labelClsExtra:"cbaLabel",name:"numFigliFemm",allowDecimals:!1,minValue:0}]}]},{xtype:"container",hidden:50==CBA.moduli.moduloAttivo,items:[{xtype:"button",cls:b?
"cbaCssBtnFunzione":"cba-stdbutton-25",width:"auto",itemId:"btnTICKET",reference:"btnTICKET",margin:"0 10 0 0",iconCls:"icon-ticket20",text:"DOCUMENTI_TICKET"},{xtype:"button",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",width:"auto",itemId:"btnMedici",reference:"btnMedici",iconCls:"icon-doctor20",text:"GESTIONE_MEDICI"}]},{xtype:"fieldset",flex:1,layout:{type:"vbox"},margin:"5 0 0 0",title:"NOTE",items:[{xtype:"htmleditor",itemId:"aNote",reference:"aNote",flex:1,margin:"0 0 3 1",width:478,labelAlign:"top",
name:"note"}]}]}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",margin:"0 0 35 0"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditDatiAnagraficiCSS",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",autoScroll:!0,flex:1,border:0,itemId:"Form",reference:"Form",cls:b?"css-form-label-blue":null,trackResetOnLoad:!0,items:[{xtype:"container",border:0,defaults:{margin:{top:5,right:5,bottom:5,
left:5}},layout:{align:"stretch",type:"hbox"},items:[{xtype:"panel",flex:1,border:0,layout:{align:"stretch",type:"vbox"},items:[{xtype:"fieldset",itemId:"fieldsetSinistra",reference:"fieldsetSinistra",margin:"5 20 5 20",layout:{align:"stretch",type:"vbox"},title:"DATI_ANAGRAFICI",margin:"5 0 0 0",items:[{xtype:"textfield",hidden:!0,name:"codOspite"},{xtype:"textfield",itemId:"aCognome",reference:"aCognome",fieldLabel:"COGNOME",labelClsExtra:"cbaLabel",name:"cognome",allowBlank:!1,maxLength:30,enforceMaxLength:!0},
{xtype:"textfield",itemId:"aNome",reference:"aNome",fieldLabel:"NOME",labelClsExtra:"cbaLabel",name:"nome",allowBlank:!1,maxLength:30,enforceMaxLength:!0},{xtype:"radiogroup",itemId:"aSesso",reference:"aSesso",fieldLabel:"SESSO",labelClsExtra:"cbaLabel",allowBlank:!1,items:[{xtype:"radiofield",itemId:"aMaschio",reference:"aMaschio",fieldLabel:"",name:"sesso",boxLabel:"MASCHIO",inputValue:"M",cls:b?"cbaCssLabel":null},{xtype:"radiofield",itemId:"aFemmina",reference:"aFemmina",fieldLabel:"",name:"sesso",
boxLabel:"FEMMINA",inputValue:"F",cls:b?"cbaCssLabel":null}]},{xtype:"datefield",itemId:"aDataNascita",reference:"aDataNascita",fieldLabel:"DATA_NASCITA",labelClsExtra:"cbaLabel",name:"dataNascita",allowBlank:!1},{xtype:"combobox",itemId:"aComuneNascita",reference:"aComuneNascita",fieldLabel:"COMUNE_NASCITA",labelClsExtra:"cbaLabel",name:"comuneNascita",allowBlank:!1,displayField:"valore",minChars:3,queryParam:"valore",valueField:"codice",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Comuni"),
tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[4] == 'T'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore}</div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"combobox",itemId:"aNazioneNascita",reference:"aNazioneNascita",fieldLabel:"NAZIONE_NASCITA",labelClsExtra:"cbaLabel",name:"nazioneNascita",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",
store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Nazioni"),typeAhead:!0,valueField:"codice"},{xtype:"container",margin:"0 0 5 0",defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"aCittadinanza",reference:"aCittadinanza",fieldLabel:"CITTADINANZA",labelClsExtra:"cbaLabel",name:"cittadinanza",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Cittadinanza"),typeAhead:!0,valueField:"codice"},
{xtype:"checkboxfield",cls:b?"cbaCssLabel":"cbaLabel",itemId:"aStp",reference:"aStp",fieldLabel:"",name:"stp",boxLabel:"STP",inputValue:"T",uncheckedValue:"F"},{xtype:"button",itemId:"btnLingua",reference:"btnLingua",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",width:100,text:"LINGUA"},{xtype:"label",itemId:"lblLingua",reference:"lblLingua",margin:"5 0 0 0",allowBlank:!0},{xtype:"image",margin:"5 0 0 1",imgCls:"icon-info",itemId:"infoBtnLingua",reference:"infoBtnLingua"},{xtype:"textfield",itemId:"txtLingua",
reference:"txtLingua",hidden:!0,name:"lingua",allowBlank:!0}]},{xtype:"container",margin:"0 0 5 0",width:410,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"textfield",validator:function(b){return ControllaCF(b)},itemId:"aCodiceFiscale",reference:"aCodiceFiscale",width:300,fieldLabel:"CODICE_FISCALE",labelClsExtra:"cbaLabel",name:"codiceFiscale",allowBlank:!1,enforceMaxLength:!0,maxLength:16},{xtype:"button",itemId:"btnCalcolatrice",reference:"btnCalcolatrice",
cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",width:100,iconCls:"icon-calcolatrice",text:"CALCOLA",tooltip:"CALCOLA_CODFISC"}]},{xtype:"container",width:410,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"aCodSan",reference:"aCodSan",width:300,fieldLabel:"COD_SAN",labelClsExtra:"cbaLabel",name:"codiceSanitario",enforceMaxLength:!0,maxLength:16},{xtype:"button",itemId:"btnModificaCS",reference:"btnModificaCS",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",
width:25,iconCls:"icon-orologio",tooltip:"TITOLO_STORICO_CODSAN"},{xtype:"button",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",itemId:"btnTEAM",reference:"btnTEAM",width:100,iconCls:"icon-team",text:"TEAM"}]}]},{xtype:"panel",region:"south",hidden:!0,title:"DATI_AGGIUNTIVI",itemId:"ContainerAdt",reference:"ContainerAdt",margin:"20",minHeight:"110",maxHeight:"150",flex:1,layout:{type:"fit"},items:[{xtype:"gridpanel",border:0,itemId:"GridAdt",reference:"GridAdt",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Adt"),
viewConfig:{loadMask:!1},emptyText:traduci("NESSUN_DATO_PRESENTE"),columns:[{xtype:"gridcolumn",dataIndex:"extra",text:"DATO",flex:1},{xtype:"gridcolumn",dataIndex:"valore",text:"VALORE",flex:1}]}]}]},{xtype:"panel",itemId:"panelDestra",reference:"panelDestra",flex:1,border:0,layout:{align:"stretch",type:"vbox"},items:[{xtype:"fieldset",itemId:"fieldSetAltro",reference:"fieldSetAltro",title:"Altro",flex:1,layout:{type:"vbox",align:"stretch"},margin:"5 0 7 0",items:[{xtype:"combobox",itemId:"aStatoCivile",
reference:"aStatoCivile",width:300,fieldLabel:"STATO_CIVILE",labelClsExtra:"cbaLabel",name:"statoCivile",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.StatoCivile"),valueField:"codice"},{xtype:"combobox",itemId:"aProfessione",reference:"aProfessione",width:300,fieldLabel:"PROFESSIONE_PREVALENTE",labelClsExtra:"cbaLabel",name:"professione",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Professione"),
typeAhead:!0,valueField:"codice"},{xtype:"combobox",itemId:"aGradoIstruzione",reference:"aGradoIstruzione",width:300,fieldLabel:"GRADO_ISTRUZIONE",labelClsExtra:"cbaLabel",name:"gradoIstruzione",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.GradoIstruzione"),typeAhead:!0,valueField:"codice"},{xtype:"container",width:410,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},margin:"0 0 5 0",items:[{xtype:"numberfield",
itemId:"aFigliM",reference:"aFigliM",width:140,fieldLabel:"FIGLI_M",labelClsExtra:"cbaLabel",name:"numFigliMaschi",allowDecimals:!1,minValue:0},{xtype:"numberfield",itemId:"aFigliF",reference:"aFigliF",width:140,margin:"0 0 0 20",fieldLabel:"FIGLI_F",labelClsExtra:"cbaLabel",name:"numFigliFemm",allowDecimals:!1,minValue:0}]}]},{xtype:"container",itemId:"cntBtn",reference:"cntBtn",hidden:50==CBA.moduli.moduloAttivo,nonDisabilitare:!0,items:[{xtype:"button",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",
width:"auto",itemId:"btnTICKET",reference:"btnTICKET",margin:"0 10 0 0",iconCls:"icon-ticket20",text:"DOCUMENTI_TICKET"},{xtype:"button",cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",width:"auto",itemId:"btnMedici",reference:"btnMedici",iconCls:"icon-doctor20",text:"GESTIONE_MEDICI"}]},{xtype:"fieldset",flex:1,itemId:"fieldSetNote",reference:"fieldSetNote",layout:{type:"vbox"},margin:"5 0 0 0",title:"NOTE",items:[{xtype:"htmleditor",itemId:"aNote",reference:"aNote",flex:1,margin:"0 0 3 1",width:478,
labelAlign:"top",name:"note"}]}]}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",margin:"0 0 35 0"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditFascicolo",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{items:[{xtype:"tabpanel",flex:1,itemId:"TabPanel",reference:"TabPanel",items:[{xtype:"container",itemId:"DatiAnagrafici",reference:"DatiAnagrafici",title:"DATI_ANAGRAFICI",layout:{type:"fit"}},{xtype:"container",itemId:"UlterioriDati",reference:"UlterioriDati",title:"ULTERIORI_DATI",
layout:{type:"fit"}},{xtype:"container",itemId:"Indirizzi",reference:"Indirizzi",title:"INDIRIZZI",layout:{type:"fit"}},{xtype:"container",itemId:"TabServizi",reference:"TabServizi",title:b?"RICOVERI":"SERVIZI",layout:{type:"fit"}},{xtype:"container",itemId:"TipologieCartella",reference:"TipologieCartella",title:"RICOVERI",layout:{type:"fit"}}]},{xtype:"panel",layout:{type:"hbox",align:"stretch"},title:"",items:[{xtype:"tbspacer",width:200},{xtype:"tbfill"},{xtype:"button",itemId:"BtnCreaAnagrafica",
reference:"BtnCreaAnagrafica",iconCls:"icon-pagante16",scale:"large",text:"ANAGRAFICA",tooltip:"CREA_ANAGRAFICA_PAGANTE",hidden:!CBA.moduli.modulo43.abilitato||43!==CBA.moduli.moduloAttivo,margin:3,disabled:!0},{xtype:"button",itemId:"BtnIndietro",reference:"BtnIndietro",iconCls:"icon-indietro",scale:"large",minWidth:85,tooltip:"INDIETRO",text:b?null:"INDIETRO",disabled:!0,margin:3},{xtype:"button",itemId:"BtnAvanti",reference:"BtnAvanti",iconCls:"icon-avanti",tooltip:"AVANTI",text:b?null:"AVANTI",
iconAlign:"right",scale:"large",minWidth:85,margin:3,nonDisabilitare:!0},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esci32",iconAlign:"right",scale:"large",minWidth:85,text:b?null:"ESCI",margin:3,nonDisabilitare:!0},{xtype:"tbfill"},{xtype:"container",layout:"vbox",width:200,margin:10,items:[{xtype:"progressbar",itemId:"ProgressWizardFas",reference:"ProgressWizardFas",text:"0% Completamento..",border:1,width:200,height:24,value:0,animate:!0}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditIndirizzi",{extend:"Generali.standard.ControlledContainer",border:0,layout:{type:"border"},initComponent:function(){var b=traduci("RESIDENZA"),c=traduci("DOMICILIO");Ext.applyIf(this,{items:[{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""},{xtype:"form",autoScroll:!0,flex:1,region:"center",border:0,itemId:"Form",reference:"Form",layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"panel",
border:0,height:250,itemId:"boxIndirizzi",reference:"boxIndirizzi",width:420,title:""},{xtype:"textfield",hidden:!0,fieldLabel:"id",name:"id"},{xtype:"textfield",hidden:!0,itemId:"EditIndirizziRecordId",reference:"EditIndirizziRecordId",fieldLabel:"idAnagrafica",name:"idIndirizzoAnagrafica"}]},{xtype:"panel",region:"west",width:210,layout:{type:"fit"},title:"IND_ELENCO",itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridIndirizzi",reference:"StoricoGridIndirizzi",
title:"",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.IndirizziUtente"),viewConfig:{loadMask:!1},sortableColumns:!1,columns:[{xtype:"datecolumn",width:80,dataIndex:"dataDecorrenza",text:"DATA_DECORRENZA",flex:1,format:"d/m/Y"}],features:[{ftype:"grouping",groupHeaderTpl:Ext.create("Ext.XTemplate","{name:this.formatName}",{formatName:function(d){return"R"==d?b:"D"==d?c:" "}})}],selModel:Ext.create("Ext.selection.RowModel",{})}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditServizi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",trackResetOnLoad:!0,itemId:"Form",reference:"Form",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:.8,layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",width:210,layout:{type:"fit",align:"stretch"},title:"SERV_ELENCO",itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridServizi",
reference:"StoricoGridServizi",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Ricoveri"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"dataDal",text:"DATA_INIZIO",flex:1,format:"d/m/Y"},{xtype:"datecolumn",dataIndex:"dataAl",text:"DATA_FINE",flex:1,format:"d/m/Y"}],selModel:Ext.create("Ext.selection.RowModel",{})}]},{xtype:"container",flex:1,border:0,margin:"5 0 0 10",layout:{type:"vbox"},autoScroll:!0,title:"",items:[{xtype:"container",margin:"0 0 2 0",layout:{type:"hbox"},
items:[{xtype:"textfield",itemId:"recordId",reference:"recordId",name:"id",hidden:!0},{xtype:"combobox",itemId:"tipoServizio",reference:"tipoServizio",width:325,fieldLabel:"TIPO_SERVIZIO",labelClsExtra:"cbaLabel",name:"idServizio",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.TipoServizioRegole"),valueField:"codice"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"label",baseCls:"cbaLabel",margin:"5 0 0 5",text:traduci("FASC")+
":",itemId:"nameLabelNumFasc",reference:"nameLabelNumFasc"},{xtype:"label",margin:"4 0 0 5",labelClsExtra:"cbaLabel",itemId:"prefNumFasc",reference:"prefNumFasc"},{xtype:"textfield",width:80,itemId:"servizioNumeroFascicolo",reference:"servizioNumeroFascicolo",hideLabel:!0,fieldLabel:"FASC",labelWidth:30,labelClsExtra:"cbaLabel",name:"fascicoloRif",maxLength:20,enforceMaxLength:!0},{xtype:"label",margin:"4 0 0 0",labelClsExtra:"cbaLabel",itemId:"suffNumFasc",reference:"suffNumFasc"}]}]},{xtype:"combobox",
width:"100%",itemId:"cbResidenza",reference:"cbResidenza",fieldLabel:"RESIDENZA_INGRESSO",labelClsExtra:"cbaLabel",name:"idProvenienza",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Provenienza"),valueField:"codice",allowBlank:!1,minChars:0},{xtype:"container",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"servizioDataDal",reference:"servizioDataDal",margin:"0 10 0 0",width:210,fieldLabel:"DATA_INIZIO",labelClsExtra:"cbaLabel",
name:"dataDal",allowBlank:!1},{xtype:"timefield",itemId:"servizioOraIngresso",reference:"servizioOraIngresso",width:140,fieldLabel:"ORA_INIZIO",labelClsExtra:"cbaLabel",labelWidth:80,name:"oraInizio",value:"08:00",allowBlank:!1,format:"H:i",increment:30}]},{xtype:"container",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"datefield",margin:"0 10 0 0",itemId:"servizioDataAl",reference:"servizioDataAl",width:210,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",name:"dataAl"},{xtype:"timefield",
itemId:"servizioOraUscita",reference:"servizioOraUscita",width:140,fieldLabel:"ORA_FINE",labelClsExtra:"cbaLabel",labelWidth:80,name:"oraFine",format:"H:i",increment:30}]},{xtype:"textfield",hidden:!0,itemId:"EditServiziRecordId",reference:"EditServiziRecordId",fieldLabel:"id",name:"idRicovero"},{xtype:"textfield",name:"idRicoveroCSS",hidden:!0},{xtype:"textfield",hidden:!0,itemId:"recordAccorpato",reference:"recordAccorpato",fieldLabel:"recordAccorpato",name:"recordAccorpato"},{xtype:"combobox",
margin:"0 0 5 0",itemId:"motivoDimissione",reference:"motivoDimissione",width:"100%",fieldLabel:"MOTIVI_DIM",labelClsExtra:"cbaLabel",name:"motivoDimissione",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.MotivoDimissione"),valueField:"codice"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"checkboxfield",fieldLabel:"CONSENSO_TRATTAMENTO_DATI_PERSONALI",inputValue:"T",margin:"0 30 0 0",uncheckedValue:"F",labelWidth:250,labelClsExtra:"cbaLabel",
cls:"cbaLabel",name:"consensoTrattamentoDati",itemId:"consensoTrattamentoDati",reference:"consensoTrattamentoDati"},{xtype:"combobox",itemId:"IdCicloScolastico",reference:"IdCicloScolastico",hidden:50!=CBA.moduli.moduloAttivo,width:208,fieldLabel:"CICLO_SCOLASTICO",labelClsExtra:"cbaLabel",name:"idCicloScolastico",labelWidth:100,displayField:"valore",queryMode:"local",valueField:"codice"}]}]},{xtype:"panel",layout:{type:"vbox",align:"stretch"},itemId:"boxBottoni",reference:"boxBottoni",width:120,
title:""}]},{xtype:"tabpanel",flex:1.3,itemId:"TabPanels",reference:"TabPanels",items:[{xtype:"panel",itemId:"PresaInCaricoDati",reference:"PresaInCaricoDati",layout:{type:"hbox",align:"stretch"},border:0,bodyBorder:!1,title:"PRESA_IN_CARICO",items:[{xtype:"container",padding:10,flex:1,defaults:{labelWidth:120},layout:{type:"vbox",align:"stretch"},hidden:50==CBA.moduli.moduloAttivo,items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"datefield",margin:"0 30 5 0",itemId:"dataRichiestaRicovero",
reference:"dataRichiestaRicovero",width:230,labelWidth:120,fieldLabel:"DATA_RICHIESTA_RICOVERO",labelClsExtra:"cbaLabel",name:"dataRichiestaRicovero"},{xtype:"datefield",itemId:"dataRicezioneRichiesta",reference:"dataRicezioneRichiesta",width:210,labelWidth:100,fieldLabel:"DATA_RICEZIONE_RICHIESTA",labelClsExtra:"cbaLabel",name:"dataRicezioneRichiesta"}]},{xtype:"combobox",itemId:"idTipoProvenienza",reference:"idTipoProvenienza",fieldLabel:"TIPO_PROVENIENZA",labelClsExtra:"cbaLabel",name:"idTipoProvenienza",
hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.TipoProvenienza")},{xtype:"combobox",itemId:"idMotivoIngresso",reference:"idMotivoIngresso",labelClsExtra:"cbaLabel",fieldLabel:"MOTIVAZIONE_INGRESSO",name:"motivoIngresso",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.MotivoIngresso")},{xtype:"combobox",itemId:"idIniziativaRichiesta",reference:"idIniziativaRichiesta",
labelClsExtra:"cbaLabel",fieldLabel:"INIZIATIVA_RICHIESTA",name:"iniziativaRichiesta",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.IniziativaRichiesta")},{xtype:"combobox",itemId:"idTipoRicovero",reference:"idTipoRicovero",labelClsExtra:"cbaLabel",fieldLabel:"TIPO_RICOVERO",name:"tipoRicovero",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.TipoRicovero")},
{xtype:"combobox",itemId:"onereDegenza",reference:"onereDegenza",labelClsExtra:"cbaLabel",fieldLabel:"ONERE_DEGENZA",name:"onereDegenza",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.OnereDegenza")},{xtype:"combobox",itemId:"RegimeRicovero",reference:"RegimeRicovero",fieldLabel:"REGIME_RICOVERO",labelClsExtra:"cbaLabel",name:"regimeRicovero",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.RegimeRicovero"),
valueField:"codice"},{xtype:"combobox",itemId:"ClassePriorita",reference:"ClassePriorita",fieldLabel:"CLASSE_PRIORITA",labelClsExtra:"cbaLabel",name:"classePrioritaria",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.ClassePriorita")},{xtype:"container",margin:"3 0 0 0",itemId:"ResponsabileRicovero",reference:"ResponsabileRicovero",layout:{type:"hbox",align:"middle"},items:[{xtype:"textfield",itemId:"ResponsabileRicoveroTxt",reference:"ResponsabileRicoveroTxt",
labelWidth:120,flex:1,labelClsExtra:"cbaLabel",fieldLabel:"RESPONSABILE_RICOVERO",name:"responsabileRicovero"},{xtype:"button",margin:"0 0 0 3",itemId:"ResponsabileRicoveroBtn",reference:"ResponsabileRicoveroBtn",iconCls:"icon-doctor20",width:25,tooltip:"RESPONSABILE_RICOVERO_TOOLTIP"}]}]},{xtype:"container",flex:1,padding:10,defaults:{labelWidth:120},layout:{type:"vbox",align:"stretch"},items:[{xtype:"htmleditor",border:0,height:70,itemId:"DiagnosiIngresso",reference:"DiagnosiIngresso",hidden:!0,
labelClsExtra:"cbaLabel",fieldLabel:"DIAGNOSI_INGRESSO",name:"diagnosiIngresso",readOnly:!0},Ext.create("GeneraliOSP.icd9.view.icd9",{itemId:"CntIdc9",labelWidthIcd9:120,reference:"CntIdc9",hidden:!0,margin:"0 0 5 0"}),{xtype:"combobox",hidden:!0,itemId:"MedicoInviante",reference:"MedicoInviante",fieldLabel:"MEDICO_INVIANTE",labelClsExtra:"cbaLabel",name:"medicoInviante",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"container",layout:{type:"hbox",align:"middle"},
items:[{xtype:"combobox",itemId:"MedicoMedGen",reference:"MedicoMedGen",flex:1,labelWidth:120,fieldLabel:"MEDICO_MEDICINA_GEN",labelClsExtra:"cbaLabel",name:"idMedicoMMG",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"button",margin:"0 0 0 3",itemId:"BtnMedico",reference:"BtnMedico",iconCls:"icon-doctor20",width:25,tooltip:"TT_MEDICO_MEDICINA_GEN"}]}]}]},{xtype:"container",itemId:"tabDatiCont",reference:"tabDatiCont",title:"DATI_CONT",iconCls:"icon-calculator_black",
layout:{type:"fit"},items:[{xtype:"container",flex:1,layout:{type:"vbox"},margin:"0 0 10 10",items:[{xtype:"textfield",itemId:"codiceRid",reference:"codiceRid",margin:"10 0 5 0",width:470,fieldLabel:"RID",labelWidth:30,labelClsExtra:"cbaLabel",name:"codiceRid",maxLength:35,enforceMaxLength:!0},{xtype:"fieldset",itemId:"parametriRette",reference:"parametriRette",margin:0,title:"DATI_CONT",flex:1,layout:{type:"vbox",flex:1},items:[{xtype:"container",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"combobox",
itemId:"CBCapitolo",reference:"CBCapitolo",fieldLabel:"CAPITOLO",labelClsExtra:"cbaLabel",labelWidth:100,name:"capitolo",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("Generali.store.Capitolo")},{xtype:"numberfield",hidden:!0,name:"annoConto"}]},{xtype:"container",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"combobox",width:340,fieldLabel:"CONTO",itemId:"CBConto",reference:"CBConto",labelClsExtra:"cbaLabel",name:"conto",displayField:"valore",queryMode:"local",
valueField:"codice",hidden:!1,store:Ext.create("Generali.store.Conto",{autoDestroy:!1})},{xtype:"button",margin:"0 0 0 5",cls:"btnLarge",itemId:"BtnPriorita",reference:"BtnPriorita",iconCls:"icon-info",scale:"medium",tooltip:""}]},{xtype:"combobox",itemId:"CBArticolo",reference:"CBArticolo",fieldLabel:"ARTICOLO",labelClsExtra:"cbaLabel",name:"articolo",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("Generali.store.Articolo")},{xtype:"cda",annoData:"annoCda",labelWidth:100,
width:450,margin:"0 0 0 0",showDesCda:!1,hideAnno:!1,itemId:"cntCda",reference:"cntCda",cbaConfig:{tipoContabilita:4}},{xtype:"combobox",itemId:"CBForzaParamContabili",reference:"CBForzaParamContabili",width:340,fieldLabel:"FORZA_PARAM_CONTABILI",labelClsExtra:"cbaLabel",name:"forzaParamContabili",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("GeneraliOSP.store.ForzaParamContabili",{filters:[function(b){return 3!=b.data.codice}]})},{xtype:"textfield",hidden:!0,itemId:"idParametriRette",
reference:"idParametriRette",fieldLabel:"idParametriRette",name:"idParametriRette"},{xtype:"textfield",hidden:!0,itemId:"idParametriContabilita",reference:"idParametriContabilita",fieldLabel:"idParametriContabilita",name:"idParametriContabilita"},{xtype:"numberfield",hidden:!0,name:"idEsercizio"}]}]}]},{xtype:"container",itemId:"tabAltreInfo",reference:"tabAltreInfo",iconCls:"icon-info_black",title:"ALTRE_INFO",scrollable:!0,layout:"vbox",items:[{xtype:"textfield",margin:"10 0 0 10",fieldLabel:"CODICE_BIANCHERIA",
width:470,labelWidth:110,labelClsExtra:"cbaLabel",itemId:"codBiancheria",reference:"codBiancheria",name:"codBiancheria",maxLength:20,enforceMaxLength:!0,hidden:50==CBA.moduli.moduloAttivo},{xtype:"container",width:"100%",margin:"20 10 2 10",itemId:"rendLomb",reference:"rendLomb",layout:{type:"column"},hidden:!0,defaults:{margin:"0 5 0 0"},items:[{xtype:"fieldset",title:"REND_LOMB",layout:"vbox",padding:5,columnWidth:.5,items:[{xtype:"numberfield",itemId:"ggMax",reference:"ggMax",width:450,labelWidth:325,
fieldLabel:"GG_ASS_MAX",labelClsExtra:"cbaLabel",name:"ggAssenzaMax",allowDecimals:!1},{xtype:"label",text:"SOSIA1",itemId:"DatiSosia1",reference:"DatiSosia1",margin:"20 0 0 0",width:450,style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"combobox",itemId:"cbRicoveroColl",reference:"cbRicoveroColl",fieldLabel:"FASCICOLO_COLLEGATO",width:450,labelWidth:137,labelClsExtra:"cbaLabel",name:"idRicoveroCollegato",displayField:"valoreDesc",queryMode:"local",valueField:"codice"},{xtype:"checkboxfield",
itemId:"cbSollievo",reference:"cbSollievo",fieldLabel:"PRESTAZIONE_SOLL",width:230,labelWidth:135,labelClsExtra:"cbaLabel",name:"postoSollievo",boxLabel:"",inputValue:"T"}]},{xtype:"fieldset",itemId:"FsSosiaLomb",reference:"FsSosiaLomb",title:CBA.StdUtenti?CBA.StdUtenti.getFlussoRegionaleDesc(7):"",columnWidth:.5,layout:{type:"vbox",align:"stretch"},padding:5,items:[{xtype:"combobox",itemId:"CbSituazionePensionistica",reference:"CbSituazionePensionistica",fieldLabel:"FR_SITUAZIONE_PENSIONISTICA",
labelWidth:145,labelClsExtra:"cbaLabel",name:"sosiaSituazionePens",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"combobox",itemId:"CbProfessioneIngresso",reference:"CbProfessioneIngresso",fieldLabel:"FR_PROFESSIONE_INGRESSO",labelWidth:145,labelClsExtra:"cbaLabel",name:"sosiaProfessione",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"datefield",itemId:"CbDataEventoIndiceSv",reference:"CbDataEventoIndiceSv",labelWidth:145,
fieldLabel:"FR_DATA_EVENTO_INDICE_SV",labelClsExtra:"cbaLabel",name:"dataEventoIndice"}]}]},{xtype:"container",margin:"10 10 10 10",itemId:"cntAlunni",reference:"cntAlunni",layout:{type:"vbox"},hidden:50!=CBA.moduli.moduloAttivo,items:[{xtype:"checkboxfield",fieldLabel:"TEMPO_ANTICIPATO",labelWidth:110,inputValue:"T",uncheckedValue:"F",name:"orarioAnticipato",itemId:"orarioAnticipato",reference:"orarioAnticipato"},{xtype:"checkboxfield",fieldLabel:"TEMPO_PROLUNGATO",labelWidth:110,inputValue:"T",
uncheckedValue:"F",name:"orarioProlungato",itemId:"orarioProlungato",reference:"orarioProlungato"},{xtype:"checkboxfield",fieldLabel:"TRASPORTO",labelWidth:110,inputValue:"T",uncheckedValue:"F",name:"trasporto",itemId:"trasporto",reference:"trasporto"},{xtype:"checkboxfield",fieldLabel:"ULTIMO_ANNO",labelWidth:110,inputValue:"T",uncheckedValue:"F",name:"ultimoAnno",itemId:"ultimoAnno",reference:"ultimoAnno",cls:"cbaLabel",hidden:!0},{xtype:"checkboxfield",fieldLabel:"VACCINAZIONI",labelWidth:110,
inputValue:"T",uncheckedValue:"F",name:"vaccinazioni",itemId:"vaccinazioni",reference:"vaccinazioni"}]}]},{xtype:"container",itemId:"TabNote",reference:"TabNote",title:"NOTE",iconCls:"icon-circolari",layout:{type:"hbox",align:"stretch"},defaults:{padding:10},items:[{xtype:"htmleditor",flex:1,itemId:"NotePresaInCarico",reference:"NotePresaInCarico",fieldLabel:"NOTE_PRESAINCARICO",labelAlign:"top",labelClsExtra:"cbaLabel",name:"notePresaInCarico"},{xtype:"htmleditor",labelAlign:"top",fieldLabel:"NOTE_DIM",
itemId:"NoteDimissione",reference:"NoteDimissione",flex:1,labelClsExtra:"cbaLabel",name:"descrDimissione"}]},{xtype:"container",itemId:"tabPers",reference:"tabPers",title:"CAMPI_PERSONALIZZATI",iconCls:"icon-hamburger",layout:{type:"fit"},items:[{xtype:"label",text:"NO_CAMPI_PERSONALIZZATI",itemId:"noCamp",reference:"noCamp",margin:"90 5 10 130",style:"font-size: 15px;color: #CCC;",hidden:!0},{xtype:"fieldset",flex:1,margin:10,padding:5,itemId:"CntCampiPers",reference:"CntCampiPers",layout:{align:"stretch",
type:"vbox"},title:"CAMPI_PERSONALIZZATI"}]},{xtype:"container",itemId:"TabProroghe",reference:"TabProroghe",hidden:!0,title:"PROGNOSI_PROROGHE",layout:{type:"vbox"},padding:10,items:[{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",itemId:"GiorniPrognosi",reference:"GiorniPrognosi",fieldLabel:"GIORNI_PROGNOSI",labelClsExtra:"cbaLabel",labelWidth:150,width:250,name:"ggPrognosi",allowDecimals:!1,minValue:0},{xtype:"label",itemId:"LbGiorniPrognosi",reference:"LbGiorniPrognosi",
margin:"0 0 0 5"}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"displayfield",itemId:"DataDimissionePrevista",reference:"DataDimissionePrevista",margin:"3 0 0 0",width:250,labelWidth:150,fieldLabel:"DATA_SCADENZA",labelClsExtra:"cbaLabel",name:"dataDimissionePrevista",renderer:function(b,c){return b?FormattaData(b):""}},{xtype:"displayfield",itemId:"DataDimissionePrevistaMedica",reference:"DataDimissionePrevistaMedica",margin:"3 0 0 0",width:300,labelWidth:200,fieldLabel:"PREVISTA_DIMISSIONE_MEDICA",
labelClsExtra:"cbaLabel",name:"dataDimissionePrevistaMedica",renderer:function(b,c){return b?FormattaData(b):""}}]},{xtype:"numberfield",hidden:!0,name:"idGGPrognosi"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditServiziCSS",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"EditServizi",reference:"EditServizi",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{style:{"background-color":"transparent"},items:[{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,margin:b?"2 8 0 0":null,title:""},{xtype:"form",flex:1,region:"center",border:0,itemId:"Form",
reference:"Form",layout:{type:"vbox"},bodyPadding:10,title:"",cls:b?"css-form-label-blue":null,margin:b?"20 0 0 0":null,trackResetOnLoad:!0,items:[{xtype:"container",margin:"0 0 5 0",width:450,defaults:{margin:{top:0,right:10,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"ServizioDataDal",reference:"ServizioDataDal",width:210,fieldLabel:"DATA_INIZIO",labelClsExtra:"cbaLabel",name:"dal",allowBlank:!1,maxValue:b?null:CBA.moduli.modulo49.serverDate},{xtype:"timefield",validator:function(b){return!0},
itemId:"servizioOraIngresso",reference:"servizioOraIngresso",width:140,fieldLabel:"ORA_INIZIO",labelClsExtra:"cbaLabel",labelWidth:85,name:"oraInizio",value:"08:00",allowBlank:!1,format:"H:i",increment:30}]},{xtype:"container",margin:"0 0 5 0",width:600,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"recordId",reference:"recordId",name:"id",hidden:!0},{xtype:"textfield",name:"idRicoveroCU",hidden:!0},{xtype:"textfield",name:"statoArchiviazione",
hidden:!0},{xtype:"textfield",hidden:!0,itemId:"EditServiziRecordId",reference:"EditServiziRecordId",fieldLabel:"id",name:"idRicovero"},{xtype:"combobox",itemId:"tipoServizio",reference:"tipoServizio",width:360,fieldLabel:"TIPOLOGIA_CARTELLA",labelClsExtra:"cbaLabel",name:"idProfilo",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("CS.store.ProfiliCssRegole"),valueField:"codice"}]},{xtype:"container",itemId:"cntLettiCitt",reference:"cntLettiCitt",margin:"0 0 5 0",
width:450,defaults:{margin:{top:0,right:10,bottom:0,left:0}},layout:{type:"vbox"},items:[{xtype:"combobox",itemId:"rispostaAggRicoveri",reference:"rispostaAggRicoveri",width:300,fieldLabel:"CATEGORIA",labelClsExtra:"cbaLabel",name:"idSwEsterni",allowBlank:!1,displayField:"extra",store:Ext.create("CS.profili.associazioni.store.rispAggRic"),valueField:"valore"},{xtype:"combobox",itemId:"editResSede",reference:"editResSede",hidden:!0,width:400,fieldLabel:"SEDE",labelClsExtra:"cbaLabel",name:"idSede",
displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Sedi"),valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i>{valore}</i></div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"combobox",itemId:"editResReparto",reference:"editResReparto",width:400,margin:"5 0 5 0",fieldLabel:"REPARTO",labelClsExtra:"cbaLabel",name:"idReparto",allowBlank:!1,displayField:"valore",
queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Reparti"),valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i>{valore}</i></div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"combobox",itemId:"editResStanza",reference:"editResStanza",width:400,margin:"5 0 5 0",fieldLabel:"STANZA",allowBlank:!1,labelClsExtra:"cbaLabel",name:"idStanza",displayField:"valore",queryMode:"local",
store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Stanze"),valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i>{valore}</i></div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"combobox",itemId:"editResLetti",reference:"editResLetti",width:200,margin:"5 0 5 0",fieldLabel:"LETTO",labelClsExtra:"cbaLabel",name:"idLetto",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Letti"),
valueField:"codice",matchFieldWidth:!1,listConfig:{width:300},tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i>{valore}</i></div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>"),hidden:50==CBA.moduli.moduloAttivo}]},{xtype:"container",itemId:"CntFine",reference:"CntFine",margin:"0 0 5 0",width:450,defaults:{margin:{top:0,right:10,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"servizioDataAl",
reference:"servizioDataAl",width:210,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",name:"al"},{xtype:"timefield",validator:function(b){return!0},itemId:"servizioOraUscita",reference:"servizioOraUscita",width:140,fieldLabel:"ORA_FINE",labelClsExtra:"cbaLabel",labelWidth:85,name:"oraFine",format:"H:i",increment:30}]}]},{xtype:"panel",region:"west",width:210,layout:{type:"fit"},title:"TIPOLOGIE_ELENCO",itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridServizi",
reference:"StoricoGridServizi",title:"",store:Ext.create("CS.profili.associazioni.store.Ricoveri"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"dal",text:"DATA_INIZIO",flex:1,format:"d/m/Y"},{xtype:"datecolumn",dataIndex:"al",text:"DATA_FINE",flex:1,format:"d/m/Y"}]}]},{xtype:"panel",region:"south",hidden:!0,title:"DATI_AGGIUNTIVI",itemId:"ContainerAdt",reference:"ContainerAdt",margin:"20",flex:1,layout:{type:"fit"},items:[{xtype:"gridpanel",border:0,itemId:"GridAdt",reference:"GridAdt",
store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Adt"),viewConfig:{loadMask:!1},emptyText:traduci("NESSUN_DATO_PRESENTE"),columns:[{xtype:"gridcolumn",dataIndex:"extra",text:"DATO",flex:1},{xtype:"gridcolumn",dataIndex:"valore",text:"VALORE",flex:1}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditServiziV1",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"EditServizi",reference:"EditServizi",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{style:{"background-color":"transparent"},items:[{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,margin:b?"2 8 0 0":null,title:""},{xtype:"form",flex:1,region:"center",border:0,itemId:"Form",
reference:"Form",layout:{type:"vbox"},bodyPadding:10,title:"",cls:b?"css-form-label-blue":null,margin:b?"20 0 0 0":null,trackResetOnLoad:!0,items:[{xtype:"container",margin:"0 0 5 0",width:450,defaults:{margin:{top:0,right:10,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"ServizioDataDal",reference:"ServizioDataDal",width:210,fieldLabel:"DATA_INIZIO",labelClsExtra:"cbaLabel",name:"dal",allowBlank:!1,maxValue:b?null:CBA.moduli.modulo49.serverDate},{xtype:"timefield",validator:function(b){return!0},
itemId:"servizioOraIngresso",reference:"servizioOraIngresso",width:140,fieldLabel:"ORA_INIZIO",labelClsExtra:"cbaLabel",labelWidth:85,name:"oraInizio",value:"08:00",allowBlank:!1,format:"H:i",increment:30}]},{xtype:"container",margin:"0 0 5 0",width:600,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"recordId",reference:"recordId",name:"id",hidden:!0},{xtype:"textfield",name:"idRicoveroCU",itemId:"idRicoveroCU",reference:"idRicoveroCU",hidden:!0},
{xtype:"textfield",name:"statoArchiviazione",hidden:!0},{xtype:"textfield",hidden:!0,itemId:"EditServiziRecordId",reference:"EditServiziRecordId",fieldLabel:"id",name:"idRicovero"},{xtype:"combobox",itemId:"tipoServizio",reference:"tipoServizio",width:360,fieldLabel:"TIPOLOGIA",labelClsExtra:"cbaLabel",name:"idProfilo",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("CS.store.ProfiliCssRegole"),valueField:"codice"},{xtype:"container",margin:"0 0 0 0",hidden:!0,
itemId:"CntPsiche",reference:"CntPsiche",items:[{xtype:"textfield",itemId:"TxtCodicePsiche",reference:"TxtCodicePsiche",width:180,name:"codicePsiche",labelClsExtra:"cbaCssLabel",fieldLabel:"CODICE_PSICHE"}]}]},{xtype:"container",itemId:"CntFine",reference:"CntFine",margin:"0 0 5 0",width:450,defaults:{margin:{top:0,right:10,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"servizioDataAl",reference:"servizioDataAl",width:210,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",name:"al"},
{xtype:"timefield",validator:function(b){return!0},itemId:"servizioOraUscita",reference:"servizioOraUscita",width:140,fieldLabel:"ORA_FINE",labelClsExtra:"cbaLabel",labelWidth:85,name:"oraFine",format:"H:i",increment:30}]},{xtype:"combobox",margin:"0 0 5 0",itemId:"motivoDimissioneCu2",reference:"motivoDimissioneCu2",hidden:!0,width:"100%",fieldLabel:"MOTIVI_DIM",labelClsExtra:"cbaLabel",name:"motivoDimissioneCu2",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.MotivoDimissione"),
valueField:"codice"},{xtype:"container",itemId:"CntNosologico",reference:"CntNosologico",margin:"20 0 0 0",hidden:!0,layout:"vbox",items:[{xtype:"fieldset",title:"NOSOLOGICO",itemId:"FsNosologico",reference:"FsNosologico",padding:20,width:350,layout:"vbox",items:[{xtype:"numberfield",itemId:"NfNosologico",reference:"NfNosologico",name:"nosologico",allowDecimals:!1,labelWidth:120,width:180,useThousandSeparator:!1,fieldLabel:"Num. Nosologico"},{xtype:"container",layout:"hbox",items:[{xtype:"label",
text:traduci("NOSOLOGICO")+":",cls:"cbaCssLabel",margin:"10 0 0 0"},{xtype:"label",itemId:"LblNosologico",reference:"LblNosologico",margin:"10 0 0 15",cls:"cbaCssLabel",style:{fontWeight:"bold",fontSize:"initial"}}]}]}]},{xtype:"container",itemId:"CntRiscAutoptico",reference:"CntRiscAutoptico",margin:"20 0 0 0",hidden:!0,layout:"vbox",items:[{xtype:"checkbox",itemId:"ChkRiscAutoptico",reference:"ChkRiscAutoptico",name:"riscontroAutoptico",boxLabel:"RISCONTRO_AUTOPTICO",isFormField:!1,inputValue:"T",
uncheckedValue:"F",margin:"0 10 0 0"}]}]},{xtype:"panel",region:"west",width:210,layout:{type:"fit"},title:"TIPOLOGIE_ELENCO",itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridServizi",reference:"StoricoGridServizi",title:"",store:Ext.create("CS.profili.associazioni.store.Ricoveri"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"dal",text:"DATA_INIZIO",flex:1,format:"d/m/Y"},{xtype:"datecolumn",dataIndex:"al",text:"DATA_FINE",flex:1,format:"d/m/Y"}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditStoricoInfoUtente",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"EditStoricoInfoUtente",reference:"EditStoricoInfoUtente",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){var b=this,c=49===CBA.moduli.moduloAttivo;Ext.applyIf(b,{style:{"background-color":"transparent"},items:[{xtype:"panel",region:"east",itemId:"BoxBottoni",reference:"BoxBottoni",width:c?"auto":120,margin:c?"3 2 0 0":null,title:""},{xtype:"form",
flex:1,region:"center",border:0,itemId:"Form",reference:"Form",layout:{type:"vbox"},cls:c?"css-form-label-blue":null,bodyPadding:10,title:"",margin:c?"25 0 0 0":null,trackResetOnLoad:!0,items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",width:c?300:210,fieldLabel:"DATA_INIZIO",labelClsExtra:"cbaLabel",name:"dal",allowBlank:!1},{xtype:"container",margin:"0 0 5 0",width:600,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"RecordId",
reference:"RecordId",name:"id",hidden:!0},{xtype:"textfield",validator:function(c){var d=!0;1==b.cbaConfig.tipo&&(d=ControllaCF(c));return d},itemId:"Descrizione",reference:"Descrizione",width:300,fieldLabel:"",labelClsExtra:"cbaLabel",name:"descrizione",allowBlank:!1,enforceMaxLength:!0,maxLength:16}]},{xtype:"fieldset",width:480,flex:1,layout:{type:"vbox"},title:"NOTE",items:[{xtype:"htmleditor",itemId:"Note",reference:"Note",flex:1,width:468,labelAlign:"top",name:"note"}]}]},{xtype:"panel",region:"west",
width:210,layout:{type:"fit"},title:"COD_ELENCO",itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGrid",reference:"StoricoGrid",title:"",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.StoricoInfoUtente"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"dal",text:"DATA_INIZIO",flex:1,format:"d/m/Y"}],selModel:Ext.create("Ext.selection.RowModel",{})}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.EditUlterioriDati",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",autoScroll:!0,flex:1,border:0,itemId:"Form",reference:"Form",trackResetOnLoad:!0,scrollable:!1,cls:49===CBA.moduli.moduloAttivo?"css-form-label-blue":null,items:[{xtype:"container",border:0,height:465,defaults:{margin:{top:5,
right:5,bottom:0,left:5}},layout:{type:"hbox"},items:[{xtype:"fieldset",title:"ULTERIORI_DATI",height:390,margin:"10 5 0 5",flex:1,itemId:"controllerUlt",reference:"controllerUlt",layout:{type:"vbox",align:"stretch"},title:"ULTERIORI_DATI",items:[{xtype:"textfield",itemId:"aCodReg",reference:"aCodReg",width:300,fieldLabel:"COD_REG",labelClsExtra:"cbaLabel",name:"codiceRegionale",maxLength:12,enforceMaxLength:!0},{xtype:"combobox",itemId:"aCodDistretto",reference:"aCodDistretto",width:300,forceSelection:!0,
autoSelect:!1,fieldLabel:"COD_DIST",labelClsExtra:"cbaLabel",name:"codiceDistretto",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Distretti")},{xtype:"textfield",itemId:"aMaternita",reference:"aMaternita",width:300,fieldLabel:"MATERNITA",labelClsExtra:"cbaLabel",name:"maternita",maxLength:40,enforceMaxLength:!0},{xtype:"textfield",itemId:"aPaternita",reference:"aPaternita",width:300,fieldLabel:"PATERNITA",labelClsExtra:"cbaLabel",name:"paternita",
maxLength:40,enforceMaxLength:!0},{xtype:"textfield",itemId:"aVedovoDi",reference:"aVedovoDi",width:300,fieldLabel:"VEDOVO_DI",labelClsExtra:"cbaLabel",name:"vedovoDi",maxLength:40,enforceMaxLength:!0,hidden:50==CBA.moduli.moduloAttivo},{xtype:"textfield",itemId:"aCognomeAcquisito",reference:"aCognomeAcquisito",width:300,fieldLabel:"COGNOME_ACQ",labelClsExtra:"cbaLabel",name:"cognomeAcquisito",maxLength:40,enforceMaxLength:!0,hidden:50==CBA.moduli.moduloAttivo},{xtype:"textfield",itemId:"aConiugatoCon",
reference:"aConiugatoCon",width:300,fieldLabel:"CONIUNGATO_CON",labelClsExtra:"cbaLabel",name:"coniugatoCon",maxLength:40,enforceMaxLength:!0,hidden:50==CBA.moduli.moduloAttivo},{xtype:"textfield",itemId:"aTestamento",reference:"aTestamento",width:300,fieldLabel:"TESTAMENTO_DEP",labelClsExtra:"cbaLabel",name:"testamento",maxLength:12,enforceMaxLength:!0,hidden:50==CBA.moduli.moduloAttivo},{xtype:"textfield",itemId:"aTelefono1",reference:"aTelefono1",width:300,fieldLabel:"TELEFONO1",labelClsExtra:"cbaLabel",
name:"telefono1",maskRe:/[0-9]/,maxLength:15,enforceMaxLength:!0},{xtype:"textfield",itemId:"aTelefono2",reference:"aTelefono2",width:300,fieldLabel:"TELEFONO2",labelClsExtra:"cbaLabel",name:"telefono2",maskRe:/[0-9]/,maxLength:15,enforceMaxLength:!0},{xtype:"textfield",itemId:"aEmail",reference:"aEmail",width:300,fieldLabel:"EMAIL",labelClsExtra:"cbaLabel",name:"email",maxLength:50,enforceMaxLength:!0}]},{xtype:"fieldset",padding:"0 8 8 8",layout:{align:"stretch",type:"vbox"},itemId:"CntCampiPers",
reference:"CntCampiPers",flex:1,title:"CAMPI_PERSONALIZZATI",hidden:!0}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",margin:"0 0 35 0",position:"bottom",hidden:!1}]}]});this.callParent(arguments)}});Ext.define("GeneraliOSP.fascicoloNoApp.view.Fascicolo",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:"fit"}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.Frontespizio",{extend:"CbaUtils.componenti.all.PanelAttivaFunzioniCBA",messaggioAttivazione:"EXPORT_MSG_ATTIVAZIONE",nomeFunzioneDaAttivare:"FRONTESPIZIO",codiceFunzione:"CU_FRONTESP",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"datefield",itemId:"dataStampa",
reference:"dataStampa",width:210,fieldLabel:"Data di stampa",labelClsExtra:"cbaLabel",name:"dataStampa",allowBlank:!1},{xtype:"fieldset",title:"Tipo Stampa",itemId:"fieldSetTipo",reference:"fieldSetTipo",flex:1,hidden:!0,items:[{xtype:"radiogroup",columns:2,vertical:!0,allowBlank:!1,items:[{boxLabel:"standard",name:"tipoFronteSpizio",cls:"cbaLabel",inputValue:1,checked:!0},{boxLabel:"ambulatoriale",name:"tipoFronteSpizio",margin:"0 0 0 5",cls:"cbaLabel",inputValue:2,checked:!1}]}]},{xtype:"fieldset",
title:"Esponi su campo data accettazione",flex:1,items:[{xtype:"radiogroup",columns:1,vertical:!0,allowBlank:!1,items:[{boxLabel:"data ingresso",name:"esponiSuAccettazione",cls:"cbaLabel",inputValue:"T",checked:!1},{boxLabel:"ultimo cambio classificazione alla data di stampa",name:"esponiSuAccettazione",cls:"cbaLabel",inputValue:"F",checked:!1}]}]},{xtype:"fieldset",title:"Esponi come campi descrizione",itemId:"fieldSetDescrizioni",reference:"fieldSetDescrizioni",hidden:!0,flex:1,items:[{xtype:"textfield",
itemId:"descrizione1",reference:"descrizione1",fieldLabel:"",labelWidth:30,labelClsExtra:"cbaLabel",name:"descrizione1",hidden:!0},{xtype:"textfield",itemId:"descrizione2",reference:"descrizione2",fieldLabel:"",labelWidth:30,labelClsExtra:"cbaLabel",name:"descrizione2",hidden:!0},{xtype:"textfield",itemId:"vailate",reference:"vailate",labelClsExtra:"cbaLabel",name:"vailate",hidden:!0}]},{xtype:"container",itemId:"boxBottoni",reference:"boxBottoni"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.ImportRicoveroCss",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"middle"},items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox",align:"stretch"},padding:5,margin:"60 0 0 10",items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"container",layout:{type:"hbox",align:"middle"},margin:"0 0 20 0",items:[{xtype:"label",html:'<strong><div style="font-size: 15px">'+
traduci("DATA_FINE_RIC_PREC")+":</div></strong>",cls:"cbaCssLabel",margin:"0 5 0 0"},{xtype:"label",itemId:"DataUltimoRicovero",reference:"DataUltimoRicovero",cls:"cbaCssLabel"}]},{xtype:"container",itemId:"CntCheck",reference:"CntCheck",layout:{type:"vbox",align:"stretch"},items:[]},{xtype:"container",layout:{type:"vbox",align:"middle"},items:[{xtype:"button",itemId:"BtnImporta",reference:"BtnImporta",text:"IMPORTA",cls:"cbaCssBtnFunzione-special",maxWidth:120,margin:"20 0 0 0",disabled:!0}]}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.LettiLiberi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,itemId:"LettiLiberi",reference:"LettiLiberi",layout:{type:"border"},items:[{xtype:"form",region:"center",border:0,itemId:"form",reference:"form",layout:{type:"border"},items:[{xtype:"panel",region:"west",border:0,width:200,layout:{align:"stretch",type:"vbox"},bodyPadding:10,title:"",items:[{xtype:"fieldset",layout:{align:"stretch",
type:"vbox"},title:"RICERCA_PER",items:[{xtype:"radiogroup",itemId:"rdgStanze",reference:"rdgStanze",columns:1,items:[{xtype:"radiofield",name:"stanze",boxLabel:"TUTTE_STANZE",inputValue:"0"},{xtype:"radiofield",name:"stanze",boxLabel:"ADIBITE_A_UTENTI",checked:!0,inputValue:"1"},{xtype:"container",itemId:"ckgSesso",reference:"ckgSesso",margin:"0 0 0 20",items:[{xtype:"checkboxfield",itemId:"F",reference:"F",boxLabel:"ADIBITA_A_F",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",
itemId:"M",reference:"M",boxLabel:"ADIBITA_A_M",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"C",reference:"C",boxLabel:"ADIBITA_A_C",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"G",reference:"G",boxLabel:"ADIBITA_A_G",checked:!0,inputValue:"T",uncheckedValue:"F"}]}]},{xtype:"checkboxfield",itemId:"CbxSoloLiberi",reference:"CbxSoloLiberi",boxLabel:"STP_SOLO_LIBERE",checked:!0,inputValue:"T",uncheckedValue:"F"}]},{xtype:"container",flex:1,
layout:{type:"vbox"},items:[{xtype:"button",cls:"btnLarge",itemId:"cerca",reference:"cerca",iconCls:"icon-ricerca",scale:"large",text:"CERCA"}]}]},{xtype:"panel",region:"east",border:0,itemId:"boxBottoni",reference:"boxBottoni",width:150},{xtype:"treepanel",region:"center",border:1,store:Ext.create("GeneraliOSP.fascicoloNoApp.store.LettiLiberi"),flex:1,itemId:"TreeLettiLiberi",reference:"TreeLettiLiberi",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.ProrogheGrid",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"Grid",reference:"Grid",store:Ext.create("Generali.data.Store",{fields:[{name:"id"},{name:"dataDomanda",type:"date"},{name:"giorniRichiesti"},{name:"giorniAutorizzati"},{name:"allegato"},{name:"modificato"},{name:"idAllegato"},{name:"nomeFileAllegato"}]}),columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",
dataIndex:"allegato",hidden:!0},{xtype:"gridcolumn",dataIndex:"idAllegato",hidden:!0},{xtype:"gridcolumn",dataIndex:"modificato",hidden:!0},{xtype:"gridcolumn",dataIndex:"nomeFileAllegato",hidden:!0},{xtype:"datecolumn",align:"center",dataIndex:"dataDomanda",text:"DATA_DOMANDA",sortable:!1,format:"d/m/Y"},{xtype:"gridcolumn",align:"center",text:"GIORNI_RICHIESTI",dataIndex:"giorniRichiesti",sortable:!1},{xtype:"gridcolumn",align:"center",text:"GIORNI_AUTORIZZATI",dataIndex:"giorniAutorizzati",sortable:!1,
summaryType:"sum",summaryRenderer:function(b,c,d){return'<span class="cbaLabel">'+b+"</span>"},editor:{xtype:"numberfield",allowDecimals:!1,allowBlank:!1,minValue:0}},{xtype:"gridcolumn",align:"center",text:"ALLEGATO",dataIndex:"idAllegato",width:200,sortable:!1,editor:{xtype:"container",layout:"hbox",items:[{xtype:"filefield",width:80,cls:"cba-stdbutton-25",hideLabel:!0,name:"f_allegato",buttonConfig:{iconCls:"icon-upload",height:25},buttonOnly:!0,buttonText:traduci("ALLEGA")},{xtype:"button",hidden:!0,
itemId:"BtnElimina",margin:"0 0 5 0",cls:"cba-button-25",iconCls:"icon-elimina",text:traduci("ELIMINA")}]},renderer:function(b,c,d){var f=this;if(d.get("nomeFileAllegato")){var g=Ext.id();Ext.defer(function(){var b=Ext.get(g);b&&Ext.create("Ext.Img",{imgCls:"icon-allegato",width:16,listeners:{afterrender:function(b,c){var g=b.getEl();g.on("click",function(b,c,g){StdUtenti.isValidID(d.get("idAllegato"))&&stampaEsporta(f,{url:getUrlGen()+"/ws/genOsp/docs/attach/getFileRefById"+(CBA.moduli&&CBA.moduli.moduloAttivo&&
49===CBA.moduli.moduloAttivo?"Css":""),params:{idAllegato:d.get("idAllegato")},titolo:d.get("nomeFileAllegato")})});g&&!g.toolTip&&(g.toolTip=creaToolTip(g.id,d.get("nomeFileAllegato")))}}}).render(b,g)},50);return"<span id='"+g+"'></span>"}return""}}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],viewConfig:{loadMask:!1},features:[{ftype:"summary",dock:"bottom"}],dockedItems:[{xtype:"toolbar",hidden:!0,dock:"top",items:[{xtype:"button",itemId:"BtnSalva",reference:"BtnSalva",
disabled:!0,iconCls:"icon-ok",text:"CONFERMA"},{xtype:"button",itemId:"BtnRipristina",reference:"BtnRipristina",disabled:!0,iconCls:"icon-annulla16",text:"Ripristina"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.ResponsabileRicovero",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"ResponsabileRicovero",reference:"ResponsabileRicovero",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",region:"center",border:0,itemId:"RespRicForm",reference:"RespRicForm",layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"container",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"datefield",
itemId:"Data",reference:"Data",format:"d/m/Y",width:210,fieldLabel:"DATA",labelClsExtra:"cbaLabel",name:"data",allowBlank:!1},{xtype:"timefield",itemId:"Ora",reference:"Ora",margin:"0 0 0 60",width:80,fieldLabel:"ORA",labelClsExtra:"cbaLabel",labelWidth:30,name:"ora",allowBlank:!1,format:"H:i",increment:30}]},{xtype:"combobox",itemId:"CBOperatori",reference:"CBOperatori",width:350,fieldLabel:"RESPONSABILE_RICOVERO",labelClsExtra:"cbaLabel",name:"idOperatore",displayField:"valore",minChars:3,queryMode:"local",
queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Operatori"),valueField:"codice",allowBlank:!1},{xtype:"combobox",itemId:"CBStatoPIC",reference:"CBStatoPIC",width:350,fieldLabel:"STATO",labelClsExtra:"cbaLabel",name:"stato",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!1},{xtype:"textareafield",itemId:"Note",reference:"Note",name:"note",fieldLabel:"NOTE",labelClsExtra:"cbaLabel",labelAlign:"top",width:350,height:100},{xtype:"button",
iconCls:"icon-map",itemId:"BtnMap",reference:"BtnMap",text:"MAPPA_SHOW_ADDRESS",hidden:!0},{xtype:"textfield",itemId:"RecordId",reference:"RecordId",fieldLabel:"id",name:"id",hidden:!0},{xtype:"textfield",fieldLabel:"dataCambioStato",name:"dataCambioStato",hidden:!0},{xtype:"textfield",fieldLabel:"operatoreCambioStato",name:"operatoreCambioStato",hidden:!0}]},{xtype:"panel",region:"west",width:370,layout:{type:"fit"},title:"ELENCO",items:[{xtype:"gridpanel",border:0,itemId:"GridResponsabili",reference:"GridResponsabili",
title:"",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.ResponsabileRicovero"),columns:[{xtype:"datecolumn",width:105,dataIndex:"data",text:"DATA",format:"d/m/Y H:i"},{xtype:"gridcolumn",dataIndex:"desOperatore",text:"NOMINATIVO",flex:1},{xtype:"gridcolumn",dataIndex:"desStato",text:"STATO",width:90}],selModel:Ext.create("Ext.selection.RowModel",{}),viewConfig:{loadMask:!1}}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.WinLingue",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,padding:5,initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox",align:"stretch"},flex:1,bodyPadding:4,items:[{xtype:"combobox",itemId:"CbLingua",reference:"CbLingua",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Lingue"),
labelWidth:70,width:350,fieldLabel:"LINGUA",labelClsExtra:"cbaLabel",name:"lingua",displayField:"valore",valueField:"codice"},{xtype:"label",margin:"10 5 10 5",labelClsExtra:"cbaLabel",cls:"cbaCssLabel",text:"MSG_INFO_LINGUA_OSPITE"}]},{xtype:"container",layout:{type:"hbox",align:"middle"},padding:"0 0 5 10",items:[{xtype:b?"CSSButtonsPanel":"container",itemId:"ContainerButtons",reference:"ContainerButtons",layout:{type:"hbox",pack:"end"},flex:1,items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",
cls:b?"cbaCssBtnFunzione":null,text:"Conferma"},{xtype:"button",itemId:"BtnAnnulla",reference:"BtnAnnulla",cls:b?"cbaCssBtnFunzione":null,text:"Annulla"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",cls:b?"cbaCssBtnFunzione":null,text:"Esci"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.WinRaccordoServCuCss",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",cls:"cbaCssPnlPopup",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",itemId:"Panel",reference:"Panel",layout:{type:"vbox",align:"stretch"},bodyPadding:20,cls:"cbaCssLabel",flex:1,items:[{xtype:"combobox",itemId:"CbServiziEsterni",reference:"CbServiziEsterni",
displayField:"descIdEsterno",valueField:"idEsterno",queryMode:"local",allowBlank:!1,labelWidth:70,margin:"35 0 0 0",maxWidth:300}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"button",itemId:"BtnConfermaServizio",reference:"BtnConfermaServizio",text:traduci("CONFERMA"),cls:"cbaCssBtnFunzione",iconCls:"icon-ok"},{xtype:"button",itemId:"BtnAnnullaServizio",reference:"BtnAnnullaServizio",iconCls:"icon-elimina",cls:"cbaCssBtnFunzione",text:traduci("ANNULLA")}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.fascicoloNoApp.view.WinSincroRicoveroCollegato",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",cls:"cbaCssPnlPopup",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",itemId:"Panel",reference:"Panel",layout:{type:"vbox",align:"stretch"},bodyPadding:20,cls:"cbaCssLabel",flex:1,items:[{xtype:"combobox",itemId:"CbRicoveri",reference:"CbRicoveri",displayField:"descrizineFormatted",
valueField:"idRicovero",queryMode:"local",allowBlank:!1,fieldLabel:"Ricovero",labelWidth:75,margin:"50 0 0 0",maxWidth:320},{xtype:"combobox",margin:"5 0 0 0",itemId:"motivoDimissioneCu2",reference:"motivoDimissioneCu2",hidden:!0,width:"100%",labelWidth:75,maxWidth:320,fieldLabel:"MOTIVI_DIM_SHORT",name:"motivoDimissioneCu2",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.MotivoDimissione"),valueField:"codice"}],dockedItems:[{xtype:"toolbar",
dock:"bottom",items:[{xtype:"button",itemId:"BtnConfermaRicovero",reference:"BtnConfermaRicovero",text:traduci("CONFERMA"),cls:"cbaCssBtnFunzione",iconCls:"icon-ok"},{xtype:"button",itemId:"BtnAnnullaRicovero",reference:"BtnAnnullaRicovero",iconCls:"icon-elimina",cls:"cbaCssBtnFunzione",text:traduci("ANNULLA")}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.flussiRegionali.controller.AggiornaClassRegionali",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Attivi",selector:b+"#Attivi"},{ref:"GridUtenti",selector:b+"#GridUtenti"},{ref:"CntDownload",selector:b+"#CntDownload"},{ref:"TabPrincipale",selector:b+"#TabPrincipale"},{ref:"PageParametri",selector:b+"#PageParametri"},{ref:"PageUtenti",selector:b+"#PageUtenti"},{ref:"DataDal",selector:b+
"#DataDal"},{ref:"DataAl",selector:b+"#DataAl"},{ref:"BtnElabora",selector:b+"#BtnElabora"},{ref:"BtnAvanti",selector:b+"#BtnAvanti"},{ref:"BtnIndietro",selector:b+"#BtnIndietro"},{ref:"Anno",selector:b+"#Anno"},{ref:"MeseAl",selector:b+"#MeseAl"},{ref:"Mese",selector:b+"#Mese"},{ref:"GridClassiSosia",selector:b+"#GridClassiSosia"},{ref:"CBServizio",selector:b+"#CBServizio"}]);this.control(b+"#TabPrincipale",{beforetabchange:this.beforetChangeTabPrincipale,render:this.renderTabPrincipale});this.control(b+
"#BtnAvanti",{click:this.avanti});this.control(b+"#BtnIndietro",{click:this.indietro});this.control(b+"#BtnElabora",{click:this.elabora});this.control(b+"#GridClassiSosia",{selectionchange:this.selChangeClassiSosia});this.control(b+"#GridUtenti",{selectionchange:this.selChangeGridUtenti})},disabilitaClickTab:function(){var b=this.getTabPrincipale();b.items.each(function(c){if(!Ext.isDefined(c.tab.giaCreato))c.tab.on("click",function(){c.tab.giaCreato=!0;b.cambiaTab=!1})})},renderTabPrincipale:function(){this.disabilitaClickTab()},
beforetChangeTabPrincipale:function(b,c,d,f){return b.cambiaTab},selChangeClassiSosia:function(b,c,d){svuotaStore(this.getGridUtenti().getStore())},selChangeGridUtenti:function(b,c,d){this.getBtnElabora().setDisabled(0==c.length)},avanti:function(){this.naviga("next")},indietro:function(){this.naviga("prev")},naviga:function(b){var c=this.getTabPrincipale(),d=c.getLayout(),c=c.getActiveTab();this.getTabPrincipale().cambiaTab=!0;b&&(d[b](),this.getCntDownload().removeAll(),this.getCntDownload().hide(),
"next"==b&&c==this.getPageParametri()&&this.caricaUtenti());this.abilitaPulsanti(!0);return!0},abilitaPulsanti:function(b){var c=this.getTabPrincipale(),d=c.getLayout();b?(this.getBtnIndietro().setDisabled(!d.getPrev()),this.getBtnAvanti().setDisabled(!d.getNext()),this.getBtnElabora().setDisabled(c.getActiveTab()!=this.getPageUtenti())):(this.getBtnIndietro().setDisabled(!0),this.getBtnAvanti().setDisabled(!0))},caricaUtenti:function(){var b=this,c=b.getGridUtenti(),d=[],f=b.getDataDal(),g=b.getDataAl();
b.abilitaPulsanti(!1);var h=b.getGridClassiSosia().getSelectionModel().getSelection();Ext.each(h,function(b){d.push(b.get("codice"))});d=d.length==b.getGridClassiSosia().getStore().count()?"":d.toString();svuotaStore(c.getStore());c.getStore().clearFilter();inizioAttesa();c.getStore().load({params:{dataDal:f.getValue(),dataAl:g.getValue(),classiSosia:d,idServizio:Ext.isEmpty(b.getCBServizio().getValue())?-1:b.getCBServizio().getValue()},callback:function(d,f,g){g?Ext.isEmpty(d)?(b.getBtnElabora().setDisabled(!0),
msgShowWarning("","MSG_STAMPA_NESSUN_UTENTE")):(Ext.suspendLayouts(),c.getSelectionModel().selectAll(),b.getBtnElabora().setDisabled(!1),Ext.resumeLayouts()):msgShowError("",f.getError());fineAttesa()}})},elabora:function(){var b=this,c=[];this.getGridUtenti().getSelectionModel().getSelection().forEach(function(b){c.push(b.data)});b.getCntDownload().removeAll();b.getCntDownload().hide();Ext.Ajax.request({method:"POST",jsonData:c,url:"/cba/osp/co/ws/genOsp/fr/sosia/aggiornaClassificazioni",params:{},
success:function(c){c=Ext.JSON.decode(c.responseText);var d=[];if(c.success){var g=b.getCntDownload();g.removeAll();var h={};Ext.apply(h,{fileType:"xls",filePath:c.data.filePath});var k,l;k=h.fileType.toLowerCase();h=getPathServer()+h.filePath;l=h.split("\\").pop().split("/").pop();k=creaItemDownload("icon-"+k,h,l,l);g.add(k);g.show();titolo=traduci("MSG_SALVATAGGIO_DATI");msgAdd(d,c.message)}else titolo=traduci("MSG_ERRORI_TROVATI"),msgAddError(d,c.message);msgShow(titolo,d)}})},onLaunch:function(){var b=
this;b.getGridClassiSosia().getStore().filter("extra",/R/);b.getGridClassiSosia().getStore().filter("valore",/^CL[1-8]/);b.getGridClassiSosia().getStore().load({callback:function(c,d,f){f&&b.getGridClassiSosia().getSelectionModel().selectAll()}});ImpostaUrl([b.getCBServizio().getStore(),b.getGridUtenti().getStore()]);b.getCBServizio().getStore().filter(function(b){if((b=b.get("extra"))&&7==b.split(",")[2])return!0});b.getCBServizio().getStore().load({params:{type:getTipiServizio()},callback:function(c,
d,f){f?1==this.getCount()&&b.getCBServizio().setValue(this.getAt(0).get("codice")):msgShowError("",d.getError())}});b.naviga()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.flussiRegionali.controller.AggiornaTariffe",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:b+"#Container"},{ref:"CBServizio",selector:b+"#CBServizio"},{ref:"DataRilevazione",selector:b+"#DataRilevazione"},{ref:"BtnCerca",selector:b+"#BtnCerca"},{ref:"BtnElaboraTariffe",selector:b+"#BtnElaboraTariffe"},{ref:"GridClassRetta",selector:b+"#GridClassRetta"},{ref:"DataDecorrenza",
selector:b+"#DataDecorrenza"},{ref:"CheckSovrascrivi",selector:b+"#CheckSovrascrivi"},{ref:"BtnElaboraTariffe",selector:b+"#BtnElaboraTariffe"}]);this.control(b+"#BtnCerca",{click:this.onClickBtnCerca});this.control(b+"#GridClassRetta",{selectionchange:this.selectionChangeGridClassRetta});this.control(b+"#BtnElaboraTariffe",{click:this.onClickBtnElaboraTariffe})},selectionChangeGridClassRetta:function(b,c,d){this.getBtnElaboraTariffe().setDisabled(0==c.length)},onClickBtnElaboraTariffe:function(){var b=
this,c=[];this.getGridClassRetta().getSelectionModel().getSelection().forEach(function(b){b.data.quotaSocialeFatt=b.data.totaleRettaFatt;delete b.data.note;c.push(b.data)});Ext.Ajax.request({method:"POST",jsonData:c,url:"/cba/osp/co/ws/genOsp/fr/tariffe/aggiorna",params:{tipoFlusso:this.getCBServizio().getSelection().data.extra.split(",")[2],dataDecorrenza:this.getDataDecorrenza().getValue(),sovrascrivi:getBoolValue(this.getCheckSovrascrivi().getValue())},success:function(c){c=Ext.JSON.decode(c.responseText);
var d=[];c.success?(b.getGridClassRetta().getSelectionModel().deselectAll(),b.getBtnElaboraTariffe().setDisabled(!0),titolo=traduci("MSG_SALVATAGGIO_DATI"),msgAdd(d,c.message)):(titolo=traduci("MSG_ERRORI_TROVATI"),msgAddError(d,c.message));msgShow(titolo,d)}})},onClickBtnCerca:function(){if(Ext.isEmpty(this.getCBServizio().getValue()))return this.getCBServizio().validate(),Messaggio("RICERCA","SELEZIONARE_SERVIZIO","OK","WARNING"),!1;this.getGridClassRetta().getStore().load({params:{idServizio:this.getCBServizio().getValue(),
data:this.getDataRilevazione().getValue()},callback:function(b,c,d){d||msgShowError("",c.getError())}})},onLaunch:function(){var b=this;ImpostaUrl([b.getCBServizio().getStore(),b.getGridClassRetta().getStore()]);b.getCBServizio().getStore().load({params:{type:getTipiServizio()},callback:function(c,d,f){f?(this.filter({filterFn:function(b){return 7==b.data.extra.split(",")[2]||9==b.data.extra.split(",")[2]?!0:!1}}),0==this.getCount()?Messaggio("ATTENZIONE","FR_AGGIORNATARIFFE_KO","OK","INFO"):1==this.getCount()&&
b.getCBServizio().setValue(this.getAt(0).get("codice"))):msgShowError("",d.getError())}});this.cbaConfig.puoiChiudere=function(){return!0}},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.flussiRegionali.controller.ElaboraTracciato",{extend:"Generali.standard.stampe.Controller",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);CBA.StdUtenti&&CBA.StdUtenti.loadFlussiRegionaliConst(this);this.addRef([{ref:"TabPrincipale",selector:this.selContainer+"#TabPrincipale"},{ref:"PageParametri",selector:this.selContainer+"#PageParametri"},{ref:"TabPeriodo",selector:this.selContainer+"#TabPeriodo"},{ref:"DataDal",selector:this.selContainer+
"#DataDal"},{ref:"DataAl",selector:this.selContainer+"#DataAl"},{ref:"PageAnteprima",selector:this.selContainer+"#PageAnteprima"},{ref:"BtnIndietro",selector:this.selContainer+"#BtnIndietro"},{ref:"BtnAvanti",selector:this.selContainer+"#BtnAvanti"},{ref:"BtnStampa",selector:this.selContainer+"#BtnStampa"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"BtnDownload",selector:this.selContainer+"#BtnDownload"},{ref:"TreeStrutture",selector:this.selContainer+"#TreeStrutture"},{ref:"IncludiGravi",
selector:this.selContainer+"#IncludiGravi"},{ref:"IncludiLievi",selector:this.selContainer+"#IncludiLievi"},{ref:"IncludiAvvisi",selector:this.selContainer+"#IncludiAvvisi"},{ref:"SenzaErrori",selector:this.selContainer+"#SenzaErrori"},{ref:"OrderByAnnoNumPratica",selector:this.selContainer+"#OrderByAnnoNumPratica"}]);this.control(this.selContainer+"#BtnElabora",{click:this.clickBtnElabora,afterrender:this.afterrenderBtnElabora});this.control(this.selContainer+"#BtnDownload",{click:this.clickBtnDownload,
afterrender:this.afterrenderBtnDownload});this.control(this.selContainer+"treepanel",{beforeitemcontextmenu:this.beforeitemcontextmenu});this.control(this.selContainer+"#TreeStrutture",{checkchange:this.checkchangeTreeStrutture});this.control(this.selContainer+"#Trimestre",{change:this.changeTrimestre})},changeTrimestre:function(b,c,d){this.trimestreChanged=-1==this.trimestreChanged?0:1},afterrenderBtnElabora:function(b,c){b.setText(traduci("FR_CONTROLLO_ERRORI"))},afterrenderBtnDownload:function(b,
c){b.setText(traduci("FR_CREA_TRACCIATO"))},checkchangeTreeStrutture:function(b,c){if(b&&("WARNING"==b.get("qtitle")||b.isLeaf())&&!this.getTreeStrutture().abilitaSelezioneServizio)return b.set("checked",!1),!1;if(b&&!b.isLeaf()){this.getTreeStrutture().getRootNode().cascadeBy(function(c){c.isLeaf()&&c.get("codStruttura")===b.get("codStruttura")&&c.get("tipoFlusso")===b.get("tipoFlusso")&&c.set("checked",b.get("checked"))});var d=getListCheckedTree(this.getTreeStrutture(),!0,"tipoFlusso");this.changeTipoPeriodo([this._SOSIA_LOMBARDIA,
this._SCDI_LOMBARDIA].includes(parseInt(d)))}},changeTipoPeriodo:function(b){this.getTabPeriodo().showTrimestri=b;this.getTabPeriodo().down("#Trimestre").setVisible(b);this.getTabPeriodo().down("#Mese").setVisible(!b);this.getTabPeriodo().down("#MeseAl").setVisible(!b);var c=this.getTabPeriodo().down("#Trimestre").getValue();b&&1>this.trimestreChanged&&(b=new Date,c=Math.floor((b.getMonth()+3)/3),[3,6,9,12].includes(b.getMonth()+1)||(1==c?(c=4,this.getTabPeriodo().down("#Anno").setValue(b.getFullYear()-
1)):--c),this.getTabPeriodo().down("#Trimestre").setValue(c));Ext.isEmpty(c)||(this.getTabPeriodo().down("#Mese").setValue(3*(c-1)+1),this.getTabPeriodo().down("#MeseAl").setValue(3*(c-1)+3))},clickBtnElabora:function(){"PageAnteprima"==this.getTabPrincipale().activeTab.itemId?this.naviga("next",!1):this.getTabPrincipale().setActiveTab(1)},clickBtnDownload:function(){var b=this,c=getListCheckedTree(b.getTreeStrutture(),!0,"tipoFlusso");[b._SOSIA_LOMBARDIA,b._FILEC_MARCHE,b._SDO_ALTOADIGE,b._SDOFIM_ALTOADIGE,
b._SDERIA_ALTOADIGE,b._FILER_MARCHE,b._LIS_TRENTINO].includes(parseInt(c))?(b.getIncludiGravi().setValue("T"),b.getIncludiLievi().setValue("T"),b.naviga("next",!0)):Messaggio("ATTENZIONE","FR_MSG_CONFIRM_CREAZIONE_TRACCIATI","YESNO","QUESTION",!1,function(){b.getIncludiGravi().setValue("T");b.getIncludiLievi().setValue("T");b.naviga("next",!0)})},archiviaTracciato:function(){var b=this,c=b.getDataAl().getValue().getMonth()+1,d=b.getDataAl().getValue().getFullYear(),f=[];b.listaTracciati&&Ext.Array.each(b.listaTracciati,
function(b){b&&["txt","xml"].includes(b.fileType.toLowerCase())&&(b=(getPathServer()+b.filePath).split("\\").pop().split("/").pop(),f.push(b))});var g="M",h=getListCheckedTree(b.getTreeStrutture(),!0,"tipoFlusso");[b._SOSIA_LOMBARDIA,b._SCDI_LOMBARDIA].includes(parseInt(h))&&(g="T",c=Math.round(((new Date(b.getDataDal().getValue())).getMonth()+2)/3));Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/general/fr/tracciato/archivia",jsonData:f,writer:{type:"json"},async:!1,params:{codStruttura:getListCheckedTree(b.getTreeStrutture(),
!0,"codStruttura"),anno:d,periodo:c,tipoPeriodo:g,tipoFlusso:h},success:function(c){c=Ext.JSON.decode(c.responseText);var d=[];titolo=traduci("MSG_SALVATAGGIO_DATI");msgAdd(d,c.message);c.success&&(b.getPageAnteprima().down("#CntDownload").show(),b.getBtnElabora().setDisabled(!0),b.getBtnDownload().setDisabled(!0));msgShow(titolo,d)}})},esci:function(){this.getTabPrincipale().up("window").close()},verificaParametri:function(){return!0},naviga:function(b,c){var d=this,f=this.getTabPrincipale();d.getBtnDownload().setDisabled(!0);
d.getBtnElabora().setDisabled(!1);if("next"==b||"PageAnteprima"==f.activeTab.itemId){var g="";0==d.getStrutture().length?g="FR_MSG_TRACCIATO_UNA_STRUTTURA":1<d.getStrutture().length?g="FR_MSG_TRACCIATO_PIU_STRUTTURE":508==d.getStrutture()[0].split("#")[2]&&(g="FR_MSG_TRACCIATO_ULSS8_KO");if(!Ext.isEmpty(g))return Messaggio("ATTENZIONE",g,"OK","INFO",function(){d.getBtnIndietro().setDisabled(!0);d.getBtnAvanti().setDisabled(!1)}),f.setActiveTab(f.down("#PageParametri")),!1;d.getPageAnteprima().down("#CntAnteprima").removeAll();
d.getPageAnteprima().down("#CntDownload").removeAll();d.getPageAnteprima().down("#CntDownload").hide();Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/general/fr/tracciato/elabora",timeout:18E5,jsonData:{},writer:{type:"json"},async:!0,params:{reportId:d.cbaConfig.id,idOrganizzazione:getIdOrg(),elencoServizi:d.getServizi().toString(),dataDal:d.getDataDal().getValue(),dataAl:d.getDataAl().getValue(),consideraErroriGravi:getBoolValue(d.getIncludiGravi().getValue()),consideraErroriLievi:getBoolValue(d.getIncludiLievi().getValue()),
consideraAvvisi:getBoolValue(d.getIncludiAvvisi().getValue()),consideraErroriNessuno:getBoolValue(d.getSenzaErrori().getValue()),orderByAnnoNumPratica:getBoolValue(d.getOrderByAnnoNumPratica().getValue()),idAvanzamentoElaborazione:0},success:function(b){var f=Ext.JSON.decode(b.responseText);b=[];titolo=traduci("MSG_ELABORAZIONE_DATI");msgAdd(b,f.message);if(f.success)if(0==f.data.length)Messaggio("ATTENZIONE","MSG_NESSUN_DATO","OK","WARNING",!1,!1);else{if(1<=f.data.length){var g={itemId:"iframePdf",
reference:"iframePdf",html:'<iframe width="100%" height="100%" src="'+(getPathServer()+f.data[0].filePath)+'"></iframe>'};d.getPageAnteprima().down("#CntAnteprima").removeAll();d.getPageAnteprima().down("#CntAnteprima").add(g);d.getBtnDownload().setDisabled(1==f.data.length);if(1<f.data.length){var h=d.getPageAnteprima().down("#CntDownload");h.removeAll();var p=getListCheckedTree(d.getTreeStrutture(),!0,"tipoFlusso"),f=f.data.filter(function(b){return!b.filePath.toLowerCase().includes(".pdf")});d.listaTracciati=
[];f.forEach(function(b){var c=b.fileType.toLowerCase(),f=getPathServer()+b.filePath,g=f.split("\\").pop().split("/").pop(),k=b.filePath.toLowerCase();k.includes(".txt.zip")?h.add(creaItemDownload("icon-txt",f,g,g)):k.includes(".csv.zip")&&[d._FAR_VENETO,d._SOSIA_LOMBARDIA,d._SCDI_LOMBARDIA,d._ODC_VENETO,d._SPA_ALTOADIGE,d._FILEC_MARCHE,d._SDO_ALTOADIGE,d._SDOFIM_ALTOADIGE,d._SDERIA_ALTOADIGE,d._FILER_MARCHE,d._LIS_TRENTINO].includes(parseInt(p))?h.add(creaItemDownload("icon-csv",f,g,g)):(h.add(creaItemDownload("icon-"+
c,f,g,g)),d.listaTracciati.push({fileType:b.fileType,filePath:b.filePath}))});c&&([d._SOSIA_LOMBARDIA,d._FILEC_MARCHE,d._SDO_ALTOADIGE,d._SDOFIM_ALTOADIGE,d._SDERIA_ALTOADIGE,d._FILER_MARCHE,d._LIS_TRENTINO].includes(parseInt(p))?(h.show(),d.getBtnElabora().setDisabled(!0),d.getBtnDownload().setDisabled(!0)):d.archiviaTracciato())}}}else d.getTabPrincipale().setActiveTab(0);msgShow(titolo,b)}})}},getStrutture:function(){var b=[];this.getTreeStrutture().getStore().getRootNode().cascadeBy(function(c){c.data.checked&&
c.isLeaf()&&-1==Ext.Array.indexOf(b,c.get("codStruttura")+"#"+c.get("tipoFlusso"))&&b.push(c.get("codStruttura")+"#"+c.get("tipoFlusso")+"#"+c.get("codAsl"))});return Ext.Array.unique(b)},getServizi:function(){var b=[];this.getTreeStrutture().getStore().getRootNode().cascadeBy(function(c){c.data.checked&&c.isLeaf()&&b.push(c.get("idServizio")+"#"+c.get("tipoFlusso"))});return Ext.Array.unique(b)},loadTreeStrutture:function(b){var c=this,d=c.getTreeStrutture();d.getStore().load({params:{tipo:b?b:1,
soloServizi:"T",conClassNull:"T",soloStrutture:"T"},callback:function(b,g,h){if(h){d.expandAll();var f=!0;d.getRootNode().cascadeBy(function(b){b.set("checked",!1);d.abilitaSelezioneServizio=[c._FILEC_MARCHE,c._FILER_MARCHE,c._LIS_TRENTINO].includes(b.data.tipoFlusso);b.isLeaf()&&!d.abilitaSelezioneServizio&&b.set("cls","cba-disabled-element");!f||Ext.isEmpty(b.data.tipoFlusso)||[c._SOSIA_LOMBARDIA,c._SCDI_LOMBARDIA].includes(b.data.tipoFlusso)||(f=!1)});c.changeTipoPeriodo(f);d.getStore().filter({filterFn:function(b){return[c._CURE_PALLIATIVE_RES_LOMBARDIA,
c._CURE_PALLIATIVE_DOM_LOMBARDIA,c._CURE_PALLIATIVE_RES_VENETO,c._FAR_VENETO,c._SOSIA_LOMBARDIA,c._SCDI_LOMBARDIA,c._ODC_VENETO,c._SPA_ALTOADIGE,c._FILEC_MARCHE,c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE,c._FILER_MARCHE,c._LIS_TRENTINO].includes(b.data.tipoFlusso)}});b="";0==d.getStore().count()&&(c.getPageParametri().setDisabled(!0),c.getPageAnteprima().setDisabled(!0),b=traduci("FR_MSG_TRACCIATO_STRUTTURA_KO"));Ext.isEmpty(b)||Messaggio("ATTENZIONE",b,"OK","WARNING",!1,!1)}else msgShowError("",
g.getError())}})},beforeitemcontextmenu:function(b,c,d,f,g,h){return getPopupMenuTree(g,b)},onLaunch:function(){var b=this;b.getTabPrincipale().cbaConfig.naviga=function(c){b.naviga(c)};b.cbaConfig.eseguiStampa||(ImpostaUrl([b.getTreeStrutture().getStore()]),b.loadTreeStrutture(),b.getPageAnteprima().setTitle("Elabora tracciato"),b.getBtnStampa().setVisible(!1),b.getBtnElabora().setVisible(!0),b.getBtnElabora().setDisabled(!1),b.getBtnDownload().setVisible(!0),b.getBtnDownload().setDisabled(!0),b.getBtnAvanti().setVisible(!0),
b.getBtnIndietro().setVisible(!0),b.trimestreChanged=-1)}});
Ext.define("GeneraliOSP.flussiRegionali.controller.ElencoTracciati",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"ElencoTracciati",selector:this.selContainer+"#ElencoTracciati"},{ref:"GridTracciati",selector:this.selContainer+"#GridTracciati"},{ref:"CntDownload",selector:this.selContainer+"#CntDownload"},{ref:"BtnAnnulla",selector:this.selContainer+"#BtnAnnulla"},{ref:"BtnDownload",selector:this.selContainer+
"#BtnDownload"}]);this.control(this.selContainer+"#GridTracciati",{select:this.selectGridTracciati});this.control(this.selContainer+"#BtnAnnulla",{click:this.clickBtnAnnulla});this.control(this.selContainer+"#BtnDownload",{click:this.clickBtnDownload})},selectGridTracciati:function(){var b=this.getGridTracciati(),c=b.getSelectionModel().getSelection()[0];this.getBtnDownload().setDisabled(!1);this.getCntDownload().removeAll();this.getCntDownload().hide();var d=!0,f="";if(0<b.getStore().indexOf(c))for(var g=
$jscomp.makeIterator(b.getStore().getRange()),b=g.next();!b.done;b=g.next()){var h=b.value,k=h.get("codStruttura").split(","),b=h.get("tipoFlusso");if(c.get("id")==h.get("id")){g=$jscomp.makeIterator(k);for(h=g.next();!h.done;h=g.next())if(h=h.value,!Ext.isEmpty(h)&&0<=f.indexOf(h+"#"+b)){d=!1;break}break}else for(k=$jscomp.makeIterator(k),h=k.next();!h.done;h=k.next())h=h.value,!Ext.isEmpty(h)&&0>f.indexOf(h+"#"+b)&&(f+=","+h+"#"+b)}this.getBtnAnnulla().setDisabled(!d||"2012">=c.get("anno"))},clickBtnAnnulla:function(b){var c=
this,d=c.getGridTracciati();b=traduci("MSG_ELIMINA");var f=d.getSelectionModel().getSelection()[0];if("3"!=f.get("tipoFlusso")){var g=new Date,h=Math.floor((g.getMonth()+3)/3),g=g.getFullYear();2>=h?(h=4,--g):5>=h?h=1:8>=h?h=2:11>=h&&(h=3);if(f.get("anno")<g||f.get("anno")===g&&f.get("trimestre")<=h)b="FR_MSG_CONFIRM_ANNULLA_TRACCIATO"}Messaggio("ATTENZIONE",b,"YESNO","QUESTION",!1,function(){controller_eliminaRecord(d.getStore(),{idTracciato:f?f.get("id"):""},function(){c.aggiornaStore()},!1,"",
"",!0)},function(){return!1})},clickBtnDownload:function(){var b=this,c=b.getGridTracciati().getSelectionModel().getSelection()[0];Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/general/fr/tracciato/download",jsonData:{},writer:{type:"json"},async:!0,params:{idTracciato:c.get("id")},success:function(c){var d=Ext.JSON.decode(c.responseText);c=[];titolo=traduci("MSG_ELABORAZIONE_DATI");msgAdd(c,d.message);if(d.success&&(b.getCntDownload().show(),1==d.data.length)){b.getCntDownload().removeAll();
var g={};Ext.apply(g,{fileType:"zip",filePath:d.data[0].filePath});if(g){var d=g.fileType.toLowerCase(),g=getPathServer()+g.filePath,h=g.split("\\").pop().split("/").pop(),d=creaItemDownload("icon-"+d,g,h,h);b.getCntDownload().add(d)}}msgShow(titolo,c)}})},aggiornaStore:function(){this.getGridTracciati().getStore().load({callback:function(b,c,d){d||msgShowError("",c.getError())}})},svuotaStore:function(){svuotaStore(this.getGridTracciati().getStore())},onLaunch:function(){this.getGridTracciati().controller=
this;this.aggiornaStore();this.getBtnDownload().setDisabled(!0);this.getBtnAnnulla().setDisabled(!0)}});
Ext.define("GeneraliOSP.flussiRegionali.store.ElencoTracciati",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"data",type:"date"},{name:"tipoFlusso"},{name:"desTipoFlusso"},{name:"anno"},{name:"periodo"},{name:"tipoPeriodo"},{name:"desPeriodo"},{name:"codStruttura"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/general/fr/tracciato/search",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/osp/co/ws/general/fr/tracciato/search",destroy:"/cba/osp/co/ws/general/fr/tracciato/delete"}},
autoDestroy:!0});Ext.define("GeneraliOSP.flussiRegionali.store.FRClassRetta",{extend:"Generali.data.StoreJson",id:Ext.id(),fields:[{name:"codiceClassificazione"},{name:"desClassificazione"},{name:"statoRisposta"},{name:"dataDal",type:"date"},{name:"totaleRettaFatt"}],proxy:{urlGen:"/ws/genOsp/fr/classRetta/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.flussiRegionali.store.UtenteSosia",{extend:"Ext.data.Store",fields:[{name:"nominativo"},{name:"codiceFiscale"},{name:"dataNascita",type:"date"},{name:"dataRiferimento",type:"date"},{name:"codOspite"},{name:"idServizio"},{name:"idRicovero"},{name:"classeSosia"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/fr/sosia/listaUtenti",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},sorters:[{property:"nominativo",direction:"ASC"}],autoDestroy:!0});
Ext.define("GeneraliOSP.flussiRegionali.view.AggiornaClassRegionali",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"tabpanel",flex:1,border:0,itemId:"TabPrincipale",reference:"TabPrincipale",tabBar:{height:48,items:[{xtype:"tbfill"},{xtype:"toolbar",border:0,items:[{xtype:"button",itemId:"BtnIndietro",reference:"BtnIndietro",iconCls:"icon-indietro",scale:"large",tooltip:"INDIETRO",
disabled:!0},{xtype:"tbspacer",width:10},{xtype:"button",itemId:"BtnAvanti",reference:"BtnAvanti",iconCls:"icon-avanti",tooltip:"AVANTI",scale:"large"},{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-elabora32",scale:"large",text:"ELABORA",disabled:!0}]}]},items:[{xtype:"panel",tabConfig:{title:"PARAMETRI_GENERALI",height:44},itemId:"PageParametri",reference:"PageParametri",layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"container",flex:1,layout:{type:"hbox",
align:"stretch"},items:[{xtype:"container",padding:5,width:270,layout:{align:"stretch",type:"vbox"},items:[{xtype:"tabPeriodo",itemId:"TabPeriodo",reference:"TabPeriodo"},{xtype:"fieldset",itemId:"ConsideraUtenti",reference:"ConsideraUtenti",layout:{type:"vbox"},title:"CONSIDERA_UTENTI",margin:"20 0 0 0",items:[{xtype:"checkboxfield",checked:!0,itemId:"Attivi",reference:"Attivi",cls:"cbaLabel",fieldLabel:"",boxLabel:"PRESENTI_PERIODO",inputValue:"T",uncheckedValue:"F",readOnly:!0}]},{xtype:"combobox",
margin:"20 0 0 0",labelClsExtra:"cbaLabel",fieldLabel:"SERVIZIO",itemId:"CBServizio",reference:"CBServizio",emptyText:"SERVIZIO",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.TipoServizio"),valueField:"codice",labelWidth:50}]},{xtype:"gridpanel",itemId:"GridClassiSosia",reference:"GridClassiSosia",store:Ext.create("CU.store.OsRenLom"),flex:1,border:0,padding:5,title:"CLASSI_SOSIA",columns:[{xtype:"gridcolumn",flex:1,dataIndex:"codice",hidden:!0},{xtype:"gridcolumn",
flex:1,dataIndex:"extra",hidden:!0},{xtype:"gridcolumn",flex:1,dataIndex:"valore",text:traduci("CLASSE")}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"simple"}),viewConfig:{loadMask:!1}}]}]},{xtype:"panel",itemId:"PageUtenti",reference:"PageUtenti",tabConfig:{title:"ELENCO_UTENTI",height:44},layout:{align:"stretch",type:"hbox"},bodyPadding:5,items:[{xtype:"gridpanel",itemId:"GridUtenti",reference:"GridUtenti",flex:1,abilitaCheckBox:!0,store:Ext.create("GeneraliOSP.flussiRegionali.store.UtenteSosia"),
columns:[{xtype:"gridcolumn",width:30,sortable:!1,resizable:!1},{xtype:"gridcolumn",dataIndex:"nominativo",text:"COGNOME_NOME",flex:1},{xtype:"datecolumn",width:80,sortable:!1,resizable:!1,align:"center",style:"text-align:center",dataIndex:"dataNascita",text:"DATA_NASCITA",format:"d/m/Y"},{xtype:"gridcolumn",dataIndex:"codOspite",hidden:!0},{xtype:"gridcolumn",dataIndex:"idRicovero",hidden:!0},{xtype:"gridcolumn",dataIndex:"idServizio",hidden:!0},{xtype:"gridcolumn",dataIndex:"codiceFiscale",hidden:!0},
{xtype:"datecolumn",dataIndex:"dataRiferimento",hidden:!0},{xtype:"gridcolumn",dataIndex:"classeSosia",hidden:!0}],viewConfig:{loadMask:!1,getRowClass:function(b,c,d,f){if(!0===b.get("dimPeriodoPrec"))return"non_attivi"}},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",cbaConfig:{searchField:"nominativo",ricercaIniziaPer:!0}}]}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"SIMPLE",enableKeyNav:!1})},{xtype:"container",itemId:"CntDownload",reference:"CntDownload",
scrollable:!1,layout:{type:"vbox",align:"center"},hidden:!0,width:250}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.flussiRegionali.view.AggiornaTariffe",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntPrincipale",reference:"CntPrincipale",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",itemId:"PnlRicerca",reference:"PnlRicerca",frame:!0,minHeight:50,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},layout:"hbox",flex:.35,items:[{xtype:"combobox",
margin:"10 0 0 5",labelClsExtra:"cbaLabel",fieldLabel:"SERVIZIO",itemId:"CBServizio",reference:"CBServizio",name:"sede",emptyText:"SERVIZIO",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.TipoServizio"),typeAhead:!0,valueField:"codice",allowBlank:!1,labelWidth:50,width:300}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:.5,items:[{xtype:"datefield",itemId:"DataRilevazione",reference:"DataRilevazione",fieldLabel:traduci("FR_AGGIORNATARIFFE_DATARILEVAZIONE"),
labelClsExtra:"cbaLabel",margin:"12 0 5 0",labelWidth:355,width:475,format:"d/m/Y",emptyText:"GG/MM/AAAA",value:new Date},{xtype:"button",itemId:"BtnCerca",reference:"BtnCerca",margin:"10 0 0 10",cls:"btnLarge",label:"CERCA",align:"left",iconCls:"icon-ricerca",scale:"medium"}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:.15,items:[{xtype:"tbfill"},{xtype:"button",margin:"10 5 5 0",cls:"cba-stdbutton-25",itemId:"BtnElaboraTariffe",reference:"BtnElaboraTariffe",iconCls:"icon-elabora",
text:traduci("ELABORA"),disabled:!0}]}]},{xtype:"splitter",height:1,nonDisabilitare:!0},{xtype:"container",itemId:"CntClassificazioni",reference:"CntClassificazioni",layout:"fit",flex:1,items:[{xtype:"gridpanel",itemId:"GridClassRetta",reference:"GridClassRetta",store:Ext.create("GeneraliOSP.flussiRegionali.store.FRClassRetta"),columns:[{xtype:"gridcolumn",flex:1,dataIndex:"codiceClassificazione",hidden:!0},{xtype:"gridcolumn",flex:1,dataIndex:"desClassificazione",text:traduci("CLASSIFICAZIONE"),
renderer:function(b,c,d,f,g,h,k){"T"==d.get("statoRisposta")&&(c.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");return b}},{xtype:"datecolumn",dataIndex:"dataDal",text:traduci("DATA_DECORRENZA"),align:"center",format:"d/m/Y",sortable:!1},{xtype:"numbercolumn",text:traduci("FR_IMPORTO_PRIVATO"),align:"center",dataIndex:"totaleRettaFatt",width:120,sortable:!1,editor:{xtype:"numberfield",selectOnFocus:!0,useThousandSeparator:!0,alwaysDisplayDecimals:!0,
thousandSeparator:".",decimalPrecision:2},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important;";return formatFloat(b,2,!0)}}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"simple"}),viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,onSpecialKey:function(b,c,d){if(d.getKey()===d.TAB){d.stopEvent();d.position=this.context;if(b)b.onEditorTab(d);c=b.getRefOwner().getSelectionModel();this.completeEdit();return c.onEditorTab(b.editingPlugin,
d)}}})],dockedItems:[{xtype:"toolbar",dock:"top",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",margin:"5 0 0 5",html:'<span style="font-style: italic">'+traduci("FR_AGGIORNATARIFFE_NOTA1")+"&nbsp;"+traduci("FR_AGGIORNATARIFFE_NOTA2")+"</span>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"datefield",itemId:"DataDecorrenza",reference:"DataDecorrenza",fieldLabel:traduci("FR_AGGIORNATARIFFE_DATADECORRENZA"),labelClsExtra:"cbaLabel",labelWidth:220,
margin:"10 0 0 5",width:330,format:"d/m/Y",emptyText:"GG/MM/AAAA",value:new Date},{xtype:"checkboxfield",itemId:"CheckSovrascrivi",reference:"CheckSovrascrivi",boxLabel:traduci("FR_AGGIORNATARIFFE_SOVRASCRIVI"),margin:"10 0 0 20",inputValue:"T",uncheckedValue:"F"}]}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.flussiRegionali.view.ElaboraTracciato",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"stampaCBA",useNewButtonStampa:!0,border:0,itemId:"TabPrincipale",reference:"TabPrincipale",items:[{xtype:"panel",tabConfig:{title:"PARAMETRI_GENERALI",height:44},itemId:"PageParametri",reference:"PageParametri",hidden:!1,layout:{align:"stretch",type:"hbox"},bodyPadding:5,title:"",items:[{xtype:"container",itemId:"CntParam",reference:"CntParam",
padding:5,width:300,layout:{align:"stretch",type:"vbox"},autoScroll:!0,items:[{xtype:"tabPeriodo",itemId:"TabPeriodo",reference:"TabPeriodo"},{xtype:"checkboxfield",itemId:"IncludiGravi",reference:"IncludiGravi",cls:"cbaLabel",fieldLabel:"",boxLabel:"FR_INCLUDI_GRAVI",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"IncludiLievi",reference:"IncludiLievi",cls:"cbaLabel",fieldLabel:"",boxLabel:"FR_INCLUDI_LIEVI",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",
itemId:"IncludiAvvisi",reference:"IncludiAvvisi",cls:"cbaLabel",fieldLabel:"",boxLabel:"FR_INCLUDI_AVVISI",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"SenzaErrori",reference:"SenzaErrori",cls:"cbaLabel",fieldLabel:"",boxLabel:"FR_INCLUDI_NO_ERRORI",checked:!1,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"OrderByAnnoNumPratica",reference:"OrderByAnnoNumPratica",cls:"cbaLabel",fieldLabel:"",boxLabel:"FR_ORDER_BY_ANNO_NUMPRATICA",checked:!1,inputValue:"T",
uncheckedValue:"F"}]},{xtype:"container",itemId:"CntTreeStrutture",reference:"CntTreeStrutture",fieldDefaults:{margin:"2 4 4 2"},layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"treepanel",flex:1,border:0,margin:"0 10 0 0",itemId:"TreeStrutture",reference:"TreeStrutture",rootVisible:!1,useArrows:!0,store:Ext.create("GeneraliOSP.store.Albero"),columns:[{xtype:"treecolumn",dataIndex:"text",text:"STRUTTURE",flex:1,renderer:function(b,c,d,f,g,h,k){c&&"WARNING"==d.get("qtitle")&&(c.tdAttr='data-qtip="'+
traduci("FR_TRACCIATO_WARNING")+'"',c.tdCls="non_attivi");return b}}],viewConfig:{loadMask:!1},listeners:{checkchange:function(b,c,d){b&&b.hasChildNodes()&&b.eachChild(function(b){b.set("checked",c)})}}}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.flussiRegionali.view.ElencoTracciati",{extend:"Generali.standard.ControlledContainer",uses:["GeneraliOSP.flussiRegionali.store.ElencoTracciati","GeneraliOSP.flussiRegionali.controller.ElencoTracciati"],initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"ElencoTracciati",reference:"ElencoTracciati",layout:{type:"hbox",align:"stretch"},bodyPadding:0,items:[{xtype:"container",itemId:"CntGriglia",layout:"fit",flex:1,items:[{xtype:"gridpanel",itemId:"GridTracciati",
reference:"GridTracciati",store:Ext.create("GeneraliOSP.flussiRegionali.store.ElencoTracciati"),columns:[{xtype:"datecolumn",format:"d/m/Y H.i.s",text:"FR_DATA_TRACCIATO",dataIndex:"data",align:"center",width:200},{xtype:"gridcolumn",text:"FR_PERSON_TIPOTRACCIATO",dataIndex:"desTipoFlusso",width:300},{xtype:"gridcolumn",text:"PERIODO",dataIndex:"desPeriodo",width:300},{xtype:"gridcolumn",text:"FR_STRUTTURA",dataIndex:"codStruttura",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.RowModel",
{}),dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnAnnulla",reference:"BtnAnnulla",iconCls:"icon-annulla",text:"ANNULLA"},{xtype:"button",itemId:"BtnDownload",reference:"BtnDownload",iconCls:"icon-zip",text:"DOWNLOAD"}]}]}]},{xtype:"container",itemId:"CntDownload",reference:"CntDownload",layout:{type:"vbox",align:"center"},hidden:!0,width:300}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.icd9Search.controller.ICD9_Search",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DescrSelected",selector:b+"#DescrSelected"},{ref:"BtnSeleziona",selector:b+"#BtnSeleziona"},{ref:"BtnEsci",selector:b+"#BtnEsci"},{ref:"TabPanel",selector:b+"#TabPanel"},{ref:"TabRicercaIcd",selector:b+"#TabRicercaIcd"},{ref:"Codice_Src",selector:b+"#Codice_Src"},{ref:"Descrizione_Src",selector:b+"#Descrizione_Src"},
{ref:"GridIcd",selector:b+"#GridIcd"},{ref:"TabIcdFreq",selector:b+"#TabIcdFreq"},{ref:"GridIcdFreq",selector:b+"#GridIcdFreq"},{ref:"TabAlberoIcd",selector:b+"#TabAlberoIcd"},{ref:"TreePanel",selector:b+"#TreePanel"}]);this.control(b+"#BtnSeleziona",{click:this.clickSeleziona});this.control(b+"#BtnEsci",{click:this.clickEsci});this.control(b+"#GridIcd",{selectionchange:this.selezioneGriglia});this.control(b+"#TabPanel",{beforetabchange:this.cambioTab});this.control(b+"#TreePanel",{select:this.treeIcdSelect});
this.control(b+"#GridIcdFreq",{selectionchange:this.selezioneGriglia})},clickEsci:function(b){b.up("window").close()},clickSeleziona:function(b){this.selectedICD&&""!==this.selectedICD.codice?(this.cbaConfig.callbackRitorno&&this.cbaConfig.callbackRitorno(this.selectedICD.codice,this.selectedICD.descrizione),b.up("window").close()):msgShowWarning("","SELEZIONARE_UN_ELEMENTO")},treeIcdSelect:function(b,c,d,f){1==b.getSelection()[0].data.leaf&&(c=b.getSelection()[0].data.text.split(" "),b=c[0],c=c.slice(1,
c.length).join(" "),this.setSelectedICD(b,c))},setSelectedICD:function(b,c){""==b||void 0==b?this.selectedICD={codice:"",descrizione:""}:(this.selectedICD={codice:b,descrizione:c},this.getDescrSelected().setText(b+" - "+c.substring(0,100)))},cambioTab:function(b,c,d){var f=this;f.tabSelected=c.itemId;f.treeLoaded||"TabAlberoIcd"!=c.itemId||(f.getTreePanel().setEmptyText(traduci("MSG_CARICAMENTO_DATI")),Ext.suspendLayouts(),f.getTreePanel().getStore().load({params:{tipoIcd:f.cbaConfig.icdUtilizzato?
f.cbaConfig.icdUtilizzato:3},callback:function(b,c,d){d?(f.treeLoaded=!0,f.getTreePanel().getRootNode().expand(),null==b||b==[]?f.getTreePanel().setEmptyText(traduci("NESSUN_DATO_TROVATO_RICERCA")):f.getTreePanel().setEmptyText("")):msgShowError("",c.getError());Ext.resumeLayouts()}}))},selezioneGriglia:function(b,c,d){var f="",g="";Ext.each(c,function(b){f=b.get("codice");g=b.get("valore")});this.setSelectedICD(f,g)},caricaRisultatiRicerca:function(b){var c=this.getGridIcd().getStore();c.clearFilter();
svuotaStore(c);Array.isArray(b)&&0<b.length&&c.add(b)},cercaIcd:function(b){var c=this,d=c.getDescrizione_Src();c.getCodice_Src();b={tipoIcd:c.cbaConfig.icdUtilizzato?c.cbaConfig.icdUtilizzato:3,codice:c.getCodice_Src().getValue(),descrizione:d.getValue(),orderBy:b};b.codice=null==b.codice?"":b.codice.trim();b.descrizione=null==b.descrizione?"":b.descrizione.trim();2>b.codice.length&&2>b.descrizione.length?c.caricaRisultatiRicerca([]):(c.urlSearch||(c.urlSearch=getUrlGen()+"/ws/genOsp/icd9/search"),
inizioAttesa(),Ext.Ajax.request({method:"GET",url:c.urlSearch,params:b,async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?c.caricaRisultatiRicerca(b.data):msgShowError("",b.message);Ext.defer(function(){fineAttesa()},150)}}))},onLaunch:function(){this.setSelectedICD();this.treeLoaded=!1;ImpostaUrl([this.getTreePanel().getStore(),this.getGridIcdFreq().getStore()]);if(this.cbaConfig.showIcdFrequenti){this.getTabIcdFreq().tab.setHidden(!1);var b=this.cbaConfig.tipoFlussoRegionale;
if(null==b||void 0==b)b=0;this.getGridIcdFreq().getStore().load({params:{tipoFlusso:b},callback:function(b,d,f){f||msgShowError("",d.getError())}})}this.tabSelected="TabRicercaIcd";this.caricaRisultatiRicerca([])},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.icd9Search.view.ICD9_Search",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this,c=traduci("INSERIRE")+" "+traduci("CARATTERI_PER_CERCARE"),d=new Ext.data.ArrayStore({fields:["codice","valore"],autoDestroy:!0});Ext.applyIf(b,{layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"toolbar",border:0,items:[{xtype:"label",itemId:"DescrSelected",reference:"DescrSelected",text:"ELEMENTO_SELEZIONATO",
margin:"0 0 0 5"},{xtype:"tbfill"},{xtype:"button",scale:"large",itemId:"BtnSeleziona",reference:"BtnSeleziona",iconCls:"icon-ok32",text:"SELEZIONA"},{xtype:"button",scale:"large",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esci32",text:"ESCI"}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"tabpanel",flex:1,itemId:"TabPanel",reference:"TabPanel",items:[{title:traduci("RICERCA_PER")+" "+traduci("CODICE"),layout:{type:"vbox",align:"stretch"},flex:1,padding:5,
itemId:"TabRicercaIcd",reference:"TabRicercaIcd",items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"image",src:"/cba/generali/images/16/find.png",margin:"0 10 0 5",height:16,width:16},{xtype:"textfield",itemId:"Codice_Src",reference:"Codice_Src",fieldLabel:"CODICE",labelClsExtra:"cbaLabel",labelWidth:50,emptyText:c,width:140,enforceMaxLength:!0,maxLength:5,margin:"0 30 0 0",listeners:{change:Ext.Function.createBuffered(function(c){b.controller.cercaIcd("C")},
200,this)}},{xtype:"textfield",itemId:"Descrizione_Src",reference:"Descrizione_Src",fieldLabel:"DESCRIZIONE",labelClsExtra:"cbaLabel",labelWidth:80,width:380,enforceMaxLength:!0,maxLength:100,emptyText:c,listeners:{change:Ext.Function.createBuffered(function(c){b.controller.cercaIcd("D")},200,this)}}]}]},{xtype:"gridpanel",height:320,itemId:"GridIcd",reference:"GridIcd",margin:"5 0 0 0",store:d,deferRowRender:!1,emptyText:traduci("NESSUN_DATO_TROVATO_RICERCA"),flex:1,columns:[{xtype:"gridcolumn",
dataIndex:"id",hidden:!0},{xtype:"gridcolumn",text:"CODICE",dataIndex:"codice",sortable:!1},{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"valore",flex:1,sortable:!1}],viewConfig:{loadMask:!1,getRowClass:function(b,c,d,k){return"cbaCssRigaAlta40"}}}]},{title:"ICD9_FREQUENTI",itemId:"TabIcdFreq",reference:"TabIcdFreq",layout:{type:"vbox",align:"stretch"},flex:1,padding:5,hidden:!0,items:[{xtype:"gridpanel",itemId:"GridIcdFreq",reference:"GridIcdFreq",store:Ext.create("Generali.data.StoreCodiceValore",
{proxy:{urlGen:"/ws/genOsp/icd9/getICDFreqenti"}}),height:320,margin:"5 0 0 0",deferRowRender:!1,emptyText:traduci("NESSUN_DATO_TROVATO_RICERCA"),flex:1,columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",text:"CODICE",dataIndex:"codice",sortable:!1},{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"valore",flex:1,sortable:!1}],viewConfig:{loadMask:!1,getRowClass:function(b,c,d,k){return"cbaCssRigaAlta40"}}}]},{title:"VISUALIZZA_ELENCO_COMPLETO",layout:{type:"vbox",align:"stretch"},
flex:1,padding:5,itemId:"TabAlberoIcd",reference:"TabAlberoIcd",items:[{xtype:"treepanel",itemId:"TreePanel",reference:"TreePanel",store:Ext.create("Generali.data.StoreJsonTree",{proxy:{urlGen:"/ws/genOsp/icd9/tree"}}),flex:1,rootVisible:!1,viewConfig:{loadMask:!1}}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.icd9.controller.icd9",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DesIcd9",selector:c+"#DesIcd9"},{ref:"Icd9",selector:c+"#Icd9"},{ref:"BtnIcd9",selector:c+"#BtnIcd9"}]);this.control(c+"#Icd9",{change:Ext.Function.createBuffered(function(c){var d=c.getValue(),g=b.getDesIcd9();d&&2<d.length?StdSipcar.promiseGetRequest(getUrlGen()+"/ws/genOsp/icd9/search",parametri={tipoIcd:3,codice:d}).then(function(b){g.setValue(1==
b.length?b[0].valore:"")})["catch"](function(b){return msgShowError("",b)}):g.setValue("");c.focus()},100,this)})}});
Ext.define("GeneraliOSP.icd9.view.icd9",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=200,c=100;this.labelAlignIcd9&&(b=90,c=80);Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntIdc9",reference:"CntIdc9",layout:{type:"hbox",align:this.labelAlignIcd9&&"top"==this.labelAlignIcd9?"bottom":"middle"},items:[{xtype:"textfield",itemId:"Icd9",reference:"Icd9",fieldLabel:"DIAGNOSI_ICD9",labelClsExtra:"cbaLabel",name:"diagnosiIngressoICD9",minLength:3,maxLength:6,enforceMaxLength:!0,
maskRe:/[0-9]/,readOnly:!0,nonDisabilitare:!0,width:this.widthIcd9?this.widthIcd9:b,labelWidth:this.labelWidthIcd9?this.labelWidthIcd9:c,labelAlign:this.labelAlignIcd9?this.labelAlignIcd9:"left"},{xtype:"textfield",itemId:"DesIcd9",reference:"DesIcd9",flex:1,name:"des_icd9",isFormField:!1,readOnly:!0,nonDisabilitare:!0,margin:"0 3 0 3",listeners:{afterrender:function(b){49!=CBA.moduli.moduloAttivo&&b.setWidth(252)}}},{xtype:"button",itemId:"BtnIcd9",reference:"BtnIcd9",text:traduci("SCHEDA"),icon:"/cba/css/generali/images/generali/apri.svg",
cls:"cbaCssBtnFunzione",scale:"small",width:85,nonDisabilitare:!0,margin:"0 3 0 0",hidden:49!=CBA.moduli.moduloAttivo}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.integrazioni.AnagraficaSearchUtils",{alternateClassName:"AnagraficaSearchUtils",uses:["GeneraliOSP.integrazioni.IntegrazioneSissWay"],constructor:function(b){this.callParent(arguments)},statics:{searchWin:function(b){return Ext.create("winCBA",{titolo:"RICERCA_RAPIDA_ANAGRAFICA",larghezzaWin:400,maximizable:!1,name:"GeneraliOSP.anagraficaSrc.view.AnagraficaLightSearch",configItem:{externalFn:void 0===b?function(){return null}:b}}).show()},getTipoIntegrazioneAnag:function(){var b=
Promise.resolve("CU_INT_ANA_SISS"),c=new Promise(function(b,c){StdUtenti.modAggIsEnable(CBA.parametriGenerali.idOrganizzazione,"CU_INT_ANA_ALTOADIGE",function(d){d=Ext.JSON.decode(d.responseText);d.success?b(d.data?"CU_INT_ANA_ALTOADIGE":null):c()})}),d=new Promise(function(b,c){StdUtenti.modAggIsEnable(CBA.parametriGenerali.idOrganizzazione,"CU_INT_ANA_PEDERZOLI",function(d){d=Ext.JSON.decode(d.responseText);d.success?b(d.data?"CU_INT_ANA_PEDERZOLI":null):c()})});return Promise.all([b,c,d])},openWinAnagrafica:function(b){b=
void 0===b?function(){return null}:b;var c=this;CBA.parametriGenerali.tipoIntegrazioneAnagrafica?this.searchWin(b):IntegrazioneSissWay.primoFetch?b():IntegrazioneSissWay.isIntegrazioneSissWay().then(function(d){IntegrazioneSissWay.primoFetch=!0;var f=d.url;d.enabled?(IntegrazioneSissWay.url=f,c.getTipoIntegrazioneAnag().then(function(d){CBA.parametriGenerali.tipoIntegrazioneAnagrafica=null;d.forEach(function(b){b&&(CBA.parametriGenerali.tipoIntegrazioneAnagrafica=b)});CBA.parametriGenerali.tipoIntegrazioneAnagrafica&&
c.searchWin(b)})):b()})["catch"](function(b){return console.error(b)})},getSicpar2Prop:function(b){return new Promise(function(c,d){Ext.Ajax.request({method:"GET",url:"/cba/gen/config/"+b,params:{},success:function(b){b=Ext.JSON.decode(b.responseText);var d=b.data;b.success&&c(d)},failure:function(b){d()}})})}}});
Ext.define("GeneraliOSP.integrazioni.IntegrazioneSissWay",{alternateClassName:"IntegrazioneSissWay",uses:["GeneraliOSP.integrazioni.AnagraficaSearchUtils","GeneraliOSP.fascicoloNoApp.store.Ospite","GeneraliOSP.integrazioni.MdwSorgenti","GeneraliOSP.integrazioni.MdwTipi"],statics:{url:null,decodeCmp:function(b,c){var d=null;Ext.Ajax.request({method:"GET",async:!1,url:getUrlGen()+"/ws/genOsp/mdw/raccordi/getByCodEsterno",params:{sorgente:MdwSorgenti.enumSorgenti.SISSWAY.id,tipo:c,codEsterno:b},success:function(f){f=
Ext.JSON.decode(f.responseText);var g=f.message,h=f.data;f.success?(d=h&&h.codCba)||console.error("il campo con id MdwTipo "+c+" con valore "+b+" risulta vuoto per cba!"):msgShowError("",g)}});return d},isIntegrazioneSissWay:function(){return new Promise(function(b,c){AnagraficaSearchUtils.getSicpar2Prop("patientdata/getUrl").then(function(c){b({url:c,enabled:!Ext.isEmpty(c)})})["catch"](function(b){c(b)})})},mapping:function(b){var c={},d;for(d in b)if(c[d]=b[d],0<=d.indexOf("#")){var f=d.split("#")[0],
g=d.split("#")[1],h=c[f];if(h)f={},Object.assign(h,(f[g]=b[d],f));else{var h={},k={};Object.assign(c,(k[f]=(h[g]=b[d],h),k))}delete c[d]}return c},launchSissWay:function(b,c){c=void 0===c?function(){return null}:c;var d=this,f={cognomeCittadino:"cognome",nomeCittadino:"nome",sessoCittadino:"sesso",codiceFiscaleCittadino:"codiceFiscale",codiceSanitarioCittadino:"codiceSanitario",idComuneNascitaCittadino:"comuneNascita",dataNascitaCittadino:"dataNascita",comuneNascitaCittadino:"desComuneNascita",idAnag:"_idAnagExternal",
statoCivileCittadino:"statoCivile",titoloStudioCittadino:"gradoIstruzione",idComuneResidenzaCittadino:"indResidenza#comune",comuneResidenzaCittadino:"indResidenza#desComune",indirizzoResidenzaCittadino:"indResidenza#indirizzo",civicoResidenzaCittadino:"indResidenza#civico",capResidenzaCittadino:"indResidenza#cap"};Ext.Ajax.request({method:"POST",url:this.url,cors:!0,timeout:36E5,useDefaultXhrHeader:!1,xmlData:'<?xml version="1.0" encoding="ISO-8859-1"?>                 <SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" xmlns:xsd="http://www.w3.org/1999/XMLSchema" xmlns:xsi="http://www.w3.org/1999/XMLSchema-instance" encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">                     <SOAP-ENV:Body>                         <m:MIA.selPaz xmlns:m=\'http://www.crs.lombardia.it/schemas/PS_R/SISSWAY/2016-01/selPaz/\' dataSetVersion=\'1.0\'>                             <appl>CBA</appl>                             <omettiEsenzioni></omettiEsenzioni>                             <cognomeCittadino>'+
b.cognome+"</cognomeCittadino>                             <nomeCittadino>"+b.nome+"</nomeCittadino>                             <codiceFiscaleCittadino>"+b.codFisc+"</codiceFiscaleCittadino>                             <codiceSanitarioCittadino/>                             <idAnag/>                             <idCittadinoNonSiss/>                             <dataNascitaCittadino/>                             <datiOperatore/>                             <nPag/>                             <maxRecord/>                         </m:MIA.selPaz>                     </SOAP-ENV:Body>                 </SOAP-ENV:Envelope>",
headers:{"Content-type":"text/xml"},success:function(b){if(200!=b.status)msgShowError("",Ext.String.format(traduci("MSG_INTEGRAZIONE_XML_ERROR"),"SISSWAY",repsonse.statusText));else if(b=b.responseXML){b=b.getElementsByTagName("assistito").item(0);var g=function(b,c){c=void 0===c?function(){return null}:c;for(var d=b.children,f=0,h=d.length;f<h;f++){var k=d[f];null!=k.firstChild&&0==k.children.length?c(k,b):g(k,c)}};if(b){b=b.getElementsByTagName("datiCittadino").item(0);var k=null;g(b,function(b,
c){f[b.nodeName]&&(k||(k={}),k[f[b.nodeName]]=b.firstChild.nodeValue)});null!=k&&(k.statoCivile&&(b=d.decodeCmp(k.statoCivile,MdwTipi.enumTipi.STATO_CIVILE.id),delete k.statoCivile,b&&(k.statoCivile=b)),k.gradoIstruzione&&(b=d.decodeCmp(k.gradoIstruzione,MdwTipi.enumTipi.TITOLO_STUDIO.id),delete k.gradoIstruzione,b&&(k.gradoIstruzione=b)),k.comuneNascita&&(k.nazioneNascita="0",k.cittadinanza="0",k.note=""),k.dataNascita&&(k.dataNascita=Ext.Date.parse(k.dataNascita,"Ymd")),k=d.mapping(k),k.indResidenza&&
(k.indResidenza.tipoIndirizzo="R",k.indResidenza.nazione="0",k.indResidenza.dataDecorrenza=new Date),b=Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite").insert(0,k),c(b[0]))}}},failure:function(b){b.responseText&&msgShowError("",Ext.String.format(traduci("MSG_INTEGRAZIONE_XML_ERROR"),"SISSWAY",b.responseText))}})}}});
Ext.define("GeneraliOSP.integrazioni.MdwSorgenti",{alternateClassName:"MdwSorgenti",SISSWAY:traduci("MDW_SISSWAY"),SYNLAB:traduci("MDW_SYNLAB"),MOBTECT:traduci("MDW_MOBTEC"),NETHOSPITAL:traduci("MDW_NETHOSPITAL"),statics:{enumSorgenti:{NETHOSPITAL:{id:1,descrizione:this.NETHOSPITAL},SYNLAB:{id:2,descrizione:this.SYNLAB},MOBTECT:{id:4,descrizione:this.MOBTECT},SISSWAY:{id:10,descrizione:this.SISSWAY}}}});
Ext.define("GeneraliOSP.integrazioni.MdwTipi",{alternateClassName:"MdwTipi",REPARTI:traduci("MDW_REPARTI"),DIVISIONI:traduci("MDW_DIVISIONI"),TITOLO_DI_STUDIO:traduci("MDW_TITOLO_STUDIO"),PROFESSIONI:traduci("MDW_PRFESSIONI"),TIPOLOGIA_CARTELLA:traduci("MDW_TIPOLOGIA_CARTELLA"),LATERALITA:traduci("MDW_LATERALITA"),STATO_CIVILE:traduci("MDW_STATO_CIVILE"),SERVIZIO_CU:traduci("MDW_SERVIZIO_CU"),statics:{enumTipi:{REPARTI:{id:1,descrizione:this.REPARTI},DIVISIONI:{id:2,descrizione:this.DIVISIONI},TITOLO_STUDIO:{id:5,
descrizione:this.TITOLO_DI_STUDIO},PROFESSIONI:{id:6,descrizione:this.PROFESSIONI},TIPOLOGIA_CARTELLA:{id:7,descrizione:this.TIPOLOGIA_CARTELLA},LATERALITA:{id:8,descrizione:this.LATERALITA},STATO_CIVILE:{id:11,descrizione:this.STATO_CIVILE},SERVIZIO_CU:{id:12,descrizione:this.SERVIZIO_CU}}}});
Ext.define("GeneraliOSP.integrazioni.controller.GridResult",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grid",selector:this.selContainer+"#Grid"},{ref:"BtnConferma",selector:this.selContainer+"#BtnConferma"},{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"}]);this.control(this.selContainer+"#BtnConferma",{click:this.clickBtnConferma});this.control(this.selContainer+"#BtnEsci",{click:this.clickBtnEsci});
this.control(this.selContainer+"#Grid",{select:this.selectGrid,itemdblclick:this.itemdblclick})},selectGrid:function(b,c){this.getBtnConferma().setDisabled(!c)},itemdblclick:function(b,c){this.conferma_esci()},conferma_esci:function(){var b=this.getGrid(),c=b.getSelectionModel().getSelection()[0];this.cbaConfig.close_cb(c);b.up("window").close()},clickBtnConferma:function(b){this.conferma_esci()},clickBtnEsci:function(b){b.up("window").close()},onLaunch:function(){var b=this.getGrid().getStore();
b.getProxy().urlGen="/ws/genOsp/anagrafica/esterna/search";ImpostaUrl([b]);Ext.Ajax.request({method:"POST",url:b.getProxy().url,jsonData:Ext.JSON.encode(this.cbaConfig.searchParam),timeout:36E5,success:function(c){c=Ext.JSON.decode(c.responseText);var d=c.message,f=c.data;c.success?f?b.loadData(f):msgShowWarning("ATTENZIONE","NESSUN_DATO_TROVATO_RICERCA"):msgShowError("",d)},failure:function(b){msgShowError("",b.result.message)}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.integrazioni.view.GridResult",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"Grid",reference:"Grid",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Ospite"),viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",text:"COGNOME",dataIndex:"cognome",width:200},{xtype:"gridcolumn",text:"NOME",dataIndex:"nome",width:150},{xtype:"gridcolumn",text:"CODICE_FISCALE",dataIndex:"codiceFiscale",width:150},
{xtype:"datecolumn",text:"DATA_NASCITA",dataIndex:"dataNascita",format:"d/m/Y",width:90},{xtype:"gridcolumn",text:"LUOGO_NASCITA",dataIndex:"desComuneNascita",renderer:function(b,c,d,f,g,h){return d.get("nazioneNascita")&&"0"!=d.get("nazioneNascita")?d.get("desNazioneNascita"):d.get("desComuneNascita")},flex:1}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:"SELEZIONA_ESCI",disabled:!0},{xtype:"button",itemId:"BtnEsci",
reference:"BtnEsci",iconCls:"icon-esci",text:"ESCI"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.medicoCurante.controller.MedicoCurante",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"GridMedico",selector:this.selContainer+"#GridMedico"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"colMedico",
selector:this.selContainer+"#colMedico"}]);this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#BtnEsci",{click:this.clickBtnEsci});this.control(this.selContainer+"#GridMedico",{beforeedit:this.beforeeditGridMedico,edit:this.editGridMedico,canceledit:this.canceleditGridMedico,validateedit:this.validateeditGridMedico})},clickBtnEsci:function(b){b.up("window").close()},clickBtnNuovo:function(b){b=
this.getGridMedico();var c=b.getStore(),d={codiceEnte:CBA.parametriGenerali.codEnte,data:new Date,idOrganizzazione:getIdOrg(),codOspite:this.cbaConfig.codOspite,isMedicoInterno:!0},c=c.insert(0,d);b.getSelectionModel().select(c);b.getPlugin().startEdit(c[0],0);this.abilitaBottoniGrid(!1)},clickBtnElimina:function(b){var c=this;b=c.getGridMedico();var d=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:d?d.get("id"):""},function(){c.aggiornaStore()})},beforeeditGridMedico:function(b,
c,d){if(!0===b.editing)return!1;this.getColMedico().bindStore(this.storeMedici);this.abilitaBottoniGrid(!1)},editGridMedico:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();f.controller=this;f.store=c.view.getStore();Ext.apply(d,{isMedicoInterno:getBoolValue(d.isMedicoInterno)});delete d.desMedico;delete d.sipcarModule;delete d.raggruppamento;delete d.medicoSpecializzazione;delete d.medicoTel;delete d.medicoEmail;delete d.medicoCodFisc;controller_salvaRecord(f,d,!1,!1)?this.abilitaBottoniGrid(!0):
b.startEdit(c.record,0)},canceleditGridMedico:function(b,c,d){this.abilitaBottoniGrid(!0);this.aggiornaStore(c.record.get("id"))},validateeditGridMedico:function(b,c,d){return msgShow("",[])},abilitaBottoniGrid:function(b){this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b);this.getBtnEsci().setDisabled(!b)},aggiornaStore:function(b){var c=this.getGridMedico(),d=c.getStore();d.load({params:{idOrg:getIdOrg(),codOspite:this.cbaConfig.codOspite},callback:function(f,g,h){if(h){var k;
b&&(k=trovaRecord(d,"id",b));c.getSelectionModel().select(k?[k]:0)}else msgShowError("",g.getError())}})},onLaunch:function(){this.cbaConfig.urlGen&&ImpostaUrl([getColGrid(this.getGridMedico(),"idMedico").editor.store,this.getGridMedico().getStore()]);this.storeMedici=Ext.create("GeneraliOSP.medicoCurante.store.Medici");ImpostaUrl([this.storeMedici]);loadStore(this.storeMedici,{idOrg:getIdOrg()});this.getGridMedico().controller=this;this.aggiornaStore()}});
Ext.define("GeneraliOSP.medicoCurante.store.Medici",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/medici/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.medicoCurante.store.MedicoCurante",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"codiceEnte"},{name:"idOrganizzazione"},{name:"codOspite"},{name:"idMedico"},{name:"isMedicoInterno"},{name:"data",type:"date"},{name:"desMedico"},{name:"raggruppamento",convert:function(b,c){return"T"==c.get("isMedicoInterno")?traduci("MEDICO_INTERNO"):traduci("MEDICO_MEDICINA_GEN")}},{name:"medicoCodFisc"},{name:"medicoEmail"},{name:"medicoTel"},{name:"medicoSpecializzazione"}],proxy:{type:"ajax",
urlGen:"/ws/genOsp/users/medico/search",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/ws/genOsp/users/medico/search",create:"/ws/genOsp/users/medico/new",update:"/ws/genOsp/users/medico/update",destroy:"/ws/genOsp/users/medico/delete"}},groupField:"raggruppamento",autoDestroy:!0});
Ext.define("GeneraliOSP.medicoCurante.view.MedicoCurante",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridMedico",reference:"GridMedico",store:Ext.create("GeneraliOSP.medicoCurante.store.MedicoCurante"),columns:[{xtype:"datecolumn",text:"DATA_DECORRENZA",width:100,dataIndex:"data",format:"d/m/Y",editor:{xtype:"datefield",allowBlank:!1}},{xtype:"gridcolumn",text:"MEDICO",flex:1,dataIndex:"idMedico",
editor:{xtype:"combobox",itemId:"colMedico",reference:"colMedico",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("GeneraliOSP.medicoCurante.store.Medici"),allowBlank:!1},renderer:function(b,d,f,g,h,k,l){return f.get("desMedico")}},{xtype:"gridcolumn",text:"MEDICO_INTERNO",dataIndex:"isMedicoInterno",align:"center",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"},renderer:function(b,d,f,g,h,k,l){return renderCheckColumn(d,b)}},{xtype:"gridcolumn",text:"TIPO_MEDICO",
dataIndex:"medicoSpecializzazione",flex:1},{xtype:"gridcolumn",text:"COD_FISCALE",dataIndex:"medicoCodFisc",flex:1},{xtype:"gridcolumn",text:"EMAIL",dataIndex:"medicoEmail",flex:1},{xtype:"gridcolumn",text:"TELEFONO",dataIndex:"medicoTel",flex:1}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}],dockedItems:[{xtype:"toolbar",dock:b?"bottom":"top",layout:{pack:b?"end":null},items:[{xtype:"button",
itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:b?null:"icon-inserisciGriglia",cls:b?"cbaCssBtnFunzione":null,text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:b?null:"icon-eliminaGriglia",cls:b?"cbaCssBtnFunzione":null,text:"Elimina"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:b?null:"icon-esciGriglia",cls:b?"cbaCssBtnFunzione":null,nonDisabilitare:!0,text:"Esci"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.modelliFattura.controller.ModelliFattura",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"GridMovimenti",selector:this.selContainer+"#GridMovimenti"},{ref:"ModelliFattura_uploadLogoSx",selector:this.selContainer+
"#ModelliFattura_uploadLogoSx"},{ref:"ModelliFattura_uploadLogoDx",selector:this.selContainer+"#ModelliFattura_uploadLogoDx"},{ref:"ModelliFattura_LogoSx",selector:this.selContainer+"#ModelliFattura_LogoSx"},{ref:"ModelliFattura_LogoDx",selector:this.selContainer+"#ModelliFattura_LogoDx"},{ref:"LogoSx",selector:this.selContainer+"#LogoSx"},{ref:"LogoDx",selector:this.selContainer+"#LogoDx"},{ref:"CntIntestazione",selector:this.selContainer+"#CntIntestazione"},{ref:"CntDatiUtente",selector:this.selContainer+
"#CntDatiUtente"},{ref:"tipoModello",selector:this.selContainer+"#tipoModello"},{ref:"EsponiQuoteAltriPaganti",selector:this.selContainer+"#EsponiQuoteAltriPaganti"},{ref:"EsponiQuoteExtraRettaAltri",selector:this.selContainer+"#EsponiQuoteExtraRettaAltri"},{ref:"EsponiQuotePensioneAltri",selector:this.selContainer+"#EsponiQuotePensioneAltri"},{ref:"NascondiDettagliZero",selector:this.selContainer+"#NascondiDettagliZero"},{ref:"NascondiUtentiZero",selector:this.selContainer+"#NascondiUtentiZero"},
{ref:"gridCampiUtente",selector:this.selContainer+"#gridCampiUtente"},{ref:"noteSplitPayment",selector:this.selContainer+"#noteSplitPayment"},{ref:"tabPanelModelloFatt",selector:this.selContainer+"#tabPanelModelloFatt"}]);this.control(this.selContainer+"#tabPanelModelloFatt",{tabchange:this.tabPanelModelloFattChange});this.control(this.selContainer+"#GridMovimenti",{select:this.selectGridMovimenti});this.control(this.selContainer+"#ModelliFattura_uploadLogoSx",{change:this.uploadLogo});this.control(this.selContainer+
"#ModelliFattura_uploadLogoDx",{change:this.uploadLogo});this.control(this.selContainer+"#ModelliFattura_LogoSx",{render:this.renderLogo});this.control(this.selContainer+"#ModelliFattura_LogoDx",{render:this.renderLogo});this.control(this.selContainer+"#CntIntestazione",{render:this.renderCntIntestazione});this.control(this.selContainer+"#CntDatiUtente",{render:this.renderCntDatiUtente});this.control(this.selContainer+"#btnSbiancaSX",{click:this.sbiancaLogo});this.control(this.selContainer+"#btnSbiancaDX",
{click:this.sbiancaLogo});this.control(this.selContainer+"#EsponiQuoteAltriPaganti",{change:this.changeEsponiQuoteAltriPaganti});this.control(this.selContainer+"#NascondiDettagliZero",{change:this.changeNascondiDettagliZero})},changeNascondiDettagliZero:function(b,c,d,f){this.getNascondiUtentiZero().setVisible(c);c||this.getNascondiUtentiZero().setValue(c)},tabPanelModelloFattChange:function(b,c,d,f){"tpModFatIntestazione"==c.getItemId()&&"S"==this.cbaConfig.permesso?(this.getBoxBottoni().queryById("btnNuovo").enable(),
this.getBoxBottoni().queryById("btnElimina").enable()):(this.getBoxBottoni().queryById("btnNuovo").disable(),this.getBoxBottoni().queryById("btnElimina").disable())},changeEsponiQuoteAltriPaganti:function(b,c,d,f){50!=getModuloAttivo()&&(this.getEsponiQuoteExtraRettaAltri().setVisible(c),this.getEsponiQuotePensioneAltri().setVisible(c))},renderLogo:function(b){"L"!=this.permesso&&getPopupMenuFoto(b)},selectGridMovimenti:function(b,c){this.loadedData=!1;clearForm(this.getForm());this.getForm().loadRecord(c);
this.loadedData=!0;var d=this.getModelliFattura_LogoSx(),f=this.getModelliFattura_LogoDx();setSrcImage(d,"/cba/gen/ws/general/reports/design/download?imageFileName="+c.get("logoSx"));setSrcImage(f,"/cba/gen/ws/general/reports/design/download?imageFileName="+c.get("logoDx"))},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow("",b);return 0==b.length?!0:!1},salvaForm:function(b){var c=this.getForm();if(!this.verificaCampiForm())return!1;var d=
c.getForm().getFieldValues();c.getForm().getFields().each(function(b){b.isFileUpload()&&delete d[b.getName()]});Ext.apply(d,{idOrganizzazione:this.cbaConfig.idOrganizzazione,scadenzaFattura:getBoolValue(d.scadenzaFattura),periodoFatturazione:getBoolValue(d.periodoFatturazione),stampaRegistroFattura:getBoolValue(d.stampaRegistroFattura),stampaAnnoFattura:getBoolValue(d.stampaAnnoFattura),scadenzaFattura:getBoolValue(d.scadenzaFattura),esponiQuoteAltriPaganti:getBoolValue(d.esponiQuoteAltriPaganti),
esponiQuoteExtraRettaAltri:d.esponiQuoteAltriPaganti?getBoolValue(d.esponiQuoteExtraRettaAltri):"F",esponiQuotePensioneAltri:d.esponiQuoteAltriPaganti?getBoolValue(d.esponiQuotePensioneAltri):"F",nascondiQuotaRetta:getBoolValue(d.nascondiQuotaRetta),nascondiIntestazionePagante:getBoolValue(d.nascondiIntestazionePagante),nascondiDettagliZero:getBoolValue(d.nascondiDettagliZero),nascondiUtentiZero:getBoolValue(d.nascondiUtentiZero),esponiAlLordoPensioni:getBoolValue(d.esponiAlLordoPensioni),esponiImportoSanitario:getBoolValue(d.esponiImportoSanitario),
esponiImportoSociale:getBoolValue(d.esponiImportoSociale)});controller_salvaRecord(c,d,b)&&b&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var b=this,c=b.getForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=b.getGridMovimenti().getStore();c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},annulla_callback:function(){b.getModelliFattura_uploadLogoSx().fileInputEl.dom.value=
"";b.getModelliFattura_uploadLogoDx().fileInputEl.dom.value="";b.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(c);c.getForm().setValues({dataDal:new Date,tipoImporto:"P"})},elimina_callback:function(){var d=c.getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,{id:d},function(){b.aggiornaStore()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(c.boxBottoni,d);c.boxBottoni.queryById("btnEsci").hide();if("L"!=
c.permesso)c.getForm().on("dirtychange",function(d,g){controller_abilitaBottoni(c);b.getGridMovimenti().setDisabled(g)})},aggiornaStore:function(b){var c=this,d=c.getForm(),f=d.store;f.load({params:{idOrganizzazione:c.cbaConfig.idOrganizzazione},callback:function(g,h,k){k?Ext.isEmpty(g)?(clearForm(d),c.getEsponiQuoteExtraRettaAltri().hide(),c.getEsponiQuotePensioneAltri().hide(),g=c.getModelliFattura_LogoSx(),h=c.getModelliFattura_LogoDx(),setSrcImage(g,"#"),setSrcImage(h,"#")):(g=c.getGridMovimenti(),
h=b?trovaRecord(f,"id",b):g.getSelectionModel().getSelected().items[0],g.getSelectionModel().deselectAll(),g.getSelectionModel().select(h?[h]:0)):msgShowError("",h.getError())}})},uploadLogo:function(b,c,d){var f=this;itemIdFilefield=b.getItemId();tipoLogo="logo"+itemIdFilefield.substr(itemIdFilefield.length-2);pos=c.lastIndexOf("\\")||c.lastIndexOf("/");form=b.up().up().getForm();strUrl="/cba/gen/ws/general/reports/design/upload";c=c.substring(pos+1);""!==c&&(b=b.fileInputEl.dom.files[0],c=new FormData,
c.append("file",b),Ext.Ajax.request({url:strUrl,method:"POST",rawData:c,headers:{"Content-Type":null},success:function(b){var c=Ext.JSON.decode(b.responseText);if(c.success){c.message&&msgShowText("TRASFERIMENTO_FILE",c.message);var d;"logoSx"==tipoLogo?(b=f.getModelliFattura_LogoSx(),d=f.getLogoSx()):(b=f.getModelliFattura_LogoDx(),d=f.getLogoDx());var c=c.data,g=c.lastIndexOf("/"),c=c.substring(g+1),c=c.replace('"}',"");setSrcImage(b,"/cba/gen/ws/general/reports/design/download?imageFileName="+
c);d.setValue(c)}else msgShowError("",c.message)}}))},sbiancaLogo:function(b){var c=this;b=b.getItemId().substring(10);var d=null,f=null;"SX"==b?(d=c.getModelliFattura_LogoSx(),f=c.getLogoSx()):(d=c.getModelliFattura_LogoDx(),f=c.getLogoDx());var g=c.getForm().getValues().id;Ext.Ajax.request({method:"GET",url:"/cba/osp/co/ws/rette/modfatt/deleteLogo?id="+g+"&isLogoSx="+("SX"==b?"T":"F")+"&imageFileName="+f.getValue(),success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(setSrcImage(d,"#"),
f.setValue(""),c.getModelliFattura_uploadLogoSx().fileInputEl.dom.value="",c.getModelliFattura_uploadLogoDx().fileInputEl.dom.value=""):msgShowError("",b.message)}})},renderCntIntestazione:function(){var b=this.getForm(),c=b.body,c=this.getCntIntestazione().getId();"S"==this.cbaConfig.permesso&&(this.formPanelDropTarget=new Ext.dd.DropTarget(c,{ddGroup:"gridIntestazione",notifyDrop:function(c,f,g){c=c.dragData.records[0];(f=b.getForm().findField(f.getTarget().name))&&f.setValue(f.getValue()+c.get("codice"));
return!0}}))},renderCntDatiUtente:function(){var b=this.getForm(),c=b.body,c=this.getCntDatiUtente().getId();"S"==this.cbaConfig.permesso&&(this.formPanelDropTarget=new Ext.dd.DropTarget(c,{ddGroup:"gridDatiUtente",notifyDrop:function(c,f,g){c=c.dragData.records[0];(f=b.getForm().findField(f.getTarget().name))&&f.setValue(f.getValue()+c.get("codice"));return!0}}))},onLaunch:function(){this.getTipoModello().getStore().load();this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);
this.callParent()}});Ext.define("GeneraliOSP.modelliFattura.store.CampiIntestazione",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/prszn/rpt/fields/organization",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.modelliFattura.store.CampiUtente",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/prszn/rpt/fields/user",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.modelliFattura.store.ModelliFattura",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"tipoImporto"},{name:"nomeModello"},{name:"noteIntestazione"},{name:"noteCorpo"},{name:"noteSplitPayment"},{name:"notePiePagina"},{name:"numeroTelefono"},{name:"logoSx"},{name:"logoDx"},{name:"rigaIntestazione1"},{name:"rigaIntestazione2"},{name:"rigaIntestazione3"},{name:"rigaIntestazione4"},{name:"stampaRegistroFattura"},{name:"campoOspite1"},{name:"campoOspite2"},
{name:"campoOspite3"},{name:"campoOspite4"},{name:"stampaAnnoFattura"},{name:"scadenzaFattura"},{name:"periodoFatturazione"},{name:"tipoModello"},{name:"esponiQuoteAltriPaganti"},{name:"esponiQuoteExtraRettaAltri"},{name:"esponiQuotePensioneAltri"},{name:"nascondiQuotaRetta"},{name:"nascondiIntestazionePagante"},{name:"nascondiDettagliZero"},{name:"nascondiUtentiZero"},{name:"esponiAlLordoPensioni"},{name:"esponiImportoSanitario"},{name:"esponiImportoSociale"}],proxy:{url:"/cba/osp/co/ws/rette/modfatt/src",
api:{read:"/cba/osp/co/ws/rette/modfatt/src",create:"/cba/osp/co/ws/rette/modfatt/new",update:"/cba/osp/co/ws/rette/modfatt/update",destroy:"/cba/osp/co/ws/rette/modfatt/delete"}}});Ext.define("GeneraliOSP.modelliFattura.store.TipoStampa",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/rette/modfatt/tipo/cbox",reader:{type:"json"}}});
Ext.define("GeneraliOSP.modelliFattura.view.ModelliFattura",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"gridpanel",itemId:"GridMovimenti",reference:"GridMovimenti",flex:1,title:"Elenco",height:120,store:Ext.create("GeneraliOSP.modelliFattura.store.ModelliFattura"),columns:[{xtype:"gridcolumn",dataIndex:"nomeModello",text:"NOME_MODELLO",flex:1}],viewConfig:{loadMask:!1}},
{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]},{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"tabpanel",border:0,activeTab:0,width:700,itemId:"tabPanelModelloFatt",reference:"tabPanelModelloFatt",items:[{xtype:"panel",title:"INTESTAZIONE",itemId:"tpModFatIntestazione",reference:"tpModFatIntestazione",items:[{xtype:"textfield",width:440,fieldLabel:"NOME_MODELLO",allowBlank:!1,
name:"nomeModello",labelClsExtra:"cbaLabel",margin:"5 0 0 5",maxLength:80,enforceMaxLength:!0},{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"textfield",name:"logoSx",itemId:"LogoSx",reference:"LogoSx",hidden:!0,maxLength:50,enforceMaxLength:!0},{xtype:"textfield",name:"logoDx",itemId:"LogoDx",reference:"LogoDx",hidden:!0,maxLength:50,enforceMaxLength:!0},{xtype:"container",margin:"10 0 10 5",defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},
items:[{xtype:"form",bodyPadding:"0 0 5 0",layout:{align:"center",type:"vbox"},itemId:"cntLogoSX",reference:"cntLogoSX",items:[{xtype:"container",itemId:"cntTitoloSX",reference:"cntTitoloSX",layout:{align:"center",type:"hbox"},items:[{xtype:"panel",layout:{align:"center",type:"vbox"},border:!1,title:"LOGOSX",items:[],titleAlign:"left",width:88,height:25},{xtype:"filefield",itemId:"ModelliFattura_uploadLogoSx",reference:"ModelliFattura_uploadLogoSx",cls:"cba-stdbutton-25",name:"f_logoSx",isFormField:!1,
clearOnSubmit:!0,buttonOnly:!0,width:25,height:25,buttonConfig:{xtype:"filebutton",width:25,height:25,iconCls:"icon-allegato"}},{xtype:"button",itemId:"btnSbiancaSX",reference:"btnSbiancaSX",width:25,height:25,iconCls:"icon-elimina",cls:"cba-stdbutton-25",tooltip:traduci("SBIANCA_LOGO")}]},{xtype:"container",itemId:"cntImgSX",reference:"cntImgSX",layout:{align:"center",type:"vbox"},items:[{xtype:"image",height:50,width:100,itemId:"ModelliFattura_LogoSx",reference:"ModelliFattura_LogoSx"}]}]},{xtype:"form",
bodyPadding:"0 0 5 0",layout:{align:"center",type:"vbox"},itemId:"cntLogoDX",reference:"cntLogoDX",items:[{xtype:"container",itemId:"cntTitoloDX",reference:"cntTitoloDX",layout:{align:"center",type:"hbox"},items:[{xtype:"panel",layout:{align:"center",type:"vbox"},border:!1,title:"LOGODX",items:[],titleAlign:"left",width:88,height:25},{xtype:"filefield",itemId:"ModelliFattura_uploadLogoDx",reference:"ModelliFattura_uploadLogoDx",cls:"cba-stdbutton-25",buttonOnly:!0,name:"f_logoDx",isFormField:!1,clearOnSubmit:!0,
width:25,height:25,buttonConfig:{xtype:"filebutton",width:25,height:25,iconCls:"icon-allegato"}},{xtype:"button",itemId:"btnSbiancaDX",reference:"btnSbiancaDX",width:25,height:25,iconCls:"icon-elimina",cls:"cba-stdbutton-25",tooltip:traduci("SBIANCA_LOGO")}]},{xtype:"container",itemId:"cntImgDX",reference:"cntImgDX",layout:{align:"center",type:"vbox"},items:[{xtype:"image",height:50,width:100,itemId:"ModelliFattura_LogoDx",reference:"ModelliFattura_LogoDx"}]}]},{xtype:"combobox",margin:"0 0 0 0",
width:250,fieldLabel:"TIPO_STAMPA",labelAlign:"top",labelPad:4,store:Ext.create("GeneraliOSP.modelliFattura.store.TipoStampa",{autoload:!1}),queryMode:"local",labelClsExtra:"cbaLabel",valueField:"codice",displayField:"valore",itemId:"tipoModello",reference:"tipoModello",name:"tipoModello",allowBlank:!0}]},{xtype:"fieldset",title:"INTESTAZIONE",margin:"0 0 0 5",width:470,items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",itemId:"CntIntestazione",reference:"CntIntestazione",margin:"0 10 0 0",
items:[{xtype:"label",margin:"0 0 20 0",text:"RIGA_INTESTAZIONE",cls:"cbaLabel"},{xtype:"textfield",labelWidth:10,width:260,fieldLabel:"1",name:"rigaIntestazione1",labelClsExtra:"cbaLabel",maxLength:100,enforceMaxLength:!0,margin:"5 0 0 0"},{xtype:"textfield",labelWidth:10,width:260,fieldLabel:"2",name:"rigaIntestazione2",labelClsExtra:"cbaLabel",maxLength:100,enforceMaxLength:!0},{xtype:"textfield",labelWidth:10,width:260,fieldLabel:"3",name:"rigaIntestazione3",labelClsExtra:"cbaLabel",maxLength:100,
enforceMaxLength:!0},{xtype:"textfield",labelWidth:10,width:260,fieldLabel:"4",name:"rigaIntestazione4",labelClsExtra:"cbaLabel",maxLength:100,enforceMaxLength:!0}]},{xtype:"gridpanel",height:130,width:150,margin:"0 0 5 0",store:Ext.create("GeneraliOSP.modelliFattura.store.CampiIntestazione",{autoLoad:!0}),columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"CAMPI",flex:1}],enableDragDrop:!0,viewConfig:{loadMask:!1,plugins:{ddGroup:"gridIntestazione",ptype:"gridviewdragdrop",enableDrop:!1}}}]},{xtype:"container",
itemId:"cntCheckBox",reference:"cntCheckBox",layout:{type:"hbox"},items:[{xtype:"container",itemId:"cntCheckBoxSX",reference:"cntCheckBoxSX",width:200,layout:{type:"vbox"},items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"SCADENZA_FATTURA",inputValue:"T",uncheckedValue:"F",name:"scadenzaFattura"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"PERIODO_FATTURAZIONE",inputValue:"T",uncheckedValue:"F",name:"periodoFatturazione"},{xtype:"checkboxfield",cls:"cbaLabel",
fieldLabel:"",boxLabel:"NASCONDI_DATI_PAGANTE",inputValue:"T",uncheckedValue:"F",name:"nascondiIntestazionePagante"}]},{xtype:"container",itemId:"cntCheckBoxDX",reference:"cntCheckBoxDX",flex:1,layout:{type:"vbox"},items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"STAMPA_REGISTRO_FATTURA",inputValue:"T",uncheckedValue:"F",name:"stampaRegistroFattura"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"STAMPA_ANNO_FATTURA",inputValue:"T",uncheckedValue:"F",name:"stampaAnnoFattura"}]}]}]}]},
{xtype:"panel",title:"DATI_UTENTE",itemId:"tpModFatDatiUtente",reference:"tpModFatDatiUtente",items:[{xtype:"fieldset",title:"DATI_UTENTE",width:470,margin:"5 0 0 5",items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",itemId:"CntDatiUtente",reference:"CntDatiUtente",items:[{xtype:"label",margin:"0 0 20 0",text:"RIGA_UTENTE",cls:"cbaLabel"},{xtype:"textfield",labelWidth:10,width:260,fieldLabel:"1",name:"campoOspite1",labelClsExtra:"cbaLabel",margin:"5 0 0 0"},{xtype:"textfield",labelWidth:10,
width:260,fieldLabel:"2",name:"campoOspite2",labelClsExtra:"cbaLabel"},{xtype:"textfield",labelWidth:10,width:260,fieldLabel:"3",name:"campoOspite3",labelClsExtra:"cbaLabel"},{xtype:"textfield",labelWidth:10,width:260,fieldLabel:"4",name:"campoOspite4",labelClsExtra:"cbaLabel"}]},{xtype:"gridpanel",itemId:"gridCampiUtente",reference:"gridCampiUtente",height:130,width:150,margin:"0 0 10 10",store:Ext.create("GeneraliOSP.modelliFattura.store.CampiUtente",{autoLoad:!0}),columns:[{xtype:"gridcolumn",
dataIndex:"valore",text:"CAMPI",flex:1}],enableDragDrop:!0,viewConfig:{loadMask:!1,plugins:{ddGroup:"gridDatiUtente",ptype:"gridviewdragdrop",enableDrop:!1}}}]}]},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"NASCONDI_QUOTE_RETTA_FATTURA",inputValue:"T",uncheckedValue:"F",name:"nascondiQuotaRetta",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"STAMPA_QUOTE_RIEPILOGO_PAGANTI",inputValue:"T",uncheckedValue:"F",itemId:"EsponiQuoteAltriPaganti",reference:"EsponiQuoteAltriPaganti",
name:"esponiQuoteAltriPaganti",margin:"0 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"STAMPA_QUOTE_EXTRARETTA_ALTRI",inputValue:"T",uncheckedValue:"F",hidden:!0,itemId:"EsponiQuoteExtraRettaAltri",reference:"EsponiQuoteExtraRettaAltri",name:"esponiQuoteExtraRettaAltri",margin:"0 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"STAMPA_QUOTE_PENSIONE_ALTRI",inputValue:"T",uncheckedValue:"F",hidden:!0,itemId:"EsponiQuotePensioneAltri",reference:"EsponiQuotePensioneAltri",
name:"esponiQuotePensioneAltri",margin:"0 0 0 5"},{xtype:"container",layout:"hbox",items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"NASCONDI_DETTAGLI_A_ZERO",inputValue:"T",uncheckedValue:"F",itemId:"NascondiDettagliZero",reference:"NascondiDettagliZero",name:"nascondiDettagliZero",margin:"0 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"NascondiUtentiZero",reference:"NascondiUtentiZero",fieldLabel:"",boxLabel:"NASCONDI_UTENTI_A_ZERO",name:"nascondiUtentiZero",margin:"0 0 0 8",
hidden:!0,inputValue:"T",uncheckedValue:"F"}]},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"ESPONI_RETTA_AL_LORDO_PENSIONI",hidden:50==getModuloAttivo(),inputValue:"T",uncheckedValue:"F",name:"esponiAlLordoPensioni",margin:"0 0 0 5"},{xtype:"container",layout:"hbox",items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"ESPONI_IMPORTO_SANITARIO",inputValue:"T",uncheckedValue:"F",itemId:"ChkEsponiImportoSanitario",reference:"ChkEsponiImportoSanitario",name:"esponiImportoSanitario",
margin:"0 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"ESPONI_IMPORTO_ALBERGHIERO",inputValue:"T",uncheckedValue:"F",itemId:"ChkEsponiImportoSociale",reference:"ChkEsponiImportoSociale",name:"esponiImportoSociale",margin:"0 0 0 5"}]}]},{xtype:"panel",title:"NOTE",itemId:"tpModFatNote",reference:"tpModFatNote",items:[{xtype:"htmleditor",height:90,fieldLabel:"NOTE_INTESTAZIONE",labelAlign:"top",name:"noteIntestazione",labelClsExtra:"cbaLabel",margin:"5 0 0 5"},{xtype:"htmleditor",
itemId:"NoteCorpo",reference:"NoteCorpo",margin:"10 0 0 5",height:90,fieldLabel:"NOTE_CORPO",name:"noteCorpo",labelAlign:"top",labelClsExtra:"cbaLabel"},{xtype:"htmleditor",margin:"10 0 0 5",height:90,fieldLabel:"NOTE_SPLIT_PAYMENT",name:"noteSplitPayment",labelAlign:"top",labelClsExtra:"cbaLabel"},{xtype:"htmleditor",itemId:"notePiePagina",reference:"notePiePagina",margin:"10 0 0 5",height:90,fieldLabel:"NOTE_PIE_PAGINA",name:"notePiePagina",labelAlign:"top",labelClsExtra:"cbaLabel"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.movimentazione.controller.ListMovimenti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"GridMovimenti",selector:this.selContainer+"#GridMovimenti"}]);this.control(this.selContainer+"#GridMovimenti",{select:this.selectGrid});this.callParent(arguments)},selectGrid:function(b,c,d){b=this.controller_main.testata;this.controller_main.record=c.getData();b.controller.aggiornaStore(c.get("id"))},load:function(b){var c=
this;svuotaStore(c.store);c.store.load({params:{idRicovero:c.record.idRicovero},callback:function(d,f,g){g?(f=!1,b&&(f=trovaRecord(this,"id",b)),f||Ext.isEmpty(d)||(f=d[0]),f&&c.getGridMovimenti().setSelection(f)):msgShowError("",f.getError())}})},onLaunch:function(){var b=this.getGridMovimenti();if(this.abilitaGestioneOraria=this.controller_main.abilitaGestioneOraria){var c=b.getColumnManager().getHeaderByDataIndex("dataDal");c.format="d/m/Y H:i";c.setWidth(100)}this.store=b.getStore();ImpostaUrl([this.store])},
destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.movimentazione.controller.Main",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"CntTop",selector:this.selContainer+"#CntTop"},{ref:"CntBottom",selector:this.selContainer+"#CntBottom"}]);this.callParent(arguments)},onLaunch:function(){this.record=this.cbaConfig.record;this.abilitaGestioneOraria=this.cbaConfig.abilitaGestioneOraria;this.testata=Ext.create("GeneraliOSP.movimentazione.view.Testata",{controller_main:this,
record:this.record});this.list_movimenti=Ext.create("GeneraliOSP.movimentazione.view.ListMovimenti",{controller_main:this,record:this.record});this.getCntTop().add(this.testata);this.getCntBottom().add(this.list_movimenti);this.list_movimenti.controller.load(this.record.idRicovero)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.movimentazione.controller.Testata",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:this.selContainer+"#Form"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"OraDal",selector:this.selContainer+"#OraDal"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CntInfo",selector:this.selContainer+"#CntInfo"},{ref:"EditResSede",selector:this.selContainer+
"#EditResSede"},{ref:"EditResReparto",selector:this.selContainer+"#EditResReparto"},{ref:"EditResStanza",selector:this.selContainer+"#EditResStanza"},{ref:"EditResLetto",selector:this.selContainer+"#EditResLetto"},{ref:"BtnLettiLiberi",selector:this.selContainer+"#BtnLettiLiberi"},{ref:"TipoMovimento",selector:this.selContainer+"#TipoMovimento"}]);this.control(this.selContainer+"#EditResSede",{select:this.onEditResSedeSelect});this.control(this.selContainer+"#EditResReparto",{select:this.onEditResRepartoSelect});
this.control(this.selContainer+"#EditResStanza",{select:this.onEditResStanzaSelect});this.control(this.selContainer+"#BtnLettiLiberi",{click:this.onBtnLettiLiberiClick})},onBtnLettiLiberiClick:function(){StdUtenti.apriWindowLettiLiberi({permesso:this.cbaConfig.permesso,ggDecorrenza:new Date,formatoData:this.abilitaGestioneOraria?"d/m/Y H:i":"d/m/Y",usaDataDimPrev:"F",cb_salva:function(b){}})},impostaSRSL_daLettiLiberi:function(b){var c={};this.loadCbSRSL(this.getEditResSede(),c,b.idSede);Ext.apply(c,
{sede:b.idSede});this.loadCbSRSL(this.getEditResReparto(),c,b.idReparto);Ext.apply(c,{reparto:b.idReparto});this.loadCbSRSL(this.getEditResStanza(),c,b.idStanza);Ext.apply(c,{stanza:b.idStanza});this.loadCbSRSL(this.getEditResLetto(),c,b.idLetto)},loadCbSRSL:function(b,c,d){var f=b.getStore();c&&(f.getProxy().extraParams=c);f.load({callback:function(c,f,k){c&&(1==c.length||d)&&(d?b.setValue(d):(b.setValue(c[0].get("codice")),b.fireEvent("select",b)))}})},onEditResStanzaSelect:function(b,c,d){SvuotaCombo(this.getEditResLetto());
0<b.value&&this.loadCbSRSL(this.getEditResLetto(),{sede:this.getEditResSede().getValue(),reparto:this.getEditResReparto().getValue(),stanza:b.value})},onEditResRepartoSelect:function(b,c,d){SvuotaCombo(this.getEditResStanza());SvuotaCombo(this.getEditResLetto());0<b.value&&0<this.getEditResSede().getValue()&&this.loadCbSRSL(this.getEditResStanza(),{sede:this.getEditResSede().getValue(),reparto:b.value,tipologia:"UB"})},onEditResSedeSelect:function(b,c,d){SvuotaCombo(this.getEditResReparto());SvuotaCombo(this.getEditResStanza());
SvuotaCombo(this.getEditResLetto());0<b.value&&this.loadCbSRSL(this.getEditResReparto(),{sede:b.value,tipologia:"UB"})},nuovo:function(){controller_nuovoRecord(this.getForm());var b=new Date;this.getDataDal().setValue(b);this.abilitaGestioneOraria&&this.getOraDal().setValue(b);this.getForm().setDisabled(!1);1==this.getTipoMovimento().getStore().getCount()&&this.getTipoMovimento().setValue(this.getTipoMovimento().getStore().getAt(0).get("codice"))},verificaCampiForm:function(){var b=[];this.getForm().isValid()||
msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},onClickBtnValida:function(){this.validato=!0;this.salvaForm()},msgInSviluppo:function(b){var c=[];msgAddError(c,b);msgShow("",c);this.aggiornaStore()},salvaForm:function(b){var c={gestioneOraria:this.abilitaGestioneOraria},d=this.controller_main.record,f=this.getForm(),g=f.getForm().getFieldValues();0<g.id?Ext.apply(g,d):Ext.apply(g,{idRicovero:d.idRicovero});"M"==g.tipoRecord&&Ext.apply(g,{tipoRecord:"U",stato:"C"});"T"==g.tipoRecord?(Ext.apply(g,
{stato:"P",idRiferimento:g.id}),this.msgInSviluppo("MOVIMENTAZIONE TRASFERIMENTO IN SVILUPPO")):"A"==g.tipoRecord?this.msgInSviluppo("MOVIMENTAZIONE APPOGGIO IN SVILUPPO"):(this.validato&&Ext.apply(g,{stato:"C"}),this.abilitaGestioneOraria&&g.dataDal.setHours(Ext.util.Format.date(g.oraDal,"H"),Ext.util.Format.date(g.oraDal,"i")),delete g.oraDal,controller_salvaRecord(f,g,b,c)&&(this.controller_main.list_movimenti.controller.load(),b&&this.callbackEsci&&this.callbackEsci()))},gestioneForm:function(){var b=
this,c=b.getForm();b.abilitaGestioneOraria=b.controller_main.abilitaGestioneOraria;if(b.abilitaGestioneOraria){b.getOraDal().show();b.getOraDal().allowBlank=!1;var d=moment(b.getDataDal().getValue()),f=moment(b.getDataDal());f.set("hour",d.get("hour"));f.set("minute",d.get("minute"));b.getOraDal().setValue(f.toDate())}c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=Ext.create("GeneraliOSP.portlet.store.Residenziale");ImpostaUrl([b.storeForm]);c.controller=b;d=Ext.create("Generali.standard.controller_PannelloBottoni",
{cbaConfig:{nuovo_callback:function(){b.nuovo()},conferma_callback:function(c){b.salvaForm(c)},annulla_callback:function(){b.controller_main.list_movimenti.controller.load()},verificaCampiForm_callback:function(){return b.verificaCampiForm()},elimina_callback:function(){var d=c.getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,{id:d},function(){b.controller_main.list_movimenti.controller.load()})},esci_callback:function(){b.getForm().up("window").close();return!1}}});
inserisciBottoni(c.boxBottoni,d);if("L"!=c.permesso)c.getForm().on("dirtychange",function(b,d){c.isValid();controller_abilitaBottoni(c)})},abilitaForm:function(b){var c=this.getForm(),d=this.controller_main.list_movimenti.controller.getGridMovimenti();disable=!1;this.validato=!0;this.abilitaBottoni(disable);c.setDisabled(disable);c.getForm().loadRecord(b);b=d.getStore().getRange();var f=!1;disable||Ext.each(b,function(b){"C"!=b.get("stato")&&(f=!0)});c.boxBottoni.down("#btnNuovo").setDisabled(f)},
abilitaBottoni:function(b){this.getForm().boxBottoni.getChildItemsToDisable().forEach(function(c){"btnEsci"!=c.itemId&&c.setDisabled(!0===b)})},aggiornaStore:function(b){var c=this,d=c.getForm(),f=d.getForm();d.store.load({params:{idRicovero:c.record.idRicovero,panel:"U"},callback:function(d,h,k){k?(clearForm(c.getForm()),h=!1,b&&(h=trovaRecord(this,"id",b)),h||Ext.isEmpty(d)||(h=d[0]),h&&(c.abilitaGestioneOraria&&(h.data.oraDal=h.get("dataDal")),f.loadRecord(h),c.abilitaForm(h))):msgShowError("",
h.getError())}})},onLaunch:function(){this.gestioneForm();var b=this.getTipoMovimento().getStore();ImpostaUrl([b,this.getEditResSede().getStore(),this.getEditResReparto().getStore(),this.getEditResStanza().getStore(),this.getEditResLetto().getStore()]);this.loadCbSRSL(this.getEditResSede(),{},null);b=StdUtenti.promiseLoadStore(b,{soloSelezionabili:!0});Promise.all([b]).then(function(b){})["catch"](function(b){return msgShowError("",b)});this.getCntInfo().update(this.record)},destroy:function(){eliminaStore(this.storeForm);
this.callParent()}});Ext.define("GeneraliOSP.movimentazione.store.TipoMovResidenziale",{extend:"Generali.data.StoreCodiceValore",constructor:function(b){b=b||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/genOsp/sinottico/cboxTipoMov"}},b)])},autoDestroy:!0});
Ext.define("GeneraliOSP.movimentazione.view.ListMovimenti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridMovimenti",reference:"GridMovimenti",store:Ext.create("GeneraliOSP.portlet.store.Residenziale"),border:0,columns:[{xtype:"datecolumn",width:80,align:"center",dataIndex:"dataDal",text:"RES_INIZIO_UTILIZZO",format:"d/m/Y"},{xtype:"gridcolumn",dataIndex:"desSede",text:"SEDE",flex:1},{xtype:"gridcolumn",dataIndex:"desReparto",
text:"REPARTO",flex:1},{xtype:"gridcolumn",dataIndex:"desStanza",text:"STANZA",flex:1},{xtype:"gridcolumn",dataIndex:"desLetto",text:"LETTO",flex:1},{xtype:"gridcolumn",dataIndex:"tipoMov",text:"TIPO_MOVIMENTO",flex:1},{xtype:"gridcolumn",dataIndex:"desStato",text:"STATO",flex:1}],viewConfig:{loadMask:!1}}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.movimentazione.view.Main",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntTop",reference:"CntTop",layout:"fit",flex:1},{xtype:"panel",itemId:"CntBottom",reference:"CntBottom",height:130,autoScroll:!0,layout:{type:"fit"}}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.movimentazione.view.Testata",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",padding:3,layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",flex:1,itemId:"CntInfo",reference:"CntInfo",style:"background-color: #f9f9f9",tpl:new Ext.XTemplate('\n                <div style=\'display: flex; flex-direction: column; padding: 5px;\'>     \n                  <div style="display: flex; align-items: center; margin-bottom: 3px;">\n                    {[this.getImage(values)]}\n                    <span style="font-size: 12px; font-weight: bold; margin-left: 2px;">{taskTitle} ({eta})</span>\n                  </div>\n                  \n                  <div>\n                    <span style="font-size: 12px; color: #909090">'+
traduci("NOSOLOGICO")+': </span>\n                    <span style="font-size: 12px;">{[this.formatDate(values, \'desNos\')]}</span>\n                  </div>\n                                \n                  <div>\n                    <span style="font-size: 12px; color: grey;">{regimeRicovero}</span>\n                  </div>\n\n                  <div style="display: flex; align-items: center; padding: 2px;">\n                    <img style="height: 20px; pointer-events: none" class="icon-letto" src="'+
Ext.BLANK_IMAGE_URL+'"></img>\n                    <span style="font-size: 12px; font-weight: bold; margin-left: 5px;">{desSede} / {desReparto} / {desStanza} / {desLetto}</span>\n                  </div>\n                </div>\n              ',{formatDate:function(b,c){return b&&moment(b[c]).isAfter("2999-01-01")?null:FormattaData(b[c])},getImage:function(b){return'<img style="height: 22px; pointer-events: none" class="'+("R"==b.tipoRecord?"icon-accompany":"F"==b.sesso?"icon-female":"icon-male")+
'" src="'+Ext.BLANK_IMAGE_URL+'"></img>'}})},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni"}]},{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",layout:{type:"vbox",align:"stretch"},bodyPadding:"0 5 5 5",trackResetOnLoad:!0,items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"fieldset",padding:3,title:"TIPO_MOVIMENTO",layout:"hbox",items:[{xtype:"datefield",width:210,fieldLabel:"DATA_DAL",itemId:"DataDal",reference:"DataDal",labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:!1,
value:new Date},{xtype:"timefield",margin:"0 0 0 10",itemId:"OraDal",reference:"OraDal",width:140,fieldLabel:"ORA_INIZIO",labelClsExtra:"cbaLabel",labelWidth:80,name:"oraDal",value:"08:00",allowBlank:!0,format:"H:i",increment:30,hidden:!0},{xtype:"component",flex:1},{xtype:"combobox",itemId:"TipoMovimento",reference:"TipoMovimento",width:300,name:"tipoRecord",valueField:"codice",displayField:"valore",queryMode:"local",allowBlank:!1,store:Ext.create("GeneraliOSP.movimentazione.store.TipoMovResidenziale")}]},
{xtype:"fieldset",padding:3,title:"DESTINAZIONE",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"combobox",itemId:"EditResSede",reference:"EditResSede",flex:1,fieldLabel:"SEDE",labelClsExtra:"cbaLabel",name:"idSede",allowBlank:!1,displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Sedi"),valueField:"codice"},{xtype:"component",width:20},{xtype:"combobox",itemId:"EditResReparto",reference:"EditResReparto",flex:1,fieldLabel:"REPARTO",labelClsExtra:"cbaLabel",
name:"idReparto",allowBlank:!1,displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Reparti"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}}]},{xtype:"container",layout:"hbox",items:[{xtype:"combobox",itemId:"EditResStanza",reference:"EditResStanza",flex:1,fieldLabel:"STANZA",allowBlank:!0,labelClsExtra:"cbaLabel",name:"idStanza",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Stanze"),
valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"component",width:20},{xtype:"combobox",itemId:"EditResLetto",reference:"EditResLetto",flex:1,fieldLabel:"LETTO",allowBlank:!0,labelClsExtra:"cbaLabel",name:"idLetto",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Letti"),valueField:"codice",matchFieldWidth:!1,listConfig:{width:300},listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"component",width:20},
{xtype:"button",cls:49===CBA.moduli.moduloAttivo?"cbaCssBtnFunzione":"cba-button-25",itemId:"BtnLettiLiberi",reference:"BtnLettiLiberi",width:100,iconCls:"icon-lettiLiberi",text:"LETTI_LIBERI"}]}]},{xtype:"fieldset",padding:3,title:"MOTIVO_RICHIESTA",flex:1,layout:"fit",items:[{xtype:"textarea",itemId:"Note",reference:"Note",name:"note"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.notifiche.controller.ParamsNotificheManuali",{extend:"Generali.notifiche.controller.ParamsNotificheManuali",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CBUtenti",selector:this.selContainer+"#CBUtenti"}]);this.control(this.selContainer+"#CBUtenti",{select:this.selectCBUtenti})},selectCBUtenti:function(b,c){c&&this.selectParametro({codOspite:c.get("codOspite"),idRicovero:c.get("idRicovero"),nominativo:c.get("nominativo")})},
caricaParametri:function(b){b=void 0===b?{}:b;var c=this.getCBUtenti();c.getStore();setCombo(c,b.codOspite,b.nominativo)},onLaunch:function(){var b=this,c=b.getCBUtenti();ImpostaUrl([c.getStore()]);c.doAutoSelect=function(){return b.doAutoSelect(c,"codOspite")}}});
Ext.define("GeneraliOSP.notifiche.view.ParamsNotificheManuali",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},margin:5,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"combobox",itemId:"CBUtenti",reference:"CBUtenti",fieldLabel:"UTENTE",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Utenti",{autoLoad:!1}),labelWidth:150,displayField:"nominativo",queryMode:"remote",valueField:"codOspite",labelClsExtra:"cbaLabel",queryParam:"cognome"}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.COPERFESTIVITA",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"gridDettaglio",selector:this.selContainer+"#gridDettaglio"},{ref:"dataGgFestivo",selector:this.selContainer+"#dataGgFestivo"},{ref:"detNuovo",selector:this.selContainer+"#detNuovo"},{ref:"detElimina",selector:this.selContainer+"#detElimina"}]);this.control(this.selContainer+"#gridDettaglio",
{beforeedit:this.onGridroweditingpluginBeforeEdit,canceledit:this.onGridroweditingpluginCanceledit,edit:this.onGridroweditingpluginEdit,validateedit:this.onGridroweditingpluginValidateedit});this.control(this.selContainer+"#detNuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#detElimina",{click:this.onButtonClickElimina})},onButtonClickNuovo:function(b,c,d){b=this.getGridDettaglio();c={idPersonTestata:b.getStore().getProxy().extraParams.idTestata,dataGgFestivo:new Date,dataGgFestivoAl:new Date,
ricorsiva:"F"};controller_nuovoRecordGrid(c,b)},onButtonClickElimina:function(b,c,d){var f=this;b=f.getGridDettaglio();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStore()})},onGridroweditingpluginBeforeEdit:function(b,c,d){var f=this;if(!0===this.getGridDettaglio().getPlugin().editing)return!1;b=b.getEditor().getForm().findField("dataGgFestivo");Ext.isDefined(b.primaVolta)||(b.primaVolta=!0,b.on("change",function(b,c){if(Ext.isEmpty(c))return!1;
var d=f.getGridDettaglio(),d=getColGrid(d,"dataGgFestivoAl").getEditor();Ext.isEmpty(d.getValue())?d.setValue(c):d.getValue()<c&&d.setValue(c)}));this.abilitaComponenti(!1)},onGridroweditingpluginCanceledit:function(b,c,d){this.abilitaComponenti(!0);this.aggiornaStore(c.record.data.id)},onGridroweditingpluginEdit:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();var f=c.record.data;if(!Ext.isEmpty(f.dataGgFestivoAl)&&f.dataGgFestivoAl.getTime()<f.dataGgFestivo.getTime())return d=
[],msgAddError(d,"MSG_DATADAL_MAGGIORE_DATAAL"),b.startEdit(c.record,1),msgShow("",d);f.ricorsiva=getBoolValue(f.ricorsiva);controller_salvaRecord(d,f,!1)?this.abilitaComponenti(!0):b.startEdit(c.record,0)},onGridroweditingpluginValidateedit:function(b,c,d){return msgShow("",[])},abilitaComponenti:function(b){this.getDetNuovo().setDisabled(!b);this.getDetElimina().setDisabled(!b);this.testata.getNuovo().setDisabled(!b);this.testata.getElimina().setDisabled(!b);this.testata.getGridTestata().setDisabled(!b);
this.cbaConfig.ctrlPerson?this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},setTitle:function(b){this.getGridDettaglio().setTitle(b)},aggiornaStore:function(b){var c=this,d=c.getGridDettaglio().getStore();d.load({params:{idTestata:d.getProxy().extraParams.idTestata},callback:function(f,g,h){h?Ext.isEmpty(f)||(f=trovaRecord(d,"id",b),g=c.getGridDettaglio(),g.getSelectionModel().deselectAll(),
g.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}})},onLaunch:function(){this.getGridDettaglio().controller=this;ImpostaUrl([this.getGridDettaglio().getStore()]);var b=this.getGridDettaglio().up("window");Localizer.localize(b);"L"==this.cbaConfig.permesso&&(containerSolaLettura(this.getGridDettaglio()),this.getDetNuovo().setDisabled(!0),this.getDetElimina().setDisabled(!0))}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.COPERGIORNIAPERTURA",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"gridDettaglio",selector:this.selContainer+"#gridDettaglio"},{ref:"detNuovo",selector:this.selContainer+"#detNuovo"},{ref:"detElimina",selector:this.selContainer+"#detElimina"}]);this.control(this.selContainer+"#gridDettaglio",{beforeedit:this.onGridroweditingpluginBeforeEdit,
canceledit:this.onGridroweditingpluginCanceledit,edit:this.onGridroweditingpluginEdit,validateedit:this.onGridroweditingpluginValidateedit});this.control(this.selContainer+"#detNuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#detElimina",{click:this.onButtonClickElimina})},onButtonClickNuovo:function(b,c,d){b=this.getGridDettaglio();c={idPersonTestata:b.getStore().getProxy().extraParams.idTestata,data:new Date,lunedi:"F",martedi:"F",mercoledi:"F",giovedi:"F",venerdi:"F",sabato:"F",
domenica:"F"};controller_nuovoRecordGrid(c,b)},onButtonClickElimina:function(b,c,d){var f=this;b=f.getGridDettaglio();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStore()})},onGridroweditingpluginBeforeEdit:function(b,c,d){if(!0===this.getGridDettaglio().getPlugin().editing)return!1;this.abilitaComponenti(!1)},onGridroweditingpluginCanceledit:function(b,c,d){this.abilitaComponenti(!0);this.aggiornaStore(c.record.data.id)},
onGridroweditingpluginEdit:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();var f=c.record.data;f.lunedi=getBoolValue(f.lunedi);f.martedi=getBoolValue(f.martedi);f.mercoledi=getBoolValue(f.mercoledi);f.giovedi=getBoolValue(f.giovedi);f.venerdi=getBoolValue(f.venerdi);f.sabato=getBoolValue(f.sabato);f.domenica=getBoolValue(f.domenica);controller_salvaRecord(d,f,!1)?this.abilitaComponenti(!0):b.startEdit(c.record,0)},onGridroweditingpluginValidateedit:function(b,
c,d){return msgShow("",[])},abilitaComponenti:function(b){this.getDetNuovo().setDisabled(!b);this.getDetElimina().setDisabled(!b);this.testata.getNuovo().setDisabled(!b);this.testata.getElimina().setDisabled(!b);this.testata.getGridTestata().setDisabled(!b);this.cbaConfig.ctrlPerson?this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},setTitle:function(b){this.getGridDettaglio().setTitle(b)},
aggiornaStore:function(b){var c=this,d=c.getGridDettaglio().getStore();d.load({params:{idTestata:d.getProxy().extraParams.idTestata},callback:function(f,g,h){h?Ext.isEmpty(f)||(f=trovaRecord(d,"id",b),g=c.getGridDettaglio(),g.getSelectionModel().deselectAll(),g.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}})},onLaunch:function(){this.getGridDettaglio().controller=this;ImpostaUrl([this.getGridDettaglio().getStore()]);var b=this.getGridDettaglio().up("window");Localizer.localize(b);
"L"==this.cbaConfig.permesso&&(containerSolaLettura(this.getGridDettaglio()),this.getDetNuovo().setDisabled(!0),this.getDetElimina().setDisabled(!0))}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.COPERPRESENZE",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"COPERPRESENZE",selector:this.selContainer+"#COPERPRESENZE"},{ref:"GridDettaglio",selector:this.selContainer+"#GridDettaglio"},{ref:"COPERPRESENZEForm",selector:this.selContainer+"#COPERPRESENZEForm"},{ref:"COPERPRESENZERecordId",
selector:this.selContainer+"#COPERPRESENZERecordId"},{ref:"boxBottoni",selector:this.selContainer+"#boxBottoni"},{ref:"MotiviDim",selector:this.selContainer+"#MotiviDim"},{ref:"CkgiornoDimissioneRette",selector:this.selContainer+"#CkgiornoDimissioneRette"},{ref:"OragiornoDimissioneRette",selector:this.selContainer+"#OragiornoDimissioneRette"},{ref:"CkgiornoDecessoRette",selector:this.selContainer+"#CkgiornoDecessoRette"},{ref:"OragiornoDecessoRette",selector:this.selContainer+"#OragiornoDecessoRette"},
{ref:"DirtyGrid",selector:this.selContainer+"#DirtyGrid"}]);this.control(this.selContainer+"#GridDettaglio",{select:this.onGridStoricoItemClick});this.control(this.selContainer+"#CkgiornoDimissioneRette",{change:this.changeGGDimissioneRette});this.control(this.selContainer+"#CkgiornoDecessoRette",{change:this.changeGGDecessoRette})},changeGGDimissioneRette:function(){(this.getCkgiornoDecessoRette().getValue()||this.getCkgiornoDimissioneRette().getValue())&&"S"==this.cbaConfig.permesso?this.getMotiviDim().setDisabled(!1):
this.getMotiviDim().setDisabled(!0);this.getCkgiornoDimissioneRette().getValue()?this.getOragiornoDimissioneRette().setDisabled(!1):this.getOragiornoDimissioneRette().setDisabled(!0)},changeGGDecessoRette:function(){(this.getCkgiornoDecessoRette().getValue()||this.getCkgiornoDimissioneRette().getValue())&&"S"==this.cbaConfig.permesso?this.getMotiviDim().setDisabled(!1):this.getMotiviDim().setDisabled(!0);this.getCkgiornoDecessoRette().getValue()?this.getOragiornoDecessoRette().setDisabled(!1):this.getOragiornoDecessoRette().setDisabled(!0)},
onGridStoricoItemClick:function(b,c,d,f,g,h){this.impostaDati(c)},onTimefieldAfterRender:function(b,c){setToolTipInfo(b,"ORAGIORNOINGRESSO_MSG","ORAGIORNOINGRESSO_TITOLO")},onTimefieldChange:function(b,c,d,f){c&&b.up("form").getForm().findField("giornoIngressoRette").setValue(!0)},onTimefieldAfterRender1:function(b,c){setToolTipInfo(b,"ORAGIORNODIMISSIONI_MSG","ORAGIORNODIMISSIONI_TITOLO")},onTimefieldChange1:function(b,c,d,f){c&&b.up("form").getForm().findField("giornoDimissioneRette").setValue(!0)},
onTimefieldAfterRender3:function(b,c){setToolTipInfo(b,"ORAGIORNOUSCITA_MSG","ORAGIORNOUSCITA_TITOLO")},onTimefieldChange2:function(b,c,d,f){c&&b.up("form").getForm().findField("giornoUscitaRette").setValue(!0)},onTimefieldAfterRender2:function(b,c){setToolTipInfo(b,"ORAGIORNORIENTRO_MSG","ORAGIORNORIENTRO_TITOLO")},onTimefieldChange3:function(b,c,d,f){c&&b.up("form").getForm().findField("giornoRientroRette").setValue(!0)},impostaDati:function(b){var c=this.getCOPERPRESENZEForm();this.getGridDettaglio().setDisabled(!1);
clearForm(c);b&&(c.loadRecord(b),b.data.oraGiornoIngresso&&c.getForm().setValues({oraGiornoIngresso:Ext.Date.parse(b.data.oraGiornoIngresso,"c")}),b.data.oraGiornoDimissioni&&c.getForm().setValues({oraGiornoDimissioni:Ext.Date.parse(b.data.oraGiornoDimissioni,"c")}),b.data.oraGiornoDecessi&&c.getForm().setValues({oraGiornoDecessi:Ext.Date.parse(b.data.oraGiornoDecessi,"c")}),b.data.oraGiornoRientro&&c.getForm().setValues({oraGiornoRientro:Ext.Date.parse(b.data.oraGiornoRientro,"c")}),b.data.oraGiornoUscita&&
c.getForm().setValues({oraGiornoUscita:Ext.Date.parse(b.data.oraGiornoUscita,"c")}))},nuovo:function(){controller_nuovoRecord(this.getCOPERPRESENZEForm())},verificaCampiForm:function(){var b=[];this.getCOPERPRESENZEForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b){var c=this.getGridDettaglio().getStore(),d=this.getCOPERPRESENZEForm().getForm();if(!this.verificaCampiForm())return!1;var f=d.getFieldValues(),g=d.findField("oraGiornoIngresso").getValue(),
h=d.findField("oraGiornoDimissioni").getValue(),k=d.findField("oraGiornoRientro").getValue(),l=d.findField("oraGiornoUscita").getValue(),d=d.findField("oraGiornoDecessi").getValue();g&&azzeraData(g);h&&azzeraData(h);k&&azzeraData(k);l&&azzeraData(l);f.idPersonTestata=c.getProxy().extraParams.idTestata;f.giornoIngressoRette=getBoolValue(f.giornoIngressoRette);f.giornoDimissioneRette=getBoolValue(f.giornoDimissioneRette);f.giornoDecessoRette=getBoolValue(f.giornoDecessoRette);f.giornoRientroRette=getBoolValue(f.giornoRientroRette);
f.giornoUscitaRette=getBoolValue(f.giornoUscitaRette);f.giornoIngressoReg=getBoolValue(f.giornoIngressoReg);f.giornoDimissioneReg=getBoolValue(f.giornoDimissioneReg);f.giornoRientroReg=getBoolValue(f.giornoRientroReg);f.giornoUscitaReg=getBoolValue(f.giornoUscitaReg);f.giornoIngressoStat=getBoolValue(f.giornoIngressoStat);f.giornoDimissioneStat=getBoolValue(f.giornoDimissioneStat);f.giornoRientroStat=getBoolValue(f.giornoRientroStat);f.giornoUscitaStat=getBoolValue(f.giornoUscitaStat);f.oraGiornoIngresso=
g;f.oraGiornoDimissioni=h;f.oraGiornoDecessi=d;f.oraGiornoRientro=k;f.oraGiornoUscita=l;delete f.DirtyGrid;controller_salvaRecord(this.getCOPERPRESENZEForm(),f,b);c=this.getMotiviDim().store.data.items;for(f=0;f<this.getMotiviDim().store.data.items.length;f++)g={tipoSov:this.getMotiviDim().selModel.isSelected(c[f])?"T":"F",codiceEnte:c[f].data.codiceEnte,risposta:c[f].data.risposta,descrizione:c[f].data.descrizione,scheda:c[f].data.scheda,domanda:c[f].data.domanda,tipoUscita:c[f].data.tipoUscita,
idServizio:c[f].data.idServizio},controller_salvaRecord(this.getMotiviDim(),g,b,null,null,null,"risposta")},setTitle:function(b){this.getCOPERPRESENZE().setTitle(b)},aggiornaStore:function(b){var c=this,d=c.getGridDettaglio().getStore(),f=c.getCOPERPRESENZEForm(),g=f.getForm();d.load({params:{idTestata:d.getProxy().extraParams.idTestata},callback:function(h,k,l){l?Ext.isEmpty(h)?clearForm(f):(b||(b=g.findField("id").getValue()),h=trovaRecord(d,"id",b),k=c.getGridDettaglio(),k.getSelectionModel().deselectAll(),
k.getSelectionModel().select(h?[h]:0)):msgShowError("",k.getError())}});c.getMotiviDim().getStore().load({params:{scheda:"A",domanda:1,idOrganizzazione:c.cbaConfig.idOrganizzazione},callback:function(b,d,f){if(f){for(d=0;d<b.length;d++)"T"==b[d].getData().tipoSov&&c.getMotiviDim().getSelectionModel().select([b[d]],!0,!1);c.getDirtyGrid().setValue("")}else b=[],msgAddError(b,d.getError()),msgShow("",b)}})},onLaunch:function(){var b=this;b.getGridDettaglio().controller=b;ImpostaUrl([b.getGridDettaglio().getStore()]);
var c=b.getCOPERPRESENZEForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();c.store=b.getGridDettaglio().getStore();c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var d=c.getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,{id:d},function(){b.aggiornaStore()})},
esci_callback:function(){var c=b.getContainer().up("window");controller_puoiUscire(c,b.getCOPERPRESENZEForm(),function(){b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),d);c.boxBottoni.queryById("btnEsci").setVisible(!1);d=b.getContainer().up("window");Localizer.localize(d);b.getCOPERPRESENZERecordId().hide();b.getCOPERPRESENZEForm().getForm().findField("idPersonTestata").hide();if("L"!=
b.cbaConfig.permesso)this.getCOPERPRESENZEForm().getForm().on("dirtychange",function(c,d){controller_abilitaBottoni(b.getCOPERPRESENZEForm());b.getGridDettaglio().setDisabled(d);b.testata.getNuovo().setDisabled(d);b.testata.getElimina().setDisabled(d);b.testata.getGridTestata().setDisabled(d)});"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getCOPERPRESENZEForm()),controller_bottoniSolaLettura(b.getBoxBottoni()));ImpostaUrl([b.getMotiviDim().getStore()]);(b.getCkgiornoDecessoRette().getValue()||
b.getCkgiornoDimissioneRette().getValue())&&"S"==b.cbaConfig.permesso?b.getMotiviDim().setDisabled(!1):b.getMotiviDim().setDisabled(!0);b.getCkgiornoDecessoRette().getValue()||b.getOragiornoDecessoRette().setDisabled(!0);b.getCkgiornoDimissioneRette().getValue()||b.getOragiornoDimissioneRette().setDisabled(!0)}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.COPERSONALIZZAZIONITE",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"container",selector:this.selContainer+"#container"},{ref:"cntDettaglio",selector:this.selContainer+"#cntDettaglio"},{ref:"gridTestata",selector:this.selContainer+"#gridTestata"},{ref:"nuovo",selector:this.selContainer+"#nuovo"},{ref:"elimina",selector:this.selContainer+"#elimina"}]);
this.control(this.selContainer+"#gridTestata",{select:this.onGridTestataSelect,beforeedit:this.onGridroweditingpluginBeforeEdit,edit:this.onGridroweditingpluginEdit,canceledit:this.onGridroweditingpluginCanceledit,validateedit:this.onGridroweditingpluginValidateedit});this.control(this.selContainer+"#nuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#elimina",{click:this.onButtonClickElimina})},onGridroweditingpluginBeforeEdit:function(b,c,d){if(!0===this.getGridTestata().getPlugin().editing)return!1;
this.abilitaComponenti(!1)},onGridroweditingpluginCanceledit:function(b,c,d){this.abilitaComponenti(!0);this.aggiornaStore(c.record.data.id)},onGridroweditingpluginEdit:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();controller_salvaRecord(d,c.record.data,!1)?(this.abilitaComponenti(!0),this.getIdPannello(this.cbaConfig.tipo),this.aggiornaTitoloDett()):b.startEdit(c.record,0)},onGridroweditingpluginValidateedit:function(b,c,d){return msgShow("",[])},onButtonClickNuovo:function(b,
c,d){b=this.getGridTestata().getStore().getProxy().extraParams;b={tipo:b.tipo,descrizione:null,idOrganizzazione:b.idOrg};c=this.getGridTestata();controller_nuovoRecordGrid(b,c)},onButtonClickElimina:function(b,c,d){var f=this;b=f.getGridTestata();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStore()})},onGridTestataSelect:function(b,c,d,f){b=c.get("id");0<b&&(d=this.getIdPannello(this.cbaConfig.tipo),"COPERPRESENZE"==d||
"COPERGIORNIAPERTURA"==d||"COPERFESTIVITA"==d||"RAPPERBUDGET"==d?(d=this.getContainer().down("#"+d+" gridpanel").controller,d.getGridDettaglio().getStore().getProxy().extraParams.idTestata=b,d.setTitle(c.get("descrizione")),d.aggiornaStore()):(Ext.getStore(d).getProxy().extraParams.idTestata=b,Ext.getCmp(d).aggiornaStore?Ext.getCmp(d).aggiornaStore():Ext.getCmp(d).queryById("grid1").aggiornaStore(),this.aggiornaTitoloDett()))},abilitaComponenti:function(b){this.getNuovo().setDisabled(!b);this.getElimina().setDisabled(!b);
var c=this.getIdPannello(this.cbaConfig.tipo);this.getContainer().down("#"+c)?this.getContainer().down("#"+c).setDisabled(!b):Ext.getCmp(c)&&Ext.getCmp(c).setDisabled(!b);this.cbaConfig.ctrlPerson&&this.cbaConfig.ctrlPerson.getPnlPerson()?this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},getIdPannello:function(b){var c;switch(b){case "P":c="COPERPRESENZE";break;case "A":c="COPERGIORNIAPERTURA";break;case "F":c=
"COPERFESTIVITA";break;case "R":c="COPERCALCOLORETTE";break;case "B":c="COPERBOLLO";break;case "C":c="COPERCONTABILI";break;case "S":c="RAPPERBUDGET"}return c},aggiornaTitoloDett:function(){var b=this.getIdPannello(this.cbaConfig.tipo),c=this.getGridTestata().getSelectionModel().getSelection()[0];c&&Ext.getCmp(b).setTitle(c.get("descrizione"))},aggiornaStore:function(b){var c=this,d=c.getGridTestata().getStore();svuotaStore(d);var f=d.getProxy(),g=c.cbaConfig;f.extraParams.idOrg=g.idOrganizzazione;
f.extraParams.tipo=g.tipo;c.getIdPannello(g.tipo);d.load({callback:function(f,g,l){if(l){if(!Ext.isEmpty(f)){g=trovaRecord(d,"id",b);var h=c.getGridTestata();h.getSelectionModel().deselectAll();h.getSelectionModel().select(g?[g]:0)}}else msgShowError("",g.getError());l&&!Ext.isEmpty(f)?c.getCntDettaglio().show():c.getCntDettaglio().hide()}})},onLaunch:function(){if(this.titolo)this.getGridTestata().setTitle(this.titolo);else if(!this.cbaConfig.impostazioniContabili){var b=Ext.getCmp("containerPersonalizzazioni").queryById("pnlAlbero").getRootNode().findChild("idRecord",
this.cbaConfig.idRecord,!0).parentNode;this.getGridTestata().setTitle(b.data.text+" - "+this.cbaConfig.text)}ImpostaUrl([this.getGridTestata().getStore()]);b=this.getIdPannello(this.cbaConfig.tipo);b="COPERPRESENZE"==b||"COPERGIORNIAPERTURA"==b||"COPERFESTIVITA"==b?Ext.create("GeneraliOSP.personalizzazioni.app.view."+b,{itemId:b,cbaConfig:this.cbaConfig,testata:this}):"RAPPERBUDGET"==b?Ext.create("RAP.person.view."+b,{itemId:b,cbaConfig:this.cbaConfig,testata:this}):Ext.create("Personalizzazioni.view."+
b,{cbaConfig:this.cbaConfig,testata:this});this.getCntDettaglio().add(b);this.aggiornaStore();b=this.getContainer().up("window");Localizer.localize(b);"L"==this.cbaConfig.permesso&&(containerSolaLettura(this.getGridTestata().id),this.getNuovo().setDisabled(!0),this.getElimina().setDisabled(!0))}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.CORISPOSTE_DE",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"gridDettaglio",selector:this.selContainer+"#gridDettaglio"},{ref:"annoCda",selector:this.selContainer+"#annoCda"},{ref:"detNuovo",selector:this.selContainer+"#detNuovo"},{ref:"detElimina",selector:this.selContainer+"#detElimina"}]);this.control(this.selContainer+"#gridDettaglio",{beforeedit:this.onGridroweditingpluginBeforeEdit,
edit:this.onGridroweditingpluginEdit,canceledit:this.onGridroweditingpluginCanceledit,validateedit:this.onGridroweditingpluginValidateedit});this.control(this.selContainer+"#annoCda",{render:this.onTextfieldRender});this.control(this.selContainer+"#detNuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#detElimina",{click:this.onButtonClickElimina})},onButtonClickNuovo:function(b,c,d){b=this.getGridDettaglio();c=b.getStore().getProxy().extraParams;d=Ext.Date.clearTime(new Date);
controller_nuovoRecordGrid({risposta:c.idRisposta,percentuale:"F",dataDal:d},b);b=b.getPlugin().editor.getForm().findField("dataDal");b.fireEvent("change",b);this.abilitaComponenti(!1)},onButtonClickElimina:function(b,c,d){var f=this;b=this.getGridDettaglio();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStore()})},onDatefieldChange:function(b,c,d,f){isValidDate(b)&&(c=b.up().getForm(),d=getPersonContabili("L"==this.cbaConfig.scheda&&
5==this.cbaConfig.domanda?null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:this.idOrg:this.cbaConfig.idServizio,b.getValue(),"L"==this.cbaConfig.scheda&&5==this.cbaConfig.domanda,null),c.setValues({tipoContabilita:d.tipoContabilitaAbilitata}),this.abilitaCampi(d,b.getValue(),!0))},onTextfieldRender:function(b,c){setContextMenuCda(b)},reloadStores:function(b,c,d,f){var g=d.getFullYear(),h={},k={},l=null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:this.idOrg,
n=f&&f.annoConto?f.annoConto:4==b.tipoContabilitaAbilitata||5==b.tipoContabilitaAbilitata?getIdEsercizioByDate(l,d):g;1!=b.tipoContabilitaAbilitata&&(4==b.tipoContabilitaAbilitata||5==b.tipoContabilitaAbilitata?(c.findField("conto").getStore().getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(h,{idOrganizzazione:l,idEsercizio:n?n:0}),5!=b.tipoDocumento&&(c.findField("registro").getStore().getProxy().url=getUrlGen()+"/ws/genAmmPers/registriIva/detail/cboxByDate",Ext.apply(k,{dataControllo:f?
f.dataDal:c.findField("dataDal").getValue(),tipoDocumento:b.tipoDocumento?b.tipoDocumento/2:0,idOrganizzazione:l}))):(c.findField("conto").getStore().getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(h,{idOrganizzazione:l,anno:n}),5!=b.tipoDocumento&&(ImpostaUrl([c.findField("registro").getStore()]),Ext.apply(k,{anno:g,tipoDocumento:b.tipoDocumento?b.tipoDocumento:0}))));if(2==b.tipoContabilitaAbilitata||3==b.tipoContabilitaAbilitata||4==b.tipoContabilitaAbilitata||5==b.tipoContabilitaAbilitata){var p=
this.cbaConfig,q=c.findField("conto");q.getStore().load({params:h,callback:function(b){f&&c.setValues({conto:f.conto,annoConto:n});("L"!=p.scheda||1!=p.domanda&&2!=p.domanda)&&"L"!=p.scheda&&("V"!=p.scheda||108!=p.domanda)&&0<b.length&&(q.allowBlank=!1,q.validate())}});"L"==this.cbaConfig.scheda&&5==this.cbaConfig.domanda||5==b.tipoDocumento||c.findField("registro").getStore().load({params:k,callback:function(){f&&c.setValues({registro:f.idRegistro?f.idRegistro:f.registro})}})}else c.findField("capitolo").getStore().load({params:{anno:g},
callback:function(){f&&c.setValues({capitolo:f.capitolo})}})},onGridroweditingpluginBeforeEdit:function(b,c,d){if(!0===this.getGridDettaglio().getPlugin().editing)return!1;this.abilitaComponenti(!1);d=b.editor.getForm();c=c.record.data;var f=c.dataDal,g=getPersonContabili("L"==this.cbaConfig.scheda&&5==this.cbaConfig.domanda?this.cbaConfig.idOrganizzazione:this.cbaConfig.idServizio,c.dataDal,"L"==this.cbaConfig.scheda&&5==this.cbaConfig.domanda,null);c.tipoContabilita||(c.tipoContabilita=g.tipoContabilitaAbilitata?
g.tipoContabilitaAbilitata:3);var h=b.getEditor().getForm().findField("dataDal");Ext.isDefined(h.giaConfigurato)||(h.on("change",this.onDatefieldChange,this),h.giaConfigurato=!0);1==g.tipoContabilitaAbilitata&&(h=b.getEditor().getForm().findField("capitolo"),Ext.isDefined(h.giaConfigurato)||(h.on("change",this.onCapitoloChange,this),h.giaConfigurato=!0));this.reloadStores(g,d,f,c);this.abilitaCampi(g,f);b.getEditor().getForm().findField("quotaSanitaria").allowBlank=!("V"==this.cbaConfig.scheda&&108==
this.cbaConfig.domanda)},onCapitoloChange:function(b,c){var d=this.getGridDettaglio().getPlugin().editor.getForm(),f=d.findField("dataDal");f.isValid()&&d.findField("articolo").getStore().load({params:{anno:f.getValue().getFullYear(),codCapitolo:c?c:0}})},onGridroweditingpluginCanceledit:function(b,c,d){this.cbaConfig.editNewDettaglio=!1;this.abilitaComponenti(!0);this.aggiornaStore(c.record.data.id,c.record)},onGridroweditingpluginEdit:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();
conf=this.cbaConfig;f.controller=this;f.store=c.view.getStore();"E"==conf.scheda&&1==conf.domanda&&conf.recordTestata&&"V"==conf.recordTestata.tipoSov?(d.quotaSanGgForced=Math.abs(d.quotaSanGgForced),d.quotaSocGgForced=Math.abs(d.quotaSocGgForced)):(d.quotaSanGgForced=null,d.quotaSocGgForced=null);d.quotaSanitaria||(d.quotaSanitaria=0);d.quotaSociale||(d.quotaSociale=0);delete d.percentuale;delete d.desAnnoCda;d.annoCda=f.findField("annoCda").getValue();d.registro=f.findField("registro").getRawValue();
d.idRegistro=Ext.isNumber(f.findField("registro").getValue())?f.findField("registro").getValue():null;d.annoConto=d.conto?f.findField("annoConto").getValue():null;controller_salvaRecord(f,d,!1,{scheda:this.cbaConfig.scheda,domanda:this.cbaConfig.domanda})?(this.abilitaComponenti(!0),this.cbaConfig.editNewDettaglio=!1):b.startEdit(c.record,0)},onGridroweditingpluginValidateedit:function(b,c,d){d=[];b=b.getEditor().getForm();c=c.newValues;var f=this.cbaConfig.scheda,g="L"==this.cbaConfig.scheda&&5==
this.cbaConfig.domanda;Ext.isEmpty(c.quotaSanitaria)&&Ext.isEmpty(c.quotaSociale)?"E"==f&&msgAddError(d,"MSG_QSAN_QSOC_OBBLIGATORI"):!g&&(c.quotaSanitaria&&0>c.quotaSanitaria||c.quotaSociale&&0>c.quotaSociale)?msgAddError(d,"MSG_QUOTE_NEGATIVE"):0===parseFloat(c.quotaSanitaria+c.quotaSociale)&&("E"==f||"L"==f||"V"==f&&108==this.cbaConfig.domanda?msgAddWarning(d,"MSG_QSAN_QSOC_MAGGIORE_0"):msgAddError(d,"MSG_QSAN_QSOC_MAGGIORE_0"));"L"==this.cbaConfig.scheda&&(1==this.cbaConfig.domanda||2==this.cbaConfig.domanda)||
"V"==this.cbaConfig.scheda&&108==this.cbaConfig.domanda||(1==c.tipoContabilita?!c.capitolo&&0<b.findField("capitolo").getStore().getCount()&&msgAddError(d,"MSG_CAPITOLO_OBBLIGATORIO"):(2==c.tipoContabilita||3==c.tipoContabilita||4==c.tipoContabilita||5==c.tipoContabilita)&&"L"!=f&&!c.conto&&0<b.findField("conto").getStore().getCount()&&msgAddError(d,"MSG_CONTO_OBBLIGATORIO"));return msgShow("",d)},abilitaComponenti:function(b){this.getDetNuovo().setDisabled(!b);this.getDetElimina().setDisabled(!b);
this.testata.getTstNuovo().setDisabled(!b);this.testata.getTstElimina().setDisabled(!b);this.testata.getGrid1().setDisabled(!b);this.cbaConfig.ctrlPerson?this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},abilitaCampi:function(b,c,d){c.getFullYear();var f=this.getGridDettaglio().getPlugin().editor.getForm(),g=f.findField("conto"),h=f.findField("registro"),k=f.findField("annoCda"),
l=f.findField("capitolo"),n=f.findField("articolo"),p=f.findField("cda"),q=4==b.tipoContabilitaAbilitata||5==b.tipoContabilitaAbilitata?getIdEsercizioByDate(null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:this.idOrg,c):c.getFullYear();h.setDisabled(!b.vediRegistro||5==b.tipoDocumento);g.setDisabled(!b.vediConto);l.setDisabled(!b.vediCapitolo);n.setDisabled(!b.vediArticolo);k.setReadOnly(!0);p.setReadOnly(!b.vediCda);p.cbaConfig.idEsercizio=q;b.vediRegistroMan?(h.setDisabled(!1),
h.maxLength=2,h.setEditable(!0),h.cbaConfig.valida=!1,h.forceSelection=!1,h.setHideTrigger(!0)):(h.setEditable(!1),h.setHideTrigger(!1),h.cbaConfig.valida=!0,h.maxLength=Number.MAX_VALUE,h.forceSelection=!0);d&&(svuotaStore(h.getStore()),svuotaStore(g.getStore()),svuotaStore(l.getStore()),svuotaStore(n.getStore()),f.setValues({conto:"",annoConto:q,capitolo:"",articolo:"",annoCda:"",cda:""}),this.reloadStores(b,f,c,null))},aggiornaStore:function(b,c){var d=this,f=this.getGridDettaglio(),g=f.getStore();
g.load({params:{idOrganizzazione:null!=d.cbaConfig.idOrganizzazione?d.cbaConfig.idOrganizzazione:CBA.parametriGenerali.idOrganizzazione},callback:function(c,f,h){if(h)if(!Ext.isEmpty(c))c=trovaRecord(g,"id",b),f=d.getGridDettaglio(),f.getSelectionModel().deselectAll(),f.getSelectionModel().select(c?[c]:0),d.testata.getTxtCerca().focus();else{if(d.cbaConfig.editNewDettaglio)d.onButtonClickNuovo()}else msgShowError("",f.getError())}});var h=this.cbaConfig;"E"==h.scheda&&1==h.domanda&&h.recordTestata&&
"V"==h.recordTestata.tipoSov?(getColGrid(f,"quotaSanGgForced").show(),getColGrid(f,"quotaSocGgForced").show()):(getColGrid(f,"quotaSanGgForced").hide(),getColGrid(f,"quotaSocGgForced").hide())},onLaunch:function(){var b=this,c=this.getGridDettaglio(),d=Ext.create("Generali.store.Registro"),f=Ext.create("Generali.store.Conto"),g=Ext.create("Generali.store.Capitolo"),h=Ext.create("Generali.store.Articolo"),k=Ext.create("Generali.store.AliquotaIva");b.idOrg=getIdOrg();c.controller=b;ImpostaUrl([d]);
editCombo(c,d,getColGrid(c,"registro"),!1,!1,!1,!1,function(b,c){c&&!Ext.isNumber(c)&&b.setValue(c.toUpperCase())},!1);editCombo(c,f,getColGrid(c,"conto"),!1,!0,300);getColGrid(c,"conto").editor.minChars=3;f.load({params:{anno:(new Date).getFullYear()}});editCombo(c,h,getColGrid(c,"articolo"),!1,!0,300);"L"==b.cbaConfig.scheda&&5==b.cbaConfig.domanda&&(d=Ext.create("Generali.store.UnitaMisuraCombo"),d.load(),editCombo(c,d,getColGrid(c,"codUniMis"),!1,!0,300),getColGrid(c,"codUniMis").show(),getColGrid(c,
"qta").show(),getColGrid(c,"qta").allowBlank=!1,getColGrid(c,"registro").hide());editCombo(c,g,getColGrid(c,"capitolo"),!1,!0,function(){var c=b.getGridDettaglio().getPlugin().editor.getForm(),d=c.findField("dataDal"),f=c.findField("capitolo").getValue();d.isValid()&&c.findField("articolo").getStore().load({params:{anno:d.getValue().getFullYear(),codCapitolo:f?f:0}})});editCombo(c,k,getColGrid(c,"idAliquotaIva"),"V"==b.cbaConfig.scheda&&108==b.cbaConfig.domanda?!1:!0,!0,300);k.load();getColGrid(c,
"cda").editor={xtype:"cdaGrid",annoData:"dataDal"};getColGrid(c,"idFranchigia").hide();getColGrid(c,"tipoContabilita").hide();getColGrid(c,"percentuale").hide();getColGrid(c,"idRegistro").hide();getColGrid(c,"annoCda").hide();getColGrid(c,"cda1").hide();getColGrid(c,"annoConto").hide();Localizer.localize(Ext.getCmp(this.id));g=b.getGridDettaglio().up("window");Localizer.localize(g);"L"==b.cbaConfig.permesso&&(containerSolaLettura(c.id),this.getDetNuovo().setDisabled(!0),this.getDetElimina().setDisabled(!0))}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.DETTMOTIVIUSCITA",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DETTMOTIVIUSCITA",selector:this.selContainer+"#DETTMOTIVIUSCITA"},{ref:"Container",selector:this.selContainer+"#Container"},{ref:"StoricoGrid",selector:this.selContainer+"#StoricoGrid"},{ref:"gridFranchigie",selector:this.selContainer+"#gridFranchigie"},{ref:"DETTMOTIVIUSCITAForm",
selector:this.selContainer+"#DETTMOTIVIUSCITAForm"},{ref:"gridFranchigie",selector:this.selContainer+"#gridFranchigie"},{ref:"pnlContoRegistro",selector:this.selContainer+"#pnlContoRegistro"},{ref:"pnlCapitoloArticolo",selector:this.selContainer+"#pnlCapitoloArticolo"},{ref:"cntCda",selector:this.selContainer+"#cntCda"},{ref:"dataDecorrenza",selector:this.selContainer+"#dataDecorrenza"},{ref:"cmbCapitolo",selector:this.selContainer+"#cmbCapitolo"},{ref:"cmbAliquota",selector:this.selContainer+"#cmbAliquota"},
{ref:"detNuovo",selector:this.selContainer+"#detNuovo"},{ref:"detElimina",selector:this.selContainer+"#detElimina"},{ref:"boxBottoni",selector:this.selContainer+"#boxBottoni"},{ref:"TipoCalcolo",selector:this.selContainer+"#TipoCalcolo"},{ref:"TipoCalcoloInfo",selector:this.selContainer+"#TipoCalcoloInfo"}]);this.control(this.selContainer+"#StoricoGrid",{select:this.onStoricoGridItemClick});this.control(this.selContainer+"#gridFranchigie",{beforeedit:this.onGridroweditingpluginBeforeEdit,edit:this.onGridroweditingpluginEdit,
canceledit:this.onGridroweditingpluginCanceledit,validateedit:this.onGridroweditingpluginValidateedit});this.control(this.selContainer+"#dataDecorrenza",{change:this.onDatefieldChange});this.control(this.selContainer+"#cmbCapitolo",{select:this.onComboboxCapitoloSelect});this.control(this.selContainer+"#cmbRegistro",{change:this.onComboboxRegistroChange});this.control(this.selContainer+"#detNuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#detElimina",{click:this.onButtonClickElimina});
this.control(this.selContainer+"#TipoCalcoloInfo",{afterrender:this.tipoCalcoloInfoAfterrender})},tipoCalcoloInfoAfterrender:function(b,c){var d=traduci("FRANCHIGIE_TIPOCALCOLO_RES_TOOLTIP");if("S"==this.cbaConfig.tipoServizio||"A"==this.cbaConfig.tipoServizio||"M"==this.cbaConfig.tipoServizio)d=traduci("FRANCHIGIE_TIPOCALCOLO_TOOLTIP");creaToolTip(b.getId(),d,"",100,300,!1,!1)},onStoricoGridItemClick:function(b,c,d,f,g,h){this.impostaDati(c)},onDatefieldChange:function(b,c,d,f){isValidDate(b)&&(c=
b.up("form").getForm(),d=getPersonContabili(this.cbaConfig.idServizio,b.getValue(),!1,null),Ext.apply(this.getCntCda().cbaConfig,{tipoContabilita:null}),c.setValues({tipoContabilita:d.tipoContabilitaAbilitata,tipoDocumento:d.tipoDocumento,idEsercizio:d.idEsercizio,annoCda:d.idEsercizio}),this.abilitaCampi(d,b.getValue().getFullYear()))},onButtonClickNuovo:function(b,c,d){c=this.getDETTMOTIVIUSCITAForm().getForm();b={idFranchigia:c.findField("idFranchigia").getValue()};"P"==c.findField("tipoImporto").getValue()&&
Ext.apply(b,{dalGiorno:0,quotaSanitaria:100,quotaSociale:100});c=this.getGridFranchigie();controller_nuovoRecordGrid(b,c)},onButtonClickElimina:function(b,c,d){var f=this;b=this.getGridFranchigie();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStoreFranchigie()})},onGridroweditingpluginBeforeEdit:function(b,c,d){if(!0===this.getGridFranchigie().getPlugin().editing)return!1;this.abilitaComponentiFranchige(!1)},onGridroweditingpluginCanceledit:function(b,
c,d){this.abilitaComponentiFranchige(!0);this.aggiornaStoreFranchigie(c.record.data.id,c.record)},onGridroweditingpluginEdit:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();controller_salvaRecord(d,c.record.data,!1,null,null,null,"id")?this.abilitaComponentiFranchige(!0):b.startEdit(c.record,0)},onGridroweditingpluginValidateedit:function(b,c,d){b=[];c=c.newValues;Ext.isEmpty(c.quotaSanitaria)&&Ext.isEmpty(c.quotaSociale)?msgAddError(b,"MSG_QSAN_QSOC_OBBLIGATORI"):
"D"!=this.getDETTMOTIVIUSCITAForm().getForm().findField("tipoImporto").getValue()&&(c.quotaSanitaria&&0>c.quotaSanitaria||c.quotaSociale&&0>c.quotaSociale)&&msgAddError(b,"MSG_QUOTE_NEGATIVE");return msgShow("",b)},onComboboxRegistroChange:function(b,c,d,f){c&&!Ext.isNumber(c)&&b.setValue(c.toUpperCase())},onComboboxCapitoloSelect:function(b,c,d){c=this.getDETTMOTIVIUSCITAForm().getForm();d=c.findField("dataDal");d.isValid()&&c.findField("articolo").getStore().load({params:{anno:d.getValue().getFullYear(),
codCapitolo:b.value?b.value:0}})},reloadStores:function(b,c,d){if(2==b.findField("tipoContabilita").getValue()||4==b.findField("tipoContabilita").getValue()||5==b.findField("tipoContabilita").getValue()){var f={},g={};4==b.findField("tipoContabilita").getValue()||5==b.findField("tipoContabilita").getValue()?(b.findField("conto").getStore().getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(f,{idOrganizzazione:null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:
getIdOrg(),idEsercizio:d&&d.data.parametriContabilita.annoConto?d.data.parametriContabilita.annoConto:b.findField("idEsercizio").getValue()}),b.setValues({annoConto:f.idEsercizio}),5!=b.findField("tipoDocumento").getValue()&&(b.findField("registro").getStore().getProxy().url=getUrlGen()+"/ws/genAmmPers/registriIva/detail/cboxByDate",Ext.apply(g,{dataControllo:b.findField("dataDal").getValue(),tipoDocumento:b.findField("tipoDocumento").getValue()?b.findField("tipoDocumento").getValue()/2:0,idOrganizzazione:null!=
this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg()}))):(b.findField("conto").getStore().getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(f,{idOrganizzazione:null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg(),anno:d&&d.data.parametriContabilita.annoConto?d.data.parametriContabilita.annoConto:c}),b.setValues({annoConto:f.anno}),ImpostaUrl([b.findField("registro").getStore()]),Ext.apply(g,{anno:c,tipoDocumento:b.findField("tipoDocumento").getValue()?
b.findField("tipoDocumento").getValue():0}));b.findField("conto").getStore().load({params:f,callback:function(){d&&b.setValues({conto:d.data.parametriContabilita.conto})}});b.findField("registro").editable||5==b.findField("tipoDocumento").getValue()||b.findField("registro").getStore().load({params:g,callback:function(){d&&b.setValues({registro:d.data.parametriContabilita.idRegistro?d.data.parametriContabilita.idRegistro:d.data.parametriContabilita.registro})}})}else 1==b.findField("tipoContabilita").getValue()&&
(b.findField("capitolo").getStore().load({params:{anno:c},callback:function(){d&&b.setValues({capitolo:d.data.parametriContabilita.capitolo})}}),b.findField("articolo").getStore().load({params:{anno:c,codCapitolo:d&&d.data.parametriContabilita.capitolo?d.data.parametriContabilita.capitolo:0},callback:function(){d&&b.setValues({articolo:d.data.parametriContabilita.articolo})}}))},impostaDati:function(b){var c=this.getDETTMOTIVIUSCITAForm(),d=c.getForm();this.getStoricoGrid().setDisabled(!1);this.cbaConfig.changeDataDal=
!1;clearForm(c);d.setValues({descrizioneCodice:traduci("NESSUNA_SELEZIONE")});b&&(d.loadRecord(b),c=b.data.dataDal.getFullYear(),setValue(d.findField("idParametriContabilita").id,b.data.idParametriContabilita),setValue(d.findField("idFranchigia").id,b.data.idFranchigia),b.data.franchigia&&d.setValues({descrizione:b.data.franchigia.descrizione,tipoImporto:b.data.franchigia.tipoImporto,tipoCalcolo:Ext.isEmpty(b.data.franchigia.tipoCalcolo)?"C":b.data.franchigia.tipoCalcolo}),b.data.parametriContabilita&&
(d.setValues({annoCda:b.data.parametriContabilita.annoCda?b.data.parametriContabilita.annoCda:d.findField("annoCda").getValue(),descrizioneCodice:b.data.parametriContabilita.cda?b.data.parametriContabilita.cda:traduci("NESSUNA_SELEZIONE"),desAnnoCda:b.data.parametriContabilita.desAnnoCda,cda:b.data.parametriContabilita.cda,cda1:b.data.parametriContabilita.cda1,idAliquotaIva:b.data.parametriContabilita.idAliquotaIva}),this.reloadStores(d,c,b)));this.cbaConfig.changeDataDal=!0;this.aggiornaStoreFranchigie()},
nuovo:function(){var b=this.getDETTMOTIVIUSCITAForm(),c=b.getForm();controller_nuovoRecord(b);c.findField("dataDal").setValue(new Date);c.findField("tipoImporto").setValue("G"==this.cbaConfig.tipoServizio?"I":"P");c.findField("tipoCalcolo").setValue("G"==this.cbaConfig.tipoServizio&&4==this.cbaConfig.domanda?"M":"C");c.setValues({descrizioneCodice:traduci("NESSUNA_SELEZIONE")});b=this.getGridFranchigie();svuotaStore(b.getStore());c.findField("dataDal").focus(!0,20)},verificaCampiForm:function(){var b=
[];this.getDETTMOTIVIUSCITAForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=this.getStoricoGrid().getStore(),d=this.getDETTMOTIVIUSCITAForm().getForm(),f={},g={},h={};d.findField("risposta").getValue()||d.findField("risposta").setValue(c.getProxy().extraParams.idRisposta);f.id=d.findField("id").getValue();f.risposta=d.findField("risposta").getValue();f.dataDal=d.findField("dataDal").getValue();f.idParametriContabilita=
d.findField("idParametriContabilita").getValue();f.idFranchigia=d.findField("idFranchigia").getValue();g.id=d.findField("idParametriContabilita").getValue();1==d.findField("tipoContabilita").getValue()?(g.conto=null,g.registro=null,g.capitolo=d.findField("capitolo").getValue(),g.articolo=d.findField("articolo").getValue()):(g.conto=d.findField("conto").getValue(),g.registro=d.findField("registro").getValue()?d.findField("registro").getRawValue():null,g.idRegistro=Ext.isNumber(d.findField("registro").getValue())?
d.findField("registro").getValue():null,g.capitolo=null,g.articolo=null);g.annoConto=d.findField("conto").getValue()?d.findField("annoConto").getValue():null;g.idAliquotaIva=d.findField("idAliquotaIva").getValue();g.annoCda=d.findField("cda").getValue()?d.findField("annoCda").getValue():null;g.cda=d.findField("cda").getValue();g.cda1=d.findField("cda1").getValue();h.id=d.findField("idFranchigia").getValue();h.idServizio=this.cbaConfig.idServizio;h.tipoImporto=d.findField("tipoImporto").getValue();
h.tipoCalcolo=this.getTipoCalcolo().getValue();f.parametriContabilita=g;f.franchigia=h;delete f.tipoDocumento;delete f.idEsercizio;delete f.descrizioneCodice;delete f.desAnnoCda;controller_salvaRecord(this.getDETTMOTIVIUSCITAForm(),f,b)},aggiornaStoreFranchigie:function(b,c){var d=this,f=d.getGridFranchigie().getStore(),g=d.getDETTMOTIVIUSCITAForm().getForm(),h=g.findField("idFranchigia").getValue();h?(f.getProxy().extraParams.idFranchigia=h,f.load({callback:function(c,h,n){n?Ext.isEmpty(c)||(b||
(b=g.findField("id").getValue()),c=trovaRecord(f,"id",b),h=d.getGridFranchigie(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(c?[c]:0),d.testata.getTxtCerca().focus()):msgShowError("",h.getError())}})):svuotaStore(f);d.getGridFranchigie().setDisabled(!h)},abilitaComponentiFranchige:function(b){this.getDetNuovo().setDisabled(!b);this.getDetElimina().setDisabled(!b);this.getBoxBottoni().setDisabled(!b);this.abilitaPannelliEsterni(b);this.getDETTMOTIVIUSCITAForm().getForm().getFields().each(function(c){c.setDisabled(!b)})},
setTitle:function(b){this.getDETTMOTIVIUSCITA().setTitle(b)},aggiornaStore:function(b){var c=this,d=c.getStoricoGrid().getStore(),f=c.getDETTMOTIVIUSCITAForm(),g=f.getForm();d.load({params:{idRisposta:d.getProxy().extraParams.idRisposta},callback:function(h,k,l){l?Ext.isEmpty(h)?(clearForm(f),g.setValues({descrizioneCodice:traduci("NESSUNA_SELEZIONE")}),c.aggiornaStoreFranchigie()):(b||(b=g.findField("id").getValue()),h=trovaRecord(d,"id",b),k=c.getStoricoGrid(),k.getSelectionModel().deselectAll(),
k.getSelectionModel().select(h?[h]:0)):msgShowError("",k.getError())}})},abilitaCampi:function(b,c){var d=this.getDETTMOTIVIUSCITAForm().getForm(),f=d.findField("conto"),g=d.findField("registro"),h=d.findField("capitolo"),k=d.findField("articolo"),l=d.findField("cda");f.setDisabled(!b.vediConto);g.setDisabled(!b.vediRegistro||5==b.tipoDocumento);h.setDisabled(!b.vediCapitolo);k.setDisabled(!b.vediArticolo);l.setReadOnly(!b.vediCda);b.vediRegistroMan?(g.setDisabled(!1),g.maxLength=2,g.setEditable(!0),
g.cbaConfig.valida=!1,g.forceSelection=!1,g.setHideTrigger(!0)):(g.setEditable(!1),g.setHideTrigger(!1),g.cbaConfig.valida=!0,g.maxLength=Number.MAX_VALUE,g.forceSelection=!0);this.cbaConfig.changeDataDal&&(svuotaStore(g.getStore()),svuotaStore(f.getStore()),svuotaStore(h.getStore()),svuotaStore(k.getStore()),d.setValues({conto:"",capitolo:"",articolo:""}),this.reloadStores(d,c,null));this.getPnlContoRegistro().setVisible(1!=b.tipoContabilitaAbilitata);this.getPnlCapitoloArticolo().setVisible(1==
b.tipoContabilitaAbilitata);this.getCmbAliquota().setVisible(!0);"R"==this.cbaConfig.tipoServizio&&Ext.isEmpty(this.getTipoCalcolo().getValue())?this.getTipoCalcolo().setValue("C"):"G"==this.cbaConfig.tipoServizio&&Ext.isEmpty(this.getTipoCalcolo().getValue())&&this.getTipoCalcolo().setValue(4==this.cbaConfig.domanda?"M":"C")},abilitaPannelliEsterni:function(b){this.getStoricoGrid().setDisabled(!b);this.testata.getTstNuovo().setDisabled(!b);this.testata.getTstElimina().setDisabled(!b);this.testata.getGrid1().setDisabled(!b);
this.cbaConfig.ctrlPerson?this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},onLaunch:function(){var b=this;b.getContainer().controller=b;var c=b.cbaConfig.params?b.cbaConfig.params.split(","):null;c&&traduci(c[0].substr(c[0].indexOf("=")+1));var d=b.getDETTMOTIVIUSCITAForm();d.permesso=b.cbaConfig.permesso;d.boxBottoni=b.getBoxBottoni();d.store=b.getStoricoGrid().getStore();
d.controller=b;c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=d.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(d.store,{id:c},function(){b.aggiornaStore()})},esci_callback:function(){var c=b.getContainer().up("window");controller_puoiUscire(c,b.getCOPERPRESENZEForm(),function(){b.salva(!0)},
function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),c);d.boxBottoni.queryById("btnEsci").setVisible(!1);c=Ext.create("Generali.store.Registro");ImpostaUrl([c,b.getGridFranchigie().getStore()]);var f=Ext.create("Generali.store.EuroPerc");"G"===this.cbaConfig.tipoServizio&&"H"===this.cbaConfig.scheda&&4===this.cbaConfig.domanda?f.remove(f.getAt(0)):(f.insert(1,[{codice:"R",valore:traduci("FRANCHIGIE_PERC_ROUND2")}]),
f.add({codice:"D",valore:"-"}));d.getForm().findField("tipoImporto").bindStore(f);d.getForm().findField("registro").bindStore(c);d.getForm().findField("conto").bindStore(Ext.create("Generali.store.Conto"));d.getForm().findField("capitolo").bindStore(Ext.create("Generali.store.Capitolo"));d.getForm().findField("articolo").bindStore(Ext.create("Generali.store.Articolo"));c=Ext.create("Generali.store.FranchigiaTipoCalcolo");b.getTipoCalcolo().bindStore(c);c.filter(function(c){var d=!0;"S"==b.cbaConfig.tipoServizio||
"A"==b.cbaConfig.tipoServizio||"M"==b.cbaConfig.tipoServizio?"C"===c.get("codice")||"M"===c.get("codice")?d=!0:d=!1:"C"===c.get("codice")||"S"===c.get("codice")?d=!0:d=!1;return d});c=Ext.create("Generali.store.AliquotaIva");d.getForm().findField("idAliquotaIva").bindStore(c);c.load();b.getPnlContoRegistro().hide();b.getPnlCapitoloArticolo().hide();b.getCmbAliquota().hide();b.aggiornaStoreFranchigie();if("L"!=b.cbaConfig.permesso)b.getDETTMOTIVIUSCITAForm().getForm().on("dirtychange",function(c,d){controller_abilitaBottoni(b.getDETTMOTIVIUSCITAForm());
b.getStoricoGrid().setDisabled(d);b.getGridFranchigie().setDisabled(d||0===b.getStoricoGrid().getStore().getCount());b.abilitaPannelliEsterni(!d)});c=b.getContainer().up("window");Localizer.localize(c);"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getDETTMOTIVIUSCITAForm()),controller_bottoniSolaLettura(b.getBoxBottoni()),this.getDetNuovo().setDisabled(!0),this.getDetElimina().setDisabled(!0))}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.OSPE_SRT",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"grid",selector:this.selContainer+"#grid"},{ref:"btnNuovo",selector:this.selContainer+"#btnNuovo"},{ref:"btnElimina",selector:this.selContainer+"#btnElimina"},{ref:"GGNotificaScadenzaDoc",selector:this.selContainer+"#GGNotificaScadenzaDoc"},{ref:"btnConferma",selector:this.selContainer+
"#btnConferma"},{ref:"BtnSblocca",selector:this.selContainer+"#BtnSblocca"}]);this.control(this.selContainer+"#grid",{beforeedit:this.onBeforeEditGrid,edit:this.onEditGrid,canceledit:this.onCancelEditGrid,validateedit:this.onValidateEditGrid});this.control(this.selContainer+"#btnNuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#btnElimina",{click:this.onButtonClickElimina});this.control(this.selContainer+"#btnConferma",{click:this.clickBtnConferma});this.control(this.selContainer+
"#BtnSblocca",{click:this.btnSbloccaClick})},btnSbloccaClick:function(){var b=this;Ext.widget("passwordCBA",{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(c){c&&(b.getBtnSblocca().setDisabled(!0),containerSolaLettura(b.getGrid(),!1),b.getBtnNuovo().setDisabled(!1),b.getBtnElimina().setDisabled(!1))}}).show()},bloccaSchermata:function(b){this.getBtnSblocca().setVisible(!0);containerSolaLettura(b,!0);this.getBtnNuovo().setDisabled(!0);this.getBtnElimina().setDisabled(!0)},clickBtnConferma:function(){var b=
this,c=0<b.storePersonOrg.count()?b.storePersonOrg.getAt(0):null;if(Ext.isEmpty(c))return!1;if(0>b.getGGNotificaScadenzaDoc().getValue())return msgShow(traduci("MSG_TITOLO_ERRORE"),traduci("MSG_VALORE_INSERITO_NON_CORRETTO"));c={versioneDB:c.data.versioneDB,id:c.data.id,idOrganizzazione:c.data.idOrganizzazione,numFascicoloAutomatico:Ext.isEmpty(c.data.numFascicoloAutomatico)?null:c.data.numFascicoloAutomatico,numFascicoloRipartiOgniAnno:Ext.isEmpty(c.data.numFascicoloRipartiOgniAnno)?null:c.data.numFascicoloRipartiOgniAnno,
numFascicoloFormato:Ext.isEmpty(c.data.numFascicoloFormato)||"N"==c.data.numFascicoloFormato?null:c.data.numFascicoloFormato,ggNotificaScadenzaDoc:b.getGGNotificaScadenzaDoc().getValue()};Ext.Ajax.request({url:"/cba/osp/co/ws/prszn/persgen/save",method:"POST",async:!1,jsonData:Ext.JSON.encode(c),success:function(c){c=Ext.JSON.decode(c.responseText);c.success?(b.loadGGNotificaScadenzaDoc(),msgShow("MSG_SALVATAGGIO_DATI",c.message)):msgShowError("",c.message)}})},onButtonClickNuovo:function(b,c,d){b=
this.getGrid();c=this.cbaConfig.params?this.cbaConfig.params.split(","):null;c={risposta:-9999,idServizio:this.cbaConfig.idServizio?this.cbaConfig.idServizio:null,codiceEnte:null,domanda:c?c[2].substr(c[2].indexOf("=")+1):this.cbaConfig.domanda,descrizione:null,scheda:c?c[1].substr(c[1].indexOf("=")+1):this.cbaConfig.scheda,notaInterna:null,tipoSov:null,tipoUscita:null,articoloPensioni:null,gruppo:null,associataA:null,tipoStato:null,classInt:null,classReg:null,giorniFranc:null,contoPensioni:null,
capitoloPensioni:null,ivaPensioni:null,raggruppamentoSov:null,codRaccordo:null,desEstesa:null};controller_nuovoRecordGrid(c,b)},onButtonClickElimina:function(b,c,d){var f=this;b=f.getGrid();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("risposta"):""},function(){f.aggiornaStore()})},onBeforeEditGrid:function(b,c,d){b=this.getGrid();if(!0===b.getPlugin().editing)return!1;if("TIPO_DOCUMENTO"==this.tipoRisposta)d=getColGrid(b,"descrizione"),c=c.record.data.classInt&&
-1==c.record.data.classInt,d.getEditor().setReadOnly(c),d=getColGrid(b,"tipoStato"),d.getEditor().setReadOnly(c),d.getEditor().allowBlank=!1;else if(c.record.data.classInt&&-1==c.record.data.classInt)return msgShowWarning("","MSG_NON_MODIFICABILE"),!1;this.abilitaComponenti(!1)},onCancelEditGrid:function(b,c,d){this.abilitaComponenti(!0);this.aggiornaStore(c.record.data.risposta)},onEditGrid:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();var f=c.record.data;
f.esenzioneReddito=getBoolValue(f.esenzioneReddito);f.esenzioneTotale=getBoolValue(f.esenzioneTotale);f.stato=getBoolValue(f.stato);["TIPO_PENSIONE","UNITA_ORGANIZZATIVA","CONVENZIONE_COMMERCIALE"].includes(this.tipoRisposta)&&(f.codSede=this.cbaConfig.idOrganizzazione);controller_salvaRecord(d,f,!1,null,null,null,"risposta")?this.abilitaComponenti(!0):b.startEdit(c.record,0)},onValidateEditGrid:function(b,c,d){b=[];record=c.newValues;"TIPO_ESENZIONE"==this.tipoRisposta&&record.esenzioneReddito&&
record.esenzioneTotale&&msgAddError(b,"MSG_ERRORE_ESENZIONE_TICKET");return msgShow("",b)},abilitaComponenti:function(b){this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b);IsolaCmp(this.getGrid(),!b);this.cbaConfig.ctrlPerson?this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},aggiornaStore:function(b){var c=this.getGrid(),d=c.getStore(),f=this.cbaConfig.params?
this.cbaConfig.params.split(","):null,f={scheda:f?f[1].substr(f[1].indexOf("=")+1):this.cbaConfig.scheda,domanda:f?f[2].substr(f[2].indexOf("=")+1):this.cbaConfig.domanda,idServizio:this.cbaConfig.idServizio?this.cbaConfig.idServizio:0};["TIPO_PENSIONE","UNITA_ORGANIZZATIVA","CONVENZIONE_COMMERCIALE"].includes(this.tipoRisposta)&&Ext.apply(f,{codSede:this.cbaConfig.idOrganizzazione});d.load({params:f,callback:function(f,h,k){k?(f=0,b&&((f=trovaRecord(d,"id",b))||(f=0)),c.getSelectionModel().select(f)):
msgShowError("",h.getError())}})},loadGGNotificaScadenzaDoc:function(){var b=this;b.storePersonOrg.load({params:{idOrg:CBA.parametriGenerali.idOrganizzazione},callback:function(c,d,f){f&&(Ext.isEmpty(c)||Ext.isEmpty(c[0].data.ggNotificaScadenzaDoc)||b.getGGNotificaScadenzaDoc().setValue(c[0].data.ggNotificaScadenzaDoc))}})},onLaunch:function(){var b=this,c=b.cbaConfig.params?b.cbaConfig.params.split(","):null;if(c){var d={};c.forEach(function(b){b=b.split("=");d[b[0]]=b[1]});title=traduci(d.internazText);
d.scheda&&(b.cbaConfig.scheda=d.scheda);d.domanda&&(b.cbaConfig.domanda=d.domanda)}else title=b.cbaConfig.text;c=b.getGrid();c.controller=b;c.setTitle(title);b.tipoRisposta=getEnumRispBySchedaDomanda(b.cbaConfig.scheda,b.cbaConfig.domanda);Ext.isDefined(b.cbaConfig.idOrganizzazione)||(b.cbaConfig.idOrganizzazione=getIdOrg());ImpostaUrl([c.getStore()]);for(var f=2;f<c.columns.length;f++)c.columns[f].hide();Ext.isDefined(b.cbaConfig.scheda)||Ext.isDefined(b.cbaConfig.domanda)||(b.cbaConfig.scheda=b.cbaConfig.params.substr(b.cbaConfig.params.indexOf("scheda")+
7,1),b.cbaConfig.domanda=b.cbaConfig.params.substr(b.cbaConfig.params.indexOf("domanda")+8));"TIPO_ESENZIONE"==b.tipoRisposta&&(getColGrid(c,"esenzioneReddito").show(),f=getColGrid(c,"esenzioneTotale"),f.setText(traduci("ESENZIONE_TOTALE")),f.show());if("TIPO_DOCUMENTO"==b.tipoRisposta){var g=getColGrid(c,"tipoStato"),f=Ext.create("GeneraliOSP.personalizzazioni.store.ComboTipologiaDocumento");editCombo(c,f,g,!1,!1);g.show();49!==CBA.moduli.moduloAttivo&&(g=getColGrid(c,"esenzioneTotale"),g.setText(traduci("CAMPO_MODELLO_FATTURA")),
g.show());b.getGGNotificaScadenzaDoc().setVisible(!0);b.getBtnConferma().setVisible(!0);b.storePersonOrg=Ext.create("GeneraliOSP.personalizzazioni.store.PersonOrganizzazione");b.loadGGNotificaScadenzaDoc()}"GRADO_ISTRUZIONE"==b.tipoRisposta&&49==getModuloAttivo()&&(g=getColGrid(c,"livEdu"),f=Ext.create("CS.store.AnniScolarita"),editCombo(c,f,g,!1,!1),getColGrid(c,"livEdu").show());"UNITA_ORGANIZZATIVA"==b.tipoRisposta&&(getColGrid(c,"codRaccordo").show(),getColGrid(c,"desEstesa").show(),getColGrid(c,
"notaInterna").show(),this.bloccaSchermata(c));if("TIPO_PENSIONE"==b.tipoRisposta){var f=null!=b.cbaConfig.idOrganizzazione?b.cbaConfig.idOrganizzazione:getIdOrg(),g=new Date,h=getPersonContabili(f,g,!0,null);if(2==h.tipoContabilitaAbilitata||4==h.tipoContabilitaAbilitata){var k,l=getColGrid(c,"contoPensioni");2==h.tipoContabilitaAbilitata?(k=Ext.create("Generali.store.Conto"),k.getProxy().extraParams={anno:g.getFullYear()}):(k=Ext.create("Generali.pianodeiconti.store.cboxContiIstituzionali"),k.getProxy().extraParams=
{idOrganizzazione:f,idEsercizio:h.idEsercizio});editCombo(c,k,l,!1,!1);l.show();k.load({callback:function(c,d,f){f?b.aggiornaStore():msgShowError("",d.getError())}})}else b.aggiornaStore()}else b.aggiornaStore();f=c.up("window");Localizer.localize(f);"L"==this.cbaConfig.permesso&&(containerSolaLettura(c.id),b.getBtnNuovo().setDisabled(!0),b.getBtnElimina().setDisabled(!0))},destroy:function(){this.cbaConfig.esci_callback&&this.cbaConfig.esci_callback();this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.OSPE_SRT_SERV",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"container",selector:this.selContainer+"#container"},{ref:"cntDettaglio",selector:this.selContainer+"#cntDettaglio"},{ref:"grid1",selector:this.selContainer+"#grid1"},{ref:"TxtCerca",selector:this.selContainer+"#TxtCerca"},{ref:"tstNuovo",selector:this.selContainer+"#tstNuovo"},{ref:"tstElimina",
selector:this.selContainer+"#tstElimina"},{ref:"tstCopia",selector:this.selContainer+"#tstCopia"},{ref:"lblNoteTitolo",selector:this.selContainer+"#lblNoteTitolo"},{ref:"iconAlunni",selector:this.selContainer+"#iconAlunni"}]);this.control(this.selContainer+"#grid1",{select:this.onGrid1Select,beforeedit:this.onGridBeforeEdit,edit:this.onGridEdit,canceledit:this.onGridCancelEdit,validateedit:this.onGridValidateEdit});this.control(this.selContainer+"#TxtCerca",{change:this.onTextfieldChange});this.control(this.selContainer+
"#tstNuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#tstElimina",{click:this.onButtonClickElimina});this.control(this.selContainer+"#tstCopia",{click:this.btnCopia})},btnCopia:function(){Ext.create("winCBA",{name:"GeneraliOSP.personalizzazioni.view.CuServiziCopia",titolo:"COPIA_ELEMENTI_SERVIZIO",dimensione:4,configItem:{permesso:this.cbaConfig.permesso,idOrganizzazione:this.cbaConfig.idOrganizzazione,tipoServizio:this.cbaConfig.tipoServizio,idServizio:this.cbaConfig.idServizio,
scheda:this.cbaConfig.scheda,domanda:this.cbaConfig.domanda,callbackRitorno:function(){}},closable:!0}).show()},onGridBeforeEdit:function(b,c,d){if(!0===this.getGrid1().getPlugin().editing)return!1;var f=c.record.data;if("L"==f.scheda&&6==f.domanda&&1==this.personContabili.tipoContabilitaAbilitata&&this.personContabili.vediArticolo){var g=b.editor.getForm();b=f.capitoloPensioni;g.findField("articoloPensioni").getStore().load({params:{anno:(new Date).getFullYear(),codCapitolo:b?b:0},callback:function(){g.setValues({articolo:f.articolo})}})}[102,
110].includes(this.cbaConfig.domanda)&&"V"==this.cbaConfig.scheda&&[13,14,15].includes(this.cbaConfig.tipoFlusso)&&50!=getModuloAttivo()&&(getColGrid(this.getGrid1(),"associataA").getEditor().allowBlank=!1);this.abilitaComponenti(!1)},onGridCancelEdit:function(b,c,d){this.abilitaComponenti(!0);this.aggiornaStore(c.record.data.risposta,c.record)},clearFiltersCol:function(b){b=getColGrid(this.getGrid1(),b);(b=b.getEditor&&b.getEditor()&&b.getEditor().getStore&&b.getEditor().getStore()||null)&&b.clearFilter()},
onGridEdit:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();var f=c.record.data;f.stato=getBoolValue(f.stato);f.esenzioneReddito="L"==this.cbaConfig.scheda&&1==this.cbaConfig.domanda?getBoolValue(f.esenzioneReddito):null;if(controller_salvaRecord(d,f,!1,null,null,null,"risposta")){if("E"==this.cbaConfig.scheda&&1==this.cbaConfig.domanda&&"G"!==this.cbaConfig.tipoServizio||"L"==this.cbaConfig.scheda&&(1==this.cbaConfig.domanda||2==this.cbaConfig.domanda)||"V"==
this.cbaConfig.scheda&&108==this.cbaConfig.domanda&&"M"===this.cbaConfig.tipoServizio)this.cbaConfig.editNewDettaglio=!0;this.abilitaComponenti(!0);this.aggiornaTitoloDett();b.grid.getStore().clearFilter();"L"==this.cbaConfig.regioneServizio&&"E"==this.cbaConfig.scheda&&5==this.cbaConfig.domanda&&this.clearFiltersCol("associataA");"E"==this.cbaConfig.scheda&&1==this.cbaConfig.domanda&&0<f.risposta&&!this.modalitaAdtSemplificato&&(b=this.getCntDettaglio().down("#gridDettaglio").controller,b.cbaConfig.recordTestata=
c.record.data,b.aggiornaStore())}else b.startEdit(c.record,0)},onGridValidateEdit:function(b,c,d){return msgShow("",[])},onButtonClickNuovo:function(b,c,d){b=this.getGrid1().getStore().getProxy().extraParams;c=this.cbaConfig;b={risposta:-9999,codiceEnte:null,idServizio:b.idServizio,domanda:b.domanda,descrizione:null,scheda:b.scheda,notaInterna:null,tipoSov:"A"==c.scheda&&1==c.domanda?"T":null,tipoUscita:50==getModuloAttivo()?"A"==c.scheda&&1==c.domanda?"T":"H"==c.scheda&&2==c.domanda?"F":null:"H"==
c.scheda&&4==c.domanda?"Q":null,articoloPensioni:null,gruppo:null,associataA:null,giorniFranc:null,tipoStato:null,classInt:null,classReg:null,contoPensioni:null,capitoloPensioni:null,ivaPensioni:null,raggruppamentoSov:null,esenzioneReddito:null,idIcona:null};c=this.getGrid1();this.cbaConfig.editNewDettaglio=!1;controller_nuovoRecordGrid(b,c)&&("E"==this.cbaConfig.scheda&&1==this.cbaConfig.domanda&&"G"!==this.cbaConfig.tipoServizio||"L"==this.cbaConfig.scheda&&(1==this.cbaConfig.domanda||2==this.cbaConfig.domanda)||
"V"==this.cbaConfig.scheda&&108==this.cbaConfig.domanda&&"M"===this.cbaConfig.tipoServizio)&&(this.cbaConfig.editNewDettaglio=!0)},onButtonClickElimina:function(b,c,d){var f=this;b=this.getGrid1();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("risposta"):""},function(){f.aggiornaStore()})},onTextfieldChange:function(b,c,d,f){setTaskField(b,function(){var c=b.up("gridpanel"),d=c.getStore();d.clearFilter();d.filter("descrizione",b.getValue());0==d.getCount()&&
(d.clearFilter(),d.filter("desFrequente",b.getValue()));b.focus();0<d.getCount()&&c.getSelectionModel().select(0)})},onGrid1Select:function(b,c,d,f){d=this.cbaConfig;b=c.get("risposta");if(!this.modalitaAdtSemplificato){if("E"==d.scheda&&1==d.domanda||"L"==d.scheda&&(1==d.domanda||2==d.domanda||5==d.domanda)||"V"==d.scheda&&108==d.domanda&&"M"===d.tipoServizio){if(d=this.getCntDettaglio().down("#gridDettaglio"))d.getStore().getProxy().extraParams.idRisposta=c.data.risposta,0<b&&(b=d.controller,b.cbaConfig.recordTestata=
c.getData(),b.aggiornaStore())}else"H"!=d.scheda||2!=d.domanda&&4!=d.domanda||64==CBA.moduli.moduloAttivo||(d=this.getCntDettaglio().down("#Container").controller,d.getStoricoGrid().getStore().getProxy().extraParams.idRisposta=c.data.risposta,0<b&&d.aggiornaStore());this.aggiornaTitoloDett()}},abilitaComponenti:function(b){this.getTstNuovo().setDisabled(!b);this.getTstElimina().setDisabled(!b);var c=this.getTxtCerca();c.setDisabled(!b);c.suspendEvent("change");c.setValue("");c.resumeEvent("change");
c=this.cbaConfig;this.modalitaAdtSemplificato||("E"==c.scheda&&1==c.domanda||"L"==c.scheda&&(1==c.domanda||2==c.domanda||5==c.domanda)||"V"==c.scheda&&108==c.domanda&&"M"===c.tipoServizio?this.getCntDettaglio().down("#gridDettaglio").setDisabled(!b):"H"!=c.scheda||2!=c.domanda&&4!=c.domanda||64==CBA.moduli.moduloAttivo||this.getCntDettaglio().down("#Container").controller.getGridFranchigie().setDisabled(!b));this.cbaConfig.ctrlPerson?this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):
Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},aggiornaTitoloDett:function(){var b=this.cbaConfig,c=this.getGrid1().getSelectionModel().getSelection()[0];this.modalitaAdtSemplificato||c&&("E"==b.scheda&&1==b.domanda||"L"==b.scheda&&(1==b.domanda||2==b.domanda||5==b.domanda)||"V"==b.scheda&&108==b.domanda?this.getCntDettaglio().down("#gridDettaglio").setTitle(c.get("descrizione")):"H"!=b.scheda||2!=b.domanda&&4!=b.domanda||64==CBA.moduli.moduloAttivo||this.getCntDettaglio().down("#Container").controller.setTitle(c.get("descrizione")))},
aggiornaStore:function(b,c){var d=this,f=this.getGrid1(),g=f.getStore(),h=g.getProxy(),k=this.cbaConfig;h.extraParams.scheda=k.scheda;h.extraParams.domanda=k.domanda;h.extraParams.idServizio=k.idServizio;"L"==d.cbaConfig.regioneServizio&&"E"==d.cbaConfig.scheda&&5==d.cbaConfig.domanda&&d.clearFiltersCol("associataA");g.load({callback:function(c,h,p){if(p){var l;b&&(l=trovaRecord(g,"risposta",b));f.getSelectionModel().select(l?[l]:0);d.modalitaAdtSemplificato||("E"==k.scheda&&1==k.domanda||"L"==k.scheda&&
(1==k.domanda||2==k.domanda||5==k.domanda)||"V"==k.scheda&&108==k.domanda?d.getCntDettaglio().down("#gridDettaglio").setVisible(c&&0<c.length):"H"!=k.scheda||2!=k.domanda&&4!=k.domanda||64==CBA.moduli.moduloAttivo||d.getCntDettaglio().down("#Container").controller.getGridFranchigie().setVisible(c&&0<c.length))}else msgShowError("",h.getError());!p||Ext.isEmpty(c)||!d.getCntDettaglio().down("#gridDettaglio")&&!d.getCntDettaglio().down("#Container")||d.modalitaAdtSemplificato?d.getCntDettaglio().hide():
d.getCntDettaglio().show();d.getTstCopia().setDisabled(Ext.isEmpty(c))}})},aggiornaStoreIconeAlunni:function(b,c){var d=Ext.create("Ext.data.ArrayStore",{fields:["codice","valore","img"],data:function(){for(var b=[0,2,5,6,7,8,27,28,56,57,60,61,62,63,65,73,85,82,86,87,89,93,97],c=[],d=1;100>d;d++)0<b.indexOf(d)||c.push([d,'<img src="/cba/css/generali/images/attivita/'+d+'.svg"/ style= "height:20px;">',""]);return c}(),autoLoad:!0,autoDestroy:!0});editCombo(b,d,c,!1,!0,null,null);c.show()},impostaGrigliaTestata:function(){var b=
this,c,d=this.getGrid1();ImpostaUrl([d.getStore()]);d.getStore().clearFilter();if(this.titolo)d.setTitle(this.titolo);else if(49!==getModuloAttivo()){var f=Ext.getCmp("containerPersonalizzazioni").queryById("pnlAlbero").getRootNode().findChild("idRecord",this.cbaConfig.idRecord,!0).parentNode;d.setTitle(f.data.text+" - "+this.cbaConfig.text)}for(var f=getColGrid(d,"raggruppamentoSov"),g=50==getModuloAttivo()?getColGrid(d,"idIcona"):null,h=2;h<d.columns.length;h++)d.columns[h].hide();[1,3,5].includes(b.cbaConfig.domanda)&&
"E"==b.cbaConfig.scheda&&getColGrid(d,"livEdu").show();if("H"==b.cbaConfig.scheda&&(2==b.cbaConfig.domanda||4==b.cbaConfig.domanda)||"A"==b.cbaConfig.scheda&&1==b.cbaConfig.domanda){if("H"!=b.cbaConfig.scheda||2!=b.cbaConfig.domanda&&4!=b.cbaConfig.domanda)"A"==b.cbaConfig.scheda&&1==b.cbaConfig.domanda&&(c=Ext.create("GeneraliOSP.store.UscitaDim"),ImpostaUrl([c]),c.load({callback:function(b,c,f){d.getView().refresh()}}));else if(43==getModuloAttivo()||55==getModuloAttivo()||64==getModuloAttivo())c=
Ext.create("GeneraliOSP.store.UscitaTemp"),ImpostaUrl([c]),c.load({callback:function(b,c,f){d.getView().refresh()}}),64!=getModuloAttivo()&&4!=b.cbaConfig.domanda&&getColGrid(d,"associataA").show();50==getModuloAttivo()||"H"==b.cbaConfig.scheda&&4==b.cbaConfig.domanda||(editCombo(d,c,getColGrid(d,"tipoUscita"),!0,!1),getColGrid(d,"tipoUscita").show())}else if("E"==b.cbaConfig.scheda&&1==b.cbaConfig.domanda)b.storeClassReg=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/classificazioni"},
autoLoad:!1,autoDestroy:!1}),b.storeClassReg.load({params:{type:5,idServizio:b.cbaConfig.idServizio},callback:function(b,c,f){d.getView().refresh()}}),c=43==getModuloAttivo()||55==getModuloAttivo()||50==getModuloAttivo(),h=getColGrid(d,"classReg"),editCombo(d,b.storeClassReg,h,c,!1),h.show(),b.storeClassInt=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/classificazioni"},autoLoad:!1,autoDestroy:!1}),b.storeClassInt.load({params:{type:3,idServizio:b.cbaConfig.idServizio},
callback:function(b,c,f){d.getView().refresh()}}),h=getColGrid(d,"classInt"),editCombo(d,b.storeClassInt,h,c,!1),h.show(),b.storeTipoQuota=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/prszn/tipoquota/cbox"},autoLoad:!1,autoDestroy:!1}),b.storeTipoQuota.load({callback:function(b,c,f){d.getView().refresh()}}),editCombo(d,b.storeTipoQuota,getColGrid(d,"tipoSov"),!0,!1),getColGrid(d,"tipoSov").show(),b.storeTipoQuota.clearFilter(),"S"==b.cbaConfig.tipoServizio||"A"==
b.cbaConfig.tipoServizio?b.storeTipoQuota.filter("codice",/G|M/):"G"!=b.cbaConfig.tipoServizio&&"M"!=b.cbaConfig.tipoServizio||b.storeTipoQuota.filter("codice",/G/),b.storeDesStampa=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/class/des4rpt"},autoLoad:!1,autoDestroy:!1}),b.storeDesStampa.load({params:{idServizio:b.cbaConfig.idServizio},callback:function(b,c,f){d.getView().refresh()}}),editCombo(d,b.storeDesStampa,f,!1,!1),f.show(),g&&b.aggiornaStoreIconeAlunni(d,
g),"G"==b.cbaConfig.tipoServizio&&(f=getColGrid(d,"giorniFranc"),f.allowBlank=!1,g=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/criterioQuote/search"}}),g.load({params:{valore:"",idServizio:b.cbaConfig.idServizio},callback:function(b,c,f){d.getView().refresh()}}),editCombo(d,g,f,!0,!1,200),f.minWidth=200,f.show()),"M"==b.cbaConfig.tipoServizio&&(getColGrid(d,"notaInterna").show(),getColGrid(d,"desFrequente").show());else if("L"==b.cbaConfig.scheda&&[1,2,5].includes(b.cbaConfig.domanda)){if(1==
b.cbaConfig.domanda||2==b.cbaConfig.domanda)Ext.getStore("RaggrScontiSupplementi").load({params:{tipoRaggr:"1"==b.cbaConfig.domanda?"S":"C",idServizio:b.cbaConfig.idServizio},callback:function(b,c,f){d.getView().refresh()}}),editCombo(d,"RaggrScontiSupplementi",f,!1,!1),f.show(),g&&b.aggiornaStoreIconeAlunni(d,g),1==b.cbaConfig.domanda&&"G"==b.cbaConfig.tipoServizio&&getColGrid(d,"notaInterna").show(),[13,14,15].includes(b.cbaConfig.tipoFlusso)&&(g=new Ext.data.ArrayStore({fields:["codice","valore"],
data:[["1",traduci("FR_CLASSE_EXTRA_SI"),""],["2",traduci("FR_CLASSE_EXTRA_NO"),""]],autoLoad:!0,autoDestroy:!0}),f=getColGrid(d,"gruppo"),f.setText(traduci("CLASSE")),f.initialConfig.text=f.text,editCombo(d,g,f,!1,!0,300),f.show());1==b.cbaConfig.domanda?getColGrid(d,"esenzioneReddito").show():5==b.cbaConfig.domanda&&(getColGrid(d,"descrizione").hide(),getColGrid(d,"desFrequente").show(),getColGrid(d,"desEstesa").show())}else"L"==b.cbaConfig.scheda&&6==b.cbaConfig.domanda&&(f=Ext.create("Ext.data.Store",
{fields:[{name:"codice"},{name:"valore"}],data:[{codice:"1",valore:traduci("ACCREDITO")},{codice:"2",valore:traduci("ADDEBITO")}],autoLoad:!0}),editCombo(d,f,getColGrid(d,"tipoSov"),!0,!1),f=getColGrid(d,"tipoSov"),f.setText("TIPO"),f.initialConfig.text=f.text,f.editor.minChars=1,f.editor.editable=!0,f.show(),this.personContabili=getPersonContabili(b.cbaConfig.idOrganizzazione,new Date,!0,null),1==this.personContabili.tipoContabilitaAbilitata&&(this.personContabili.vediArticolo&&(g=Ext.create("Generali.store.Articolo"),
f=getColGrid(d,"articoloPensioni"),editCombo(d,g,f,!1,!0,300),f.show()),g=Ext.create("Generali.store.Capitolo"),f=getColGrid(d,"capitoloPensioni"),editCombo(d,g,f,!0,!0,300,function(){if(b.personContabili.vediArticolo){var c=b.getGrid1().getPlugin().editor.getForm(),f=c.findField("capitoloPensioni").getValue();c.findField("articoloPensioni").getStore().load({params:{anno:(new Date).getFullYear(),codCapitolo:f?f:0},callback:function(b,c,f){d.getView().refresh()}})}}),f.show(),f.allowBlank=!1,g.load({params:{anno:(new Date).getFullYear()},
callback:function(b,c,f){d.getView().refresh()}})));if(102==b.cbaConfig.domanda&&"V"==b.cbaConfig.scheda&&[13,14,15].includes(b.cbaConfig.tipoFlusso)&&50!=getModuloAttivo()){var k=getColGrid(d,"associataA"),l=Ext.create("Generali.data.StoreCodiceValore");Ext.Ajax.request({method:"GET",params:{scheda:"V",domanda:110,idServizio:b.cbaConfig.idServizio},url:getUrlGen()+"/ws/genOsp/risp/src",success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(b.data.forEach(function(b){var c={};Ext.apply(c,
{codice:b.associataA,valore:b.descrizione});l.add(c)}),d.getView().refresh()):msgShowError("",b.message)}});editCombo(d,l,k,!1,!0,500);k.minWidth=500;k.show()}("V"==b.cbaConfig.scheda&&104==b.cbaConfig.domanda&&["L","V","T","M","W"].includes(b.cbaConfig.regioneServizio)||"V"==b.cbaConfig.regioneServizio&&"E"==b.cbaConfig.scheda&&5==b.cbaConfig.domanda||"E"==b.cbaConfig.scheda&&1==b.cbaConfig.domanda&&"M"==b.cbaConfig.tipoServizio||"V"==b.cbaConfig.scheda&&110==b.cbaConfig.domanda&&[12,13,14,15,16].includes(b.cbaConfig.tipoFlusso)&&
50!=getModuloAttivo())&&!Ext.isEmpty(b.cbaConfig.tipoFlusso)&&(f=getColGrid(d,"associataA"),g=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/fr/codifiche/cbox"}}),c={tipoFlusso:b.cbaConfig.tipoFlusso},"TIPO_RICOVERO"==b.tipoRisposta&&Ext.apply(c,{tipoCodifica:"TR"}),"REGIME_RICOVERO"==b.tipoRisposta&&[13,14,15].includes(b.cbaConfig.tipoFlusso)&&Ext.apply(c,{tipoCodifica:"RR"}),g.load({params:c,callback:function(c,f,g){if(![50,64].includes(getModuloAttivo())){var h=
"";!("CLASSIFICAZIONE_RETTA"==b.tipoRisposta&&"M"==b.cbaConfig.tipoServizio||["CLASSIFICAZIONE_REG","TIPO_RICOVERO"].includes(b.tipoRisposta))||"CLASSIFICAZIONE_REG"==b.tipoRisposta&&"L"==b.cbaConfig.regioneServizio||("CLASSIFICAZIONE_REG"==b.tipoRisposta&&"V"==b.cbaConfig.regioneServizio?h="CL":"CLASSIFICAZIONE_RETTA"==b.tipoRisposta&&"M"==b.cbaConfig.tipoServizio&&(h="CN"));this.clearFilter();Ext.isEmpty(h)||this.filter({filterFn:function(b){return b.data.extra==h}})}d.getView().refresh()}}),editCombo(d,
g,f,!1,!0,500),f.minWidth=500,f.show());if(50!=getModuloAttivo()&&"L"==b.cbaConfig.regioneServizio&&"E"==b.cbaConfig.scheda&&5==b.cbaConfig.domanda){b.clearFiltersCol("associataA");var g=Ext.create("GeneraliOSP.store.gruppiClass"),n=Ext.create("CU.store.OsRenLom"),f=getColGrid(d,"gruppo"),k=getColGrid(d,"associataA");c=getColGrid(d,"giorniFranc");n.load();editCombo(d,g,f,!1,!0,300,function(b,c,d){n.clearFilter();n.filter({filterFn:function(c){return c.data.extra==b}});k.getEditor().clearValue()});
f.show();editCombo(d,n,k,!1,!0,300);k.minWidth=150;k.show();c.show();var p=this.getLblNoteTitolo(),q=traduci("LOMB_GGFRANCHIGIA_ANNUI")+": ";p.update(q);p.show();Ext.Ajax.request({method:"GET",url:"/cba/osp/co/ws/prszn/persLomb/ggFrancAnno",success:function(b){b=Ext.JSON.decode(b.responseText);b.success?p.update(q+b.data):msgShowError("",b.message)}})}else 50!=getModuloAttivo()&&"V"==b.cbaConfig.regioneServizio&&"E"==b.cbaConfig.scheda&&5==b.cbaConfig.domanda&&(f=getColGrid(d,"classReg"),g=getColGrid(d,
"percRimbOsp"),b.storeClassReg=Ext.create("CU.store.ClassStdVen"),b.storeClassReg.load(),editCombo(d,b.storeClassReg,f,!1,!0,300,function(c,d,f){b.storeClassReg.clearFilter()}),f.initialConfig.text="VEN_CLASS_STD_VEN",f.show(),g.show());"L"==b.cbaConfig.scheda&&7==b.cbaConfig.domanda&&(f=getColGrid(d,"classInt"),f.editor={xtype:"numberfield",allowBlank:!1,minValue:1,maxValue:10,allowDecimals:!1},f.show())},impostaGrigliaDettaglio:function(){if(!this.modalitaAdtSemplificato){var b=null;["MOTIVO_ASSENZA",
"CRITERIO_QUOTE"].includes(this.tipoRisposta)?64!=getModuloAttivo()&&(b="GeneraliOSP.personalizzazioni.app.view.DETTMOTIVIUSCITA"):["CLASSIFICAZIONE_RETTA","SUPPLEMENTO","SCONTO","VOCI_FREQUENTI","POSIZIONE_TICKET"].includes(this.tipoRisposta)&&(b="GeneraliOSP.personalizzazioni.app.view.CORISPOSTE_DE");if(b){b=Ext.create(b,{flex:1,cbaConfig:this.cbaConfig,testata:this});if("POSIZIONE_TICKET"==this.tipoRisposta){var c=b.controller.getGridDettaglio();getColGrid(c,"quotaSociale").hide();getColGrid(c,
"idAliquotaIva").hide();getColGrid(c,"conto").hide();getColGrid(c,"registro").hide();getColGrid(c,"cda").hide();getColGrid(c,"desAnnoCda").hide();getColGrid(c,"capitolo").hide();getColGrid(c,"articolo").hide()}this.getCntDettaglio().add(b);this.getCntDettaglio().down("#gridDettaglio")?(b=this.getCntDettaglio().down("#gridDettaglio"),b=b.getStore(),b.removeAll()):this.getCntDettaglio().down("#Container")&&(b=this.getCntDettaglio().down("#Container").controller.getStoricoGrid(),b=b.getStore(),b.removeAll())}}},
onLaunch:function(){var b=this;this.cbaConfig.editNewDettaglio=!1;this.tipoRisposta=getEnumRispBySchedaDomanda(this.cbaConfig.scheda,this.cbaConfig.domanda);this.impostaGrigliaTestata();this.modalitaAdtSemplificato=!1;CBA.StdUtenti.getImpostazioniServizio(CBA.moduli.moduloAttivo,this.cbaConfig.idServizio).then(function(c){b.modalitaAdtSemplificato=1==c.modalitaIntZucchetti?!0:!1;b.impostaGrigliaDettaglio()})["catch"](function(b){return msgShowError("",b)});"L"==this.cbaConfig.permesso&&(containerSolaLettura(this.getGrid1().id),
this.getTstNuovo().setDisabled(!0),this.getTstElimina().setDisabled(!0));this.aggiornaStore();var c=this.getContainer().up("window");Localizer.localize(c)},destroy:function(){this.storeDesStampa&&eliminaStore(this.storeDesStampa);this.storeTipoQuota&&eliminaStore(this.storeTipoQuota);this.storeClassInt&&eliminaStore(this.storeClassInt);this.storeClassReg&&eliminaStore(this.storeClassReg);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.app.controller.TEANAPERS",{extend:"Generali.standard.ViewController",init:function(){var b=this;b.selContainer="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"GridMedici",selector:b.selContainer+"#GridMedici"},{ref:"BtnNuovo",selector:b.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:b.selContainer+"#BtnElimina"},{ref:"TxtCerca",selector:b.selContainer+"#TxtCerca"},{ref:"BtnSostituisci",selector:b.selContainer+"#BtnSostituisci"},{ref:"CBSostituisci",
selector:b.selContainer+"#CBSostituisci"}]);b.control(b.selContainer+"#GridMedici",{beforeedit:b.beforeeditGridMedici,edit:b.editGridMedici,canceledit:b.canceleditGridMedici,validateedit:b.validateeditGridMedici});b.control(b.selContainer+"#CBSostituisci",{expand:b.aggiornaCB});b.control(b.selContainer+"#BtnNuovo",{click:b.clickBtnNuovo});b.control(b.selContainer+"#BtnElimina",{click:b.clickBtnElimina});b.control(b.selContainer+"#BtnSostituisci",{click:b.clickBtnSostituisci});b.control(b.selContainer+
"#TxtCerca",{change:Ext.Function.createBuffered(function(c){var d=b.getGridMedici(),f=d.getStore();f.clearFilter();f.filter("descrizione",c.getValue());c.focus();0<f.getCount()&&d.getSelectionModel().select(0);c.focus()},100,b)})},clickBtnNuovo:function(b){controller_nuovoRecordGrid({codiceEnte:CBA.parametriGenerali.codEnte,tipo:"M",id:null},this.getGridMedici())},clickBtnElimina:function(b){var c=this;b=c.getGridMedici();var d=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),
{id:d?d.get("id"):""},function(){c.aggiornaStore()})},clickBtnSostituisci:function(){this.getGridMedici().getSelectionModel().getSelection();msgShowWarning("ATTENZIONE","FUNZIONALITA' IN MANUTENZIONE")},beforeeditGridMedici:function(b,c,d){if(!0===b.editing)return!1;b=b.getEditor().getForm();d=b.findField("nazione");var f=b.findField("comune"),g=c.record.get("desComune"),h=b.findField("idOrganizzazione"),k=c.record.get("idOrganizzazione");Ext.isEmpty(g)||(g=g.endsWith(")")?g.split("(")[0].trim():
"",this.storeComuni.load({params:{valore:g}}));b.findField("specializzazione").bindStore(this.storeTipoSpecializzazione);d.bindStore(this.storeNazioni);f.bindStore(this.storeComuni);f.on("beforequery",function(b,c){if(!b.query)return!1;forceQueryCombo(f,2," ")});d.primaVolta||(d.primaVolta=!0,d.on("change",function(b,c){var d="0"==c;f.setReadOnly(!d);d||f.setValue()}));d.fireEvent("change",d,c.record.get("nazione"));c.record.set("idOrganizzazione",Ext.isEmpty(k)?"F":"T");h.setDisabled(Ext.isEmpty(k)?
!1:!0);this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(b){IsolaCmp(this.getGridMedici(),!b);this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b);this.getTxtCerca().setDisabled(!b);this.getCBSostituisci().setDisabled(!b);this.getBtnSostituisci().setDisabled(!b)},editGridMedici:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();Ext.isEmpty(d.idOrganizzazione)||1!=d.idOrganizzazione&&"T"!=d.idOrganizzazione?d.idOrganizzazione=null:d.idOrganizzazione=this.cbaConfig.idOrganizzazione;
f.controller=this;f.store=c.view.getStore();controller_salvaRecord(f,d,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):b.startEdit(c.record,0)},canceleditGridMedici:function(b,c,d){this.abilitaBottoniGrid(!0);this.aggiornaStore(c.record.get("id"))},validateeditGridMedici:function(b,c,d){return msgShow("",[])},aggiornaStore:function(b){var c=this.getGridMedici(),d=c.getStore();d.load({params:{codiceEnte:CBA.parametriGenerali.codEnte,idOrg:this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:
getIdOrg(),descrizione:""},callback:function(f,g,h){if(h){var k;b&&(k=trovaRecord(d,"id",b));c.getSelectionModel().select(k?[k]:0)}else msgShowError("",g.getError())}})},svuotaStore:function(){svuotaStore(this.getGridMedici().getStore())},aggiornaCB:function(){var b=this.getCBSostituisci().getStore(),c=this.getGridMedici();b.filter(function(b){b=b.get("valore");var d=c.getSelectionModel().getSelection()[0];return b!=d.data.descrizione?!0:!1})},onLaunch:function(){var b=this.cbaConfig.params?this.cbaConfig.params.split(","):
null,b=b?traduci(b[0].substr(b[0].indexOf("=")+1)):this.cbaConfig.text,c=this.getCBSostituisci().getStore();gridMedici=this.getGridMedici();gridMedici.controller=this;gridMedici.setTitle(b);this.storeTipoSpecializzazione=Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/risposte/cbox",extraParams:{scheda:"M",domanda:1}},autoDestroy:!1});this.storeNazioni=Ext.create("GeneraliOSP.fascicoloNoApp.store.Nazioni",{autoDestroy:!1});this.storeComuni=Ext.create("GeneraliOSP.fascicoloNoApp.store.Comuni",
{proxy:{extraParams:{excom:!0}},autoDestroy:!1});ImpostaUrl([c,gridMedici.getStore(),this.storeTipoSpecializzazione,this.storeNazioni,this.storeComuni]);this.storeTipoSpecializzazione.load({callback:function(b,c,g){g||msgShowError("",c.getError())}});this.storeNazioni.load({callback:function(b,c,g){g||msgShowError("",c.getError())}});this.aggiornaStore()},destroy:function(){eliminaStore(this.storeTipoSpecializzazione);eliminaStore(this.storeNazioni);eliminaStore(this.storeComuni);this.callParent()}});
Ext.define("Personalizzazioni.model.modAlbero",{extend:"Ext.data.Model",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idOrganizzazione"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/prszn/conf/tree",reader:{type:"json",messageProperty:"message",rootProperty:"children"}}});
Ext.define("Personalizzazioni.model.modCOPERBOLLO",{extend:"Ext.data.Model",proxy:{type:"ajax",api:{read:"/cba/osp/co/ws/prszn/bolloext/src",create:"/cba/osp/co/ws/prszn/bolloext/new",update:"/cba/osp/co/ws/prszn/bolloext/update",destroy:"/cba/osp/co/ws/prszn/bollo/delete"},url:"/cba/osp/co/ws/prszn/bolloext/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},fields:[{name:"id"},{name:"idPersonTestata"},{name:"data",type:"date"},{name:"importoBollo"},{name:"importoMinimoBollo"},
{name:"aliquota"},{name:"cda"},{name:"annoCda"},{name:"desAnnoCda"},{name:"cda1"},{name:"bolloVirtuale"},{name:"competenzaMinMaxDettagli"},{name:"descBolloVirtuale"},{name:"conto"},{name:"annoConto"},{name:"capitolo"},{name:"articolo"},{name:"idAliquotaIva"},{name:"idParametriContabilita"}]});
Ext.define("Personalizzazioni.model.modCOPERCALCOLORETTE",{extend:"Ext.data.Model",proxy:{type:"ajax",api:{read:"/cba/osp/co/ws/prszn/calcrtt/src",create:"/cba/osp/co/ws/prszn/calcrtt/new",update:"/cba/osp/co/ws/prszn/calcrtt/update",destroy:"/cba/osp/co/ws/prszn/calcrtt/delete"},url:"/cba/osp/co/ws/prszn/calcrtt/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},fields:[{name:"id"},{name:"idPersonTestata"},{name:"data",type:"date"},{name:"calcoloRetta"},{name:"bolloAutomatico"},
{name:"ivaConScorporo"},{name:"separazioneRetta"},{name:"mensilita"},{name:"idModelloFattura"},{name:"protezioneRetta"},{name:"conguaglioAutomatico"},{name:"prestazioniAmbulatoriali"},{name:"prestazioniAmbulatorialiEsaurite"}]});
Ext.define("Personalizzazioni.model.modCOPERCONTABILI",{extend:"Ext.data.Model",proxy:{type:"ajax",api:{read:"/cba/osp/co/ws/prszn/contbl/src",create:"/cba/osp/co/ws/prszn/contbl/new",update:"/cba/osp/co/ws/prszn/contbl/update",destroy:"/cba/osp/co/ws/prszn/contbl/delete"},url:"/cba/osp/co/ws/prszn/contbl/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},fields:[{name:"id"},{name:"idPersonTestata"},{name:"data",type:"date"},{name:"idRegistro"},{name:"registro"},
{name:"tipoDocumento"},{name:"tipoContabilitaAbilitata"},{name:"condizionePagamento"},{name:"causaleFattura"},{name:"causaleNotaAccredito"},{name:"enteIvaFinanziaria"},{name:"desEnteIvaFinanziaria"},{name:"tipoContropartitaCorrispettivi"},{name:"contoContropartitaCorrispettivi"},{name:"ftLibDesBreve"},{name:"pensNonRaggrMovimRetta"},{name:"pensAzzeraResidui"},{name:"pensScadenzeAlNetto"},{name:"pensIncassoTipoPassaggio"},{name:"pensIncassoCausale"},{name:"pensIncassoContoScad"},{name:"pensIncassoContoDare"},
{name:"pensIncassoTipoContoAvere"},{name:"pensIncassoContoAvere"},{name:"pensIncassoEntrateCapitolo"},{name:"pensIncassoEntrateArticolo"},{name:"pensIncassoSpeseCapitolo"},{name:"pensIncassoSpeseArticolo"},{name:"pensScadenzeAlNetto"},{name:"pensCreaDocumentoContabile"},{name:"pensPassaggioCausale"},{name:"pensPassaggioConto"},{name:"elaboraRetteZero"},{name:"attivita"},{name:"rigeneraAddebitiAccrediti"},{name:"pensIncassoNoCassa"},{name:"accreditoUsaEccedenza"},{name:"bloccaCanc_Eco2"}]});
Ext.define("Personalizzazioni.model.modComboBox",{extend:"Ext.data.Model",fields:[{name:"codice"},{name:"valore"},{name:"extra"}]});Ext.define("Personalizzazioni.store.CBEnteIva",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"CBEnteIva",proxy:{type:"ajax",url:"/cba/gen/ws/general/entivafin/cbox",reader:{type:"json"}}},b)])}});
Ext.define("Personalizzazioni.store.CBPersonBollo",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"CBPersonBollo",proxy:{type:"ajax",url:getUrlGen()+"/ws/genOsp/prszn/perste/cbox",reader:{type:"json"}}},b)])}});
Ext.define("Personalizzazioni.store.CBPersonCalcoloRette",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"CBPersonCalcoloRette",proxy:{type:"ajax",url:getUrlGen()+"/ws/genOsp/prszn/perste/cbox",reader:{type:"json"}}},b)])}});
Ext.define("Personalizzazioni.store.CBPersonContabili",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"CBPersonContabili",proxy:{type:"ajax",url:getUrlGen()+"/ws/genOsp/prszn/perste/cbox",reader:{type:"json"}}},b)])}});
Ext.define("Personalizzazioni.store.CBPersonFestivita",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"CBPersonFestivita",proxy:{type:"ajax",url:getUrlGen()+"/ws/genOsp/prszn/perste/cbox",reader:{type:"json"}}},b)])}});
Ext.define("Personalizzazioni.store.CBPersonGiorniApertura",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"CBPersonGiorniApertura",proxy:{type:"ajax",url:getUrlGen()+"/ws/genOsp/prszn/perste/cbox",reader:{type:"json"}}},b)])}});
Ext.define("Personalizzazioni.store.CBPersonPresenze",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"CBPersonPresenze",proxy:{type:"ajax",url:getUrlGen()+"/ws/genOsp/prszn/perste/cbox",reader:{type:"json"}}},b)])}});
Ext.define("Personalizzazioni.store.COPERBOLLO",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modCOPERBOLLO"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modCOPERBOLLO",storeId:"COPERBOLLO"},b)])}});
Ext.define("Personalizzazioni.store.COPERCALCOLORETTE",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modCOPERCALCOLORETTE"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modCOPERCALCOLORETTE",storeId:"COPERCALCOLORETTE"},b)])}});
Ext.define("Personalizzazioni.store.COPERCONTABILI",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modCOPERCONTABILI"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modCOPERCONTABILI",storeId:"COPERCONTABILI"},b)])}});
Ext.define("GeneraliOSP.personalizzazioni.app.store.COPERFESTIVITA",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idPersonTestata"},{name:"dataGgFestivo",type:"date"},{name:"ricorsiva"},{name:"dataGgFestivoAl",type:"date"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/prszn/fest/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.app.store.COPERGIORNIAPERTURA",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idPersonTestata"},{name:"data",type:"date"},{name:"lunedi"},{name:"martedi"},{name:"mercoledi"},{name:"giovedi"},{name:"venerdi"},{name:"sabato"},{name:"domenica"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/prszn/ggopen/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.app.store.COPERPRESENZE",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idPersonTestata"},{name:"data",type:"date"},{name:"ggModificaFascicolo"},{name:"giornoIngressoReg"},{name:"giornoDimissioneReg"},{name:"giornoRientroReg"},{name:"giornoUscitaReg"},{name:"giornoIngressoRette"},{name:"giornoDimissioneRette"},{name:"giornoRientroRette"},{name:"giornoUscitaRette"},{name:"giornoIngressoStat"},{name:"giornoDimissioneStat"},{name:"giornoRientroStat"},{name:"giornoUscitaStat"},
{name:"oraGiornoIngresso"},{name:"oraGiornoDimissioni"},{name:"oraGiornoRientro"},{name:"oraGiornoUscita"},{name:"giornoDecessoRette"},{name:"oraGiornoDecessi"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/prszn/prsnz/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.app.store.COPERSONALIZZAZIONITE",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"tipo"},{name:"descrizione"},{name:"idOrganizzazione"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/prszn/perste/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoLoad:!1,autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.app.store.CORISPOSTE_DE",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"risposta"},{name:"dataDal",type:"date"},{name:"quotaSanitaria"},{name:"quotaSociale"},{name:"quotaSanGgForced"},{name:"quotaSocGgForced"},{name:"idFranchigia"},{name:"idParametriContabilita"},{name:"conto"},{name:"desConto"},{name:"capitolo"},{name:"desCapitolo"},{name:"articolo"},{name:"desArticolo"},{name:"desAnnoCda"},{name:"annoCda"},{name:"cda1"},{name:"cda"},{name:"idRegistro"},
{name:"registro"},{name:"desRegistro"},{name:"tipoContabilita"},{name:"tipoDocumento"},{name:"idAliquotaIva"},{name:"desAliquotaIva"},{name:"codUniMis"},{name:"qta"},{name:"desUniMis"},{name:"annoConto"}],proxy:{type:"ajax",api:{read:getUrlGen()+"/ws/genOsp/prszn/rispext/src",create:getUrlGen()+"/ws/genOsp/prszn/rispext/new",update:getUrlGen()+"/ws/genOsp/prszn/rispext/update",destroy:getUrlGen()+"/ws/genOsp/prszn/rispext/delete"},url:getUrlGen()+"/ws/genOsp/prszn/rispext/src",reader:{type:"json",
idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.app.store.DETTMOTIVIUSCITA",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"risposta"},{name:"dataDal",type:"date"},{name:"idParametriContabilita"},{name:"parametriContabilita"},{name:"idFranchigia"},{name:"franchigia"}],proxy:{type:"ajax",api:{read:getUrlGen()+"/ws/genOsp/prszn/rsdetass/src",create:getUrlGen()+"/ws/genOsp/prszn/rsdetass/new",update:getUrlGen()+"/ws/genOsp/prszn/rsdetass/update",destroy:getUrlGen()+"/ws/genOsp/prszn/rsdetass/delete"},
url:getUrlGen()+"/ws/genOsp/prszn/rsdetass/src",reader:{type:"json",idProperty:"risposta",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("Personalizzazioni.store.ModFattura",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"ModFattura",proxy:{type:"ajax",url:"/cba/osp/co/ws/rette/modfatt/list",reader:{type:"json"}}},b)])}});
Ext.define("GeneraliOSP.personalizzazioni.app.store.OSPE_SRT",{extend:"Generali.data.StoreJson",fields:[{name:"codiceEnte"},{name:"scheda"},{name:"domanda"},{name:"risposta"},{name:"idServizio"},{name:"descrizione"},{name:"notaInterna"},{name:"tipoSov"},{name:"tipoUscita"},{name:"gruppo"},{name:"associataA"},{name:"tipoStato"},{name:"classInt"},{name:"classReg"},{name:"giorniFranc"},{name:"contoPensioni"},{name:"capitoloPensioni"},{name:"articoloPensioni"},{name:"desArticolo"},{name:"ivaPensioni"},
{name:"raggruppamentoSov"},{name:"esenzioneReddito"},{name:"esenzioneTotale"},{name:"desEstesa"},{name:"desFrequente"},{name:"livEdu"},{name:"percRimbOsp"},{name:"idIcona"},{name:"codSede"},{name:"stato"},{name:"codRaccordo"}],proxy:{urlGen:"/ws/genOsp/risp/src",api:{read:".",create:".",update:".",destroy:"."}},autoLoad:!1,autoDestroy:!0});
Ext.define("Personalizzazioni.store.RaggrScontiSupplementi",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"RaggrScontiSupplementi",proxy:{type:"ajax",url:"/cba/osp/co/ws/general/extras/groups",reader:{type:"json"}}},b)])}});
Ext.define("GeneraliOSP.personalizzazioni.app.store.TEANAPERS",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"codiceEnte"},{name:"descrizione"},{name:"codice"},{name:"barCode"},{name:"tipo"},{name:"codiceFiscale"},{name:"email"},{name:"telefono"},{name:"specializzazione"},{name:"idUtentePwd"},{name:"desSpecializzazione"},{name:"nazione"},{name:"desNazione"},{name:"comune"},{name:"desComune"},{name:"indirizzo"},{name:"idOrganizzazione"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/medici/src",reader:{type:"json",
messageProperty:"message",rootProperty:"data"},api:{read:".",create:".",update:".",destroy:"."}},autoDestroy:!0});Ext.define("Personalizzazioni.store.TipiContAbilitata",{extend:"Ext.data.Store",requires:["Personalizzazioni.model.modComboBox"],constructor:function(b){b=b||{};this.callParent([Ext.apply({model:"Personalizzazioni.model.modComboBox",storeId:"TipiContAbilitata",proxy:{type:"ajax",url:"/cba/gen/ws/general/cntb/type",reader:{type:"json"}}},b)])}});
Ext.define("Personalizzazioni.store.albero",{extend:"Ext.data.TreeStore",requires:["Personalizzazioni.model.modAlbero"],constructor:function(b){b=b||{};this.callParent([Ext.apply({autoLoad:!1,model:"Personalizzazioni.model.modAlbero",storeId:"albero",root:{expanded:!1}},b)])}});
Ext.define("Personalizzazioni.view.COPERBOLLO",{extend:"Ext.panel.Panel",border:0,id:"COPERBOLLO",itemId:"COPERBOLLO",reference:"COPERBOLLO",layout:{type:"border"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",region:"west",width:150,layout:{type:"fit"},title:"BOLLO_ELENCO",items:[{xtype:"gridpanel",border:0,id:"StoricoGridBollo",itemId:"StoricoGridBollo",reference:"StoricoGridBollo",title:"",store:"COPERBOLLO",viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"data",
text:"DATA_DECORRENZA",flex:1,format:"d/m/Y"}],listeners:{itemclick:{fn:this.onGridStoricoItemClick,scope:this}}}]},{xtype:"form",region:"center",border:0,id:"COPERBOLLOForm",itemId:"COPERBOLLOForm",reference:"COPERBOLLOForm",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"datefield",width:210,fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",name:"data",allowBlank:!1,selectOnFocus:!0,listeners:{change:{fn:this.onDatefieldChange,scope:this}}},{xtype:"numberfield",
width:210,fieldLabel:"BOLLO_IMPORTO",labelClsExtra:"cbaLabel",name:"importoBollo",allowBlank:!1},{xtype:"numberfield",width:210,fieldLabel:"BOLLO_IMPORTO_MIN",labelClsExtra:"cbaLabel",name:"importoMinimoBollo",allowBlank:!1},{xtype:"container",margin:"0 0 5 0",layout:{align:"stretch",type:"hbox"},items:[{xtype:"container",itemId:"pnlContoRegistro",reference:"pnlContoRegistro",margin:"0 5 0 0",items:[{xtype:"combobox",width:400,fieldLabel:"CONTO",labelClsExtra:"cbaLabel",name:"conto",displayField:"valore",
queryMode:"local",valueField:"codice"},{xtype:"cda",annoData:"annoCda",labelWidth:100,width:500,margin:"0 0 0 0",hideCodice:!0,showDesCda:!0,hideAnno:!1,itemId:"cntCda",reference:"cntCda",cbaConfig:{tipoContabilita:4}}]},{xtype:"container",height:55,itemId:"pnlCapitoloArticolo",reference:"pnlCapitoloArticolo",items:[{xtype:"combobox",width:400,fieldLabel:"CAPITOLO",labelClsExtra:"cbaLabel",name:"capitolo",displayField:"valore",queryMode:"local",valueField:"codice",listeners:{select:{fn:this.onComboboxSelect1,
scope:this}}},{xtype:"combobox",width:400,fieldLabel:"ARTICOLO",labelClsExtra:"cbaLabel",name:"articolo",displayField:"valore",queryMode:"local",valueField:"codice"}]}]},{xtype:"combobox",width:300,fieldLabel:"BOLLO_ALIQUOTA",labelClsExtra:"cbaLabel",name:"idAliquotaIva",allowBlank:!1,displayField:"valore",queryMode:"local",valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[1] == 'F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore}</div>',
"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"container",margin:"0 0 5 0",layout:{align:"stretch",type:"vbox"},items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"bolloDocContab",boxLabel:"USA_BOLLO_DOC_CONT",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"competenzaMinMaxDettagli",boxLabel:"BOLLO_COMPETENZA_MINMAXDETTAGLI",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",
name:"bolloVirtuale",boxLabel:"BOLLO_VIRTUALE",inputValue:"T",uncheckedValue:"F"}]},{xtype:"htmleditor",height:100,itemId:"descBolloVirtuale",reference:"descBolloVirtuale",width:400,fieldLabel:"DESC_BOLLO_VIRTUALE",labelAlign:"top",labelClsExtra:"cbaLabel",name:"descBolloVirtuale"},{xtype:"textfield",hidden:!0,fieldLabel:"idPersonTestata",name:"idPersonTestata"},{xtype:"textfield",hidden:!0,id:"COPERBOLLORecordId",itemId:"COPERBOLLORecordId",reference:"COPERBOLLORecordId",fieldLabel:"id",name:"id"},
{xtype:"textfield",hidden:!0,fieldLabel:"idParametriContabilita",name:"idParametriContabilita"},{xtype:"numberfield",hidden:!0,name:"idEsercizio"},{xtype:"numberfield",hidden:!0,name:"annoConto"}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}],listeners:{beforerender:{fn:this.onCOPERBOLLOBeforeRender,scope:this}}});this.callParent(arguments)},onGridStoricoItemClick:function(b,c,d,f,g,h){this.impostaDati(c)},onDatefieldChange:function(b,c,d,f){c=this.cbaConfig.idOrganizzazione;
isValidDate(b)&&(this.cbaConfig.personContabili=getPersonContabili(c,b.getValue(),!0,null),Ext.apply(this.queryById("cntCda").cbaConfig,{tipoContabilita:null}),this.abilitaCampi(b.getValue().getFullYear()),Ext.getCmp(this.id+"Form").getForm().isValid())},onComboboxSelect1:function(b,c,d){c=Ext.getCmp("COPERBOLLOForm").getForm();d=c.findField("data");d.isValid()&&c.findField("articolo").getStore().load({params:{anno:d.getValue().getFullYear(),codCapitolo:b.value?b.value:0}})},onCOPERBOLLOBeforeRender:function(b,
c){var d=this,f=Ext.create("Generali.standard.PannelloBottoniVert",{id:d.id+"BoxBottoni",itemId:d.id+"BoxBottoni",cbaConfig:{conferma_callback:function(){d.salva()},esci_callback:function(){d.esci()},annulla_callback:function(){d.aggiornaStore()},nuovo_callback:function(){d.nuovo()},elimina_callback:function(){eliminaRecordQuestion(d.id,"COPERBOLLO",["id"])},verificaCampiForm_callback:function(){return d.verificaCampiForm()},formContainerName:d.id,formStoreName:"COPERBOLLO",arrayCampiChiave:'["id"]'}});
inserisciBottoni(this.getComponent("boxBottoni"),f);Ext.getCmp("_btnEsci"+d.id+"BoxBottoni").hide();Localizer.localize(Ext.getCmp(this.id));f=Ext.getCmp("COPERBOLLOForm").getForm();f.findField("conto").bindStore(Ext.create("Generali.store.Conto"));f.findField("capitolo").bindStore(Ext.create("Generali.store.Capitolo"));f.findField("articolo").bindStore(Ext.create("Generali.store.Articolo"));var g=Ext.create("Generali.store.AliquotaIva");f.findField("idAliquotaIva").bindStore(g);g.load();d.queryById("pnlContoRegistro").hide();
d.queryById("pnlCapitoloArticolo").hide();if("L"!=d.cbaConfig.permesso)Ext.getCmp(this.id+"Form").getForm().on("dirtychange",function(b,c){abilitaBottoni(d.id+"BoxBottoni",d.id+"Form",d.id);Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(c);d.getStoricoGrid().setDisabled(c);d.testata.getNuovo().setDisabled(c);d.testata.getElimina().setDisabled(c);d.testata.getGridTestata().setDisabled(c)});"L"==d.cbaConfig.permesso&&(containerSolaLettura(d.id+"Form"),bottoniSolaLettura(d.id+
"BoxBottoni"))},impostaDati:function(b){var c=Ext.getCmp("COPERBOLLO"),d=Ext.getCmp("COPERBOLLOForm").getForm();c.getStoricoGrid().setDisabled(!1);c.cbaConfig.changeDataDal=!1;clearForm(c.id+"Form");d.setValues({descrizioneCodice:traduci("NESSUNA_SELEZIONE")});if(b){Ext.getCmp(c.id+"Form").loadRecord(b);var f=b.data.data.getFullYear();d.setValues({tipoContabilita:c.cbaConfig.personContabili.tipoContabilitaAbilitata});d.setValues({descrizioneCodice:b.get("cda")?b.get("cda"):traduci("NESSUNA_SELEZIONE")});
if(1==c.cbaConfig.personContabili.tipoContabilitaAbilitata)d.findField("capitolo").getStore().load({params:{anno:f},callback:function(){d.setValues({capitolo:b.data.capitolo})}}),d.findField("articolo").getStore().load({params:{anno:f,codCapitolo:b.data.capitolo?b.data.capitolo:0},callback:function(){d.setValues({articolo:b.data.articolo})}});else{var g={};4==c.cbaConfig.personContabili.tipoContabilitaAbilitata||5==c.cbaConfig.personContabili.tipoContabilitaAbilitata?(d.findField("conto").getStore().getProxy().url=
"/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(g,{idOrganizzazione:null!=c.cbaConfig.idOrganizzazione?c.cbaConfig.idOrganizzazione:getIdOrg(),idEsercizio:b.data.annoConto?b.data.annoConto:c.cbaConfig.personContabili.idEsercizio})):(d.findField("conto").getStore().getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(g,{idOrganizzazione:null!=c.cbaConfig.idOrganizzazione?c.cbaConfig.idOrganizzazione:getIdOrg(),anno:b.data.annoConto?b.data.annoConto:f}));d.findField("conto").getStore().load({params:g,
callback:function(){d.setValues({conto:b.data.conto})}})}}c.cbaConfig.changeDataDal=!0},esci:function(){var b=this.aggiornaStore();puoiUscire("win_"+this.id,this.id+"Form",!1,b,b)},nuovo:function(){nuovoRecord(Ext.getCmp("COPERBOLLO"));var b=Ext.getCmp(this.id+"Form").getForm(),c=Ext.Date.clearTime(new Date);b.setValues({data:c,descrizioneCodice:traduci("NESSUNA_SELEZIONE")});b.findField("data").focus(!0,20)},verificaCampiForm:function(){var b=[],c=Ext.getCmp(this.id+"Form").getForm(),d=c.getFieldValues();
c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");var f=Ext.getCmp("COPERBOLLO").cbaConfig;1==f.personContabili.tipoContabilitaAbilitata?!d.capitolo&&0<c.findField("capitolo").getStore().getCount()&&msgAddError(b,"MSG_CAPITOLO_OBBLIGATORIO"):(2==f.personContabili.tipoContabilitaAbilitata||4==f.personContabili.tipoContabilitaAbilitata||5==f.personContabili.tipoContabilitaAbilitata)&&!d.conto&&0<c.findField("conto").getStore().getCount()&&msgAddError(b,"MSG_CONTO_OBBLIGATORIO");return msgShow("",
b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=Ext.getCmp("COPERBOLLOForm").getForm().getFieldValues();c.idPersonTestata=Ext.getStore("COPERBOLLO").getProxy().extraParams.idTestata;c.bolloVirtuale=getBoolValue(c.bolloVirtuale);c.bolloDocContab=getBoolValue(c.bolloDocContab);c.competenzaMinMaxDettagli=getBoolValue(c.competenzaMinMaxDettagli);delete c.tipoContabilita;delete c.idEsercizio;delete c.descrizioneCodice;delete c.desAnnoCda;var d=Ext.getCmp("COPERBOLLO").cbaConfig;salvaRecord(this,
c,Ext.getStore("COPERBOLLO"),b,!1,{tipoContabilita:d.personContabili.tipoContabilitaAbilitata})},getStoricoGrid:function(){return Ext.getCmp("StoricoGridBollo")},aggiornaStore:function(b){generaliRicaricaStore("StoricoGridBollo","COPERBOLLO",{idTestata:Ext.getStore("COPERBOLLO").getProxy().extraParams.idTestata},"StoricoGridBollo","id",this.impostaDati,b)},abilitaCampi:function(b){var c=Ext.getCmp("COPERBOLLOForm").getForm();c.setValues({tipoContabilita:this.cbaConfig.personContabili.tipoContabilitaAbilitata,
idEsercizio:this.cbaConfig.personContabili.idEsercizio});var d=c.findField("conto"),f=c.findField("capitolo"),g=c.findField("articolo"),h=c.findField("cda");d.setDisabled(!this.cbaConfig.personContabili.vediConto);f.setDisabled(!this.cbaConfig.personContabili.vediCapitolo);g.setDisabled(!this.cbaConfig.personContabili.vediArticolo);h.setReadOnly(!this.cbaConfig.personContabili.vediCda);this.cbaConfig.changeDataDal&&(svuotaStore(d.getStore()),svuotaStore(f.getStore()),svuotaStore(g.getStore()),c.setValues({conto:"",
annoConto:this.cbaConfig.personContabili.idEsercizio,capitolo:"",articolo:"",annoCda:this.cbaConfig.personContabili.idEsercizio}),1==this.cbaConfig.personContabili.tipoContabilitaAbilitata?f.getStore().load({params:{anno:b},callback:function(){c.findField("capitolo").allowBlank=!1;c.findField("capitolo").validate()}}):(f={},4==this.cbaConfig.personContabili.tipoContabilitaAbilitata||5==this.cbaConfig.personContabili.tipoContabilitaAbilitata?(d.getStore().getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",
Ext.apply(f,{idOrganizzazione:this.cbaConfig.idOrganizzazione,idEsercizio:this.cbaConfig.personContabili.idEsercizio})):(d.getStore().getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(f,{anno:b})),d.getStore().load({params:f,callback:function(){c.findField("conto").allowBlank=!1;c.findField("conto").validate()}})));Ext.getCmp("COPERBOLLOForm").queryById("pnlContoRegistro").setVisible(1!=this.cbaConfig.personContabili.tipoContabilitaAbilitata);Ext.getCmp("COPERBOLLOForm").queryById("pnlCapitoloArticolo").setVisible(1==
this.cbaConfig.personContabili.tipoContabilitaAbilitata)}});
Ext.define("Personalizzazioni.view.COPERCALCOLORETTE",{extend:"Ext.panel.Panel",border:0,id:"COPERCALCOLORETTE",itemId:"COPERCALCOLORETTE",reference:"COPERCALCOLORETTE",layout:{type:"border"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",region:"west",width:150,layout:{type:"fit"},title:"RETTE_ELENCO",items:[{xtype:"gridpanel",border:0,id:"StoricoGridRette",itemId:"StoricoGridRette",reference:"StoricoGridRette",title:"",store:"COPERCALCOLORETTE",viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",
dataIndex:"data",text:"DATA_DECORRENZA",flex:1,format:"d/m/Y"}],listeners:{itemclick:{fn:this.onGridStoricoItemClick,scope:this}}}]},{xtype:"form",region:"center",border:0,id:"COPERCALCOLORETTEForm",itemId:"COPERCALCOLORETTEForm",reference:"COPERCALCOLORETTEForm",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"datefield",fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",name:"data",fieldCls:"cbaInputData",allowBlank:!1},{xtype:"container",width:420,layout:{align:"stretch",
type:"hbox"},items:[{xtype:"fieldset",flex:1,width:350,layout:{align:"stretch",type:"hbox"},title:"RETTE_CALCOLO",items:[{xtype:"container",flex:1,layout:{align:"stretch",type:"vbox"},items:[{xtype:"radiofield",flex:5,cls:"cbaLabel",name:"calcoloRetta",boxLabel:"RETTE_anticipate",inputValue:"A",listeners:{change:{fn:this.onCalcoloRettaChange,scope:this}}},{xtype:"radiofield",flex:1,cls:"cbaLabel",name:"calcoloRetta",boxLabel:"RETTE_posticipate",inputValue:"P"}]},{xtype:"container",flex:1,items:[{xtype:"checkboxfield",
disabled:!0,itemId:"conguaglioAutomatico",reference:"conguaglioAutomatico",name:"conguaglioAutomatico",boxLabel:"RETTE_CONGUAGLIO_AUTO",inputValue:"T",uncheckedValue:"F"}]}]}]},{xtype:"fieldset",width:420,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},title:"RETTE_EMISSIONE",items:[{xtype:"container",flex:1,items:[{xtype:"radiofield",cls:"cbaLabel",name:"mensilita",boxLabel:"RETTE_mensile",inputValue:"M"},{xtype:"radiofield",cls:"cbaLabel",name:"mensilita",boxLabel:"RETTE_bimestrale",
inputValue:"B"}]},{xtype:"container",flex:1,margin:"0 0 5 0",items:[{xtype:"radiofield",cls:"cbaLabel",name:"mensilita",boxLabel:"RETTE_trimestrale",inputValue:"T"},{xtype:"radiofield",cls:"cbaLabel",name:"mensilita",boxLabel:"RETTE_quadrimestrale",inputValue:"Q"}]},{xtype:"container",flex:1,items:[{xtype:"radiofield",cls:"cbaLabel",name:"mensilita",boxLabel:"RETTE_semestrale",inputValue:"S"},{xtype:"radiofield",cls:"cbaLabel",name:"mensilita",boxLabel:"RETTE_annuale",inputValue:"A"}]}]},{xtype:"checkboxfield",
cls:"cbaLabel",fieldLabel:"",name:"bolloAutomatico",boxLabel:"BOLLO_AUTOMATICO",inputValue:"T"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"ivaConScorporo",boxLabel:"RETTE_IVA_SCORPORO",inputValue:"T"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"protezioneRetta",boxLabel:"PROTEZIONE_RETTA",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"prestazioniAmbulatoriali",boxLabel:"RETTE_PRESTAZIONI_AMBULATORIALI",inputValue:"T",uncheckedValue:"F",
disabled:!0},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"prestazioniAmbulatorialiEsaurite",boxLabel:"RETTE_PRESTAZIONI_AMBULATORIALI_ESAURITE",inputValue:"T",uncheckedValue:"F",disabled:!0},{xtype:"combobox",fieldLabel:"RETTE_SEPARAZIONE",labelClsExtra:"cbaLabel",name:"separazioneRetta",fieldCls:"cbaInput200",displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!1},{xtype:"combobox",fieldLabel:"RETTE_MODELLO_FATT",labelClsExtra:"cbaLabel",name:"idModelloFattura",fieldCls:"cbaInput200",
displayField:"valore",queryMode:"local",store:"ModFattura",valueField:"codice",allowBlank:!1},{xtype:"textfield",fieldLabel:"idPersonTestata",name:"idPersonTestata"},{xtype:"textfield",id:"COPERCALCOLORETTERecordId",itemId:"COPERCALCOLORETTERecordId",reference:"COPERCALCOLORETTERecordId",fieldLabel:"id",name:"id"}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}],listeners:{beforerender:{fn:this.onCOPERCALCOLORETTEBeforeRender,scope:this}}});this.callParent(arguments)},
onGridStoricoItemClick:function(b,c,d,f,g,h){this.impostaDati(c)},onCalcoloRettaChange:function(b,c,d,f){c?b.up("form").down("#conguaglioAutomatico").enable():b.up("form").down("#conguaglioAutomatico").disable()},onCOPERCALCOLORETTEBeforeRender:function(b,c){var d=this,f=Ext.create("Generali.standard.PannelloBottoniVert",{id:d.id+"BoxBottoni",itemId:d.id+"BoxBottoni",cbaConfig:{conferma_callback:function(){d.salva()},esci_callback:function(){d.esci()},annulla_callback:function(){d.aggiornaStore()},
nuovo_callback:function(){d.nuovo()},elimina_callback:function(){eliminaRecordQuestion(d.id,"COPERCALCOLORETTE",["id"])},verificaCampiForm_callback:function(){return d.verificaCampiForm()},formContainerName:d.id,formStoreName:"COPERCALCOLORETTE",arrayCampiChiave:'["id"]'}});inserisciBottoni(d.getComponent("boxBottoni"),f);Ext.getCmp("_btnEsci"+d.id+"BoxBottoni").hide();Localizer.localize(Ext.getCmp(d.id));Ext.getStore("ModFattura").load({params:{idOrg:b.cbaConfig.idOrganizzazione}});Ext.getCmp(d.id+
"RecordId").hide();f=Ext.getCmp("COPERCALCOLORETTEForm").getForm();f.findField("idPersonTestata").hide();f.findField("separazioneRetta").bindStore(new Ext.data.ArrayStore({fields:["codice","valore"],data:[["F",traduci("RETTE_SEPARAZIONE_NESSUNA")],["S",traduci("RETTE_SEPARAZIONE_SERVIZIO")],["T",traduci("RETTE_SEPARAZIONE_UTENTE")]],autoLoad:!0,autoDestroy:!0}));if("L"!=d.cbaConfig.permesso)f.on("dirtychange",function(b,c){abilitaBottoni(d.id+"BoxBottoni",d.id+"Form",d.id);Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(c);
d.getStoricoGrid().setDisabled(c);d.testata.getNuovo().setDisabled(c);d.testata.getElimina().setDisabled(c);d.testata.getGridTestata().setDisabled(c)});"L"==d.cbaConfig.permesso&&(containerSolaLettura(d.id+"Form"),bottoniSolaLettura(d.id+"BoxBottoni"))},impostaDati:function(b){var c=Ext.getCmp("COPERCALCOLORETTE");c.getStoricoGrid().setDisabled(!1);clearForm(c.id+"Form");b&&Ext.getCmp(c.id+"Form").loadRecord(b)},esci:function(){var b=this.aggiornaStore();puoiUscire("win_"+this.id,this.id+"Form",!1,
b,b)},nuovo:function(){nuovoRecord(Ext.getCmp("COPERCALCOLORETTE"));Ext.getCmp("COPERCALCOLORETTEForm").getForm().setValues([{id:"calcoloRetta",value:"P"},{id:"mensilita",value:"M"}])},verificaCampiForm:function(){var b=[];Ext.getCmp(this.id+"Form").getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=Ext.getCmp("COPERCALCOLORETTEForm").getForm(),d=c.getFieldValues();d.idPersonTestata=Ext.getStore("COPERCALCOLORETTE").getProxy().extraParams.idTestata;
d.bolloAutomatico=getBoolValue(d.bolloAutomatico);d.ivaConScorporo=getBoolValue(d.ivaConScorporo);d.protezioneRetta=getBoolValue(d.protezioneRetta);d.prestazioniAmbulatoriali=getBoolValue(c.findField("prestazioniAmbulatoriali").getValue());d.prestazioniAmbulatorialiEsaurite=getBoolValue(c.findField("prestazioniAmbulatorialiEsaurite").getValue());d.conguaglioAutomatico="A"==d.calcoloRetta?getBoolValue(d.conguaglioAutomatico):"F";salvaRecord(this,d,Ext.getStore("COPERCALCOLORETTE"),b)},getStoricoGrid:function(){return Ext.getCmp("StoricoGridRette")},
aggiornaStore:function(b){generaliRicaricaStore("StoricoGridRette","COPERCALCOLORETTE",{idTestata:Ext.getStore("COPERCALCOLORETTE").getProxy().extraParams.idTestata},"StoricoGridRette","id",this.impostaDati,b)}});
Ext.define("Personalizzazioni.view.COPERCONTABILI",{extend:"Ext.panel.Panel",border:0,id:"COPERCONTABILI",itemId:"COPERCONTABILI",reference:"COPERCONTABILI",layout:{type:"border"},initComponent:function(){this.lblBloccaCancNoCont2=traduci("BLOCCA_CANC_NOCONT2");this.lblBloccaCancEco2=traduci("BLOCCA_CANC_ECO2");Ext.applyIf(this,{items:[{xtype:"panel",region:"west",width:150,layout:{type:"fit"},title:"CONTABILI_ELENCO",items:[{xtype:"gridpanel",border:0,id:"StoricoGridContabili",itemId:"StoricoGridContabili",
reference:"StoricoGridContabili",title:"",store:"COPERCONTABILI",viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"data",text:"DATA_DECORRENZA",flex:1,format:"d/m/Y"}],listeners:{itemclick:{fn:this.onGridStoricoItemClick,scope:this}}}]},{xtype:"form",region:"center",border:0,id:"COPERCONTABILIForm",itemId:"COPERCONTABILIForm",reference:"COPERCONTABILIForm",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"datefield",itemId:"data",reference:"data",
width:210,fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",name:"data",allowBlank:!1,listeners:{change:{fn:this.onDataChange,scope:this}}},{xtype:"combobox",width:300,fieldLabel:"CONTABILITA_ABILITATA",labelClsExtra:"cbaLabel",name:"tipoContabilitaAbilitata",allowBlank:!1,displayField:"valore",queryMode:"local",store:"TipiContAbilitata",valueField:"codice",listeners:{change:{fn:this.onContabilitaChange,scope:this}}},{xtype:"combobox",width:300,fieldLabel:"TIPO_DOCUMENTO",labelClsExtra:"cbaLabel",
name:"tipoDocumento",allowBlank:!1,displayField:"valore",queryMode:"local",valueField:"codice",listeners:{change:{fn:this.onTipoDocumentoChange,scope:this}}},{xtype:"combobox",width:400,fieldLabel:"CONDIZIONE_PAGAMENTO",labelClsExtra:"cbaLabel",name:"condizionePagamento",allowBlank:!1,displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"combobox",itemId:"attivita",reference:"attivita",width:400,fieldLabel:"ATTIVITA_PRIMANOTA",labelClsExtra:"cbaLabel",name:"attivita",allowBlank:!1,
displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"combobox",itemId:"causaliFattura",reference:"causaliFattura",width:400,fieldLabel:"CAUSALE_FATTURA",labelClsExtra:"cbaLabel",name:"causaleFattura",allowBlank:!1,displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"combobox",id:"causaliNotaAcc",itemId:"causaliNotaAcc",reference:"causaliNotaAcc",width:400,fieldLabel:"CAUSALE_NOTA_ACCREDITO",labelClsExtra:"cbaLabel",name:"causaleNotaAccredito",allowBlank:!1,displayField:"valore",
queryMode:"local",valueField:"codice"},this.processEnteIvaFinanziaria({xtype:"combobox",width:400,fieldLabel:"ENTE_IVA",labelClsExtra:"cbaLabel",name:"enteIvaFinanziaria",matchFieldWidth:!1,displayField:"valore",queryMode:"local",store:"CBEnteIva",valueField:"codice"}),{xtype:"combobox",itemId:"registro",reference:"registro",width:160,fieldLabel:"REGISTRO",labelClsExtra:"cbaLabel",name:"registro",allowBlank:!1,editable:!1,displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"textfield",
hidden:!0,fieldLabel:"idRegistro",name:"idRegistro"},{xtype:"fieldset",id:"pnlControPartita",title:"TIPO_CONTROPARTITA",items:[{xtype:"radiogroup",layout:{align:"stretch",type:"hbox"},columns:2,items:[{xtype:"radiofield",cls:"cbaLabel",margin:"0 10 0 0",name:"tipoContropartitaCorrispettivi",boxLabel:"PIANO_CONTI",inputValue:"P"},{xtype:"radiofield",cls:"cbaLabel",name:"tipoContropartitaCorrispettivi",boxLabel:"CLIENTI",inputValue:"C"}],listeners:{change:{fn:this.onControPartitaChange,scope:this}}},
{xtype:"combobox",width:400,fieldLabel:"CONTROPARTITA",labelClsExtra:"cbaLabel",name:"contoContropartitaCorrispettivi",displayField:"valore",queryMode:"local",valueField:"codice"}]},{xtype:"fieldset",id:"pnlPensioni",title:"PENSIONI",hidden:50==getModuloAttivo(),items:[{xtype:"checkboxfield",cls:"cbaLabel",name:"pensNonRaggrMovimRetta",boxLabel:"PENSNONRAGGRMOVIMRETTA",inputValue:"T"},{xtype:"container",layout:{type:"hbox"},margin:"0 0 10 0",items:[{xtype:"checkboxfield",width:150,cls:"cbaLabel",
name:"pensAzzeraResidui",boxLabel:"PENSAZZERARESIDUI",inputValue:"T"},{xtype:"combobox",labelClsExtra:"cbaLabel",name:"pensUsoPensione",fieldLabel:"PENS_USA_PENSIONE",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("GeneraliOSP.personalizzazioni.store.TipoUsoPensione"),allowBlank:50==getModuloAttivo()}]},{xtype:"fieldset",id:"pnlPensIncasso",title:"INCASSO",hidden:!0,items:[{xtype:"combobox",id:"pensIncassoTipoPassaggio",itemId:"pensIncassoTipoPassaggio",reference:"pensIncassoTipoPassaggio",
width:400,labelClsExtra:"cbaLabel",name:"pensIncassoTipoPassaggio",displayField:"valore",queryMode:"local",valueField:"codice",listeners:{change:{fn:this.onCbPensIncassoChange,scope:this}}},{xtype:"combobox",id:"pensIncassoCausale",itemId:"pensIncassoCausale",reference:"pensIncassoCausale",width:400,fieldLabel:"CAUSALE",labelClsExtra:"cbaLabel",name:"pensIncassoCausale",displayField:"valore",queryMode:"local",valueField:"codice",hidden:!0},{xtype:"checkboxfield",cls:"cbaLabel",boxLabel:"PENS_INCASSONOCASSA",
inputValue:"T",id:"pensIncassoNoCassa",itemId:"pensIncassoNoCassa",reference:"pensIncassoNoCassa",name:"pensIncassoNoCassa",margin:"0 20 0 0"},{xtype:"container",id:"IncassoDareAvere",itemId:"IncassoDareAvere",reference:"IncassoDareAvere",hidden:!0,layout:{type:"hbox"},items:[{xtype:"combobox",id:"pensIncassoContoDare",itemId:"pensIncassoContoDare",reference:"pensIncassoContoDare",fieldLabel:"DARE",labelClsExtra:"cbaLabel",name:"pensIncassoContoDare",displayField:"valore",queryMode:"local",valueField:"codice",
labelAlign:"top",margin:"0 20 0 0"},{xtype:"fieldset",title:"AVERE",width:230,items:[{xtype:"radiogroup",layout:{align:"stretch",type:"hbox"},columns:2,items:[{xtype:"radiofield",cls:"cbaLabel",margin:"0 10 0 0",name:"pensIncassoTipoContoAvere",boxLabel:"CLIENTI",inputValue:1},{xtype:"radiofield",cls:"cbaLabel",name:"pensIncassoTipoContoAvere",boxLabel:"PIANO_CONTI",inputValue:2,listeners:{change:{fn:this.onRgAverechange,scope:this}}}]},{xtype:"combobox",id:"pensIncassoContoAvere",itemId:"pensIncassoContoAvere",
reference:"pensIncassoContoAvere",width:210,labelClsExtra:"cbaLabel",name:"pensIncassoContoAvere",displayField:"valore",queryMode:"local",valueField:"codice",hidden:!0}]}]},{xtype:"combobox",id:"pensIncassoContoScad",itemId:"pensIncassoContoScad",reference:"pensIncassoContoScad",width:400,fieldLabel:"CONTO",labelClsExtra:"cbaLabel",name:"pensIncassoContoScad",displayField:"valore",queryMode:"local",valueField:"codice",hidden:!0}]},{xtype:"fieldset",id:"pnlPensPassaggio",title:"PENSIONIPASSAGGIO",
hidden:!0,items:[{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"pensScadenzeAlNetto",boxLabel:"PENSSCADENZEALNETTO",inputValue:"T"},{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"pensCreaDocumentoContabile",boxLabel:"PENSCREADOCUMENTOCONTABILE",inputValue:"T",listeners:{change:{fn:this.onCBPassaPensionichange,scope:this}}},{xtype:"combobox",id:"pensPassaggioCausale",itemId:"pensPassaggioCausale",reference:"pensPassaggioCausale",width:400,fieldLabel:"CAUSALE",labelClsExtra:"cbaLabel",name:"pensPassaggioCausale",
displayField:"valore",queryMode:"local",valueField:"codice",hidden:!0},{xtype:"combobox",id:"pensPassaggioConto",itemId:"pensPassaggioConto",reference:"pensPassaggioConto",width:400,fieldLabel:"CONTO",labelClsExtra:"cbaLabel",name:"pensPassaggioConto",displayField:"valore",queryMode:"local",valueField:"codice",hidden:!0}]},{xtype:"fieldset",id:"pnlPensPassaggioFinanziaria",title:"PENSIONIPASSAGGIO",hidden:!0,items:[{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"pensPassaTotale",boxLabel:"PENSPASSATOTALE",
inputValue:"T"},{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"pensPassaggioQuote",boxLabel:"PENSPASSAGGIOQUOTE",inputValue:"T",listeners:{change:{fn:this.onCheckPassaQuoteChange,scope:this}}},{xtype:"fieldset",id:"pnlPensPassaggioEntrate",title:"PENSPASSAGGIOENTRATE",hidden:!0,items:[{xtype:"combobox",id:"pensIncassoEntrateCapitolo",itemId:"pensIncassoEntrateCapitolo",reference:"pensIncassoEntrateCapitolo",width:400,fieldLabel:"CAPITOLO",labelClsExtra:"cbaLabel",name:"pensIncassoEntrateCapitolo",
displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!0,listeners:{change:{fn:this.onCBpensIncassoEntrateCapitolo,scope:this}}},{xtype:"combobox",id:"pensIncassoEntrateArticolo",itemId:"pensIncassoEntrateArticolo",reference:"pensIncassoEntrateArticolo",width:400,fieldLabel:"ARTICOLO",labelClsExtra:"cbaLabel",name:"pensIncassoEntrateArticolo",displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!0}]},{xtype:"fieldset",id:"pnlPensPassaggioSpese",title:"PENSPASSAGGIOSPESE",
hidden:!0,items:[{xtype:"combobox",id:"pensIncassoSpeseCapitolo",itemId:"pensIncassoSpeseCapitolo",reference:"pensIncassoSpeseCapitolo",width:400,fieldLabel:"CAPITOLO",labelClsExtra:"cbaLabel",name:"pensIncassoSpeseCapitolo",displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!0,listeners:{change:{fn:this.onCBpensIncassoSpeseCapitolo,scope:this}}},{xtype:"combobox",id:"pensIncassoSpeseArticolo",itemId:"pensIncassoSpeseArticolo",reference:"pensIncassoSpeseArticolo",width:400,fieldLabel:"ARTICOLO",
labelClsExtra:"cbaLabel",name:"pensIncassoSpeseArticolo",displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!0}]}]}]},{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"ftLibDesBreve",boxLabel:"FT_LIB_DES_BREVE",inputValue:"T"},{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"elaboraRetteZero",boxLabel:"ELABORA_RETTE_ZERO",inputValue:"T"},{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"pensDivisioneAccertamenti",boxLabel:"PENSDIVISIONEACCERTAMENTI",inputValue:"T"},{xtype:"checkboxfield",
flex:0,cls:"cbaLabel",name:"rigeneraAddebitiAccrediti",boxLabel:"RIGENERAADDEBITIACCREDITI",inputValue:"T"},{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"accreditoUsaEccedenza",boxLabel:"ACCREDITOUSAECCEDENZA",inputValue:"T"},{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"bloccaCanc_Eco2",boxLabel:this.lblBloccaCancEco2,inputValue:"T",hidden:!0},{xtype:"checkboxfield",flex:0,cls:"cbaLabel",name:"escludiDaTS730",boxLabel:"ESCLUDI_DA_TS730",inputValue:"T",hidden:!0},{xtype:"textfield",hidden:!0,
id:"COPERCONTABILIRecordId",itemId:"COPERCONTABILIRecordId",reference:"COPERCONTABILIRecordId",fieldLabel:"id",name:"id"},{xtype:"textfield",hidden:!0,fieldLabel:"idPersonTestata",name:"idPersonTestata"}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}],listeners:{beforerender:{fn:this.onCOPERCONTABILIBeforeRender,scope:this},destroy:{fn:this.onCOPERCONTABILIDestroy,scope:this}}});this.callParent(arguments)},processEnteIvaFinanziaria:function(b){b.displayTpl=
Ext.create("Ext.XTemplate",'<tpl for=".">',"{extra} | {valore}","</tpl>");b.tpl=Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item">{extra} | {valore}</div>',"</tpl>");return b},onGridStoricoItemClick:function(b,c,d,f,g,h){this.impostaDati(c)},onControPartitaChange:function(b,c,d,f){b=Ext.getCmp("pnlControPartita");c=Ext.getCmp("COPERCONTABILIForm").getForm().findField("tipoContropartitaCorrispettivi").getValue();b.down("combobox").allowBlank=!(b.isVisible()&&c);b.down("combobox").validate()},
onDataChange:function(b,c,d,f){isValidDate(b)&&(this.idEsercizio=getIdEsercizioByDate(null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg(),c))},onContabilitaChange:function(b,c,d,f){if(c){this.refreshTipoDocumento(c);this.loadConto(c);if(1==c)this.loadCapitolo();else if(4==c||5==c)Ext.getCmp("COPERCONTABILIForm").getForm(),this.storeAttivita.load({params:{idOrganizzazione:this.cbaConfig.idOrganizzazione,applicaFiltro:"F"}});this.abilitaCampi()}},refreshTipoDocumento:function(b,
c){var d=Ext.getCmp(this.id+"Form").getForm();d.setValues({tipoDocumento:""});d.findField("tipoDocumento").getStore().reload({params:{soloTipiGenerici:!0,tipoContabilita:b}})},onTipoDocumentoChange:function(b,c,d,f){var g=this,h=Ext.getCmp("COPERCONTABILIForm").getForm();b=h.findField("tipoContabilitaAbilitata").getValue();c!=d&&null!=d&&(1!=b&&5!=c&&(h.findField("registro").clearValue(),h.findField("registro").reset()),h.findField("causaleFattura").clearValue(),h.findField("causaleNotaAccredito").clearValue());
c&&(b&&(g.storeCausaleContabilita.load({params:{tipoContabilita:b,tipoDocOspiti:c,idOrganizzazione:g.cbaConfig.idOrganizzazione},callback:function(){g.filtraStoreCausali();h.setValues({causaleFattura:g.dati?g.dati.causaleFattura:null,causaleNotaAccredito:g.dati?g.dati.causaleNotaAccredito:null});h.findField("causaleFattura").getStore().data.items&&1==h.findField("causaleFattura").getStore().data.items.length&&h.findField("causaleFattura").setValue(h.findField("causaleFattura").getStore().data.items[0].get("codice"));
h.findField("causaleNotaAccredito").getStore().data.items&&1==h.findField("causaleNotaAccredito").getStore().data.items.length&&h.findField("causaleNotaAccredito").setValue(h.findField("causaleNotaAccredito").getStore().data.items[0].get("codice"));h.findField("causaleFattura").validate();h.findField("causaleNotaAccredito").validate()}}),g.storeCausaleContabilitaDocCont.load({params:{tipoContabilita:b,tipoDocOspiti:5,idOrganizzazione:g.cbaConfig.idOrganizzazione},callback:function(){g.filtraStoreCausali();
h.setValues({pensIncassoCausale:g.dati?g.dati.pensIncassoCausale:null,pensPassaggioCausale:g.dati?g.dati.pensPassaggioCausale:null})}}),3==b&&g.dati&&g.dati.registro?(h.setValues({registro:g.dati.registro}),h.findField("registro").setRawValue(g.dati.registro)):5==c||1==b||h.findField("registro").editable||this.loadRegistro(b)),this.abilitaCampi())},onCbPensIncassoChange:function(b,c,d,f){d=Ext.getCmp("pensIncassoCausale");f=Ext.getCmp("IncassoDareAvere");var g=Ext.getCmp("pensIncassoContoScad"),h=
Ext.getCmp("pensIncassoContoDare"),k=Ext.getCmp("COPERCONTABILIForm").getForm();b=k.findField("tipoContabilitaAbilitata").getValue();d.setVisible(1==c);f.setVisible(1==c);g.setVisible(2==c);d.allowBlank=1!=c;h.allowBlank=1!=c;d.validate();h.validate();f.isVisible()&&0==this.storeContiBanca.count()&&(c=k.findField("data"),c=c.getValue()?c.getValue().getFullYear():0,d={},4!=b&&5!=b||!this.idEsercizio?(this.storeContiBanca.getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(d,{idOrganizzazione:null!=
this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg(),anno:c,contoBanca:"T"})):(this.storeContiBanca.getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(d,{idOrganizzazione:null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg(),idEsercizio:this.idEsercizio,contoBanca:"T",contiBancaOrganizzazioneSelezionata:"T"})),this.storeContiBanca.load({params:d}))},onRgAverechange:function(b,c,d,f){b=Ext.getCmp("pensIncassoContoAvere");Ext.getCmp("IncassoDareAvere").isVisible()&&
(b.allowBlank=!c,b.setVisible(c),b.validate())},onCBPassaPensionichange:function(b,c,d,f){b=Ext.getCmp("pensPassaggioCausale");d=Ext.getCmp("pensPassaggioConto");b.setVisible(c);d.setVisible(c);b.allowBlank=!c;d.allowBlank=!c;b.validate();d.validate()},onCheckPassaQuoteChange:function(b,c,d,f){b=Ext.getCmp(this.id+"Form").getForm();Ext.getCmp("pnlPensPassaggioEntrate").setVisible(1==c);Ext.getCmp("pnlPensPassaggioSpese").setVisible(1==c);Ext.getCmp("pensIncassoEntrateCapitolo").allowBlank=0==c;Ext.getCmp("pensIncassoSpeseCapitolo").allowBlank=
0==c;b.setValues({pensIncassoEntrateCapitolo:1==c&&this.dati?this.dati.pensIncassoEntrateCapitolo:null,pensIncassoEntrateArticolo:1==c&&this.dati?this.dati.pensIncassoEntrateArticolo:null,pensIncassoSpeseCapitolo:1==c&&this.dati?this.dati.pensIncassoSpeseCapitolo:null,pensIncassoSpeseArticolo:1==c&&this.dati?this.dati.pensIncassoSpeseArticolo:null});b.isValid()},onCBpensIncassoEntrateCapitolo:function(b,c,d,f){c&&this.loadArticolo("entrate",c)},onCBpensIncassoSpeseCapitolo:function(b,c,d,f){c&&this.loadArticolo("spese",
c)},onCOPERCONTABILIBeforeRender:function(b,c){var d=this,f=Ext.create("Generali.standard.PannelloBottoniVert",{id:d.id+"BoxBottoni",itemId:d.id+"BoxBottoni",cbaConfig:{conferma_callback:function(){d.salva()},esci_callback:function(){d.esci()},annulla_callback:function(){d.aggiornaStore()},nuovo_callback:function(){d.nuovo()},elimina_callback:function(){eliminaRecordQuestion(d.id,"COPERCONTABILI",["id"])},verificaCampiForm_callback:function(){return d.verificaCampiForm()},formContainerName:d.id,formStoreName:"COPERCONTABILI",
arrayCampiChiave:'["id"]'}});inserisciBottoni(this.getComponent("boxBottoni"),f);Ext.getCmp("_btnEsci"+d.id+"BoxBottoni").hide();Localizer.localize(Ext.getCmp(this.id));var f=Ext.getCmp("COPERCONTABILIForm").getForm(),g=Ext.create("Generali.store.Registro");ImpostaUrl([g]);f.findField("registro").bindStore(g);d.storeCausaleContabilita=Ext.create("Generali.store.CausaleContabilita",{autoDestroy:!1});f.findField("causaleFattura").bindStore(Ext.create("Ext.data.ChainedStore",{source:d.storeCausaleContabilita}));
f.findField("causaleNotaAccredito").bindStore(Ext.create("Ext.data.ChainedStore",{source:d.storeCausaleContabilita}));d.storeCausaleContabilitaDocCont=Ext.create("Generali.store.CausaleContabilita",{autoDestroy:!1});f.findField("pensIncassoCausale").bindStore(Ext.create("Ext.data.ChainedStore",{source:d.storeCausaleContabilitaDocCont}));f.findField("pensPassaggioCausale").bindStore(Ext.create("Ext.data.ChainedStore",{source:d.storeCausaleContabilitaDocCont}));d.storeTipoIncasso=Ext.create("GeneraliOSP.personalizzazioni.store.TipoIncasso",
{autoDestroy:!1});f.findField("pensIncassoTipoPassaggio").bindStore(d.storeTipoIncasso);g=Ext.create("Generali.store.TipoDocRette");f.findField("tipoDocumento").bindStore(g);g=Ext.create("Generali.store.CondizioniPagamento");f.findField("condizionePagamento").bindStore(g);g.load();d.storeConti=Ext.create("Generali.store.Conto",{autoDestroy:!1});f.findField("contoContropartitaCorrispettivi").bindStore(d.storeConti);f.findField("pensIncassoContoScad").bindStore(d.storeConti);f.findField("pensPassaggioConto").bindStore(d.storeConti);
f.findField("pensIncassoContoAvere").bindStore(d.storeConti);d.storeContiBanca=Ext.create("Generali.store.Conto",{autoDestroy:!1});f.findField("pensIncassoContoDare").bindStore(d.storeContiBanca);d.storeAttivita=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/osp/co/ws/genAmm/attivita/cbox"},autoDestroy:!1});f.findField("attivita").bindStore(d.storeAttivita);Ext.getStore("TipiContAbilitata").load();Ext.getStore("CBEnteIva").load();Ext.getCmp(this.id+"RecordId").hide();f.findField("idPersonTestata").hide();
d.storeCapitolo=Ext.create("Generali.store.Capitolo",{autoDestroy:!1});d.storeArticoloEntrate=Ext.create("Generali.store.Articolo",{autoDestroy:!1});d.storeArticoloSpese=Ext.create("Generali.store.Articolo",{autoDestroy:!1});f.findField("pensIncassoEntrateCapitolo").bindStore(Ext.create("Ext.data.ChainedStore",{source:d.storeCapitolo}));f.findField("pensIncassoEntrateArticolo").bindStore(d.storeArticoloEntrate);f.findField("pensIncassoSpeseCapitolo").bindStore(Ext.create("Ext.data.ChainedStore",{source:d.storeCapitolo}));
f.findField("pensIncassoSpeseArticolo").bindStore(d.storeArticoloSpese);if("L"!=d.cbaConfig.permesso)Ext.getCmp(this.id+"Form").getForm().on("dirtychange",function(b,c){abilitaBottoni(d.id+"BoxBottoni",d.id+"Form",d.id);Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(c);d.getStoricoGrid().setDisabled(c);d.testata.getNuovo().setDisabled(c);d.testata.getElimina().setDisabled(c);d.testata.getGridTestata().setDisabled(c)});"L"==d.cbaConfig.permesso&&(containerSolaLettura(d.id+
"Form"),bottoniSolaLettura(d.id+"BoxBottoni"))},onCOPERCONTABILIDestroy:function(b,c){eliminaStore(this.storeCausaleContabilita);eliminaStore(this.storeTipoIncasso);eliminaStore(this.storeConti);eliminaStore(this.storeContiBanca);eliminaStore(this.storeAttivita);eliminaStore(this.storeCapitolo);eliminaStore(this.storeArticoloEntrate);eliminaStore(this.storeArticoloSpese)},impostaDati:function(b){var c=Ext.getCmp("COPERCONTABILI");c.getStoricoGrid().setDisabled(!1);clearForm(c.id+"Form");if(b){var d=
Ext.getCmp(c.id+"Form").getForm(),f=4==b.data.tipoContabilitaAbilitata||5==b.data.tipoContabilitaAbilitata;Ext.getCmp(c.id+"Form").loadRecord(b);c.dati=b.data;d.setValues({tipoDocumento:b.data.tipoDocumento,attivita:f?b.data.attivita:null,pensIncassoCausale:b.data.pensIncassoCausale&&0!=b.data.pensIncassoCausale?b.data.pensIncassoCausale:null,pensIncassoContoDare:b.data.pensIncassoContoDare&&0!=b.data.pensIncassoContoDare?b.data.pensIncassoContoDare:null,pensIncassoContoAvere:b.data.pensIncassoContoAvere&&
0!=b.data.pensIncassoContoAvere?b.data.pensIncassoContoAvere:null,pensPassaggioCausale:b.data.pensPassaggioCausale&&0!=b.data.pensPassaggioCausale?b.data.pensPassaggioCausale:null,pensPassaggioConto:b.data.pensPassaggioConto&&0!=b.data.pensPassaggioConto?b.data.pensPassaggioConto:null,pensPassaggioQuote:3==b.data.pensIncassoTipoPassaggio?!0:!1})}else c.abilitaCampi()},esci:function(){var b=this.aggiornaStore();puoiUscire("win_"+this.id,this.id+"Form",!1,b,b)},nuovo:function(){Ext.getCmp("COPERCONTABILI").dati=
null;nuovoRecord(Ext.getCmp("COPERCONTABILI"))},verificaCampiForm:function(){var b=[],c=Ext.getCmp(this.id+"Form").getForm();c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");4!=c.findField("tipoDocumento").getValue()||c.findField("causaleNotaAccredito").getValue()||msgAddError(b,"NOTA_ACCREDITO_OBB");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=Ext.getCmp("COPERCONTABILIForm").getForm(),d=c.findField("registro"),f=c.getFieldValues();f.registro=5==f.tipoDocumento?
"A":d.getRawValue();f.idRegistro=Ext.isNumber(d.getValue())?d.getValue():null;f.idPersonTestata=Ext.getStore("COPERCONTABILI").getProxy().extraParams.idTestata;c.findField("enteIvaFinanziaria").isVisible()||(f.enteIvaFinanziaria=null);f.ftLibDesBreve=getBoolValue(f.ftLibDesBreve);f.elaboraRetteZero=getBoolValue(f.elaboraRetteZero);f.rigeneraAddebitiAccrediti=getBoolValue(f.rigeneraAddebitiAccrediti);f.accreditoUsaEccedenza=getBoolValue(f.accreditoUsaEccedenza);f.bloccaCanc_Eco2=getBoolValue(f.bloccaCanc_Eco2);
f.escludiDaTS730=getBoolValue(f.escludiDaTS730);f.pensNonRaggrMovimRetta=getBoolValue(f.pensNonRaggrMovimRetta);f.pensAzzeraResidui=getBoolValue(f.pensAzzeraResidui);f.pensIncassoNoCassa=getBoolValue(f.pensIncassoNoCassa);2==f.tipoContabilitaAbilitata||4==f.tipoContabilitaAbilitata?(f.pensScadenzeAlNetto=getBoolValue(f.pensScadenzeAlNetto),f.pensCreaDocumentoContabile=getBoolValue(f.pensCreaDocumentoContabile)):(f.pensScadenzeAlNetto="F",f.pensCreaDocumentoContabile="F");if(2!=f.tipoContabilitaAbilitata&&
4!=f.tipoContabilitaAbilitata||null==f.pensIncassoTipoPassaggio||0==f.pensIncassoTipoPassaggio)f.pensIncassoTipoPassaggio=0,f.pensIncassoCausale=null,f.pensIncassoContoDare=null,f.pensIncassoContoAvere=null,f.pensIncassoContoScad=null;1==f.tipoContabilitaAbilitata?(f.pensPassaTotale=getBoolValue(f.pensPassaTotale),f.pensDivisioneAccertamenti=getBoolValue(f.pensDivisioneAccertamenti),f.pensIncassoTipoPassaggio=f.pensPassaggioQuote?3:0):(f.pensPassaTotale=null,f.pensDivisioneAccertamenti=null);delete f.pensPassaggioQuote;
"F"===f.pensCreaDocumentoContabile&&(f.pensPassaggioCausale=null,f.pensPassaggioConto=null);50==getModuloAttivo()&&(f.pensUsoPensione=1);salvaRecord(this,f,Ext.getStore("COPERCONTABILI"),b,!1,{idOrg:null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg()})},getStoricoGrid:function(){return Ext.getCmp("StoricoGridContabili")},aggiornaStore:function(b){generaliRicaricaStore("StoricoGridContabili","COPERCONTABILI",{idTestata:Ext.getStore("COPERCONTABILI").getProxy().extraParams.idTestata},
"StoricoGridContabili","id",this.impostaDati,b)},abilitaCampi:function(){var b=Ext.getCmp("COPERCONTABILIForm").getForm(),c=b.findField("tipoContabilitaAbilitata").getValue(),d=b.findField("tipoDocumento").getValue(),f=4==c||5==c;if(!c)return!1;var g=(2==c||f)&&6==b.findField("tipoDocumento").getValue(),h=Ext.getCmp("pnlControPartita");h.setVisible(g&&5!=c);h.down("radiogroup").allowBlank=!h.isVisible();if(g){var k=b.findField("tipoContropartitaCorrispettivi").getValue();k?b.setValues({tipoContropartitaCorrispettivi:"P"}):
b.setValues({tipoContropartitaCorrispettivi:"C"})}h.down("combobox").allowBlank=!(h.isVisible()&&k);g=!1;1==c&&(g=getPersonFinanziaria()[1]);h=b.findField("enteIvaFinanziaria");h.setVisible(g);h.allowBlank=!g;h.validateValue(h.getValue());g=b.findField("registro");g.setVisible(1!=c&&5!=d);g.allowBlank=1==c||5==d;b.findField("ftLibDesBreve").setVisible(2==c||f);b.findField("pensIncassoTipoPassaggio").allowBlank=1==c||3==c||5==c||50==getModuloAttivo();h=Ext.getCmp("pnlPensIncasso");k=Ext.getCmp("pnlPensPassaggio");
2==c||4==c?(k.show(),h.show()):(k.hide(),h.hide());h=Ext.getCmp("pnlPensPassaggioFinanziaria");1==c?h.show():h.hide();h=b.findField("attivita");h.setVisible(f);h.allowBlank=!f;h.validate();f=Ext.getCmp("causaliNotaAcc");f.setVisible(4==d);f.allowBlank=4!=d;1!=c&&(3==c?(g.setDisabled(!1),g.maxLength=2,g.setEditable(!0),g.cbaConfig.valida=!1,g.forceSelection=!1,g.setHideTrigger(!0)):(g.setEditable(!1),g.setHideTrigger(!1),g.cbaConfig.valida=!0,g.maxLength=Number.MAX_VALUE,g.forceSelection=!0));d=b.findField("bloccaCanc_Eco2");
d.setVisible(["4","5"].includes(c));d.setBoxLabel("5"==c?this.lblBloccaCancNoCont2:this.lblBloccaCancEco2);b.findField("escludiDaTS730").setVisible(["4","5"].includes(c));b.isValid()},loadRegistro:function(b){var c=this,d=Ext.getCmp(c.id+"Form").getForm(),f=d.findField("registro").getStore(),g=d.findField("data").getValue(),g=g?g.getFullYear():0,h=d.findField("tipoDocumento").getValue(),k={};4==b||5==b?(f.getProxy().url="/cba/osp/co/ws/genAmmPers/registriIva/detail/cboxByDate",Ext.apply(k,{dataControllo:d.findField("data").getValue(),
tipoDocumento:h/2,idOrganizzazione:null!=c.cbaConfig.idOrganizzazione?c.cbaConfig.idOrganizzazione:getIdOrg()})):(ImpostaUrl([f]),Ext.apply(k,{anno:g,tipoDocOspiti:h}));f.load({params:k,callback:function(f,g,k){c.dati&&c.dati.tipoDocumento==h&&d.setValues({registro:4!=b&&5!=b||!c.dati.idRegistro?c.dati.registro:c.dati.idRegistro});!d.findField("registro").getValue()&&f&&1==f.length&&d.setValues({registro:f[0].get("codice")})}})},loadConto:function(b){var c=Ext.getCmp(this.id+"Form").getForm(),c=c.findField("data").getValue()?
c.findField("data").getValue().getFullYear():0,d={};4!=b&&5!=b||!this.idEsercizio?(this.storeConti.getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(d,{anno:c})):(this.storeConti.getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(d,{idOrganizzazione:null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg(),idEsercizio:this.idEsercizio}));this.storeConti.load({params:d})},loadCapitolo:function(){var b=this,c=Ext.getCmp(b.id+"Form").getForm(),d=c.findField("data").getValue()?
c.findField("data").getValue().getFullYear():0;b.storeCapitolo.load({params:{anno:d,parte:"E,S"},callback:function(){b.filtraComboCapitolo();c.setValues({pensIncassoEntrateCapitolo:b.dati?b.dati.pensIncassoEntrateCapitolo:null,pensIncassoSpeseCapitolo:b.dati?b.dati.pensIncassoSpeseCapitolo:null})}})},loadArticolo:function(b,c){var d=this,f=Ext.getCmp(d.id+"Form").getForm(),g=f.findField("data").getValue()?f.findField("data").getValue().getFullYear():0;"entrate"==b?d.storeArticoloEntrate.load({params:{anno:g,
codCapitolo:c},callback:function(){d.filtraComboArticolo(b);f.setValues({pensIncassoEntrateArticolo:d.dati?d.dati.pensIncassoEntrateArticolo:null})}}):"spese"==b&&d.storeArticoloSpese.load({params:{anno:g,codCapitolo:c},callback:function(){d.filtraComboArticolo(b);f.setValues({pensIncassoSpeseArticolo:d.dati?d.dati.pensIncassoSpeseArticolo:null})}})},filtraStoreCausali:function(){var b=Ext.getCmp("COPERCONTABILIForm").getForm(),c=b.findField("tipoDocumento").getValue(),d=b.findField("tipoContabilitaAbilitata").getValue();
b.findField("causaleFattura").setFieldLabel(4==c?traduci("CAUSALE_FATTURA"):traduci("CAUSALE"));b.findField("causaleFattura").getStore().clearFilter();b.findField("causaleFattura").getStore().filter({filterFn:function(b){return"4"==d||"5"==d?"4"==c?"+"!=b.data.extra.split(",")[0]||"FV"!=b.data.extra.split(",")[1]&&"FVS"!=b.data.extra.split(",")[1]?!1:!0:"5"==c?"+"==b.data.extra.split(",")[0]&&"A"==b.data.extra.split(",")[2]?!0:!1:"6"==c?"+"==b.data.extra.split(",")[0]&&"CO"==b.data.extra.split(",")[1]?
!0:!1:"+"==b.data.extra.split(",")[0]?!0:!1:"+"==b.data.extra?!0:!1}});b.findField("causaleNotaAccredito").getStore().clearFilter();b.findField("causaleNotaAccredito").getStore().filter({filterFn:function(b){return"4"==d||"5"==d?"-"!=b.data.extra.split(",")[0]||"AV"!=b.data.extra.split(",")[1]&&"AVS"!=b.data.extra.split(",")[1]?!1:!0:"-"==b.data.extra?!0:!1}});b.findField("pensIncassoCausale").getStore().clearFilter();b.findField("pensIncassoCausale").getStore().filter({filterFn:function(b){return"4"==
d?"I"==b.data.extra.split(",")[2]?!0:!1:!0}});b.findField("pensPassaggioCausale").getStore().clearFilter();b.findField("pensPassaggioCausale").getStore().filter({filterFn:function(b){return"4"==d?"A"==b.data.extra.split(",")[2]?!0:!1:!0}})},filtraComboCapitolo:function(){var b=Ext.getCmp("COPERCONTABILIForm").getForm();b.findField("pensIncassoEntrateCapitolo").getStore().clearFilter();b.findField("pensIncassoEntrateCapitolo").getStore().filter({filterFn:function(b){return"E"==b.data.extra?!0:!1}});
b.findField("pensIncassoSpeseCapitolo").getStore().clearFilter();b.findField("pensIncassoSpeseCapitolo").getStore().filter({filterFn:function(b){return"S"==b.data.extra?!0:!1}})},filtraComboArticolo:function(b){var c=Ext.getCmp("COPERCONTABILIForm").getForm(),d=c.findField("pensIncassoEntrateArticolo"),c=c.findField("pensIncassoSpeseArticolo");"entrate"==b?(d.getStore().clearFilter(),d.getStore().filter({filterFn:function(b){return b.data.codice&&"E"==b.data.extra?!0:!1}}),d.setDisabled(0==d.getStore().getCount())):
"spese"==b&&(c.getStore().clearFilter(),c.getStore().filter({filterFn:function(b){return b.data.codice&&"S"==b.data.extra?!0:!1}}),c.setDisabled(0==c.getStore().getCount()))}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.COPERFESTIVITA",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",flex:1,border:0,itemId:"gridDettaglio",reference:"gridDettaglio",title:"",store:Ext.create("GeneraliOSP.personalizzazioni.app.store.COPERFESTIVITA"),dockedItems:[{xtype:"toolbar",dock:"top",border:0,items:[{xtype:"button",itemId:"detNuovo",reference:"detNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",
itemId:"detElimina",reference:"detElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],columns:[{xtype:"datecolumn",width:150,dataIndex:"dataGgFestivo",text:"DALLA_DATA",format:"d/m/Y",editor:{xtype:"datefield",allowBlank:!1}},{xtype:"datecolumn",width:150,dataIndex:"dataGgFestivoAl",text:"ALLA_DATA",format:"d/m/Y",editor:{xtype:"datefield",allowBlank:!1}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:150,align:"center",dataIndex:"ricorsiva",text:"FEST_RICORSIVA",
editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.COPERGIORNIAPERTURA",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",flex:1,itemId:"gridDettaglio",reference:"gridDettaglio",store:Ext.create("GeneraliOSP.personalizzazioni.app.store.COPERGIORNIAPERTURA"),dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"detNuovo",reference:"detNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"detElimina",
reference:"detElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],columns:[{xtype:"datecolumn",width:150,dataIndex:"data",text:"data",format:"d/m/Y",editor:{xtype:"datefield",allowBlank:!1}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:50,align:"center",dataIndex:"lunedi",text:"lun",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:50,align:"center",
dataIndex:"martedi",text:"mar",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:50,align:"center",dataIndex:"mercoledi",text:"mer",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:50,align:"center",dataIndex:"giovedi",text:"gio",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},
{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:50,align:"center",dataIndex:"venerdi",text:"ven",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:50,align:"center",dataIndex:"sabato",text:"sab",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:50,
align:"center",dataIndex:"domenica",text:"dom",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.COPERPRESENZE",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"COPERPRESENZE",reference:"COPERPRESENZE",layout:{type:"border"},title:"",items:[{xtype:"panel",region:"west",width:150,border:0,itemId:"Container",reference:"Container",layout:{type:"fit"},title:"PRESENZE_ELENCO",items:[{xtype:"gridpanel",border:0,itemId:"GridDettaglio",reference:"GridDettaglio",title:"",
store:Ext.create("GeneraliOSP.personalizzazioni.app.store.COPERPRESENZE"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"data",text:"DATA_DECORRENZA",flex:1,format:"d/m/Y"}]}]},{xtype:"form",region:"center",border:0,itemId:"COPERPRESENZEForm",reference:"COPERPRESENZEForm",autoScroll:!0,flex:1,layout:{type:"hbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",layout:{type:"hbox"},padding:"0 0 10 0",items:[{xtype:"datefield",
width:210,fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",name:"data",fieldCls:"cbaInputData",allowBlank:!1},{xtype:"numberfield",padding:"0 0 0 40",width:210,fieldLabel:"GGMODIFICAFASCICOLO",labelClsExtra:"cbaLabel",name:"ggModificaFascicolo",fieldCls:"cbaInput50",allowDecimals:!1}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"fieldset",defaults:{margin:{top:0,right:0,bottom:5,left:0}},layout:{type:"hbox"},title:"retta",items:[{xtype:"container",flex:1,layout:{type:"vbox"},items:[{xtype:"container",
flex:1,layout:{type:"hbox"},items:[{xtype:"checkboxfield",cls:"cbaLabel",width:290,fieldLabel:"",name:"giornoIngressoRette",boxLabel:"giornoIngressoRette",inputValue:"T",uncheckedValue:"F"},{xtype:"timefield",validator:function(b){return!0},width:50,fieldLabel:"",labelClsExtra:"cbaLabel",labelWidth:60,name:"oraGiornoIngresso",fieldCls:"cbaInputOra",format:"H:i",increment:30,listeners:{afterrender:{fn:this.onTimefieldAfterRender,scope:this},change:{fn:this.onTimefieldChange,scope:this}}}]},{xtype:"container",
flex:1,layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"CkgiornoDimissioneRette",reference:"CkgiornoDimissioneRette",flex:1,cls:"cbaLabel",width:290,fieldLabel:"",name:"giornoDimissioneRette",boxLabel:"giornoDimissioneRette",inputValue:"T",uncheckedValue:"F"},{xtype:"timefield",itemId:"OragiornoDimissioneRette",reference:"OragiornoDimissioneRette",validator:function(b){return!0},width:50,fieldLabel:"",labelClsExtra:"cbaLabel",labelWidth:50,name:"oraGiornoDimissioni",fieldCls:"cbaInputOra",
format:"H:i",increment:30,listeners:{afterrender:{fn:this.onTimefieldAfterRender1,scope:this},change:{fn:this.onTimefieldChange1,scope:this}}}]},{xtype:"container",flex:1,layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"CkgiornoDecessoRette",reference:"CkgiornoDecessoRette",flex:1,cls:"cbaLabel",width:290,fieldLabel:"",name:"giornoDecessoRette",boxLabel:"giornoDecessoRette",inputValue:"T",uncheckedValue:"F"},{xtype:"timefield",itemId:"OragiornoDecessoRette",reference:"OragiornoDecessoRette",
validator:function(b){return!0},width:50,fieldLabel:"",labelClsExtra:"cbaLabel",labelWidth:50,name:"oraGiornoDecessi",fieldCls:"cbaInputOra",format:"H:i",increment:30,listeners:{afterrender:{fn:this.onTimefieldAfterRender1,scope:this},change:{fn:this.onTimefieldChange1,scope:this}}}]},{xtype:"container",flex:1,layout:{type:"hbox"},items:[{xtype:"checkboxfield",flex:1,cls:"cbaLabel",width:290,fieldLabel:"",name:"giornoUscitaRette",boxLabel:"giornoUscitaRette",inputValue:"T",uncheckedValue:"F"},{xtype:"timefield",
validator:function(b){return!0},width:50,fieldLabel:"",labelClsExtra:"cbaLabel",labelWidth:50,name:"oraGiornoUscita",fieldCls:"cbaInputOra",format:"H:i",increment:30,listeners:{afterrender:{fn:this.onTimefieldAfterRender3,scope:this},change:{fn:this.onTimefieldChange2,scope:this}}}]},{xtype:"container",flex:1,layout:{type:"hbox"},items:[{xtype:"checkboxfield",flex:1,cls:"cbaLabel",width:290,fieldLabel:"",name:"giornoRientroRette",boxLabel:"giornoRientroRette",inputValue:"T",uncheckedValue:"F"},{xtype:"timefield",
validator:function(b){return!0},width:50,fieldLabel:"",labelClsExtra:"cbaLabel",labelWidth:50,name:"oraGiornoRientro",fieldCls:"cbaInputOra",format:"H:i",increment:30,listeners:{afterrender:{fn:this.onTimefieldAfterRender2,scope:this},change:{fn:this.onTimefieldChange3,scope:this}}}]}]},{xtype:"gridpanel",itemId:"MotiviDim",reference:"MotiviDim",padding:"0 10 0 20",width:210,height:170,title:"",disabled:!0,store:Ext.create("GeneraliOSP.store.RisposteSmall"),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",
text:traduci("MOTIVI_DIM"),flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,listeners:{selectionchange:function(b,c,d){this.column.getView().up().up().up().up().up().controller.getDirtyGrid().setValue("xx")}}}),features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}]}]},{xtype:"button",cls:"btnLarge",itemId:"btnInfoGGIngressoUscita",reference:"btnInfoGGIngressoUscita",margin:"10 0 0 10",iconCls:"icon-info",scale:"medium",text:"",tooltip:"TOOLTIP_PERSONPRESENZE"}]},
{xtype:"fieldset",title:"regionale",width:352,items:[{xtype:"checkboxfield",cls:"cbaLabel",name:"giornoIngressoReg",boxLabel:"giornoIngressoReg",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"giornoDimissioneReg",boxLabel:"giornoDimissioneReg",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"giornoUscitaReg",boxLabel:"giornoUscitaReg",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",
name:"giornoRientroReg",boxLabel:"giornoRientroReg",inputValue:"T",uncheckedValue:"F"}]},{xtype:"fieldset",title:"interna",width:352,items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"giornoIngressoStat",boxLabel:"giornoIngressoStat",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"giornoDimissioneStat",boxLabel:"giornoDimissioneStat",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"giornoUscitaStat",
boxLabel:"giornoUscitaStat",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",name:"giornoRientroStat",boxLabel:"giornoRientroStat",inputValue:"T",uncheckedValue:"F"}]},{xtype:"textfield",fieldLabel:"idPersonTestata",name:"idPersonTestata"},{xtype:"textfield",itemId:"COPERPRESENZERecordId",reference:"COPERPRESENZERecordId",fieldLabel:"id",name:"id"}]},{xtype:"textfield",itemId:"DirtyGrid",reference:"DirtyGrid",name:"DirtyGrid",hidden:!0}]},{xtype:"panel",region:"east",
itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.COPERSONALIZZAZIONITE",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"container",reference:"container",layout:{align:"stretch",type:"vbox"},items:[{xtype:"panel",itemId:"pnlTestata",reference:"pnlTestata",layout:{align:"stretch",type:"vbox"},minHeight:200,flex:.3,items:[{xtype:"gridpanel",border:0,itemId:"gridTestata",reference:"gridTestata",flex:1,style:"margin-bottom: 10px",
store:Ext.create("GeneraliOSP.personalizzazioni.app.store.COPERSONALIZZAZIONITE"),viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"descrizione",flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1})],dockedItems:[{xtype:"toolbar",dock:"top",border:0,itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"nuovo",reference:"nuovo",iconCls:"icon-inserisciGriglia",
text:"Nuovo"},{xtype:"button",itemId:"elimina",reference:"elimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}]}]},{xtype:"container",itemId:"cntDettaglio",reference:"cntDettaglio",flex:.7,layout:{type:"fit"},hidden:!0}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.CORISPOSTE_DE",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",flex:1,border:0,itemId:"gridDettaglio",reference:"gridDettaglio",title:"",store:Ext.create("GeneraliOSP.personalizzazioni.app.store.CORISPOSTE_DE"),dockedItems:[{xtype:"toolbar",dock:"top",border:0,items:[{xtype:"button",itemId:"detNuovo",reference:"detNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",
itemId:"detElimina",reference:"detElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],columns:[{xtype:"datecolumn",dataIndex:"dataDal",text:"DATA_DECORRENZA",format:"d/m/Y",editor:{xtype:"datefield",allowBlank:!1,selectOnFocus:!0}},{xtype:"numbercolumn",dataIndex:"quotaSanitaria",format:"0.00000,",sortable:!1,align:"center",text:"M"==this.cbaConfig.tipoServizio?"V"==this.cbaConfig.scheda&&108==this.cbaConfig.domanda?"IMPORTO":"Q_AMB_SSN":"Q_SAN",flex:1,maxWidth:130,renderer:function(b,c,d,f,
g,h,k){c.style="text-align:right !important";return formatFloat(b)},editor:{xtype:"numberfield",decimalPrecision:5,selectOnFocus:!0}},{xtype:"numbercolumn",dataIndex:"quotaSociale",format:"0.00000,",sortable:!1,align:"center",text:"M"==this.cbaConfig.tipoServizio?"Q_AMB_PRIVATO":"Q_SOC",flex:1,renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},editor:{xtype:"numberfield",decimalPrecision:5,selectOnFocus:!0}},{xtype:"numbercolumn",hidden:!0,dataIndex:"quotaSanGgForced",
format:"0.00000,",sortable:!1,align:"center",text:"Q_SAN_GGFORCED",flex:1,renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},editor:{xtype:"numberfield",decimalPrecision:5,selectOnFocus:!0}},{xtype:"numbercolumn",hidden:!0,dataIndex:"quotaSocGgForced",format:"0.00000,",sortable:!1,align:"center",text:"Q_SOC_GGFORCED",flex:1,renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},editor:{xtype:"numberfield",selectOnFocus:!0}},
{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return d.data.desUniMis},hidden:!0,maxWidth:110,width:110,dataIndex:"codUniMis",text:"Unit di Misura"},{xtype:"gridcolumn",hidden:!0,maxWidth:40,width:40,resizable:!1,align:"center",dataIndex:"qta",text:"Q.t",editor:{xtype:"numberfield",selectOnFocus:!0}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:82,dataIndex:"percentuale",text:"percentuale",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F",
selectOnFocus:!0}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){if(b&&(b=trovaRecord(h,"codice",b)))return b.data.valore},dataIndex:"idFranchigia",text:"franchigia",flex:1},{xtype:"gridcolumn",dataIndex:"idAliquotaIva",text:"aliquota",flex:1,renderer:function(b,c,d){return d.get("desAliquotaIva")},editor:{xtype:"combobox",selectOnFocus:!0,displayField:"valore",queryMode:"local",valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[1] == 'F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore}</div>',
"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>"),listConfig:{width:500,heigth:200,loadMask:!1}}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){b=d.data.desConto;d.data.conto&&!b&&(b=d.data.conto);return b},dataIndex:"conto",text:"conto",flex:1},{xtype:"gridcolumn",dataIndex:"idRegistro",flex:1},{xtype:"gridcolumn",dataIndex:"annoConto",flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){b=d.data.desRegistro;d.data.registro&&!b&&(b=d.data.registro);return b},
dataIndex:"registro",text:"registro",flex:1},{xtype:"gridcolumn",itemId:"annoCda",reference:"annoCda",renderer:function(b,c,d,f,g,h,k){0===b&&(b="");return b},dataIndex:"annoCda",flex:1},{xtype:"gridcolumn",itemId:"desAnnoCda",reference:"desAnnoCda",dataIndex:"desAnnoCda",text:"anno_cda",flex:1},{xtype:"gridcolumn",dataIndex:"cda",text:"cda",flex:1},{xtype:"gridcolumn",dataIndex:"cda1",text:"cda1",editor:{xtype:"textfield"}},{xtype:"gridcolumn",dataIndex:"tipoContabilita",text:"tipoContabilita",flex:1,
editor:{xtype:"textfield"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return null==d.data.capitolo?"":d.data.capitolo+" - "+d.data.desCapitolo},dataIndex:"capitolo",text:"capitolo",flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return null==d.data.articolo?"":d.data.articolo+" - "+d.data.desArticolo},dataIndex:"articolo",text:"articolo",flex:1}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.DETTMOTIVIUSCITA",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"DETTMOTIVIUSCITA",reference:"DETTMOTIVIUSCITA",layout:{type:"border"},title:"",items:[{xtype:"panel",region:"west",itemId:"Container",reference:"Container",width:150,layout:{type:"fit"},title:"DETTMOTIVIUSCITA_ELENCO",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGrid",reference:"StoricoGrid",title:"",
store:Ext.create("GeneraliOSP.personalizzazioni.app.store.DETTMOTIVIUSCITA"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"dataDal",text:"DATA_DECORRENZA",flex:1,format:"d/m/Y"}]}]},{xtype:"form",region:"center",border:0,itemId:"DETTMOTIVIUSCITAForm",reference:"DETTMOTIVIUSCITAForm",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"datefield",itemId:"dataDecorrenza",reference:"dataDecorrenza",margin:"0 0 5 0",width:250,labelWidth:110,
fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:!1,selectOnFocus:!0},{xtype:"combobox",margin:"0 0 5 0",width:250,labelWidth:110,fieldLabel:"TIPO_IMPORTO",labelClsExtra:"cbaLabel",name:"tipoImporto",allowBlank:!1,editable:!1,displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"container",itemId:"CalcoloFranchigia",reference:"CalcoloFranchigia",margin:"0 0 5 0",layout:{align:"stretch",type:"hbox"},items:[{xtype:"combobox",fieldLabel:"TIPO_CALCOLO",name:"tipoCalcolo",
itemId:"TipoCalcolo",reference:"TipoCalcolo",labelClsExtra:"cbaLabel",displayField:"valore",queryMode:"local",valueField:"codice",width:250,labelWidth:110,allowBlank:!1},{xtype:"button",cls:"btnLarge",itemId:"TipoCalcoloInfo",reference:"TipoCalcoloInfo",margin:"0 0 0 10",iconCls:"icon-info",scale:"medium",text:""}]},{xtype:"gridpanel",margin:"0 0 30 0",height:150,itemId:"gridFranchigie",reference:"gridFranchigie",width:435,title:"",store:Ext.create("Generali.clientiFornitori.store.FranchigieDe"),
columns:[{xtype:"numbercolumn",dataIndex:"dalGiorno",format:"0,",text:"DALGIORNO",align:"right",allowDecimals:!1,editor:{xtype:"numberfield",allowDecimals:!1,selectOnFocus:!0}},{xtype:"numbercolumn",dataIndex:"quotaSanitaria",format:"G"==this.cbaConfig.tipoServizio?"0.00000":"0.00,",sortable:!1,align:"center",text:"QUOTA_SAN",flex:1,editor:{xtype:"numberfield",decimalPrecision:"G"==this.cbaConfig.tipoServizio?5:2,selectOnFocus:!0},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";
return formatFloat(b)}},{xtype:"numbercolumn",dataIndex:"quotaSociale",format:"G"==this.cbaConfig.tipoServizio?"0.00000":"0.00,",sortable:!1,align:"center",text:"QUOTA_SOC",flex:1,editor:{xtype:"numberfield",decimalPrecision:"G"==this.cbaConfig.tipoServizio?5:2,selectOnFocus:!0},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)}}],viewConfig:{width:200,loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",
itemId:"detNuovo",reference:"detNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"detElimina",reference:"detElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]},{xtype:"container",margin:"0 0 5 0",layout:{align:"stretch",type:"hbox"},items:[{xtype:"container",itemId:"pnlContoRegistro",reference:"pnlContoRegistro",margin:"0 5 0 0",items:[{xtype:"container",items:[{xtype:"combobox",itemId:"cmbRegistro",
reference:"cmbRegistro",width:160,fieldLabel:"REGISTRO",labelClsExtra:"cbaLabel",name:"registro",editable:!1,displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"combobox",width:435,fieldLabel:"CONTO",labelClsExtra:"cbaLabel",name:"conto",displayField:"valore",queryMode:"local",valueField:"codice",minChars:3}]},{xtype:"cda",annoData:"annoCda",labelWidth:100,width:500,margin:"0 0 0 0",hideCodice:!0,showDesCda:!0,hideAnno:!1,itemId:"cntCda",reference:"cntCda",cbaConfig:{tipoContabilita:4}},
{xtype:"numberfield",hidden:!0,name:"idEsercizio"}]},{xtype:"container",height:55,itemId:"pnlCapitoloArticolo",reference:"pnlCapitoloArticolo",items:[{xtype:"combobox",itemId:"cmbCapitolo",reference:"cmbCapitolo",width:435,fieldLabel:"CAPITOLO",labelClsExtra:"cbaLabel",name:"capitolo",displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"combobox",width:435,fieldLabel:"ARTICOLO",labelClsExtra:"cbaLabel",name:"articolo",displayField:"valore",queryMode:"local",valueField:"codice"}]}]},
{xtype:"combobox",itemId:"cmbAliquota",reference:"cmbAliquota",width:337,fieldLabel:"ALIQUOTA",labelClsExtra:"cbaLabel",name:"idAliquotaIva",displayField:"valore",queryMode:"local",valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[1] == 'F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore}</div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"textfield",
hidden:!0,itemId:"DETTMOTIVIUSCITARecordId",reference:"DETTMOTIVIUSCITARecordId",fieldLabel:"id",name:"id"},{xtype:"textfield",hidden:!0,fieldLabel:"idParametriContabilita",name:"idParametriContabilita"},{xtype:"textfield",hidden:!0,fieldLabel:"idFranchigia",name:"idFranchigia"},{xtype:"textfield",hidden:!0,fieldLabel:"risposta",name:"risposta"},{xtype:"textfield",hidden:!0,fieldLabel:"tipoDocumento",name:"tipoDocumento"},{xtype:"textfield",hidden:!0,fieldLabel:"annoConto",name:"annoConto"}]},{xtype:"panel",
region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}]}]});this.callParent(arguments)}});
Ext.define("Personalizzazioni.view.GEANFOCL",{extend:"Ext.panel.Panel",id:"GEANFOCL",itemId:"GEANFOCL",reference:"GEANFOCL",layout:{align:"stretch",type:"hbox"},title:"CLIENTI_FORNITORI",initComponent:function(){var b=this;Ext.applyIf(b,{dockedItems:[{xtype:"container",aggiornaStore:function(){this.queryById("GridCliFo").getStore().load({start:0,limit:25})},dock:"left",itemId:"cntLeft",reference:"cntLeft",width:214,layout:{align:"stretch",type:"vbox"},items:[{xtype:"fieldset",width:100,layout:{align:"stretch",
type:"vbox"},collapsed:!0,collapsible:!0,title:"Avanzate",items:[{xtype:"checkboxfield",itemId:"ChkDestinatario",reference:"ChkDestinatario",name:"destinatario",boxLabel:"DESTINATARIO_FATTURA",inputValue:"T",uncheckedValue:"F",listeners:{change:{fn:b.onCheckboxfieldChange,scope:b}}},{xtype:"checkboxfield",itemId:"ChkRette",reference:"ChkRette",name:"rette",boxLabel:"PERSON_RETTE",inputValue:"T",uncheckedValue:"F",listeners:{change:{fn:b.onCheckboxfieldChange,scope:b}}},{xtype:"checkboxfield",itemId:"ChkFranchigia",
reference:"ChkFranchigia",name:"franchigia",boxLabel:"PERSON_FRANCHIGIA",inputValue:"T",uncheckedValue:"F",listeners:{change:{fn:b.onCheckboxfieldChange,scope:b}}},{xtype:"checkboxfield",itemId:"ChkPesonFattEle",reference:"ChkPesonFattEle",name:"personFattEle",boxLabel:"PERSON_FATTELE",inputValue:"T",uncheckedValue:"F",hidden:!0,listeners:{change:{fn:b.onCheckboxfieldChange,scope:b}}},{xtype:"radiogroup",flex:1,margin:"0 0 5 0",labelWidth:60,itemId:"RgbFiltro",reference:"RgbFiltro",labelClsExtra:"cbaLabel",
listeners:{change:{fn:b.onCheckboxfieldChange,scope:b}},layout:{type:"column"},fieldLabel:"CERCA_PER",items:[{xtype:"radiofield",width:120,name:"RgbFiltro",boxLabel:"RAGIONE_SOCIALE",inputValue:"RAGSOC",checked:!0,cls:"cbaLabel"},{xtype:"radiofield",width:120,name:"RgbFiltro",boxLabel:"PARTITA_IVA",inputValue:"PARIVA",cls:"cbaLabel"},{xtype:"radiofield",width:120,fieldLabel:"",name:"RgbFiltro",boxLabel:"CODICE_FISCALE",inputValue:"CODFISC",cls:"cbaLabel"}]}]},{xtype:"gridpanel",flex:1,itemId:"GridCliFo",
reference:"GridCliFo",width:232,title:"",columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"RAGIONE_SOCIALE",flex:1}],viewConfig:{loadMask:!1,getRowClass:function(b,d){if(null!=b.get("extra")&&-1!=b.get("extra").indexOf(",")){if("T"!=b.get("extra").split(",")[1])return"non_attivi";if("T"==b.get("extra").split(",")[2])return"in_grassetto"}}},dockedItems:[{xtype:"pagingtoolbar",dock:"bottom",itemId:"PTCliFo",reference:"PTCliFo",width:360,displayInfo:!1},{xtype:"toolbar",dock:"top",itemId:"TBRicerca",
reference:"TBRicerca",items:[{xtype:"cercaGrid",minChars:3,itemId:"Pagante",reference:"Pagante",cbaConfig:{filtroPersonalizzato:function(c,d,f){var g=c.getValue();b.queryById("cntLeft").aggiornaStore();f.getProxy().extraParams={valore:g?g:""};f.loadPage(1,{callback:function(b,f,g){d.getSelectionModel().select(0);c.focus(!1,20)}})}}},{xtype:"button",margin:"10,0,0,0",itemId:"prtPersonRette",reference:"prtPersonRette",iconCls:"icon-stampa32",scale:"small",hidden:!1,tooltip:"Stampa Personalizzazioni rette",
listeners:{click:{fn:b.onClickPrtPersonRette,scope:b}}}]}],listeners:{select:{fn:b.onGridCliFoSelect,scope:b}}}]}],items:[{xtype:"tabpanel",flex:1,itemId:"TabGenerale",reference:"TabGenerale",activeTab:0,items:[{xtype:"panel",itemId:"TabAnagrafica",reference:"TabAnagrafica",layout:{type:"fit"},title:"ANAGRAFICA"},{xtype:"panel",itemId:"TabDestFatt",reference:"TabDestFatt",layout:{type:"fit"},title:"DESTINATARIO_FATTURA"}],listeners:{beforetabchange:{fn:b.onTabpanelBeforeTabChange,scope:b},tabchange:{fn:b.onTabGeneraleTabChange,
scope:b}}}],listeners:{beforerender:{fn:b.onPanelBeforeRender,scope:b}}});b.callParent(arguments)},onClickPrtPersonRette:function(){var b={};b.url=getUrlGen()+"/ws/reports/users/prtPersonRettePaganti";b.params=this.leggiFiltriRicerca();stampaEsporta(this.queryById("prtPersonRette"),b,null)},onCheckboxfieldChange:function(b,c,d,f){var g=this.queryById("GridCliFo"),h=this.queryById("PTCliFo"),k=g.getStore();k.loadPage(1,{callback:function(b,c,d){g.getSelectionModel().select(0);h.bindStore(k);h.show()}})},
onGridCliFoSelect:function(b,c,d,f){this.caricaDati()},onTabpanelBeforeTabChange:function(b,c,d,f){return!d.down("form").getForm().isDirty()},onTabGeneraleTabChange:function(b,c,d,f){this.caricaDati()},leggiFiltriRicerca:function(){return{valore:this.queryById("Pagante").getValue(),campoRicerca:this.queryById("RgbFiltro").getValue().RgbFiltro,contiene:"T",destinatario:this.queryById("ChkDestinatario").getSubmitValue(),rette:this.queryById("ChkRette").getSubmitValue(),franchigia:this.queryById("ChkFranchigia").getSubmitValue(),
personFattEle:this.queryById("ChkPesonFattEle").getSubmitValue(),tipoContabilita:this.personContabili.tipoContabilitaAbilitata}},onPanelBeforeRender:function(b,c){var d=this;Localizer.localize(b);var f=Ext.create("Generali.clientiFornitori.store.ClientiFornitori");d.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null);f.on("beforeload",function(b,c,f){b.getProxy().extraParams=d.leggiFiltriRicerca()});b.queryById("GridCliFo").bindStore(f);b.queryById("PTCliFo").bindStore(f);f.load();b.queryById("TabAnagrafica").add(Ext.create("Generali.clientiFornitori.view.Anagrafica",
{itemId:"Anagrafica",reference:"Anagrafica"+Ext.Date.now()}));b.queryById("TabDestFatt").add(Ext.create("Generali.clientiFornitori.view.DestinatarioFattura",{itemId:"DestFatt",reference:"DestFatt"+Ext.Date.now(),permesso:d.cbaConfig.permesso,hideButtonEsci:!0}));f=getIdOrg();b.queryById("TabGenerale").add({xtype:"panel",layout:{type:"fit"},itemId:"TabPersonRette",reference:"TabPersonRette",tipo:"PersonRette",title:traduci("PERSON_RETTE"),items:Ext.create("Generali.clientiFornitori.view.PersonRette",
{itemId:"PersonRette",reference:"PersonRette"+Ext.Date.now(),permesso:d.cbaConfig.permesso,idOrg:f})});b.queryById("TabGenerale").add({xtype:"panel",layout:{type:"fit"},itemId:"TabPersonFranchigia",reference:"TabPersonFranchigia",tipo:"PersonFranchigia",title:traduci("PERSON_FRANCHIGIA"),items:Ext.create("Generali.clientiFornitori.view.PersonFranchigia",{itemId:"PersonFranchigia",reference:"PersonFranchigia"+Ext.Date.now(),permesso:d.cbaConfig.permesso,idOrg:f})});if(43==CBA.moduli.moduloAttivo||
50==CBA.moduli.moduloAttivo)if(4==d.personContabili.tipoContabilitaAbilitata||5==d.personContabili.tipoContabilitaAbilitata)d.queryById("ChkPesonFattEle").show(),b.queryById("TabGenerale").add({xtype:"panel",layout:{type:"fit"},itemId:"TabPersonFattEle",reference:"TabPersonFattEle",tipo:"PersonFattEle",title:traduci("PERSON_FATTELE"),items:Ext.create("Generali.clientiFornitori.view.PersonFattEle",{itemId:"PersonFattEle",reference:"PersonFattEle"+Ext.Date.now(),permesso:d.cbaConfig.permesso,idOrg:f})})},
caricaDati:function(){var b=this.queryById("GridCliFo").getSelectionModel().getSelection()[0];if(b){var c=this.queryById("TabGenerale").getActiveTab();"TabAnagrafica"==c.getItemId()?4==this.personContabili.tipoContabilitaAbilitata||5==this.personContabili.tipoContabilitaAbilitata?c.down().controller.caricaInfoCliFor(b.get("codice")):c.down().controller.caricaAnagrafica(b.get("codice")):"TabDestFatt"==c.getItemId()?c.down().controller.caricaDestinatario(b.get("codice"),b.get("valore")):c.tipo&&"PersonRette"==
c.tipo?c.down().controller.caricaPerson(b.get("codice")):c.tipo&&"PersonFranchigia"==c.tipo?c.down().controller.caricaFranchigie(b.get("codice")):c.tipo&&"PersonFattEle"==c.tipo&&c.down().controller.caricaPersonFattEle(b.get("codice"))}}});
Ext.define("Personalizzazioni.view.IMP_CONTABILI",{extend:"Ext.tab.Panel",id:"IMP_CONTABILI",itemId:"IMP_CONTABILI",reference:"IMP_CONTABILI",activeTab:0,initComponent:function(){Ext.applyIf(this,{listeners:{beforerender:{fn:this.onIMP_CONTABILIBeforeRender,scope:this},tabchange:{fn:this.onIMP_CONTABILITabChange,scope:this},beforetabchange:{fn:this.onIMP_CONTABILIBeforeTabChange,scope:this}},items:[this.processTabRette({xtype:"panel",height:250,itemId:"TabRette",reference:"TabRette",width:400,layout:{align:"stretch",
type:"vbox"},title:"TAB_CALCOLO_RETTE"}),this.processTabPersCont({xtype:"panel",itemId:"TabPersCont",reference:"TabPersCont",layout:{align:"stretch",type:"vbox"},title:"TAB_PERS_CONTABILI"}),this.processTabBollo({xtype:"panel",itemId:"TabBollo",reference:"TabBollo",layout:{align:"stretch",type:"vbox"},title:"TAB_BOLLO"})]});this.callParent(arguments)},processTabRette:function(b){b.tipo="R";return b},processTabPersCont:function(b){b.tipo="C";return b},processTabBollo:function(b){b.tipo="B";return b},
onIMP_CONTABILIBeforeRender:function(b,c){Localizer.localize(b);this.aggiornaTab(b.queryById("TabRette"))},onIMP_CONTABILITabChange:function(b,c,d,f){d.removeAll();this.aggiornaTab(c)},onIMP_CONTABILIBeforeTabChange:function(b,c,d,f){return!Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").isDisabled()},aggiornaTab:function(b){var c=this.cbaConfig;b.add(Ext.create("GeneraliOSP.personalizzazioni.app.view.COPERSONALIZZAZIONITE",{flex:1,cbaConfig:{impostazioniContabili:!0,tipo:b.tipo,idOrganizzazione:c.idOrganizzazione,
permesso:c.permesso}}))}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.OSPE_SRT",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",flex:1,border:0,itemId:"grid",reference:"grid",title:"",store:Ext.create("GeneraliOSP.personalizzazioni.app.store.OSPE_SRT",{sorters:[{property:"stato",transform:function(b){return StdSipcar.coalesce(b,"F")}},{property:"descrizione",transform:function(b){return null==b?b:b.toLowerCase()}}]}),dockedItems:[{xtype:"toolbar",dock:"top",
border:0,items:[{xtype:"button",itemId:"btnNuovo",reference:"btnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"btnElimina",reference:"btnElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"},{xtype:"button",itemId:"BtnSblocca",reference:"BtnSblocca",iconCls:"icon-locked",tooltip:"SBLOCCA",text:"SBLOCCA",hidden:!0,width:80},{xtype:"numberfield",itemId:"GGNotificaScadenzaDoc",reference:"GGNotificaScadenzaDoc",padding:"0 0 0 160",width:240,fieldLabel:"GGNOTIFICASCADENZADOC",
labelWidth:150,labelClsExtra:"cbaLabel",name:"ggNotificaScadenzaDoc",fieldCls:"cbaInput50",allowDecimals:!1,minValue:0,maxLength:5,enforceMaxLength:!0,hidden:!0},{xtype:"button",itemId:"btnConferma",reference:"btnConferma",iconCls:"icon-ok",text:"CONFERMA",hidden:!0}]}],columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){"T"==b&&(c.tdCls="icon-deseleziona")},width:65,align:"center",dataIndex:"stato",text:"DISATTIVATO",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"},hidden:!(112==
this.cbaConfig.domanda&&"V"==this.cbaConfig.scheda)},{xtype:"gridcolumn",width:300,dataIndex:"descrizione",text:"descrizione",editor:{xtype:"textfield",itemId:"editorDescrizione",reference:"editorDescrizione",allowBlank:!1,maxLength:50,enforceMaxLength:!0}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:130,align:"center",dataIndex:"esenzioneReddito",text:"esenzione_reddito",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",
renderer:function(b,c,d,f,g,h,k){c=getColGrid(k,"tipoStato");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},width:200,dataIndex:"tipoStato",text:"TIPOLOGIA_DOCUMENTO"},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},width:130,align:"center",dataIndex:"esenzioneTotale",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c=getColGrid(k,
"livEdu");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},dataIndex:"livEdu",text:"LIV_EDU",flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c=getColGrid(k,"contoPensioni");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},dataIndex:"contoPensioni",text:traduci("CONTO_PENSIONE"),flex:1},{xtype:"gridcolumn",dataIndex:"codRaccordo",text:traduci("CODICE_RACCORDO"),
editor:{xtype:"textfield",itemId:"editorCodRaccordo",reference:"editorCodRaccordo",maxLength:15,enforceMaxLength:!0},flex:1},{xtype:"gridcolumn",dataIndex:"desEstesa",text:traduci("DB_CICLO_ATTIVO"),editor:{xtype:"textfield",itemId:"editorDesEstesa",reference:"editorDesEstesa",maxLength:100,enforceMaxLength:!0},flex:1},{xtype:"gridcolumn",dataIndex:"notaInterna",text:traduci("AZIENDA_CICLO_ATTIVO"),editor:{xtype:"textfield",itemId:"editorAziendaCicloAttivo",reference:"editorAziendaCicloAttivo",maxLength:50,
enforceMaxLength:!0},flex:1}],viewConfig:{getRowClass:function(b,c,d,f){if(b&&"T"==b.get("stato"))return"non_attivi"},loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}],listeners:{}});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.OSPE_SRT_SERV",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this.cbaConfig.params?this.cbaConfig.params.split(","):null;if(b){var c={};b.forEach(function(b){b=b.split("=");c[b[0]]=b[1]});c.scheda&&(this.cbaConfig.scheda=c.scheda);c.domanda&&(this.cbaConfig.domanda=c.domanda)}var d=this;Ext.applyIf(d,{items:[{xtype:"container",itemId:"container",reference:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",
itemId:"pnlTestata",reference:"pnlTestata",layout:{type:"vbox",align:"stretch"},flex:.3,minHeight:"E"==d.cbaConfig.scheda&&1==d.cbaConfig.domanda||"L"==d.cbaConfig.scheda&&0<=[1,2].indexOf(d.cbaConfig.domanda)?300:250,items:[{xtype:"gridpanel",itemId:"grid1",reference:"grid1",flex:1,store:Ext.create("GeneraliOSP.personalizzazioni.app.store.OSPE_SRT",{sorters:[{property:"stato",transform:function(b){return StdSipcar.coalesce(b,"F")}},{property:"descrizione",transform:function(b){return null==b?b:b.toLowerCase()}},
{property:"desFrequente",transform:function(b){return null==b?b:b.toLowerCase()}}]}),columns:[{xtype:"gridcolumn",renderer:function(b,c,d,k,l,n,p){"T"==b&&(c.tdCls="icon-deseleziona")},width:65,align:"center",dataIndex:"stato",text:"DISATTIVATO",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"},hidden:!(1==d.cbaConfig.domanda&&"E"==d.cbaConfig.scheda||3==d.cbaConfig.domanda&&"E"==d.cbaConfig.scheda||5==d.cbaConfig.domanda&&"E"==d.cbaConfig.scheda||1==d.cbaConfig.domanda&&"L"==d.cbaConfig.scheda||
2==d.cbaConfig.domanda&&"L"==d.cbaConfig.scheda||2==d.cbaConfig.domanda&&"H"==d.cbaConfig.scheda)},{xtype:"gridcolumn",dataIndex:"descrizione",text:"descrizione",flex:1,editor:{xtype:"textfield",allowBlank:5==d.cbaConfig.domanda&&"L"==d.cbaConfig.scheda,enforceMaxLength:!0,maxLength:50},align:"center",renderer:function(b,c,d,k,l,n,p){c.style="text-align:left !important";return b}},{xtype:"gridcolumn",dataIndex:"desFrequente",text:["M"].includes(d.cbaConfig.tipoServizio)?traduci("CODICE_BRANCA"):"descrizione",
flex:1,editor:{xtype:["M"].includes(d.cbaConfig.tipoServizio)?"numberfield":"textfield",allowBlank:!(5==d.cbaConfig.domanda&&"L"==d.cbaConfig.scheda),enforceMaxLength:!0,maxLength:["M"].includes(d.cbaConfig.tipoServizio)?2:200},align:"center",renderer:function(b,c,h,k,l,n,p){c.style="text-align:"+["M"].includes(d.cbaConfig.tipoServizio)?"center":"left !important";return b}},{xtype:"gridcolumn",dataIndex:"desEstesa",text:"Descrizione estesa",flex:1,editor:{xtype:"textfield",enforceMaxLength:!0,maxLength:200},
align:"center",renderer:function(b,c,d,k,l,n,p){c.style="text-align:left !important";return b}},{xtype:"gridcolumn",dataIndex:"notaInterna",text:["M","G"].includes(d.cbaConfig.tipoServizio)?traduci("CODICE_REGIONALE"):traduci("NOTE"),width:120,editor:{xtype:"textfield",enforceMaxLength:!0,maxLength:50},align:"center",renderer:function(b,c,d,k,l,n,p){c.style="text-align:right !important";return b}},{xtype:"gridcolumn",renderer:function(b,c,h,k,l,n,p){k=d.cbaConfig;c="L"==k.regioneServizio&&50!=getModuloAttivo();
h="T"==k.regioneServizio&&[13,14,15].includes(k.tipoFlusso);k="W"==k.regioneServizio&&43==getModuloAttivo();if(c||h||k)if(p=getColGrid(p,"gruppo"),p=p.getEditor().getStore?p.getEditor().getStore():!1,b&&p&&(p=trovaRecord(p,"codice",b)))return p.data.valore;return b},maxWidth:80,minWidth:80,width:80,defaultWidth:80,dataIndex:"gruppo",text:"GRUPPO",align:"center"},{xtype:"gridcolumn",align:"center",dataIndex:"associataA",width:120,text:"H"==d.cbaConfig.scheda&&"2"==d.cbaConfig.domanda?"SIGLAFOGLIOPRESENZE":
"ASSOCIATAA",editor:{xtype:"textfield",enforceMaxLength:!0,maxLength:3},renderer:function(b,c,h,k,l,n,p){c.style="text-align:left !important";if("H"==d.cbaConfig.scheda&&"2"==d.cbaConfig.domanda)return h.data.associataA?h.data.associataA:"";c=getColGrid(p,"associataA");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c){if("L"==d.cbaConfig.regioneServizio&&"CLASSIFICAZIONE_REG"==d.controller.tipoRisposta){c.clearFilter();var f=h.get("gruppo");c.filter({filterFn:function(b){return b.data.extra==
f}})}if(b=trovaRecord(c,"codice",b))return b.data.valore}}},{xtype:"gridcolumn",dataIndex:"giorniFranc",text:"G"==d.cbaConfig.tipoServizio?"CRITERIO_QUOTE":"LOMB_GGFRANCHIGIA_CLREGIO",renderer:function(b,c,h,k,l,n,p){if("G"==d.cbaConfig.tipoServizio){if(c=getColGrid(p,"giorniFranc"),c=c.getEditor().getStore?c.getEditor().getStore():!1,b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore}else return b},editor:{xtype:"numberfield",minValue:0,maxValue:365,allowDecimals:!1},hidden:!0},{text:"ICONA",
xtype:"gridcolumn",itemId:"iconAlunni",renderer:function(b,c,d,k,l,n,p){if(null!=d.data.idIcona)return'<img src="/cba/css/generali/images/attivita/'+d.data.idIcona+'.svg"/ style= "height:25px;">'},width:50,dataIndex:"idIcona",hidden:!0},{xtype:"gridcolumn",renderer:function(b,c,d,k,l,n,p){c=getColGrid(p,"raggruppamentoSov");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},dataIndex:"raggruppamentoSov",text:"DESCR_STAMPA",flex:1,align:"center"},
{xtype:"gridcolumn",align:"center",editor:{xtype:"textfield",enforceMaxLength:!0,maxLength:3},renderer:function(b,c,d,k,l,n,p){c.style="text-align:center !important";return b},dataIndex:"livEdu",text:"SIGLAFOGLIOPRESENZE",width:110},{xtype:"gridcolumn",renderer:function(b,c,d,k,l,n,p){c=getColGrid(p,"tipoUscita");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},dataIndex:"tipoUscita",text:"TIPO_USCITA",flex:1},{xtype:"gridcolumn",renderer:function(b,
c,h,k,l,n,p){if(7==d.cbaConfig.domanda&&"L"==d.cbaConfig.scheda)return c.style="text-align:center !important",b;if(b&&(b=trovaRecord(d.controller.storeClassInt,"codice",b)))return b.data.valore},dataIndex:"classInt",text:7==d.cbaConfig.domanda&&"L"==d.cbaConfig.scheda?"ORDINE":"CLASS_INTERNA",flex:7==d.cbaConfig.domanda&&"L"==d.config.cbaConfig?.2:1,align:"center"},{xtype:"gridcolumn",align:"center",renderer:function(b,c,d,k,l,n,p){c=getColGrid(p,"tipoSov");c=c.getEditor().getStore?c.getEditor().getStore():
!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},dataIndex:"tipoSov",minChars:1,text:"TIPO_QUOTA"},{xtype:"gridcolumn",renderer:function(b,c,d,k,l,n,p){c=getColGrid(p,"capitoloPensioni");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},hidden:!0,width:180,dataIndex:"capitoloPensioni",text:"CAPITOLO"},{xtype:"gridcolumn",renderer:function(b,c,d,k,l,n,p){return d.data.desArticolo},hidden:!0,width:180,dataIndex:"articoloPensioni",
text:"ARTICOLO"},{xtype:"gridcolumn",dataIndex:"classReg",text:"CLASS_REGIONALE",width:100,hidden:!0,align:"center",renderer:function(b,c,h,k,l,n,p){if(b&&d.controller.storeClassReg&&(b=trovaRecord(d.controller.storeClassReg,"codice",b)))return b.data.valore}},{xtype:"gridcolumn",dataIndex:"percRimbOsp",text:"VEN_PERC_RIMB_OSP",editor:{xtype:"numberfield",minValue:0,maxValue:100,allowDecimals:!1},width:100,hidden:!0},{xtype:"gridcolumn",renderer:function(b,c,d,k,l,n,p){return renderCheckColumn(c,
b)},width:140,align:"center",dataIndex:"esenzioneReddito",text:"ESCLUDI_DA_CALCOLO_PENSIONI",hidden:!0,editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}}],viewConfig:{getRowClass:function(b,c,d,k){if("T"==b.get("stato"))return"non_attivi"},loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",border:0,itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"tstNuovo",reference:"tstNuovo",iconCls:"icon-inserisciGriglia",
text:"Nuovo"},{xtype:"button",itemId:"tstElimina",reference:"tstElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"},{xtype:"button",itemId:"tstCopia",reference:"tstCopia",iconCls:"icon-copia",text:"COPIA",disabled:!0,tooltip:"MSG_FUNZIONALITA_CBA"},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",width:200,fieldLabel:"",emptyText:"CERCA"},{xtype:"tbspacer",flex:1},{xtype:"tbtext",itemId:"lblNoteTitolo",reference:"lblNoteTitolo",html:"LOMB_GGFRANCHIGIA_ANNUI: -",hidden:!0}]}]}]},{xtype:"container",
itemId:"cntDettaglio",reference:"cntDettaglio",layout:{type:"fit"},flex:.8,border:0,bodyBorder:!1,hidden:!0}]}]});d.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.app.view.TEANAPERS",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridMedici",reference:"GridMedici",store:Ext.create("GeneraliOSP.personalizzazioni.app.store.TEANAPERS"),columns:[{xtype:"gridcolumn",text:"MEDICO",dataIndex:"descrizione",flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:60,enforceMaxLength:!0}},{xtype:"gridcolumn",text:"CODICE_MEDICO",dataIndex:"codice",
flex:1,editor:{xtype:"textfield",maxLength:16,enforceMaxLength:!0}},{xtype:"gridcolumn",text:"COD_FISCALE",dataIndex:"codiceFiscale",flex:1,editor:{xtype:"textfield",maxLength:16,enforceMaxLength:!0}},{xtype:"gridcolumn",text:"EMAIL",dataIndex:"email",flex:1,editor:{xtype:"textfield",vtype:"email"}},{xtype:"gridcolumn",text:"TELEFONO",dataIndex:"telefono",flex:1,editor:{xtype:"textfield"}},{xtype:"gridcolumn",text:"TIPO_MEDICO",dataIndex:"specializzazione",flex:1,renderer:function(b,c,d){return d.get("desSpecializzazione")},
editor:{xtype:"combobox",displayField:"valore",queryMode:"local",valueField:"codice"}},{xtype:"gridcolumn",text:"NAZIONE",dataIndex:"nazione",flex:1,renderer:function(b,c,d){return d.get("desNazione")},editor:{xtype:"combobox",queryMode:"local",displayField:"valore",valueField:"codice"}},{xtype:"gridcolumn",text:"CITTA",dataIndex:"comune",flex:1,renderer:function(b,c,d){return d.get("desComune")},editor:{xtype:"combobox",queryMode:"remote",queryParam:"valore",displayField:"valore",valueField:"codice",
minChars:3,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[4] == 'T'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore}</div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")}},{xtype:"gridcolumn",text:"IND_INDIRIZZO",dataIndex:"indirizzo",flex:1,editor:{xtype:"textfield"}},{xtype:"gridcolumn",text:"ORGANIZZAZIONE",dataIndex:"idOrganizzazione",editor:{xtype:"checkbox",name:"idOrganizzazione",
inputValue:"T",uncheckedValue:"F"},renderer:function(b,c,d,f,g,h,k){b="check"+Ext.id();d=d.get("idOrganizzazione");d=Ext.isEmpty(d)?"check-disabled-gray":"checked";return"<span id="+b+">"+('<img style="display:block;height:16px;margin-left:32px;" \n\t\t\t\t\t\t\t\t\tsrc="/cba/generali/images/svg/others/'+d+'.svg"></img>')+"</span>"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",
itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",width:200,fieldLabel:"",emptyText:"CERCA"},"-",{xtype:"combobox",width:450,fieldLabel:"ACCORPA_CON",itemId:"CBSostituisci",reference:"CBSostituisci",labelClsExtra:"cbaLabel",name:"sostituisci",displayField:"valore",queryMode:"local",valueField:"codice",
store:Ext.create("GeneraliOSP.medicoCurante.store.Medici",{autoLoad:!1}),listeners:{afterrender:function(b){creaToolTipInfo(b,traduci("TOOLTIP_ACCORPA_MEDICO"))}}},{xtype:"button",itemId:"BtnSostituisci",reference:"BtnSostituisci",iconCls:"icon-elabora",text:"ACCORPA"}]}]}]});this.callParent(arguments)}});
Ext.define("Personalizzazioni.view.container",{extend:"Ext.container.Container",border:0,height:700,id:"containerPersonalizzazioni",itemId:"containerPersonalizzazioni",reference:"containerPersonalizzazioni",layout:{type:"fit"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,collapseDirection:"left",
title:"PERSONALIZZAZIONI"},{xtype:"panel",flex:1,border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"}}]}],listeners:{beforerender:{fn:this.onContainerBeforeRender,scope:this},destroy:function(){CBA.StdUtenti.clearMap()}}});this.callParent(arguments)},onContainerBeforeRender:function(b,c){var d=this,f=Ext.create("Ext.tree.Panel",{flex:1,store:Ext.create("Personalizzazioni.store.albero"),itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},
listeners:{itemappend:function(b,c){c.data.text=traduci(c.data.text)},beforeitemcontextmenu:function(b,c,d,f,g,q){return getPopupMenuTree(g,b)},itemclick:function(b,c,d,f,g,q){c.data.leaf||!1!==c.data.expanded||b.expand(c)},select:function(b,c,f,g){b=d.queryById("content");b.removeAll();c=c.data;if(c.leaf||c.forceOpen)f={},c.params&&(f=c.params[0]),f.permesso=c.permesso,f.text=c.text,f.idRecord=c.idRecord,f.idModulo=43,f.idOrganizzazione=Ext.isEmpty(c.idOrganizzazione)?getIdOrg():c.idOrganizzazione,
f.idEnte=CBA.parametriGenerali.codEntePwd,c.idServizio&&(f.idServizio=c.idServizio),"PERSONSTAMPE"==c.panelType?c=Ext.create("personStampe.view.Container",{cbaConfig:f,flex:1}):"PERSONMODFATT"==c.panelType?c=Ext.create("GeneraliOSP.modelliFattura.view.ModelliFattura",{cbaConfig:f,flex:1}):"IMP_SERVIZIO"==c.panelType?c=Ext.create("GeneraliOSP.personalizzazioni.view.ImpostazioniServizio",{cbaConfig:f,flex:1}):"COPERGENERALI"==c.panelType?c=Ext.create("GeneraliOSP.personalizzazioni.view.PersonOrganizzazione",
{cbaConfig:f,flex:1}):"GEORGANIZZAZIONI"==c.panelType?c=Ext.create("Generali.gestPwdNew.view.Organizzazioni",{cbaConfig:f,flex:1}):"PERSONETICHETTE"==c.panelType?(f.personalizzazioni=!0,c=Ext.create("GeneraliOSP.personalizzazioni.view.PersonEtichette",{cbaConfig:f,flex:1})):"PERSONESTRATTOCONTO"==c.panelType?c=Ext.create("GeneraliOSP.personalizzazioni.view.PersonEstrattoConto",{cbaConfig:f,flex:1}):"GEDOC_PERS"==c.panelType?(1024>=Ext.getBody().getViewSize().width&&d.down("#pnlPerson").collapse(),
c=Ext.create("Generali.docPerson.view.DocPerson",{cbaConfig:f,flex:1})):c="CPPERS_FE"==c.panelType?Ext.create("Generali.person_fe.view.MainPersonFE",{cbaConfig:f,flex:1}):"COSERVIZI"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.PersonServizi",{cbaConfig:f,flex:1}):"COPERCAMPIPERS"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.PersonCampiAnag",{cbaConfig:f,flex:1}):"OSCLASSVEN"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.OSCLASSVEN",{cbaConfig:f,flex:1}):
"PROFILAZIONI_ANAGRAFICA"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.PersonProfilazioneAnagrafica",{cbaConfig:f,flex:1}):"PROFILAZIONI_CLASSIFICAZIONI"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.PersonProfilazioneClassificazioni",{cbaConfig:f,flex:1}):"OSPE_SRT"==c.panelType||"TEANAPERS"==c.panelType||"COPERSONALIZZAZIONITE"==c.panelType||"OSPE_SRT_SERV"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.app.view."+c.panelType,{cbaConfig:f,flex:1}):"SEDI_REPARTI"==
c.panelType?Ext.create("Generali.sediReparti.view.SediReparti",{cbaConfig:f,flex:1,title:"sometitle"}):"STRUTTURE_OSPEDALIERE"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.StruttureOspedaliere",{cbaConfig:f,flex:1}):"RACCORDI_FR"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.PersonRaccordiFR",{cbaConfig:f,flex:1}):"EXPORTFT"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.PersonExportFT",{cbaConfig:f,flex:1}):"PERS_PAGOPA"==c.panelType?Ext.create("Generali.personPagoPA.view.PersonPagoPA",
{cbaConfig:f,flex:1}):"ASS_DISTRETTO_PAGANTESSN"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.AssociaDistrettoPagSsn",{cbaConfig:f,flex:1}):"LISTINI"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.Listini",{cbaConfig:f,flex:1}):"CRITERI_CALCOLO"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.CriteriCalcolo",{cbaConfig:f,flex:1}):"PORTALE_UTENTI"==c.panelType?Ext.create("GeneraliOSP.personalizzazioni.view.PersonPortaleUtenti",{cbaConfig:f,flex:1}):Ext.create("Personalizzazioni.view."+
c.panelType,{cbaConfig:f,flex:1}),b.add(c)}}});b.queryById("pnlPerson").add(f);var g=f.getStore();g.load({callback:function(b,c,d){d?g.root.expand():msgShowError("",c.getError())}});Localizer.localize(b)}});
Ext.define("GeneraliOSP.personalizzazioni.controller.AssociaDistrettoPagSsn",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridAssPagantiSsn",selector:this.selContainer+"#GridAssPagantiSsn"},{ref:"CbxPagante",selector:this.selContainer+"#CbxPagante"}]);this.control(this.selContainer+"#GridAssPagantiSsn",{beforeedit:this.beforeEditGrid,edit:this.editGrid})},beforeEditGrid:function(b,c,d){b.getEditor().getForm().findField("codFocl").bindStore(this.storeCLIFO)},
cancelEditGrid:function(b,c,d){this.aggiornaStore()},editGrid:function(b,c,d){var f=this;c=f.getGridAssPagantiSsn().getSelection()[0].data;b=b.getEditor().getForm().findField("codFocl").getValue();Ext.apply(c,{extra:c.idRacc+"#"+b});delete c.desPagante;delete c.idRacc;delete c.codFocl;Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/asl/assDistrPagante/save",method:"POST",async:!1,params:{idOrganizzazione:f.cbaConfig.idOrganizzazione,idServizio:f.cbaConfig.idServizio},jsonData:c,success:function(b){b=
Ext.JSON.decode(b.responseText);b.success?f.aggiornaStore():msgShowError("",b.message)}})},aggiornaStore:function(){var b=this.getGridAssPagantiSsn().getStore();ImpostaUrl([b]);b.load({params:{idServizio:this.cbaConfig.idServizio,codRegione:this.cbaConfig.regione,codAsl:this.cbaConfig.codAsl},callback:function(b,d,f){f||msgShowError("",d.getError())}})},trovaRecordCliFor:function(b){var c=trovaRecord(this.storeCLIFO,"codice",b);c&&(b=c.get("valore"));return b},onLaunch:function(){var b=this;b.personContabili=
getPersonContabili(b.cbaConfig.idOrganizzazione,new Date,!0,null);b.storeCLIFO=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/gen/ws/general/anfocl/cbox"},autoLoad:!1});b.storeCLIFO.load({params:{idOrganizzazione:b.cbaConfig.idOrganizzazione,tipoContabilita:b.personContabili.tipoContabilitaAbilitata,limit:0},callback:function(c,d,f){f?b.aggiornaStore():(msgAddError(messaggi,d.getError()),msgShow("",messaggi))}})},destroy:function(){eliminaStore(this.storeCLIFO);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.CriteriCalcolo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Criteri",selector:this.selContainer+"#Criteri"},{ref:"IdCriterio",selector:this.selContainer+"#IdCriterio"},{ref:"Container",selector:this.selContainer+"#Container"},{ref:"StoricoGrid",selector:this.selContainer+"#StoricoGrid"},{ref:"GridCosti",selector:this.selContainer+"#GridCosti"},
{ref:"CriteriForm",selector:this.selContainer+"#CriteriForm"},{ref:"NomeCriterio",selector:this.selContainer+"#NomeCriterio"},{ref:"CalcoloPrezzo",selector:this.selContainer+"#CalcoloPrezzo"},{ref:"CalcoloQuantita",selector:this.selContainer+"#CalcoloQuantita"},{ref:"detNuovo",selector:this.selContainer+"#detNuovo"},{ref:"detElimina",selector:this.selContainer+"#detElimina"},{ref:"boxBottoni",selector:this.selContainer+"#boxBottoni"}]);this.control(this.selContainer+"#StoricoGrid",{select:this.onStoricoGridItemClick});
this.control(this.selContainer+"#GridCosti",{beforeedit:this.onGridroweditingpluginBeforeEdit,edit:this.onGridroweditingpluginEdit,canceledit:this.onGridroweditingpluginCanceledit,validateedit:this.onGridroweditingpluginValidateedit});this.control(this.selContainer+"#detNuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#detElimina",{click:this.onButtonClickElimina})},onStoricoGridItemClick:function(b,c,d,f,g,h){this.impostaDati(c)},onButtonClickNuovo:function(b,c,d){b={idCriterioCalcolo:this.getIdCriterio().getValue()};
c=this.getGridCosti();controller_nuovoRecordGrid(b,c)},onButtonClickElimina:function(b,c,d){var f=this;b=this.getGridCosti();c=b.getSelectionModel().getSelection()[0];if(Ext.isEmpty(c))return msgShowWarning("ATTENZIONE","MSG_NO_RECORD_SELECTED"),!1;controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStoreCosti()})},onGridroweditingpluginBeforeEdit:function(b,c,d){if(!0===this.getGridCosti().getPlugin().editing)return!1;this.abilitaComponentiCriteri(!1)},onGridroweditingpluginCanceledit:function(b,
c,d){this.abilitaComponentiCriteri(!0);this.aggiornaStoreCosti()},onGridroweditingpluginEdit:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();controller_salvaRecord(d,c.record.data,!1,null,null,null,"id")?this.abilitaComponentiCriteri(!0):b.startEdit(c.record,0)},onGridroweditingpluginValidateedit:function(b,c,d){return msgShow("",[])},impostaDati:function(b){var c=this.getCriteriForm(),d=c.getForm();this.getStoricoGrid().setDisabled(!1);clearForm(c);b&&(d.loadRecord(b),
this.getIdCriterio().setValue(b.data.id),this.aggiornaStoreCosti())},nuovo:function(){var b=this.getCriteriForm();b.getForm();controller_nuovoRecord(b);b=this.getGridCosti();svuotaStore(b.getStore())},verificaCampiForm:function(){var b=[];this.getCriteriForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c={id:this.getIdCriterio().getValue(),descrizione:this.getNomeCriterio().getValue(),idCalcoloPrezzo:this.getCalcoloPrezzo().getValue(),
calcoloQuantita:this.getCalcoloQuantita().getValue(),idServizio:this.cbaConfig.idServizio};controller_salvaRecord(this.getCriteriForm(),c,b)},aggiornaStoreCosti:function(b){var c=this,d=c.getGridCosti().getStore();c.getCriteriForm().getForm();var f=this.getIdCriterio().getValue();f?(this.getDetNuovo().setDisabled(!1),this.getDetElimina().setDisabled(!1),d.getProxy().extraParams.idCriterioCalcolo=f,d.load({callback:function(f,h,k){k?Ext.isEmpty(f)||(f=trovaRecord(d,"id",b),h=c.getGridCosti(),h.getSelectionModel().deselectAll(),
h.getSelectionModel().select(f?[f]:0)):msgShowError("",h.getError())}})):svuotaStore(d);c.getGridCosti().setDisabled(!f)},abilitaComponentiCriteri:function(b){this.getDetNuovo().setDisabled(!b);this.getDetElimina().setDisabled(!b);this.getBoxBottoni().setDisabled(!b);this.abilitaPannelliEsterni(b);this.getCriteriForm().getForm().getFields().each(function(c){c.setDisabled(!b)})},setTitle:function(b){this.getCriteri().setTitle(b)},aggiornaStore:function(b){var c=this;if(this.getBoxBottoni().isDisabled())return c.aggiornaStoreCosti(b),
!1;var d=c.getStoricoGrid().getStore(),f=c.getCriteriForm();f.getForm();clearForm(f);d.getProxy().extraParams={idServizio:c.cbaConfig.idServizio};d.load({callback:function(f,h,k){k?Ext.isEmpty(f)?c.aggiornaStoreCosti():(b||(b=c.getIdCriterio().getValue()),f=trovaRecord(d,"id",b),h=c.getStoricoGrid(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(f?[f]:0)):msgShowError("",h.getError())}})},abilitaPannelliEsterni:function(b){this.getStoricoGrid().setDisabled(!b);this.cbaConfig.ctrlPerson?
this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},onLaunch:function(){var b=this;b.getContainer().controller=b;var c=b.cbaConfig.params?b.cbaConfig.params.split(","):null;c&&traduci(c[0].substr(c[0].indexOf("=")+1));var d=b.getCriteriForm();d.permesso=b.cbaConfig.permesso;d.boxBottoni=b.getBoxBottoni();d.store=b.getStoricoGrid().getStore();d.controller=b;c=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=d.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(d.store,{id:c},function(){b.aggiornaStore()})},esci_callback:function(){var c=b.getContainer().up("window");controller_puoiUscire(c,b.getCriteriForm(),function(){b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});
inserisciBottoni(b.getBoxBottoni(),c);d.boxBottoni.queryById("btnEsci").setVisible(!1);b.getDetNuovo().setDisabled(!0);b.getDetElimina().setDisabled(!0);ImpostaUrl([b.getGridCosti().getStore(),b.getCalcoloPrezzo().getStore()]);b.getCalcoloPrezzo().getStore().load({params:{idOrganizzazione:b.cbaConfig.idOrganizzazione,idServizio:b.cbaConfig.idServizio}});b.aggiornaStore();if("L"!=b.cbaConfig.permesso)b.getCriteriForm().getForm().on("dirtychange",function(c,d){controller_abilitaBottoni(b.getCriteriForm());
b.getStoricoGrid().setDisabled(d);b.getGridCosti().setDisabled(d||0===b.getStoricoGrid().getStore().getCount());b.abilitaPannelliEsterni(!d)});c=b.getContainer().up("window");Localizer.localize(c);"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getCriteriForm()),controller_bottoniSolaLettura(b.getBoxBottoni()),this.getDetNuovo().setDisabled(!0),this.getDetElimina().setDisabled(!0))},caricaStore:function(b,c){c=void 0===c?{}:c;return new Promise(function(d,f){b.load({params:c,callback:function(b,
c,k){k?d(b):f(c)}})})}});
Ext.define("GeneraliOSP.personalizzazioni.controller.CuServiziAbilitaFlussi",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GrigliaFlussi",selector:this.selContainer+"#GrigliaFlussi"},{ref:"BtnSblocca",selector:this.selContainer+"#BtnSblocca"},{ref:"LblSblocco",selector:this.selContainer+"#LblSblocco"}]);this.control(this.selContainer+"#BtnSblocca",{click:this.btnSbloccaClick});this.control(this.selContainer+
"#GrigliaFlussi",{beforeedit:this.beforeeditGriglia,edit:this.editGriglia,canceledit:this.canceleditGriglia,validateedit:this.validateeditGriglia})},btnSbloccaClick:function(){var b=this;Ext.widget("passwordCBA",{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(c){c&&(b.abilitaModificaRecord=!0,c=b.getBtnSblocca(),c.setDisabled(!0),c.setIconCls("icon-unlocked"),c=b.getLblSblocco(),c.setText(traduci("SBLOCCO_EFFETTUATO")),c.addCls("cbaLabelDatiUtente"))}}).show()},beforeeditGriglia:function(b,
c,d){!0===!this.abilitaModificaRecord&&msgShowWarning("",this.getLblSblocco().text);return!0===this.abilitaModificaRecord},editGriglia:function(b,c,d){d=b.getEditor().getForm();var f=c.record.data;d.controller=this;d.store=c.view.getStore();f.tipoStato=getBoolValue(f.tipoStato);controller_salvaRecord(d,f,!1,null,null,null,"risposta")||b.startEdit(e.record,0)},canceleditGriglia:function(b,c,d){this.aggiornaStore(c.record.get("id"))},validateeditGriglia:function(b,c,d){return msgShow("",[])},aggiornaStore:function(b){var c=
this.getGrigliaFlussi();c.getStore().load({params:{scheda:"S",domanda:1,codSede:this.cbaConfig.idOrganizzazione},callback:function(d,f,g){g?d&&(d=!1,b&&(d=trovaRecord(c.getStore(),"risposta",b)),d?c.getSelectionModel().select([d]):c.getSelectionModel().select(0)):msgShowError("",f.getError())}})},svuotaStore:function(){svuotaStore(this.getGriglia().getStore())},onLaunch:function(){ImpostaUrl([this.getGrigliaFlussi().getStore()]);this.aggiornaStore()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.CuServiziCopia",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridServizi",selector:this.selContainer+"#GridServizi"},{ref:"BtnSblocca",selector:this.selContainer+"#BtnSblocca"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"}]);this.control(this.selContainer+"#BtnSblocca",{click:this.btnSbloccaClick});this.control(this.selContainer+
"#BtnElabora",{click:this.btnELaboraClick})},btnELaboraClick:function(){var b=[];Ext.each(this.getGridServizi().getStore().data.items,function(c){c.get("checked")&&b.push(c.get("codice"))});if(0==b.length)return msgShowWarning("","MSG_NO_SERVICE_SELECTED"),!1;b=b.toString();Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/servizi/copyItems",async:!1,params:{scheda:this.cbaConfig.scheda,domanda:this.cbaConfig.domanda,idServizio:this.cbaConfig.idServizio,idOrganizzazione:this.cbaConfig.idOrganizzazione,
servicesToCopy:b},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?msgShow("",b.message):msgShowWarning("",b.data)}})},btnSbloccaClick:function(){var b=this;Ext.widget("passwordCBA",{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(c){c&&(b.aggiornaStore(),b.getBtnElabora().setDisabled(!1),c=b.getBtnSblocca(),c.setDisabled(!0),c.setIconCls("icon-unlocked"))}}).show()},aggiornaStore:function(){var b=this;b.getGridServizi().getStore().load({params:{type:b.cbaConfig.tipoServizio,
filtroServizi:"T",groupByOrg:"T"},callback:function(c,d,f){f?c&&c.forEach(function(c){c.get("codice")==b.cbaConfig.idServizio&&b.getGridServizi().getStore().remove(c)}):msgShowError("",d.getError())}})},svuotaStore:function(){svuotaStore(this.getGridServizi().getStore())},onLaunch:function(){ImpostaUrl([this.getGridServizi().getStore()])}});
Ext.define("GeneraliOSP.personalizzazioni.controller.ImpostazioniServizio",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"GridImpostazioni",selector:this.selContainer+"#GridImpostazioni"},{ref:"TabPanelImpServizio",selector:this.selContainer+
"#TabPanelImpServizio"},{ref:"CntImpGenerali",selector:this.selContainer+"#CntImpGenerali"},{ref:"CntImpProroghe",selector:this.selContainer+"#CntImpProroghe"},{ref:"CntImpListaAttesa",selector:this.selContainer+"#CntImpListaAttesa"},{ref:"btnSblocca",selector:this.selContainer+"#btnSblocca"},{ref:"btnNuovo",selector:this.selContainer+"#btnNuovo"},{ref:"CbUnitaOrganizzativa",selector:this.selContainer+"#CbUnitaOrganizzativa"}]);this.control(this.selContainer+"#TabPanelImpServizio",{tabchange:this.tabPanelImpServizioChange});
this.control(this.selContainer+"#GridImpostazioni",{select:this.selectGridImpostazioni})},tabPanelImpServizioChange:function(b,c,d,f){"TpImpGenerali"==c.getItemId()?this.getForm().boxBottoni.queryById("btnConferma").disabled&&this.getForm().boxBottoni.queryById("btnSblocca").disabled&&(this.getBoxBottoni().queryById("btnNuovo").enable(),this.getBoxBottoni().queryById("btnElimina").enable()):(this.getBoxBottoni().queryById("btnNuovo").disable(),this.getBoxBottoni().queryById("btnElimina").disable())},
selectGridImpostazioni:function(b,c){this.loadedData=!1;clearForm(this.getForm());this.getForm().loadRecord(c);this.loadedData=!0},nuovo:function(){var b=this.getForm();controller_nuovoRecord(b,!1,!1);b.getForm().setValues({modalitaIntZucchetti:0,gestioneStrutturaAssenza:"F",abilitaAccompagnatore:"F",abilitaTariffaRettaPers:"T"})},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow("",b);return 0==b.length?!0:!1},salvaForm:function(b){var c=
this.getForm();if(!this.verificaCampiForm())return!1;var d=c.getForm().getFieldValues();Ext.apply(d,{idOrganizzazione:this.cbaConfig.idOrganizzazione,idModulo:CBA.moduli.moduloAttivo,abilitaOraResidenziale:getBoolValue(d.abilitaOraResidenziale),prognosiProroghe:getBoolValue(d.prognosiProroghe),diagnosiIcd9:getBoolValue(d.diagnosiIcd9),diagnosiIngresso:getBoolValue(d.diagnosiIngresso),indennitaAccompagnamento:getBoolValue(d.indennitaAccompagnamento),infoAggiuntive:getBoolValue(d.infoAggiuntive),iniziativaRichiesta:getBoolValue(d.iniziativaRichiesta),
medicoAccettante:getBoolValue(d.medicoAccettante),medicoInviante:getBoolValue(d.medicoInviante),medicoGenerale:getBoolValue(d.medicoGenerale),motivazioneIngresso:getBoolValue(d.motivazioneIngresso),onereDegenza:getBoolValue(d.onereDegenza),percentualeInvalidita:getBoolValue(d.percentualeInvalidita),prognosiProroghe:getBoolValue(d.prognosiProroghe),regimeRicovero:getBoolValue(d.regimeRicovero),situazioneDomicilio:getBoolValue(d.situazioneDomicilio),situazioneRilevazione:getBoolValue(d.situazioneRilevazione),
tipoProvenienza:getBoolValue(d.tipoProvenienza),tipoRicovero:getBoolValue(d.tipoRicovero),accessoPrevisto:getBoolValue(d.accessoPrevisto),gestioneStrutturaAssenza:getBoolValue(d.gestioneStrutturaAssenza),abilitaAccompagnatore:getBoolValue(d.abilitaAccompagnatore),abilitaTariffaRettaPers:getBoolValue(d.abilitaTariffaRettaPers),giorniPrognosi:getBoolValue(d.giorniPrognosi)});controller_salvaRecord(c,d,b)&&b&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var b=this,c=b.getForm();b.storeForm=
c.store=b.getGridImpostazioni().getStore();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var d=c.getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,{id:d},function(){b.aggiornaStore()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});
d.add({xtype:"button",cls:"cba-button-25",iconCls:"icon-locked",text:"SBLOCCA",tooltip:"SBLOCCA",itemId:"btnSblocca",reference:"btnSblocca",margin:"3 0 0 0",disabled:!0,handler:function(c){b.btnSbloccaClick(c)}});inserisciBottoni(c.boxBottoni,d);c.boxBottoni.queryById("btnEsci").hide();c.boxBottoni.queryById("btnNuovo").disable();c.boxBottoni.queryById("btnElimina").disable();containerSolaLettura(c,!0);if("S"==c.permesso)c.getForm().on("dirtychange",function(d,g){controller_abilitaBottoni(c);b.getGridImpostazioni().setDisabled(g)})},
btnSbloccaClick:function(b,c,d){var f=this;Ext.widget("passwordCBA",{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(c){c&&(containerSolaLettura(f.getForm(),!1),b.disable(),b.isSbloccato=!0,f.getBoxBottoni().queryById("btnNuovo").enable(),f.getBoxBottoni().queryById("btnElimina").enable())}}).show()},aggiornaStore:function(b){var c=this,d=c.getForm(),f=d.store,g=d.boxBottoni.queryById("btnSblocca");f.load({params:{idOrganizzazione:c.cbaConfig.idOrganizzazione},callback:function(h,k,l){l?Ext.isEmpty(h)?
(clearForm(d),"S"==c.cbaConfig.permesso&&(g.disable(),g.isSbloccato=!0,d.boxBottoni.queryById("btnNuovo").enable(),d.boxBottoni.queryById("btnElimina").enable(),containerSolaLettura(d,!1))):(g.isSbloccato||g.enable(),b||(b=h[0].get("id")),h=trovaRecord(f,"id",b),k=c.getGridImpostazioni(),k.getSelectionModel().deselectAll(),k.getSelectionModel().select(h?[h]:0)):msgShowError("",k.getError())}})},onLaunch:function(){var b=this.getGridImpostazioni().getStore();storeUnitaOrganizzativa=this.getCbUnitaOrganizzativa().getStore();
ImpostaUrl([b,storeUnitaOrganizzativa]);this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.Listini",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Listini",selector:this.selContainer+"#Listini"},{ref:"IdListino",selector:this.selContainer+"#IdListino"},{ref:"Container",selector:this.selContainer+"#Container"},{ref:"StoricoGrid",selector:this.selContainer+"#StoricoGrid"},{ref:"GridPrestazioni",selector:this.selContainer+"#GridPrestazioni"},
{ref:"ListiniForm",selector:this.selContainer+"#ListiniForm"},{ref:"NomeListino",selector:this.selContainer+"#NomeListino"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"DataAl",selector:this.selContainer+"#DataAl"},{ref:"SoggettoConvenzionato",selector:this.selContainer+"#SoggettoConvenzionato"},{ref:"CriterioCalcolo",selector:this.selContainer+"#CriterioCalcolo"},{ref:"CriterioCalcoloInfo",selector:this.selContainer+"#CriterioCalcoloInfo"},{ref:"detNuovo",selector:this.selContainer+
"#detNuovo"},{ref:"detElimina",selector:this.selContainer+"#detElimina"},{ref:"boxBottoni",selector:this.selContainer+"#boxBottoni"}]);this.control(this.selContainer+"#StoricoGrid",{select:this.onStoricoGridItemClick});this.control(this.selContainer+"#GridPrestazioni",{beforeedit:this.onGridroweditingpluginBeforeEdit,edit:this.onGridroweditingpluginEdit,canceledit:this.onGridroweditingpluginCanceledit,validateedit:this.onGridroweditingpluginValidateedit});this.control(this.selContainer+"#detNuovo",
{click:this.onButtonClickNuovo});this.control(this.selContainer+"#detElimina",{click:this.onButtonClickElimina});this.control(this.selContainer+"#CriterioCalcoloInfo",{afterrender:this.criterioCalcoloInfoAfterrender})},criterioCalcoloInfoAfterrender:function(b,c){creaToolTip(b.getId(),"TESTO_INFO","",100,300,!1,!1)},onStoricoGridItemClick:function(b,c,d,f,g,h){this.impostaDati(c)},onButtonClickCopia:function(b,c,d){var f=this;Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/prszn/listini/copia",method:"GET",
params:{idListino:this.getIdListino().getValue()},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(f.aggiornaStore(),msgShow("MSG_SALVATAGGIO_DATI",b.message)):msgShowError("",b.message)}})},onButtonClickNuovo:function(b,c,d){b={idListino:this.getIdListino().getValue()};c=this.getGridPrestazioni();controller_nuovoRecordGrid(b,c)},onButtonClickElimina:function(b,c,d){var f=this;b=this.getGridPrestazioni();c=b.getSelectionModel().getSelection()[0];if(Ext.isEmpty(c))return msgShowWarning("ATTENZIONE",
"MSG_NO_RECORD_SELECTED"),!1;controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStorePrestazioni()})},onGridroweditingpluginBeforeEdit:function(b,c,d){if(!0===this.getGridPrestazioni().getPlugin().editing)return!1;this.abilitaComponentiListini(!1);b.getEditor().getForm().findField("idPrestazione").allowBlank=!1;b.getEditor().getForm().findField("idCriterioCalcolo").allowBlank=!0;b.getEditor().getForm().findField("cda").cbaConfig.idEsercizio=this.annoEsercizio;b.getEditor().getForm().findField("cda").cbaConfig.tipoContabilita=
this.tipoContabilitaAbilitata;b.getEditor().getForm().setValues({idConto:"",idCDA:"",cda:"",cda1:""})},onGridroweditingpluginCanceledit:function(b,c,d){this.abilitaComponentiListini(!0);this.aggiornaStorePrestazioni()},onGridroweditingpluginEdit:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();var f=c.record.data;f.idEsercizio=Ext.isEmpty(c.record.data.idEsercizio)?this.annoEsercizio:c.record.data.idEsercizio;f.idCDA=Ext.isEmpty(c.record.data.cda1)?c.record.data.idCDA:
c.record.data.cda1;delete f.cda1;delete f.cda;controller_salvaRecord(d,f,!1,null,null,null,"id")?this.abilitaComponentiListini(!0):b.startEdit(c.record,0)},onGridroweditingpluginValidateedit:function(b,c,d){return msgShow("",[])},impostaDati:function(b){var c=this.getListiniForm(),d=c.getForm();this.getStoricoGrid().setDisabled(!1);clearForm(c);b&&(d.loadRecord(b),this.getIdListino().setValue(b.data.id),this.aggiornaStorePrestazioni())},nuovo:function(){var b=this.getListiniForm(),c=b.getForm();controller_nuovoRecord(b);
c.findField("dal").setValue(new Date);b=this.getGridPrestazioni();svuotaStore(b.getStore())},verificaCampiForm:function(){var b=[];this.getListiniForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c={id:this.getIdListino().getValue(),descrizione:this.getNomeListino().getValue(),dal:this.getDataDal().getValue(),al:this.getDataAl().getValue(),idSoggettoConvenzionato:this.getSoggettoConvenzionato().getValue(),
idCriterioCalcolo:this.getCriterioCalcolo().getValue(),idServizio:this.cbaConfig.idServizio};controller_salvaRecord(this.getListiniForm(),c,b)},aggiornaStorePrestazioni:function(b){var c=this,d=c.getGridPrestazioni().getStore();c.getListiniForm().getForm();var f=this.getIdListino().getValue();f?(this.getDetNuovo().setDisabled(!1),this.getDetElimina().setDisabled(!1),d.getProxy().extraParams.idListino=f,d.load({callback:function(f,h,k){k?Ext.isEmpty(f)||(f=trovaRecord(d,"id",b),h=c.getGridPrestazioni(),
h.getSelectionModel().deselectAll(),h.getSelectionModel().select(f?[f]:0)):msgShowError("",h.getError())}})):svuotaStore(d);c.getGridPrestazioni().setDisabled(!f)},abilitaComponentiListini:function(b){this.getDetNuovo().setDisabled(!b);this.getDetElimina().setDisabled(!b);this.getBoxBottoni().setDisabled(!b);this.abilitaPannelliEsterni(b);this.getListiniForm().getForm().getFields().each(function(c){c.setDisabled(!b)})},setTitle:function(b){this.getListini().setTitle(b)},aggiornaStore:function(b){var c=
this;if(this.getBoxBottoni().isDisabled())return c.aggiornaStorePrestazioni(b),!1;var d=c.getStoricoGrid().getStore(),f=c.getListiniForm();f.getForm();clearForm(f);d.getProxy().extraParams={idServizio:c.cbaConfig.idServizio};d.load({callback:function(g,h,k){k?Ext.isEmpty(g)?c.aggiornaStorePrestazioni():(b||(b=c.getIdListino().getValue()),g=trovaRecord(d,"id",b),h=c.getStoricoGrid(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(g?[g]:0),f.boxBottoni.queryById("btnCopia").setDisabled(!1)):
msgShowError("",h.getError())}})},abilitaPannelliEsterni:function(b){this.getStoricoGrid().setDisabled(!b);this.cbaConfig.ctrlPerson?this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b):Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b)},onLaunch:function(){var b=this;b.getContainer().controller=b;var c=b.cbaConfig.params?b.cbaConfig.params.split(","):null;c&&traduci(c[0].substr(c[0].indexOf("=")+1));var d=b.getListiniForm();
d.permesso=b.cbaConfig.permesso;d.boxBottoni=b.getBoxBottoni();d.store=b.getStoricoGrid().getStore();d.controller=b;c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=d.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(d.store,{id:c},function(){b.aggiornaStore()})},esci_callback:function(){var c=
b.getContainer().up("window");controller_puoiUscire(c,b.getListiniForm(),function(){b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),c);d.boxBottoni.down("panel").insert(2,{xtype:"button",itemId:"btnCopia",reference:"btnCopia",text:traduci("COPIA"),cls:"cba-button-25",iconCls:"icon-copia",margin:"0 0 1 0",disabled:!0,handler:function(){b.onButtonClickCopia()}});d.boxBottoni.queryById("btnEsci").setVisible(!1);
b.getDetNuovo().setDisabled(!0);b.getDetElimina().setDisabled(!0);var f=b.getGridPrestazioni(),g=Ext.create("Generali.store.Conto"),c=Ext.create("Generali.store.AliquotaIva");storePrestazioni=Ext.create("CU.store.TipoSupplementiSconti");storeCriteri=Ext.create("Generali.data.StoreCodiceValore");storeCriteri.getProxy().urlGen="/ws/genOsp/prszn/criteri/cbox";ImpostaUrl([f.getStore(),storePrestazioni,storeCriteri]);editCombo(f,storePrestazioni,getColGrid(f,"idPrestazione"),!1,!0,300);editCombo(f,storeCriteri,
getColGrid(f,"idCriterioCalcolo"),!1,!0,300);b.getCriterioCalcolo().bindStore(Ext.create("Ext.data.ChainedStore",{source:storeCriteri}));var h=Ext.isEmpty(b.getDataDal().getValue())?new Date:b.getDataDal().getValue(),k=getPersonContabili(b.cbaConfig.idServizio,h,!1,null);b.annoEsercizio=4==k.tipoContabilitaAbilitata||5==k.tipoContabilitaAbilitata?getIdEsercizioByDate(b.cbaConfig.idOrganizzazione,h):h.getFullYear();b.tipoContabilitaAbilitata=k.tipoContabilitaAbilitata;h={};4==k.tipoContabilitaAbilitata||
5==k.tipoContabilitaAbilitata?(g.getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(h,{idOrganizzazione:b.cbaConfig.idOrganizzazione,idEsercizio:b.annoEsercizio})):(g.getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(h,{idOrganizzazione:b.cbaConfig.idOrganizzazione,anno:b.annoEsercizio}));editCombo(f,g,getColGrid(f,"idConto"),!1,!0,300);getColGrid(f,"idConto");editCombo(f,c,getColGrid(f,"idAliquotaIVA"),!1,!0,300);getColGrid(f,"cda").editor={xtype:"cdaGrid",annoData:"dal"};
f=StdUtenti.promiseLoadStore(storePrestazioni,{idServizio:b.cbaConfig.idServizio,tipo:"S"});k=StdUtenti.promiseLoadStore(storeCriteri,{idServizio:b.cbaConfig.idServizio});g=StdUtenti.promiseLoadStore(g,h);c=StdUtenti.promiseLoadStore(c);Promise.all([f,k,g,c]).then(function(c){b.aggiornaStore()})["catch"](function(b){return msgShowError("",b)});if("L"!=b.cbaConfig.permesso)b.getListiniForm().getForm().on("dirtychange",function(c,d){controller_abilitaBottoni(b.getListiniForm());b.getListiniForm().boxBottoni.queryById("btnCopia").setDisabled(d);
b.getStoricoGrid().setDisabled(d);b.getGridPrestazioni().setDisabled(d||0===b.getStoricoGrid().getStore().getCount());b.abilitaPannelliEsterni(!d)});c=b.getContainer().up("window");Localizer.localize(c);"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getListiniForm()),controller_bottoniSolaLettura(b.getBoxBottoni()),this.getDetNuovo().setDisabled(!0),this.getDetElimina().setDisabled(!0))}});
Ext.define("GeneraliOSP.personalizzazioni.controller.NumerazioneProtocollo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"fieldSetFormato",selector:this.selContainer+"#fieldSetFormato"},{ref:"numProtocolloAutomatico",selector:this.selContainer+"#numProtocolloAutomatico"},{ref:"NumProtocolloRipartiAnno",
selector:this.selContainer+"#NumProtocolloRipartiAnno"},{ref:"numProtocolloFormato",selector:this.selContainer+"#numProtocolloFormato"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"}]);this.control(this.selContainer+"#numProtocolloAutomatico",{change:this.onChangeProtocolloAutomatico});this.control(this.selContainer+"#NumProtocolloRipartiAnno",{change:this.onChangeNumProtocolloRipartiAnno})},onChangeNumProtocolloRipartiAnno:function(b,c,d,f){b="^([A]{1,4}-[S]{1}-[N]{1}|[S]{1}-[A]{1,4}-[N]{1}|[N]{1}-[S]{1}-[A]{1,4}|[A]{1,4}-[N]{1}-[S]{1}|[S]{1}-[N]{1}-[A]{1,4})$|^([S|N]{1}-[S|N]{1})$";
c&&(b="^([A]{1,4}[^A,S,N]{0,1}[S]{0,1}[^A,S,N]{0,1}[N]{1,10}|[S]{0,1}.{0,1}[A]{1,4}.{0,1}[N]{1,10}|[N]{1,10}.{0,1}[S]{0,1}.{0,1}[A]{1,4}|[A]{1,4}.{0,1}[N]{1,10}.{0,1}[S]{0,1}|[S]{0,1}.{0,1}[N]{1,10}.{0,1}[A]{1,4})$|^([S|N]{1}.{0,1}[S|N]{1})$");this.getNumProtocolloFormato().regex=new RegExp(b);this.getNumProtocolloFormato().validate()},onChangeProtocolloAutomatico:function(b,c,d,f){b=this.getFieldSetFormato();"S"==c.numProtocolloAutomatico?(b.setDisabled(!1),b.down("textfield").allowBlank=!1,b.down("textfield").validate()):
(b.setDisabled(!0),b.down("textfield").allowBlank=!0)},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salvaForm:function(b){var c=this.getForm(),d=c.getForm().getFieldValues();Ext.apply(d,{idOrganizzazione:this.cbaConfig.idOrganizzazione,numProtocolloRipartiOgniAnno:getBoolValue(d.numProtocolloRipartiOgniAnno)});controller_salvaRecord(c,d,b)&&b&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var b=this,
c=b.getForm();c.setTitle(traduci("NUMERAZIONE_PROTOCOLLO"));c.permesso=b.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=Ext.create("LA.person.store.Person");c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},annulla_callback:function(){b.aggiornaStore()},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(c.boxBottoni,d,!0,"start");c.boxBottoni.queryById("btnEsci").hide();
c.boxBottoni.queryById("btnNuovo").hide();c.boxBottoni.queryById("btnElimina").hide();if("L"!=c.permesso)c.getForm().on("dirtychange",function(b,d){controller_abilitaBottoni(c)});"L"==c.permesso&&containerSolaLettura(b.getContainer())},aggiornaStore:function(b){var c=this,d=c.getForm(),f=d.getForm();d.store.load({params:{idOrganizzazione:c.cbaConfig.idOrganizzazione},callback:function(b,h,k){k?Ext.isEmpty(b)?clearForm(d):(f.loadRecord(b[0]),c.onChangeNumProtocolloRipartiAnno(null,"T"==b[0].get("numProtocolloRipartiOgniAnno"))):
msgShowError("",h.getError())}})},onLaunch:function(){this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.OSCLASSVEN",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GrigliaTestata",selector:this.selContainer+"#GrigliaTestata"},{ref:"GrigliaDettaglio",selector:this.selContainer+"#GrigliaDettaglio"},{ref:"detNuovo",selector:this.selContainer+"#detNuovo"},{ref:"detElimina",selector:this.selContainer+"#detElimina"}]);this.control(this.selContainer+"#detNuovo",
{click:this.onButtonClickNuovo});this.control(this.selContainer+"#detElimina",{click:this.onButtonClickElimina});this.control(this.selContainer+"#GrigliaTestata",{select:this.onGrigliaTestataSelect});this.control(this.selContainer+"#GrigliaDettaglio",{beforeedit:this.beforeeditGrigliaDettaglio,edit:this.editGrigliaDettaglio,canceledit:this.canceleditGrigliaDettaglio,validateedit:this.validateeditGrigliaDettaglio})},onButtonClickNuovo:function(b,c,d){b=this.getGrigliaDettaglio();b.getStore();controller_nuovoRecordGrid({progr:null,
codEnte:101,codTestata:this.cbaConfig.idTest,dataDecorrenza:new Date,importo:0,quotaOspite:0,strutturaDest:0},b)},onButtonClickElimina:function(b,c,d){var f=this;b=f.getGrigliaDettaglio();c=f.getGrigliaDettaglio();d=b.getSelectionModel().getSelection()[0];c.getSelectionModel().getSelection();controller_eliminaRecord(b.getStore(),{id:d?d.get("progr"):0},function(){f.aggiornaStore()})},canceleditGrigliaDettaglio:function(b,c,d){},beforeeditGrigliaDettaglio:function(b,c,d){return!0===b.editing?!1:!0},
onGrigliaTestataSelect:function(b,c,d,f){this.cbaConfig.idTest=c.get("progr");this.aggiornaStore(c)},aggiornaStore:function(b){var c=null;Ext.isDefined(b)||(b=trovaRecord(this.getGrigliaTestata().getStore(),"progr",this.cbaConfig.idTest));c=b.get("progr");if(0<c){var d=this.getGrigliaDettaglio();d.getStore();d.setTitle(b.get("descr"));d.getStore().load({params:{codTestata:c},callback:function(b,c,h){h?Ext.isEmpty(b)||d.getSelectionModel().select(0):msgShowError("",c.getError())}})}},editGrigliaDettaglio:function(b,
c,d){d=c.record.getData();var f=b.getEditor().getForm();f.controller=this;f.store=c.view.getStore();controller_salvaRecord(f,d,!1)||b.startEdit(c.record,0)},validateeditGrigliaDettaglio:function(b,c,d){return msgShow("",[])},aggiornaTestata:function(b){var c=this,d=c.getGrigliaDettaglio().getStore();svuotaStore(d);c.getGrigliaTestata().getStore().load({callback:function(d,g,h){h?Ext.isEmpty(d)||(c.getGrigliaTestata().getSelectionModel().deselectAll(),c.getGrigliaTestata().getSelectionModel().select(d&&
b?[b]:0)):msgShowError("",g.getError())}})},svuotaStore:function(){svuotaStore(this.getGrigliaTestata().getStore());svuotaStore(this.getGrigliaDettaglio().getStore())},onLaunch:function(){ImpostaUrl([this.getGrigliaTestata().getStore(),this.getGrigliaDettaglio().getStore()]);this.aggiornaTestata()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonCampiAnag",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GrigliaAnagrafica",selector:this.selContainer+"#GrigliaAnagrafica"},{ref:"GrigliaServizi",selector:this.selContainer+"#GrigliaServizi"}]);this.control(this.selContainer+"#GrigliaAnagrafica",{beforeedit:this.beforeeditGrigliaAnagrafica,edit:this.editGrigliaAnagrafica,canceledit:this.canceleditGrigliaAnagrafica,
validateedit:this.validateeditGrigliaAnagrafica});this.control(this.selContainer+"#GrigliaServizi",{beforeedit:this.beforeeditGrigliaServizi,edit:this.editGrigliaServizi,canceledit:this.canceleditGrigliaServizi,validateedit:this.validateeditGrigliaServizi})},beforeeditGrigliaAnagrafica:function(b,c,d){c=this.getGrigliaAnagrafica().getSelectionModel().getSelection()[0].id;this.getGrigliaAnagrafica().getColumns()[2].getEditor(c-1,"").setRawValue(this.getGrigliaAnagrafica().getStore().data.items[c-1].get("stato"));
statoAnag=this.getGrigliaAnagrafica().getStore().data.items[c-1].get("stato");this.getGrigliaAnagrafica().getColumns()[3].getEditor(c-1,"").setRawValue(this.getGrigliaAnagrafica().getStore().data.items[c-1].get("tipocampo"));tipoAnag=this.getGrigliaAnagrafica().getStore().data.items[c-1].get("tipocampo");this.getGrigliaAnagrafica().getColumns()[2].getEditor(c-1,"").emptyText=this.getGrigliaAnagrafica().getStore().data.items[c-1].get("stato");this.getGrigliaAnagrafica().getColumns()[3].getEditor(c-
1,"").emptyText=this.getGrigliaAnagrafica().getStore().data.items[c-1].get("tipocampo");return!0===b.editing?!1:!0},editGrigliaAnagrafica:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();f.controller=this;f.store=c.view.getStore();null==statoAnag&&(statoAnag="F");null==tipoAnag&&(tipoAnag="1");statoAnag="Disabilitato"==statoAnag?"F":"Opzionale"==statoAnag?"O":"T";tipoAnag="Testo"==tipoAnag?1:"Numerico"==tipoAnag?2:3;null==d.stato&&(d.stato=statoAnag);null==d.tipocampo&&(d.tipocampo=
tipoAnag);d.numCampo=maxOrdineAnag;controller_salvaRecord(f,d,!1)||b.startEdit(c.record,0)},canceleditGrigliaAnagrafica:function(b,c,d){this.aggiornaStore(c.record.get("id"))},validateeditGrigliaAnagrafica:function(b,c,d){return msgShow("",[])},canceleditGrigliaServizi:function(b,c,d){this.aggiornaStore(c.record.get("id"))},beforeeditGrigliaServizi:function(b,c,d){c=this.getGrigliaServizi().getSelectionModel().getSelection()[0].id;this.getGrigliaServizi().getColumns()[2].getEditor(c-11,"").setRawValue(this.getGrigliaServizi().getStore().data.items[c-
11].get("stato"));statoServ=this.getGrigliaServizi().getStore().data.items[c-11].get("stato");this.getGrigliaServizi().getColumns()[3].getEditor(c-11,"").setRawValue(this.getGrigliaServizi().getStore().data.items[c-11].get("tipocampo"));tipoServ=this.getGrigliaServizi().getStore().data.items[c-11].get("tipocampo");this.getGrigliaServizi().getColumns()[2].getEditor(c-11,"").emptyText=this.getGrigliaServizi().getStore().data.items[c-11].get("stato");this.getGrigliaServizi().getColumns()[3].getEditor(c-
11,"").emptyText=this.getGrigliaServizi().getStore().data.items[c-11].get("tipocampo");return!0===b.editing?!1:!0},visualizzaCombo:function(b){b.stato="DISABILITATO"==b.stato?"F":"OPZIONALE"==b.stato?"O":"T";b.tipocampo="TESTO"==b.tipocampo?1:"NUMERICO"==b.tipocampo?2:3},editGrigliaServizi:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();f.controller=this;f.store=c.view.getStore();null==statoServ&&(statoServ="F");null==tipoServ&&(tipoServ="1");statoServ="Disabilitato"==statoServ?
"F":"Opzionale"==statoServ?"O":"T";tipoServ="Testo"==tipoServ?1:"Numerico"==tipoServ?2:3;null==d.stato&&(d.stato=statoServ);null==d.tipocampo&&(d.tipocampo=tipoServ);d.numCampo=maxOrdineServ;controller_salvaRecord(f,d,!1)||b.startEdit(c.record,0)},validateeditGrigliaServizi:function(b,c,d){return msgShow("",[])},aggiornaStore:function(b){var c=this,d=c.getGrigliaServizi().getStore();svuotaStore(d);b="undefined"!=typeof c.cbaConfig.idServizio?c.cbaConfig.idServizio:1;c.getGrigliaAnagrafica().getStore().load({params:{idOrganizzazione:b},
callback:function(b,g,h){h?Ext.isEmpty(b)||(Ext.suspendLayouts(),maxOrdineAnag=0,maxOrdineServ=10,Ext.each(b,function(b){maxOrdineAnag<=b.data.numCampo&&10>b.data.numCampo?maxOrdineAnag=b.data.numCampo+1:maxOrdineServ<=b.data.numCampo&&(maxOrdineServ=b.data.numCampo+1)}),Ext.each(b,function(b){b.data.stato="F"==b.data.stato?traduci("DISABILITATO"):"O"==b.data.stato?traduci("OPZIONALE"):traduci("OBBLIGATORIO");b.data.tipocampo=1==b.data.tipocampo?traduci("TESTO"):2==b.data.tipocampo?traduci("NUMERICO"):
traduci("DATA/ORA");c.getGrigliaAnagrafica().getStore().remove(b);c.getGrigliaAnagrafica().getStore().add(b);10<=b.data.numCampo&&(d.add(b),c.getGrigliaAnagrafica().getStore().remove(b));10<b.data.numCampo&&(b.data.numCampo-=10);c.getGrigliaServizi().getView().refresh()}),Ext.resumeLayouts()):msgShowError("",g.getError())}})},svuotaStore:function(){svuotaStore(this.getGrigliaAnagrafica().getStore());svuotaStore(this.getGrigliaServizi().getStore())},onLaunch:function(){ImpostaUrl([this.getGrigliaAnagrafica().getStore(),
this.getGrigliaServizi().getStore()]);this.aggiornaStore()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonEstrattoConto",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"PnlTestata",selector:this.selContainer+"#PnlTestata"},{ref:"GridTestata",selector:this.selContainer+"#GridTestata"},{ref:"PnlDettaglio",selector:this.selContainer+"#PnlDettaglio"},{ref:"GridDettaglio",selector:this.selContainer+"#GridDettaglio"},{ref:"nuovo",selector:this.selContainer+
"#nuovo"},{ref:"elimina",selector:this.selContainer+"#elimina"},{ref:"detNuovo",selector:this.selContainer+"#detNuovo"},{ref:"detElimina",selector:this.selContainer+"#detElimina"}]);this.control(this.selContainer+"#GridTestata",{select:this.onGridTestataSelect,edit:this.onGridTestataEdit,canceledit:this.onGridTestataCancelEdit,validateedit:this.onGridTestataValidateEdit});this.control(this.selContainer+"#nuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#elimina",{click:this.onButtonClickElimina});
this.control(this.selContainer+"#GridDettaglio",{beforeedit:this.onGridDettaglioBeforeEdit,edit:this.onGridDettaglioEdit,canceledit:this.onGridDettaglioCancelEdit,validateedit:this.onGridDettaglioValidateEdit});this.control(this.selContainer+"#detNuovo",{click:this.onButtonClickNuovoDettaglio});this.control(this.selContainer+"#detElimina",{click:this.onButtonClickEliminaDettaglio})},abilitaComponenti:function(b,c){"L"!=this.cbaConfig.permesso&&(this.getNuovo().setDisabled(!b),this.getElimina().setDisabled(!b),
this.getDetNuovo().setDisabled(!b),this.getDetElimina().setDisabled(!b),"TE"==c?this.getGridDettaglio().setDisabled(!b):this.getGridTestata().setDisabled(!b),Ext.getCmp("containerPersonalizzazioni").queryById("pnlPerson").setDisabled(!b))},onGridTestataSelect:function(b,c,d,f){this.personContabili=getPersonContabili(this.cbaConfig.idOrganizzazione,c.get("dataDal"),!0,null);b=c.get("id");0<b&&(this.getPnlDettaglio().setTitle(c.get("descrizione")),this.reloadStoresCombo(c.get("dataDal")),this.getGridDettaglio().getStore().getProxy().extraParams.idTestata=
b,this.aggiornaStoreDettaglio())},onGridTestataCancelEdit:function(b,c,d){this.aggiornaStore(c.record.data.id)},onGridTestataEdit:function(b,c,d){d=b.getEditor().getForm();var f=c.record.data;d.controller=this;d.store=c.view.getStore();f.applicaFiltro=getBoolValue(f.applicaFiltro);f.idEsercizio=this.personContabili.idEsercizio;f.tipoContabilita=this.personContabili.tipoContabilitaAbilitata;controller_salvaRecord(d,f,!1,{copiaDettagli:this.copiaDettagli})||b.startEdit(e.record,0)},onGridTestataValidateEdit:function(b,
c,d){},onButtonClickNuovo:function(b,c,d){var f=this;c=Ext.Date.clearTime(new Date);b=f.getGridTestata().getStore().getAt(0);c={dataDal:c,descrizione:null,idOrganizzazione:f.cbaConfig.idOrganizzazione,applicaFiltro:null==b||"F"==b?"F":"T"};f.abilitaComponenti(!1,"TE");controller_nuovoRecordGrid(c,f.getGridTestata());svuotaStore(f.getGridDettaglio().getStore());f.copiaDettagli="F";null!=b&&Messaggio("ATTENZIONE","ESTRATTOCONTO_COPIADETTAGLI","YESNO","QUESTION",!1,function(){f.copiaDettagli="T"})},
onButtonClickElimina:function(b,c,d){var f=this;b=f.getGridTestata();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStore()})},aggiornaStore:function(b){var c=this,d=c.getGridTestata().getStore();d.load({params:{idOrg:c.cbaConfig.idOrganizzazione},callback:function(f,g,h){if(h){if(!Ext.isEmpty(f)){g=trovaRecord(d,"id",b);var k=c.getGridTestata();k.getSelectionModel().deselectAll();k.getSelectionModel().select(g?[g]:0)}c.copiaDettagli=
"F";c.abilitaComponenti(!0,"TE")}else msgShowError("",g.getError());h&&!Ext.isEmpty(f)?c.getPnlDettaglio().show():c.getPnlDettaglio().hide()}})},onButtonClickNuovoDettaglio:function(b,c,d){b=this.getGridDettaglio();this.abilitaComponenti(!1,"DE");controller_nuovoRecordGrid({},b)},onButtonClickEliminaDettaglio:function(b,c,d){var f=this;b=f.getGridDettaglio();c=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStoreDettaglio()})},
onGridDettaglioBeforeEdit:function(b,c,d){if(!0===this.getGridDettaglio().getPlugin().editing)return!1;b=b.editor.getForm();d=c.record.data;this.getGridTestata();this.getGridTestata().getSelectionModel().getSelection()[0].get("dataDal");d="T"===d.predefinito;this.predefinitoExist&&!d?c.grid.columns[0].field.disable():c.grid.columns[0].field.enable();b.setValues({tipoContabilita:this.personContabili.tipoContabilitaAbilitata})},onGridDettaglioCancelEdit:function(b,c,d){this.aggiornaStoreDettaglio(c.record.data.id)},
onGridDettaglioEdit:function(b,c,d){d=b.getEditor().getForm();var f=c.record.data,g=this.getGridTestata().getSelectionModel().getSelection()[0],h=g.get("id");d.controller=this;d.store=c.view.getStore();f.idPersEstrattoConto=h;f.predefinito=getBoolValue(f.predefinito);f.idOrganizzazione=g.get("idOrganizzazione");f.idEsercizio=g.get("idEsercizio");f.tipoContabilita=g.get("tipoContabilita");controller_salvaRecord(d,f,!1)||b.startEdit(e.record,0)},onGridDettaglioValidateEdit:function(b,c,d){c=[];b=b.getEditor().getForm();
Ext.isEmpty(b.findField("idCausale").getValue())&&Ext.isEmpty(b.findField("idConto").getValue())&&msgAddError(c,"ESTRATTOCONTO_DATIOBBLIGATORI");return msgShow("",c)},aggiornaStoreDettaglio:function(b){var c=this,d=c.getGridDettaglio().getStore(),f=this.getGridTestata().getSelectionModel().getSelection()[0];c.predefinitoExist=!1;d.load({params:{idPersEC:f.get("id"),idOrganizzazione:f.get("idOrganizzazione"),idEsercizio:f.get("idEsercizio"),tipoContabilita:f.get("tipoContabilita")},callback:function(f,
h,k){k?(Ext.isEmpty(f)||(h=trovaRecord(d,"id",b),k=c.getGridDettaglio(),k.getSelectionModel().deselectAll(),k.getSelectionModel().select(h?[h]:0),Ext.each(f,function(b){if("T"===b.data.predefinito)return c.predefinitoExist=!0,!1})),c.abilitaComponenti(!0,"DE")):msgShowError("",h.getError())}})},reloadStoresCombo:function(b){var c=this,d={},f=null!=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg(),g=this.getGridDettaglio(),h=getColGrid(g,"idConto"),g=getColGrid(g,"idCausale");
c.amm_2_0="4"==c.personContabili.tipoContabilitaAbilitata||5==c.personContabili.tipoContabilitaAbilitata;1<c.personContabili.tipoContabilitaAbilitata&&(c.amm_2_0?(h.field.getStore().getProxy().url="/cba/gen/ws/general/pianoDeiConti/leaf/cbox",Ext.apply(d,{idOrganizzazione:f,idEsercizio:c.personContabili.idEsercizio,soloPatrimoniali:"T"})):(h.field.getStore().getProxy().url="/cba/gen/ws/general/conto/src",Ext.apply(d,{idOrganizzazione:f,anno:b.getFullYear()})),h.field.getStore().load({params:d}),g.field.getStore().load({params:{tipoContabilita:c.personContabili.tipoContabilitaAbilitata,
tipoDocOspiti:2,idOrganizzazione:f},callback:function(b,d,f){f?this.filter({filterFn:function(b){return c.amm_2_0?"I"==b.data.extra.split(",")[2]?!0:!1:!0}}):msgShowError("",d.getError())}}))},onLaunch:function(){var b=this.getGridDettaglio(),c=Ext.create("Generali.store.Conto"),d=Ext.create("Generali.store.CausaleContabilita");"L"==this.cbaConfig.permesso&&(containerSolaLettura(this.getPnlTestata()),containerSolaLettura(this.getPnlDettaglio()));this.copiaDettagli="F";b.controller=this;editCombo(b,
c,getColGrid(b,"idConto"),!1,!0,300);getColGrid(b,"idConto").editor.minChars=3;editCombo(b,d,getColGrid(b,"idCausale"),!1,!0,300);getColGrid(b,"idCausale").editor.minChars=3;this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonEtichette",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"grigliaModelliEtichette",selector:this.selContainer+"#grigliaModelliEtichette"},{ref:"formEtichette",selector:this.selContainer+"#formEtichette"},{ref:"abilitaFormModifica",selector:this.selContainer+"#abilitaFormModifica"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},
{ref:"numEtichette",selector:this.selContainer+"#numEtichette"},{ref:"altezzaEtichetta",selector:this.selContainer+"#altezzaEtichetta"},{ref:"margineSuperiore",selector:this.selContainer+"#margineSuperiore"},{ref:"margineLaterale",selector:this.selContainer+"#margineLaterale"},{ref:"margineEtichettaOrizzontale",selector:this.selContainer+"#margineEtichettaOrizzontale"},{ref:"margineEtichettaVerticale",selector:this.selContainer+"#margineEtichettaVerticale"},{ref:"dimensioneCarattere",selector:this.selContainer+
"#dimensioneCarattere"},{ref:"rbIntestazioneUtente",selector:this.selContainer+"#rbIntestazioneUtente"},{ref:"btnNuovo",selector:this.selContainer+"#btnNuovo"},{ref:"btnElimina",selector:this.selContainer+"#btnElimina"},{ref:"btnSalva",selector:this.selContainer+"#btnSalva"},{ref:"btnAnnulla",selector:this.selContainer+"#btnAnnulla"}]);this.control(this.selContainer+"#abilitaFormModifica",{change:this.changeAbilitaFormModifica});this.control(this.selContainer+"#grigliaModelliEtichette",{select:this.selectGrid});
this.control(this.selContainer+"#formEtichette",{dirtychange:this.onDirtyChangeForm});this.control(this.selContainer+"#btnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#btnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#btnSalva",{click:this.clickBtnSalva});this.control(this.selContainer+"#btnAnnulla",{click:this.clickBtnAnnulla})},onDirtyChangeForm:function(){this.getBtnNuovo().setDisabled(!0);this.getBtnElimina().setDisabled(!0);this.getBtnSalva().setDisabled(!1);
this.getBtnAnnulla().setDisabled(!1)},changeAbilitaFormModifica:function(b,c){this.getFormEtichette().setDisabled(!c)},impostaDati:function(b){var c=this.getFormEtichette().getForm();c.loadRecord(b);c.reset()},selectGrid:function(b,c,d,f){this.impostaDati(c);this.abilitaNuovoElimina(!0)},clickBtnNuovo:function(){var b=this.getFormEtichette().getForm(),c=b.getValues();c.id=-9999;c.descrizione="";controller_nuovoRecord(this.getFormEtichette(),!1,!1);b.setValues(c);this.getBtnNuovo().setDisabled(!0);
this.getBtnElimina().setDisabled(!0);this.getBtnSalva().setDisabled(!1);this.getBtnAnnulla().setDisabled(!1)},checkImpostazione:function(b,c){b.isValid()&&!Ext.isEmpty(b.getValue())||msgAddError(c,b.fieldLabel+" "+b.getActiveError())},verificaImpostazioniEtichette:function(b){var c=[],d=!1;msgAddError(c,"MSG_ERRORI_TROVATI");this.checkImpostazione(this.getNumEtichette(),c);this.checkImpostazione(this.getAltezzaEtichetta(),c);this.checkImpostazione(this.getMargineSuperiore(),c);this.checkImpostazione(this.getMargineLaterale(),
c);this.checkImpostazione(this.getMargineEtichettaOrizzontale(),c);this.checkImpostazione(this.getMargineEtichettaVerticale(),c);this.checkImpostazione(this.getDimensioneCarattere(),c);1==c.length?d=!0:msgShow(b,c);return d},clickBtnSalva:function(){var b=this;if(!this.verificaImpostazioniEtichette())return!1;var c=b.getFormEtichette().getForm().getValues();Ext.isEmpty(c.idOrganizzazione)&&(c.idOrganizzazione=Ext.isEmpty(b.cbaConfig.idOrganizzazione)?getIdOrg():b.cbaConfig.idOrganizzazione);var d=
getUrlGen()+"/ws/genOsp/etichette/",d=0>c.id||Ext.isEmpty(c.id)?d+"new":d+"update";Ext.Ajax.request({method:"POST",url:d,jsonData:Ext.JSON.encode(c),writer:{type:"json"},success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success)b.aggiornaStoreGriglia(c.data.id),msgShow("",c.message);else return msgShowError("",c.message),!1}});return!0},clickBtnAnnulla:function(){var b=this.getGrigliaModelliEtichette();formEtichette=this.getFormEtichette().getForm();b=b.getSelection();b.length&&formEtichette.setValues(b[0].getData());
this.abilitaNuovoElimina(!0)},abilitaNuovoElimina:function(b){this.getGrigliaModelliEtichette();formEtichette=this.getFormEtichette().getForm();this.getBtnNuovo().setDisabled(!b||"L"==this.cbaConfig.permesso);this.getBtnElimina().setDisabled(!b||"L"==this.cbaConfig.permesso);this.getBtnSalva().setDisabled(b||"L"==this.cbaConfig.permesso);this.getBtnAnnulla().setDisabled(b||"L"==this.cbaConfig.permesso);formEtichette.reset();formEtichette.wasDirty=!1},clickBtnElimina:function(){var b=this,c=b.getGrigliaModelliEtichette(),
d=c.getSelection()[0];controller_eliminaRecord(c.getStore(),{id:d?d.get("id"):""},function(){b.aggiornaStoreGriglia()})},aggiornaStoreGriglia:function(b){var c=this,d=c.getFormEtichette(),f=c.getGrigliaModelliEtichette(),g=f.getStore();g.load({params:{idOrganizzazione:Ext.isEmpty(c.cbaConfig.idOrganizzazione)?getIdOrg():c.cbaConfig.idOrganizzazione},callback:function(h,k,l){if(null==c.getView())return!1;l?(Ext.isEmpty(h)?Ext.isEmpty(d.items)||clearForm(d):(h=b?trovaRecord(g,"id",b):h[0],f.setSelection(h),
c.impostaDati(h),c.abilitaNuovoElimina(!0)),Ext.isEmpty(d.items)||(d.getForm().reset(),d.getForm().wasDirty=!1)):msgShowError("",k.getError())}})},ricaricaTitle:function(b){this.getRbIntestazioneUtente().setVisible(1!=b)},onLaunch:function(){this.cbaConfig.personalizzazioni||(this.getFormEtichette().setDisabled(!0),this.cbaConfig.etichCtrl=this);var b=this.getGrigliaModelliEtichette().getStore().getProxy();b.url=getUrlGen()+"/ws/genOsp/etichette/list";b.api.read=getUrlGen()+"/ws/genOsp/etichette/list";
b.api.destroy=getUrlGen()+"/ws/genOsp/etichette/delete";this.aggiornaStoreGriglia()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonExportFT",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CmbTipoTracciato",selector:this.selContainer+"#CmbTipoTracciato"},{ref:"RbTipo",selector:this.selContainer+"#RbTipo"},{ref:"CmbCategoriaCliForSolco",selector:this.selContainer+"#CmbCategoriaCliForSolco"},{ref:"CntGridCodiciEsterni",selector:this.selContainer+"#CntGridCodiciEsterni"},
{ref:"GridCodiciEsterni",selector:this.selContainer+"#GridCodiciEsterni"},{ref:"CntRaccordo",selector:this.selContainer+"#CntRaccordo"},{ref:"CntRaccArtSolco",selector:this.selContainer+"#CntRaccArtSolco"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"GridParametriTracciatoSTD",selector:this.selContainer+"#GridParametriTracciatoSTD"},{ref:"BtnSalvaParametri",selector:this.selContainer+"#BtnSalvaParametri"},{ref:"Toolbar",
selector:this.selContainer+"#Toolbar"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BtnSblocca",selector:this.selContainer+"#BtnSblocca"}]);this.control(this.selContainer+"#CmbTipoTracciato",{change:this.changeCmbTipoTracciato});this.control(this.selContainer+"#RbTipo",{change:this.changeRbTipo});this.control(this.selContainer+"#GridCodiciEsterni",{select:this.selectGridCodiciEsterni,beforeedit:this.beforeeditGridCodiciEsterni,edit:this.editGridCodiciEsterni,canceledit:this.canceleditGridCodiciEsterni,
validateedit:this.validateeditGridCodiciEsterni});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#CmbCategoriaCliForSolco",{change:this.changeCmbCategoriaSolco});this.control(this.selContainer+"#BtnSalvaParametri",{click:this.salvaParametriTracciatoSTD});this.control(this.selContainer+"#BtnSblocca",{click:this.btnSbloccaClick})},btnSbloccaClick:function(){var b=this;Ext.widget("passwordCBA",
{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(c){c&&(b.getToolbar().hide(),containerSolaLettura(b.getCntGridCodiciEsterni(),!1),containerSolaLettura(b.getCntRaccordo(),!1))}}).show()},selectGridCodiciEsterni:function(b,c,d,f){c.get("id")&&this.fireEvent("CodiceCaricato",c.get("id"))},beforeeditGridCodiciEsterni:function(b,c,d){["CLIFO","REG"].includes(this.tipoDatoExt)&&(b=c.record.getData().descrizione,Ext.isEmpty(b)||(b=b.split("#SOLCO"),0<b.length&&!Ext.isEmpty(b[0])&&(c.record.data.descrizione=
b[0])))},validateeditGridCodiciEsterni:function(){},editGridCodiciEsterni:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();d.idOrganizzazione=this.idOrganizzazione;f.controller=this;f.store=c.view.getStore();if(["CLIFO","REG"].includes(this.tipoDatoExt)){var g=d.descrizione,h=g.split("#SOLCO");0<h.length&&!Ext.isEmpty(h[0])&&(g=h[0]);d.descrizione=g+"#SOLCO"+moment(moment.now()).format("YYYYMMDDHHmmss")}controller_salvaRecord(f,d,!1,{forzaRegistrazione:!1},null,null,"codice")?this.abilitaBtn(!0):
b.startEdit(c.record,0)},canceleditGridCodiciEsterni:function(b,c,d){this.aggiornaStore(c.record.get("codice"))},changeCmbTipoTracciato:function(b,c){var d=this.getRbTipo();containerSolaLettura(d,!1);this.getCntGridCodiciEsterni().show();7==c?(this.sistemaExt="ADHOC",this.getToolbar().show(),containerSolaLettura(this.getCntGridCodiciEsterni(),!0),containerSolaLettura(this.getCntRaccordo(),!0)):(this.getToolbar().hide(),this.sistemaExt="DEDFT",containerSolaLettura(this.getCntGridCodiciEsterni(),!1));
this.raccordo.controller.cbaConfig.tipotracciato=c;this.isStandardCBA=1==c;this.isSolco=4==c;this.isBolseq=3==c||5==c;this.isZhcAdHoc=7==c;this.isTeamSystem=8==c;this.isBPoint=9==c;var f=["DCPG","DCNG","DCAU","DIVA","DCDC"];this.isSolco&&(f="DCDC DCPG CLIFO REG VCR CTG".split(" "));this.isBolseq&&(f=3==c?"DCPG DCNG CLIFO DIVA REG VCR".split(" "):["DCPG","DCNG","DIVA","VCR","DCDC"]);this.isStandardCBA&&(f=["DCPG","DCNG","DIVA"],this.importaParametriTracciatoSTD());this.isZhcAdHoc&&(f="UDO CLA RMD RMA RSU RSC".split(" "));
this.isTeamSystem&&(f="DCPG DCNG DCAU CLIFO DIVA DCDC REG".split(" "));this.isBPoint&&(f=["DCNG","CLIFO","DCAU","DIVA","REG"]);this.getGridParametriTracciatoSTD().setVisible(this.isStandardCBA);f.includes("CLIFO")&&(this.personContabili=getPersonContabili(this.idOrganizzazione,new Date,!0,null),this.cbaConfig.tipoContabilitaAbilitata=this.personContabili.tipoContabilitaAbilitata);d.items.items.forEach(function(b){var c=b.config.inputValue;f?b.setHidden(!f.includes(c)):b.setHidden(!1)});!this.isSolco&&
!this.isBolseq||this.raccArtSolco||(this.raccArtSolco=this.getCntRaccArtSolco().add(Ext.create(this.getCntRaccArtSolco().cbaConfig.url,{cbaConfig:{idOrganizzazione:this.cbaConfig.idOrganizzazione,ctrlMain:this}})),this.raccordo.controller.loadStoreSolco());d.setValue({tipo:f[0]})},changeRbTipo:function(b,c){var d=this,f=d.getGridCodiciEsterni();f.getStore();f=f.down("#lblTitle");d.tipoDatoExt=c.tipo;var g=traduci("CODIFICA_ESTERNA"),h=d.getCmbTipoTracciato().getSelectedRecord();h&&(g+=" - "+h.get("valore"));
f.setHtml(g);d.getCntGridCodiciEsterni().setHidden(!1);d.isSolco||d.isBolseq?d.changeRbTipoSolco(b,c):((d.isStandardCBA||d.isZhcAdHoc)&&d.getGridCodiciEsterni().getColumns().forEach(function(b){"DCNG"==d.tipoDatoExt?"codice"===b.dataIndex?(b.setText(traduci("EXPORT_CONTO")),b.getEditor().allowBlank=!0,b.getEditor().validateValue(b.getEditor().getValue())):"descrizione"===b.dataIndex&&b.setText(traduci("EXPORT_MASTRO")):"codice"===b.dataIndex?(b.setText(traduci("CODICE")),b.getEditor().allowBlank=
!1,b.getEditor().validateValue(b.getEditor().getValue())):"descrizione"===b.dataIndex&&b.setText(traduci("DESCRIZIONE"))}),d.aggiornaStore())},changeRbTipoSolco:function(b,c){var d=this.getGridCodiciEsterni(),f=this.getCntRaccArtSolco(),g=this.getCntGridCodiciEsterni(),h="VCR"==this.tipoDatoExt||"CTG"==this.tipoDatoExt,k=this.getCmbCategoriaCliForSolco(),l=traduci("CODICE"),n=traduci("DESCRIZIONE");f.setHidden(!h);g.setHidden(h);h&&(svuotaStore(f.down("grid").getStore()),f.down("#lblTitleRacSolco").setHtml(b.getChecked()[1].boxLabel));
if("CLIFO"==this.tipoDatoExt||"REG"==this.tipoDatoExt)l=traduci("EXPORT_CONTO"),n=traduci("EXPORT_MASTRO");d.getColumns().forEach(function(b){"codice"===b.dataIndex?b.setText(l):"descrizione"===b.dataIndex&&b.setText(n)});k.setHidden("CTG"!=this.tipoDatoExt);k.allowBlank="CTG"!=this.tipoDatoExt;"VCR"==this.tipoDatoExt?this.raccArtSolco.getController().aggiornaStore():"CTG"==this.tipoDatoExt?(k.clearValue(),k.setEmptyText(traduci("seleziona")+" "+traduci("CATEGORIA")),k.validate(),k.focus(),this.storeCTG||
(this.storeCTG=Ext.create("Generali.catCliFor.store.cboxCatCliFor"),k.bindStore(this.storeCTG),this.storeCTG.load({params:{idOrganizzazione:this.cbaConfig.idOrganizzazione}}))):this.aggiornaStore()},changeCmbCategoriaSolco:function(b,c){var d=this.raccArtSolco.getController();c&&d.aggiornaStore()},aggiornaStore:function(b){var c=this,d=c.getGridCodiciEsterni(),f=d.getStore();c.impostaUrlByModAttivo(f,"tabelle/codificaExt/");svuotaStore(f);f.load({params:{tipoDatoExt:c.tipoDatoExt,sistemaExt:c.sistemaExt,
idOrganizzazione:c.cbaConfig.idOrganizzazione},callback:function(g,h,k){k&&(h=null,b?h=trovaRecord(f,"codice",b):0<g.length&&(h=g[0]),h&&d.getSelectionModel().select(h?[h]:0),c.raccordo.controller.svuotaStore())}})},abilitaBtn:function(b){this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b)},clickBtnNuovo:function(b){controller_nuovoRecordGrid({sistemaExt:this.sistemaExt,tipoDatoExt:this.tipoDatoExt,idOrganizzazione:this.idOrganizzazione},this.getGridCodiciEsterni())},clickBtnElimina:function(b){var c=
this;b=c.getGridCodiciEsterni();var d=b.getSelectionModel().getSelection()[0],d=d?d.get("id"):"";Ext.isEmpty(d)||controller_eliminaRecord(b.getStore(),{id:d},function(){c.aggiornaStore()})},loadData:function(){},loadCmbTracciatoExport:function(){var b=this;b.getCmbTipoTracciato().getStore().load({params:{idOrganizzazione:b.cbaConfig.idOrganizzazione},callback:function(c,d,f){f?1==c.length&&(c=c[0].get("codice"),b.getCmbTipoTracciato().setValue(c)):msgShowError("",d.getError())}})},salvaParametriTracciatoSTD:function(){var b=
this,c=b.getGridParametriTracciatoSTD(),d=[],f=[];Ext.each(c.getStore().getData().items,function(b){b.data.idOrganizzazione=getIdOrg();d.push(b.data)});0<d.length&&Messaggio("ATTENZIONE",traduci("CERTIF_SALVA_DATI_WARN"),"YESNO","QUESTION",!1,function(){newRecord={id:Ext.isDefined(b.idParametriTracciatoSTD)?b.idParametriTracciatoSTD:null,idOrganizzazione:getIdOrg(),idModulo:CBA.moduli.moduloAttivo,idFunzione:1,dati:window.btoa(encodeURIComponent(JSON.stringify(d))),data:new Date};Ext.Ajax.request({method:"POST",
url:"/cba/gen/ws/general/operator/dati/insertUpdate",jsonData:newRecord,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(msgAdd(f,b.message),msgShow("MSG_SALVATAGGIO_DATI",f)):msgShowError("",b.message)}})},function(){return!1})},importaParametriTracciatoSTD:function(){var b=this,c=b.getGridParametriTracciatoSTD(),d=c.getStore();Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/general/operator/dati/get",timeout:18E5,params:{idOrganizzazione:getIdOrg(),idModulo:CBA.moduli.moduloAttivo,
idFunzione:1},success:function(f){f=Ext.JSON.decode(f.responseText);if(f.success&&!Ext.isEmpty(f.data))b.idParametriTracciatoSTD=f.data.id,d.loadData(JSON.parse(decodeURIComponent(window.atob(f.data.dati))),!1),c.view.refresh();else if(f.success&&Ext.isEmpty(f.data)){f={idOrganizzazione:getIdOrg()};var g=[];g.push(f);c.getStore().loadData(g);c.getView().refresh();msgShowWarning("","EXPORT_PARAMETRI_KO")}else msgShowError("",f.message)}})},onLaunch:function(){var b=this,c=b.getRbTipo();b.idOrganizzazione=
b.cbaConfig.idOrganizzazione;b.loadCmbTracciatoExport();containerSolaLettura(c,!0);var d=b.getCntRaccordo().add(Ext.create(b.getCntRaccordo().cbaConfig.url,{cbaConfig:{idOrganizzazione:b.cbaConfig.idOrganizzazione,controllerPrincipale:this}}));b.raccordo=d;b.on("CodiceCaricato",function(c){b.getGridCodiciEsterni().getSelectionModel().getSelection()[0].getData();d.controller.caricaDati(b.getGridCodiciEsterni(),b.sistemaExt,b.tipoDatoExt,c)})},impostaUrlByModAttivo:function(b,c,d){null==c&&(c="tabelle/raccordoCodiciExt/");
var f;f=43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo?"/cba/osp/co/ws/genAmmIntgr/":"/cba/amm/cp/ws/integrazioni/";f+=c;d?b.getProxy().url=f:(b.getProxy().url=f+"list",b.getProxy().api={read:f+"list",create:f+"insert",update:f+"update",destroy:f+"delete"})}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonExportFTraccordo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.tipiRaccordi="DCPG DCNG DCAU DIVA DCDC CLIFO REG UDO RMD RMA RSU RSC CLA".split(" ");this.stores=[{codice:"DCPG",storeName:"Generali.condizionidipagamento.store.cboxCondPagamento",autoLoad:!0,impostaUrl:!1},{codice:"DCNG",storeName:"Generali.pianodeiconti.store.cboxContiIstituzionali",autoLoad:!1,
impostaUrl:!1},{codice:"DCAU",storeName:"GeneraliAM.store.CausaliContabili",autoLoad:!0,impostaUrl:!0},{codice:"DIVA",storeName:"Generali.aliquotaiva.store.cboxAliquotaIva",autoLoad:!0,impostaUrl:!1},{codice:"DCDC",storeName:"Generali.cda.store.CboxCda",autoLoad:!1,impostaUrl:!1},{codice:"CLIFO",storeName:"GeneraliOSP.store.FattListaPaganti",autoLoad:!1,impostaUrl:!1},{codice:"REG",storeName:"Generali.store.Registro",autoLoad:!1,impostaUrl:!1},{codice:"UDO",storeName:"GeneraliOSP.store.TipoServizio",
autoLoad:!1,impostaUrl:!0},{codice:"RMD",storeName:"GeneraliOSP.personalizzazioni.store.RaccordoZhc",autoLoad:!1,impostaUrl:!0},{codice:"RMA",storeName:"GeneraliOSP.personalizzazioni.store.RaccordoZhc",autoLoad:!1,impostaUrl:!0},{codice:"RSU",storeName:"GeneraliOSP.personalizzazioni.store.RaccordoZhc",autoLoad:!1,impostaUrl:!0},{codice:"RSC",storeName:"GeneraliOSP.personalizzazioni.store.RaccordoZhc",autoLoad:!1,impostaUrl:!0},{codice:"CLA",storeName:"GeneraliOSP.personalizzazioni.store.RaccordoZhc",
autoLoad:!1,impostaUrl:!0}];this.addRef([{ref:"GridRacc",selector:this.selContainer+"#GridRacc"},{ref:"BtnNuovoRacc",selector:this.selContainer+"#BtnNuovoRacc"},{ref:"BtnEliminaRacc",selector:this.selContainer+"#BtnEliminaRacc"}]);this.control(this.selContainer+"#GridRacc",{beforeedit:this.beforeeditGridRacc,edit:this.editGridRacc,canceledit:this.canceleditGridRacc,validateedit:this.validateeditGridRacc});this.control(this.selContainer+"#BtnNuovoRacc",{click:this.clickBtnNuovoRacc});this.control(this.selContainer+
"#BtnEliminaRacc",{click:this.clickBtnEliminaRacc})},clickBtnNuovoRacc:function(b){if(0==this.cbaConfig.controllerPrincipale.getGridCodiciEsterni().getStore().getTotalCount())return msgShowError("","Errore inserire prima una Codifica esterna"),!1;controller_nuovoRecordGrid({id:null,idCodiceExt:this.idCodiceExt,idEsercizio:this.idEsercizioDefault},this.getGridRacc())},clickBtnEliminaRacc:function(b){var c=this;b=c.getGridRacc();var d=b.getSelectionModel().getSelection()[0];controller_eliminaRecord(b.getStore(),
{id:d?d.get("id"):""},function(){c.aggiornaStore()})},beforeeditGridRacc:function(b,c,d){if(!0===b.editing)return!1;c=c.record.getData();d=b.getEditor().getForm();b=d.findField("idEsercizio");d=d.findField("idCodiceSipcar");["DCNG","DCDC","REG"].includes(this.tipoDatoExt)?(b.bindStore(this.storeEsercizio),c=c.idEsercizio,c!=this.idEsercizioDefault?this.loadStoreCboxByEsercizio(c):this.loadStoreCboxByEsercizio(this.idEsercizioDefault)):b.allowBlank=!0;if(this.tipiRaccordi.includes(this.tipoDatoExt))d.bindStore(this.currentStore);
else return msgShowError("","Errore raccordo ancora da configurare per tipoDatoExt:"+this.tipoDatoExt),!1;this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(b){this.getBtnNuovoRacc().setDisabled(!b);this.getBtnEliminaRacc().setDisabled(!b)},editGridRacc:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();d.idOrganizzazione=this.idOrganizzazione;f.controller=this;f.store=c.view.getStore();var g;g=43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo?"/cba/osp/co/ws/genAmmIntgr/":
"/cba/amm/cp/ws/integrazioni/";f.store.getProxy().url=g+"tabelle/raccordoCodiciExt/list";f.store.getProxy().api={read:g+"tabelle/raccordoCodiciExt/list",create:g+"tabelle/raccordoCodiciExt/insert",update:g+"tabelle/raccordoCodiciExt/update",destroy:g+"tabelle/raccordoCodiciExt/delete"};controller_salvaRecord(f,d,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):b.startEdit(c.record,0)},canceleditGridRacc:function(b,c,d){this.abilitaBottoniGrid(!0);this.aggiornaStore(c.record.get("id"))},validateeditGridRacc:function(b,
c,d){return msgShow("",[])},caricaDati:function(b,c,d,f){this.createStore(d,!0);this.grigliaPrincipale=b;this.sistemaExt=c;this.tipoDatoExt=d;this.idCodiceExt=f;b={};switch(d){case "DCAU":b={idOrganizzazione:this.idOrganizzazione,tipoCausale:this.cbaConfig.controllerPrincipale.isBPoint?"":"I"};break;case "UDO":b={idOrg:this.idOrganizzazione};break;case "RMD":b={scheda:"A",domanda:1,conDescrServizio:"T"};break;case "RMA":b={scheda:"H",domanda:2,conDescrServizio:"T"};break;case "RSU":b={scheda:"L",
domanda:1,conDescrServizio:"T"};break;case "RSC":b={scheda:"L",domanda:2,conDescrServizio:"T"};break;case "CLA":b={scheda:"E",domanda:1,conDescrServizio:"T"};break;case "REG":b={idOrganizzazione:this.idOrganizzazione,dataControllo:new Date,tipoDocumento:2};this.currentStore.getProxy().url="/cba/osp/co/ws/genAmmPers/registriIva/detail/cboxByDate";break;case "CLIFO":b={idOrganizzazione:this.idOrganizzazione,tipoContabilita:this.cbaConfig.controllerPrincipale.cbaConfig.tipoContabilitaAbilitata,limit:0}}this.currentStore.load({params:b});
this.svuotaStore();this.aggiornaStore()},getColumnByIndex:function(b){return this.getGridRacc().columns.find(function(c){return c.dataIndex==b})},aggiornaStore:function(b){var c=this.getGridRacc(),d=c.getStore(),f=this.getColumnByIndex("idEsercizio");["DCNG","DCDC","REG"].includes(this.tipoDatoExt)?f.setHidden(!1):f.setHidden(!0);var f="/cba/amm/cp/ws/integrazioni/",g="tabelle/raccordoCodiciExt/list";if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo)f="/cba/osp/co/ws/genAmmIntgr/","UDO RMD RMA RSU RSC CLA".split(" ").includes(this.tipoDatoExt)&&
(g="codificheUtenti/list");d.getProxy().url=f+g;d.getProxy().api={read:f+g,create:f+"tabelle/raccordoCodiciExt/insert",update:f+"tabelle/raccordoCodiciExt/update",destroy:f+"tabelle/raccordoCodiciExt/delete"};d.load({params:{idOrganizzazione:this.idOrganizzazione,tipoDatoExt:this.tipoDatoExt,sistemaExt:this.sistemaExt,idCodiceExt:this.idCodiceExt},callback:function(f,g,l){l?(f=0,b&&(f=trovaRecord(d,"id",b)),c.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}})},svuotaStore:function(){svuotaStore(this.getGridRacc().getStore())},
createStore:function(b,c){var d=(c=void 0===c?!1:c)?"currentStore":"store"+b;c&&this.currentStore?eliminaStore(this.currentStore):this[d]&&eliminaStore(this[d]);var f=this.stores.find(function(c){return c.codice==b});this[d]=Ext.create(f.storeName,{autoLoad:f.autoLoad});f.impostaUrl&&ImpostaUrl([this[d]])},loadStoreSolco:function(){this.createStore("CLIFO");this.createStore("REG");this.storeCLIFO.load({params:{idOrganizzazione:this.idOrganizzazione,tipoContabilita:this.cbaConfig.controllerPrincipale.cbaConfig.tipoContabilitaAbilitata,
limit:0}});this.storeREG.getProxy().url="/cba/osp/co/ws/genAmmPers/registriIva/detail/cboxByDate";this.storeREG.load({params:{idOrganizzazione:this.idOrganizzazione,dataControllo:new Date,tipoDocumento:2},callback:function(b,c,d){d||msgShowError("",c.getError())}})},loadStoreCboxByEsercizio:function(b){b||(b=this.idEsercizioDefault);this.storeDCNG.load({params:{idOrganizzazione:this.idOrganizzazione,idEsercizio:b}});this.storeDCDC.load({params:{idOrganizzazione:this.idOrganizzazione,idEsercizio:b},
callback:function(b,d,f){f||null==b&&msgShowError("","Errore nessun CDA impostato")}})},loadStoreRisposte:function(b){this.creaStore(b,!0)},onLaunch:function(){var b=this;b.idOrganizzazione=b.cbaConfig.idOrganizzazione?b.cbaConfig.idOrganizzazione:getIdOrg();b.storeDCNG=Ext.create("Generali.pianodeiconti.store.cboxContiIstituzionali",{autoLoad:!1});b.storeDCDC=Ext.create("Generali.cda.store.CboxCda",{autoLoad:!1});b.storeEsercizio=Ext.create("Generali.esercizioCont.store.cboxEsercizioCont",{autoload:!1});
b.storeRisposte=Ext.create("Generali.data.StoreCodiceValore",{autoLoad:!1,proxy:{urlGen:"/ws/genOsp/risposte/cbox"},autoDestroy:!1});b.storeEsercizio.load({params:{idOrganizzazione:b.idOrganizzazione}});getIdEsercizioDefaultByIdOrg(b.idOrganizzazione,function(c){b.idEsercizioDefault=c;b.loadStoreCboxByEsercizio(b.idEsercizioDefault)});b.getGridRacc().controller=b},destroy:function(){eliminaStore(this.currentStore);eliminaStore(this.storeDCNG);eliminaStore(this.storeDCDC);eliminaStore(this.storeCLIFO);
eliminaStore(this.storeREG);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonExportFTraccordoSolco",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridRaccSolco",selector:this.selContainer+"#GridRaccSolco"},{ref:"BtnConferma",selector:this.selContainer+"#BtnConferma"},{ref:"BtnRipristina",selector:this.selContainer+"#BtnRipristina"}]);this.control(this.selContainer+"#GridRaccSolco",{beforeedit:this.beforeeditGridRaccSolco,
edit:this.editGridRaccSolco,canceledit:this.canceleditGridRaccSolco,validateedit:this.validateeditGridRaccSolco})},beforeeditGridRaccSolco:function(b,c,d){if(!0===b.editing)return!1},abilitaBottoniGrid:function(b){},editGridRaccSolco:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm(),g=this.cbaConfig.ctrlMain,h=0,k={};f.controller=this;f.store=c.view.getStore();g.getCmbCategoriaCliForSolco().isVisible()&&(h=g.getCmbCategoriaCliForSolco().getValue());Ext.apply(k,{codCatFocl:h,idOrganizzazione:this.idOrganizzazione});
controller_salvaRecord(f,d,!1,k,null,null,"risposta")?this.abilitaBottoniGrid(!0):b.startEdit(c.record,0)},canceleditGridRaccSolco:function(b,c,d){this.abilitaBottoniGrid(!0);this.aggiornaStore(c.record.get("id"))},validateeditGridRaccSolco:function(b,c,d){return msgShow("",[])},getColumnByIndex:function(b){return col=this.getGridRaccSolco().columns.find(function(c){return c.dataIndex==b})},aggiornaStore:function(b){var c=this,d=c.cbaConfig.ctrlMain,f=c.getGridRaccSolco(),g=f.getStore(),h={idOrganizzazione:c.idOrganizzazione};
d.getCmbCategoriaCliForSolco().isVisible()&&(d=d.getCmbCategoriaCliForSolco().getValue(),Ext.apply(h,{codCatFocl:d?d:0}));g.load({params:h,callback:function(d,h,n){n?(d=0,b&&(d=trovaRecord(g,"risposta",b)),f.getSelectionModel().select(d?[d]:0)):msgShowError("",h.getError());c.abilitaBottoniGrid(!0)}})},svuotaStore:function(){svuotaStore(this.getGridRaccSolco().getStore())},onLaunch:function(){var b=this.cbaConfig.ctrlMain.getCmbTipoTracciato().getValue();this.idOrganizzazione=this.cbaConfig.idOrganizzazione?
this.cbaConfig.idOrganizzazione:getIdOrg();this.getGridRaccSolco().controller=this;this.getColumnByIndex("desFrequente").setHidden(3!=b)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonOrganizzazione",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"fieldSetFormato",selector:this.selContainer+"#fieldSetFormato"},{ref:"numFascicoloAutomatico",selector:this.selContainer+"#numFascicoloAutomatico"},{ref:"NumFascRipartiAnno",
selector:this.selContainer+"#NumFascRipartiAnno"},{ref:"numFascicoloFormato",selector:this.selContainer+"#numFascicoloFormato"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"}]);this.control(this.selContainer+"#numFascicoloAutomatico",{change:this.onChangeFascAutomatico});this.control(this.selContainer+"#NumFascRipartiAnno",{change:this.onChangeNumFascRipartiAnno})},onChangeNumFascRipartiAnno:function(b,c,d,f){b="^([A]{1,4}-[S]{1}-[N]{1}|[S]{1}-[A]{1,4}-[N]{1}|[N]{1}-[S]{1}-[A]{1,4}|[A]{1,4}-[N]{1}-[S]{1}|[S]{1}-[N]{1}-[A]{1,4})$|^([S|N]{1}-[S|N]{1})$";
c&&(b="^([A]{1,4}[^A,S,N]{0,1}[S]{0,1}[^A,S,N]{0,1}[N]{1,10}|[S]{0,1}.{0,1}[A]{1,4}.{0,1}[N]{1,10}|[N]{1,10}.{0,1}[S]{0,1}.{0,1}[A]{1,4}|[A]{1,4}.{0,1}[N]{1,10}.{0,1}[S]{0,1}|[S]{0,1}.{0,1}[N]{1,10}.{0,1}[A]{1,4})$|^([S|N]{1}.{0,1}[S|N]{1})$");this.getNumFascicoloFormato().regex=new RegExp(b);this.getNumFascicoloFormato().validate()},validaNumFascicoloFormato:function(){this.getNumFascicoloFormato().getValue()},onChangeFascAutomatico:function(b,c,d,f){b=this.getFieldSetFormato();"S"==c.numFascicoloAutomatico?
(b.setDisabled(!1),b.down("textfield").allowBlank=!1,b.down("textfield").validate()):(b.setDisabled(!0),b.down("textfield").allowBlank=!0)},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salvaForm:function(b){var c=this.getForm(),d=c.getForm().getFieldValues();Ext.apply(d,{idOrganizzazione:this.cbaConfig.idOrganizzazione,numFascicoloAutomatico:d.numFascicoloAutomatico,numFascicoloRipartiOgniAnno:getBoolValue(d.numFascicoloRipartiOgniAnno),
numFascicoloFormato:d.numFascicoloFormato});controller_salvaRecord(c,d,b)&&b&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var b=this,c=b.getForm();c.setTitle(traduci("GESTIONE_PERSONALIZZAZIONI")+" - "+b.cbaConfig.text);c.permesso=b.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=Ext.create("GeneraliOSP.personalizzazioni.store.PersonOrganizzazione");c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},
annulla_callback:function(){b.aggiornaStore()},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(c.boxBottoni,d,!0,"start");c.boxBottoni.queryById("btnEsci").hide();c.boxBottoni.queryById("btnNuovo").hide();c.boxBottoni.queryById("btnElimina").hide();if("L"!=c.permesso)c.getForm().on("dirtychange",function(b,d){controller_abilitaBottoni(c)});"L"==c.permesso&&containerSolaLettura(b.getContainer())},aggiornaStore:function(b){var c=this,d=c.getForm(),f=d.getForm();
d.store.load({params:{idOrg:c.cbaConfig.idOrganizzazione},callback:function(b,h,k){k?Ext.isEmpty(b)?clearForm(d):(f.loadRecord(b[0]),c.onChangeNumFascRipartiAnno(null,"T"==b[0].get("numFascicoloRipartiOgniAnno"))):msgShowError("",h.getError())}})},onLaunch:function(){this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonPortaleUtenti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnSblocca",selector:this.selContainer+"#BtnSblocca"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"PIva",selector:this.selContainer+"#PIva"},{ref:"CodiceDisambiguazione",selector:this.selContainer+"#CodiceDisambiguazione"},
{ref:"Descrizione",selector:this.selContainer+"#Descrizione"}])},btnSbloccaClick:function(b,c,d){var f=this;Ext.widget("passwordCBA",{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(c){c&&(containerSolaLettura(f.getForm(),!1),b.disable(),b.isSbloccato=!0,f.getBoxBottoni().queryById("btnConferma").enable(),f.getBoxBottoni().queryById("btnAnnulla").enable(),f.getPIva().setReadOnly(!0),""!=f.getCodiceDisambiguazione().getValue()&&f.getCodiceDisambiguazione().setReadOnly(!0))}}).show()},verificaCampiForm:function(){var b=
[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow("",b);return 0==b.length?!0:!1},salvaForm:function(b){var c=this.getForm();""!=this.getCodiceDisambiguazione().getValue()&&this.getCodiceDisambiguazione().setReadOnly(!0);var d=c.getForm().getFieldValues();Ext.apply(d,{idOrganizzazione:this.cbaConfig.idOrganizzazione,piva:d.piva,codiceDisambiguazione:d.codiceDisambiguazione,descrizione:d.descrizione});controller_salvaRecord(c,d,b)&&b&&this.callbackEsci&&this.callbackEsci()},
gestioneForm:function(){var b=this,c=b.getForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){b.aggiornaStore()},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});d.add({xtype:"button",cls:"cba-button-25",iconCls:"icon-locked",
text:"SBLOCCA",tooltip:"SBLOCCA",itemId:"btnSblocca",reference:"btnSblocca",margin:"3 0 0 0",disabled:!0,handler:function(c){b.btnSbloccaClick(c)}});inserisciBottoni(c.boxBottoni,d);c.boxBottoni.queryById("btnEsci").hide();c.boxBottoni.queryById("btnNuovo").hide();c.boxBottoni.queryById("btnElimina").hide();containerSolaLettura(c,!0);if("S"==c.permesso)c.on("dirtychange",function(b,d){controller_abilitaBottoni(c)})},nuovo:function(){},aggiornaStore:function(b){var c=this,d=c.getForm();b=d.store;var f=
d.boxBottoni.queryById("btnSblocca");b.load({params:{idOrganizzazione:c.cbaConfig.idOrganizzazione},callback:function(b,h,k){k?(Ext.isEmpty(b)?(clearForm(d),Ext.Ajax.request({method:"GET",params:{id:c.cbaConfig.idOrganizzazione},url:"/cba/gen/ws/general/org/get",success:function(b){b=Ext.JSON.decode(b.responseText);b.success&&(b=""==b.data.partitaIva?b.data.codiceFiscale:b.data.partitaIva,d.getForm().setValues({piva:b}))}})):d.loadRecord(b[0]),f.isSbloccato||f.enable()):msgShowError("",h.getError())}})},
onLaunch:function(){var b=Ext.create("GeneraliOSP.personalizzazioni.store.PersonPortaleUtenti");ImpostaUrl([b]);this.getForm().store=b;this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonProfilazioneAnagrafica",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Griglia",selector:this.selContainer+"#Griglia"},{ref:"BtnSblocca",selector:this.selContainer+"#BtnSblocca"},{ref:"LblSblocco",selector:this.selContainer+"#LblSblocco"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},
{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"BtnConvenzioneCom",selector:this.selContainer+"#BtnConvenzioneCom"}]);this.control(this.selContainer+"#Griglia",{beforeedit:this.onGridBeforeEdit,edit:this.onGridEdit,canceledit:this.onGridCancelEdit});this.control(this.selContainer+"#BtnSblocca",{click:this.btnSbloccaClick});this.control(this.selContainer+"#BtnNuovo",{click:this.onBtnNuovoClick});this.control(this.selContainer+"#BtnElimina",{click:this.onBtnEliminaClick});this.control(this.selContainer+
"#BtnConvenzioneCom",{click:this.onBtnConvenzioneComClick})},btnSbloccaClick:function(){var b=this;Ext.widget("passwordCBA",{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(c){c&&(b.abilitaModificaRecord=!0,sessionStorage.setItem("abilitaModificaProfiliCU2","true"),b.impostaEditComponents())}}).show()},impostaEditComponents:function(){this.getBtnSblocca().hide();this.getLblSblocco().hide();this.getBtnNuovo().show();this.getBtnElimina().show();this.getBtnConvenzioneCom().show()},onBtnConvenzioneComClick:function(b,
c,d){var f=this;Ext.create("winCBA",{name:"GeneraliOSP.personalizzazioni.app.view.OSPE_SRT",titolo:"CONVENZIONECOMMERCIALE",dimensione:1,configItem:{scheda:"V",domanda:"112",permesso:f.cbaConfig.permesso,idOrganizzazione:f.cbaConfig.idOrganizzazione,esci_callback:function(){f.storeConvenzione.reload()}},closable:!0}).show()},onBtnNuovoClick:function(b,c,d){b={id:null,idOrganizzazione:this.cbaConfig.idOrganizzazione};c=this.getGriglia();controller_nuovoRecordGrid(b,c)},onBtnEliminaClick:function(b,
c,d){var f=this;b=f.getGriglia();c=b.getSelectionModel().getSelection()[0];if(Ext.isEmpty(c))return msgShowWarning("ATTENZIONE","MSG_NO_RECORD_SELECTED"),!1;controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStore()})},onGridBeforeEdit:function(b,c,d){if(1!=this.abilitaModificaRecord||"S"!=this.cbaConfig.permesso)return!1;b=b.getEditor().getForm();var f=b.findField("livelloAssistenziale"),g=b.findField("regione");f.firstTime||(f.firstTime=!0,f.on("expand",function(b){b=
b.getStore();b.clearFilter();b.filterBy(function(b){return"LA"==b.get("extra")&&b.get("gruppo")&&b.get("gruppo").includes(g.getValue())})}),g.on("select",function(b){f.clearValue()}))},onGridCancelEdit:function(b,c,d){this.aggiornaStore()},onGridEdit:function(b,c,d){d=c.record.data;Ext.apply(d,{stato:getBoolValue(d.stato),convenzionatoFSR:getBoolValue(d.convenzionatoFSR)});if(""==d.descrizione){var f=c.grid.columns,g;for(g in f){var h=f[g],k=h.getEditor(),l="";"combobox"==k.xtype&&"regione"!=h.dataIndex&&
(l=k.getDisplayValue());""!=l&&(d.descrizione+=(""==d.descrizione?"":" - ")+l)}d.descrizione+=" - "+("T"===d.convenzionatoFSR?"Convenzionato":"Non Convenzionato")}controller_salvaRecord(this.getGriglia(),d,!1,null,null,null,"id")||b.startEdit(c.record,0)},aggiornaStore:function(b){var c=this,d=c.getGriglia(),f=d.getStore();f.load({params:{idOrganizzazione:c.cbaConfig.idOrganizzazione},callback:function(g,h,k){k?g&&(g=!1,b&&(g=trovaRecord(f,"id",b)),d.getSelectionModel().select(g?[record]:0),c.getBtnNuovo().setDisabled("L"==
c.cbaConfig.permesso),c.getBtnElimina().setDisabled("L"==c.cbaConfig.permesso)):msgShowError("",h.getError())}})},loadCombo:function(){var b=this.getGriglia().columns,c={},d;for(d in b){var f=b[d],g=f.getEditor();if("combobox"==g.xtype){c.tipo="";switch(f.dataIndex){case "tipologiaUtente":c.tipo="TU";break;case "formaAccreditamento":c.tipo="FA";break;case "livelloAssistenziale":c.tipo="LA";break;case "durata":c.tipo="DU";break;case "formaErogazione":this.storeServizi.sort("valore","ASC");g.bindStore(this.storeServizi);
break;case "convenzioneCommerciale":this.storeConvenzione.clearFilter(),this.storeConvenzione.filter({filterFn:function(b){return"T"==b.data.extra?!1:!0}}),g.bindStore(this.storeConvenzione)}""!=c.tipo&&(f=Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche}),f.filter({filterFn:function(b){return function(c){return c.data.extra==b.tipo?!0:!1}}(c)}),f.sort("valore","ASC"),g.bindStore(f))}c={tipo:c.tipo}}},onLaunch:function(){var b=this,c=sessionStorage.getItem("abilitaModificaProfiliCU2");
(this.abilitaModificaRecord=c&&"true"==c)&&this.impostaEditComponents();this.getBtnNuovo().setDisabled(!0);this.getBtnElimina().setDisabled(!0);this.storeServizi=Ext.create("GeneraliOSP.personalizzazioni.store.TipoServizio");ImpostaUrl([this.getGriglia().getStore(),this.storeServizi]);this.storeCodifiche=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/fr/codifiche/cbox"}});this.storeConvenzione=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/risposte/cbox"}});
var c=StdUtenti.promiseLoadStore(this.storeCodifiche,{tipoFlusso:18}),d=StdUtenti.promiseLoadStore(this.storeServizi,{tipiServizio:"R,S,D,M"}),f=StdUtenti.promiseLoadStore(this.storeConvenzione,{scheda:"V",domanda:112,idOrganizzazione:this.cbaConfig.idOrganizzazione});Promise.all([c,d,f]).then(function(c){b.loadCombo()})["catch"](function(b){return msgShowError("",b)});this.aggiornaStore();this.cbaConfig.permesso=this.cbaConfig&&this.cbaConfig.permesso?this.cbaConfig.permesso:"L";"L"==this.cbaConfig.permesso&&
(containerSolaLettura(this.getContainer()),this.getBtnNuovo().setDisabled(!0),this.getBtnElimina().setDisabled(!0))},destroy:function(){eliminaStore(this.storeServizi);eliminaStore(this.storeCodifiche);eliminaStore(this.storeConvenzione);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonProfilazioneClassificazioni",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"GrigliaProfili",selector:this.selContainer+"#GrigliaProfili"},{ref:"GrigliaProfiliClass",selector:this.selContainer+"#GrigliaProfiliClass"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",
selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#GrigliaProfili",{select:this.onGrigliaProfiliSelect});this.control(this.selContainer+"#GrigliaProfiliClass",{edit:this.onGridEdit,canceledit:this.onGridCancelEdit});this.control(this.selContainer+"#BtnNuovo",{click:this.onBtnNuovoClick});this.control(this.selContainer+"#BtnElimina",{click:this.onBtnEliminaClick})},onGrigliaProfiliSelect:function(b,c,d,f){this.aggiornaStore()},onBtnNuovoClick:function(b,c,d){(b=(b=this.getGrigliaProfili().getSelectionModel().getSelection()[0])?
b.get("codice"):null)?controller_nuovoRecordGrid({id:null,idServizio:this.cbaConfig.idServizio,idAnagraficaProfilazione:b,stato:"F"},this.getGrigliaProfiliClass()):alert("Selezionare prima un profilo")},onBtnEliminaClick:function(b,c,d){var f=this;b=f.getGrigliaProfiliClass();c=b.getSelectionModel().getSelection()[0];if(Ext.isEmpty(c))return msgShowWarning("ATTENZIONE","MSG_NO_RECORD_SELECTED"),!1;var g=c?c.get("id"):"";controller_eliminaRecord(b.getStore(),{id:g},function(){f.aggiornaStore(g)})},
onGridCancelEdit:function(b,c,d){this.aggiornaStore()},onGridEdit:function(b,c,d){d=c.record.data;Ext.apply(d,{stato:getBoolValue(d.stato)});controller_salvaRecord(this.getGrigliaProfiliClass(),d,!1,null,null,null,"id")||b.startEdit(c.record,0)},aggiornaStore:function(b){var c=this,d=c.getGrigliaProfiliClass(),f=d.getStore(),g=c.getGrigliaProfili().getSelectionModel().getSelection()[0];(g=g?g.get("codice"):"")?f.load({params:{idAnagraficaProfilazione:g,idServizio:c.cbaConfig.idServizio},callback:function(g,
k,l){l?g&&(g=!1,b&&(g=trovaRecord(f,"id",b)),d.getSelectionModel().select(g?[record]:0),c.getBtnNuovo().setDisabled("L"==c.cbaConfig.permesso),c.getBtnElimina().setDisabled("L"==c.cbaConfig.permesso)):msgShowError("",k.getError())}}):alert("Selezionare prima un profilo")},onLaunch:function(){var b=this,c=b.getGrigliaProfili().getStore(),d=null,f=b.getGrigliaProfiliClass().columns,g;for(g in f){var h=f[g];"idRisposta"==h.dataIndex&&(d=h.editor.store)}ImpostaUrl([c,b.getGrigliaProfiliClass().getStore(),
d]);c=StdUtenti.promiseLoadStore(c,{idOrganizzazione:b.cbaConfig.idOrganizzazione,idServizio:b.cbaConfig.idServizio});d=StdUtenti.promiseLoadStore(d,{type:1,idServizio:b.cbaConfig.idServizio});Promise.all([c,d]).then(function(c){b.getGrigliaProfili().getSelectionModel().select(0)})["catch"](function(b){return msgShowError("",b)});b.cbaConfig.permesso=b.cbaConfig&&b.cbaConfig.permesso?b.cbaConfig.permesso:"L";"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getContainer()),this.getBtnNuovo().setDisabled(!0),
this.getBtnElimina().setDisabled(!0))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonRaccordiFR",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"TipoFlusso",selector:this.selContainer+"#TipoFlusso"},{ref:"pnlTabella",selector:this.selContainer+"#pnlTabella"},{ref:"RbMotIngresso",selector:this.selContainer+"#RbMotIngresso"},{ref:"RgbTabellaRaccordo",selector:this.selContainer+
"#RgbTabellaRaccordo"},{ref:"RbStatoCivile",selector:this.selContainer+"#RbStatoCivile"},{ref:"RbGradoIstruzione",selector:this.selContainer+"#RbGradoIstruzione"},{ref:"RbMotiviDimissione",selector:this.selContainer+"#RbMotiviDimissione"},{ref:"RbMotiviUscita",selector:this.selContainer+"#RbMotiviUscita"},{ref:"RbProfessione",selector:this.selContainer+"#RbProfessione"},{ref:"RbProvenienza",selector:this.selContainer+"#RbProvenienza"},{ref:"RbIniziativaRichiesta",selector:this.selContainer+"#RbIniziativaRichiesta"},
{ref:"RbPosizioneTicket",selector:this.selContainer+"#RbPosizioneTicket"},{ref:"RbTipoEsenzioneTicket",selector:this.selContainer+"#RbTipoEsenzioneTicket"},{ref:"RbOnereDegenza",selector:this.selContainer+"#RbOnereDegenza"},{ref:"RbTipoMedico",selector:this.selContainer+"#RbTipoMedico"},{ref:"RbTipoRicetta",selector:this.selContainer+"#RbTipoRicetta"},{ref:"RbClassePriorita",selector:this.selContainer+"#RbClassePriorita"},{ref:"GridTabella",selector:this.selContainer+"#GridTabella"},{ref:"BtnToolbar",
selector:this.selContainer+"#BtnToolbar"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"BtnRaccordiInfo",selector:this.selContainer+"#BtnRaccordiInfo"}]);this.control(this.selContainer+"#GridTabella",{beforeedit:this.onBeforeEditGridTab,edit:this.onEditGridTab,canceledit:this.onCancelEditGridTab,validateedit:this.onValidateEditGridTab});this.control(this.selContainer+"#RgbTabellaRaccordo",{change:this.changeRgbTabellaRaccordo});
this.control(this.selContainer+"#BtnNuovo",{click:this.onButtonClickNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.onButtonClickElimina});this.control(this.selContainer+"#BtnRaccordiInfo",{afterrender:this.btnRaccordiInfoAfterrender});this.control(this.selContainer+"#TipoFlusso",{select:this.onTipoFlussoSelect})},onTipoFlussoSelect:function(b,c,d){b.value&&(c=this.getRgbTabellaRaccordo(),c.setDisabled(!1),[12,16].includes(b.value)?(c.fireEvent("change",c,{rbTabellaRaccordo:"MD"}),
c.items.items[2].setValue(!0)):(c.fireEvent("change",c,{rbTabellaRaccordo:"SC"}),c.items.items[0].setValue(!0)),this.getRbMotiviDimissione().setVisible(![17].includes(b.value)),this.getRbStatoCivile().setVisible(![12,16,17].includes(b.value)),this.getRbGradoIstruzione().setVisible(![12,15,16,17].includes(b.value)),this.getRbPosizioneTicket().setVisible(![7,9,12,13,14,15,16,17].includes(b.value)),this.getRbTipoEsenzioneTicket().setVisible(![7,9,13,14,15,16].includes(b.value)),this.getRbIniziativaRichiesta().setVisible(![7,
12,13,14,15,16,17].includes(b.value)),this.getRbOnereDegenza().setVisible(![7,9,16,17].includes(b.value)),this.getRbClassePriorita().setVisible([13,14].includes(b.value)),this.getRbTipoMedico().setVisible([12,13,14,15,16].includes(b.value)),this.getRbTipoRicetta().setVisible([12,17].includes(b.value)),this.getRbMotiviUscita().setVisible(![7,9,12,13,14,15,16,17].includes(b.value)),this.getRbMotIngresso().setVisible([9,13,14,15].includes(b.value)),this.getRbProfessione().setVisible(9==b.value),this.getRbProvenienza().setVisible(17!=
b.value),this.storeCodifiche.load({params:{tipoFlusso:b.value},callback:function(b,c,d){}}))},changeRgbTabellaRaccordo:function(b,c){var d=this.getPnlTabella(),f="",g="",h=this.getGridTabella();this.cbaConfig.scheda="";this.cbaConfig.domanda="";d.setTitle("-");getColGrid(h,"associataA").hide();c&&("SC"==c.rbTabellaRaccordo?(d.setTitle(this.getRbStatoCivile().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda="3",f=c.rbTabellaRaccordo):"GI"==c.rbTabellaRaccordo?(d.setTitle(this.getRbGradoIstruzione().boxLabel),
this.cbaConfig.scheda="V",this.cbaConfig.domanda="4",f=c.rbTabellaRaccordo):"MD"==c.rbTabellaRaccordo?(d.setTitle(this.getRbMotiviDimissione().boxLabel),this.cbaConfig.scheda="A",this.cbaConfig.domanda="1",f=c.rbTabellaRaccordo,this.ulss8&&getColGrid(h,"associataA").show()):"SP"==c.rbTabellaRaccordo?(d.setTitle(this.getRbProvenienza().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda="21",f=c.rbTabellaRaccordo):"RI"==c.rbTabellaRaccordo?(d.setTitle(this.getRbIniziativaRichiesta().boxLabel),
this.cbaConfig.scheda="V",this.cbaConfig.domanda="103",f=c.rbTabellaRaccordo):"MUT"==c.rbTabellaRaccordo?(d.setTitle(this.getRbMotiviUscita().boxLabel),this.cbaConfig.scheda="H",this.cbaConfig.domanda="2",f=c.rbTabellaRaccordo):"PT"==c.rbTabellaRaccordo?(d.setTitle(this.getRbPosizioneTicket().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda="108",f=c.rbTabellaRaccordo):"ET"==c.rbTabellaRaccordo?(d.setTitle(this.getRbTipoEsenzioneTicket().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda=
"12",f=c.rbTabellaRaccordo):"OD"==c.rbTabellaRaccordo?(d.setTitle(this.getRbOnereDegenza().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda="109",f=c.rbTabellaRaccordo):"CLP"==c.rbTabellaRaccordo?(d.setTitle(this.getRbClassePriorita().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda="111",f=c.rbTabellaRaccordo):"TM"==c.rbTabellaRaccordo?(d.setTitle(this.getRbTipoMedico().boxLabel),this.cbaConfig.scheda="M",this.cbaConfig.domanda="1",f=c.rbTabellaRaccordo):"CR"==c.rbTabellaRaccordo?
(d.setTitle(this.getRbTipoRicetta().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda="106",f=c.rbTabellaRaccordo):"MR"==c.rbTabellaRaccordo?(d.setTitle(this.getRbMotIngresso().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda="102",f=c.rbTabellaRaccordo,[13,14,15].includes(this.getTipoFlusso().getValue())&&(f="MRO",g="MRD")):"PI"==c.rbTabellaRaccordo&&(d.setTitle(this.getRbProfessione().boxLabel),this.cbaConfig.scheda="V",this.cbaConfig.domanda="5",f=c.rbTabellaRaccordo));this.storeRaccordo.clearFilter();
this.storeRaccordo.filter({filterFn:function(b){return[f,g].includes(b.data.extra)?!0:!1}});this.aggiornaStore()},onButtonClickNuovo:function(b,c,d){},onButtonClickElimina:function(b,c,d){},onBeforeEditGridTab:function(b,c,d){b=this.getGridTabella();d=getColGrid(b,"codice").getEditor();associataA=getColGrid(b,"associataA").getEditor();d.allowBlank="MD"===this.getRgbTabellaRaccordo().getValue().rbTabellaRaccordo||"SP"===this.getRgbTabellaRaccordo().getValue().rbTabellaRaccordo||"RI"===this.getRgbTabellaRaccordo().getValue().rbTabellaRaccordo;
d.emptyText=traduci("FR_PERSON_RACCORDO_EMPTYTEXT");associataA.emptyText=traduci("FR_PERSON_RACCORDO_EMPTYTEXT");[13,14,15].includes(this.getTipoFlusso().getValue())&&"MR"===this.getRgbTabellaRaccordo().getValue().rbTabellaRaccordo&&(this.storeRaccordo.clearFilter(),this.storeRaccordo.filter({filterFn:function(b){return"1"==c.record.data.associataA&&"MRO"==b.data.extra||"2"==c.record.data.associataA&&"MRD"==b.data.extra}}));if(!0===b.getPlugin().editing)return!1;this.abilitaComponenti(!1);this.editStatus=
!0},onCancelEditGridTab:function(b,c,d){this.abilitaComponenti(!0);this.editStatus=!1},onEditGridTab:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();var f=c.record.data,g=f.desServizio,h=f.tipoServizio;delete f.desServizio;delete f.tipoServizio;delete f.codStruttura;f.codice=c.newValues.codice;f.associataA=c.newValues.associataA;controller_salvaRecord(d,f,!1,null,null,null,"idRaccordo")?(f.desServizio=g,f.tipoServizio=h,this.abilitaComponenti(!0),this.editStatus=
!1):b.startEdit(c.record,0)},onValidateEditGridTab:function(b,c,d){return msgShow("",[])},abilitaComponenti:function(b){this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b)},aggiornaStore:function(){var b=this,c=this.getGridTabella(),d=c.getStore(),f=d.getProxy(),g=this.cbaConfig;g.scheda&&g.domanda?(f.extraParams.scheda=g.scheda,f.extraParams.domanda=g.domanda,f.extraParams.tipoFlusso=b.getTipoFlusso().getValue(),f.extraParams.idOrganizzazione=g.idOrganizzazione,d.load({callback:function(d,
f,g){g?(b.ulss8||6!=b.getTipoFlusso().getValue()?6!=b.getTipoFlusso().getValue()&&(b.ulss8=!1):Ext.each(d,function(c){if(508==c.get("codAsl"))return b.ulss8=!0,!1}),setTimeout(function(){c.getSelectionModel().select(0);c.getView().refresh()},100)):msgShowError("",f.getError())}}),b.editStatus=!1):svuotaStore(d)},onLaunch:function(){var b=this;b.getContainer().controller=b;b.getRgbTabellaRaccordo().controller=b;b.getBtnToolbar().hide();this.editStatus=!1;this.cbaConfig.scheda="";this.cbaConfig.domanda=
"";var c=this.getGridTabella();ImpostaUrl([c.getStore(),b.getTipoFlusso().getStore()]);b.getTipoFlusso().emptyText=traduci("FR_PERSON_FLUSSO_EMPTYTEXT");b.getTipoFlusso().getStore().load({params:{scheda:"S",domanda:1,idOrganizzazione:b.cbaConfig.idOrganizzazione},callback:function(c,d,f){1==b.getTipoFlusso().getStore().count()?(c=b.getTipoFlusso().getStore().getRange()[0].data.codice,d=b.getTipoFlusso().getStore().findRecord("codice",c,0,!1,!0,!0),b.getTipoFlusso().setValue(c),b.getTipoFlusso().fireEvent("select",
b.getTipoFlusso(),[d])):b.getRgbTabellaRaccordo().setDisabled(!0)}});b.getTipoFlusso().getStore().filter({filterFn:function(b){return"T"==b.data.extra.trim()?!0:!1}});b.storeCodifiche=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/fr/codifiche/cbox"}});var d=getColGrid(c,"codice"),f=getColGrid(c,"associataA");b.storeRaccordo=Ext.create("Ext.data.ChainedStore",{source:b.storeCodifiche});b.storeRaccordo.filter({filterFn:function(b){return"SC"==b.data.extra?!0:!1}});
b.storeAssociataA=Ext.create("Ext.data.ChainedStore",{source:b.storeCodifiche});b.storeAssociataA.filter({filterFn:function(b){return"MD_ULSS8"==b.data.extra?!0:!1}});editCombo(c,b.storeRaccordo,d,!1,!1);d.show();editCombo(c,b.storeAssociataA,f,!1,!1);f.hide();c=b.getContainer().up("window");Localizer.localize(c);"L"==b.cbaConfig.permesso&&b.abilitaComponenti(!1)},destroy:function(){this.storeCodifiche&&eliminaStore(this.storeCodifiche);this.storeRaccordo&&eliminaStore(this.storeRaccordo);this.storeAssociataA&&
eliminaStore(this.storeAssociataA);this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonServizi",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"grigliaServizi",selector:this.selContainer+"#grigliaServizi"},{ref:"btnNuovo",selector:this.selContainer+"#btnNuovo"},{ref:"btnElimina",selector:this.selContainer+"#btnElimina"},{ref:"btnAbilitazioni",selector:this.selContainer+"#btnAbilitazioni"},{ref:"colTipoServizio",selector:this.selContainer+
"#colTipoServizio"},{ref:"colRegione",selector:this.selContainer+"#colRegione"},{ref:"colTipoFlusso",selector:this.selContainer+"#colTipoFlusso"},{ref:"colASL",selector:this.selContainer+"#colASL"},{ref:"colASST",selector:this.selContainer+"#colASST"},{ref:"colTipoPresidio",selector:this.selContainer+"#colTipoPresidio"},{ref:"colBollo",selector:this.selContainer+"#colBollo"},{ref:"colPersContabili",selector:this.selContainer+"#colPersContabili"},{ref:"colCalcoloRette",selector:this.selContainer+"#colCalcoloRette"},
{ref:"colPresenze",selector:this.selContainer+"#colPresenze"},{ref:"colFestivita",selector:this.selContainer+"#colFestivita"},{ref:"colGGApertura",selector:this.selContainer+"#colGGApertura"},{ref:"ColBudget",selector:this.selContainer+"#ColBudget"},{ref:"ColPersServizio",selector:this.selContainer+"#ColPersServizio"}]);this.control(this.selContainer+"#btnNuovo",{click:this.btnNuovoClick});this.control(this.selContainer+"#btnElimina",{click:this.btnEliminaClick});this.control(this.selContainer+"#btnAbilitazioni",
{click:this.btnAbilitazioniClick});this.control(this.selContainer+"#grigliaServizi",{select:this.selectServizi,beforeedit:this.beforeEditServizi,canceledit:this.cancelEditServizi,edit:this.editServizi,validateedit:this.validateEditServizi})},reloadStoreASL:function(b){b.up().getForm().findField("codAsst").setValue(-1);this.getColASL().getEditor().getStore().load({params:{codRegione:b.selection.data.extra}})},reloadStoreASST:function(b){Ext.isEmpty(b.up().getForm().findField("codAsl").getValue())||
this.getColASST().getEditor().getStore().load({params:{codRegione:b.selection.data.extra,codAsl:b.selection.data.codice}})},btnNuovoClick:function(){if(55==CBA.moduli.moduloAttivo&&CBA.moduli.modulo55.abilitato)return msgShowWarning("ATTENZIONE","FAR_PERSON_SERVIZI_WARNING"),!1;controller_nuovoRecordGrid({idOrganizzazione:this.cbaConfig.idOrganizzazione},this.getGrigliaServizi())},btnEliminaClick:function(){var b=this,c;b.getGrigliaServizi().getSelectionModel().getSelection()[0]&&(c=b.getGrigliaServizi().getSelectionModel().getSelection()[0].get("id"));
controller_eliminaRecord(b.store,{id:c},function(){b.aggiornaStore()})},btnAbilitazioniClick:function(){Ext.create("winCBA",{name:"GeneraliOSP.personalizzazioni.view.CuServiziAbilitaFlussi",titolo:"ATTIVAFLUSSIREGIONALI",dimensione:1,configItem:{permesso:this.cbaConfig.permesso,idOrganizzazione:this.cbaConfig.idOrganizzazione,callbackRitorno:function(){}},closable:!0}).show()},selectServizi:function(b,c){c.get("id")&&this.getBtnElimina().setDisabled(0>c.get("id")||"S"!=this.cbaConfig.permesso)},beforeEditServizi:function(b,
c,d){if(c.record.data.id&&0>c.record.data.id&&-9999!=c.record.data.id)return msgShowError("Attenzione","MSG_RECORD_NON_MODIFICABILE"),!1;b.getEditor().getForm().findField("regione").store.each(function(d){c.record.data.desRegione==d.get("valore")&&b.getEditor().getForm().findField("codAsl").store.load({params:{codRegione:d.get("extra")}})});Ext.isEmpty(c.record.data.id)||"D"!==c.record.data.tipoServizio?b.getEditor().getForm().findField("tipoServizio").store.filter(function(b){var c=!0;"D"===b.get("codice")?
c=!1:c=!0;return c}):"D"===c.record.data.tipoServizio&&b.getEditor().getForm().findField("tipoServizio").store.clearFilter();this.abilitaVideata(!1)},cancelEditServizi:function(b,c,d){this.aggiornaStore(c.record.data.id);this.abilitaVideata(!0)},editServizi:function(b,c,d){var f=this,g=c.record.data;!Ext.isEmpty(g.id)||"G"!==g.tipoServizio&&"M"!==g.tipoServizio?controller_salvaRecord(f,g,!1,{idOrg:f.cbaConfig.idOrganizzazione})||(b.startEdit(c.record,0),f.abilitaVideata(!1)):Ext.widget("passwordCBA",
{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(d){d?controller_salvaRecord(f,g,!1,{idOrg:f.cbaConfig.idOrganizzazione})||(b.startEdit(c.record,0),f.abilitaVideata(!1)):(b.startEdit(c.record,0),f.abilitaVideata(!1))}}).show()},validateEditServizi:function(b,c,d){c=[];b.getEditor().getForm().findField("codAsl").allowBlank=55!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo&&3!==b.getEditor().getForm().findField("tipoFlusso").getValue();b.getEditor().getForm().findField("codAsst").allowBlank=
3!==b.getEditor().getForm().findField("tipoFlusso").getValue();b.getEditor().getForm().isValid()||(b.getEditor().getForm().findField("codAsl").allowBlank=55!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo,b.getEditor().getForm().findField("codAsst").allowBlank=!0,msgAddError(c,"MSG_CAMPI_OBBLIGATORI"));return msgShow("",c)},abilitaVideata:function(b){this.cbaConfig.ctrlPerson&&this.cbaConfig.ctrlPerson.getPnlPerson()&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!b);this.getBtnNuovo().setDisabled(!b||
"S"!=this.cbaConfig.permesso);this.getBtnElimina().setDisabled(!b||"S"!=this.cbaConfig.permesso);this.getBtnAbilitazioni().setDisabled(!b||"S"!=this.cbaConfig.permesso)},aggiornaStore:function(b){var c=this.getGrigliaServizi(),d=c.getStore();d.load({params:{idOrg:this.cbaConfig.idOrganizzazione,tipiServizio:getTipiServizio()},callback:function(f,g,h){h?f&&(f=!1,b&&(f=trovaRecord(d,"id",b)),f?(c.getSelectionModel().select([f]),"undefined"!==typeof currRicovero&&f.get("id")==currRicovero.servizio.id&&
(currRicovero.servizio.codiceStruttura=f.get("codiceStruttura"),currRicovero.servizio.tipoFlusso=f.get("tipoFlusso"))):c.getSelectionModel().select(0)):msgShowError("",g.getError())}});this.abilitaVideata(!0)},onLaunch:function(){var b=this,c=b.cbaConfig.idOrganizzazione,d=getUrlGen()+"/ws/genOsp/prszn/perste/cbox",f=function(b,f){b.getProxy().url=d;b.getProxy().extraParams.idEnte=c;b.getProxy().extraParams.tipo=f;b.load()};b.getGrigliaServizi().controller=b;ImpostaUrl([b.getGrigliaServizi().getStore(),
b.getColTipoServizio().editor.store,b.getColASL().editor.store,b.getColASST().editor.store,b.getColTipoFlusso().editor.store,b.getColPersServizio().editor.store]);b.getColTipoServizio().editor.allowBlank=!1;b.getColTipoServizio().editor.store.load({params:{tipiServizio:getTipiServizio()}});b.getColRegione().editor.allowBlank=!1;b.getColRegione().editor.store.load();b.getColPersServizio().editor.store.load({params:{idOrganizzazione:b.cbaConfig.idOrganizzazione}});if(43==CBA.moduli.moduloAttivo||50==
CBA.moduli.moduloAttivo)f(b.getColBollo().editor.store,"B"),f(b.getColPersContabili().editor.store,"C"),f(b.getColCalcoloRette().editor.store,"R");if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo||55==CBA.moduli.moduloAttivo||64==CBA.moduli.moduloAttivo)f(b.getColPresenze().editor.store,"P"),f(b.getColFestivita().editor.store,"F"),f(b.getColGGApertura().editor.store,"A"),64==CBA.moduli.moduloAttivo&&f(b.getColBudget().editor.store,"S"),b.tracciatoGarsia=!1,55==CBA.moduli.moduloAttivo&&
Ext.Ajax.request({url:"/cba/osp/far/ws/prszn/person/src",method:"GET",async:!1,params:{idOrganizzazione:getIdOrg()},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?(b.tracciatoGarsia=2==c.data.tipoTracciati?!0:!1,b.getColTipoPresidio().setVisible(b.tracciatoGarsia),b.getColTipoPresidio().editor.allowBlank=!b.tracciatoGarsia,b.tracciatoGarsia&&(c=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/osp/far/ws/prszn/codifiche/cbox"}}),c.getProxy().extraParams={tipoCodifica:"GPR"},
c.load(),b.getColTipoPresidio().editor.store=c)):msgShowError("",c.message)}});48==CBA.moduli.moduloAttivo?(b.getBtnAbilitazioni().setVisible(!1),b.getColTipoFlusso().setVisible(!1)):(f=b.getColTipoFlusso().editor.store,f.getProxy().extraParams.idOrg=c,f.load());b.store=b.getGrigliaServizi().getStore();b.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.PersonTree",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"pnlPerson",selector:this.selContainer+"#pnlPerson"},{ref:"content",selector:this.selContainer+"#content"}])},onLaunch:function(){var b=this,c=Ext.create("Ext.tree.Panel",{flex:1,store:Ext.create("GeneraliOSP.personalizzazioni.store.PersonTree"),itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,
rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(b,c){c.data.text=traduci(c.data.text)},beforeitemcontextmenu:function(b,c,g,h,k,l){return getPopupMenuTree(k,b)},itemclick:function(c,f,g,h,k,l){c=b.getContent();c.removeAll();f=f.data;null!=f.panelType&&""!=f.panelType&&(f.forceOpen=!0);if(f.leaf||f.forceOpen){g={};f.params&&(g.params=f.params,0<=f.params.indexOf("tipo")&&(h=f.params.split(","),g.tipo=h[1].substr(h[1].indexOf("=")+1)));g.permesso=f.permesso;f.idOrganizzazione&&
(g.idOrganizzazione=f.idOrganizzazione);f.idServizio&&(g.idServizio=f.idServizio);f.tipoServizio&&(g.tipoServizio=f.tipoServizio);g.ctrlPerson=b;var d;null!=f.panelType&&""!=f.panelType&&(d=Ext.create(f.panelType,{cbaConfig:g,flex:1,titolo:this.getRootNode().findChild("idRecord",f.idRecord,!0).parentNode.data.text+" - "+f.text}));c.add(d)}}}});b.getPnlPerson().add(c);ImpostaUrl([c.getStore()]);c.getStore().load({callback:function(b,f,g){g?c.expandAll():msgShowError("",f.getError())}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.personalizzazioni.controller.StruttureOspedaliere",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Griglia",selector:this.selContainer+"#Griglia"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#Griglia",{beforeedit:this.onGridBeforeEdit,
edit:this.onGridEdit,canceledit:this.onGridCancelEdit});this.control(this.selContainer+"#BtnNuovo",{click:this.onBtnNuovoClick});this.control(this.selContainer+"#BtnElimina",{click:this.onBtnEliminaClick})},onBtnNuovoClick:function(b,c,d){b=this.getGriglia();controller_nuovoRecordGrid({id:null,recordUtente:"T"},b)},onBtnEliminaClick:function(b,c,d){var f=this;b=f.getGriglia();c=b.getSelectionModel().getSelection()[0];if(Ext.isEmpty(c))return msgShowWarning("ATTENZIONE","MSG_NO_RECORD_SELECTED"),!1;
c&&"T"==c.get("recordUtente")?controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){f.aggiornaStore()}):msgShowWarning("ATTENZIONE","MSG_RECORD_NON_MODIFICABILE")},onGridBeforeEdit:function(b,c,d){(b=c.record&&"T"==c.record.get("recordUtente"))||msgShowWarning("ATTENZIONE","MSG_RECORD_NON_MODIFICABILE");return b},onGridCancelEdit:function(b,c,d){this.aggiornaStore()},onGridEdit:function(b,c,d){d=c.record.data;controller_salvaRecord(this.getGriglia(),d,!1,null,null,null,"id")||b.startEdit(c.record,
0)},aggiornaStore:function(b){var c=this,d=c.getGriglia(),f=d.getStore();f.load({callback:function(g,h,k){k?g&&(g=!1,b&&(g=trovaRecord(f,"id",b)),d.getSelectionModel().select(g?[record]:0),c.getBtnNuovo().setDisabled("L"==c.cbaConfig.permesso),c.getBtnElimina().setDisabled("L"==c.cbaConfig.permesso)):msgShowError("",h.getError())}})},onLaunch:function(){this.getBtnNuovo().setDisabled(!0);this.getBtnElimina().setDisabled(!0);ImpostaUrl([this.getGriglia().getStore()]);this.aggiornaStore();this.cbaConfig.permesso=
this.cbaConfig&&this.cbaConfig.permesso?this.cbaConfig.permesso:"L";"L"==this.cbaConfig.permesso&&(containerSolaLettura(this.getContainer()),this.getBtnNuovo().setDisabled(!0),this.getBtnElimina().setDisabled(!0))},destroy:function(){this.callParent()}});Ext.Loader.setConfig({enabled:!0});
Ext.application({requires:"Personalizzazioni.view.container Personalizzazioni.view.IMP_CONTABILI Personalizzazioni.view.COPERCALCOLORETTE Personalizzazioni.view.COPERCONTABILI Personalizzazioni.view.COPERBOLLO Personalizzazioni.view.GEANFOCL".split(" "),models:["modAlbero","modCOPERBOLLO","modCOPERCALCOLORETTE","modComboBox","modCOPERCONTABILI"],stores:"albero COPERBOLLO COPERCALCOLORETTE COPERCONTABILI ModFattura TipiContAbilitata RaggrScontiSupplementi CBPersonBollo CBPersonContabili CBPersonCalcoloRette CBPersonPresenze CBPersonGiorniApertura CBPersonFestivita CBEnteIva".split(" "),
views:"container IMP_CONTABILI COPERCALCOLORETTE COPERCONTABILI COPERBOLLO GEANFOCL".split(" "),name:"Personalizzazioni",appFolder:"ospiti/generali/personalizzazioni/app"});
Ext.define("GeneraliOSP.personalizzazioni.store.Campi_Pers_Anag",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"ordine"},{name:"descrizione"},{name:"stato"},{name:"tipocampo"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/personCampiAnag/src",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/osp/co/ws/genOsp/personCampiAnag/src",create:"/cba/osp/co/ws/genOsp//personCampiAnag/new",update:"/cba/osp/co/ws/genOsp/personCampiAnag/update",destroy:"/cba/osp/co/ws/genOsp/personCampiAnag/delete"}},
autoDestroy:!0});Ext.define("GeneraliOSP.personalizzazioni.store.ClassRegStdVen",{extend:"Ext.data.Store",fields:[{name:"progr"},{name:"descr"},{name:"ammesso"},{name:"livIntensita"},{name:"regimeAssistenza"},{name:"macroArea"},{name:"tipoUtenza"},{name:"tipoPosto"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/prszn/ClassRegStdVen/src",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.ClassRegStdVenDet",{extend:"Generali.data.StoreJson",fields:[{name:"codEnte"},{name:"progr"},{name:"codTestata"},{name:"dataDecorrenza",type:"date"},{name:"importo"},{name:"quotaOspite"},{name:"strutturaDest"}],proxy:{urlGen:"/ws/prszn/ClassRegStdVenDet/src",api:{read:".",create:".",update:".",destroy:"."}},sorters:[{property:"dataDecorrenza",direction:"desc"}],autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.ComboStatoCampo",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"testo",convert:function(b,c){return traduci(b)}}],data:[["T","OBBLIGATORIO"],["O","OPZIONALE"],["F","DISABILITATO"]],autoDestroy:!0});Ext.define("GeneraliOSP.personalizzazioni.store.ComboTipiCampo",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"testo",convert:function(b,c){return traduci(b)}}],data:[["1","TINY_TEXT"],["2","NUMERICO"],["3","DATA/ORA"]],autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.ComboTipologiaDocumento",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore",convert:function(b,c){return traduci(b)}}],data:[["A","TIPOLOGIA_UTENTE"],["R","TIPOLOGIA_RIC"],["C","TIPOLOGIA_RIC_CS"]],autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.CriteriCalcolo",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"descrizione"},{name:"idCalcoloPrezzo"},{name:"calcoloQuantita"},{name:"idServizio"}],proxy:{type:"ajax",api:{read:getUrlGen()+"/ws/genOsp/prszn/criteri/search",create:getUrlGen()+"/ws/genOsp/prszn/criteri/new",update:getUrlGen()+"/ws/genOsp/prszn/criteri/update",destroy:getUrlGen()+"/ws/genOsp/prszn/criteri/delete"},url:getUrlGen()+"/ws/genOsp/prszn/criteri/search",reader:{type:"json",
idProperty:"risposta",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.CriteriCalcoloCosti",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idCriterioCalcolo"},{name:"dalGiorno"},{name:"tipoQuotaPrivato"},{name:"quotaSanitariaPrivato"},{name:"quotaSocialePrivato"},{name:"tipoQuotaSSN"},{name:"quotaSanitariaSSN"},{name:"quotaSocialeSSN"},{name:"tipoQuotaConvenzionato"},{name:"quotaSanitariaConvenzionato"},{name:"quotaSocialeConvenzionato"}],proxy:{type:"ajax",api:{read:getUrlGen()+"/ws/genOsp/prszn/criteri/costi/search",
create:getUrlGen()+"/ws/genOsp/prszn/criteri/costi/new",update:getUrlGen()+"/ws/genOsp/prszn/criteri/costi/update",destroy:getUrlGen()+"/ws/genOsp/prszn/criteri/costi/delete"},url:getUrlGen()+"/ws/genOsp/prszn/criteri/costi/search",reader:{type:"json",idProperty:"risposta",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.CriteriCalcoloPrezzo",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/prszn/criteri/prezzo/get"},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.DistrettoAslPagante",{extend:"Generali.data.StoreCodiceValore",fields:[{name:"valore"},{name:"codice"},{name:"extra"},{name:"idRacc",convert:function(b,c){var d=c.get("extra"),f=d?d.split("#"):null;d&&f&&2==f.length&&(b=f[0]);return b},depends:["extra"]},{name:"codFocl",convert:function(b,c){var d=c.get("extra"),f=d?d.split("#"):null;d&&f&&2==f.length&&(b=f[1]);return b},depends:["extra"]}],groupField:"gruppo",constructor:function(b){b=b||{};this.callParent([Ext.apply({proxy:{urlGen:"/ws/genOsp/asl/assDistrPagante/list"}},
b)])}});Ext.define("GeneraliOSP.personalizzazioni.store.EstrattoConto",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"dataDal",type:"date"},{name:"descrizione"},{name:"applicaFiltro"}],proxy:{url:"/cba/osp/co/ws/prszn/escont/src",api:{read:"/cba/osp/co/ws/prszn/escont/src",create:"/cba/osp/co/ws/prszn/escont/new",update:"/cba/osp/co/ws/prszn/escont/update",destroy:"/cba/osp/co/ws/prszn/escont/delete"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.EstrattoContoDettaglio",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idPersEstrattoConto"},{name:"predefinito"},{name:"idConto"},{name:"idCausale"},{name:"idEsercizio"},{name:"tipoContabilita"},{name:"idOrganizzazione"}],proxy:{url:"/cba/osp/co/ws/prszn/escontdet/src",api:{read:"/cba/osp/co/ws/prszn/escontdet/src",create:"/cba/osp/co/ws/prszn/escontdet/new",update:"/cba/osp/co/ws/prszn/escontdet/update",destroy:"/cba/osp/co/ws/prszn/escontdet/delete"}},
autoDestroy:!0});Ext.define("GeneraliOSP.personalizzazioni.store.EtichetteOSP",{extend:"Generali.etichette.store.EtichetteGen",fields:[{name:"stpPerContoDi"},{name:"tipoOrdinamento"},{name:"tipoEtichetta"}],proxy:{url:"/cba/gen/ws/general/etichette/list",api:{destroy:"/cba/gen/ws/general/etichette/delete"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.ImpostazioniServizio",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"idModulo"},{name:"descrizione"},{name:"prognosiProroghe"},{name:"abilitaOraResidenziale"},{name:"tipoProvenienza"},{name:"motivazioneIngresso"},{name:"iniziativaRichiesta"},{name:"onereDegenza"},{name:"tipoRicovero"},{name:"regimeRicovero"},{name:"diagnosiIngresso"},{name:"diagnosiIcd9"},{name:"medicoInviante"},{name:"medicoGenerale"},{name:"medicoAccettante"},
{name:"infoAggiuntive"},{name:"indennitaAccompagnamento"},{name:"percentualeInvalidita"},{name:"situazioneDomicilio"},{name:"situazioneRilevazione"},{name:"accessoPrevisto"},{name:"gestioneStrutturaAssenza"},{name:"modalitaIntZucchetti"},{name:"unitaOrganizzativa"},{name:"abilitaAccompagnatore"},{name:"abilitaTariffaRettaPers"},{name:"giorniPrognosi"}],proxy:{urlGen:"/ws/genOsp/prszn/servizio/src",api:{read:".",create:".",update:".",destroy:"."}}});
Ext.define("GeneraliOSP.personalizzazioni.store.Listini",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"descrizione"},{name:"al",type:"date"},{name:"dal",type:"date"},{name:"idSoggettoConvenzionato"},{name:"idCriterioCalcolo"},{name:"idServizio"}],proxy:{type:"ajax",api:{read:getUrlGen()+"/ws/genOsp/prszn/listini/search",create:getUrlGen()+"/ws/genOsp/prszn/listini/new",update:getUrlGen()+"/ws/genOsp/prszn/listini/update",destroy:getUrlGen()+"/ws/genOsp/prszn/listini/delete"},url:getUrlGen()+
"/ws/genOsp/prszn/listini/search",reader:{type:"json",idProperty:"risposta",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.ListiniDettagli",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idListino"},{name:"idPrestazione"},{name:"idCriterioCalcolo"},{name:"quotaSanitaria"},{name:"quotaSociale"},{name:"idEsercizio"},{name:"idAliquotaIVA"},{name:"idConto"},{name:"idCDA"},{name:"cda1"},{name:"cda"}],proxy:{type:"ajax",api:{read:getUrlGen()+"/ws/genOsp/prszn/listini/dett/search",create:getUrlGen()+"/ws/genOsp/prszn/listini/dett/new",update:getUrlGen()+"/ws/genOsp/prszn/listini/dett/update",
destroy:getUrlGen()+"/ws/genOsp/prszn/listini/dett/delete"},url:getUrlGen()+"/ws/genOsp/prszn/listini/dett/search",reader:{type:"json",idProperty:"risposta",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.PersonOrganizzazione",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"versioneDB"},{name:"idOrganizzazione"},{name:"numFascicoloAutomatico"},{name:"numFascicoloRipartiOgniAnno"},{name:"numFascicoloFormato"},{name:"ggNotificaScadenzaDoc"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/genOsp/persgen/getbyorg",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/genOsp/persgen/getbyorg",create:"/cba/osp/co/ws/prszn/persgen/save",
update:"/cba/osp/co/ws/prszn/persgen/save",destroy:"/cba/osp/co/ws/prszn/persgen/delete"}},autoDestroy:!0});Ext.define("GeneraliOSP.personalizzazioni.store.PersonPortaleUtenti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"pIva"},{name:"codiceDisambiguazione"},{name:"descrizione"}],proxy:{urlGen:"/ws/genOsp/prszn/portaleUtenti/src",api:{read:".",create:".",update:".",destroy:"."}}});
Ext.define("GeneraliOSP.personalizzazioni.store.PersonProfilazioneAnagrafica",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"stato"},{name:"descrizione"},{name:"regione"},{name:"tipologiaUtente"},{name:"formaErogazione"},{name:"formaAccreditamento"},{name:"livelloAssistenziale"},{name:"durata"},{name:"convenzionatoFSR"},{name:"convenzioneCommerciale"},{name:"desRegione"},{name:"desTipologiaUtente"},{name:"desFormaAccreditamento"},{name:"desFormaErogazione"},
{name:"desLivelloAssistenziale"},{name:"desConvenzioneCommerciale"},{name:"desDurata"}],proxy:{urlGen:"/ws/genOsp/prszn/profilazioneAnagrafica/src",api:{read:".",create:".",update:".",destroy:"."}}});
Ext.define("GeneraliOSP.personalizzazioni.store.PersonProfilazioneClassificazione",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idServizio"},{name:"idAnagraficaProfilazione"},{name:"idRisposta"},{name:"stato"},{name:"desRisposta"}],proxy:{urlGen:"/ws/genOsp/prszn/profilazioneClassif/src",api:{read:".",create:".",update:".",destroy:"."}}});
Ext.define("GeneraliOSP.personalizzazioni.store.PersonRaccordiFR",{extend:"Generali.data.StoreJson",fields:[{name:"idRaccordo"},{name:"risposta"},{name:"desRisposta"},{name:"statoRisposta"},{name:"idServizio"},{name:"desServizio"},{name:"tipoServizio"},{name:"codStruttura"},{name:"tipoFlusso"},{name:"codice"},{name:"associataA"},{name:"codAsl"}],proxy:{urlGen:"/ws/genOsp/fr/personRaccordi/src",api:{create:".",update:".",destroy:"."}},groupField:"desServizio",autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.PersonServizi",{extend:"Generali.data.StoreJson",fields:[{name:"idServizio"},{name:"descrizione"},{name:"tipoServizio"},{name:"desTipoServizio"},{name:"regione"},{name:"desRegione"},{name:"codiceStruttura"},{name:"cudes"},{name:"idPersBollo"},{name:"desPersBollo"},{name:"idPersContabili"},{name:"desPersContabili"},{name:"idPersCalcoloRette"},{name:"desPersCalcoloRette"},{name:"idPersPresenze"},{name:"desPersPresenze"},{name:"idPersGiorniApertura"},{name:"desPersGiorniApertura"},
{name:"idPersFestivita"},{name:"desPersFestivita"},{name:"idPersServizio"},{name:"desPersServizio"},{name:"idOrganizzazione"},{name:"desOrganizzazione"},{name:"codAsl"},{name:"desAsl"},{name:"tipoPresidio"},{name:"desTipoPresidio"},{name:"sigla"},{name:"idPersBudget"},{name:"desPersBudget"},{name:"tipoFlusso"},{name:"desTipoFlusso"},{name:"codAsst"}],proxy:{urlGen:"/ws/genOsp/servizi/src",api:{read:".",create:".",update:".",destroy:"."}},autoLoad:!1,autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.PersonTree",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idOrganizzazione"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"}],proxy:{type:"ajax",urlGen:"/ws/prszn/conf/tree",reader:{type:"json",rootProperty:"children"}},autoLoad:!1,root:{expanded:!1},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.RaccordiArticoloSolco",{extend:"Ext.data.Store",fields:[{name:"risposta"},{name:"descrizione"},{name:"desEstesa"},{name:"tipo"},{name:"desArticolo"},{name:"desFrequente"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/adHoc/raccCodArticoloSolco/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/adHoc/raccCodArticoloSolco/list",create:getUrlGen()+"/ws/adHoc/raccCodArticoloSolco/insert",update:getUrlGen()+"/ws/adHoc/raccCodArticoloSolco/update",
destroy:getUrlGen()+"/ws/adHoc/raccCodArticoloSolco/delete"}},autoLoad:!1,autoDestroy:!0});Ext.define("GeneraliOSP.personalizzazioni.store.RaccordoZhc",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/risposte/cbox"},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.StruttureOspedaliere",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"regione"},{name:"codiceOspedale"},{name:"citta"},{name:"descrizione"},{name:"recordUtente"}],proxy:{urlGen:"/ws/genOsp/ospedali/src",api:{read:".",create:".",update:".",destroy:"."}}});
Ext.define("GeneraliOSP.personalizzazioni.store.TipoIncasso",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore",convert:function(b,c){return traduci(b)}}],data:[["0","NESSUNA_SCRITTURA_CONTABILE"],["1","CREA_PRIMA_NOTA"],["2","CREA_SCADENZA_LIBERA"]],autoLoad:!0,autoDestroy:!0});Ext.define("GeneraliOSP.personalizzazioni.store.TipoServizio",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/servtype/cbox"},autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.store.TipoUsoPensione",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore",convert:function(b,c){return traduci(b)}}],data:[["1","PENS_USA_QSANSOC"],["2","PENS_USA_QSAN"],["3","PENS_USA_QSOC"]],autoLoad:!0,autoDestroy:!0});
Ext.define("GeneraliOSP.personalizzazioni.view.AssociaDistrettoPagSsn",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"gridpanel",itemId:"GridAssPagantiSsn",reference:"GridAssPagantiSsn",flex:1,store:Ext.create("GeneraliOSP.personalizzazioni.store.DistrettoAslPagante",{fields:[{name:"valore"},{name:"codice"},{name:"extra"},{name:"idRacc",convert:function(b,d){var c=d.get("extra"),g=c?c.split("#"):null;c&&g&&2==g.length&&(b=g[0]);return b},
depends:["extra"]},{name:"codFocl",convert:function(b,d){var c=d.get("extra"),g=c?c.split("#"):null;c&&g&&2==g.length&&(b=g[1]);return b},depends:["extra"]}],autoLoad:!1}),viewConfig:{loadMask:!1,enableTextSelection:!0},columns:[{xtype:"gridcolumn",dataIndex:"valore",flex:1,text:"DISTRETTO"},{xtype:"gridcolumn",dataIndex:"codFocl",flex:1,text:"CLIENTI_FORNITORI",editor:{xtype:"combobox",itemId:"CbxPagante",reference:"CbxPagante",queryMode:"local",displayField:"valore",valueField:"codice",allowBlank:!0,
listConfig:{width:500,heigth:200,loadMask:!1}},renderer:function(c,d,f,g,h,k,l){d=b.controller;c&&(c=d.trovaRecordCliFor(f.get("codFocl")));return c}}],hideGroupedHeader:!0,plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",cls:"baseBgColor",height:36,items:[{xtype:"tbfill"},{xtype:"label",html:traduci("ASSOCIAZIONE_DISTRETTO_PAGANTE_SSN"),cls:"cbaLabel"},{xtype:"tbfill"}]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.CriteriCalcolo",{extend:"Generali.standard.ControlledContainer",initComponent:function(){this.storeCalcoloQuantita=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["1",traduci("CRITERI_CALCOLO_QUANTITA_1"),""],["2",traduci("CRITERI_CALCOLO_QUANTITA_2"),""],["3",traduci("CRITERI_CALCOLO_QUANTITA_3"),""],["4",traduci("CRITERI_CALCOLO_QUANTITA_4"),""]],autoLoad:!0,autoDestroy:!0});Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"Criteri",
reference:"Criteri",layout:{type:"border"},title:"Gestione "+traduci("CRITERI_CALCOLO"),items:[{xtype:"panel",region:"west",itemId:"Container",reference:"Container",width:230,layout:{type:"fit"},title:"ELENCO",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGrid",reference:"StoricoGrid",title:"",store:Ext.create("GeneraliOSP.personalizzazioni.store.CriteriCalcolo"),viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"NOME",flex:1,align:"center",renderer:function(b,
c,d,f,g,h,k){c.style="text-align:left !important";return b}}]}]},{xtype:"form",region:"center",border:0,itemId:"CriteriForm",reference:"CriteriForm",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"textfield",itemId:"IdCriterio",reference:"IdCriterio",hidden:!0,name:"id"},{xtype:"textfield",itemId:"NomeCriterio",reference:"NomeCriterio",fieldLabel:"NOME",name:"descrizione",labelClsExtra:"cbaLabel",margin:"5 0 0 0",labelWidth:110,width:450,maxLength:100,
enforceMaxLength:!0,allowBlank:!1},{xtype:"combobox",itemId:"CalcoloPrezzo",reference:"CalcoloPrezzo",margin:"10 0 0 0",fieldLabel:"CRITERI_CALCOLO_PREZZO",name:"idCalcoloPrezzo",labelClsExtra:"cbaLabel",displayField:"valore",queryMode:"local",valueField:"codice",width:450,labelWidth:110,allowBlank:!1,store:Ext.create("GeneraliOSP.personalizzazioni.store.CriteriCalcoloPrezzo")},{xtype:"combobox",itemId:"CalcoloQuantita",reference:"CalcoloQuantita",margin:"10 0 0 0",fieldLabel:"CRITERI_CALCOLO_QUANTITA",
name:"calcoloQuantita",labelClsExtra:"cbaLabel",displayField:"valore",queryMode:"local",valueField:"codice",width:450,labelWidth:110,allowBlank:!1,store:this.storeCalcoloQuantita},{xtype:"gridpanel",margin:"10 0 0 0",itemId:"GridCosti",reference:"GridCosti",flex:1,title:"CRITERI_CALCOLO_COSTI",store:Ext.create("GeneraliOSP.personalizzazioni.store.CriteriCalcoloCosti"),columns:[{xtype:"numbercolumn",dataIndex:"dalGiorno",flex:1,format:"0,",text:"DALGIORNO",align:"center",allowDecimals:!1,editor:{xtype:"numberfield",
allowDecimals:!1,selectOnFocus:!0,allowBlank:!1}},{xtype:"booleancolumn",itemId:"GridQuotePrivato",reference:"GridQuotePrivato",hideable:!1,text:"CRITERI_CALCOLO_PAG_PRIVATO",columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return decodeTipoQuota(b,!0)},width:75,align:"center",dataIndex:"tipoQuotaPrivato",hideable:!1,text:"TIPO_QUOTA",editor:{xtype:"combo",itemId:"CbTipoQuotaPrivato",reference:"CbTipoQuotaPrivato",allowBlank:!1,store:Ext.create("Generali.store.EuroPerc"),displayField:"valore",
valueField:"codice",mode:"local",triggerAction:"all",editable:!1,matchFieldWidth:!1,listeners:{change:function(b,c,d,f){b=b.up("grid").getPlugin().getEditor().getForm();c="P"==c?"100":"";d=b.findField("quotaSanitariaPrivato");b=b.findField("quotaSocialePrivato");d.setValue(c);b.setValue(c)}}}},{xtype:"gridcolumn",text:"Q_SAN",width:70,format:"0.00,",sortable:!1,align:"center",dataIndex:"quotaSanitariaPrivato",editor:{xtype:"numberfield"},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";
return null!=b?formatFloat(b):""}},{xtype:"gridcolumn",text:"Q_SOC",width:70,format:"0.00,",sortable:!1,align:"center",dataIndex:"quotaSocialePrivato",editor:{xtype:"numberfield",allowBlank:!1},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return null!=b?formatFloat(b):""}}]},{xtype:"booleancolumn",itemId:"GridQuoteSSN",reference:"GridQuoteSSN",hideable:!1,text:"CRITERI_CALCOLO_PAG_SSN",columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return decodeTipoQuota(b,
!0)},width:75,align:"center",dataIndex:"tipoQuotaSSN",hideable:!1,text:"TIPO_QUOTA",editor:{xtype:"combo",itemId:"CbTipoQuotaSSN",reference:"CbTipoQuotaSSN",store:Ext.create("Generali.store.EuroPerc"),displayField:"valore",valueField:"codice",mode:"local",triggerAction:"all",editable:!1,matchFieldWidth:!1,listeners:{change:function(b,c,d,f){b=b.up("grid").getPlugin().getEditor().getForm();c="P"==c?"100":"";d=b.findField("quotaSanitariaSSN");b=b.findField("quotaSocialeSSN");d.setValue(c);b.setValue(c)}}}},
{xtype:"gridcolumn",text:"Q_SAN",width:70,format:"0.00,",sortable:!1,align:"center",dataIndex:"quotaSanitariaSSN",editor:{xtype:"numberfield"},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return null!=b?formatFloat(b):""}},{xtype:"gridcolumn",text:"Q_SOC",width:70,format:"0.00,",sortable:!1,align:"center",dataIndex:"quotaSocialeSSN",editor:{xtype:"numberfield"},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return null!=b?formatFloat(b):""}}]},{xtype:"booleancolumn",
itemId:"GridQuoteConvenzionato",reference:"GridQuoteConvenzionato",hideable:!1,text:"CRITERI_CALCOLO_PAG_CONVENZIONATO",columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return decodeTipoQuota(b,!0)},width:75,align:"center",dataIndex:"tipoQuotaConvenzionato",hideable:!1,text:"TIPO_QUOTA",editor:{xtype:"combo",itemId:"CbTipoQuotaConvenzionato",reference:"CbTipoQuotaConvenzionato",store:Ext.create("Generali.store.EuroPerc"),displayField:"valore",valueField:"codice",mode:"local",triggerAction:"all",
editable:!1,matchFieldWidth:!1,listeners:{change:function(b,c,d,f){b=b.up("grid").getPlugin().getEditor().getForm();c="P"==c?"100":"";d=b.findField("quotaSanitariaConvenzionato");b=b.findField("quotaSocialeConvenzionato");d.setValue(c);b.setValue(c)}}}},{xtype:"gridcolumn",text:"Q_SAN",width:70,format:"0.00,",sortable:!1,align:"center",dataIndex:"quotaSanitariaConvenzionato",editor:{xtype:"numberfield"},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return null!=b?formatFloat(b):
""}},{xtype:"gridcolumn",text:"Q_SOC",width:70,format:"0.00,",sortable:!1,align:"center",dataIndex:"quotaSocialeConvenzionato",editor:{xtype:"numberfield"},renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return null!=b?formatFloat(b):""}}]}],viewConfig:{loadMask:!1,width:800},dockedItems:[{xtype:"toolbar",dock:"top",itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"detNuovo",reference:"detNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",
itemId:"detElimina",reference:"detElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.CuServiziAbilitaFlussi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",margin:"0 0 0 0",layout:{type:"vbox",align:"stretch"},title:"ATTIVAFLUSSIREGIONALI",autoScroll:!0,flex:1,items:[{xtype:"gridpanel",flex:.5,layout:{margin:40},itemId:"GrigliaFlussi",reference:"GrigliaFlussi",store:Ext.create("GeneraliOSP.personalizzazioni.app.store.OSPE_SRT"),dockedItems:[{xtype:"toolbar",dock:"top",
border:0,itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"BtnSblocca",reference:"BtnSblocca",iconCls:"icon-locked",text:"SBLOCCA"},{xtype:"label",margin:"0 0 0 10",itemId:"LblSblocco",reference:"LblSblocco",text:"MSG_ATTIVAZIONE_FLUSSI"}]}],columns:[{xtype:"gridcolumn",dataIndex:"risposta",hidden:!0},{xtype:"gridcolumn",dataIndex:"descrizione",header:"DESCRIZIONE",width:300,readOnly:!0},{xtype:"gridcolumn",header:"SIGLA",dataIndex:"notaInterna",width:100,readOnly:!0},{xtype:"gridcolumn",
header:"ABILITATO",dataIndex:"tipoStato",width:50,renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.CuServiziCopia",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},autoScroll:!0,flex:1,items:[{xtype:"gridpanel",flex:.5,layout:{margin:40},itemId:"GridServizi",reference:"GridServizi",store:Ext.create("GeneraliOSP.store.TipoServizioByOrg"),dockedItems:[{xtype:"toolbar",dock:"top",border:0,itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",
itemId:"BtnSblocca",reference:"BtnSblocca",iconCls:"icon-locked",text:"SBLOCCA"},{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-elabora32",text:"ELABORA",disabled:!0},{xtype:"label",margin:"0 0 0 10",itemId:"LblSblocco",reference:"LblSblocco",text:"MSG_FUNZIONALITA_CBA"}]}],columns:[{xtype:"gridcolumn",text:"CODICE",dataIndex:"codice",hidden:!0},{xtype:"checkcolumn",itemId:"CheckColumnServizi",text:"",dataIndex:"checked",width:35},{xtype:"gridcolumn",text:"SERVIZIO",dataIndex:"valore",
flex:1}],features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}],viewConfig:{width:200,loadMask:!1}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.ImpostazioniServizio",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){this.storeModIntZuc=Ext.create("Ext.data.ArrayStore",{fields:["codice","valore"],data:[[0,traduci("SCENARIO_0")],[1,traduci("SCENARIO_1")],[2,traduci("SCENARIO_2")],[3,traduci("SCENARIO_3")],[4,traduci("SCENARIO_4")],[5,traduci("SCENARIO_5")]],autoLoad:!0,autoDestroy:!0});Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"hbox"},
items:[{xtype:"gridpanel",itemId:"GridImpostazioni",reference:"GridImpostazioni",flex:1,title:"Elenco",height:120,store:Ext.create("GeneraliOSP.personalizzazioni.store.ImpostazioniServizio"),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"DESCRIZIONE",flex:1}],viewConfig:{loadMask:!1}},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]},{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,
items:[{xtype:"tabpanel",border:0,activeTab:0,width:700,itemId:"TabPanelImpServizio",reference:"TabPanelImpServizio",items:[{xtype:"panel",title:"IMPOSTAZIONI_GENERALI",itemId:"TpImpGenerali",reference:"TpImpGenerali",border:0,items:[{xtype:"textfield",width:440,fieldLabel:"DESCRIZIONE",allowBlank:!1,name:"descrizione",labelClsExtra:"cbaLabel",margin:"5 0 0 5",maxLength:80,enforceMaxLength:!0},{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"fieldset",margin:"10 0 0 0",
layout:{type:"vbox"},items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"PERS_SERVIZIO_ABILITAORARESIDENZIALE",inputValue:"T",uncheckedValue:"F",name:"abilitaOraResidenziale",margin:"5 0 0 0"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"PERS_SERVIZIO_ABILITASTRUTTURE",inputValue:"T",uncheckedValue:"F",name:"gestioneStrutturaAssenza",margin:"5 0 0 0"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"PERS_SERVIZIO_ABILITAACCOMPAGNATORE",inputValue:"T",
uncheckedValue:"F",name:"abilitaAccompagnatore",margin:"5 0 0 0"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"PERS_SERVIZIO_ABILITAQUOTAPERSRETTA",inputValue:"T",uncheckedValue:"F",name:"abilitaTariffaRettaPers",margin:"5 0 0 0"}]},{xtype:"fieldset",margin:"10 0 0 0",layout:{type:"vbox"},items:[{xtype:"combo",fieldLabel:"MODALITA_INT_ZUCCHETTI",margin:"5 0 0 5",labelClsExtra:"cbaLabel",labelWidth:230,width:670,name:"modalitaIntZucchetti",itemId:"CbModalitaIntZucchetti",reference:"CbModalitaIntZucchetti",
fieldCls:"cbaInput200",displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!1,store:this.storeModIntZuc},{xtype:"combo",fieldLabel:"UNITA_ORGANIZZATIVA",margin:"5 0 5 5",labelClsExtra:"cbaLabel",labelWidth:230,width:670,name:"unitaOrganizzativa",itemId:"CbUnitaOrganizzativa",reference:"CbUnitaOrganizzativa",fieldCls:"cbaInput50",displayField:"descrizione",queryMode:"local",valueField:"risposta",allowBlank:!1,store:Ext.create("GeneraliOSP.personalizzazioni.app.store.OSPE_SRT",{proxy:{extraParams:{scheda:"A",
domanda:3}},autoLoad:!0})}]}]},{xtype:"panel",title:"PROGNOSI_PROROGHE",itemId:"TpPrognosiProroghe",reference:"TpPrognosiProroghe",border:0,hidden:43!=CBA.moduli.moduloAttivo,items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"PERS_SERVIZIO_PROGNOSIPROROGHE",inputValue:"T",uncheckedValue:"F",name:"prognosiProroghe",margin:"5 0 0 5"}]},{xtype:"panel",title:"PRESA_IN_CARICO",itemId:"TpPresaInCaricoLA",reference:"TpPresaInCaricoLA",border:0,hidden:48!=CBA.moduli.moduloAttivo,items:[{xtype:"fieldset",
margin:"5 0 0 5",layout:{type:"vbox"},title:"DATI_GENERALI",items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",layout:{type:"vbox"},width:230,items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"TIPO_PROVENIENZA",inputValue:"T",uncheckedValue:"F",name:"tipoProvenienza",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"MOTIVAZIONE_INGRESSO",inputValue:"T",uncheckedValue:"F",name:"motivazioneIngresso",margin:"5 0 0 5"},{xtype:"checkboxfield",
cls:"cbaLabel",fieldLabel:"",boxLabel:"INIZIATIVA_RICHIESTA",inputValue:"T",uncheckedValue:"F",name:"iniziativaRichiesta",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"ONERE_DEGENZA",inputValue:"T",uncheckedValue:"F",name:"onereDegenza",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"TIPO_RICOVERO",inputValue:"T",uncheckedValue:"F",name:"tipoRicovero",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"REGIME_RICOVERO",
inputValue:"T",uncheckedValue:"F",name:"regimeRicovero",margin:"5 0 0 5"}]},{xtype:"container",layout:{type:"vbox"},width:230,items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"DATA_ACCESSO_PREVISTO",inputValue:"T",uncheckedValue:"F",name:"accessoPrevisto",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"DIAGNOSI_INGRESSO",inputValue:"T",uncheckedValue:"F",name:"diagnosiIngresso",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",
boxLabel:"DIAGNOSI_ICD9",inputValue:"T",uncheckedValue:"F",name:"diagnosiIcd9",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"MEDICO_INVIANTE",inputValue:"T",uncheckedValue:"F",name:"medicoInviante",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"MEDICO_MEDICINA_GEN",inputValue:"T",uncheckedValue:"F",name:"medicoGenerale",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"MEDICO_ACCETTANTE",inputValue:"T",
uncheckedValue:"F",name:"medicoAccettante",margin:"5 0 0 5"}]},{xtype:"container",layout:{type:"vbox"},width:230,items:[{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"GIORNI_PROGNOSI",inputValue:"T",uncheckedValue:"F",name:"giorniPrognosi",margin:"5 0 0 5"}]}]}]},{xtype:"fieldset",margin:"10 0 0 5",layout:{type:"vbox"},title:"DATI_AGGIUNTIVI",items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",layout:{type:"vbox"},width:230,items:[{xtype:"checkboxfield",cls:"cbaLabel",
fieldLabel:"",boxLabel:"INFO_AGG",inputValue:"T",uncheckedValue:"F",name:"infoAggiuntive",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"IND_ACCOMPAGNAMENTO",inputValue:"T",uncheckedValue:"F",name:"indennitaAccompagnamento",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"PERC_INVALIDITA",inputValue:"T",uncheckedValue:"F",name:"percentualeInvalidita",margin:"5 0 0 5"}]},{xtype:"container",layout:{type:"vbox"},width:230,items:[{xtype:"checkboxfield",
cls:"cbaLabel",fieldLabel:"",boxLabel:"SITUAZIONE_DOMICILIO",inputValue:"T",uncheckedValue:"F",name:"situazioneDomicilio",margin:"5 0 0 5"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"SITUAZIONE_RILEVAZIONE",inputValue:"T",uncheckedValue:"F",name:"situazioneRilevazione",margin:"5 0 0 5"}]}]}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.Listini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"Listini",reference:"Listini",layout:{type:"border"},title:"Gestione Listini",items:[{xtype:"panel",region:"west",itemId:"Container",reference:"Container",width:230,layout:{type:"fit"},title:"ELENCO",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGrid",reference:"StoricoGrid",title:"",store:Ext.create("GeneraliOSP.personalizzazioni.store.Listini"),
viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"NOME",flex:1,align:"center",renderer:function(b,c,d,f,g,h,k){c.style="text-align:left !important";return b}},{xtype:"datecolumn",align:"center",dataIndex:"dal",text:"DATA_DECORRENZA",width:90,format:"d/m/Y"}]}]},{xtype:"form",region:"center",border:0,itemId:"ListiniForm",reference:"ListiniForm",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"textfield",itemId:"IdListino",
reference:"IdListino",hidden:!0,name:"id"},{xtype:"textfield",itemId:"NomeListino",reference:"NomeListino",fieldLabel:"NOME",name:"descrizione",labelClsExtra:"cbaLabel",margin:"5 0 0 0",labelWidth:110,width:450,maxLength:100,enforceMaxLength:!0,allowBlank:!1},{xtype:"container",itemId:"PeriodoValidita",reference:"PeriodoValidita",margin:"10 0 0 0",layout:{align:"stretch",type:"hbox"},items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",width:220,labelWidth:110,fieldLabel:"DATA_DECORRENZA",
labelClsExtra:"cbaLabel",name:"dal",allowBlank:!1,selectOnFocus:!0},{xtype:"datefield",itemId:"DataAl",reference:"DataAl",margin:"0 0 0 50",width:180,labelWidth:70,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",name:"al"}]},{xtype:"combobox",itemId:"SoggettoConvenzionato",reference:"SoggettoConvenzionato",margin:"10 0 0 0",width:450,labelWidth:110,fieldLabel:"SOGGETTO_CONVENZIONATO",labelClsExtra:"cbaLabel",name:"idSoggettoConvenzionato",displayField:"valore",valueField:"codice",minChars:3,queryParam:"valore",
store:Ext.create("GeneraliOSP.store.FattListaPaganti",{autoLoad:!0}),tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='' || extra.indexOf('null')!=-1 || extra.indexOf(',')==0\">",'<div class="x-boundlist-item">{valore}</div>',"<tpl else>","<tpl if=\"extra.indexOf(',')!=-1\">","<tpl if=\"extra.split(',')[1]=='F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore} [CF: {[values.extra.split(\',\')[0]]}]</div>',"<tpl else>","<div class=\"x-boundlist-item\">{valore} [CF: {[values.extra.split(',')[0]]}]</div>",
"</tpl>","<tpl else>",'<div class="x-boundlist-item">{valore} [CF: {extra}]</div>',"</tpl>","</tpl>","</tpl>")},{xtype:"container",itemId:"Calcolo",reference:"Calcolo",margin:"10 0 0 0",layout:{align:"stretch",type:"hbox"},items:[{xtype:"combobox",fieldLabel:"CRITERIO_CALCOLO",name:"idCriterioCalcolo",itemId:"CriterioCalcolo",reference:"CriterioCalcolo",labelClsExtra:"cbaLabel",displayField:"valore",queryMode:"local",valueField:"codice",width:450,labelWidth:110,allowBlank:!1},{xtype:"button",cls:"btnLarge",
itemId:"CriterioCalcoloInfo",reference:"CriterioCalcoloInfo",margin:"0 0 0 10",iconCls:"icon-info",scale:"medium",text:""}]},{xtype:"gridpanel",margin:"10 0 0 0",itemId:"GridPrestazioni",reference:"GridPrestazioni",flex:1,title:"",store:Ext.create("GeneraliOSP.personalizzazioni.store.ListiniDettagli"),columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:left !important";c=getColGrid(k,"idPrestazione");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,
"codice",b)))return b.data.valore},dataIndex:"idPrestazione",text:"PRESTAZIONE",width:180,align:"center",editor:{xtype:"combobox",selectOnFocus:!0,displayField:"valore",queryMode:"local",valueField:"codice",listConfig:{width:300,heigth:200,loadMask:!1}}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:left !important";c=getColGrid(k,"idCriterioCalcolo");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},dataIndex:"idCriterioCalcolo",
text:"CRITERIO_CALCOLO",width:180,align:"center",editor:{xtype:"combobox",selectOnFocus:!0,displayField:"valore",queryMode:"local",valueField:"codice",listConfig:{width:300,heigth:200,loadMask:!1}}},{xtype:"numbercolumn",dataIndex:"quotaSanitaria",format:"0.00000,",sortable:!1,align:"center",text:"Q_SAN",width:70,renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return null!=b?formatFloat(b):""},editor:{xtype:"numberfield",decimalPrecision:5,selectOnFocus:!0}},{xtype:"numbercolumn",
dataIndex:"quotaSociale",format:"0.00000,",sortable:!1,align:"center",text:"Q_SOC",width:70,renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return null!=b?formatFloat(b):""},editor:{xtype:"numberfield",decimalPrecision:5,selectOnFocus:!0}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:left !important";c=getColGrid(k,"idAliquotaIVA");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},dataIndex:"idAliquotaIVA",
text:"ALIQUOTA",flex:1,align:"center",editor:{xtype:"combobox",selectOnFocus:!0,displayField:"valore",queryMode:"local",valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[1] == 'F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore}</div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>"),listConfig:{width:300,heigth:200,loadMask:!1}}},{xtype:"gridcolumn",renderer:function(b,
c,d,f,g,h,k){c.style="text-align:left !important";c=getColGrid(k,"idConto");c=c.getEditor().getStore?c.getEditor().getStore():!1;if(b&&c&&(b=trovaRecord(c,"codice",b)))return b.data.valore},dataIndex:"idConto",text:"CONTO",flex:1,align:"center",editor:{xtype:"combobox",selectOnFocus:!0,displayField:"valore",queryMode:"local",valueField:"codice",listConfig:{width:300,heigth:200,loadMask:!1}}},{xtype:"gridcolumn",align:"center",dataIndex:"cda",text:"cda",flex:1,renderer:function(b,c,d,f,g,h,k){c.style=
"text-align:left !important";return b}},{xtype:"gridcolumn",dataIndex:"cda1",text:"cda1",editor:{xtype:"textfield"},hidden:!0},{xtype:"gridcolumn",dataIndex:"idCDA",hidden:!0},{xtype:"gridcolumn",dataIndex:"idEsercizio",hidden:!0}],viewConfig:{loadMask:!1,width:800},dockedItems:[{xtype:"toolbar",dock:"top",itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"detNuovo",reference:"detNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"detElimina",reference:"detElimina",
iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.NumerazioneProtocollo",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",flex:1,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:320},{xtype:"textfield",name:"id",hidden:!0},{xtype:"textfield",name:"codEnte",hidden:!0},{xtype:"textfield",
name:"priorita",hidden:!0},{xtype:"textfield",name:"numComuni",hidden:!0},{xtype:"textfield",name:"defComuni",hidden:!0},{xtype:"textfield",name:"comune1",hidden:!0},{xtype:"textfield",name:"comune2",hidden:!0},{xtype:"textfield",name:"comune3",hidden:!0},{xtype:"textfield",name:"comune4",hidden:!0},{xtype:"textfield",name:"comune5",hidden:!0},{xtype:"textfield",name:"comune6",hidden:!0},{xtype:"textfield",name:"comune7",hidden:!0},{xtype:"textfield",name:"comune8",hidden:!0},{xtype:"textfield",name:"comune9",
hidden:!0},{xtype:"textfield",name:"comune10",hidden:!0},{xtype:"textfield",name:"sosia",hidden:!0},{xtype:"textfield",name:"codicaASL",hidden:!0},{xtype:"textfield",name:"codStruttura",hidden:!0},{xtype:"textfield",name:"ggRitiraDom",hidden:!0},{xtype:"textfield",name:"persStanze",hidden:!0},{xtype:"textfield",name:"avvisoRitiroDom",hidden:!0},{xtype:"textfield",name:"versioneDB",hidden:!0},{xtype:"textfield",name:"modificaDomPas",hidden:!0},{xtype:"textfield",name:"rifFascAuto",hidden:!0},{xtype:"textfield",
name:"stampaNumProt",hidden:!0},{xtype:"textfield",name:"permessiAccesso",hidden:!0},{xtype:"textfield",name:"incrPunteggioDopo",hidden:!0},{xtype:"textfield",name:"ggIncrementoAuto",hidden:!0},{xtype:"textfield",name:"puntiIncrementoAuto",hidden:!0},{xtype:"textfield",name:"sfondo",hidden:!0},{xtype:"textfield",name:"idOrganizzazione",hidden:!0},{xtype:"textfield",name:"abilitaSediRep",hidden:!0},{xtype:"textfield",name:"abilitaLetti",hidden:!0},{xtype:"fieldset",title:"CALCOLO_PROTOCOLLO",margin:"10 10 0 10",
layout:{type:"vbox"},items:[{xtype:"radiogroup",itemId:"numProtocolloAutomatico",reference:"numProtocolloAutomatico",columns:1,vertical:!0,items:[{boxLabel:"NESSUNO",name:"numProtocolloAutomatico",cls:"cbaLabel",inputValue:"F",checked:!1},{boxLabel:"NUM_PROTOCOLLO_AUTO_ORGANIZZAZIONE",name:"numProtocolloAutomatico",cls:"cbaLabel",inputValue:"T",checked:!1},{boxLabel:"NUM_PROTOCOLLO_AUTO_SERVIZIO",name:"numProtocolloAutomatico",cls:"cbaLabel",inputValue:"S",checked:!1}]},{xtype:"checkboxfield",margin:"10 0 10 3",
itemId:"NumProtocolloRipartiAnno",reference:"NumProtocolloRipartiAnno",boxLabel:"RIPARTI_DA_UNO_OGNI_ANNO",cls:"cbaLabel",name:"numProtocolloRipartiOgniAnno",inputValue:"T",uncheckedValue:"F"}]},{xtype:"fieldset",itemId:"fieldSetFormato",reference:"fieldSetFormato",title:"FORMATO_NUMERO_PROTOCOLLO",margin:"10 10 0 10",layout:{type:"vbox"},disabled:!0,items:[{xtype:"textfield",fieldLabel:"FORMATO",itemId:"numProtocolloFormato",reference:"numProtocolloFormato",name:"numProtocolloFormato",width:250,
labelClsExtra:"cbaLabel",maxLength:20,regexText:traduci("MSG_MALFORMATO_NUMPROTOCOLLO")},{margin:"10 0 10 0",border:0,html:"<TABLE border=0><TR><TD><B>Esempi:</B><BR> <B>AAAA-S-N</B> = 2017-LA-12<BR> <B>S-AA-N</B>   = LA-17-12<BR> <B>N-S-A</B>    = 12-LA-7<BR><BR>  <B>A</B>=Anno (A=ultima cifra dell'anno, AA=Le ultime due cifre,..)<BR>  <B>S</B>=Sigla Servizio (Stampare la sigla impostata nelle personalizzazioni elenco servizi) <BR>  <B>N</B>=Numero protocollo <BR></TD></TR></TABLE>"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.OSCLASSVEN",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",margin:"0 0 0 0",layout:{type:"vbox",align:"stretch",margin:40},items:[{xtype:"gridpanel",title:"CLASS_REG_STD_VEN",flex:.5,layout:{margin:40},hidden:!1,itemId:"GrigliaTestata",reference:"GrigliaTestata",store:Ext.create("GeneraliOSP.personalizzazioni.store.ClassRegStdVen",{autoLoad:!1}),columns:[{xtype:"gridcolumn",header:"DESCRIZIONE",
dataIndex:"descr",flex:.1,hidden:!1},{xtype:"gridcolumn",header:"AMMESSO",dataIndex:"ammesso",flex:.1,hidden:!1},{xtype:"gridcolumn",header:"LIV_INTENSITA",dataIndex:"livIntensita",flex:.1,hidden:!1},{xtype:"gridcolumn",header:"REG_ASSIST",dataIndex:"regimeAssistenza",flex:.1,hidden:!1},{xtype:"gridcolumn",header:"MACRO_AREA",dataIndex:"macroArea",flex:.1,hidden:!1},{xtype:"gridcolumn",header:"TIPO_UTENZA",dataIndex:"tipoUtenza",flex:.1,hidden:!1},{xtype:"gridcolumn",header:"TIPO_POSTO",dataIndex:"tipoPosto",
flex:.1,hidden:!1}],viewConfig:{hidden:!1,loadMask:!1}},{xtype:"gridpanel",title:"",flex:1,hidden:!1,itemId:"GrigliaDettaglio",reference:"GrigliaDettaglio",store:Ext.create("GeneraliOSP.personalizzazioni.store.ClassRegStdVenDet",{autoLoad:!1}),dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"detNuovo",reference:"detNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"detElimina",reference:"detElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],
columns:[{xtype:"datecolumn",header:"DATA_DECORRENZA",dataIndex:"dataDecorrenza",format:"d/m/Y",flex:.1,hidden:!1,editor:{xtype:"datefield",allowBlank:!1}},{xtype:"gridcolumn",header:"IMPORTO_SAN",dataIndex:"importo",allowBlank:!1,decimalPrecision:5,flex:.1,hidden:!1,renderer:cell_renderer_importo,editor:{xtype:"numberfield"}},{xtype:"gridcolumn",header:"IMPORTO_ALB",dataIndex:"quotaOspite",allowBlank:!1,decimalPrecision:5,flex:.1,renderer:cell_renderer_importo,hidden:!1,editor:{xtype:"numberfield"}},
{xtype:"gridcolumn",header:"CODICESTRUTTURA",dataIndex:"strutturaDest",flex:.1,hidden:!1,editor:{xtype:"textfield",maxLength:6,enforceMaxLength:!0}}],viewConfig:{hidden:!1,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonCampiAnag",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",margin:"0 0 0 0",layout:{type:"vbox",align:"stretch",margin:40},items:[{xtype:"gridpanel",title:"CAMPI_PERSONALIZZATI_ANAGRAFICA",flex:.5,layout:{margin:40},hidden:!1,itemId:"GrigliaAnagrafica",reference:"GrigliaAnagrafica",store:Ext.create("GeneraliOSP.personalizzazioni.store.Campi_Pers_Anag",{autoLoad:!1}),columns:[{xtype:"gridcolumn",
header:"ORDINE",dataIndex:"numCampo",flex:.1,hidden:!1},{xtype:"gridcolumn",header:"DESCRIZIONE",dataIndex:"descrizione",flex:1,hidden:!1,editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}},{xtype:"gridcolumn",header:"CRM_STATO",dataIndex:"stato",flex:1,editor:{xtype:"combobox",itemId:"comboStatoAnag",reference:"comboStatoAnag",store:Ext.create("GeneraliOSP.personalizzazioni.store.ComboStatoCampo"),displayField:"testo",valueField:"codice"}},{xtype:"gridcolumn",header:"TIPO_CAMPO",
dataIndex:"tipocampo",flex:1,hidden:!1,editor:{xtype:"combobox",store:Ext.create("GeneraliOSP.personalizzazioni.store.ComboTipiCampo"),displayField:"testo",valueField:"codice"}}],viewConfig:{hidden:!1,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]},{xtype:"gridpanel",title:"CAMPI_PERSONALIZZATI_SERVIZI",flex:1,hidden:!1,itemId:"GrigliaServizi",reference:"GrigliaServizi",store:Ext.create("GeneraliOSP.personalizzazioni.store.Campi_Pers_Anag",{autoLoad:!1}),
columns:[{xtype:"gridcolumn",header:"ORDINE",dataIndex:"numCampo",flex:.1,hidden:!1},{xtype:"gridcolumn",header:"DESCRIZIONE",dataIndex:"descrizione",flex:1,hidden:!1,editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}},{xtype:"gridcolumn",header:"CRM_STATO",dataIndex:"stato",flex:1,hidden:!1,editor:{xtype:"combobox",store:Ext.create("GeneraliOSP.personalizzazioni.store.ComboStatoCampo"),emptyText:traduci("SELEZIONARE_UNO_STATO_"),displayField:"testo",valueField:"codice"}},{xtype:"gridcolumn",
header:"TIPO_CAMPO",dataIndex:"tipocampo",flex:1,hidden:!1,editor:{xtype:"combobox",store:Ext.create("GeneraliOSP.personalizzazioni.store.ComboTipiCampo"),emptyText:traduci("SELEZIONARE_UN_TIPO_"),displayField:"testo",valueField:"codice"}}],viewConfig:{hidden:!1,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonEstrattoConto",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",height:35,title:"CU_ESTRATTO_CONTO",items:[]},{xtype:"container",itemId:"container",reference:"container",layout:{align:"stretch",type:"vbox"},items:[{xtype:"panel",itemId:"PnlTestata",reference:"PnlTestata",layout:{align:"stretch",type:"vbox"},minHeight:200,flex:.3,border:0,items:[{xtype:"gridpanel",
border:0,itemId:"GridTestata",reference:"GridTestata",flex:1,style:"margin-bottom: 10px",store:Ext.create("GeneraliOSP.personalizzazioni.store.EstrattoConto"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"dataDal",text:"DATA_DECORRENZA",format:"d/m/Y",editor:{xtype:"datefield",allowBlank:!1,selectOnFocus:!0}},{xtype:"gridcolumn",header:"FILTRO_APPLICA",dataIndex:"applicaFiltro",width:100,renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},editor:{xtype:"checkboxfield",
inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",dataIndex:"descrizione",text:"descrizione",flex:1,editor:{xtype:"textfield",maxLength:100,enforceMaxLength:!0}}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1})],dockedItems:[{xtype:"toolbar",dock:"top",border:0,itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"nuovo",reference:"nuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"elimina",reference:"elimina",iconCls:"icon-eliminaGriglia",
text:"Elimina"}]}]}]},{xtype:"panel",itemId:"PnlDettaglio",reference:"PnlDettaglio",flex:1,border:0,layout:{align:"stretch",type:"vbox"},minHeight:200,items:[{xtype:"gridpanel",flex:1,border:0,itemId:"GridDettaglio",reference:"GridDettaglio",title:"",store:Ext.create("GeneraliOSP.personalizzazioni.store.EstrattoContoDettaglio"),dockedItems:[{xtype:"toolbar",dock:"top",border:0,items:[{xtype:"button",itemId:"detNuovo",reference:"detNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",
itemId:"detElimina",reference:"detElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],columns:[{xtype:"gridcolumn",header:"PREDEFINITO",dataIndex:"predefinito",width:100,renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){b=d.data.desCausale;d.data.idCausale&&!b&&(b=d.data.idCausale);return b},dataIndex:"idCausale",text:"causale",flex:1},{xtype:"gridcolumn",renderer:function(b,
c,d,f,g,h,k){b=d.data.desConto;d.data.idConto&&!b&&(b=d.data.idConto);return b},dataIndex:"idConto",text:"conto",flex:1},{xtype:"gridcolumn",dataIndex:"idEsercizio",flex:1,hidden:!0},{xtype:"gridcolumn",dataIndex:"tipoContabilita",flex:1,hidden:!0},{xtype:"gridcolumn",dataIndex:"idOrganizzazione",flex:1,hidden:!0}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonEtichette",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"grigliaModelliEtichette",reference:"grigliaModelliEtichette",flex:1,store:Ext.create("GeneraliOSP.personalizzazioni.store.EtichetteOSP",{autoLoad:!1,autoDestroy:!1}),title:this.cbaConfig.personalizzazioni?"LISTA_ETICHETTE":"",autoScroll:!0,columns:[{xtype:"gridcolumn",dataIndex:"descrizione",
text:"NOME_MODELLO_ETICHETTA",flex:5,editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}},{xtype:"gridcolumn",dataIndex:"id",text:"ID",flex:1,hidden:!0,editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}}]},{xtype:"container",flex:4,layout:{align:"stretch",type:"vbox"},items:[{xtype:"checkboxfield",margin:"0 10 0 30",itemId:"abilitaFormModifica",reference:"abilitaFormModifica",boxLabel:"ABILITA_MODIFICA_TEMPORANEA",cls:"cbaLabel",name:"modificaTemp",inputValue:"T",
uncheckedValue:"F",hidden:this.cbaConfig.personalizzazioni},{xtype:"form",itemId:"formEtichette",reference:"formEtichette",trackResetOnLoad:!0,title:this.cbaConfig.personalizzazioni?"IMPOSTAZIONI_ETICHETTE":"",flex:4,layout:{type:"vbox"},items:[{xtype:"textfield",itemId:"idImpEtichette",reference:"idImpEtichette",name:"id",dataIndex:"id",hidden:!0},{xtype:"textfield",name:"idOrganizzazione",hidden:!0},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"TipoEtichetta",reference:"TipoEtichetta",
name:"tipoEtichetta",margin:"10 20 0 10",width:200,fieldLabel:"TIPO",labelClsExtra:"cbaLabel",labelWidth:30,displayField:"valore",valueField:"codice",editable:!1,readOnly:!0,store:Ext.create("Ext.data.Store",{fields:["codice","valore"],data:[{codice:0,valore:traduci("ETICHETTE_FOGLIO")},{codice:1,valore:traduci("ETICHETTE_DYMO")},{codice:2,valore:traduci("ETICHETTE_BRACCIALETTI_ZEBRA")}],autoLoad:!0})},{xtype:"textfield",itemId:"nomeModelloEtichetta",reference:"nomeModelloEtichetta",width:400,fieldLabel:"NOME_MODELLO_ETICHETTA",
labelClsExtra:"cbaLabel",labelWidth:160,name:"descrizione",allowBlank:!1,maxLength:300,enforceMaxLength:!0,margin:"10 0 0 10",hidden:!this.cbaConfig.personalizzazioni}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"fieldset",margin:"10 8 0 8",layout:{type:"vbox"},title:"MARGINI_FOGLIO",items:[{xtype:"numberfield",allowDecimals:!1,fieldLabel:"SUPERIORE_MM",itemId:"margineSuperiore",reference:"margineSuperiore",name:"margineSuperiore",labelClsExtra:"cbaLabel",labelWidth:100,width:140,minValue:1,
maxvalue:50},{xtype:"numberfield",allowDecimals:!1,fieldLabel:"LATERALE_MM",itemId:"margineLaterale",reference:"margineLaterale",name:"margineLaterale",labelClsExtra:"cbaLabel",labelWidth:100,width:140,minValue:1,maxvalue:50}]},{xtype:"fieldset",margin:"10 0 0 0",layout:{type:"vbox"},title:"MARGINI_ETICHETTE",items:[{xtype:"numberfield",allowDecimals:!1,fieldLabel:"ORIZZONTALE_MM",itemId:"margineEtichettaOrizzontale",reference:"margineEtichettaOrizzontale",name:"margineEtichettaOrizzontale",labelClsExtra:"cbaLabel",
labelWidth:110,width:150,minValue:1,maxvalue:50},{xtype:"numberfield",fieldLabel:"VERTICALE_MM",itemId:"margineEtichettaVerticale",reference:"margineEtichettaVerticale",name:"margineEtichettaVerticale",labelClsExtra:"cbaLabel",labelWidth:110,width:150,minValue:1,maxvalue:50,allowDecimals:!1}]},{xtype:"fieldset",margin:"10 0 0 10",layout:{type:"vbox"},title:"DIMENSIONI_ETICHETTA",items:[{xtype:"numberfield",allowDecimals:!1,fieldLabel:"ETICHETTE_RIGA",itemId:"numEtichette",reference:"numEtichette",
name:"numEtichette",labelClsExtra:"cbaLabel",labelWidth:170,width:210,minValue:1,maxValue:6},{xtype:"numberfield",allowDecimals:!1,fieldLabel:"ALTEZZA_MM",itemId:"altezzaEtichetta",reference:"altezzaEtichetta",name:"altezzaEtichetta",labelClsExtra:"cbaLabel",labelWidth:170,width:210,minValue:5}]}]},{xtype:"container",layout:{type:"hbox"},margin:"10 0 0 0",width:525,items:[{xtype:"combobox",itemId:"dimensioneCarattere",reference:"dimensioneCarattere",name:"dimensioneCarattere",width:180,fieldLabel:"DIMENSIONE_CARATTERE",
labelAlign:"left",labelWidth:130,labelClsExtra:"cbaLabel",maxLength:20,margin:"0 0 0 15",displayField:"valore",valueField:"valore",editable:!1,allowblank:!1,store:Ext.create("Ext.data.Store",{fields:[{name:"valore"}],data:[{valore:6},{valore:7},{valore:8},{valore:9},{valore:10},{valore:11}],autoLoad:!0})},{xtype:"checkboxfield",margin:"0 10 0 30",boxLabel:"RIPETI_ETICHETTA_SU_UNA_PAGINA",cls:"cbaLabel",name:"ripetiSuPagina",inputValue:"T",uncheckedValue:"F"}]},{xtype:"checkboxfield",margin:"0 10 0 30",
boxLabel:"ORDINA_PER_UTENTE",cls:"cbaLabel",name:"tipoOrdinamento",inputValue:"1",uncheckedValue:"0"},{xtype:"fieldset",layout:{type:"vbox"},title:"PERSON_INTEST_ETICH",margin:"10 0 8 8",width:560,items:[{xtype:"container",itemId:"rgTipoIntestazione",reference:"rgTipoIntestazione",columns:1,layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"rbIntestazionePers",reference:"rbIntestazionePers",boxLabel:"Stampa intestazione",name:"stpIntestazione",cls:"cbaLabel",inputValue:"T"},{xtype:"textfield",
itemId:"edtIntestazione",reference:"edtIntestazione",name:"intestazione",margin:"0 10 0 100",fieldLabel:"INTESTAZIONE_ETICHETTA",labelClsExtra:"cbaLabel",labelWidth:130,width:300,maxLength:20}]},{xtype:"checkboxfield",itemId:"rbIntestazioneUtente",reference:"rbIntestazioneUtente",boxLabel:"STP_PER_CONTO_DI_PAGANTE",name:"stpPerContoDi",cls:"cbaLabel",inputValue:"T"}]}],dockedItems:[{xtype:"toolbar",dock:"top",border:0,itemId:"toolbar",reference:"toolbar",hidden:!this.cbaConfig.personalizzazioni,items:[{xtype:"button",
itemId:"btnNuovo",reference:"btnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"btnElimina",reference:"btnElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"},{xtype:"button",itemId:"btnSalva",reference:"btnSalva",disabled:!0,scale:"small",iconCls:"icon-ok",text:"Conferma"},{xtype:"button",disabled:!0,itemId:"btnAnnulla",reference:"btnAnnulla",iconCls:"icon-annulla",text:"Ripristina"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonExportFT",{extend:"CbaUtils.componenti.all.PanelAttivaFunzioniCBA",messaggioAttivazione:"EXPORT_FT_ATTIVAZIONE",nomeFunzioneDaAttivare:"EXPORT_FT",codiceFunzione:"CU_EXPORT_FT",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,flex:1,itemId:"CntServizioDisattivato",reference:"CntServizioDisattivato",layout:{align:"stretch",type:"vbox"},title:"",hidden:!0,items:[{xtype:"panel",cls:"pannelloBiancoBordato",margin:3,layout:{align:"stretch",
type:"vbox"},height:120,border:0,items:[{xtype:"label",margin:"30 15 0 15",cls:"cbaLabelDatiUtente",html:traduci("MSG_ATTIVAZIONE_FE"),style:"text-align:center"}]}]},{xtype:"panel",title:"RACCORDI",border:0,layout:{type:"vbox",align:"stretch"},dockedItems:[{xtype:"toolbar",dock:"top",hidden:!0,itemId:"Toolbar",reference:"Toolbar",items:[{xtype:"button",itemId:"BtnSblocca",reference:"BtnSblocca",iconCls:"icon-locked",text:"SBLOCCA"},{xtype:"label",margin:"0 0 0 10",itemId:"LblSblocco",reference:"LblSblocco",
text:"MSG_ATTIVAZIONE_VIDEATABLOCCATA"}]}],items:[{xtype:"container",region:"center",minHeight:120,maxWidth:900,itemId:"Form",reference:"Form",layout:{type:"vbox",align:"stretch"},autoScroll:!0,defaults:{margin:5},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"container",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",margin:5,maxWidth:400,itemId:"CmbTipoTracciato",reference:"CmbTipoTracciato",
displayField:"valore",valueField:"codice",queryMode:"local",labelClsExtra:"cbaLabel",allowBlank:!1,fieldLabel:"TIPO_TRACCIATO_EXPORT",store:Ext.create("CU.store.TipoTracciatoExport")},{xtype:"radiogroup",flex:1,padding:15,columns:3,vertical:!0,labelClsExtra:"cbaLabel",itemId:"RbTipo",reference:"RbTipo",cls:"cbaLabel",items:[{boxLabel:"CONDIZIONI_DI_PAGAMENTO",name:"tipo",inputValue:"DCPG"},{boxLabel:"CONTO",name:"tipo",inputValue:"DCNG"},{boxLabel:"CAUSALI_FATTURA",name:"tipo",inputValue:"DCAU"},
{boxLabel:"IVA",name:"tipo",inputValue:"DIVA"},{boxLabel:"CDA",name:"tipo",inputValue:"DCDC"},{boxLabel:"RACCORDO_ELENCO_SERVIZI",name:"tipo",inputValue:"UDO",hidden:!0},{boxLabel:"RACCORDO_MOTIVO_DIMISSIONE",name:"tipo",inputValue:"RMD",hidden:!0},{boxLabel:"JESI_MOTIVO_ASSENZA",name:"tipo",inputValue:"RMA",hidden:!0},{boxLabel:"SUPPLEMENTO",name:"tipo",inputValue:"RSU",hidden:!0},{boxLabel:"SCONTO",name:"tipo",inputValue:"RSC",hidden:!0},{boxLabel:"CLASSIFICAZIONE",name:"tipo",inputValue:"CLA",
hidden:!0},{boxLabel:"PAGANTE",name:"tipo",inputValue:"CLIFO",hidden:!0},{boxLabel:"REGISTRO",name:"tipo",inputValue:"REG",hidden:!0},{boxLabel:"RACCORDO_VOCI_RETTA_SOLCO",name:"tipo",inputValue:"VCR",hidden:!0},{boxLabel:"RACCORDO_CATEGORIE_SOLCO",name:"tipo",inputValue:"CTG",hidden:!0}]},{xtype:"combobox",margin:5,maxWidth:400,itemId:"CmbCategoriaCliForSolco",reference:"CmbCategoriaCliForSolco",valueField:"codice",displayField:"valore",queryMode:"local",labelClsExtra:"cbaLabel",fieldLabel:"CATEGORIA",
store:Ext.create("Generali.catCliFor.store.cboxCatCliFor"),hidden:!0}]},{xtype:"gridpanel",itemId:"GridParametriTracciatoSTD",reference:"GridParametriTracciatoSTD",flex:1,minHeight:50,margin:5,store:Ext.create("Generali.person_fe.store.ParametriTracciatoSTD",{autoLoad:!1}),hidden:!0,columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"idOrganizzazione",hidden:!0},{xtype:"gridcolumn",text:"EXPORT_MASTRO_CLIENTE",dataIndex:"mastroCliente",flex:1,sortable:!1,editor:{xtype:"textfield",
allowBlank:!0},align:"center"},{xtype:"gridcolumn",text:"EXPORT_CONTO_CLIENTE",dataIndex:"contoCliente",flex:1,sortable:!1,editor:{xtype:"textfield",allowBlank:!0},align:"center"},{xtype:"gridcolumn",width:80,align:"center",dataIndex:"usaRaccordiConto",text:"EXPORT_CONTO_RACCORDI",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"},renderer:function(b,c,d,f,g,h,k){return renderCheckColumn(c,b)}},{xtype:"gridcolumn",text:"EXPORT_NUMERO_ATTIVITA",dataIndex:"numeroAttivita",flex:1,sortable:!1,
editor:{xtype:"textfield",allowBlank:!0},align:"center"},{xtype:"gridcolumn",text:"TIPO_REGISTRO",dataIndex:"tipoRegistro",flex:1,sortable:!1,editor:{xtype:"textfield",allowBlank:!0},align:"center"},{xtype:"gridcolumn",text:"EXPORT_NUMERO_REGISTRO_IVA",dataIndex:"numeroRegistroIVA",flex:1,sortable:!1,editor:{xtype:"textfield",allowBlank:!0},align:"center"},{xtype:"gridcolumn",text:"cda",dataIndex:"cda",flex:1,sortable:!1,editor:{xtype:"textfield",allowBlank:!0},align:"center"},{xtype:"gridcolumn",
text:"TIPO_CATEGORIA_CLIENTE_FORNITORE",dataIndex:"categoriaCliente",width:60,sortable:!1,editor:{xtype:"textfield",allowBlank:!0},align:"center"},{xtype:"gridcolumn",text:"EXPORT_MASTRO_IVA",dataIndex:"mastroIVA",width:70,sortable:!1,editor:{xtype:"textfield",allowBlank:!0},align:"center"},{xtype:"gridcolumn",text:"EXPORT_CONTO_IVA",dataIndex:"contoIVA",flex:1,sortable:!1,editor:{xtype:"textfield",allowBlank:!0},align:"center"}],viewConfig:{loadMask:!1},plugins:[{ptype:"cellediting",clicksToEdit:1}],
dockedItems:[{xtype:"toolbar",dock:"top",cls:"baseBgColor",height:36,items:[{xtype:"label",itemId:"LabelParametri",reference:"LabelParametri",html:traduci("PARAMETRI"),cls:"cbaLabel",flex:7,style:"text-align:center"},{xtype:"button",itemId:"BtnSalvaParametri",reference:"BtnSalvaParametri",iconCls:"icon-save",text:"SALVA",scale:"small",flex:1}]}],disableSelection:!0}]}]},{xtype:"container",itemId:"CntGridCodiciEsterni",reference:"CntGridCodiciEsterni",hidden:!0,flex:1,layout:{type:"hbox",align:"stretch"},
items:[{xtype:"gridpanel",itemId:"GridCodiciEsterni",reference:"GridCodiciEsterni",flex:1,minHeight:300,store:Ext.create("Generali.person_fe.store.CodificaEsterna",{autoLoad:!1}),viewConfig:{loadMask:!1,enableTextSelection:!0},columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"idOrganizzazione",hidden:!0},{xtype:"gridcolumn",dataIndex:"sistemaExt",hidden:!0},{xtype:"gridcolumn",dataIndex:"tipoDatoExt",hidden:!0},{xtype:"gridcolumn",text:"CODICE",dataIndex:"codice",
flex:1,sortable:!0,editor:{xtype:"textfield",allowBlank:!1}},{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"descrizione",sortable:!0,flex:5,editor:{xtype:"textfield",allowBlank:!1},renderer:function(b,c,d,f,g,h,k){c=b;["CLIFO","REG"].includes(d.get("tipoDatoExt"))&&b&&0<b.indexOf("#SOLCO")&&(c=b.split("#SOLCO")[0]);return c}}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",cls:"baseBgColor",height:36,items:[{xtype:"cercaGrid",
width:250,labelWidth:0,emptyText:"CODICE",cbaConfig:{searchField:"codice",ricercaIniziaPer:!0}},{xtype:"tbfill"},{xtype:"label",itemId:"lblTitle",reference:"lblTitle",html:traduci("CODIFICA_ESTERNA"),cls:"cbaLabel"},{xtype:"tbfill"},{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo",disabled:!0},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"Elimina",disabled:!0}]}]},{xtype:"splitter"},{xtype:"container",
flex:1,itemId:"CntRaccordo",reference:"CntRaccordo",layout:"fit",cbaConfig:{url:"GeneraliOSP.personalizzazioni.view.PersonExportFTraccordo"}}]},{xtype:"container",itemId:"CntRaccArtSolco",reference:"CntRaccArtSolco",flex:1,layout:"fit",hidden:!0,cbaConfig:{url:"GeneraliOSP.personalizzazioni.view.PersonExportFTraccordoSolco"}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonExportFTraccordo",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"gridpanel",width:180,minHeight:300,itemId:"GridRacc",reference:"GridRacc",flex:1,store:Ext.create("Generali.person_fe.store.RaccordoCodificaEsterna",{autoLoad:!1}),viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",text:"ESERCIZIO",dataIndex:"idEsercizio",hidden:!0,renderer:function(b,d,f){d=this.controller;b||(b=
d.idEsercizioDefault);return(d=(d=trovaRecord(d.storeEsercizio,"codice",b))?d.get("valore"):null)?d:"id:"+b},editor:{xtype:"combobox",displayField:"valore",allowBlank:!1,queryMode:"local",valueField:"codice",minChars:0,listeners:{change:function(c,d,f){b.controller.loadStoreCboxByEsercizio(d)}}}},{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"idCodiceSipcar",flex:1,sortable:!1,renderer:function(b,d,f){d=f.get("desCodiceSipcar");Ext.isEmpty(d)&&!Ext.isEmpty(b)&&(f=this.controller,f=f["store"+f.tipoDatoExt])&&
(d=(d=trovaRecord(f,"codice",b,null,null))?d.get("valore"):"descrizione non trovata (idSipcar:"+b+")");return d},editor:{xtype:"combobox",displayField:"valore",allowBlank:!1,queryMode:"local",valueField:"codice",minChars:0}}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",cls:"baseBgColor",height:36,items:[{xtype:"tbfill"},{xtype:"label",html:traduci("COLLEGAMENTO_SIPCAR"),cls:"cbaLabel"},{xtype:"tbfill"},{xtype:"button",
itemId:"BtnNuovoRacc",reference:"BtnNuovoRacc",iconCls:"icon-inserisciGriglia",text:"Nuovo",disabled:!0},{xtype:"button",itemId:"BtnEliminaRacc",reference:"BtnEliminaRacc",iconCls:"icon-eliminaGriglia",text:"Elimina",disabled:!0}]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonExportFTraccordoSolco",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridRaccSolco",reference:"GridRaccSolco",flex:1,store:Ext.create("GeneraliOSP.personalizzazioni.store.RaccordiArticoloSolco",{autoLoad:!1}),viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",text:"risposta",dataIndex:"risposta",flex:1,hidden:!0,sortable:!1},{xtype:"gridcolumn",text:"DESCATEGORIA",
dataIndex:"desCategoria",flex:2,hidden:!0,sortable:!1},{xtype:"gridcolumn",text:"SERVIZIO",dataIndex:"desEstesa",flex:2,sortable:!1},{xtype:"gridcolumn",text:"TIPO",dataIndex:"desSchedaDomanda",flex:1,sortable:!1},{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"descrizione",flex:3,sortable:!1},{xtype:"gridcolumn",text:"CODICE_ARTICOLO_SOLCO",dataIndex:"desArticolo",flex:1,sortable:!1,editor:{xtype:"textfield",allowBlank:!0}},{xtype:"gridcolumn",text:"DESCRIZIONE_ARTICOLO_SOLCO",dataIndex:"desFrequente",
flex:3,hidden:!0,sortable:!1,editor:{xtype:"textfield",maxLength:72,enforceMaxLength:!0,allowBlank:!0}}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",cls:"baseBgColor",height:36,items:[{xtype:"cercaGrid",label:"DESCRIZIONE",width:250,labelWidth:0,emptyText:"DESCRIZIONE",cbaConfig:{searchField:"descrizione",ricercaIniziaPer:!0}},{xtype:"tbfill"},{xtype:"label",itemId:"lblTitleRacSolco",reference:"lblTitleRacSolco",html:traduci("COLLEGAMENTO_SIPCAR"),
cls:"cbaLabel"},{xtype:"tbfill"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonOrganizzazione",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",flex:1,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:320},{xtype:"textfield",name:"id",hidden:!0},{xtype:"textfield",name:"versioneDB",hidden:!0},{xtype:"textfield",
name:"ggNotificaScadenzaDoc",hidden:!0},{xtype:"fieldset",title:"CALCOLO_FASCICOLO",margin:"10 10 0 10",layout:{type:"vbox"},items:[{xtype:"radiogroup",itemId:"numFascicoloAutomatico",reference:"numFascicoloAutomatico",columns:1,vertical:!0,items:[{boxLabel:"NESSUNO",name:"numFascicoloAutomatico",cls:"cbaLabel",inputValue:"F",checked:!1},{boxLabel:"NUM_FASCICOLO_AUTO_ORGANIZZAZIONE",name:"numFascicoloAutomatico",cls:"cbaLabel",inputValue:"T",checked:!1},{boxLabel:"NUM_FASCICOLO_AUTO_SERVIZIO",name:"numFascicoloAutomatico",
cls:"cbaLabel",inputValue:"S",checked:!1}]},{xtype:"checkboxfield",margin:"10 0 10 3",itemId:"NumFascRipartiAnno",reference:"NumFascRipartiAnno",boxLabel:"RIPARTI_DA_UNO_OGNI_ANNO",cls:"cbaLabel",name:"numFascicoloRipartiOgniAnno",inputValue:"T",uncheckedValue:"F"}]},{xtype:"fieldset",itemId:"fieldSetFormato",reference:"fieldSetFormato",title:"FORMATO_NUMERO_FASCICOLO",margin:"10 10 0 10",layout:{type:"vbox"},disabled:!0,items:[{xtype:"textfield",fieldLabel:"FORMATO",itemId:"numFascicoloFormato",
reference:"numFascicoloFormato",name:"numFascicoloFormato",width:250,labelClsExtra:"cbaLabel",maxLength:20,regexText:traduci("MSG_MALFORMATO_NUMFASC")},{margin:"10 0 10 0",border:0,html:"<TABLE border=0><TR><TD><B>Esempi:</B><BR> <B>AAAA-S-N</B> = 2017-CDIS-12<BR> <B>S-AA-N</B>   = CDIS-17-12<BR> <B>N-S-A</B>    = 12-CDIS-7<BR><BR>  <B>A</B>=Anno (A=ultima cifra dell'anno, AA=Le ultime due cifre,..)<BR>  <B>S</B>=Sigla Servizio (Stampare la sigla impostata nelle personalizzazioni elenco servizi) <BR>  <B>N</B>=Numero fascicolo <BR></TD></TR></TABLE>"}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonPortaleUtenti",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",title:"PERSONPORTALEUTENTI",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",region:"center",minHeight:120,maxWidth:900,itemId:"Form",reference:"Form",layout:{type:"vbox",align:"stretch"},autoScroll:!0,
defaults:{margin:5},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"container",border:0,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"label",text:"PARTITA_IVA",margin:"0 0 0 10",cls:"cbaLabel"},{xtype:"textfield",margin:"5 0 5 5",name:"piva",itemId:"PIva",reference:"PIva",width:250,maxLength:15,allowBlank:!1,readOnly:!0},{xtype:"label",text:"CODICEUNIVOCOPORTALEUTENTI",
margin:"0 0 0 10",cls:"cbaLabel"},{xtype:"textfield",margin:"5 0 5 5",name:"codiceDisambiguazione",itemId:"CodiceDisambiguazione",reference:"CodiceDisambiguazione",width:250,allowBlank:!1,validator:function(b){return/^[a-zA-Z0-9]{1,10}$/.test(b)}},{xtype:"label",text:"DESCCODICEUNIVOCOPORTALEUTENTI",margin:"0 0 0 10",cls:"cbaLabel"},{xtype:"textfield",margin:"5 0 5 5",name:"descrizione",itemId:"Descrizione",reference:"Descrizione",width:250,maxLength:50,allowBlank:!0}]},{margin:"5 0 5 5",xtype:"container",
itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonProfilazioneAnagrafica",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"Container",reference:"Container",title:traduci("PROFILAZIONI_ANAGRAFICA"),layout:{type:"vbox",align:"stretch"},autoScroll:!0,flex:1,items:[{xtype:"gridpanel",border:0,itemId:"Griglia",reference:"Griglia",flex:1,title:"",store:Ext.create("GeneraliOSP.personalizzazioni.store.PersonProfilazioneAnagrafica"),
viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",width:65,align:"center",dataIndex:"stato",text:"DISATTIVATO",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"},renderer:function(b,c,d,f,g,h,k){"T"==b&&(c.tdCls="icon-deseleziona")}},{xtype:"gridcolumn",dataIndex:"descrizione",text:"DESCRIZIONE",allowBlank:!1,flex:1,editor:{xtype:"textfield"}},{xtype:"gridcolumn",dataIndex:"regione",text:"REGIONE",allowBlank:!1,flex:1,align:"center",renderer:function(b,c,d,f,g,h,k){return d.get("desRegione")},
editor:{xtype:"combobox",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",valueField:"codice",store:Ext.create("Generali.store.Regione"),typeAhead:!0}},{xtype:"gridcolumn",dataIndex:"tipologiaUtente",text:"TIPOLOGIAUTENTE",flex:1,align:"center",renderer:function(b,c,d,f,g,h,k){return d.get("desTipologiaUtente")},editor:{xtype:"combobox",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",valueField:"codice",typeAhead:!0}},{xtype:"gridcolumn",dataIndex:"formaErogazione",
text:"FORMAEROGAZIONE",flex:1,align:"center",editor:{xtype:"combobox",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",valueField:"codice",typeAhead:!0},renderer:function(b,c,d,f,g,h,k){return d.get("desFormaErogazione")}},{xtype:"gridcolumn",dataIndex:"formaAccreditamento",text:"FORMAACCREDITAMENTO",flex:1,align:"center",renderer:function(b,c,d,f,g,h,k){return d.get("desFormaAccreditamento")},editor:{xtype:"combobox",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",
valueField:"codice",typeAhead:!0,matchFieldWidth:!1,listConfig:{width:300}}},{xtype:"gridcolumn",dataIndex:"livelloAssistenziale",text:"LIVELLOASSISTENZIALE",flex:1,align:"center",renderer:function(b,c,d,f,g,h,k){return d.get("desLivelloAssistenziale")},editor:{xtype:"combobox",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",valueField:"codice",typeAhead:!0,matchFieldWidth:!1,listConfig:{width:300}}},{xtype:"gridcolumn",dataIndex:"convenzioneCommerciale",text:"CONVENZIONECOMMERCIALE",
flex:1,align:"center",renderer:function(b,c,d,f,g,h,k){return d.get("desConvenzioneCommerciale")},editor:{xtype:"combobox",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",valueField:"codice",typeAhead:!0,matchFieldWidth:!1,listConfig:{width:300}}},{xtype:"gridcolumn",dataIndex:"durata",text:"DURATA",flex:1,align:"center",renderer:function(b,c,d,f,g,h,k){return d.get("desDurata")},editor:{xtype:"combobox",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",valueField:"codice",
typeAhead:!0}},{xtype:"gridcolumn",dataIndex:"convenzionatoFSR",text:"CONVENZIONATE",align:"center",renderer:function(b,c){renderCheckColumn(c,b)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"idOrganizzazione",hidden:!0}],viewConfig:{getRowClass:function(b,c,d,f){if(b&&"T"==b.get("stato"))return"non_attivi"},loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",
itemId:"BtnSblocca",reference:"BtnSblocca",iconCls:"icon-locked",text:"SBLOCCA"},{xtype:"label",margin:"0 0 0 10",itemId:"LblSblocco",reference:"LblSblocco",text:"MSG_ATTIVAZIONE_VIDEATABLOCCATA"},{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO",hidden:!0},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA",hidden:!0},{xtype:"tbspacer",width:10},{xtype:"button",itemId:"BtnConvenzioneCom",reference:"BtnConvenzioneCom",
iconCls:"icon-circolari",text:"CONVENZIONECOMMERCIALE",hidden:!0}]}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonProfilazioneClassificazioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"Container",reference:"Container",title:traduci("PROFILAZIONI_CLASSIFICAZIONI"),layout:{type:"vbox",align:"stretch"},autoScroll:!0,flex:1,items:[{xtype:"gridpanel",border:0,itemId:"GrigliaProfili",reference:"GrigliaProfili",flex:.3,title:"",store:Ext.create("Generali.data.StoreCodiceValore",
{proxy:{urlGen:"/ws/genOsp/prszn/profilazioneAnagrafica/cbox"},autoLoad:!1}),viewConfig:{getRowClass:function(b,c,d,f){if(b&&"T"==b.get("extra"))return"non_attivi"},loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"codice",hidden:!0},{xtype:"gridcolumn",dataIndex:"valore",text:"DESCRIZIONE",allowBlank:!1,flex:1}]},{xtype:"gridpanel",border:0,itemId:"GrigliaProfiliClass",reference:"GrigliaProfiliClass",flex:.7,title:"",store:Ext.create("GeneraliOSP.personalizzazioni.store.PersonProfilazioneClassificazione"),
viewConfig:{getRowClass:function(b,c,d,f){if(b&&"T"==b.get("stato"))return"non_attivi"},loadMask:!1},columns:[{xtype:"gridcolumn",width:65,align:"center",dataIndex:"stato",text:"DISATTIVATO",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"},renderer:function(b,c,d,f,g,h,k){"T"==b&&(c.tdCls="icon-deseleziona")}},{xtype:"gridcolumn",dataIndex:"idRisposta",text:"DESCRIZIONE",allowBlank:!1,flex:1,renderer:function(b,c,d,f,g,h,k){(b=d.get("desRisposta"))&&""!=b&&(d=b.split("#"),b=d[0],"T"==
d[1]&&(c.tdCls="testoAnnullato"));return b},editor:{xtype:"combobox",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",valueField:"codice",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Classificazioni"),typeAhead:!0,listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}}},{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"idServizio",hidden:!0},{xtype:"gridcolumn",dataIndex:"idAnagraficaProfilazione",hidden:!0}],viewConfig:{getRowClass:function(b,
c,d,f){if(b&&"T"==b.get("stato"))return"non_attivi"},loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"}]}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonRaccordiFR",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox"},flex:1,items:[{xtype:"combobox",itemId:"TipoFlusso",reference:"TipoFlusso",margin:"15 0 0 15",width:600,labelWidth:150,fieldLabel:"TIPOFLUSSOREGIONALE",labelClsExtra:"cbaLabel",name:"tipoFlusso",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",
store:Ext.create("GeneraliOSP.store.TipoFlusso"),valueField:"codice"},{xtype:"fieldset",title:"FR_PERSON_TAB_RACCORDI",layout:{type:"vbox"},margin:"15 0 0 15",width:600,itemId:"FsRaccordi",reference:"FsRaccordi",items:[{xtype:"radiogroup",width:560,columns:3,vertical:!0,itemId:"RgbTabellaRaccordo",reference:"RgbTabellaRaccordo",margin:"0 0 0 0",items:[{boxLabel:"Stato civile",formId:this.getItemId()+"-form",itemId:"RbStatoCivile",reference:"RbStatoCivile",name:"rbTabellaRaccordo",inputValue:"SC",
cls:"cbaLabel"},{boxLabel:"GRADO_ISTRUZIONE",formId:this.getItemId()+"-form",itemId:"RbGradoIstruzione",reference:"RbGradoIstruzione",name:"rbTabellaRaccordo",inputValue:"GI",cls:"cbaLabel"},{boxLabel:"MOTIVI_DIM",formId:this.getItemId()+"-form",itemId:"RbMotiviDimissione",reference:"RbMotiviDimissione",name:"rbTabellaRaccordo",inputValue:"MD",cls:"cbaLabel"},{boxLabel:"TIPO_PROVENIENZA",formId:this.getItemId()+"-form",itemId:"RbProvenienza",reference:"RbProvenienza",name:"rbTabellaRaccordo",inputValue:"SP",
cls:"cbaLabel"},{boxLabel:"INIZIATIVA_RICHIESTA",formId:this.getItemId()+"-form",itemId:"RbIniziativaRichiesta",reference:"RbIniziativaRichiesta",name:"rbTabellaRaccordo",inputValue:"RI",cls:"cbaLabel"},{boxLabel:"PROFESSIONE_PREVALENTE",formId:this.getItemId()+"-form",itemId:"RbProfessione",reference:"RbProfessione",name:"rbTabellaRaccordo",inputValue:"PI",cls:"cbaLabel"},{boxLabel:"MOTIVI_USCITA_TEMP",formId:this.getItemId()+"-form",itemId:"RbMotiviUscita",reference:"RbMotiviUscita",name:"rbTabellaRaccordo",
inputValue:"MUT",cls:"cbaLabel"},{boxLabel:"TIPO_MEDICO",formId:this.getItemId()+"-form",itemId:"RbTipoMedico",reference:"RbTipoMedico",name:"rbTabellaRaccordo",inputValue:"TM",cls:"cbaLabel"},{boxLabel:"POSIZIONE_TICKET",formId:this.getItemId()+"-form",itemId:"RbPosizioneTicket",reference:"RbPosizioneTicket",name:"rbTabellaRaccordo",inputValue:"PT",cls:"cbaLabel"},{boxLabel:"TIPO_ESENZIONE_TICKET",formId:this.getItemId()+"-form",itemId:"RbTipoEsenzioneTicket",reference:"RbTipoEsenzioneTicket",name:"rbTabellaRaccordo",
inputValue:"ET",cls:"cbaLabel"},{boxLabel:"ONERE_DEGENZA",formId:this.getItemId()+"-form",itemId:"RbOnereDegenza",reference:"RbOnereDegenza",name:"rbTabellaRaccordo",inputValue:"OD",cls:"cbaLabel"},{boxLabel:"MOTIVAZIONE_INGRESSO",formId:this.getItemId()+"-form",itemId:"RbMotIngresso",reference:"RbMotIngresso",name:"rbTabellaRaccordo",inputValue:"MR",cls:"cbaLabel"},{boxLabel:"CLASSE_PRIORITA",formId:this.getItemId()+"-form",itemId:"RbClassePriorita",reference:"RbClassePriorita",name:"rbTabellaRaccordo",
inputValue:"CLP",cls:"cbaLabel"},{boxLabel:"TIPO_RICETTA",formId:this.getItemId()+"-form",itemId:"RbTipoRicetta",reference:"RbTipoRicetta",name:"rbTabellaRaccordo",inputValue:"CR",cls:"cbaLabel"}]}]},{xtype:"container",border:0,layout:{type:"vbox"},flex:1,items:[{xtype:"panel",border:0,flex:1,margin:"15 0 0 15",itemId:"pnlTabella",reference:"pnlTabella",width:600,layout:{type:"vbox"},title:"-",items:[{xtype:"gridpanel",border:0,flex:1,margin:"0 0 10 0",width:600,itemId:"GridTabella",reference:"GridTabella",
store:Ext.create("GeneraliOSP.personalizzazioni.store.PersonRaccordiFR"),title:"",autoScroll:!0,dockedItems:[{xtype:"toolbar",itemId:"BtnToolbar",reference:"BtnToolbar",dock:"top",border:0,items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}],columns:[{xtype:"gridcolumn",itemId:"colDescrizione",reference:"colDescrizione",dataIndex:"desRisposta",
text:"descrizione",flex:1,renderer:function(b,c,d,f,g,h,k){"T"==d.get("statoRisposta")&&(c.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");return b}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){f=getColGrid(k,"codice");f=f.getEditor().getStore()?f.getEditor().getStore():!1;[13,14,15].includes(d.data.tipoFlusso)&&"MR"===this.up().up().up().down("#RgbTabellaRaccordo").getValue().rbTabellaRaccordo&&!Ext.isEmpty(d.data.associataA)&&(f.clearFilter(),
f.filter({filterFn:function(b){return"1"==d.data.associataA&&"MRO"==b.data.extra||"2"==d.data.associataA&&"MRD"==b.data.extra}}));if(b&&f){if(b=trovaRecord(f,"codice",b))return b.data.valore}else return c.tdCls="non_attivi",traduci("FR_PERSON_RACCORDO_EMPTYTEXT")},dataIndex:"codice",text:"FR_PERSON_RACCORDO",style:"font-weight:bold",flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){d=getColGrid(k,"associataA");d=d.getEditor().getStore()?d.getEditor().getStore():!1;if(b&&d){if(b=trovaRecord(d,
"codice",b))return b.data.valore}else return c.tdCls="non_attivi",traduci("FR_PERSON_RACCORDO_EMPTYTEXT")},dataIndex:"associataA",text:"FR_PERSON_RACCORDO_ASL",style:"font-weight:bold",flex:1,allowBlank:!0}],features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonServizi",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"grigliaServizi",reference:"grigliaServizi",flex:1,store:Ext.create("GeneraliOSP.personalizzazioni.store.PersonServizi"),title:"LISTA_SERVIZI",autoScroll:!0,dockedItems:[{xtype:"toolbar",dock:"top",border:0,itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"btnNuovo",
reference:"btnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"btnElimina",reference:"btnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"button",itemId:"btnAbilitazioni",reference:"btnAbilitazioni",iconCls:"icon-processing",text:"ABILITAZIONI"}]}],columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"DESCRIZIONE",flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}},{xtype:"gridcolumn",itemId:"colTipoServizio",reference:"colTipoServizio",
renderer:function(b,c,d,f,g,h,k){return d.data.desTipoServizio},dataIndex:"tipoServizio",text:"TIPO_SERVIZIO",flex:1,editor:{xtype:"combobox",hideLabel:!0,name:"tipoServizio",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.personalizzazioni.store.TipoServizio"),typeAhead:!0,valueField:"codice",matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",dataIndex:"sigla",text:"SIGLA",flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:4,enforceMaxLength:!0}},
{xtype:"gridcolumn",dataIndex:"tipoFlusso",text:"TIPOFLUSSOREGIONALE",flex:1,itemId:"colTipoFlusso",reference:"colTipoFlusso",renderer:function(b,c,d,f,g,h,k){return d.data.desTipoFlusso},editor:{xtype:"combobox",hideLabel:!0,name:"tipoFlusso",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/servizi/flussiReg"}}),typeAhead:!0,valueField:"codice",matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",
itemId:"colRegione",reference:"colRegione",renderer:function(b,c,d,f,g,h,k){return d.data.desRegione},dataIndex:"regione",text:"REGIONE",flex:1,editor:{xtype:"combobox",hideLabel:!0,name:"regione",displayField:"valore",queryMode:"local",store:Ext.create("Generali.store.Regione"),typeAhead:!0,valueField:"codice",listeners:{change:function(b){this.up("#grigliaServizi").controller.reloadStoreASL(this)}},matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"colASL",
reference:"colASL",renderer:function(b,c,d,f,g,h,k){return d.data.desAsl},dataIndex:"codAsl",text:"L"==CBA.moduli.modulo43.regioni?"IND_ATS":"IND_ASL",flex:1,editor:{xtype:"combobox",hideLabel:!0,name:"codAsl",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.AziendeSanitarie"),typeAhead:!0,valueField:"codice",allowBlank:55!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo,listeners:{change:function(b){this.up("#grigliaServizi").controller.reloadStoreASST(this)}},
matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"colASST",reference:"colASST",renderer:function(b,c,d,f,g,h,k){return d.data.desAsst},dataIndex:"codAsst",text:"DISTRETTO",flex:1,editor:{xtype:"combobox",hideLabel:!0,name:"codAsst",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.AziendeSanitarieDettaglio"),typeAhead:!0,valueField:"codice",allowBlank:!0,matchFieldWidth:!1,listConfig:{width:300,heigth:200,loadMask:!1}},
hidden:43!=CBA.moduli.moduloAttivo},{xtype:"gridcolumn",dataIndex:"codiceStruttura",text:"CODICESTRUTTURA",flex:1,hidden:![43,55,64].includes(CBA.moduli.moduloAttivo),editor:{xtype:"textfield",maxLength:6,minLength:5,enforceMaxLength:!0,allowBlank:55!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo}},{xtype:"gridcolumn",dataIndex:"cudes",text:"CUDES",flex:1,hidden:43!=CBA.moduli.moduloAttivo,editor:{xtype:"textfield",maxLength:6,minLength:6,enforceMaxLength:!0,allowBlank:!0}},{xtype:"gridcolumn",
itemId:"ColBudget",reference:"ColBudget",renderer:function(b,c,d,f,g,h,k){return d.data.desPersBudget},dataIndex:"idPersBudget",text:"RAP_BDG",flex:1,hidden:64!=CBA.moduli.moduloAttivo,editor:{xtype:"combobox",hideLabel:!0,name:"idPersBudget",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore"),typeAhead:!0,valueField:"codice",matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"colTipoPresidio",reference:"colTipoPresidio",
renderer:function(b,c,d,f,g,h,k){return d.data.desTipoPresidio},dataIndex:"tipoPresidio",text:"FAR_TIPO_PRESIDIO",flex:1,hidden:!0,editor:{xtype:"combobox",hideLabel:!0,name:"tipoPresidio",typeAhead:!0,valueField:"codice",allowBlank:!0,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"colBollo",reference:"colBollo",renderer:function(b,c,d,f,g,h,k){return d.data.desPersBollo},
dataIndex:"idPersBollo",text:"PERSONBOLLO",flex:1,hidden:43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo,editor:{xtype:"combobox",hideLabel:!0,name:"idPersBollo",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore"),typeAhead:!0,valueField:"codice",allowBlank:43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo,matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"colPersContabili",reference:"colPersContabili",
renderer:function(b,c,d,f,g,h,k){return d.data.desPersContabili},dataIndex:"idPersContabili",text:"PERSONCONTABILI",flex:1,hidden:43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo,editor:{xtype:"combobox",hideLabel:!0,name:"idPersContabili",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore"),typeAhead:!0,valueField:"codice",allowBlank:43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo,matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},
{xtype:"gridcolumn",itemId:"colCalcoloRette",reference:"colCalcoloRette",renderer:function(b,c,d,f,g,h,k){return d.data.desPersCalcoloRette},dataIndex:"idPersCalcoloRette",text:"PERSONCALCOLORETTE",flex:1,hidden:43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo,editor:{xtype:"combobox",hideLabel:!0,name:"idPersCalcoloRette",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore"),typeAhead:!0,valueField:"codice",allowBlank:43!=CBA.moduli.moduloAttivo&&50!=
CBA.moduli.moduloAttivo,matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"colPresenze",reference:"colPresenze",renderer:function(b,c,d,f,g,h,k){return d.data.desPersPresenze},dataIndex:"idPersPresenze",text:"PERSONPRESENZE",flex:1,hidden:43!=CBA.moduli.moduloAttivo&&55!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo,editor:{xtype:"combobox",hideLabel:!0,name:"idPersPresenze",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore"),
typeAhead:!0,valueField:"codice",allowBlank:43!=CBA.moduli.moduloAttivo&&55!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo&&64!=CBA.moduli.moduloAttivo,matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"colFestivita",reference:"colFestivita",renderer:function(b,c,d,f,g,h,k){return d.data.desPersFestivita},dataIndex:"idPersFestivita",text:"PERSONFESTIVITA",flex:1,hidden:![43,50,55,64].includes(CBA.moduli.moduloAttivo),editor:{xtype:"combobox",hideLabel:!0,
name:"idPersFestivita",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore"),typeAhead:!0,valueField:"codice",allowBlank:43!=CBA.moduli.moduloAttivo&&55!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo,matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"colGGApertura",reference:"colGGApertura",renderer:function(b,c,d,f,g,h,k){return d.data.desPersGiorniApertura},dataIndex:"idPersGiorniApertura",text:"PERSONGIORNIAPERTURA",
flex:1,hidden:![43,50,55,64].includes(CBA.moduli.moduloAttivo),editor:{xtype:"combobox",hideLabel:!0,name:"idPersGiorniApertura",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore"),typeAhead:!0,valueField:"codice",allowBlank:![43,50,55].includes(CBA.moduli.moduloAttivo),matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",itemId:"ColPersServizio",reference:"ColPersServizio",renderer:function(b,c,d,f,g,h,k){return d.data.desPersServizio},
dataIndex:"idPersServizio",text:"IMPOSTAZIONI_SERVIZIO",flex:1,hidden:![43,48,50,55].includes(CBA.moduli.moduloAttivo),editor:{xtype:"combobox",hideLabel:!0,name:"idPersServizio",displayField:"descrizione",queryMode:"local",store:Ext.create("GeneraliOSP.personalizzazioni.store.ImpostazioniServizio"),typeAhead:!0,valueField:"id",allowBlank:![43,48,50,55].includes(CBA.moduli.moduloAttivo),matchFieldWidth:!1,listConfig:{width:300,heigth:200,loadMask:!1}}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",
{autoCancel:!1,errorSummary:!1})]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.PersonTree",{extend:"Generali.standard.ControlledContainer",border:0,height:700,layout:{type:"fit"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"PERSONALIZZAZIONI"},{xtype:"panel",region:"center",border:0,itemId:"content",reference:"content",
layout:{align:"stretch",type:"vbox"}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.personalizzazioni.view.StruttureOspedaliere",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,title:traduci("STRUTTURE_OSPEDALIERE"),itemId:"Container",reference:"Container",layout:{type:"vbox",align:"stretch"},autoScroll:!0,flex:1,items:[{xtype:"gridpanel",border:0,itemId:"Griglia",reference:"Griglia",flex:1,title:"",store:Ext.create("GeneraliOSP.personalizzazioni.store.StruttureOspedaliere"),viewConfig:{loadMask:!1},
columns:[{xtype:"gridcolumn",itemId:"colRegione",reference:"colRegione",dataIndex:"regione",text:"REGIONE",allowBlank:!1,flex:1,align:"center",editor:{xtype:"combobox",itemId:"CbRegione",reference:"CbRegione",hideLabel:!0,allowBlank:!1,queryMode:"local",displayField:"valore",valueField:"codice",store:Ext.create("Generali.store.Regione"),typeAhead:!0},renderer:function(b,c,d,f,g,h,k){return d.get("desRegione")}},{xtype:"gridcolumn",dataIndex:"citta",text:"CITTA",allowBlank:!1,flex:1,align:"center",
editor:{xtype:"textfield",allowBlank:!1}},{xtype:"gridcolumn",dataIndex:"codiceOspedale",text:"CODICE_OSPEDALE",allowBlank:!1,flex:1,align:"center",editor:{xtype:"textfield",allowBlank:!1,maxLength:6,enforceMaxLength:!0}},{xtype:"gridcolumn",dataIndex:"descrizione",text:"DESCRIZIONE",allowBlank:!1,flex:1,align:"center",editor:{xtype:"textfield",allowBlank:!1}},{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"recordUtente",hidden:!0}],viewConfig:{loadMask:!1,width:800},
dockedItems:[{xtype:"toolbar",dock:"top",itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"}]}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.controller.Assenze",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:b+"#Container"},{ref:"boxBottoni",selector:b+"#boxBottoni"},{ref:"pnlTestataCal",selector:b+"#pnlTestataCal"},{ref:"giorniAssenza",selector:b+"#giorniAssenza"},{ref:"EditAssenzeForm",selector:b+"#EditAssenzeForm"},{ref:"EditAssenzeCal",selector:b+"#EditAssenzeCal"},{ref:"EditAssenzeCalendario",
selector:b+"#EditAssenzeCalendario"},{ref:"StoricoGridAssenze",selector:b+"#StoricoGridAssenze"},{ref:"cntOspedale",selector:b+"#cntOspedale"},{ref:"cbOspedale",selector:b+"#cbOspedale"},{ref:"cbConAssistenza",selector:b+"#cbConAssistenza"},{ref:"EditAssenzeRecordId",selector:b+"#EditAssenzeRecordId"},{ref:"editAssenzaMotivo",selector:b+"#editAssenzaMotivo"},{ref:"editAssenzaDataDal",selector:b+"#editAssenzaDataDal"},{ref:"editAssenzaDataAl",selector:b+"#editAssenzaDataAl"},{ref:"editAssenzaOraInizio",
selector:b+"#editAssenzaOraInizio"},{ref:"editAssenzaOraFine",selector:b+"#editAssenzaOraFine"},{ref:"EditAssenzeAnno",selector:b+"#EditAssenzeAnno"},{ref:"ImgOraInizio",selector:b+"#ImgOraInizio"},{ref:"ImgOraFine",selector:b+"#ImgOraFine"},{ref:"notes",selector:b+"#notes"},{ref:"EditAssenzeIdAssenzaCs",selector:b+"#EditAssenzeIdAssenzaCs"}]);this.control(b+"#giorniAssenza",{afterrender:this.onTextfieldAfterRender});this.control(b+"#StoricoGridAssenze",{select:this.onStoricoGridAssenzeItemClick});
this.control(b+"#ImgOraInizio",{afterrender:this.onImageInizioAfterRender});this.control(b+"#ImgOraFine",{afterrender:this.onImageFineAfterRender});this.control(b+"#EditAssenzeCal",{beforerender:this.onEditAssenzeCalBeforeRender});this.control(b+"#EditAssenzeAnno",{change:this.onEditAssenzeAnnoChange});this.control(b+"#editAssenzaMotivo",{change:this.onEditAssenzaMotivoChange})},onEditAssenzaMotivoChange:function(b,c,d){svuotaStore(this.storeElencoRegole);Ext.isEmpty(c)||(b=b.getSelectedRecord().getData().regole,
Ext.isEmpty(b)||this.storeElencoRegole.loadData(b))},onImageInizioAfterRender:function(b,c){creaToolTip(b.getId(),"","",!1,!1,!1,!1,function(c){c.update(b.msgTooltip)})},onImageFineAfterRender:function(b,c){creaToolTip(b.getId(),"","",!1,!1,!1,!1,function(c){c.update(b.msgTooltip)})},onTextfieldAfterRender:function(b,c){var d=this;creaToolTipInfo(b,"","",!1,!1,!1,!1,function(b){var c=d.getEditAssenzeCal(),c=traduci("ASS_TIPOCALCOLO")+" "+c.queryById("classificazione").getSelectedLabel();b.update(c)})},
onStoricoGridAssenzeItemClick:function(b,c,d,f,g,h){this.impostaDati(c);permettiModificheDopoDimissione()||(containerSolaLettura(me.getEditAssenzeForm()),me.getEditAssenzeForm().boxBottoni.queryById("btnElimina").setDisabled(!0),me.getEditAssenzeForm().boxBottoni.queryById("btnNuovo").setDisabled(!0))},onEditAssenzeAnnoChange:function(b,c,d,f){b.puoiCambiare&&(this.getEditAssenzeForm().getForm(),b=this.getEditAssenzeCal().queryById("classificazione").getValue(),this.aggiornaCalendario(b))},onEditAssenzeCalBeforeRender:function(b,
c){if("S"!=currRicovero.servizio.tipoServizio&&"A"!=currRicovero.servizio.tipoServizio&&"M"!=currRicovero.servizio.tipoServizio){var d=this.getEditAssenzeAnno();d.setHideTrigger(!1);d.puoiCambiare=!1;d.setValue(Ext.util.Format.date(new Date,"Y"));d.puoiCambiare=!0}else this.getEditAssenzeCal().hide()},nuovo:function(){controller_nuovoRecord(this.getEditAssenzeForm());this.getEditAssenzeForm().getForm().setValues({idAssenza:-9999});this.getEditAssenzeCalendario().getStore().loadData([],!1);this.getEditAssenzaDataDal().setValue(new Date);
this.getEditAssenzaOraInizio().setValue(new Date);this.getImgOraInizio().hide();this.getImgOraFine().hide()},verificaCampiForm:function(){var b=[],c=this.getEditAssenzeForm().getForm();c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");c.findField("dataDal").getValue()>c.findField("dataAl").getValue()&&c.findField("dataAl").getValue()&&msgAddError(b,"MSG_DATADAL_MAGGIORE_DATAAL");return msgShow("",b)},beforeSalva:function(b){var c=this,d=c.getEditAssenzeForm().getForm().getFieldValues();(null===
d.id||0>=d.id)&&!Ext.isEmpty(c.storeElencoRegole.getData().items)?1<c.storeElencoRegole.getData().items.length&&"N"!=c.storeElencoRegole.getData().items[0].get("operazioneNuovo")?Ext.create("winCBA",{permesso:"S",larghezzaWin:420,altezzaWin:200,name:"GeneraliOSP.raccordoAssenze.view.WinRaccordoAssenze",titolo:"Selezionare Motivo Assenza",maximizable:!1,closable:!1,configItem:{store:c.storeElencoRegole,onSave:function(b,d,h){c.salva(b,d,h)},onCancel:function(){c.aggiornaStore()},testoHtml:"Selezionare il motivo di Assenza da creare in CSS2",
lbl:"Motivo Assenza",esci:b}}).show():(d=c.storeElencoRegole.getData().items[0].data.idPadre||c.storeElencoRegole.getData().items[0].data.id,c.salva(b,c.storeElencoRegole.getData().items[0].data.idEsterno,d)):c.salva(b)},salva:function(b,c,d,f){var g=this;if(!this.verificaCampiForm())return!1;var h=g.getEditAssenzaDataDal().getValue();h.setHours(Ext.util.Format.date(g.getEditAssenzaOraInizio().getValue(),"H"),Ext.util.Format.date(g.getEditAssenzaOraInizio().getValue(),"i"));var k;g.getEditAssenzaDataAl().getValue()&&
(k=g.getEditAssenzaDataAl().getValue(),k.setHours(Ext.util.Format.date(g.getEditAssenzaOraFine().getValue(),"H"),Ext.util.Format.date(g.getEditAssenzaOraFine().getValue(),"i")));var l={idAssenza:g.getEditAssenzeRecordId().getValue(),idRicovero:currRicovero.idRicovero,dataDal:h,dataAl:k,motivoUscita:g.getEditAssenzaMotivo().getValue(),codiceOspedale:g.getEditAssenzeForm().getForm().getFieldValues().codiceOspedale,conAssistenza:getBoolValue(g.getEditAssenzeForm().getForm().getFieldValues().conAssistenza),
note:g.getNotes().getValue(),idAssenzaCs:g.getEditAssenzeIdAssenzaCs().getValue()};k=g.getEditAssenzeCal().queryById("classificazione").getValue();h={};Ext.apply(h,{tipoClass:k});Ext.isEmpty(d)||(Ext.apply(h,{idRegola:d}),Ext.isEmpty(c)||Ext.apply(h,{idEsterno:c}));f&&Ext.apply(h,{forceStore:!0});f=Ext.isEmpty(l.idAssenza)||0>=l.idAssenza?g.getEditAssenzeForm().store.getProxy().api.create:g.getEditAssenzeForm().store.getProxy().api.update;Ext.Ajax.request({method:"POST",url:f,jsonData:l,async:!1,
params:h,success:function(f){var h=Ext.JSON.decode(f.responseText);h.success?(f=h.data)?(!Ext.isEmpty(l.idAssenza)&&f.motivoUscita&&f.listAssenzeCs?g.creaWinSceltaAssenzaCs(f.listAssenzeCs,f.motivoUscita):g.generaMessaggio(h.message),g.aggiornaStore(f.id)):editor.startEdit(context.record,0):h.message&&("?"==h.message[0]||h.message[0].testo&&"?"==h.message[0].testo[0])?Messaggio("ATTENZIONE",h.message[0].testo.slice(1),"YESNO","QUESTION",!1,function(){g.salva(b,c,d,!0)},function(){g.getEditAssenzeForm().boxBottoni.queryById("btnNuovo").setDisabled(!0);
g.getEditAssenzeForm().boxBottoni.queryById("btnElimina").setDisabled(!0);g.getEditAssenzeForm().boxBottoni.queryById("btnAnnulla").setDisabled(!1);g.getEditAssenzeForm().boxBottoni.queryById("btnConferma").setDisabled(!1);g.getEditAssenzeForm().boxBottoni.queryById("btnEsci").setDisabled(!1)}):msgShowError("ERRORE",h.message)}})},creaWinSceltaAssenzaCs:function(b,c){this.storeAssenzeCs.loadData(b);Ext.create("winCBA",{permesso:"S",larghezzaWin:450,altezzaWin:200,name:"GeneraliOSP.raccordoAssenze.view.WinSincroAssenzaCollegata",
titolo:"Selezionare Assenza di CSS2",maximizable:!1,configItem:{store:this.storeAssenzeCs,htmlText:"Selezionare assenza aperta in CSS2 per l'ospite <i></i> che si desidera chiudere",dalProperty:"dal",alProperty:"al",url:"/ws/genOsp/assenzeCs/sincro",idMotivo:c}}).show()},generaMessaggio:function(b){b&&1<b.length?msgShowWarning("ATTENZIONE",b):msgShow("MSG_SALVATAGGIO_DATI",b)},impostaDati:function(b){var c=this.getEditAssenzeForm();c.suspendEvents();this.getStoricoGridAssenze().setDisabled(!1);clearForm(c);
b&&(Ext.apply(b.data,{oraInizio:b.data.dataDal,notes:b.data.note}),b.data.dataAl&&Ext.apply(b.data,{oraFine:b.data.dataAl}),this.getCbOspedale().setValueNotFoundText(b.data.codiceOspedale),this.getEditAssenzeForm().loadRecord(b));"S"!=currRicovero.servizio.tipoServizio&&"A"!=currRicovero.servizio.tipoServizio&&"M"!=currRicovero.servizio.tipoServizio?(this.getImgOraInizio().show(),this.getImgOraFine().show(),this.calcolaGiorniAssenza()):(this.getImgOraInizio().hide(),this.getImgOraFine().hide());c.resumeEvents()},
aggiornaStore:function(b){var c=this,d=c.getStoricoGridAssenze().getStore();d.load({params:{idRicovero:currRicovero.idRicovero},callback:function(f,g,h){h?Ext.isEmpty(f)?permettiModificheDopoDimissione()?(clearForm(c.getEditAssenzeForm()),f=c.getEditAssenzeCal().queryById("classificazione").getValue(),c.aggiornaCalendario(f)):(containerSolaLettura(c.getEditAssenzeForm()),c.getEditAssenzeForm().boxBottoni.queryById("btnNuovo").setDisabled(!0),c.getEditAssenzeForm().boxBottoni.queryById("btnElimina").setDisabled(!0),
c.getEditAssenzeForm().boxBottoni.queryById("btnAnnulla").setDisabled(!0),c.getEditAssenzeForm().boxBottoni.queryById("btnConferma").setDisabled(!0),c.getEditAssenzeForm().boxBottoni.queryById("btnEsci").setDisabled(!1)):(b||(b=c.getEditAssenzeRecordId().getValue()),f=trovaRecord(d,"idAssenza",b),g=c.getStoricoGridAssenze(),g.getSelectionModel().deselectAll(),g.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}})},calcolaGiorniAssenza:function(){var b=this,c=b.getEditAssenzeForm().getForm(),
d=b.getEditAssenzeCal().queryById("classificazione").getValue(),f=Ext.Date.clone(b.getEditAssenzaDataDal().getValue());f&&f.setHours(Ext.util.Format.date(b.getEditAssenzaOraInizio().getValue(),"H"),Ext.util.Format.date(b.getEditAssenzaOraInizio().getValue(),"i"));var g;b.getEditAssenzaDataAl().getValue()&&(g=Ext.Date.clone(b.getEditAssenzaDataAl().getValue()),g.setHours(Ext.util.Format.date(b.getEditAssenzaOraFine().getValue(),"H"),Ext.util.Format.date(b.getEditAssenzaOraFine().getValue(),"i")));
var h=currRicovero.dataAl;h&&Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/prszn/prsnz/ultimogiornoricovero",params:{idServizio:currRicovero.idServizio,tipo:d,data:h,motivoDimissione:currRicovero.motivoDimissione},method:"GET",async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?!b.data&&h>g&&(h=Ext.Date.subtract(h,Ext.Date.DAY,1)):msgShowError("",b.message)}});f?Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/asstemp/calcDays",params:{idServizio:currRicovero.idServizio,
dataDimissione:h,tipoClass:d,assenzaDal:f,assenzaAl:g},success:function(f){f=Ext.JSON.decode(f.responseText);var g=b.getImgOraInizio();g.removeCls("presente");g.removeCls("assente");var h=b.getImgOraFine();h.removeCls("presente");h.removeCls("assente");f.success?(c.setValues({giorniAssenza:f.data.ggAssenza}),"P"==f.data.tipoPresenzaUscita?g.addCls("presente"):g.addCls("assente"),g.msgTooltip=f.data.descPresenzaUscita,"P"==f.data.tipoPresenzaRientro?h.addCls("presente"):h.addCls("assente"),h.msgTooltip=
f.data.descPresenzaRientro,b.aggiornaCalendario(d)):msgShowError("",f.message)}}):b.aggiornaCalendario(d)},aggiornaCalendario:function(b){var c=this,d=c.getEditAssenzeAnno().getValue();abilitaCmp(c.getEditAssenzeAnno(),!1);var f=[],g,h,k,l,n=new Date,p,q=creaData(1,1,d),r=creaData(31,12,d);p=currRicovero.dataAl?currRicovero.dataAl:n;currRicovero.dataDal>q&&(q=currRicovero.dataDal);var t=currRicovero.dataDal;t.setHours(0,0,0);var u=new Date(currRicovero.dataAl);u.setHours(0,0,0);for(var x=1;12>=x;x++){g=
Ext.util.Format.date(dataFineMese(x,d),"d");h=[getMese(x)];for(var v=1;31>=v;v++){var w=creaData(v,x,d);v>g?h.push(["X"]):w<t||currRicovero.dataAl&&w>u?h.push(["D"]):Ext.Date.isEqual(w,t)?Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/prszn/prsnz/primogiornoricovero",params:{idServizio:currRicovero.idServizio,tipo:b,data:currRicovero.dataDal},method:"GET",async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?b.data?h.push(["P"]):h.push(["D"]):msgShowError("",b.message)}}):currRicovero.dataAl&&
Ext.Date.isEqual(w,u)?Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/prszn/prsnz/ultimogiornoricovero",params:{idServizio:currRicovero.idServizio,tipo:b,data:currRicovero.dataAl,motivoDimissione:currRicovero.motivoDimissione},method:"GET",async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?b.data?h.push(["P"]):h.push(["D"]):msgShowError("",b.message)}}):w<n?h.push(["P"]):h.push(["N"])}f.push(h)}c.getEditAssenzeCalendario().getStore().loadData(f);Ext.Ajax.request({url:getUrlGen()+
"/ws/genOsp/asstemp/bydate",params:{idRicovero:currRicovero.idRicovero,tipoClass:b,dataDal:creaData(1,1,d),dataAl:creaData(31,12,d)},method:"GET",success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){if(b.data){Ext.suspendLayouts();for(var d=0;d<b.data.length;d++){var f=Ext.Date.parse(b.data[d].dataDal,"c"),g=Ext.Date.parse(b.data[d].dataAl,"c");b.data[d].dataAl||(g=p);f.setHours(0,0,0,0);for(g.setHours(0,0,0,0);f<=g;f.setDate(f.getDate()+1))k=Ext.util.Format.date(new Date(f),"m"),l=
Ext.util.Format.date(new Date(f),"d"),f>=q&&f<=p&&f<=r&&c.getEditAssenzeCalendario().getStore().getAt(k-1).set("gg"+parseFloat(l),"A")}Ext.resumeLayouts(!0)}}else msgShowError("",b.message);abilitaCmp(c.getEditAssenzeAnno(),!0)},failure:function(b){}})},refreshDatiVideataFascicolo:function(){var b={},c=this.cbaConfig.ricerca?this.cbaConfig.ricerca:this.cbaConfig.controllerFascicolo.Ricerca;Ext.apply(b,{codOspite:this.cbaConfig.codOspite});c.controller.cerca(b)},caricaComboOspedali:function(){var b=
this;this.showOspedali=!1;[50,64].includes(CBA.moduli.moduloAttivo)||(new Promise(function(b,d){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/prszn/servizio/impostazioni",params:{idServizio:currRicovero.servizio.id},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?b(c.data):d(c.message)},failure:function(b){d(b.status+" "+b.statusText)}})})).then(function(c){c=c?StdSipcar.coalesce(c.gestioneStrutturaAssenza,"F"):"F";b.showOspedali="T"==c;b.showOspedali&&(b.storeOspedale=
Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/ospedali/cbox"},autoLoad:!1,autoDestroy:!1}),loadStore(b.storeOspedale,{regione:currRicovero.servizio.regione}),b.getCbOspedale().bindStore(b.storeOspedale),b.getCbOspedale().setVisible(!0));b.getCbConAssistenza().setVisible("L"==currRicovero.servizio.regione);b.getCntOspedale().setVisible(b.showOspedali||"L"==currRicovero.servizio.regione)})["catch"](function(b){msgShowError("",b)})},onLaunch:function(){var b=this,c=
b.getEditAssenzeForm();b.getContainer().controller=b;b.getStoricoGridAssenze().controller=b;c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();c.store=b.getStoricoGridAssenze().getStore();ImpostaUrl([c.store,b.getEditAssenzaMotivo().getStore()]);c.controller=b;b.caricaComboOspedali();var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.beforeSalva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},
elimina_callback:function(){var d=c.getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,{idAssenza:d},function(){b.aggiornaStore()})},esci_callback:function(){var d=c.up("window");controller_puoiUscire(d,c,function(){b.salva(!0);b.refreshDatiVideataFascicolo()},function(){b.refreshDatiVideataFascicolo();b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()},function(){b.refreshDatiVideataFascicolo();
b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),d);d=Ext.create("classificazione",{xtype:"classificazione",itemId:"classificazione",reference:"classificazione",columns:3,width:500,title:"",fieldLabel:"ASS_TIPOCALCOLO",labelWidth:220,margin:"2 0 2 0"});this.getPnlTestataCal().insert(1,d);this.getGiorniAssenza().setVisible("S"!=
currRicovero.servizio.tipoServizio&&"A"!=currRicovero.servizio.tipoServizio&&"M"!=currRicovero.servizio.tipoServizio);d.down("radiogroup").on("change",function(c,d){b.calcolaGiorniAssenza()});d=b.getContainer().up("window");Localizer.localize(d);b.getEditAssenzeCalendario().getStore().loadData([],!1);this.aggiornaStore();loadStore(b.getEditAssenzaMotivo().getStore(),{idServizio:currRicovero.idServizio,scheda:"H",domanda:2,idRicovero:currRicovero.idRicovero});b.getEditAssenzeRecordId().hide();if("L"!=
b.cbaConfig.permesso)c.getForm().on("dirtychange",function(d,g){controller_abilitaBottoni(c);b.getStoricoGridAssenze().setDisabled(g);b.getPnlTestataCal().setDisabled(g)});b.getCbConAssistenza().setVisible("L"==currRicovero.servizio.regione);"L"==b.cbaConfig.permesso&&(containerSolaLettura(c),controller_bottoniSolaLettura(c.boxBottoni));b.storeElencoRegole=Ext.create("Ext.data.Store",{fields:[{name:"descrizioneFormatted",convert:function(b,c){return c.get("descIdEsterno")+" ("+c.get("descServ")+")"}}]});
b.storeAssenzeCs=Ext.create("Ext.data.Store",{fields:[{name:"id"},{name:"dal"},{name:"descrizineFormatted",convert:function(b,c){return c.get("desMotivo")+" - Dal: "+FormattaData(c.get("dal"))}}]})},destroy:function(){this.showOspedali&&eliminaStore(this.storeOspedale);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.Consenso",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grid",selector:this.selContainer+"#Grid"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"GridAssenze",selector:this.selContainer+"#GridAssenze"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"BtnEliminaFake",selector:this.selContainer+
"#BtnElimina"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"DataAl",selector:this.selContainer+"#DataAl"},{ref:"OraDal",selector:this.selContainer+"#OraDal"},{ref:"OraAl",selector:this.selContainer+"#OraAl"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"PnlCompilatore",selector:this.selContainer+"#PnlCompilatore"},{ref:"LabelUpdateCompilatore",selector:this.selContainer+"#LabelUpdateCompilatore"},{ref:"RadioConsenso",selector:this.selContainer+"#RadioConsenso"},
{ref:"BtnAllegati",selector:this.selContainer+"#BtnAllegati"}]);this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#BtnEsci",{click:this.clickBtnEsci});this.control(this.selContainer+"#Grid",{selectionchange:this.selectionchangeGrid});this.control(this.selContainer+"#BtnAllegati",{click:this.clickBtnAllegati});this.control(this.selContainer+"#DataAl",{expand:this.expandDataAl});
this.control(this.selContainer+"#RadioConsenso",{change:this.changeRadioConsenso})},changeRadioConsenso:function(b,c,d){this.evidenziaCampiObbligatori()},expandDataAl:function(b){b=this.getDataDal().getValue();this.getDataAl().setMinValue(b)},selectionchangeGrid:function(b,c){var d=this.getForm(),f=d.boxBottoni.queryById("btnElimina"),g=this.getLabelUpdateCompilatore();g.update(null);if(0<c.length){this.getDataDal().setMinValue(null);this.getDataAl().setMinValue(null);var h=c[0],k=h.get("tipoBlocco"),
l=cssHasBloccoModifica(k),n=recordAnnullato=k&&"DEL"==cssGetBlocchi(k)[0];h.get("permessiAnnulla");h.get("compilatore");d.cbaConfig.tipoBlocco=k;d.getForm().loadRecord(h);f.cbaConfig.recordAnnullabile=this.cbaConfig.permesso&&!n?!0:!1;h.get("updateCompilatore")&&g.update(traduci("CHIUSO_DA")+": "+FormattaData(h.get("updateData"),"d/m/Y H:i")+" <br> \n\t\t\t\t\t"+traduci("DA")+": "+h.get("desCompilatoreUpdate")+" ("+h.get("compilatoreUpdateFigProf")+")");this.updateNotification(h.get("numAllegati"));
bloccaFormCss(d,l)}},updateNotification:function(b){if(!cbaValidId(this.getForm().getForm().getFieldValues().id))return!1;setBadgeText(this.getBtnAllegati(),b,"bottomright","lightgreen")},clickBtnEsci:function(b){b.up("window").close()},afterNuovo:function(){var b=this,c=this.getForm(),d=this.getDataDal(),f=this.getDataAl(),g=Ext.isEmpty(this.getGrid().getSelectionModel().getSelected())?null:this.getGrid().getSelectionModel().getSelected().get("al");bloccaFormCss(c,!1);getServerTime().then(function(c){c=
new Date(c);d.setValue(c);d.setMinValue(Ext.clone(c));f.setMinValue(d.getValue());b.getLabelUpdateCompilatore().update(null);g&&(c=Ext.clone(b.getGrid().getSelectionModel().getSelected().get("al")),d.setMaxValue(c))})},evidenziaCampiObbligatori:function(){var b=this.lookup("RadioConsenso");b.getValue().consenso?b.setStyle("border","none"):b.setStyle("border","1px solid #CF4C35")},clickBtnAllegati:function(b){var c=this.getForm().getForm().getFieldValues().id,d=(c=!cbaValidId(c))?null:this.storeForm.getData().getAt(0);
this.compilatore=c?CBA.moduli.modulo49.operatore.id:d.get("compilatore");c=Ext.create("winCBA",{titolo:traduci("ALLEGATI_CONSENSO_DOSSIER")+"&nbsp;"+traduci("DEL_GIORNO")+"&nbsp;"+FormattaData(this.getPnlCompilatore().getDataOraReg(),"d M. Y"),name:"GeneraliCS.standard.allegati.view.Allegati",maximizable:!1,larghezzaWin:800,altezzaWin:700,clsWin:"cbaCssBordoPopup",configItem:{controllerTe:this,idTestata:this.getGrid().getSelectionModel().getSelected().items[0].get("id"),solaLettura:"L"==this.cbaConfig.permesso?
!0:!1,tipo:"5A"}});d=b.getPosition()[0]+b.getWidth()-800;b=b.getPosition()[1]+b.getHeight();c.showAt(d,b)},gestioneForm:function(){var b=this,c=this.getForm();c.permesso=this.cbaConfig.permesso?this.cbaConfig.permesso:"L";c.boxBottoni=this.getBoxBottoni();c.controller=this;c.store=this.storeForm=this.getGrid().getStore();var d=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(c){b.salvaForm(!1)},annulla_callback:function(){var d=b.getGrid().getSelectionModel().getSelection()[0];
d?b.aggiornaStore(d.get("id")):clearForm(c)},nuovo_callback:function(){controller_nuovoRecord(c);b.afterNuovo()},elimina_callback:function(){var c=b.getForm().getForm().findField("id").getValue();Ext.isEmpty(c)?Messaggio("ATTENZIONE","NESSUNA_REGISTRAZIONE_SELEZIONATA","OK","QUESTION"):controller_eliminaRecord(b.getGrid().getStore(),{id:c},function(){return b.aggiornaStore(c)},!1)},esci_callback:function(){c.up("window").close()},verificaCampiForm_callback:function(){return b.verificaCampiForm()},
noText:!0,personIcons:getIconButtons()}});inserisciBottoni(c.boxBottoni,d,!0);margineStdBtnFunzione(c.boxBottoni);if("S"==c.permesso)c.getForm().on("dirtychange",function(d,g){controller_abilitaBottoni(c);c.boxBottoni.queryById("btnEsci").setDisabled(g);b.getGrid().setDisabled(g);b.getBtnAllegati().setDisabled(g);var f=c.getForm().getFieldValues().id;g&&!cbaValidId(f)&&b.getPnlCompilatore().setNuovoRecord();b.evidenziaCampiObbligatori()})},salvaForm:function(b){var c=this.getForm(),d=c.getForm().getFieldValues(),
f=this.getDataDal().getValue(),g=this.getDataAl().getValue(),h=this.getOraDal().getValue(),k=this.getOraAl().getValue(),l=d.compilatore,n=d.id;delete d.dataRegAppo;delete d.oraRegAppo;h&&(f=sommaDataOra(f,h));g&&k&&(g=sommaDataOra(g,k));delete d._oraDal;delete d._oraAl;Ext.apply(d,{compilatore:Ext.isEmpty(l)?this.compilatoreLog:l,codUtente:this.codUtente,dal:f,al:g,updateCompilatore:cbaValidId(n)?this.compilatoreLog:null,updateData:cbaValidId(n)?new Date:null});controller_salvaRecord(c,d,!1,!1,!0)&&
b&&me.callbackEsci&&me.callbackEsci()},verificaCampiForm:function(){var b=[],c=this.getDataDal().getValue(),d=this.getDataAl().getValue(),f=this.getOraDal().getValue(),g=this.getOraAl().getValue(),h=this.getRadioConsenso().getValue().consenso;this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");null==h&&msgAddError(b,"MSG_CAMPI_OBBLIGATORI");c&&f&&(c=sommaDataOra(c,f));d&&g&&(d=sommaDataOra(d,g));c&&d&&c.getTime()>d.getTime()&&msgAddError(b,"MSG_LIMITE_DATE");return msgShow("ATTENZIONE",
b)},abilitaBtnNuovo:function(b){var c=this;c.getForm().boxBottoni.queryById("btnNuovo").setDisabled(!1);Ext.each(b,function(b){var d=b.get("al");b=b.get("deletedData");Ext.isEmpty(d)&&Ext.isEmpty(b)&&c.getForm().boxBottoni.queryById("btnNuovo").setDisabled(!0)})},aggiornaStore:function(b){var c=this,d=this,f=this.getGrid().getStore();clearForm(this.getForm());f.load({params:{codUtente:this.codUtente},callback:function(g,h,k){k?Ext.isEmpty(g)||(d.abilitaBtnNuovo(g),b&&((g=trovaRecord(f,"id",b))||(g=
0),c.getGrid().getSelectionModel().deselectAll(),c.getGrid().getSelectionModel().select(g?g:0))):msgShowError("",h.getError())}})},onLaunch:function(){var b=this.getGrid();b.controller=this;b.cbaConfig.btnElimina=this.getBtnEliminaFake();this.idRicovero=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).get("idRicovero");this.codUtente=CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0].get("codOspite");this.compilatoreLog=CBA.moduli.modulo49.operatore.id;this.getPnlCompilatore().hide();this.gestioneForm();
this.aggiornaStore();cssSetAnnullabile(this)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.Contatti",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"EditCRMTipoContatto",selector:b+"#EditCRMTipoContatto"},{ref:"EditCRMStato",selector:b+"#EditCRMStato"},{ref:"StoricoGridCRM",selector:b+"#StoricoGridCRM"},{ref:"boxBottoni",selector:b+"#boxBottoni"},{ref:"EditCRMForm",selector:b+"#EditCRMForm"},{ref:"EditCRMNominativo",selector:b+"#EditCRMNominativo"},{ref:"EditCRMIdContatto",
selector:b+"#EditCRMIdContatto"},{ref:"EditCRMData",selector:b+"#EditCRMData"},{ref:"EditCRMOra",selector:b+"#EditCRMOra"},{ref:"EditCRMMotivo",selector:b+"#EditCRMMotivo"},{ref:"RecordId",selector:b+"#RecordId"},{ref:"EditCRMOggetto",selector:b+"#EditCRMOggetto"},{ref:"EditCRMNote",selector:b+"#EditCRMNote"}]);this.control(b+"#EditCRMTipoContatto",{change:this.onEditCRMTipoContattoChange,select:this.onEditCRMTipoContattoSelect,expand:this.expandTipo,collapse:this.collapseTipo});this.control(b+"#EditCRMStato",
{change:this.onEditCRMStatoChange});this.control(b+"#StoricoGridCRM",{select:this.onStoricoGridCRMSelect})},collapseTipo:function(b,c){48==CBA.moduli.moduloAttivo&&b.store.clearFilter()},expandTipo:function(b,c){48==CBA.moduli.moduloAttivo&&(b.store.clearFilter(),b.store.filter(function(b,c){return 1!=b.data.codice}))},onEditCRMTipoContattoChange:function(b,c,d,f){this.getEditCRMNominativo().allowBlank=!0;this.getEditCRMNominativo().setVisible(3==c);this.getEditCRMIdContatto().allowBlank=!0;this.getEditCRMIdContatto().setVisible(1==
c||2==c);b=this.getEditCRMIdContatto().getStore();1==c||2==c?(this.getEditCRMIdContatto().allowBlank=!1,b.load({params:{codospite:this.cbaConfig.controllerFascicolo.currentDip,tipoContatto:c,tipoContabilita:this.personContabili.tipoContabilitaAbilitata}})):this.getEditCRMNominativo().allowBlank=!1;this.getEditCRMIdContatto().validateValue(this.getEditCRMIdContatto().getValue());this.getEditCRMNominativo().validateValue(this.getEditCRMNominativo().getValue())},onEditCRMTipoContattoSelect:function(b,
c,d){this.getEditCRMNominativo().setValue("");this.getEditCRMIdContatto().clearValue()},onEditCRMStatoChange:function(b,c,d,f){d=trovaRecord(b.store,"codice",d);c=trovaRecord(b.store,"codice",c);d&&b.inputEl.removeCls(d.data.img);c&&b.inputEl.addCls(c.data.img)},onStoricoGridCRMSelect:function(b,c){this.impostaDati(c)},nuovo:function(){controller_nuovoRecord(this.getEditCRMForm(),this.getEditCRMNominativo());this.getEditCRMData().setValue(new Date);this.getEditCRMOra().setValue(new Date);this.getEditCRMTipoContatto().setValue(2)},
verificaCampiForm:function(){var b=[];this.getEditCRMForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=this.getEditCRMData().getValue();c.setHours(Ext.util.Format.date(this.getEditCRMOra().getValue(),"H"),Ext.util.Format.date(this.getEditCRMOra().getValue(),"i"));c={id:this.getRecordId().getValue(),codOspite:this.cbaConfig.controllerFascicolo.currentDip,data:c,tipoContatto:this.getEditCRMTipoContatto().getValue(),
idContatto:this.getEditCRMIdContatto().getValue(),nominativo:this.getEditCRMNominativo().getValue(),motivo:this.getEditCRMMotivo().getValue(),stato:this.getEditCRMStato().getValue(),oggetto:this.getEditCRMOggetto().getValue(),note:this.getEditCRMNote().getValue()};controller_salvaRecord(this.getEditCRMForm(),c,b)},impostaDati:function(b){var c=this;c.getStoricoGridCRM().setDisabled(!1);clearForm(c.getEditCRMForm().id);c.getEditCRMTipoContatto().getStore().clearFilter();b&&(c.getEditCRMForm().loadRecord(b),
c.getEditCRMForm().getForm().setValues({CRMOra:b.data.data}),b.data.idContatto&&c.getEditCRMIdContatto().getStore().load({params:{codospite:c.cbaConfig.controllerFascicolo.currentDip,tipoContatto:b.data.tipoContatto,tipoContabilita:c.personContabili.tipoContabilitaAbilitata},callback:function(d,f,g){c.getEditCRMForm().getForm().setValues({EditCRMIdContatto:b.data.idContatto})}}))},aggiornaStore:function(b){var c=this,d=c.getStoricoGridCRM().getStore();d.load({params:{codospite:c.cbaConfig.controllerFascicolo.currentDip},
callback:function(f,g,h){h?Ext.isEmpty(f)?clearForm(c.getEditCRMForm().id):(b||(b=c.getRecordId().getValue()),f=trovaRecord(d,"id",b),g=c.getStoricoGridCRM(),g.getSelectionModel().deselectAll(),g.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}});permettiModificheDopoDimissione()||(containerSolaLettura(c.getEditCRMForm()),c.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),c.getBoxBottoni().queryById("btnElimina").setDisabled(!0),c.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),
c.getBoxBottoni().queryById("btnConferma").setDisabled(!0),c.getBoxBottoni().queryById("btnEsci").setDisabled(!1))},onLaunch:function(){var b=this;b.personContabili||(b.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null));ImpostaUrl([b.getStoricoGridCRM().getStore(),b.getEditCRMTipoContatto().getStore(),b.getEditCRMIdContatto().getStore(),b.getEditCRMMotivo().getStore()]);var c=b.getEditCRMForm();c.boxBottoni=b.getBoxBottoni();c.store=b.getStoricoGridCRM().getStore();c.controller=b;var d=
Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var d=b.getEditCRMForm().getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,{idCrm:d},function(){b.aggiornaStore()})},esci_callback:function(){var d=c.up("window");controller_puoiUscire(d,c,function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&
b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),d);var f;b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.getContainer()&&b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0]&&
(f=b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0].get("id"));this.aggiornaStore(f);loadStore(b.getEditCRMTipoContatto().getStore());loadStore(b.getEditCRMMotivo().getStore());d=Ext.create("Ext.data.ArrayStore",{fields:["codice","valore","img"],data:[[1,"","icon-angry"],[2,"","icon-stright"],[3,"","icon-smile"]],autoLoad:!0,autoDestroy:!0});b.getEditCRMStato().tpl=Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item {img}" style="height: 25px"></div>',
"</tpl>");b.getEditCRMStato().bindStore(d);if("L"!=b.cbaConfig.permesso)c.getForm().on("dirtychange",function(d,f){controller_abilitaBottoni(c);f?b.getStoricoGridCRM().setDisabled(!0):b.getStoricoGridCRM().setDisabled(!1)});"L"==b.cbaConfig.permesso&&(containerSolaLettura(c),controller_bottoniSolaLettura(c.boxBottoni))},destroy:function(){}});
Ext.define("GeneraliOSP.portlet.controller.Documenti",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"EditDocumenti",selector:c+"#EditDocumenti"},{ref:"docTipoDoc",selector:c+"#docTipoDoc"},{ref:"descrizioneBreve",selector:c+"#descrizioneBreve"},{ref:"linkDocAllegato",selector:c+"#linkDocAllegato"},{ref:"docAllega",selector:c+"#docAllega"},{ref:"docEliminaAllegato",selector:c+
"#docEliminaAllegato"},{ref:"StoricoGridDoc",selector:c+"#StoricoGridDoc"},{ref:"docTicket",selector:c+"#docTicket"},{ref:"docTicketImp",selector:c+"#docTicketImp"},{ref:"docTEAM",selector:c+"#docTEAM"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"docLbAllegato",selector:c+"#docLbAllegato"},{ref:"docDataEmissione",selector:c+"#docDataEmissione"},{ref:"docNomeIstituzione",selector:c+"#docNomeIstituzione"},{ref:"docNumero",selector:c+"#docNumero"},{ref:"docDataScadenzaTEAM",selector:c+"#docDataScadenzaTEAM"},
{ref:"docNomeIstituzioneTEAM",selector:c+"#docNomeIstituzioneTEAM"},{ref:"docNumeroIdIstituzioneTEAM",selector:c+"#docNumeroIdIstituzioneTEAM"},{ref:"docNumeroTEAM",selector:c+"#docNumeroTEAM"},{ref:"docNumTesseraTEAM",selector:c+"#docNumTesseraTEAM"},{ref:"docNomeFile",selector:c+"#docNomeFile"},{ref:"EditDocumentiForm",selector:c+"#EditDocumentiForm"},{ref:"docIdAllegato",selector:c+"#docIdAllegato"},{ref:"pnlTEAM",selector:c+"#pnlTEAM"},{ref:"pnlAltriDoc",selector:c+"#pnlAltriDoc"},{ref:"recordId",
selector:c+"#recordId"},{ref:"docDataScadenza",selector:c+"#docDataScadenza"},{ref:"docLabelAllegato",selector:c+"#docLabelAllegato"},{ref:"priImp",selector:c+"#priImp"},{ref:"tipoImpegnativa",selector:c+"#tipoImpegnativa"},{ref:"tipoRicetta",selector:c+"#tipoRicetta"},{ref:"quesito",selector:c+"#quesito"},{ref:"medicoRic",selector:c+"#medicoRic"},{ref:"codEse",selector:c+"#codEse"},{ref:"cmbCodEse",selector:c+"#cmbCodEse"},{ref:"IdEsenzioneTicket",selector:c+"#IdEsenzioneTicket"}]);b.control(c+"#EditDocumenti",
{destroy:b.onEditDocumentiDestroy});b.control(c+"#docTipoDoc",{change:b.onDocTipoDocChange1});b.control(c+"#linkDocAllegato",{afterrender:b.onlinkDocAllegatoAfterRender});b.control(c+"#docAllega",{change:b.onDocAllegaChange,afterrender:b.onAfterrenderFileField});b.control(c+"#docEliminaAllegato",{click:b.onButtonClick});b.control(c+"#StoricoGridDoc",{select:b.selectGridDoc});b.control(c+"#cmbCodEse",{select:b.selectCmbCodEse});b.control(c+"#codEse",{change:b.onCodEseChange});b.on({esci:function(){b.getEditDocumentiForm().boxBottoni.queryById("btnEsci").handler()}});
b.on({changeTab:function(){return b.changeTab()}})},onAfterrenderFileField:function(b){"L"==this.cbaConfig.permesso&&(containerSolaLettura(this.getEditDocumentiForm()),controller_bottoniSolaLettura(this.getBoxBottoni()))},onCodEseChange:function(b,c,d,f){Ext.isEmpty(c)||c===d||(b=trovaRecord(this.getStoricoGridDoc().getStore(),"numero",c))&&b.data.ticket&&this.impostaDocEsenzione(b)},afterTabChange:function(){0==this.getStoricoGridDoc().getStore().getTotalCount()&&this.getDocTipoDoc().focus(!1,200)},
changeTab:function(){var b=this,c=b.getEditDocumentiForm().up("window");controller_puoiUscire(c,b.getEditDocumentiForm(),function(){b.salva(!1)},function(){b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){b.aggiornaStore()})},onDocTipoDocChange1:function(b,c,d,f){if(c&&b.selection){var g=b.selection.get("extra").split("#");b="4"==g[0];c="5"==g[0];d="6"==g[0];f="7"==g[0];var h="8"==g[0],k="0"==g[0],g=k&&"C"==g[1];this.getDocTicket().setVisible(c);
this.getDocTicket().allowBlank=!c||g;this.getPnlTEAM().setVisible(b);this.getPnlAltriDoc().setVisible(!0);this.getDocAllega().setVisible(!1);this.getDocAllega().setVisible(!0);this.getDocDataEmissione().setVisible(!b);this.getDocDataScadenza().setVisible(!b);this.getDocNomeIstituzione().setVisible(!b);this.getDocNumero().setVisible(!b);this.getPriImp().setVisible(f);this.getTipoImpegnativa().setVisible(f);this.getTipoRicetta().setVisible(f);this.getQuesito().setVisible(f);this.getMedicoRic().setVisible(f);
this.getCodEse().setVisible(f);this.getCmbCodEse().setVisible(f);this.getDocTicketImp().setVisible(f);this.getDocDataEmissione().allowBlank=b||c||g;this.getDocNomeIstituzione().allowBlank=k||b||c||d||f||h||g;this.getDocNumero().allowBlank=k||b||h||g;this.getDocDataScadenzaTEAM().allowBlank=!b||g;this.getDocNomeIstituzioneTEAM().allowBlank=!b||g;this.getDocNumeroIdIstituzioneTEAM().allowBlank=!b||g;this.getDocTEAM().allowBlank=!b||g;this.getDocNumeroTEAM().allowBlank=!b||g;this.getDocNumTesseraTEAM().allowBlank=
!b||g}validaForm(this.getEditDocumentiForm())},onlinkDocAllegatoAfterRender:function(b,c){var d=this;if(!d.impostatoClickAllegato)b.getEl().on("click",function(){var c=d.getStoricoGridDoc().getStore().findRecord("id",d.getRecordId().getValue()),g=c.data.nomeFile;g||(g="");c=c.data.idAllegato;null==c&&(c=0);setWindow(1);stampaEsporta(b,{url:getUrlGen()+"/ws/genOsp/docs/attach/getFileRefById"+(CBA.moduli&&CBA.moduli.moduloAttivo&&49===CBA.moduli.moduloAttivo?"Css":""),params:{idAllegato:c},titolo:g})});
d.impostatoClickAllegato=!0},onDocAllegaChange:function(b,c,d){var f=this;d=c.lastIndexOf("\\")||c.lastIndexOf("/");c=c.substring(d+1);if(50<c.length)return Messaggio("ATTENZIONE","MSG_NOMEFILE_LUNGHEZZA","OK","WARNING"),b.fileInputEl.dom.value=null,!1;if(""==c||!f.estensioneValida(c))return b.fileInputEl.dom.value=null,!1;d=new FormData;var g=b.extractFileInput();d.append("fileData",g.files[0]);Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/docs/attach/upload",method:"POST",rawData:d,params:{idDoc:f.getRecordId().getValue(),
nomeFile:c},headers:{"Content-Type":null},success:function(b){b=Ext.JSON.decode(b.responseText);var d=[],g=traduci("MSG_ELABORAZIONE_OK");if(b.success){msgShowText("TRASFERIMENTO_FILE",b.message);var h=f.getStoricoGridDoc().getStore().findRecord("id",f.getRecordId().getValue());h.data.nomeFile=c;h.data.idAllegato=b.idAllegato;f.getEditDocumentiForm().getForm().setValues({idAllegato:b.idAllegato});f.setAllegato(c)}else g=traduci("MSG_ELABORAZIONE_KO"),msgAddError(d,b.message);msgShow(g,d)},failure:function(b){msgShowError("",
b.responseText)}});b.fileInputEl.dom.value=null},onButtonClick:function(b,c,d){if(""===this.getDocLbAllegato().text)return Messaggio("ELIMINA","MSG_NESSUN_ALLEGATO","OK","WARNING"),!1;Messaggio("ELIMINA","MSG_ELIMINA_ALLEGATO","YESNO","QUESTION","",Ext.bind(this.eliminaAllegato,this))},selectGridDoc:function(b,c){this.impostaDati(c);permettiModificheDopoDimissione()||(containerSolaLettura(this.getEditDocumenti()),this.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),this.getBoxBottoni().queryById("btnElimina").setDisabled(!0),
this.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),this.getBoxBottoni().queryById("btnConferma").setDisabled(!0),this.getBoxBottoni().queryById("btnEsci").setDisabled(!1),this.getDocAllega().setDisabled(!0))},onEditDocumentiDestroy:function(b,c){this.getEditDocumenti().ripristinaFiltri()},abilitaCampiAllegato:function(b){0===this.getStoricoGridDoc().getStore().getCount()&&(b=!1,this.setAllegato(""));"L"!=this.cbaConfig.permesso&&(this.getDocAllega().setDisabled(!b),this.getDocEliminaAllegato().setDisabled(!b))},
impostaDati:function(b){var c=this.getEditDocumentiForm();this.getStoricoGridDoc().setDisabled(!1);clearForm(c);if(b){this.getDocTicketImp().setReadOnly(!1);if(b.get("impegnativa")&&b.get("idEsenzioneTicket")){var d=trovaRecord(this.getStoricoGridDoc().getStore(),"id",b.get("idEsenzioneTicket"));this.getDocTicketImp().allowBlank=!1;d&&(b.data.codEsenzione=d.get("numero"),b.data.idRispostaEseImp=d.get("idRisposta"),this.getCodEse().setReadOnly(!0),this.getDocTicketImp().setReadOnly(!0),this.getDocTicketImp().allowBlank=
!0)}c.loadRecord(b);this.getPnlTEAM().isVisible()&&c.getForm().setValues({dataScadenzaTEAM:b.get("dataScadenza"),nomeIdIstituzioneTEAM:b.get("nomeIdIstituzione"),numIdIstituzioneTEAM:b.get("numIdIstituzione"),nazioneTEAM:b.get("nazione"),numeroTEAM:b.get("numero"),numeroTesseraTEAM:b.get("numeroTessera"),docTicket:b.get("idRisposta")});(c=b.data.nomeFile)||(c="");this.setAllegato(c)}else this.abilitaCampiAllegato(!1),this.cbaConfig.soloCodiciTEAM||this.cbaConfig.isTicket?this.getDocTipoDoc().getStore().getAt(0)&&
this.getDocTipoDoc().setValue(this.getDocTipoDoc().getStore().getAt(0).data.codice):this.getDocTipoDoc().fireEvent("change"),controller_abilitaBottoni(this.getEditDocumentiForm()),this.getBoxBottoni().queryById("btnEsci").setDisabled(!1);this.getDocTipoDoc().setReadOnly(b)},getTipoDocStandard:function(b,c){var d=null;Ext.each(b.data.items,function(b){b.data.extra==c&&(d=b.data.codice)});return d},nuovo:function(){this.getDocTipoDoc().setReadOnly(!1);controller_nuovoRecord(this.getEditDocumentiForm());
this.setAllegato("");this.getCodEse().setReadOnly(!1);this.getDocTicketImp().setReadOnly(!1);this.getDocTicketImp().allowBlank=!0;if(this.cbaConfig.soloImpegnative){var b=this.getTipoDocStandard(this.getDocTipoDoc().getStore(),"7#A");this.getEditDocumentiForm().getForm().setValues({tipoDocumento:b});this.getDocTipoDoc().setReadOnly(!0)}else(this.cbaConfig.soloCodiciTEAM||this.cbaConfig.isTicket)&&this.getDocTipoDoc().getStore().getAt(0)&&this.getDocTipoDoc().setValue(this.getDocTipoDoc().getStore().getAt(0).data.codice)},
verificaCampiForm:function(){var b=[],c=this.getEditDocumentiForm().getForm();this.getDocTipoDoc();var d=this.getDocTipoDoc().getValue()&&"7#A"==this.getDocTipoDoc().selection.get("extra");c.findField("idRispostaEseImp").allowBlank=!d||Ext.isEmpty(c.findField("codEsenzione").getValue());c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");this.getDocTipoDoc().getValue()!=this.cbaConfig.codiciTEAM&&this.getDocDataEmissione().getValue()>this.getDocDataScadenzaTEAM().getValue()&&this.getDocDataScadenzaTEAM().getValue()&&
msgAddError(b,"MSG_DATAEMISSIONE_MAGGIORE_DATASCADENZA");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=this.getDocTipoDoc(),d=c.getValue(),f=d&&"4#A"==c.selection.get("extra"),g=d&&"5#A"==c.selection.get("extra"),c=d&&"7#A"==c.selection.get("extra"),g=g?this.getDocTicket().getValue():null,d=this.cbaConfig.codOspite?this.cbaConfig.codOspite:this.cbaConfig.controllerFascicolo.currentDip,h=-1;this.cbaConfig.idRicovero?h=this.cbaConfig.idRicovero:this.cbaConfig.controllerEditFascicolo&&
this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?h=this.cbaConfig.controllerEditFascicolo.currRicovero?this.cbaConfig.controllerEditFascicolo.currRicovero.idRicovero:-1:this.cbaConfig.controllerFascicolo&&this.cbaConfig.controllerFascicolo.idRicovero&&(h=this.cbaConfig.controllerFascicolo.idRicovero);g={codOspite:d,idRicovero:h,idRicoveroCs:-1,id:this.getRecordId().getValue(),idDocumento:this.getRecordId().getValue(),tipoDocumento:this.getDocTipoDoc().getValue(),idRisposta:g,nomeFile:""!=this.getDocLbAllegato().text?
this.getDocLbAllegato().text:"",idAllegato:""!=this.getDocLbAllegato().text?this.getDocIdAllegato().getValue():"",descrizioneBreve:this.getDescrizioneBreve().getValue()};f?Ext.apply(g,{desTipoDocumento:"T",dataScadenza:this.getDocDataScadenzaTEAM().getValue(),numeroTessera:this.getDocNumTesseraTEAM().getValue(),numero:this.getDocNumeroTEAM().getValue(),nomeIdIstituzione:this.getDocNomeIstituzioneTEAM().getValue(),numIdIstituzione:this.getDocNumeroIdIstituzioneTEAM().getValue(),nazione:this.getDocTEAM().getValue()}):
(Ext.apply(g,{dataScadenza:this.getDocDataScadenza().getValue(),dataEmissione:this.getDocDataEmissione().getValue(),nomeIdIstituzione:this.getDocNomeIstituzione().getValue(),numero:this.getDocNumero().getValue(),numeroTessera:null,numIdIstituzione:null,nazione:null}),c&&(f=!0,this.getIdEsenzioneTicket().getValue()||Ext.isEmpty(this.getCodEse().getValue())||(f=this.salvaEsenzDaImpegnativa(this.getEditDocumentiForm(),g)),f?(Ext.apply(g,{priorita:this.getPriImp().getValue(),tipoImp:this.getTipoImpegnativa().getValue(),
tipoRicetta:this.getTipoRicetta().getValue(),note:this.getQuesito().getValue(),idMedico:this.getMedicoRic().getValue(),codEsenzione:this.getCodEse().getValue(),idEsenzioneTicket:g.idEsenzioneTicket?g.idEsenzioneTicket:this.getIdEsenzioneTicket().getValue()}),Ext.isEmpty(g.codEsenzione)&&Ext.apply(g,{idEsenzioneTicket:null})):g=null));controller_salvaRecord(this.getEditDocumentiForm(),g,b)&&this.cbaConfig.wizard&&""!=this.cbaConfig.controllerEditFascicolo.navDirection&&this.cbaConfig.controllerEditFascicolo.navigaWizard(this.cbaConfig.controllerEditFascicolo.navDirection,
!0)},salvaEsenzDaImpegnativa:function(b,c){var d=!1,f={},g=this.getTipoDocStandard(this.getDocTipoDoc().getStore(),"5#A");Ext.apply(f,c);Ext.apply(f,{dataScadenza:null,dataEmissione:null,nomeIdIstituzione:null,numero:this.getCodEse().getValue(),idRisposta:this.getDocTicketImp().getValue(),tipoDocumento:g});g=b.store.getProxy().api.create;Ext.Ajax.request({url:g,method:"POST",jsonData:f,async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(Ext.apply(c,{idEsenzioneTicket:b.data.id}),
msgShowText("",b.message)):msgShowError("",b.message);d=!0},failure:function(b){d=!1;msgShowError("",b.responseText)}});return d},getStoricoGrid:function(){return this.getStoricoGridDoc()},estensioneValida:function(b){return"rar"==b.slice((b.lastIndexOf(".")>>>0)+1)||"7z"==b.slice((b.lastIndexOf(".")>>>0)+1)||"exe"==b.slice((b.lastIndexOf(".")>>>0)+1)||"tar"==b.slice((b.lastIndexOf(".")>>>0)+1)||"zip"==b.slice((b.lastIndexOf(".")>>>0)+1)?(Messaggio("MSG_TITOLO_ERRORE","MSG_ERRORE_ESTENSIONE_ALLEGATI",
"OK","ERROR"),!1):!0},setAllegato:function(b){for(var c=getEstensioni(),d=0;d<c.length;d++)this.getLinkDocAllegato().removeCls("icon-"+c[d]);d=b.lastIndexOf(".");d=b.length-d-1;(d=b.substr(b.length-d,d).toLowerCase())&&(0<=Ext.Array.indexOf(c,d)?this.getLinkDocAllegato().addCls("icon-"+d):this.getLinkDocAllegato().addCls("icon-unknown"));this.getDocLbAllegato().setText(b);""!==b?(this.getLinkDocAllegato().show(),setToolTip(this.getLinkDocAllegato().id,this.getLinkDocAllegato().getEl(),b)):this.getLinkDocAllegato().hide()},
eliminaAllegato:function(){var b=this,c=this;Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/docs/attach/delete?idDoc="+b.getRecordId().getValue(),method:"GET",async:!1,success:function(d){d=Ext.JSON.decode(d.responseText);d.success?(trovaRecord(b.getStoricoGridDoc().getStore(),"id",b.getRecordId().getValue()).data.nomeFile="",c.setAllegato(""),msgShowText("",d.message)):msgShowError("",d.message)},failure:function(b){msgShowError("",b.responseText)}})},selectCmbCodEse:function(b,c,d){this.getCodEse().setValue(c.get("codice"));
c.get("idDocumento")&&(b=trovaRecord(this.getStoricoGridDoc().getStore(),"id",c.get("idDocumento")))&&this.impostaDocEsenzione(b)},impostaDocEsenzione:function(b){this.getDocTicketImp().setValue(b.data.idRisposta);this.getIdEsenzioneTicket().setValue(b.id);this.getDocTicketImp().setReadOnly(!0);this.getDocTicketImp().allowBlank=!0},caricaCmbCodEseImpegnative:function(b){var c=[];Ext.each(b,function(b){if(b.get("ticket")){var d=b.get("desTipoEsenzione")+" "+FormattaData(b.get("dataEmissione"))+" (n."+
b.get("numero")+")";c.push({codice:b.get("numero"),valore:d,idDocumento:b.get("id")})}});this.getCmbCodEse().setStore(Ext.create("Ext.data.Store",{extend:"Generali.data.StoreCodiceValore",data:c}))},aggiornaStore:function(b){var c=this,d=c.getStoricoGridDoc().getStore(),f=c.getEditDocumentiForm(),g=f.getForm(),h=c.cbaConfig.codOspite?c.cbaConfig.codOspite:c.cbaConfig.controllerFascicolo.currentDip,k=-1;c.cbaConfig.idRicovero?k=c.cbaConfig.idRicovero:c.cbaConfig.controllerEditFascicolo&&c.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo?
k=c.cbaConfig.controllerEditFascicolo.currRicovero?c.cbaConfig.controllerEditFascicolo.currRicovero.idRicovero:-1:c.cbaConfig.controllerFascicolo&&c.cbaConfig.controllerFascicolo.idRicovero&&(k=c.cbaConfig.controllerFascicolo.idRicovero);var l=-9999;c.cbaConfig.soloImpegnative&&(l=c.getTipoDocStandard(c.getDocTipoDoc().getStore(),"7#A"));d.load({params:{codospite:h,idRicovero:k,idRicoveroCs:-1,tipoDoc:null!=l?l:-9999},callback:function(h,k,l){l?(c.cbaConfig.addRecord?(c.cbaConfig.addRecord=!1,c.nuovo()):
Ext.isEmpty(h)?permettiModificheDopoDimissione()?clearForm(f):(containerSolaLettura(c.getEditDocumenti()),c.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),c.getBoxBottoni().queryById("btnElimina").setDisabled(!0),c.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),c.getBoxBottoni().queryById("btnConferma").setDisabled(!0),c.getBoxBottoni().queryById("btnEsci").setDisabled(!1)):(b||(b=g.findField("id").getValue()),k=trovaRecord(d,"id",b),l=c.getStoricoGridDoc(),l.getSelectionModel().deselectAll(),
l.getSelectionModel().select(k?[k]:0),0==l.getStore().count()&&c.impostaDati(!1)),c.caricaCmbCodEseImpegnative(h),c.cbaConfig.wizard&&c.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento()):msgShowError("",k.getError())}})},ripristinaFiltri:function(){this.getDocTipoDoc().getStore().clearFilter();this.getStoricoGridDoc().clearFilter()},caricaStorePromise:function(b,c){c=void 0===c?{}:c;return new Promise(function(d,f){b.load({params:c,callback:function(b,c,k){k?d(b):f(c)}})})},onLaunch:function(){var b=
this,c=b.getDocTipoDoc().getStore();b.getContainer().controller=b;ImpostaUrl([c,b.getDocTicket().getStore(),b.getDocTicketImp().getStore(),b.getDocTEAM().getStore(),b.getStoricoGridDoc().getStore(),b.getTipoRicetta().getStore(),b.getTipoImpegnativa().getStore(),b.getPriImp().getStore()]);var d=b.getEditDocumentiForm(),f=49===CBA.moduli.moduloAttivo,g=f?"controller_PannelloBottoni":"controller_PannelloBottoniVert";d.permesso=b.cbaConfig.permesso;d.boxBottoni=b.getBoxBottoni();b.storeForm=d.store=b.getStoricoGridDoc().getStore();
d.controller=b;g=Ext.create("Generali.standard."+g,{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=d.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(d.store,{idDocumento:c},function(){b.aggiornaStore()})},esci_callback:function(){var c=b.getEditDocumenti().up("window");controller_puoiUscire(c,b.getEditDocumentiForm(),function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&
b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:f?!0:null,personIcons:f?getIconButtons():null}});inserisciBottoni(b.getBoxBottoni(),g);f&&b.getBoxBottoni().queryById("btnElimina").setIconCls(getIconButtons().btnEliminaX);b.getDocLbAllegato().hide();
b.getDocTicket().hide();b.getDocNomeFile().hide();b.getPnlTEAM().hide();b.getPnlAltriDoc().hide();b.getPnlTEAM().setPosition(0,60);loadStore(b.getDocTEAM().getStore());loadStore(b.getDocTicket().getStore());g=b.getMedicoRic().getStore();g.proxy.url=getUrlGen()+"/ws/genOsp/medici/cbox";loadStore(g,{idOrg:getIdOrg()});loadStore(b.getTipoImpegnativa().getStore(),{scheda:"V",domanda:105,idServizio:"undefined"==typeof currRicovero||Ext.isEmpty(currRicovero.idServizio)?-1:currRicovero.idServizio});loadStore(b.getTipoRicetta().getStore(),
{scheda:"V",domanda:106,idServizio:"undefined"==typeof currRicovero||Ext.isEmpty(currRicovero.idServizio)?-1:currRicovero.idServizio});loadStore(b.getPriImp().getStore());loadStore(b.getDocTicketImp().getStore());b.getRecordId().hide();b.getDocIdAllegato().hide();b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&d.boxBottoni.queryById("btnEsci").setVisible(!1);if("L"!=b.cbaConfig.permesso)b.getEditDocumentiForm().on("dirtychange",function(c,d){controller_abilitaBottoni(b.getEditDocumentiForm());
d?(b.getStoricoGrid().setDisabled(!0),b.abilitaCampiAllegato(!1)):(b.getStoricoGrid().setDisabled(!1),b.abilitaCampiAllegato(!0));b.cbaConfig.controllerEditFascicolo&&(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(d),b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(d))});b.getLinkDocAllegato().setSrc(Ext.BLANK_IMAGE_URL);b.cbaConfig.soloCodiciTEAM?(b.getStoricoGridDoc().getStore().filter("teamCard",!0),c.filter("extra","4#A")):b.cbaConfig.soloImpegnative&&b.getStoricoGridDoc().getStore().filter("impegnativa",
!0);b.cbaConfig.isTicket&&(b.getStoricoGridDoc().getStore().filter("ticket",!0),c.filter("extra","5#A"));b.getDocTEAM().displayTpl=Ext.create("Ext.XTemplate",'<tpl for=".">',"{codice}","</tpl>");var h;b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.getContainer()&&b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0]&&(h=b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0].get("id"));StdSipcar.promiseLoadStore(c,{listaTipologie:f?
"A,C":"A,R"}).then(function(c){b.aggiornaStore(h)})["catch"](function(b){return alert(b)})},destroy:function(){}});
Ext.define("GeneraliOSP.portlet.controller.EdtClassIntReg",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntForm",selector:this.selContainer+"#CntForm"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CbClassificazione",selector:this.selContainer+"#CbClassificazione"},{ref:"CbClasse",selector:this.selContainer+"#CbClasse"},{ref:"impegnativa",
selector:this.selContainer+"#impegnativa"},{ref:"BtnCreaImpegnativa",selector:this.selContainer+"#BtnCreaImpegnativa"},{ref:"infoImpegnativa",selector:this.selContainer+"#infoImpegnativa"},{ref:"FSSosia",selector:this.selContainer+"#FSSosia"}]);this.control(this.selContainer+"#BtnCreaImpegnativa",{click:this.BtnCreaImpegnativaclick})},BtnCreaImpegnativaclick:function(){var b=this,c=Ext.create("winCBA",{name:"GeneraliOSP.portlet.view.Documenti",titolo:"INSERISCI_IMPEGNATIVA",dimensione:1,configItem:{codOspite:b.cbaConfig.codOspite,
soloImpegnative:!0,addRecord:!0}});c.on("close",function(){b.caricaStoreImpegnativa()});c.show()},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow("",b);return 0==b.length?!0:!1},salvaForm:function(b){var c=this.getForm(),d=c.getForm().getFieldValues(),f={id:d.id_reg,utNonStd:d.utNonStd,importoSupplementare:d.importoSupplementare,regione:d.regione,gruppo:d.gruppo,associataA:d.associataA,importoSSR:d.importoSSR};delete d.id_reg;delete d.utNonStd;
delete d.importoSupplementare;delete d.regione;delete d.gruppo;delete d.associataA;delete d.importoSSR;Ext.apply(d,{idClassificazione:d.id,idRicovero:this.cbaConfig.idRicovero,tipoClassificazione:this.cbaConfig.classType,datiRegionali:f});controller_salvaRecord(c,d,b)&&b&&this.callbackEsci&&this.callbackEsci();this.cbaConfig.fromRegionali&&(this.getForm().getForm().findField("dataDal").setReadOnly(!0),this.getCbClassificazione().setReadOnly(!0),this.getForm().getForm().findField("noteClassificazione").setReadOnly(!0))},
gestioneForm:function(){var b=this,c=b.getForm(),d=b.cbaConfig.gridStorico,f=b.cbaConfig.tabClass;c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=d.getStore();c.controller=b;d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},annulla_callback:function(){b.cbaConfig.caricaGrid(b.cbaConfig.gridStorico)},nuovo_callback:function(){containerSolaLettura(c,!1);controller_nuovoRecord(c);b.cbaConfig.fromRegionali||
f.setDisabled(!0);c.getForm().setValues({dataDal:0==b.cbaConfig.gridStorico.getStore().count()&&"undefined"!==typeof currRicovero?currRicovero.dataDal:new Date})},elimina_callback:function(){var d=c.getForm().findField("id").getValue(),f=b.cbaConfig.gridStorico.getStore();Ext.isEmpty(d)||controller_eliminaRecord(f,{idClassificazione:d},function(){b.cbaConfig.caricaGrid(b.cbaConfig.gridStorico)})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},esci_callback:function(){var c=b.getForm().up("window");
!b.cbaConfig.noPortlet&&b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()}}});inserisciBottoni(c.boxBottoni,d);b.cbaConfig.wizard&&c.boxBottoni.queryById("btnEsci").setVisible(!1);if("L"!=c.permesso)c.getForm().on("dirtychange",function(d,h){controller_abilitaBottoni(c);b.cbaConfig.fromRegionali||f.setDisabled(h)})},impostaDati:function(b){var c=this.getForm();Ext.suspendLayouts();clearForm(c);c.loadRecord(b);Ext.resumeLayouts()},
aggiornaStore:function(b){this.cbaConfig.caricaGrid(this.cbaConfig.gridStorico,b)},caricaStoreImpegnativa:function(){this.storeImpegnativa.load({params:{codOspite:this.cbaConfig.codOspite,addDateToValue:!1},callback:function(b,c,d){d||msgShowError("Store Impegnativa",c.error[0].testo)}})},inizializzaForm:function(b,c){this.storeForm=this.getForm().store=c.getStore();this.cbaConfig.gridStorico=c;this.cbaConfig.classType=b;this.getCbClassificazione().getStore().load({params:{type:this.cbaConfig.classType,
idServizio:this.cbaConfig.idServizio}});if(5==b&&"V"==this.cbaConfig.regione){var d=this.getImpegnativa();Ext.isEmpty(this.storeImpegnativa)&&(this.storeImpegnativa=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/docsImp/get"}}),d.bindStore(this.storeImpegnativa),this.caricaStoreImpegnativa());d.show();this.getBtnCreaImpegnativa().show();this.cbaConfig.fromRegionali?this.getInfoImpegnativa().show():this.getInfoImpegnativa().hide()}else this.getImpegnativa().hide(),
this.getBtnCreaImpegnativa().hide(),this.cbaConfig.fromRegionali||this.getInfoImpegnativa().hide();this.getCbClasse().setVisible(!1);"L"==this.cbaConfig.regione&&50!=CBA.moduli.moduloAttivo&&(this.getCbClasse().setVisible(5==this.cbaConfig.classType&&!CBA.moduli.modulo27.installato),this.getFSSosia().setVisible("R"==this.cbaConfig.tipoServizio&&5==this.cbaConfig.classType));this.cbaConfig.fromRegionali&&(this.getForm().getForm().findField("dataDal").setReadOnly(!0),this.getCbClassificazione().setReadOnly(!0),
this.getForm().getForm().findField("noteClassificazione").setReadOnly(!0),this.getForm().boxBottoni.queryById("btnElimina").setVisible(!1),this.getForm().boxBottoni.queryById("btnNuovo").setVisible(!1))},onLaunch:function(){var b=this;ImpostaUrl([b.getCbClassificazione().getStore()]);Ext.isEmpty(b.cbaConfig.regione)&&Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/servizi/regione",async:!1,params:{idServizio:b.cbaConfig.idServizio},success:function(c){c=Ext.JSON.decode(c.responseText);
var d=[];c.success?b.cbaConfig.regione=c.data:msgAddError(d,c.message)}});b.gestioneForm()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtClassRetta_Amb",{extend:"Generali.standard.ViewController",parametriStampa:{hideMenu:!0},init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntForm",selector:this.selContainer+"#CntForm"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"ContainerPrestazioni",selector:this.selContainer+"#ContainerPrestazioni"},{ref:"ContainerPaganti",selector:this.selContainer+
"#ContainerPaganti"},{ref:"BtnCreaAnagrafica",selector:this.selContainer+"#BtnCreaAnagrafica"},{ref:"BtnElaboraFattura",selector:this.selContainer+"#BtnElaboraFattura"},{ref:"Impegnativa",selector:this.selContainer+"#Impegnativa"},{ref:"BtnCreaImpegnativa",selector:this.selContainer+"#BtnCreaImpegnativa"},{ref:"EditClassificazioniDataDal",selector:this.selContainer+"#EditClassificazioniDataDal"},{ref:"CodiceEsenzione",selector:this.selContainer+"#CodiceEsenzione"},{ref:"CBPosizioneTicket",selector:this.selContainer+
"#CBPosizioneTicket"},{ref:"CBTipoEsenzione",selector:this.selContainer+"#CBTipoEsenzione"},{ref:"QuotaTicket",selector:this.selContainer+"#QuotaTicket"},{ref:"TotalePrestazioni",selector:this.selContainer+"#TotalePrestazioni"},{ref:"CbStatoInvio",selector:this.selContainer+"#CbStatoInvio"}]);this.control(this.selContainer+"#BtnElaboraFattura",{click:this.BtnElaboraFatturaclick});this.control(this.selContainer+"#BtnCreaAnagrafica",{click:this.BtnCreaAnagraficaclick});this.control(this.selContainer+
"#BtnCreaImpegnativa",{click:this.BtnCreaImpegnativaclick});this.control(this.selContainer+"#Impegnativa",{change:this.changeImpegnativa});this.control(this.selContainer+"#EditClassificazioniDataDal",{change:this.changeDataDal});this.control(this.selContainer+"#CBPosizioneTicket",{change:this.changePosizioneTicket});this.control(this.selContainer+"#CbStatoInvio",{afterrender:this.afterrenderStatoInvio,select:this.selectStatoInvio})},afterrenderStatoInvio:function(b,c){var d=this;tipoFlusso=currRicovero.servizio.tipoFlusso;
b.getEl().on("contextmenu",function(b){b.preventDefault();d.menu||(d.menu=Ext.create("Ext.menu.Menu",{items:[{text:traduci("FR_SBLOCCA_STATOINVIO"),singoloRecord:!0,handler:function(b){[11].includes(tipoFlusso)?Messaggio("ATTENZIONE",traduci("FR_WARN_SBLOCCO_STATO_PRATICA"),"YESNO","QUESTION",!1,function(){d.getCbStatoInvio().setReadOnly(!1);d.cbaConfig.controllerPortlet.cbaConfig.sbloccaStatoInvio=!0}):Ext.widget("passwordCBA",{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(b){b&&(d.getCbStatoInvio().setReadOnly(!1),
d.cbaConfig.controllerPortlet.cbaConfig.sbloccaStatoInvio=!0)}}).show()}}]}));1==d.getCbStatoInvio().readOnly&&d.menu.showAt(b.getXY())})},selectStatoInvio:function(){this.forzaStatoInvio=!0},changeDataDal:function(b,c,d,f){isValidDate(b)&&this.getCBPosizioneTicket().getStore().load({params:{idServizio:currRicovero.servizio.id,data:c},callback:function(b,c,d){d||msgShowError("",c.getError())}})},changePosizioneTicket:function(b,c,d,f){if(this.getQuotaTicket().isDisabled()||Ext.isEmpty(d)&&!Ext.isEmpty(this.getQuotaTicket().getValue()))return!1;
b=trovaRecord(this.getCBPosizioneTicket().getStore(),"codice",c);this.getQuotaTicket().setValue(b.get("extra").split(",")[1])},changeImpegnativa:function(b,c,d,f){this.getCodiceEsenzione().setValue("");this.getCodiceEsenzione().setReadOnly(!0);this.getCBTipoEsenzione().clearValue();this.getCBTipoEsenzione().setReadOnly(!0);Ext.isEmpty(c)?(this.getQuotaTicket().setValue(null),this.getQuotaTicket().setDisabled(!0)):(b=trovaRecord(this.getImpegnativa().getStore(),"codice",c),Ext.isEmpty(b.data.extra.split(",")[0])||
this.getCodiceEsenzione().setValue(b.data.extra.split(",")[0]),Ext.isEmpty(b.data.extra.split(",")[1])||this.getCBTipoEsenzione().setValue(b.data.extra.split(",")[1]),this.getCBTipoEsenzione().setReadOnly(!(!Ext.isEmpty(this.getCodiceEsenzione().getValue())&&Ext.isEmpty(b.data.extra.split(",")[1]))),this.getQuotaTicket().setDisabled(!1),!Ext.isEmpty(this.getCBPosizioneTicket().getValue())&&Ext.isEmpty(this.getQuotaTicket().getValue())&&(b=trovaRecord(this.getCBPosizioneTicket().getStore(),"codice",
this.getCBPosizioneTicket().getValue()),this.getQuotaTicket().setValue(b.get("extra").split(",")[1])))},BtnElaboraFatturaclick:function(b,c,d){var f=this,g=newIdElab(),h=getPersonContabili(getIdOrg(),f.getEditClassificazioniDataDal().getValue(),!0,null),k=f.getEditClassificazioniDataDal().getValue(),l=new Date(k.getFullYear(),11==k.getMonth()?1:k.getMonth()+1,0),n=[];f.getContainerPrestazioni().down("grid").getStore().each(function(b){if(0<b.get("pianificato")||0<b.get("erogato"))n.push(b.get("idRisposta")),
b=new Date(b.get("dataPrestazione")),l<b&&(l=11==b.getMonth()?new Date(b.getFullYear(),11,31):new Date(b.getFullYear(),b.getMonth()+1,0))});if(0==n.length)return msgShowError("",traduci("MSG_ELABORA_FATTURE_AMBULATORIALE_KO")),!1;var p=[];b=f.getContainerPaganti().down("grid").getSelectionModel().getSelection()[0];p.push(b.get("codfocl"));b=traduci("MSG_ELABORA_FATTURE_PAGANTE_SELEZIONATO")+" <b>"+b.get("ragioneSociale")+"</b>?";Messaggio("ATTENZIONE",b,"YESNO","QUESTION",!1,function(){Ext.Ajax.request({method:"POST",
url:"/cba/osp/co/ws/rette/elab",params:{tipoContabilita:h.tipoContabilitaAbilitata,idEsercizio:h.idEsercizio,idAvanzamentoElaborazione:g,sovrascriviFatture:"T",dataDocumento:new Date,retteAnticipate:"F",mensilita:"M",dataDal:k,dataAl:l,presenti:"T",dimessi:"F",motiviDimissione:"",servizi:currRicovero.servizio.id,classificazioni:Ext.Array.unique(n).toString(),reparti:null,elencoOspiti:"("+currOspite.codOspite+")",elencoPaganti:"("+p.toString()+")"},timeout:18E5,success:function(b){b=Ext.JSON.decode(b.responseText);
b.success?(f.getBtnElaboraFattura().setDisabled(!0),msgShowText("",b.message),f.stampa(b.data,p)):msgShowError("",b.message)}});Ext.create("winElaborazione",{idElaborazione:g}).start()})},stampa:function(b,c){showWinStampa(43,CBA.parametriGenerali.codEnte,"CUStampaFatture",{configBtnStampa:Ext.apply(this.parametriStampa,{params:{format:"pdf",statoDaContabilizzare:"F",statoContabilizzato:"F",elencoPaganti:"("+c.toString()+")"}}),idFatture:b,eseguiStampa:!0,isAmbulatoriale:!0})},BtnCreaAnagraficaclick:function(b,
c,d){b=getPersonContabili(getIdOrg(),new Date,!0,null);4==b.tipoContabilitaAbilitata||5==b.tipoContabilitaAbilitata?c=(Ext.isEmpty(currOspite.indResidenza.indirizzo)?null:currOspite.indResidenza.indirizzo)+"#"+(Ext.isEmpty(currOspite.indResidenza.civico)?null:currOspite.indResidenza.civico)+"#"+(Ext.isEmpty(currOspite.indResidenza.esponente)?null:currOspite.indResidenza.esponente)+"#"+(Ext.isEmpty(currOspite.indResidenza.interno)?null:currOspite.indResidenza.interno):(c=currOspite.indResidenza.indirizzo,
currOspite.indResidenza.civico&&(c+=", "+currOspite.indResidenza.civico,currOspite.indResidenza.esponente&&(c+="/"+currOspite.indResidenza.esponente),currOspite.indResidenza.interno&&(c+=" Int. "+currOspite.indResidenza.interno)));checkInsertNewPagante(currOspite,c,b)},BtnCreaImpegnativaclick:function(){var b=this,c=Ext.create("winCBA",{name:"GeneraliOSP.portlet.view.Documenti",titolo:"INSERISCI_IMPEGNATIVA",dimensione:1,configItem:{codOspite:currOspite.codOspite,soloImpegnative:!0},soloImpegnative:!0});
c.show();c.on("close",function(){b.loadStoreImpegnativa()})},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow("",b);return 0==b.length?!0:!1},salvaForm:function(b){var c=this.getForm(),d=c.getForm(),f=d.getFieldValues(),d=d.findField("statoInvio").getValue();this.forzaStatoInvio||"F"!=d||(d="M");Ext.apply(f,{idRicovero:this.cbaConfig.idRicovero,motivoAssenzaDefault:-100,statoInvio:d});controller_salvaRecord(c,f,b,{})&&b&&this.callbackEsci&&
this.callbackEsci()},gestioneForm:function(){var b=this,c=b.getForm(),d=b.cbaConfig.gridStorico,f=b.cbaConfig.tabClass;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=d.getStore();c.controller=b;b.getQuotaTicket().setDisabled(!0);d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},annulla_callback:function(){b.aggiornaStore(c.getForm().findField("id").getValue())},nuovo_callback:function(){containerSolaLettura(c,!1);controller_nuovoRecord(c);
f.setDisabled(!0);b.getContainerPrestazioni().hide();b.getContainerPaganti().hide();b.getQuotaTicket().setReadOnly(!0);b.getQuotaTicket().setValue(null);b.getTotalePrestazioni().setReadOnly(!0);b.getTotalePrestazioni().setValue(null);c.getForm().findField("dataDecorrenza").setValue(0==b.cbaConfig.gridStorico.getStore().count()?currRicovero.dataDal:new Date);c.getForm().findField("statoInvio").setValue("T")},elimina_callback:function(){var d=c.getForm().findField("id").getValue(),f=b.getCbStatoInvio().getValue();
!Ext.isEmpty(d)&&f&&("T"==f||"8"==f||"9"==f?controller_eliminaRecord(c.store,{id:d},function(){b.aggiornaStore()},null,traduci("FR_ELIMINA_PRATICA")):Messaggio("ELIMINA",traduci("MSG_ELIMINA"),"YESNO","QUESTION","",function(){c.getForm().setValues({statoInvio:"8"});b.salvaForm(!1)}))},verificaCampiForm_callback:function(){return b.verificaCampiForm()},esci_callback:function(){var c=b.getForm().up("window");!b.cbaConfig.noPortlet&&b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&
b.cbaConfig.controllerPortlet.updatePortlet();c.close()}}});inserisciBottoni(c.boxBottoni,d);b.cbaConfig.wizard&&c.boxBottoni.queryById("btnEsci").setVisible(!1);if("L"!=b.cbaConfig.permesso)c.getForm().on("dirtychange",function(d,h){controller_abilitaBottoni(c);8!=b.getCbStatoInvio().getValue()&&9!=b.getCbStatoInvio().getValue()||b.getBoxBottoni().queryById("btnElimina").setDisabled(!0);f.setDisabled(h);b.cbaConfig.gridStorico.setDisabled(h);b.getContainerPrestazioni().setDisabled(h);b.getContainerPaganti().setDisabled(h);
b.getBtnCreaAnagrafica().setDisabled(h)});else containerSolaLettura(b.getForm()),containerSolaLettura(b.getContainerPrestazioni()),containerSolaLettura(b.getContainerPaganti()),controller_abilitaBottoni(c),b.getBtnCreaAnagrafica().setDisabled(!0),b.getBoxBottoni().queryById("btnEsci").setDisabled(!1);0==b.cbaConfig.gridStorico.getStore().getCount()&&b.aggiornaStore()},impostaDati:function(b){var c=this,d=c.getForm();clearForm(d);c.loadStoreImpegnativa();c.loadCombo();setTimeout(function(){d.loadRecord(b);
c.getContainerPrestazioni().show();c.getContainerPrestazioni().down("grid").controller.aggiornaStore()},500);c.getBoxBottoni().queryById("btnElimina").setDisabled(8==b.get("statoInvio")||9==b.get("statoInvio"));c.getImpegnativa().setReadOnly("T"!=b.get("statoInvio"))},aggiornaStore:function(b){clearForm(this.getForm());this.getContainerPrestazioni().hide();this.getContainerPaganti().hide();this.cbaConfig.caricaGrid(this.cbaConfig.gridStorico,b);this.forzaStatoInvio=!1},loadStoreImpegnativa:function(){this.getImpegnativa().getStore().load({params:{codOspite:currOspite.codOspite},
callback:function(b,c,d){d||msgShowError("",c.getError())}})},loadCombo:function(){this.getCBTipoEsenzione().getStore().load({params:{idServizio:0},callback:function(b,c,d){d||msgShowError("",c.getError())}});this.getCbStatoInvio().getStore().load()},onLaunch:function(){ImpostaUrl([this.getImpegnativa().getStore(),this.getCBPosizioneTicket().getStore(),this.getCBTipoEsenzione().getStore(),this.getCbStatoInvio().getStore()]);this.getCbStatoInvio().setReadOnly(this.cbaConfig.wizard||this.cbaConfig.controllerPortlet&&
!this.cbaConfig.controllerPortlet.cbaConfig.sbloccaStatoInvio);this.forzaStatoInvio=!1;this.loadStoreImpegnativa();this.loadCombo();this.gestioneForm();this.gestGridPrestazioni=Ext.create("GeneraliOSP.portlet.view.EdtClassRetta_CdiPrestazioni",{itemId:"EdtClassRetta_CdiPrestazioni",reference:"EdtClassRetta_CdiPrestazioni",cbaConfig:{permesso:this.cbaConfig.permesso,gridStorico:this.cbaConfig.gridStorico,controllerTestata:this,isAmbulatoriale:!0,idRicovero:this.cbaConfig.idRicovero,tipoServizio:this.cbaConfig.tipoServizio,
abilitaTariffaRettaPers:this.cbaConfig.abilitaTariffaRettaPers,modalitaAdtSemplificato:this.cbaConfig.modalitaAdtSemplificato}});this.getContainerPrestazioni().add(this.gestGridPrestazioni);if(CBA.moduli.modulo43.abilitato||50==CBA.moduli.moduloAttivo)this.gestGridPaganti=Ext.create("GeneraliOSP.portlet.view.EdtClassRetta_CdiPaganti",{itemId:"EdtClassRetta_CdiPaganti",reference:"EdtClassRetta_CdiPaganti",cbaConfig:{permesso:this.cbaConfig.permesso,gridStorico:this.cbaConfig.gridStorico,controllerTestata:this,
controllerPrestazioni:this.gestGridPrestazioni.down("grid").controller,tipoServizio:this.cbaConfig.tipoServizio}}),this.getContainerPaganti().add(this.gestGridPaganti)},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtClassRetta_Cdi",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntForm",selector:this.selContainer+"#CntForm"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CbProfiloUtente",selector:this.selContainer+"#CbProfiloUtente"},{ref:"EditCDIMotivoAss",selector:this.selContainer+"#EditCDIMotivoAss"},
{ref:"ContainerPrestazioni",selector:this.selContainer+"#ContainerPrestazioni"},{ref:"ContainerPaganti",selector:this.selContainer+"#ContainerPaganti"},{ref:"BtnCreaAnagrafica",selector:this.selContainer+"#BtnCreaAnagrafica"}]);this.control(this.selContainer+"#BtnCreaAnagrafica",{click:this.BtnCreaAnagraficaclick});this.control(this.selContainer+"#CbProfiloUtente",{select:this.selectCbProfiloUtente})},selectCbProfiloUtente:function(b,c,d){this.idProfiloOriginale!=b.value&&"T"==c.data.extra&&msgShowWarning("ATTENZIONE",
"MSG_ELEMENTO_DISATTIVATO")},verificaCampiForm:function(){var b=[];this.getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");msgShow("",b);return 0==b.length?!0:!1},salvaForm:function(b){var c=this,d=c.getForm(),f=d.getForm(),g=f.getFieldValues();Ext.apply(g,{idRicovero:c.cbaConfig.idRicovero,dataFine:f.findField("dataFine").getValue()});var f=d.store.getCount(),h={};if(c.idProfiloOriginale&&c.idProfiloOriginale!=g.idProfilazione){var k=c.getContainerPrestazioni().down("grid").getStore().getCount();
if(k&&0<k){controller_abilitaBottoni(d);msgShowError("Attenzione","MSG_BLOCCO_CAMBIO_PROFILAZIONE");return}}var l=0>g.id&&0<f&&0<d.store.count();l&&d.store.getAt(0).get("idProfilazione")!=g.idProfilazione&&(l=!1,msgShowWarning("","MSG_ANNULLACOPIA_PRESTAZIONI_PRECEDENTI"));(new Promise(function(b,f){if(l){var g=Messaggio("Attenzione","MSG_COPIA_PRESTAZIONI_PRECEDENTI","YESNO","QUESTION","",function(){Ext.apply(h,{idTestataDaCopiare:d.store.getAt(0).get("id"),aggiornaQuote:g.ckbValue});b()},function(){b()});
c.cbaConfig.modalitaAdtSemplificato||(g.add({xtype:"checkboxfield",boxLabel:traduci("MSG_COPIA_PRESTAZIONI_AGGIORNA_QUOTE"),checked:!0,inputValue:"T",uncheckedValue:"F",margin:"0 5 0 25"}),g.on("hide",function(b){var c=b.down("checkbox");b.ckbValue=getBoolValue(c.getValue());b.remove(c)},c,{single:!0}))}else b()})).then(function(){controller_salvaRecord(d,g,b,h)&&b&&c.callbackEsci&&c.callbackEsci()})},gestioneForm:function(){var b=this,c=b.getForm(),d=b.cbaConfig.gridStorico,f=b.cbaConfig.tabClass;
c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=d.getStore();c.controller=b;d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salvaForm(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){containerSolaLettura(c,!1);controller_nuovoRecord(c);f.setDisabled(!0);b.getContainerPrestazioni().hide();b.getContainerPaganti().hide();var d=b.getCbProfiloUtente().getStore();b.idProfiloOriginale=
1==d.getCount()?d.getAt(0).get("codice"):null;b.idPrestazioneOriginale=null;c.getForm().setValues({dataDecorrenza:0==b.cbaConfig.gridStorico.getStore().count()&&"undefined"!==typeof currRicovero?currRicovero.dataDal:new Date,idProfilazione:b.idProfiloOriginale})},elimina_callback:function(){var d=c.getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,{id:d},function(){b.aggiornaStore()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},esci_callback:function(){var c=
b.getForm().up("window");!b.cbaConfig.noPortlet&&b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()}}});inserisciBottoni(c.boxBottoni,d);b.cbaConfig.wizard&&c.boxBottoni.queryById("btnEsci").setVisible(!1);if("L"!=c.permesso)c.getForm().on("dirtychange",function(d,h){controller_abilitaBottoni(c);f.setDisabled(h);b.getContainerPrestazioni().setDisabled(h);b.getContainerPaganti().setDisabled(h);b.getBtnCreaAnagrafica().setDisabled(h)});
"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getForm()),containerSolaLettura(b.getContainerPrestazioni()),containerSolaLettura(b.getContainerPaganti()),controller_abilitaBottoni(c),b.getBtnCreaAnagrafica().setDisabled(!0),b.getBoxBottoni().queryById("btnEsci").setDisabled(!1));0==b.cbaConfig.gridStorico.getStore().getCount()&&b.aggiornaStore()},impostaDati:function(b){var c=this.getForm();clearForm(c);this.idProfiloOriginale=b?b.get("idProfilazione"):null;this.idPrestazioneOriginale=b?b.get("prestazione"):
null;c.loadRecord(b);this.getContainerPrestazioni().show();this.getContainerPrestazioni().down("grid").controller.aggiornaStore()},aggiornaStore:function(b){clearForm(this.getForm());this.getContainerPrestazioni().hide();this.getContainerPaganti().hide();this.cbaConfig.caricaGrid(this.cbaConfig.gridStorico,b)},BtnCreaAnagraficaclick:function(b,c,d){b=getPersonContabili(getIdOrg(),new Date,!0,null);4==b.tipoContabilitaAbilitata||5==b.tipoContabilitaAbilitata?c=(Ext.isEmpty(currOspite.indResidenza.indirizzo)?
null:currOspite.indResidenza.indirizzo)+"#"+(Ext.isEmpty(currOspite.indResidenza.civico)?null:currOspite.indResidenza.civico)+"#"+(Ext.isEmpty(currOspite.indResidenza.esponente)?null:currOspite.indResidenza.esponente)+"#"+(Ext.isEmpty(currOspite.indResidenza.interno)?null:currOspite.indResidenza.interno):(c=currOspite.indResidenza.indirizzo,currOspite.indResidenza.civico&&(c+=", "+currOspite.indResidenza.civico,currOspite.indResidenza.esponente&&(c+="/"+currOspite.indResidenza.esponente),currOspite.indResidenza.interno&&
(c+=" Int. "+currOspite.indResidenza.interno)));checkInsertNewPagante(currOspite,c,b)},impostaModalitaAdtSemplificato:function(){if(this.cbaConfig.modalitaAdtSemplificato)this.getBtnCreaAnagrafica().setVisible(!1);else if(CBA.moduli.modulo43.abilitato||50==CBA.moduli.moduloAttivo)this.gestGridPaganti=Ext.create("GeneraliOSP.portlet.view.EdtClassRetta_CdiPaganti",{itemId:"EdtClassRetta_CdiPaganti",reference:"EdtClassRetta_CdiPaganti",cbaConfig:{permesso:this.cbaConfig.permesso,gridStorico:this.cbaConfig.gridStorico,
controllerTestata:this,controllerPrestazioni:this.gestGridPrestazioni.down("grid").controller,tipoServizio:this.cbaConfig.tipoServizio}}),this.getContainerPaganti().add(this.gestGridPaganti)},onLaunch:function(){var b=this.getCbProfiloUtente(),c=b.getStore(),d=this.getEditCDIMotivoAss().getStore();ImpostaUrl([c,d]);this.gestioneForm();var f=StdUtenti.promiseLoadStore(c,{tipoServizio:this.cbaConfig.tipoServizio,idServizio:this.cbaConfig.idServizio}),d=StdUtenti.promiseLoadStore(d,{idServizio:this.cbaConfig.idServizio});
Promise.all([f,d]).then(function(d){1==c.getCount()&&b.hide()})["catch"](function(b){return msgShowError("",b)});this.gestGridPrestazioni=Ext.create("GeneraliOSP.portlet.view.EdtClassRetta_CdiPrestazioni",{itemId:"EdtClassRetta_CdiPrestazioni",reference:"EdtClassRetta_CdiPrestazioni",cbaConfig:{permesso:this.cbaConfig.permesso,gridStorico:this.cbaConfig.gridStorico,controllerTestata:this,tipoServizio:this.cbaConfig.tipoServizio,idRicovero:this.cbaConfig.idRicovero,abilitaTariffaRettaPers:this.cbaConfig.abilitaTariffaRettaPers,
controllerPortlet:this.cbaConfig.controllerPortlet,modalitaAdtSemplificato:this.cbaConfig.modalitaAdtSemplificato}});this.getContainerPrestazioni().add(this.gestGridPrestazioni);this.impostaModalitaAdtSemplificato()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtClassRetta_CdiPaganti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grid",selector:this.selContainer+"#Grid"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"CbPagante",selector:this.selContainer+"#CbPagante"},{ref:"CbTipoQuota",selector:this.selContainer+"#CbTipoQuota"},{ref:"CBPagantiAtt",
selector:this.selContainer+"#CBPagantiAtt"},{ref:"RdgEdtPaganti",selector:this.selContainer+"#RdgEdtPaganti"},{ref:"GridQPresSanitaria",selector:this.selContainer+"#GridQPresSanitaria"},{ref:"GridQPresSociale",selector:this.selContainer+"#GridQPresSociale"},{ref:"GridQuotePresenza",selector:this.selContainer+"#GridQuotePresenza"},{ref:"GridQuoteAssenza",selector:this.selContainer+"#GridQuoteAssenza"}]);this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+
"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#CBPagantiAtt",{change:this.aggiornaStore});this.control(this.selContainer+"#Grid",{beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,validateedit:this.validateeditGrid});this.control(this.selContainer+"#RdgEdtPaganti",{change:this.onRdgEdtPagantiChange})},onRdgEdtPagantiChange:function(){var b=this.cbaConfig.controllerTestata.getForm().getRecord(),c=this.getGrid().getPlugin().getEditor().getForm();
this.aggiornaComboPagante(b,c)},aggiornaComboPagante:function(b,c){var d=this,f=c.findField("codfocl"),g;"F"==d.getRdgEdtPaganti().getValue().filtroPaganti?(g=d.storePagantiFascicolo,f.bindStore(g),f.queryMode="local",g.getProxy().extraParams.idRicovero=b.get("idRicovero"),b&&(g.getProxy().extraParams.dataDal=b.data.dataDecorrenza,g.getProxy().extraParams.dataAl=b.data.dataFine),g.load({callback:function(b,g,l){l&&(1==b.length&&(g=b[0].get("codice"),f.setValue(g),isTipoServAmb(d.cbaConfig.tipoServizio)||
c.findField("dataDal").setValue(giornoInizioMese(new Date))),0<b.length?d.filtraComboPaganti(this):(d.getRdgEdtPaganti().setValue({filtroPaganti:"U"}),d.getRdgEdtPaganti().setDisabled(!0)))}})):(f.bindStore(d.storeListaPaganti),f.queryMode="remote")},verificaPagante:function(b,c){var d=[];null!==b.dataDal&&b.dataDal>b.dataAl&&b.dataAl&&msgAddError(d,"MSG_DATADAL_MAGGIORE_DATAAL");Ext.isNumber(b.codfocl)||msgAddError(d,"MSG_SELZIONARE_PAGANTE");(b.quotaSanitaria&&0>b.quotaSanitaria||b.quotaSociale&&
0>b.quotaSociale)&&msgAddError(d,"MSG_QUOTE_NEGATIVE");"M"==this.cbaConfig.tipoServizio&&"T"===b.tipoQuota&&(b.quotaSanitariaAssenza=null,b.quotaSocialePresenza=null,b.quotaSocialeAssenza=null);if("T"===b.tipoQuota){var f=[];Ext.each(this.getGrid().getStore().data.items,function(b){"T"===b.get("tipoQuota")&&f.push([b.get("id"),b.get("dataDal"),null!=b.get("dataAl")?b.get("dataAl"):new Date("01-01-2100")])});if(0!=f.length)for(var g=0,h=f.length;g<h;g++)if(!c||f[g][0]!=c)if(b.dataAl)if(b.dataAl>=f[g][1]&&
b.dataAl<=f[g][2]){msgAddError(d,"MSG_QUOTATMAX_OVER");break}else{if(b.dataAl>=f[g][2]&&b.dataDal<=f[g][2]){msgAddError(d,"MSG_QUOTATMAX_OVER");break}}else if(!b.dataAl&&b.dataDal<=f[g][2]){msgAddError(d,"MSG_QUOTATMAX_OVER");break}}return msgShow("",d)},abilitaBottoniPagante:function(b){this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b);this.getCBPagantiAtt().setDisabled(!b);this.cbaConfig.controllerTestata.getForm().setDisabled(!b);this.cbaConfig.controllerTestata.cbaConfig.tabClass.setDisabled(!b);
this.cbaConfig.controllerTestata.getBoxBottoni().setDisabled(!b);this.cbaConfig.controllerPrestazioni.getGrid().setDisabled(!b)},clickBtnNuovo:function(b){b=quotaPSoc=quotaPSanAss=quotaPSocAss=100;"M"==this.cbaConfig.tipoServizio&&(quotaPSanAss=quotaPSocAss=0,b=Ext.isEmpty(this.cbaConfig.controllerTestata.getForm().getRecord().get("idImpegnativa"))?0:100,quotaPSoc=Ext.isEmpty(this.cbaConfig.controllerTestata.getForm().getRecord().get("idImpegnativa"))?100:0);b={idCdiPlanTestata:this.cbaConfig.controllerTestata.getForm().getForm().findField("id").getValue(),
tipoQuota:"P",quotaSanitaria:b,quotaSociale:quotaPSoc,quotaSanitariaAssenza:quotaPSanAss,quotaSocialeAssenza:quotaPSocAss,ragioneSociale:null,dataDal:"M"==this.cbaConfig.tipoServizio?this.cbaConfig.controllerTestata.getForm().getForm().findField("dataDecorrenza").getValue():null};controller_nuovoRecordGrid(b,this.getGrid())},clickBtnElimina:function(b){var c=this;b=c.getGrid();var d=b.getSelectionModel().getSelection()[0];d&&(b.getStore().cbaConfig.idPagante=d.get("id"));controller_eliminaRecord(b.getStore(),
{idPagante:d?d.get("id"):""},function(){c.getGrid().verificaEditAuto=!1;c.getGrid().columns[0].getEditor().getStore().removeAll();c.aggiornaStore(d.get("id"))})},beforeeditGrid:function(b,c,d){var f=this;if(!0===f.getGrid().getPlugin().editing)return!1;f.abilitaBottoniPagante(!1);f.abilitaRdgEdtPaganti(!0);f.getCbTipoQuota().cbaConfig.initChange||(f.getCbTipoQuota().addListener("change",function(b,c){var d=b.up().getForm(),g=d.findField("quotaSanitaria"),h=d.findField("quotaSociale"),k=d.findField("quotaSanitariaAssenza"),
r=d.findField("quotaSocialeAssenza");isTipoServAmb(f.cbaConfig.tipoServizio)&&"T"===c&&(g.setValue(0),h.setValue(0),k.setValue(0),r.setValue(0));f.abilitaCampoQuotaPagante(d,"quotaSanitaria",c);f.abilitaCampoQuotaPagante(d,"quotaSanitariaAssenza",c);f.abilitaCampoQuotaPagante(d,"quotaSociale",c);f.abilitaCampoQuotaPagante(d,"quotaSocialeAssenza",c)}),f.getCbTipoQuota().getStore().clearFilter(),"M"==f.cbaConfig.tipoServizio&&Ext.isEmpty(f.cbaConfig.controllerTestata.getForm().getRecord().get("idImpegnativa"))&&
f.getCbTipoQuota().getStore().filter({filterFn:function(b){return"T"!=b.data.codice}}),f.getCbTipoQuota().cbaConfig.initChange=!0);f.getCbPagante().cbaConfig.initChange||(f.getCbPagante().getStore().getProxy().setExtraParam("tipoContabilita",f.personContabili.tipoContabilitaAbilitata),f.getCbPagante().getStore().getProxy().setExtraParam("limit",0),f.getCbPagante().cbaConfig.initChange=!0);d=f.cbaConfig.controllerTestata.getForm().getRecord();b=b.getEditor().getForm();var g=b.findField("codfocl");
f.aggiornaComboPagante(d,b);c.colIdx=0;c.record.get("codfocl")&&c.record.get("ragioneSociale")&&("U"==f.getRdgEdtPaganti().getValue().filtroPaganti?g.getStore().load({params:{valore:c.record.get("ragioneSociale")},callback:function(b,d,l){l&&(f.filtraComboPaganti(g.getStore()),c.record.get("codfocl")&&g.setValue(c.record.get("codfocl")))}}):g.setValue(c.record.get("codfocl")));f.abilitaCampoQuotaPagante(b,"quotaSanitaria",c.record.get("tipoQuota"));f.abilitaCampoQuotaPagante(b,"quotaSanitariaAssenza",
c.record.get("tipoQuota"));f.abilitaCampoQuotaPagante(b,"quotaSociale",c.record.get("tipoQuota"));f.abilitaCampoQuotaPagante(b,"quotaSocialeAssenza",c.record.get("tipoQuota"));f.cbaConfig.filtra=!1},editGrid:function(b,c,d){d=b.getEditor().getForm();d.controller=this;d.store=c.view.getStore();var f=c.record.data;Ext.apply(f,{idCdiPlanTestata:this.cbaConfig.controllerTestata.getForm().getForm().findField("id").getValue(),idRisposta:this.cbaConfig.controllerPrestazioni.getGrid().getSelectionModel().getSelection()[0].get("idRisposta"),
quotaSanitaria:d.findField("quotaSanitaria").getValue(),quotaSociale:d.findField("quotaSociale").getValue(),quotaSanitariaAssenza:d.findField("quotaSanitariaAssenza").getValue(),quotaSocialeAssenza:d.findField("quotaSocialeAssenza").getValue()});this.cbaConfig.filtra=!1;controller_salvaRecord(d,f,!1,{tipoServizio:this.cbaConfig.tipoServizio})?(this.abilitaRdgEdtPaganti(!1),this.cbaConfig.filtra=!0,this.abilitaBottoniPagante(!0)):b.startEdit(c.record,0)},canceleditGrid:function(b,c,d){this.cbaConfig.filtra=
!0;this.getGrid().verificaEditAuto=!1;this.abilitaBottoniPagante(!0);this.aggiornaStore(c.record.get("id"));this.abilitaRdgEdtPaganti(!1)},abilitaRdgEdtPaganti:function(b){var c=this.getRdgEdtPaganti(),d=this.getCBPagantiAtt();b?(c.setVisible(!0),d.setHidden(!0),c.setValue({filtroPaganti:"F"})):(c.setHidden(!0),d.setVisible(!0))},validateeditGrid:function(b,c,d){return this.verificaPagante(c.newValues,c.record.get("id"))},aggiornaStore:function(b){var c=this,d=c.getGrid(),f=d.getStore();isTipoServAmb(c.cbaConfig.tipoServizio)&&
(c.getGridQuotePresenza().setMargin("-7 0 0 0"),c.getGridQPresSanitaria().setVisible(!Ext.isEmpty(c.cbaConfig.controllerTestata.getForm().getRecord().get("idImpegnativa"))),c.getGridQPresSociale().setVisible(Ext.isEmpty(c.cbaConfig.controllerTestata.getForm().getRecord().get("idImpegnativa"))));c.getCbTipoQuota()&&(c.getCbTipoQuota().cbaConfig.initChange=!1);c.getRdgEdtPaganti().setDisabled(!1);f.load({params:{idTestata:c.cbaConfig.controllerTestata.getForm().getForm().findField("id").getValue(),
idRisposta:c.cbaConfig.controllerPrestazioni.getGrid().getSelectionModel().getSelection()[0].get("idRisposta")},callback:function(f,h,k){Ext.isEmpty(f)?d.verificaEditAuto&&c.permettiModificheDopoDimissione&&c.getBtnNuovo().fireEvent("click"):(d.verificaEditAuto=!0,c.filtraPagantiAttivi(),posizionaRecordGrid(d,f,b,"id"))}})},filtraPagantiAttivi:function(){var b=this,c=b.getGrid().getStore();b.getCBPagantiAtt().checked?c.filter({filterFn:function(c){var d=!1,g=new Date;if(b.cbaConfig.filtra){if(g>=
c.data.dataDal&&(g<=c.data.dataAl||!c.data.dataAl)||g<=c.data.dataDal&&(g>=c.data.dataAl||!c.data.dataAl))d=!0;return d}return!0}}):c.clearFilter()},filtraComboPaganti:function(b){var c=this;b.clearFilter();b.filter({filterFn:function(b){return"4"!=c.personContabili.tipoContabilitaAbilitata&&"5"!=c.personContabili.tipoContabilitaAbilitata||""==b.data.extra.split(",")?!0:"T"==b.data.extra.split(",")[1]?!0:!1}})},abilitaCampoQuotaPagante:function(b,c,d){b=b.findField(c);var f=isTipoServAmb(this.cbaConfig.tipoServizio);
b.allowBlank=f&&("T"===d||-1!=c.indexOf("Assenza"));b.setDisabled(f&&"T"===d);b.validateValue(b.getValue())},onLaunch:function(){var b=this.getGrid();this.permettiModificheDopoDimissione=permettiModificheDopoDimissione();this.storePagantiFascicolo=Ext.create("CU.store.PagantiFascicoloPeriodo",{autoDestroy:!1});this.storeListaPaganti=Ext.create("GeneraliOSP.portlet.store.ListaPaganti",{autoDestroy:!1});ImpostaUrl([b.getStore(),this.storePagantiFascicolo]);b.controller=this;this.cbaConfig.filtra=!0;
b.verificaEditAuto=!0;this.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null);this.storeListaPaganti.getProxy().setExtraParam("tipoContabilita",this.personContabili.tipoContabilitaAbilitata);this.storeListaPaganti.getProxy().setExtraParam("limit",0);this.filtraComboPaganti(this.storeListaPaganti);this.permettiModificheDopoDimissione||(containerSolaLettura(this.getGrid()),this.getBtnNuovo().setDisabled(!0),this.getBtnElimina().setDisabled(!0));this.getGridQuoteAssenza().setVisible("M"!=
this.cbaConfig.tipoServizio)},destroy:function(){eliminaStore(this.storePagantiFascicolo);eliminaStore(this.storeListaPaganti);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtClassRetta_CdiPrestazioni",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Grid",selector:this.selContainer+"#Grid"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"LblAuto",selector:this.selContainer+"#LblAuto"},{ref:"CBClasInt",
selector:this.selContainer+"#CBClasInt"},{ref:"CBClasReg",selector:this.selContainer+"#CBClasReg"},{ref:"GridQuotaSanitaria",selector:this.selContainer+"#GridQuotaSanitaria"},{ref:"GridQuotaSociale",selector:this.selContainer+"#GridQuotaSociale"}]);this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#Grid",{beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,
validateedit:this.validateeditGrid,afterrender:this.afterrenderGrid,select:this.selectGrid})},selectGrid:function(b,c,d){c.get("id")&&(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)&&!this.cbaConfig.modalitaAdtSemplificato&&(this.cbaConfig.controllerTestata.getContainerPaganti().show(),this.cbaConfig.controllerTestata.getContainerPaganti().down("grid").controller.aggiornaStore())},afterrenderGrid:function(b){b.columns[getGiornoAttuale()+3].addCls("selezionato")},clickBtnNuovo:function(b){b=
{idCdiPlanTestata:this.cbaConfig.controllerTestata.getForm().getForm().findField("id").getValue(),idRisposta:null,lun:"F",mar:"F",mer:"F",gio:"F",ven:"F",sab:"F",dom:"F"};controller_nuovoRecordGrid(b,this.getGrid());this.getLblAuto().setVisible(!0);this.getCBClasInt().setVisible(!0);this.getCBClasReg().setVisible("L"!=this.cbaConfig.controllerTestata.cbaConfig.regione);this.getGridQuotaSanitaria().setVisible},clickBtnElimina:function(b){var c=this;b=c.getGrid();var d=b.getSelectionModel().getSelection()[0];
d&&(b.getStore().cbaConfig.idRisposta=d.get("idRisposta"));d&&(Ext.getCmp("CBClasInt").getValue()||Ext.getCmp("CBClasReg").getValue()?(b={idClassificazione:id,idTestata:d?d.get("idCdiPlanTestata"):"",idRisposta:d?d.get("idRisposta"):"",autoInt:Ext.getCmp("CBClasInt").getValue(),autoReg:Ext.getCmp("CBClasReg").getValue()},creaWin({id:"EliminaRettaeClassificazione",dimensioneWindow:"Calcolatrice",titolo:"Elimina",permesso:c.cbaConfig.permesso,permessoDB:c.cbaConfig.permesso,projectName:"GeneraliOSP.portlet",
config:b,altezzaWin:220,callbackEsci:function(){c.aggiornaStore()}})):controller_eliminaRecord(b.getStore(),{idTestata:d?d.get("idCdiPlanTestata"):"",idRisposta:d?d.get("idRisposta"):""},function(){c.aggiornaStore()}))},beforeeditGrid:function(b,c,d){if(!0===b.editing)return!1;b.getEditor().getForm().findField("idRisposta").setDisabled(c.record.get("idRisposta"));this.cbaConfig.isAmbulatoriale&&1==this.getGrid().getStore().count()&&StdUtenti.getCodFoclAssDistr(currOspite.indResidenza,currRicovero.idServizio,
this.cbaConfig.regione);this.abilitaBottoniGrid(!1)},editGrid:function(b,c,d){var f=this,g=this,h=b.getEditor().getForm(),k=c.record.getData();g.getLblAuto().setVisible(!1);g.getCBClasInt().setVisible(!1);g.getCBClasReg().setVisible(!1);h.controller=this;h.store=c.view.getStore();Ext.apply(k,{id:k.id,idCdiPlanTestata:g.cbaConfig.controllerTestata.getForm().getForm().findField("id").getValue(),lun:getBoolValue(k.lun),mar:getBoolValue(k.mar),mer:getBoolValue(k.mer),gio:getBoolValue(k.gio),ven:getBoolValue(k.ven),
sab:getBoolValue(k.sab),dom:getBoolValue(k.dom)});var l=h.store.getCount(),n={tipoServizio:g.cbaConfig.tipoServizio,autoInt:g.getCBClasInt().getValue(),autoReg:g.getCBClasReg().getValue()};g.cbaConfig.isAmbulatoriale&&1==l&&currOspite.codFoclAssDistr&&Ext.apply(n,{codFoclAsst:currOspite.codFoclAssDistr});(new Promise(function(b,c){!k.id&&1<l&&(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)&&!f.cbaConfig.modalitaAdtSemplificato?Messaggio("Attenzione","MSG_COPIA_PAGANTI_PRESTAZIONE",
"YESNO","QUESTION","",function(){Ext.apply(n,{idRispostaPrecedente:h.store.getAt(l-1).get("idRisposta")});b()},function(){b()}):b()})).then(function(){delete k.dataPrestazione;controller_salvaRecord(h,k,!1,n)?g.abilitaBottoniGrid(!0):b.startEdit(c.record,0)})},canceleditGrid:function(b,c,d){this.abilitaBottoniGrid(!0);this.aggiornaStore(c.record.get("id"));this.getLblAuto().setVisible(!1);this.getCBClasInt().setVisible(!1);this.getCBClasReg().setVisible(!1)},validateeditGrid:function(b,c,d){return msgShow("",
[])},abilitaBottoniGrid:function(b){this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b);(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)&&this.cbaConfig.controllerTestata.getContainerPaganti().setDisabled(!b);this.cbaConfig.controllerTestata.getCntForm().setDisabled(!b);this.cbaConfig.controllerTestata.cbaConfig.tabClass.setDisabled(!b)},aggiornaStore:function(b){var c=this,d=c.getGrid(),f=d.getStore(),g={idTestata:c.cbaConfig.controllerTestata.getForm().getForm().findField("id").getValue()};
if(c.cbaConfig.isAmbulatoriale)Ext.apply(g,{idRicovero:c.cbaConfig.idRicovero}),c.getGridQuotaSanitaria().setVisible(!Ext.isEmpty(c.cbaConfig.controllerTestata.getForm().getRecord().get("idImpegnativa"))),c.getGridQuotaSociale().setVisible(Ext.isEmpty(c.cbaConfig.controllerTestata.getForm().getRecord().get("idImpegnativa")));else{var h=c.cbaConfig.controllerTestata.getForm().getForm().findField("idProfilazione").getValue();c.storePrest.clearFilter();c.storePrest.filter([{filterFn:function(b){b=b.get("tipo");
var c=[];b&&(c=b.split(",").map(function(b){return+b}));return c.includes(h)}}])}f.load({params:g,callback:function(g,h,n){if(n){h=b?StdSipcar.coalesce(trovaRecord(f,"idRisposta",b),0):0;var k=c.cbaConfig.controllerTestata;k&&k.cbaConfig.selezionaRecord&&(n=trovaRecord(f,"idRisposta",k.cbaConfig.selezionaRecord.idRisposta))&&(h=n);d.getSelectionModel().deselectAll();d.getSelectionModel().select(h?[h]:0);if(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)h=c.cbaConfig.controllerTestata.getContainerPaganti(),
null==g||0==g.length?(h.hide(),(h=h.down("grid"))&&svuotaStore(h.getStore())):h.show();if(c.cbaConfig.isAmbulatoriale&&k){k.getTotalePrestazioni().setValue(null);var l=0;!Ext.isEmpty(g)&&0<g.length&&g.forEach(function(b){l+=Ext.isEmpty(k.getForm().getRecord().get("idImpegnativa"))?b.get("quotaSociale")*b.get("quantita"):b.get("quotaSanitaria")*b.get("quantita")});k.getTotalePrestazioni().setValue(l)}}else msgShowError("",h.getError())}})},impostaModalitaAdtSemplificato:function(){var b=this.getGrid();
b.columnManager.getHeaderByDataIndex("quotaSanitaria").hide();b.columnManager.getHeaderByDataIndex("quotaSociale").hide();b.columnManager.getHeaderByDataIndex("totale").hide()},onLaunch:function(){var b=this,c=b.getGrid(),d=c.getStore();idServizio=b.cbaConfig.controllerTestata.cbaConfig.idServizio;c.controller=b;b.storePrest=Ext.create("GeneraliOSP.cercaFascicolo.store.Classificazioni");ImpostaUrl([d,b.storePrest]);b.cbaConfig.isAmbulatoriale&&(d.proxy.api.read=getUrlGen()+"/ws/genOsp/amb/prest/list",
c.columnManager.getHeaderByDataIndex("lun").hide(),c.columnManager.getHeaderByDataIndex("mar").hide(),c.columnManager.getHeaderByDataIndex("mer").hide(),c.columnManager.getHeaderByDataIndex("gio").hide(),c.columnManager.getHeaderByDataIndex("ven").hide(),c.columnManager.getHeaderByDataIndex("sab").hide(),c.columnManager.getHeaderByDataIndex("dom").hide(),c.columnManager.getHeaderByDataIndex("quantita").show(),c.columnManager.getHeaderByDataIndex("pianificato").show(),c.columnManager.getHeaderByDataIndex("residuo").show());
this.view.on("afterrender",function(){var d=StdUtenti.promiseLoadStore(b.storePrest,{type:1,idServizio:idServizio});Promise.all([d]).then(function(d){d=c.getVisibleColumns();for(idx in d){var f=d[idx];if("idRisposta"==f.dataIndex){f.getEditor().bindStore(b.storePrest);break}}})["catch"](function(b){return msgShowError("",b)})});permettiModificheDopoDimissione()||(containerSolaLettura(c),b.getBtnNuovo().setDisabled(!0),b.getBtnElimina().setDisabled(!0));b.cbaConfig.modalitaAdtSemplificato&&b.impostaModalitaAdtSemplificato()},
destroy:function(){eliminaStore(this.storePrest);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtClassRetta_Res",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntForm",selector:this.selContainer+"#CntForm"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"ContainerPaganti",selector:this.selContainer+"#ContainerPaganti"},{ref:"BtnSimula",selector:this.selContainer+"#BtnSimula"},{ref:"PnlImporti",
selector:this.selContainer+"#PnlImporti"},{ref:"EdtQuotaSoc",selector:this.selContainer+"#EdtQuotaSoc"},{ref:"EdtQuotaSocDefault",selector:this.selContainer+"#EdtQuotaSocDefault"},{ref:"EdtQuotaSan",selector:this.selContainer+"#EdtQuotaSan"},{ref:"EdtQuotaSanDefault",selector:this.selContainer+"#EdtQuotaSanDefault"},{ref:"EdtQuotaSanFatt",selector:this.selContainer+"#EdtQuotaSanFatt"},{ref:"EdtQuotaSocFatt",selector:this.selContainer+"#EdtQuotaSocFatt"},{ref:"EdtQuotaTot",selector:this.selContainer+
"#EdtQuotaTot"},{ref:"CbProfiloUtente",selector:this.selContainer+"#CbProfiloUtente"},{ref:"CbPrestazione",selector:this.selContainer+"#CbPrestazione"},{ref:"LblAuto",selector:this.selContainer+"#LblAuto"},{ref:"CBClasInt",selector:this.selContainer+"#CBClasInt"},{ref:"CBClasReg",selector:this.selContainer+"#CBClasReg"},{ref:"BtnCreaAnagrafica",selector:this.selContainer+"#BtnCreaAnagrafica"},{ref:"EditNote",selector:this.selContainer+"#EditNote"}]);this.control(this.selContainer+"#BtnSimula",{click:this.clickBtnSimula});
this.control(this.selContainer+"#EdtQuotaSoc",{change:this.changeEdtQuotaSoc});this.control(this.selContainer+"#EdtQuotaSan",{change:this.changeEdtQuotaSan});this.control(this.selContainer+"#BtnCreaAnagrafica",{click:this.BtnCreaAnagraficaclick});this.control(this.selContainer+"#CbProfiloUtente",{select:this.selectCbProfiloUtente});this.control(this.selContainer+"#CbPrestazione",{select:this.selectCbPrestazione})},verificaCampiForm:function(){var b=[],c=this.getForm();c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");
c=c.getForm().getFieldValues();(c.quotaSanitariaRetta&&0>c.quotaSanitariaRetta||c.quotaSocialeRetta&&0>c.quotaSocialeRetta)&&msgAddError(b,"MSG_QUOTE_NEGATIVE");msgShow("",b);return 0==b.length?!0:!1},salvaForm:function(b){var c=this,d=c.getForm(),f=d.getForm(),g=f.findField("idClassificazione").getValue(),h=d.getForm().getFieldValues();Ext.apply(h,{idClassificazione:g,tipoClassificazione:1,id:f.findField("id").getValue(),idRicovero:c.cbaConfig.idRicovero,dataDal:f.findField("dataDal").getValue(),
dataAl:f.findField("dataAl").getValue(),noteClassificazione:f.findField("noteClassificazione").getValue(),codiceClassificazione:f.findField("codiceClassificazione").getValue(),quotaSanitariaRetta:f.findField("quotaSanitariaRetta").getValue(),quotaSocialeRetta:f.findField("quotaSocialeRetta").getValue()});var k=c.storeForm,l=c.getCBClasInt().getValue(),n=c.getCBClasReg().getValue();delete h.quotaSanitariaDefault;delete h.quotaSocialeDefault;delete h.quotaSanitariaFatt;delete h.quotaSocialeFatt;delete h.totaleRettaFatt;
0>=g&&0<k.getCount()&&c.abilitaPaganti?Messaggio("Attenzione","MSG_COPIA_PAGANTI_CLASS","YESNO","QUESTION","",function(){controller_salvaRecord(d,h,b,{tipoServizio:currRicovero.servizio.tipoServizio,idClassPrecedente:k.getAt(0).get("idClassificazione"),autoInt:l,autoReg:n})&&b&&c.callbackEsci&&c.callbackEsci()},function(){controller_salvaRecord(d,h,b,{tipoServizio:currRicovero.servizio.tipoServizio,autoInt:l,autoReg:n,codFoclAsst:currOspite.codFoclAssDistr?currOspite.codFoclAssDistr:-1})&&b&&c.callbackEsci&&
c.callbackEsci()}):controller_salvaRecord(d,h,b,{tipoServizio:currRicovero.servizio.tipoServizio,autoInt:l,autoReg:n,codFoclAsst:0>=g&&currOspite.codFoclAssDistr?currOspite.codFoclAssDistr:-1})&&b&&c.callbackEsci&&c.callbackEsci()},showCBClassGestAuto:function(b){this.getLblAuto().setVisible(b);this.getCBClasInt().setVisible(b);this.getCBClasReg().setVisible(b)},gestioneForm:function(){var b=this,c=b.getForm(),d=b.cbaConfig.gridStorico,f=b.cbaConfig.tabClass;c.permesso=b.cbaConfig.permesso;c.boxBottoni=
b.getBoxBottoni();b.storeForm=c.store=d.getStore();c.controller=b;var g=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.showCBClassGestAuto(!1);b.salvaForm(c)},annulla_callback:function(){b.aggiornaStore();b.showCBClassGestAuto(!1)},nuovo_callback:function(){containerSolaLettura(c,!1);controller_nuovoRecord(c);b.getCBClasInt().setDisabled(!1);b.getCBClasReg().setDisabled(!1);b.showCBClassGestAuto(!0);f.setDisabled(!0);b.getContainerPaganti().hide();
var d=b.getCbProfiloUtente().getStore();b.idProfiloOriginale=1==d.getCount()?d.getAt(0).get("codice"):null;b.idPrestazioneOriginale=null;c.getForm().setValues({dataDal:0==b.cbaConfig.gridStorico.getStore().count()&&"undefined"!==typeof currRicovero?currRicovero.dataDal:new Date,idProfilazione:b.idProfiloOriginale});b.filtraStorePrestazioni(b.idProfiloOriginale)},elimina_callback:function(){var f=c.getForm().findField("id").getValue();Ext.isEmpty(f)||(b.getCBClasInt().getValue()||b.getCBClasReg().getValue()?
(f={idClassificazione:b.getForm().getForm().findField("idClassificazione").getValue(),autoInt:b.getCBClasInt().getValue(),autoReg:b.getCBClasReg().getValue()},creaWin({id:"EliminaRettaeClassificazione",dimensioneWindow:"Calcolatrice",titolo:"Elimina",permesso:b.cbaConfig.permesso,permessoDB:b.cbaConfig.permesso,projectName:"GeneraliOSP.portlet",config:f,altezzaWin:220,callbackEsci:function(){b.aggiornaStore()}})):controller_eliminaRecord(d.getStore(),{idClassificazione:f,autoInt:b.getCBClasInt().getValue(),
autoReg:b.getCBClasReg().getValue()},function(){b.aggiornaStore()}))},verificaCampiForm_callback:function(){return b.verificaCampiForm()},esci_callback:function(){var c=b.getForm().up("window");!b.cbaConfig.noPortlet&&b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()}}});inserisciBottoni(c.boxBottoni,g);b.cbaConfig.wizard&&c.boxBottoni.queryById("btnEsci").setVisible(!1);b.cbaConfig.modalitaAdtSemplificato?(b.getPnlImporti().hide(),
b.getContainerPaganti().hide(),b.getBtnSimula().hide(),b.getBtnCreaAnagrafica().hide(),b.getEditNote().setHeight(180)):(b.getPnlImporti().show(),b.getContainerPaganti().setHidden(!b.abilitaPaganti),b.getBtnSimula().show(),b.getBtnSimula().setDisabled(!1),b.getBtnCreaAnagrafica().setDisabled(!1));b.abilitaPaganti=!b.cbaConfig.modalitaAdtSemplificato&&(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato);b.cbaConfig.abilitaTariffaRettaPers||(b.getEdtQuotaSan().setDisabled(!0),b.getEdtQuotaSoc().setDisabled(!0));
if("L"!=c.permesso)c.getForm().on("dirtychange",function(d,g){controller_abilitaBottoni(c);f.setDisabled(g);b.getContainerPaganti().setDisabled(g);b.getBtnSimula().setDisabled(g);b.getBtnCreaAnagrafica().setDisabled(g);"G"==currRicovero.servizio.tipoServizio&&g&&0>=d.findField("idClassificazione").getValue()&&StdUtenti.getCodFoclAssDistr(currOspite.indResidenza,currRicovero.idServizio,b.cbaConfig.regione)});"L"!=b.cbaConfig.permesso&&permettiModificheDopoDimissione()||(containerSolaLettura(b.getForm()),
containerSolaLettura(b.getContainerPaganti()),controller_abilitaBottoni(c),b.getBtnSimula().setDisabled(!0),b.getBtnCreaAnagrafica().setDisabled(!0),b.getBoxBottoni().queryById("btnEsci").setDisabled(!1));0==b.cbaConfig.gridStorico.getStore().getCount()&&b.aggiornaStore();b.abilitaPaganti&&(b.gestGridPaganti=Ext.create("GeneraliOSP.portlet.view.EdtClassRetta_ResPaganti",{itemId:"EdtClassRetta_ResPaganti",reference:"EdtClassRetta_ResPaganti",cbaConfig:{permesso:b.cbaConfig.permesso,gridStorico:b.cbaConfig.gridStorico,
controllerTestata:b}}),b.getContainerPaganti().add(b.gestGridPaganti));b.showCBClassGestAuto(!1)},impostaDati:function(b){var c=this.getForm(),d=this.getContainerPaganti().down("grid");this.cbaConfig.tabClass.setDisabled(!1);this.getBtnSimula().setDisabled("L"==this.cbaConfig.permesso);this.getBtnCreaAnagrafica().setDisabled("L"==this.cbaConfig.permesso);this.cbaConfig.gridStorico.setDisabled(!1);this.tipoQuotaClassificazione=null;this.idProfiloOriginale=b?b.get("idProfilazione"):null;this.idPrestazioneOriginale=
b?b.get("codiceClassificazione"):null;clearForm(c);this.cbaConfig.modalitaAdtSemplificato||this.getContainerPaganti().setHidden(!b||!this.abilitaPaganti);b&&(this.filtraStorePrestazioni(b.get("idProfilazione")),this.tipoQuotaClassificazione=b.get("tipoQuota"),c.loadRecord(b),this.abilitaPaganti&&d.controller.aggiornaStore(),this.getBoxBottoni().queryById("btnElimina").setHidden(b.get("dataAl")));this.aggiornaColoreImporti()},filtraStorePrestazioni:function(b){var c=this.getCbPrestazione().getStore();
b||(b=0);c.clearFilter();c.filter([{filterFn:function(c){c=c.get("tipo");var d=[];c&&(d=c.split(",").map(function(b){return+b}));return d.includes(b)}}])},selectCbProfiloUtente:function(b,c,d){this.idProfiloOriginale!=b.value&&"T"==c.data.extra&&msgShowWarning("ATTENZIONE","MSG_ELEMENTO_DISATTIVATO");this.getCbPrestazione().clearValue();this.filtraStorePrestazioni(b.value)},selectCbPrestazione:function(b,c,d){this.idPrestazioneOriginale!=b.value&&"T"==c.data.extra&&msgShowWarning("ATTENZIONE","MSG_ELEMENTO_DISATTIVATO")},
aggiornaStore:function(b){var c=this;c.getContainerPaganti().hide();c.cbaConfig.caricaGrid(c.cbaConfig.gridStorico,b,function(){var b=c.getCbProfiloUtente().value;c.filtraStorePrestazioni(b)})},aggiornaColoreImporti:function(){0<=parseFloat(this.getEdtQuotaSoc().getValue())?(this.getEdtQuotaSoc().addCls("selezionato"),this.getEdtQuotaSocDefault().removeCls("selezionato")):(this.getEdtQuotaSocDefault().addCls("selezionato"),this.getEdtQuotaSoc().removeCls("selezionato"));0<=parseFloat(this.getEdtQuotaSan().getValue())?
(this.getEdtQuotaSan().addCls("selezionato"),this.getEdtQuotaSanDefault().removeCls("selezionato")):(this.getEdtQuotaSanDefault().addCls("selezionato"),this.getEdtQuotaSan().removeCls("selezionato"))},changeEdtQuotaSan:function(b,c,d,f){Ext.isEmpty(c)?this.getEdtQuotaSanFatt().setValue(this.getEdtQuotaSanDefault().getValue()):this.getEdtQuotaSanFatt().setValue(c);b=0;this.getEdtQuotaSanFatt().getValue()&&(b=parseFloat(this.getEdtQuotaSanFatt().getValue()));c=0;this.getEdtQuotaSocFatt().getValue()&&
(c=parseFloat(this.getEdtQuotaSocFatt().getValue()));this.getEdtQuotaTot().setValue(b+c);this.aggiornaColoreImporti()},changeEdtQuotaSoc:function(b,c,d,f){Ext.isEmpty(c)?this.getEdtQuotaSocFatt().setValue(this.getEdtQuotaSocDefault().getValue()):this.getEdtQuotaSocFatt().setValue(c);b=0;this.getEdtQuotaSanFatt().getValue()&&(b=parseFloat(this.getEdtQuotaSanFatt().getValue()));c=0;this.getEdtQuotaSocFatt().getValue()&&(c=parseFloat(this.getEdtQuotaSocFatt().getValue()));this.getEdtQuotaTot().setValue(b+
c);this.aggiornaColoreImporti()},clickBtnSimula:function(){var b=this.getForm().getForm();Ext.create("winCBA",{name:"GeneraliOSP.simulaRetta.view.Simula",titolo:"RETTE_SIMULA",dimensione:2,configItem:{idClassificazione:b.findField("idClassificazione").getValue(),dataIniClass:b.findField("dataDal").getValue(),dataFineClass:b.findField("dataAl").getValue(),desClassificazione:b.findField("codiceClassificazione").rawValue,quotaSanitariaClassificazione:b.findField("quotaSanitariaFatt").getValue(),quotaSocialeClassificazione:b.findField("quotaSocialeFatt").getValue(),
tipoQuotaClassificazione:this.tipoQuotaClassificazione}}).show()},BtnCreaAnagraficaclick:function(b,c,d){b=getPersonContabili(getIdOrg(),new Date,!0,null);4==b.tipoContabilitaAbilitata||5==b.tipoContabilitaAbilitata?c=(Ext.isEmpty(currOspite.indResidenza.indirizzo)?null:currOspite.indResidenza.indirizzo)+"#"+(Ext.isEmpty(currOspite.indResidenza.civico)?null:currOspite.indResidenza.civico)+"#"+(Ext.isEmpty(currOspite.indResidenza.esponente)?null:currOspite.indResidenza.esponente)+"#"+(Ext.isEmpty(currOspite.indResidenza.interno)?
null:currOspite.indResidenza.interno):(c=currOspite.indResidenza.indirizzo,currOspite.indResidenza.civico&&(c+=", "+currOspite.indResidenza.civico,currOspite.indResidenza.esponente&&(c+="/"+currOspite.indResidenza.esponente),currOspite.indResidenza.interno&&(c+=" Int. "+currOspite.indResidenza.interno)));checkInsertNewPagante(currOspite,c,b)},onLaunch:function(){var b=this.getCbProfiloUtente(),c=b.getStore(),d=this.getCbPrestazione().getStore();ImpostaUrl([c,d]);var f=StdUtenti.promiseLoadStore(c,
{tipoServizio:this.cbaConfig.tipoServizio,idServizio:this.cbaConfig.idServizio}),d=StdUtenti.promiseLoadStore(d,{type:1,idServizio:this.cbaConfig.idServizio});Promise.all([f,d]).then(function(d){1==c.getCount()&&b.hide()})["catch"](function(b){return msgShowError("",b)});this.gestioneForm()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtClassRetta_ResPaganti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grid",selector:this.selContainer+"#Grid"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"CbTipoQuota",selector:this.selContainer+"#CbTipoQuota"},{ref:"CbPagante",selector:this.selContainer+"#CbPagante"},{ref:"CBPagantiAtt",
selector:this.selContainer+"#CBPagantiAtt"}]);this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#CBPagantiAtt",{change:this.aggiornaStore});this.control(this.selContainer+"#Grid",{beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,validateedit:this.validateeditGrid})},verificaPagante:function(b,c){var d=[];null!==b.dataDal&&b.dataDal>b.dataAl&&
b.dataAl&&msgAddError(d,"MSG_DATADAL_MAGGIORE_DATAAL");Ext.isNumber(b.codfocl)||msgAddError(d,"MSG_SELZIONARE_PAGANTE");"Z"===b.tipoQuota?(b.pensione=!0,b.quotaSanitariaPresenza=null,b.quotaSanitariaAssenza=null,b.quotaSocialePresenza=null,b.quotaSocialeAssenza=null):(b.quotaSanitariaPresenza&&0>b.quotaSanitariaPresenza||b.quotaSanitariaAssenza&&0>b.quotaSanitariaAssenza||b.quotaSocialePresenza&&0>b.quotaSocialePresenza||b.quotaSocialeAssenza&&0>b.quotaSocialeAssenza)&&msgAddError(d,"MSG_QUOTE_NEGATIVE");
if("T"===b.tipoQuota){var f=[];Ext.each(this.getGrid().getStore().data.items,function(b){"T"===b.get("tipoQuota")&&f.push([b.get("id"),b.get("dataDal"),null!=b.get("dataAl")?b.get("dataAl"):new Date("01-01-2100")])});if(0!=f.length)for(var g=0,h=f.length;g<h;g++)if(!c||f[g][0]!=c)if(b.dataAl)if(b.dataAl>=f[g][1]&&b.dataAl<=f[g][2]){msgAddError(d,"MSG_QUOTATMAX_OVER");break}else{if(b.dataAl>=f[g][2]&&b.dataDal<=f[g][2]){msgAddError(d,"MSG_QUOTATMAX_OVER");break}}else if(!b.dataAl&&b.dataDal<=f[g][2]){msgAddError(d,
"MSG_QUOTATMAX_OVER");break}}return msgShow("",d)},abilitaBottoniPagante:function(b){this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b);this.getCBPagantiAtt().setDisabled(!b);this.cbaConfig.controllerTestata.getForm().setDisabled(!b);this.cbaConfig.controllerTestata.cbaConfig.tabClass.setDisabled(!b);this.cbaConfig.controllerTestata.getBoxBottoni().setDisabled(!b)},clickBtnNuovo:function(b){b=this.cbaConfig.controllerTestata.getForm().getForm();b={idClassificazione:b.findField("id").getValue(),
dataDal:b.findField("dataDal").getValue(),dataAl:null,pensione:"F",tipoQuota:"P",quotaSanitariaPresenza:100,quotaSocialePresenza:100,quotaSanitariaAssenza:100,quotaSocialeAssenza:100,ragioneSociale:null};this.abilitaBottoniPagante(!1);controller_nuovoRecordGrid(b,this.getGrid())},clickBtnElimina:function(b){var c=this;b=c.getGrid();var d=b.getSelectionModel().getSelection()[0];d&&(b.getStore().cbaConfig.idPagante=d.get("id"));controller_eliminaRecord(b.getStore(),{idPagante:d?d.get("id"):""},function(){c.getGrid().verificaEditAuto=
!1;c.getGrid().columns[0].getEditor().getStore().removeAll();c.aggiornaStore(d.get("id"))})},beforeeditGrid:function(b,c,d){var f=this;if(!0===f.getGrid().getPlugin().editing)return!1;"G"==currRicovero.servizio.tipoServizio&&f.getCbTipoQuota().getStore().filter("codice",/G|P/);f.getCbTipoQuota().cbaConfig.initChange||(f.getCbTipoQuota().addListener("change",function(b,c){var d=b.up().getForm(),g=d.findField("quotaSanitariaPresenza"),h=d.findField("quotaSocialePresenza"),k=d.findField("quotaSanitariaAssenza"),
r=d.findField("quotaSocialeAssenza"),t=d.findField("pensione");"P"===c?(g.setValue("100"),h.setValue("100"),k.setValue("100"),r.setValue("100")):"Z"===c&&(t.setValue(!0),g.setValue(""),h.setValue(""),k.setValue(""),r.setValue(""));f.abilitaCampoQuotaPagante(d,"quotaSanitariaPresenza",c);f.abilitaCampoQuotaPagante(d,"quotaSanitariaAssenza",c);f.abilitaCampoQuotaPagante(d,"quotaSocialePresenza",c);f.abilitaCampoQuotaPagante(d,"quotaSocialeAssenza",c)}),f.getCbTipoQuota().cbaConfig.initChange=!0);f.getCbPagante().cbaConfig.initChange||
(f.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null),f.getCbPagante().getStore().getProxy().setExtraParam("tipoContabilita",f.personContabili.tipoContabilitaAbilitata),f.getCbPagante().getStore().getProxy().setExtraParam("limit",f.getCbPagante().pageSize),f.getCbPagante().getStore().getProxy().setExtraParam("campoRicerca","RAGSOC"),f.getCbPagante().cbaConfig.initChange=!0);this.abilitaBottoniPagante(!1);b=b.getEditor().getForm();c.colIdx=0;var g=b.findField("codfocl");c.record.get("codfocl")&&
c.record.get("ragioneSociale")&&g.getStore().load({params:{valore:c.record.get("ragioneSociale")},callback:function(b,d,l){l&&(f.filtraComboPaganti(g.getStore()),c.record.get("codfocl")&&g.setValue(c.record.get("codfocl")))}});f.abilitaCampoQuotaPagante(b,"quotaSanitariaPresenza",c.record.get("tipoQuota"));f.abilitaCampoQuotaPagante(b,"quotaSanitariaAssenza",c.record.get("tipoQuota"));f.abilitaCampoQuotaPagante(b,"quotaSocialePresenza",c.record.get("tipoQuota"));f.abilitaCampoQuotaPagante(b,"quotaSocialeAssenza",
c.record.get("tipoQuota"));f.cbaConfig.filtra=!1},editGrid:function(b,c,d){d=c.record.data;Ext.apply(d,{idClassificazione:this.cbaConfig.controllerTestata.getForm().getForm().findField("id").getValue(),pensione:d.pensione?"T":"F"});delete d.ragioneSociale;var f=b.getEditor().getForm();f.controller=this;f.store=c.view.getStore();this.cbaConfig.filtra=!1;controller_salvaRecord(f,d,!1,{tipoServizio:currRicovero.servizio.tipoServizio})?(this.cbaConfig.filtra=!0,this.abilitaBottoniPagante(!0)):(this.abilitaBottoniPagante(!0),
b.startEdit(c.record,0))},canceleditGrid:function(b,c,d){this.getGrid().verificaEditAuto=!1;this.abilitaBottoniPagante(!0);this.aggiornaStore(c.record.get("id"));this.cbaConfig.filtra=!0},validateeditGrid:function(b,c,d){return this.verificaPagante(c.newValues,c.record.get("id"))},aggiornaStore:function(b){var c=this,d=c.getGrid(),f=d.getStore();f.load({params:{idClassificazione:c.cbaConfig.controllerTestata.getForm().getForm().findField("id").getValue()},callback:function(g,h,k){k?(Ext.isEmpty(g)?
d.verificaEditAuto&&c.permettiModificheDopoDimissione&&c.getBtnNuovo().fireEvent("click"):(c.filtraPagantiAttivi(),g=b?trovaRecord(f,"id",b):null,d.getSelectionModel().deselectAll(),d.getSelectionModel().select(g?[g]:0)),d.verificaEditAuto=!0):msgShowError("",h.getError())}})},filtraPagantiAttivi:function(){var b=this,c=b.getGrid().getStore();b.getCBPagantiAtt().checked?c.filter({filterFn:function(c){var d=!1,g=new Date;if(b.cbaConfig.filtra){if(g>=c.data.dataDal&&(g<=c.data.dataAl||!c.data.dataAl)||
g<=c.data.dataDal&&(g>=c.data.dataAl||!c.data.dataAl))d=!0;return d}return!0}}):c.clearFilter()},filtraComboPaganti:function(b){var c=this;b.clearFilter();b.filter({filterFn:function(b){return"4"!=c.personContabili.tipoContabilitaAbilitata&&"5"!=c.personContabili.tipoContabilitaAbilitata||""==b.data.extra.split(",")?!0:"T"==b.data.extra.split(",")[1]?!0:!1}})},abilitaCampoQuotaPagante:function(b,c,d){b=b.findField(c);b.allowBlank="Z"===d;b.setDisabled("Z"===d);b.validateValue(b.getValue())},onLaunch:function(){var b=
this.getGrid(),c=this.cbaConfig.controllerTestata;this.permettiModificheDopoDimissione=permettiModificheDopoDimissione();c.modalitaAdtSemplificato?b.setVisible(!1):(b.controller=this,this.cbaConfig.filtra=!0,b.verificaEditAuto=!0,ImpostaUrl([b.getStore()]));this.permettiModificheDopoDimissione||(containerSolaLettura(this.getGrid()),this.getBtnNuovo().setDisabled(!0),this.getBtnElimina().setDisabled(!0))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtClassificazioni",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"TabClass",selector:c+"#TabClass"},{ref:"PnlMain",selector:c+"#PnlMain"},{ref:"PnlIntReg",selector:c+"#PnlIntReg"},{ref:"PnlRegionale",selector:c+"#PnlRegionale"},{ref:"PnlInterna",selector:c+"#PnlInterna"},{ref:"Container",selector:c+"#Container"},{ref:"StoricoGridRetta",selector:c+"#StoricoGridRetta"},
{ref:"ColDataCDI",selector:c+"#ColDataCDI"},{ref:"ColDataRetta",selector:c+"#ColDataRetta"},{ref:"ColDesClass",selector:c+"#ColDesClass"},{ref:"StoricoGridRegionale",selector:c+"#StoricoGridRegionale"},{ref:"StoricoGridInterna",selector:c+"#StoricoGridInterna"}]);b.control(c+"#StoricoGridRetta",{select:b.selectStoricoGridRetta});b.control(c+"#Container",{expand:b.expandPanelRetta});b.control(c+"#StoricoGridRegionale",{select:b.selectStoricoGridRegionale});b.control(c+"#PnlRegionale",{expand:b.expandPanelRegionale});
b.control(c+"#StoricoGridInterna",{select:b.selectStoricoGridInterna});b.control(c+"#PnlInterna",{expand:b.expandPanelInterna});b.on({esci:function(){return b.esciWizard()}});b.on({changeTab:function(){return b.changeTab()}});b.control(c+"#PnlMain",{afterrender:b.afterRenderPanels});b.control(c+"#PnlRegionale",{afterrender:b.afterRenderPanels});b.control(c+"#PnlInterna",{afterrender:b.afterRenderPanels})},afterTabChange:function(){0==this.getStoricoGridRetta().getStore().getTotalCount()&&this.getPnlMain().down("datefield").focus(!1,
200)},afterRenderPanels:function(){var b=this;if("L"!=b.config.permesso){var c;if(b.getPnlMain().isVisible())c=b.getPnlMain().down("form");else if(b.getPnlRegionale().isVisible()||b.PnlInterna().isVisible())c=b.getPnlIntReg().down("form");if(c)c.on("dirtychange",function(c,f){b.cbaConfig.controllerEditFascicolo&&(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(f),b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(f))})}},esciWizard:function(){var b;this.getPnlMain().isVisible()?
b=this.getPnlMain().down("form"):this.getPnlIntReg().isVisible()&&(b=this.getPnlIntReg().down("form"));var c=b.up("window");b.getForm().isDirty()?controller_puoiUscire(c,b,function(){b.boxBottoni.queryById("btnConferma").handler()},function(){b.boxBottoni.queryById("btnEsci").handler()},function(){b.controller.aggiornaStore()}):b.boxBottoni.queryById("btnEsci").handler()},changeTab:function(){var b;this.getPnlMain().isVisible()?b=this.getPnlMain().down("form"):this.getPnlIntReg().isVisible()&&(b=
this.getPnlIntReg().down("form"));var c=b.up("window");b.getForm().isDirty()?controller_puoiUscire(c,b,function(){b.boxBottoni.queryById("btnConferma").handler()},function(){b.boxBottoni.queryById("btnAnnulla").handler()},function(){b.controller.aggiornaStore()}):b.boxBottoni.queryById("btnEsci").handler()},verificaCampiForm:function(){var b;this.getPnlMain().isVisible()?b=this.getPnlMain().down("form"):this.getPnlIntReg().isVisible()&&(b=this.getPnlIntReg().down("form"));return b.controller.verificaCampiForm()},
isDirtyForm:function(){var b;this.getPnlMain().isVisible()?b=this.getPnlMain().down("form"):this.getPnlIntReg().isVisible()&&(b=this.getPnlIntReg().down("form"));return b.getForm().isDirty()},selectStoricoGridRetta:function(b,c,d){this.edtClassMain.controller.impostaDati(c)},expandPanelRetta:function(b){this.getPnlIntReg().hide();this.getPnlMain().show()},selectStoricoGridRegionale:function(b,c,d,f){this.edtClassIntReg.controller.impostaDati(c)},expandPanelRegionale:function(b,c){this.getPnlIntReg().show();
this.getPnlMain().hide();this.edtClassIntReg.controller.inizializzaForm(5,this.getStoricoGridRegionale());this.caricaGrid(this.getStoricoGridRegionale())},selectStoricoGridInterna:function(b,c,d,f){this.edtClassIntReg.controller.impostaDati(c)},expandPanelInterna:function(b,c){this.getPnlIntReg().show();this.getPnlMain().hide();this.edtClassIntReg.controller.inizializzaForm(3,this.getStoricoGridInterna());this.caricaGrid(this.getStoricoGridInterna())},gestClassIntReg:function(){var b=this,c=b.getTabClass().down("#StoricoGridRegionale");
b.edtClassIntReg=Ext.create("GeneraliOSP.portlet.view.EdtClassIntReg",{itemId:"EdtClass",reference:"EdtClass",cbaConfig:{permesso:permettiModificheDopoDimissione()?b.cbaConfig.permesso:"L",gridStorico:c,tabClass:b.getTabClass(),classType:5,idServizio:b.servizio,idRicovero:b.ricovero,codOspite:b.cbaConfig.controllerEditFascicolo?b.cbaConfig.controllerEditFascicolo.currRicovero.codOspite:b.cbaConfig.currRicovero.codOspite,caricaGrid:function(c,f,g){b.caricaGrid(c,f,g)},noPortlet:b.cbaConfig.noPortlet,
controllerPortlet:b.cbaConfig.controllerPortlet,wizard:b.cbaConfig.wizard,tipoServizio:b.cbaConfig.currRicovero.isModel?b.cbaConfig.currRicovero.get("servizio").tipoServizio:b.cbaConfig.currRicovero.servizio.tipoServizio,regione:b.cbaConfig.currRicovero.isModel?b.cbaConfig.currRicovero.get("servizio").regione:b.cbaConfig.currRicovero.servizio.regione}});b.getPnlIntReg().add(b.edtClassIntReg)},gestClassMain:function(b){var c=this,d=c.getTabClass().down("#StoricoGridRetta"),d={permesso:permettiModificheDopoDimissione()?
c.cbaConfig.permesso:"L",gridStorico:d,tabClass:c.getTabClass(),idServizio:c.servizio,idRicovero:c.ricovero,caricaGrid:function(b,d,h){c.caricaGrid(b,d,h)},noPortlet:c.cbaConfig.noPortlet,controllerPortlet:c.cbaConfig.controllerPortlet,wizard:c.cbaConfig.wizard,tipoServizio:c.cbaConfig.currRicovero.isModel?c.cbaConfig.currRicovero.get("servizio").tipoServizio:c.cbaConfig.currRicovero.servizio.tipoServizio,regione:c.cbaConfig.currRicovero.isModel?c.cbaConfig.currRicovero.get("servizio").regione:c.cbaConfig.currRicovero.servizio.regione,
selezionaRecord:c.cbaConfig.selezionaRecord,abilitaTariffaRettaPers:c.recImpServizio?"T"==c.recImpServizio.abilitaTariffaRettaPers?!0:!1:!0,modalitaAdtSemplificato:c.recImpServizio?1==c.recImpServizio.modalitaIntZucchetti?!0:!1:!1};c.edtClassMain="AMB"==b?Ext.create("GeneraliOSP.portlet.view.EdtClassRetta_Amb",{itemId:"EdtClassRetta_Amb",reference:"EdtClassRetta_Amb",cbaConfig:d}):"CDI"==b?Ext.create("GeneraliOSP.portlet.view.EdtClassRetta_Cdi",{itemId:"EdtClassRetta_Cdi",reference:"EdtClassRetta_Cdi",
cbaConfig:d}):Ext.create("GeneraliOSP.portlet.view.EdtClassRetta_Res",{itemId:"EdtClassRetta_Res",reference:"EdtClassRetta_Res",cbaConfig:d});c.getPnlMain().add(c.edtClassMain)},caricaGrid:function(b,c,d){var f=this,g=b.getStore();g.load({params:{idRicovero:f.ricovero},callback:function(h,k,l){l?(k="StoricoGridRetta"==b.itemId?f.getPnlMain().down("form"):f.getPnlIntReg().down("form"),Ext.isEmpty(h)?clearForm(k):(c||(c=k.getForm().findField("id").getValue()),l=trovaRecord(g,"id",c),b.getSelectionModel().deselectAll(),
b.getSelectionModel().select(l?[l]:0)),containerSolaLettura(k,Ext.isEmpty(h)),f.cbaConfig.wizard&&f.cbaConfig.controllerEditFascicolo&&f.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento(),d&&d()):msgShowError("",k.getError())}})},onLaunch:function(){var b=this;b.getContainer().controller=b;b.recImpServizio=null;CBA.StdUtenti.getImpostazioniServizio(CBA.moduli.moduloAttivo,b.cbaConfig.currRicovero.idServizio).then(function(c){b.recImpServizio=c})["catch"](function(b){return msgShowError("",
b)});var c=b.cbaConfig,d=b.cbaConfig.currRicovero.isModel;b.ricovero=d?b.cbaConfig.currRicovero.get("idRicovero"):b.cbaConfig.currRicovero.idRicovero;b.servizio=d?b.cbaConfig.currRicovero.get("idServizio"):b.cbaConfig.currRicovero.idServizio;c.hideClassReg?b.getPnlRegionale().hide():(b.getStoricoGridRegionale().bindStore(Ext.create("GeneraliOSP.portlet.store.ClassRegionale")),ImpostaUrl([b.getStoricoGridRegionale().getStore()]));c.hideClassInt?b.getPnlInterna().hide():(b.getStoricoGridInterna().bindStore(Ext.create("GeneraliOSP.portlet.store.ClassInterna")),
ImpostaUrl([b.getStoricoGridInterna().getStore()]));c.hideClassReg&&c.hideClassInt||b.gestClassIntReg();"CDI"==c.tipoClRetta?(b.getColDataRetta().hide(),b.getColDesClass().hide(),b.getStoricoGridRetta().bindStore(Ext.create("GeneraliOSP.portlet.store.ClRettaCdiTe"))):"AMB"==c.tipoClRetta?(b.getColDataRetta().hide(),b.getColDesClass().hide(),b.getStoricoGridRetta().bindStore(Ext.create("GeneraliOSP.portlet.store.ClRettaAmbTe"))):(b.getColDataCDI().hide(),b.getStoricoGridRetta().bindStore(Ext.create("GeneraliOSP.portlet.store.ClassRetta")));
ImpostaUrl([b.getStoricoGridRetta().getStore()]);var f=b.getStoricoGridRetta();f.getStore().load({params:{idRicovero:b.ricovero},callback:function(d,h,k){k||msgShowError("",h.getError());b.gestClassMain(c.tipoClRetta);Ext.isEmpty(d)?b.loadComboClass:f.getSelectionModel().select(0)}})},setStyleErroreClass:function(b,c,d){0>=d.get("codiceClassificazione")&&(c.tdCls="labelErrore");return b},destroy:function(){this.cbaConfig.controllerFascicolo&&Ext.each(this.cbaConfig.controllerFascicolo.getContainer().query("portlet"),
function(b){"Portlet_Regionale"==b.items.items[0].itemId&&b.items.items[0].controller.updatePortlet()});this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtScontiSupp",{extend:"Generali.standard.ViewController",init:function(){var b=this;b.txtPeriodoConguaglio=traduci("PERIODO_CONGUAGLIO");var c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"EditScontiSupp",selector:c+"#EditScontiSupp"},{ref:"Container",selector:c+"#Container"},{ref:"StoricoGridScontiSupp",selector:c+"#StoricoGridScontiSupp"},{ref:"EditScontiSuppDett",selector:c+"#EditScontiSuppDett"},{ref:"BoxBottoni",selector:c+"#BoxBottoni"},
{ref:"EditScontiSuppForm",selector:c+"#EditScontiSuppForm"},{ref:"EditScontiSuppTipo",selector:c+"#EditScontiSuppTipo"},{ref:"EditScontiSuppDataDal",selector:c+"#EditScontiSuppDataDal"},{ref:"EditScontiSuppDataAl",selector:c+"#EditScontiSuppDataAl"},{ref:"EditScontiSuppRisposta",selector:c+"#EditScontiSuppRisposta"},{ref:"EditScontiSuppDesc",selector:c+"#EditScontiSuppDesc"},{ref:"EditScontiSuppFattore",selector:c+"#EditScontiSuppFattore"},{ref:"EditScontiSuppTipoImporto",selector:c+"#EditScontiSuppTipoImporto"},
{ref:"EditScontiSuppNumGG",selector:c+"#EditScontiSuppNumGG"},{ref:"GiorniPianificazione",selector:c+"#GiorniPianificazione"},{ref:"PnlImportiScontiSupp",selector:c+"#PnlImportiScontiSupp"},{ref:"EditScontiSuppQuotaSanDefault",selector:c+"#EditScontiSuppQuotaSanDefault"},{ref:"EditScontiSuppQuotaSocDefault",selector:c+"#EditScontiSuppQuotaSocDefault"},{ref:"EditScontiSuppQuotaSan",selector:c+"#EditScontiSuppQuotaSan"},{ref:"EditScontiSuppQuotaSoc",selector:c+"#EditScontiSuppQuotaSoc"},{ref:"EditScontiSuppQuotaSanFatt",
selector:c+"#EditScontiSuppQuotaSanFatt"},{ref:"EditScontiSuppQuotaSocFatt",selector:c+"#EditScontiSuppQuotaSocFatt"},{ref:"EditScontiSuppQuotaTot",selector:c+"#EditScontiSuppQuotaTot"},{ref:"EditScontiSuppRecordId",selector:c+"#EditScontiSuppRecordId"},{ref:"ContainerDettaglio",selector:c+"#ContainerDettaglio"},{ref:"LblCompConguaglio",selector:c+"#LblCompConguaglio"},{ref:"GGPianificazione",selector:c+"#GGPianificazione"},{ref:"BtnElaboraFattura",selector:c+"#BtnElaboraFattura"},{ref:"EditScontiSuppNote",
selector:c+"#EditScontiSuppNote"}]);b.control(c+"#BtnElaboraFattura",{click:b.BtnElaboraFatturaclick});b.control(c+"#StoricoGridScontiSupp",{select:b.selectStoricoGridEditScontiSupp});b.control(c+"#EditScontiSuppTipo",{change:b.onEditScontiSuppTipoChange,select:b.onEditScontiSuppTipoSelect});b.control(c+"#EditScontiSuppDataDal",{blur:b.onEditScontiSuppDataDalBlur});b.control(c+"#EditScontiSuppDataAl",{blur:b.onEditScontiSuppDataAlBlur});b.control(c+"#EditScontiSuppRisposta",{select:b.onEditScontiSuppRispostaSelect});
b.control(c+"#EditScontiSuppFattore",{change:b.onEditScontiSuppFattoreChange,select:b.onEditScontiSuppFattoreSelect});b.control(c+"#EditScontiSuppTipoImporto",{change:b.onEditScontiSuppTipoImportoChange,beforequery:b.beforequeryEditScontiSuppTipoImporto});b.control(c+"#EditScontiSuppQuotaSan",{change:b.onEditQuotaSanChange});b.control(c+"#EditScontiSuppQuotaSoc",{change:b.onEditQuotaSocChange});b.control(c+"#EditScontiSuppQuotaTot",{afterrender:b.onEditScontiSuppQuotaTotAfterRender});b.on({esci:function(){b.getEditScontiSuppForm().boxBottoni.queryById("btnEsci").handler()}});
b.on({changeTab:function(){return b.changeTab()}})},beforequeryEditScontiSuppTipoImporto:function(b){"S"===this.getEditScontiSuppTipo().getValue()&&(b.cancel=!0)},BtnElaboraFatturaclick:function(b,c,d){var f=this;b=f.getEditScontiSuppDataDal().getValue();var g=getPersonContabili(getIdOrg(),b,!0,null),h=f.getStoricoGridScontiSupp().getSelectionModel().getSelection()[0],k=f.getContainerDettaglio().down("grid").getSelectionModel().getSelection()[0];b="";0<k.get("numFattContabilizzate")&&(b=traduci("MSG_ELABORA_EXTRA_CONTABILIZZATO")+
". ");b+=traduci("MSG_ELABORA_FATTURE_PAGANTE_SELEZIONATO")+" <b>"+k.get("ragioneSociale")+"</b>?";Messaggio("ATTENZIONE",b,"YESNO","QUESTION",!1,function(){Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/rette/extra/elab",params:{tipoContabilita:g.tipoContabilitaAbilitata,idEsercizio:g.idEsercizio,dataDocumento:new Date,idExtraRetta:h.get("id"),idPagante:k.get("codfocl"),idRicovero:f.ricovero},timeout:18E5,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(f.getBtnElaboraFattura().setDisabled(!0),
msgShowText("",b.message),f.stampa(b.data,[k.get("codfocl")])):msgShowError("",b.message)}})})},stampa:function(b,c){showWinStampa(43,CBA.parametriGenerali.codEnte,"CUStampaFatture",{configBtnStampa:Ext.apply(this.parametriStampa,{params:{format:"pdf",statoDaContabilizzare:"F",statoContabilizzato:"F",elencoPaganti:"("+c.toString()+")"}}),idFatture:b,eseguiStampa:!0,isAmbulatoriale:!0})},ckChangeGiorno:function(){this.getGGPianificazione().getStore().data.items[0].dirty?(this.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),
this.getBoxBottoni().queryById("btnElimina").setDisabled(!0),this.getBoxBottoni().queryById("btnAnnulla").setDisabled(!1),this.getBoxBottoni().queryById("btnConferma").setDisabled(!1),this.getBoxBottoni().queryById("btnEsci").setDisabled(!0)):(this.getBoxBottoni().queryById("btnNuovo").setDisabled(!1),this.getBoxBottoni().queryById("btnElimina").setDisabled(!1),this.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),this.getBoxBottoni().queryById("btnConferma").setDisabled(!0),this.getBoxBottoni().queryById("btnEsci").setDisabled(!1))},
onEditScontiSuppQuotaTotAfterRender:function(b,c){if(this.cbaConfig.gestioneCauzione){this.getContainer().hide();this.getBoxBottoni().queryById("btnNuovo").setVisible(!1);this.getBoxBottoni().queryById("btnElimina").setVisible(!1);var d=this.getEditScontiSuppForm().getForm();d.setValues({tipo:this.cbaConfig.tipoScontoSupp,dataDal:this.cbaConfig.data,dataAl:this.cbaConfig.data,fattoreMoltiplicazione:"A",giorniMoltiplicazione:1,tipoImporto:"I"});d.findField("quotaSociale").setValue(this.cbaConfig.importo);
d.findField("quotaSanitaria").setReadOnly(!0);d.findField("tipo").setReadOnly(!0);d.findField("fattoreMoltiplicazione").setReadOnly(!0);d.findField("giorniMoltiplicazione").setReadOnly(!0);d.findField("tipoImporto").setReadOnly(!0);d.isValid();d.findField("idRisposta").focus(!1,1E3)}},changeTab:function(){var b=this,c=b.getEditScontiSuppForm().up("window");controller_puoiUscire(c,b.getEditScontiSuppForm(),function(){b.salva(!1,!1)},function(){b.aggiornaStore()},function(){b.aggiornaStore()})},onEditQuotaSocChange:function(b,
c,d,f){Ext.isEmpty(c)?this.getEditScontiSuppQuotaSocFatt().setValue(this.getEditScontiSuppQuotaSocDefault().getValue()):this.getEditScontiSuppQuotaSocFatt().setValue(c);b=0;this.getEditScontiSuppQuotaSanFatt().getValue()&&(b=parseFloat(this.getEditScontiSuppQuotaSanFatt().getValue()));c=0;this.getEditScontiSuppQuotaSocFatt().getValue()&&(c=parseFloat(this.getEditScontiSuppQuotaSocFatt().getValue()));this.getEditScontiSuppQuotaTot().setValue(b+c);this.aggiornaColoreImporti()},onEditQuotaSanChange:function(b,
c,d,f){Ext.isEmpty(c)?this.getEditScontiSuppQuotaSanFatt().setValue(this.getEditScontiSuppQuotaSanDefault().getValue()):this.getEditScontiSuppQuotaSanFatt().setValue(c);b=0;this.getEditScontiSuppQuotaSanFatt().getValue()&&(b=parseFloat(this.getEditScontiSuppQuotaSanFatt().getValue()));c=0;this.getEditScontiSuppQuotaSocFatt().getValue()&&(c=parseFloat(this.getEditScontiSuppQuotaSocFatt().getValue()));this.getEditScontiSuppQuotaTot().setValue(b+c);this.aggiornaColoreImporti()},onEditScontiSuppTipoImportoChange:function(b,
c,d,f){this.aggiornaFattore();this.aggiornaQuote()},onEditScontiSuppFattoreSelect:function(b,c,d){"A"!=b.value||this.getEditScontiSuppNumGG().getValue()||this.getEditScontiSuppNumGG().setValue(1)},onEditScontiSuppFattoreChange:function(b,c,d,f){"R"==c?(this.getGiorniPianificazione().show(),"L"!=this.cbaConfig.permesso&&("C"==this.getEditScontiSuppTipo().getValue()&&"S"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti||"S"==this.getEditScontiSuppTipo().getValue()&&"S"!=CBA.moduli["modulo"+
CBA.moduli.moduloAttivo].permessi.GestioneSupplementi)&&containerSolaLettura(this.getGGPianificazione()),this.getEditScontiSuppNumGG().hide(),this.getEditScontiSuppNumGG().allowBlank=!0):("A"==c?(this.getEditScontiSuppNumGG().show(),this.getEditScontiSuppNumGG().allowBlank=!1):(this.getEditScontiSuppNumGG().hide(),this.getEditScontiSuppNumGG().allowBlank=!0),this.getGiorniPianificazione().hide());this.getEditScontiSuppNumGG().validate()},onEditScontiSuppRispostaSelect:function(b,c,d){this.aggiornaQuoteDaPerson()},
onEditScontiSuppDataAlBlur:function(b,c){this.aggiornaQuoteDaPerson()},onEditScontiSuppDataDalBlur:function(b,c){},aggiornaQuoteDaPerson:function(){var b=this;(isValidDate(b.getEditScontiSuppDataAl())||!b.getEditScontiSuppDataAl().getValue())&&b.getEditScontiSuppRisposta().getValue()&&b.getEditScontiSuppForm().isDirty()&&Ext.Ajax.request({url:"/cba/osp/co/ws/prszn/dettrisp/last",method:"GET",params:{data:b.getEditScontiSuppDataAl().getValue()?b.getEditScontiSuppDataAl().getValue():new Date,idRisposta:b.getEditScontiSuppRisposta().getValue()},
success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){c.data?(b.getEditScontiSuppQuotaSocDefault().setValue(c.data.quotaSociale),b.getEditScontiSuppQuotaSanDefault().setValue(c.data.quotaSanitaria)):(b.getEditScontiSuppQuotaSocDefault().setValue(""),b.getEditScontiSuppQuotaSanDefault().setValue(""));c=b.getEditScontiSuppQuotaSoc();var d=b.getEditScontiSuppQuotaSan();c.fireEvent("change",c,c.getValue());d.fireEvent("change",d,d.getValue())}else msgShowError("",c.message)}})},onEditScontiSuppTipoSelect:function(b,
c,d){this.getEditScontiSuppQuotaSocDefault().setValue("");this.getEditScontiSuppQuotaSanDefault().setValue("");this.getEditScontiSuppQuotaSoc().setValue("");this.getEditScontiSuppQuotaSan().setValue("");this.getEditScontiSuppQuotaSoc().fireEvent("change");this.getEditScontiSuppQuotaSan().fireEvent("change")},onEditScontiSuppTipoChange:function(b,c,d,f){c&&(SvuotaCombo(this.getEditScontiSuppRisposta()),this.getEditScontiSuppRisposta().getStore().getProxy().extraParams={idServizio:this.servizio,tipo:c},
this.getEditScontiSuppRisposta().getStore().load(),"C"==c?abilitaCmp(this.getEditScontiSuppTipoImporto(),!0):(abilitaCmp(this.getEditScontiSuppTipoImporto(),!1),this.getEditScontiSuppTipoImporto().setValue("I")),this.aggiornaFattore(),this.aggiornaQuote());b.removeCls("icon-piuleft");b.removeCls("icon-menoleft");"S"==c?b.addCls("icon-piuleft"):b.addCls("icon-menoleft")},aggiornaFattore:function(){"C"==this.getEditScontiSuppTipo().getValue()&&"P"==this.getEditScontiSuppTipoImporto().getValue()?(this.getEditScontiSuppFattore().setValue("A"),
this.getEditScontiSuppNumGG().setValue(1),abilitaCmp(this.getEditScontiSuppFattore(),!1),abilitaCmp(this.getEditScontiSuppNumGG(),!1)):("C"==this.getEditScontiSuppTipo().getValue()&&this.modalitaAdtSemplificato?(abilitaCmp(this.getEditScontiSuppFattore(),!1),this.getEditScontiSuppFattore().setValue("A"),abilitaCmp(this.getEditScontiSuppTipoImporto(),!1),this.getEditScontiSuppTipoImporto().setValue("I")):abilitaCmp(this.getEditScontiSuppFattore(),!0),abilitaCmp(this.getEditScontiSuppNumGG(),!0))},
aggiornaQuote:function(){"C"==this.getEditScontiSuppTipo().getValue()&&"P"==this.getEditScontiSuppTipoImporto().getValue()&&(this.getEditScontiSuppQuotaSocDefault().setValue(""),this.getEditScontiSuppQuotaSanDefault().setValue(""),this.getEditScontiSuppQuotaSoc().getValue()||this.getEditScontiSuppQuotaSoc().setValue("0"),this.getEditScontiSuppQuotaSan().getValue()||this.getEditScontiSuppQuotaSan().setValue("0"))},selectStoricoGridEditScontiSupp:function(b,c,d,f,g,h){this.impostaDati(c);this.permettiModificheDopoDimissione||
(containerSolaLettura(this.getEditScontiSuppForm()),containerSolaLettura(this.getContainerDettaglio()),this.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),this.getBoxBottoni().queryById("btnElimina").setDisabled(!0),this.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),this.getBoxBottoni().queryById("btnConferma").setDisabled(!0),this.getBoxBottoni().queryById("btnEsci").setDisabled(!1));"L"!=this.cbaConfig.permesso&&("C"==c.data.tipo&&"L"==CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti||
"S"==c.data.tipo&&"L"==CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi?(containerSolaLettura(this.getEditScontiSuppForm()),containerSolaLettura(this.getContainerDettaglio()),this.getBoxBottoni().queryById("btnElimina").setDisabled(!0),this.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),this.getBoxBottoni().queryById("btnConferma").setDisabled(!0)):(containerSolaLettura(this.getEditScontiSuppForm(),!1),containerSolaLettura(this.getContainerDettaglio(),!1),this.getBoxBottoni().queryById("btnElimina").setDisabled(!1),
this.getEditScontiSuppTipo().setReadOnly(!0)),"S"==c.data.tipo?(abilitaCmp(this.getEditScontiSuppTipoImporto(),!1),this.getEditScontiSuppTipoImporto().setValue("I")):"C"==c.data.tipo&&this.modalitaAdtSemplificato&&(abilitaCmp(this.getEditScontiSuppFattore(),!1),this.getEditScontiSuppFattore().setValue("A"),abilitaCmp(this.getEditScontiSuppTipoImporto(),!1),this.getEditScontiSuppTipoImporto().setValue("I")))},impostaDati:function(b){var c;c=this.getContainerDettaglio().down("grid").controller;var d=
this.getEditScontiSuppForm();this.getStoricoGridScontiSupp().setDisabled(!1);clearForm(d);var f=this.getContainerDettaglio();f.down("grid").verificaEditAuto=!0;b?(d.loadRecord(b),this.modalitaAdtSemplificato||(f.show(),c.aggiornaStore()),c=b.data.giorniPianificazione?{lun:"T"==b.data.giorniPianificazione[0],mar:"T"==b.data.giorniPianificazione[1],mer:"T"==b.data.giorniPianificazione[2],gio:"T"==b.data.giorniPianificazione[3],ven:"T"==b.data.giorniPianificazione[4],sab:"T"==b.data.giorniPianificazione[5],
dom:"T"==b.data.giorniPianificazione[6]}:{lun:!1,mar:!1,mer:!1,gio:!1,ven:!1,sab:!1,dom:!1},d.getForm().setValues({id:b.data.idExtraRetta}),"C"==b.data.generatoDa?(this.getLblCompConguaglio().setText(this.txtPeriodoConguaglio+": "+FormattaData(b.data.conguaglioDa)+" - "+FormattaData(b.data.conguaglioA)),this.getLblCompConguaglio().setVisible(!0)):this.getLblCompConguaglio().hide()):(svuotaStore(this.getEditScontiSuppRisposta().getStore()),svuotaStore(f.down("#EditScontiSuppPaganti").getStore()),this.getLblCompConguaglio().hide(),
f.hide(),c={lun:!1,mar:!1,mer:!1,gio:!1,ven:!1,sab:!1,dom:!1});this.aggiornaColoreImporti();this.getEditScontiSuppNumGG().validate();b=[];b.push(c);Ext.suspendLayouts();this.getGGPianificazione().getStore().loadData(b);Ext.resumeLayouts()},aggiornaColoreImporti:function(){var b=this.getEditScontiSuppQuotaSan(),c=this.getEditScontiSuppQuotaSanDefault();0<=parseFloat(b.getValue())?(b.addCls("selezionato"),c.removeCls("selezionato")):(c.addCls("selezionato"),b.removeCls("selezionato"));b=this.getEditScontiSuppQuotaSoc();
c=this.getEditScontiSuppQuotaSocDefault();0<=parseFloat(b.getValue())?(b.addCls("selezionato"),c.removeCls("selezionato")):(c.addCls("selezionato"),b.removeCls("selezionato"))},aggiornaStore:function(b){var c=this,d=c.getEditScontiSuppForm(),f=d.getForm(),g=d.store;c.getEditScontiSuppTipo().getStore().clearFilter();g.clearFilter();g.load({params:{idRicovero:c.ricovero},callback:function(h,k,l){l?(Ext.isEmpty(h)?(clearForm(d),c.impostaDati(),containerSolaLettura(c.getEditScontiSuppForm()),c.getBoxBottoni().queryById("btnElimina").setDisabled(!0)):
(g.filterBy(function(b){return"C"==b.data.tipo&&"N"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti||"S"==b.data.tipo&&"N"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi?!0:!1}),b||(b=f.findField("id").getValue()),h=trovaRecord(g,"id",b),c.cbaConfig.selezionaRecord&&(k=trovaRecord(g,"idRisposta",c.cbaConfig.selezionaRecord.idRisposta))&&(h=k),k=c.getStoricoGridScontiSupp(),k.getSelectionModel().deselectAll(),k.getSelectionModel().select(h?[h]:0)),
c.cbaConfig.wizard&&c.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento()):msgShowError("",k.getError())}});c.permettiModificheDopoDimissione||(containerSolaLettura(c.getEditScontiSuppForm()),c.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),c.getBoxBottoni().queryById("btnElimina").setDisabled(!0),c.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),c.getBoxBottoni().queryById("btnConferma").setDisabled(!0),c.getBoxBottoni().queryById("btnEsci").setDisabled(!1))},verificaCampiForm:function(b){var c=
this,d=[],f=this.getEditScontiSuppForm().getForm();f.isValid()||msgAddError(d,"MSG_CAMPI_OBBLIGATORI");f.findField("dataDal").getValue()>f.findField("dataAl").getValue()&&f.findField("dataAl").getValue()&&msgAddError(d,"MSG_DATADAL_MAGGIORE_DATAAL");var g=f.findField("quotaSanitaria").getValue(),h=f.findField("quotaSociale").getValue();(g&&0>g||h&&0>h)&&msgAddError(d,"MSG_QUOTE_NEGATIVE");var g=c.getEditScontiSuppDataDal().getValue(),h=c.getEditScontiSuppDataAl().getValue(),k=Ext.isDefined(c.cbaConfig.currRicovero.data);
(g&&g<Ext.Date.clearTime(k?f.findField("dataDal").getValue():c.cbaConfig.currRicovero.dataDal)||h&&(k?f.findField("dataAl").getValue():c.cbaConfig.currRicovero.dataAl)&&h>Ext.Date.clearTime(k?f.findField("dataAl").getValue():c.cbaConfig.currRicovero.dataAl))&&msgAddError(d,"WARN_INTERVALLO_SUPPSCONTO_NON_E_COERENTE");if(0<d.length)return msgShow("",d);c.saltaCheckQuote=0!=c.getEditScontiSuppQuotaTot().getValue();c.modalitaAdtSemplificato&&(c.saltaCheckQuote=!0);if(0==c.saltaCheckQuote)Messaggio("ATTENZIONE",
traduci("MSG_QSAN_QSOC_WARNING"),"YESNO","QUESTION",null,function(){c.saltaCheckQuote=!0;c.salva(b,!0)});else return!0},nuovo:function(b){containerSolaLettura(this.getEditScontiSuppForm(),!1);this.getEditScontiSuppTipo().setReadOnly(!1);var c=this.getEditScontiSuppTipo().getStore();c.clearFilter();c.filterBy(function(b){return"C"==b.data.codice&&"S"==CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti||"S"==b.data.codice&&"S"==CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi?
!0:!1});controller_nuovoRecord(b);this.getEditScontiSuppTipo().setValue("S");"G"==this.tipoServizio?this.getEditScontiSuppFattore().setValue("P"):this.getEditScontiSuppFattore().setValue("A");this.getEditScontiSuppTipoImporto().setValue("I");this.getEditScontiSuppNumGG().setValue(1);this.getEditScontiSuppDataDal().setValue(new Date);this.getContainerDettaglio().hide();recGG={lun:!1,mar:!1,mer:!1,gio:!1,ven:!1,sab:!1,dom:!1};b=[];b.push(recGG);Ext.suspendLayouts();this.getGGPianificazione().getStore().loadData(b);
Ext.resumeLayouts()},salva:function(b,c){if(!c&&!this.verificaCampiForm(b))return!1;var d=this.getEditScontiSuppForm().getForm(),f=d.findField("fattoreMoltiplicazione").getValue();"A"!=f&&this.getEditScontiSuppNumGG().setValue("");var g="";"R"!=f?g="FFFFFFF":(g=this.getGGPianificazione().getStore().data.items[0].get("lun")?g+"T":g+"F",g=this.getGGPianificazione().getStore().data.items[0].get("mar")?g+"T":g+"F",g=this.getGGPianificazione().getStore().data.items[0].get("mer")?g+"T":g+"F",g=this.getGGPianificazione().getStore().data.items[0].get("gio")?
g+"T":g+"F",g=this.getGGPianificazione().getStore().data.items[0].get("ven")?g+"T":g+"F",g=this.getGGPianificazione().getStore().data.items[0].get("sab")?g+"T":g+"F",g=this.getGGPianificazione().getStore().data.items[0].get("dom")?g+"T":g+"F");f={idExtraRetta:d.findField("idExtraRetta").getValue(),idRicovero:this.ricovero,dataDal:d.findField("dataDal").getValue(),dataAl:d.findField("dataAl").getValue(),tipo:d.findField("tipo").getValue(),idRisposta:d.findField("idRisposta").getValue(),fattoreMoltiplicazione:d.findField("fattoreMoltiplicazione").getValue(),
giorniMoltiplicazione:d.findField("giorniMoltiplicazione").getValue(),tipoImporto:d.findField("tipoImporto").getValue(),descrizioneAggiuntiva:d.findField("descrizioneAggiuntiva").getValue(),quotaSanitaria:d.findField("quotaSanitaria").getValue(),quotaSociale:d.findField("quotaSociale").getValue(),giorniPianificazione:g,noteInterne:d.findField("noteInterne").getValue()};""!=d.findField("generatoDa").getValue()&&Ext.apply(f,{generatoDa:d.findField("generatoDa").getValue(),conguaglioDa:d.findField("conguaglioDa").getValue(),
conguaglioA:d.findField("conguaglioA").getValue()});Ext.isDefined(this.cbaConfig.storePaganti)?!Ext.isDefined(this.idPaganteCauzione)&&this.cbaConfig.gestioneCauzione&&1==this.cbaConfig.storePaganti.getCount()?this.idPaganteCauzione=this.cbaConfig.storePaganti.getAt(0).get("codice"):this.idPaganteCauzione=0:this.idPaganteCauzione=0;this.nuovoScontoSupplemento=!f.idExtraRetta;d=controller_salvaRecord(this.getEditScontiSuppForm(),f,b,{idPagante:this.idPaganteCauzione,saltaCheckQuote:this.saltaCheckQuote},
!1,!1,"idExtraRetta");("S"==this.tipoServizio||"A"==this.tipoServizio||"M"==this.tipoServizio)&&d&&this.nuovoScontoSupplemento&&!this.modalitaAdtSemplificato&&this.getContainerDettaglio().show()},gestioneForm:function(){var b=this;b.getEditScontiSuppFattore().getStore().load({callback:function(){}});var c=Ext.create("Ext.data.ArrayStore",{fields:["codice","valore","img"],data:[["S","SUPPLEMENTO","icon-piuleft"],["C","SCONTO","icon-menoleft"]],autoLoad:!0,autoDestroy:!0}),d=b.getEditScontiSuppTipo();
d.tpl=Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item {img}">{valore}</div>',"</tpl>");d.bindStore(c);b.getEditScontiSuppTipoImporto().bindStore(Ext.create("Generali.store.EuroPerc"));var f=b.getEditScontiSuppForm();if("L"==b.cbaConfig.permesso)containerSolaLettura(f),containerSolaLettura(b.getContainerDettaglio()),controller_bottoniSolaLettura(b.getBoxBottoni());else f.getForm().on("dirtychange",function(c,d){controller_abilitaBottoni(f);b.getStoricoGridScontiSupp().setDisabled(d);
b.getContainerDettaglio().setDisabled(d);b.getBtnElaboraFattura().setDisabled(d);b.cbaConfig.controllerEditFascicolo&&(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(d),b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(d))});b.getBtnElaboraFattura().setVisible("G"==b.tipoServizio&&!b.modalitaAdtSemplificato)},onLaunch:function(){var b=this,c=b.getEditScontiSuppForm();c.boxBottoni=b.getBoxBottoni();c.permesso=b.cbaConfig.permesso;b.storeForm=c.store=b.getStoricoGridScontiSupp().getStore();
c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c,!1)},annulla_callback:function(){b.cbaConfig.gestioneCauzione?(b.cbaConfig.callbackEsci(b.getEditScontiSuppRecordId().getValue()),b.getEditScontiSuppForm().up("window").close()):b.aggiornaStore(b.getEditScontiSuppRecordId().getValue()||null)},nuovo_callback:function(){b.nuovo(c)},elimina_callback:function(){var d=c.getForm().findField("idExtraRetta").getValue();Ext.isEmpty(d)||
controller_eliminaRecord(c.store,{idExtraRetta:d},function(){b.aggiornaStore()},!1,"")},esci_callback:function(){var d=b.getEditScontiSuppForm().up("window");b.cbaConfig.gestioneCauzione?(b.cbaConfig.callbackEsci(b.getEditScontiSuppRecordId().getValue()),d.close()):b.cbaConfig.noPortlet?d.close():controller_puoiUscire(d,c,function(){b.salva(!0,!1)},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()},function(){b.cbaConfig.controllerPortlet&&
b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm(!1)}}});inserisciBottoni(c.boxBottoni,d);b.getBoxBottoni().add(b.getBtnElaboraFattura());b.getContainerDettaglio().add([Ext.create("GeneraliOSP.portlet.view.EdtScontiSuppDe",{cbaConfig:{controllerTestata:b}})]);b.cbaConfig.wizard&&c.boxBottoni.queryById("btnEsci").setVisible(!1);b.permettiModificheDopoDimissione=permettiModificheDopoDimissione();
b.saltaCheckQuote=!1;b.getContainer().controller=b;ImpostaUrl([b.getStoricoGridScontiSupp().getStore(),b.getEditScontiSuppFattore().getStore(),b.getEditScontiSuppRisposta().getStore()]);d=b.cbaConfig.currRicovero.isModel;b.ricovero=d?b.cbaConfig.currRicovero.get("idRicovero"):b.cbaConfig.currRicovero.idRicovero;b.servizio=d?b.cbaConfig.currRicovero.get("idServizio"):b.cbaConfig.currRicovero.idServizio;b.tipoServizio=d?b.cbaConfig.currRicovero.get("servizio").tipoServizio:b.cbaConfig.currRicovero.servizio.tipoServizio;
if(!b.cbaConfig.noPortlet){var f=!1;b.cbaConfig.idExtraRetta&&(f=b.cbaConfig.idExtraRetta)}b.modalitaAdtSemplificato=!1;CBA.StdUtenti.getImpostazioniServizio(CBA.moduli.moduloAttivo,b.servizio).then(function(c){b.modalitaAdtSemplificato=1==c.modalitaIntZucchetti?!0:!1;b.gestioneForm();b.cbaConfig.gestioneCauzione||b.aggiornaStore(f)})["catch"](function(b){return msgShowError("",b)})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EdtScontiSuppDe",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"EditScontiSuppPaganti",selector:this.selContainer+"#EditScontiSuppPaganti"},{ref:"BtnNuovoScontiSuppPaganti",selector:this.selContainer+"#BtnNuovoScontiSuppPaganti"},{ref:"BtnEliminaScontiSuppPaganti",selector:this.selContainer+"#BtnEliminaScontiSuppPaganti"},{ref:"RdgScontiSuppPaganti",selector:this.selContainer+
"#RdgScontiSuppPaganti"},{ref:"ColEditPagante",selector:this.selContainer+"#ColEditPagante"}]);this.control(this.selContainer+"#BtnNuovoScontiSuppPaganti",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnEliminaScontiSuppPaganti",{click:this.clickBtnElimina});this.control(this.selContainer+"#EditScontiSuppPaganti",{beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,validateedit:this.validateeditGrid});this.control(this.selContainer+"#RdgScontiSuppPaganti",
{change:this.rdgScontiSuppPagantiChange})},verificaPagante:function(b){var c=[];Ext.isNumber(b.codfocl)||msgAddError(c,"MSG_SELZIONARE_PAGANTE");(b.quotaSanitaria&&0>b.quotaSanitaria||b.quotaSociale&&0>b.quotaSociale)&&msgAddError(c,"MSG_QUOTE_NEGATIVE");return msgShow("",c)},rdgScontiSuppPagantiChange:function(){var b=this.cbaConfig.controllerTestata.getStoricoGridScontiSupp().getSelectionModel().getSelection()[0],c=this.getEditScontiSuppPaganti().getPlugin().getEditor().getForm().findField("codfocl");
this.aggiornaComboPagante(b,c)},abilitaBottoniPagante:function(b){this.getBtnNuovoScontiSuppPaganti().setDisabled(!b);this.getBtnEliminaScontiSuppPaganti().setDisabled(!b);this.cbaConfig.controllerTestata.getEditScontiSuppForm().setDisabled(!b);this.cbaConfig.controllerTestata.getStoricoGridScontiSupp().setDisabled(!b);this.cbaConfig.controllerTestata.getBoxBottoni().setDisabled(!b);this.getRdgScontiSuppPaganti().setDisabled(b)},clickBtnNuovo:function(b){b={idCdiPlanTestata:this.cbaConfig.controllerTestata.getEditScontiSuppRecordId().getValue(),
tipoQuota:"P",quotaSanitaria:100,quotaSociale:100,ragioneSociale:null};controller_nuovoRecordGrid(b,this.getEditScontiSuppPaganti());try{var c=this.getEditScontiSuppPaganti().columns[0].getEditor();1==c.getStore().getCount()&&c.setValue(c.getStore().getAt(0).get("codice"))}catch(d){}this.abilitaBottoniPagante(!1)},clickBtnElimina:function(b){var c=this;b=c.getEditScontiSuppPaganti();var d=b.getSelectionModel().getSelection()[0];d&&(b.getStore().cbaConfig.idPagante=d.get("id"));controller_eliminaRecord(b.getStore(),
{idPagante:d?d.get("id"):""},function(){c.aggiornaStore(d.get("id"))})},beforeeditGrid:function(b,c,d){var f=this;if(!0===f.getEditScontiSuppPaganti().getPlugin().editing)return!1;this.abilitaBottoniPagante(!1);d=f.cbaConfig.controllerTestata.getStoricoGridScontiSupp().getSelectionModel().getSelection()[0];var g=b.getEditor().getForm().findField("codfocl");f.aggiornaComboPagante(d,g);c.record.get("codfocl")&&c.record.get("ragioneSociale")&&("U"==f.getRdgScontiSuppPaganti().getValue().filtroPaganti?
g.getStore().load({params:{valore:c.record.get("ragioneSociale")},callback:function(b,d,l){l&&(f.filtraComboPaganti(g.getStore()),c.record.data.codfocl&&g.setValue(c.record.data.codfocl))}}):g.setValue(c.record.get("codfocl")))},editGrid:function(b,c,d){d={id:c.record.data.id,idExtraRetta:this.cbaConfig.controllerTestata.getEditScontiSuppRecordId().getValue(),tipoQuota:c.newValues.tipoQuota,quotaSanitaria:c.newValues.quotaSanitaria,quotaSociale:c.newValues.quotaSociale,codfocl:c.newValues.codfocl};
var f=b.getEditor().getForm();f.controller=this;f.store=c.view.getStore();controller_salvaRecord(f,d,!1,!1)?this.abilitaBottoniPagante(!0):b.startEdit(c.record,0)},canceleditGrid:function(b,c,d){this.abilitaBottoniPagante(!0);b=this.getRdgScontiSuppPaganti();"F"!=b.getValue().filtroPaganti&&b.setValue({filtroPaganti:"F"});this.aggiornaStore(c.record.data.id,c.record)},validateeditGrid:function(b,c,d){return this.verificaPagante(c.newValues)},aggiornaComboPagante:function(b,c){var d=this,f;"F"==d.getRdgScontiSuppPaganti().getValue().filtroPaganti?
(f=d.storePagantiFascicolo,c.bindStore(f),c.queryMode="local",f.getProxy().extraParams.idRicovero=d.cbaConfig.controllerTestata.ricovero,b&&(f.getProxy().extraParams.dataDal=b.data.dataDal,f.getProxy().extraParams.dataAl=b.data.dataAl),f.load({callback:function(b,c,f){f&&d.filtraComboPaganti(this)}})):(c.bindStore(d.storeListaPaganti),c.queryMode="remote")},filtraComboPaganti:function(b){var c=this;b.clearFilter();b.filter({filterFn:function(b){return("4"==c.personContabili.tipoContabilitaAbilitata||
"5"==c.personContabili.tipoContabilitaAbilitata)&&1<b.data.extra.split(",").length?"T"==b.data.extra.split(",")[1]?!0:!1:!0}})},aggiornaStore:function(b){var c=this,d=c.getEditScontiSuppPaganti(),f=d.getStore(),g=d.verificaEditAuto;f.getProxy().extraParams.idExtra=c.cbaConfig.controllerTestata.getEditScontiSuppRecordId().getValue();f.load({callback:function(f,k,l){Ext.isEmpty(f)?g&&c.permettiModificheDopoDimissione&&c.getBtnNuovoScontiSuppPaganti().fireEvent("click"):posizionaRecordGrid(d,f,b,"id");
d.verificaEditAuto=!1}})},onLaunch:function(){this.getEditScontiSuppPaganti().controller=this;this.permettiModificheDopoDimissione=permettiModificheDopoDimissione();this.storePagantiFascicolo=Ext.create("CU.store.PagantiFascicoloPeriodo",{autoDestroy:!1});this.storeListaPaganti=Ext.create("GeneraliOSP.portlet.store.ListaPaganti",{autoDestroy:!1});ImpostaUrl([this.getEditScontiSuppPaganti().getStore(),this.storePagantiFascicolo]);this.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null);
this.storeListaPaganti.getProxy().setExtraParam("tipoContabilita",this.personContabili.tipoContabilitaAbilitata);this.storeListaPaganti.getProxy().setExtraParam("limit",0);this.filtraComboPaganti(this.storeListaPaganti);this.permettiModificheDopoDimissione||(this.getBtnNuovoScontiSuppPaganti().setDisabled(!0),this.getBtnEliminaScontiSuppPaganti().setDisabled(!0))},destroy:function(){eliminaStore(this.storePagantiFascicolo);eliminaStore(this.storeListaPaganti);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.EstrattoConto",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"EstrattoConto",selector:c+"#EstrattoConto"},{ref:"TpEstrattoConto",selector:c+"#TpEstrattoConto"},{ref:"TpCauzione",selector:c+"#TpCauzione"}]);b.control(c+"#EstrattoConto",{tabchange:b.tabchangeEstrattoConto});b.on({esci:function(){b.getContainer().up("window").close()}});
b.control(c+"#Container",{afterrender:b.onEstrattoContoAfterRender})},onEstrattoContoAfterRender:function(b,c){this.cbaConfig.wizard&&this.getEstrattoConto().getTabBar().down("#tbStampa").down("#BtnEsci").setVisible(!1)},afterTabChange:function(){this.cbaConfig.soloCauzioni||this.getTpEstrattoConto().down("#GridPaganti").controller.aggiornaStore()},tabchangeEstrattoConto:function(b,c){if("TpCauzione"==c.getItemId()){var d=c.down("grid");0<d.getStore().getCount()&&d.getSelectionModel().select(0)}},
onLaunch:function(){this.getContainer().controller=this;var b=!0;Ext.isEmpty(this.cbaConfig.recRicovero)||Ext.isEmpty(this.cbaConfig.recRicovero.idServizio)||(b=!1);this.personContabili=getPersonContabili(b?getIdOrg():this.cbaConfig.recRicovero.idServizio,new Date,b,null);["2","4","5"].includes(this.personContabili.tipoContabilitaAbilitata)||(this.cbaConfig.soloCauzioni=!0);this.cbaConfig.soloCauzioni?this.getEstrattoConto().remove(this.getTpEstrattoConto()):this.getTpEstrattoConto().add(Ext.create("GeneraliOSP.estrattoConto.view.TabEstrattoConto",
{itemId:"TabEstrattoConto",reference:"TabEstrattoConto"+Ext.Date.now(),cbaConfig:{permesso:this.cbaConfig.permesso,portlet:this.cbaConfig.portlet,wizard:this.cbaConfig.wizard,personContabili:this.personContabili,idServizio:b?null:this.cbaConfig.recRicovero.idServizio}}));this.getTpCauzione().add(Ext.create("GeneraliOSP.estrattoConto.view.TabCauzione",{itemId:"TabCauzione",reference:"TabCauzione"+Ext.Date.now(),cbaConfig:{permesso:this.cbaConfig.permesso,portlet:this.cbaConfig.portlet,wizard:this.cbaConfig.wizard,
controllerEditFascicolo:this.cbaConfig.controllerEditFascicolo,personContabili:this.personContabili}}))},destroy:function(){this.cbaConfig.portlet&&this.cbaConfig.portlet.down("#Container").controller.updatePortlet();this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.FARDati",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntDati",selector:this.selContainer+"#CntDati"},{ref:"GridPratiche",selector:this.selContainer+"#GridPratiche"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"FARDatiForm",selector:this.selContainer+"#FARDatiForm"},{ref:"RecordId",selector:this.selContainer+"#RecordId"},{ref:"CbPosContabile",
selector:this.selContainer+"#CbPosContabile"},{ref:"LblStruttura",selector:this.selContainer+"#LblStruttura"},{ref:"PnlPratica",selector:this.selContainer+"#PnlPratica"},{ref:"NumeroPratica",selector:this.selContainer+"#NumeroPratica"},{ref:"NumPraticaZero",selector:this.selContainer+"#NumPraticaZero"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"DataAl",selector:this.selContainer+"#DataAl"},{ref:"CbDimissione",selector:this.selContainer+"#CbDimissione"},{ref:"PnlFRNA",selector:this.selContainer+
"#PnlFRNA"},{ref:"FlagFRNA",selector:this.selContainer+"#FlagFRNA"},{ref:"CbRegPagante",selector:this.selContainer+"#CbRegPagante"},{ref:"CbDstPagante",selector:this.selContainer+"#CbDstPagante"},{ref:"PnlCombo",selector:this.selContainer+"#PnlCombo"},{ref:"CbStrutturaProvenienza",selector:this.selContainer+"#CbStrutturaProvenienza"},{ref:"CbMotivazioneRichiesta",selector:this.selContainer+"#CbMotivazioneRichiesta"},{ref:"CbRichiestaInserimento",selector:this.selContainer+"#CbRichiestaInserimento"},
{ref:"CbTipoAccoglienza",selector:this.selContainer+"#CbTipoAccoglienza"},{ref:"Note",selector:this.selContainer+"#Note"},{ref:"PnlGarsia",selector:this.selContainer+"#PnlGarsia"},{ref:"CbTipoPosto",selector:this.selContainer+"#CbTipoPosto"},{ref:"CbDistrettoContratto",selector:this.selContainer+"#CbDistrettoContratto"},{ref:"CbAssistenzaRegione",selector:this.selContainer+"#CbAssistenzaRegione"},{ref:"CbAssistenzaDistretto",selector:this.selContainer+"#CbAssistenzaDistretto"},{ref:"CntDatiTrimestrali",
selector:this.selContainer+"#CntDatiTrimestrali"}]);this.control(this.selContainer+"#GridPratiche",{select:this.onGridPraticheSelect});this.control(this.selContainer+"#CbPosContabile",{afterrender:this.afterrenderPosContabile});this.control(this.selContainer+"#DataDal",{change:this.changeDataDal});this.control(this.selContainer+"#DataAl",{change:this.changeDataAl});this.control(this.selContainer+"#FlagFRNA",{change:this.changeFlagFRNA});this.control(this.selContainer+"#CbRegPagante",{change:this.changeCbRegPagante});
this.control(this.selContainer+"#CbAssistenzaRegione",{change:this.changeCbAssistenzaRegione});this.control(this.selContainer+"#CbTipoAccoglienza",{change:this.changeCbTipoAccoglienza});this.control(this.selContainer+"#CbDstPagante",{change:this.changeCbDstPagante})},afterrenderPosContabile:function(b,c){var d=this;b.getEl().on("contextmenu",function(b){b.preventDefault();d.menu||(d.menu=Ext.create("Ext.menu.Menu",{items:[{text:traduci("FAR_SBLOCCA_POSCONTABILE"),singoloRecord:!0,handler:function(b){Ext.widget("passwordCBA",
{avvisaPasswordCorretta:!1,callBackSbloccoPwd:function(b){b&&(d.getCbPosContabile().setReadOnly(!1),d.forzaPosContabile=!0,d.getNumPraticaZero().setVisible(!0),d.getNumeroPratica().setWidth(115))}}).show()}}]}));d.menu.showAt(b.getXY())})},changeCbDstPagante:function(b,c,d,f){this.tracciatoGarsia&&!this.getCbDistrettoContratto().getValue()&&this.getCbDistrettoContratto().setValue(c)},changeCbTipoAccoglienza:function(b,c,d,f){var g=this;idPratica=g.getFARDatiForm().getForm().findField("id").getValue();
posContabile=g.getCbPosContabile().getValue();if(0<idPratica&&posContabile&&!g.chiusuraForzata&&Ext.isEmpty(g.getDataAl().getValue()))return g.chiusuraForzata=!0,Messaggio("ATTENZIONE","FAR_CHIUSURA_FORZATA","YESNO","WARNING","",function(){g.getFARDatiForm().getForm().setValues({tipologia_accoglienza:d});g.motivoDimForzato=6;g.cambioTipoAccoglienza=c;g.getBoxBottoni().queryById("btnNuovo").handler()},function(){g.chiusuraForzata=!1}),!1;!g.chiusuraForzata&&g.tracciatoGarsia&&"3">=c&&g.getCbTipoPosto().setValue(c)},
changeCbAssistenzaRegione:function(b,c,d,f){c&&"080"!=c&&this.getCbAssistenzaDistretto().clearValue();this.getCbAssistenzaDistretto().setDisabled("080"!=c);this.getCbAssistenzaDistretto().allowBlank="080"!=c},changeCbRegPagante:function(b,c,d,f){b=this.getFARDatiForm().getForm();c&&"080"!=c&&this.getCbDstPagante().clearValue();this.getCbDstPagante().setDisabled("080"!=c);this.getCbDstPagante().allowBlank="080"!=c;b.isValid()},changeFlagFRNA:function(b,c,d,f){var g=this,h=g.getFARDatiForm().getForm();
idPratica=h.findField("id").getValue();posContabile=g.getCbPosContabile().getValue();if(0<idPratica&&posContabile&&!g.chiusuraForzata&&Ext.isEmpty(g.getDataAl().getValue()))return g.chiusuraForzata=!0,Messaggio("ATTENZIONE","FAR_CHIUSURA_FORZATA","YESNO","WARNING","",function(){g.getFARDatiForm().getForm().setValues({aCaricoFRNA:d});g.motivoDimForzato=5;g.getBoxBottoni().queryById("btnNuovo").handler()},function(){g.chiusuraForzata=!1;d&&(g.getCbRegPagante().clearValue(),g.getCbDstPagante().clearValue());
g.getCbRegPagante().setVisible(g.tracciatoGarsia||1==c);g.getCbRegPagante().allowBlank=!g.tracciatoGarsia&&0==c;g.getCbDstPagante().setVisible(g.tracciatoGarsia||1==c);g.getCbDstPagante().allowBlank="080"!=h.findField("regionePagante").getValue();h.isValid()}),!1;g.chiusuraForzata||(d&&(g.getCbRegPagante().clearValue(),g.getCbDstPagante().clearValue()),g.getCbRegPagante().setVisible(g.tracciatoGarsia||1==c),g.getCbRegPagante().allowBlank=!g.tracciatoGarsia&&0==c,g.getCbDstPagante().setVisible(g.tracciatoGarsia||
1==c),g.getCbDstPagante().allowBlank="080"!=h.findField("regionePagante").getValue())},changeDataAl:function(b,c,d,f){this.getCbDimissione().setDisabled(!isValidDate(b));this.getCbDimissione().allowBlank=!isValidDate(b);this.getCbDimissione().validate();Ext.isEmpty(c)&&this.getCbDimissione().clearValue()},changeDataDal:function(b,c,d,f){var g=this.getFARDatiForm().getForm();if(isValidDate(b)){c=g.findField("annoPratica").getValue();b=Ext.util.Format.date(b.getValue(),"Y");if(0<g.findField("id").getValue()&&
c!=b)return Messaggio("ATTENZIONE",traduci("FAR_INIZIOPRATICA_KO"),"OK","WARNING"),this.getDataDal().setValue(d),!1;g.findField("id").getValue()||this.impostaNuovo(!1);0>g.findField("id").getValue()&&(g.setValues({annoPratica:b}),Ext.Ajax.request({url:"/cba/osp/far/ws/schedaFAR/pratiche/newNumero",method:"GET",params:{annoPratica:b,codStruttura:g.findField("codStruttura").getValue()},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?g.setValues({numPratica:b.data}):msgShowError("",b.message)}}))}},
onGridPraticheSelect:function(b,c){this.impostaDati(c)},impostaNuovo:function(b){var c=this,d=c.getFARDatiForm().getForm(),f=c.getGridPratiche().getStore();Ext.Ajax.request({url:"/cba/osp/far/ws/genOsp/getDatiFar",method:"GET",async:!1,params:{codOspite:currRicovero.codOspite},success:function(b){res=JSON.parse(b.responseText);0<res.data.length&&(0<=res.data[0]&&c.getCbStrutturaProvenienza().setValue(res.data[0]),0<=res.data[1]&&c.getCbMotivazioneRichiesta().setValue(res.data[1]),0<=res.data[2]&&
c.getCbRichiestaInserimento().setValue(res.data[2]))}});if(currRicovero.servizio.codiceStruttura){c.getLblStruttura().setValue(currRicovero.servizio.codiceStruttura+" - "+currRicovero.desServizio);d.setValues({id:"-9999",codStruttura:currRicovero.servizio.codiceStruttura,recordModificato:"T"});if(0==c.getGridPratiche().getStore().count())c.getDataDal().setValue(currRicovero.dataDal);else if(c.chiusuraForzata)c.getDataDal().setValue(new Date);else{var g=new Date(c.getGridPratiche().getSelection()[0].get("data_fine").getTime()+
864E5);c.getDataDal().setValue(g)}g=c.getCntDatiTrimestrali().items.items[0].items.items[0].controller;g.impostaDati(!1);g.recUltimoTrimestre=null;b&&(d.setValues({aCaricoFRNA:c.chiusuraForzata&&!c.cambioTipoAccoglienza?1==f.getAt(0).get("aCaricoFRNA")?"2":"1":f.getAt(0).get("aCaricoFRNA"),regionePagante:c.chiusuraForzata&&!c.cambioTipoAccoglienza?null:f.getAt(0).get("regionePagante"),distrettoPagante:c.chiusuraForzata&&!c.cambioTipoAccoglienza?null:f.getAt(0).get("distrettoPagante"),tipo_struttura_prov:f.getAt(0).get("tipo_struttura_prov"),
iniziativa_richiesta:f.getAt(0).get("iniziativa_richiesta"),motivazione_richiesta:f.getAt(0).get("motivazione_richiesta"),tipologia_accoglienza:c.chiusuraForzata&&c.cambioTipoAccoglienza?c.cambioTipoAccoglienza:f.getAt(0).get("tipologia_accoglienza"),garsia_tipoPosto:c.tracciatoGarsia?f.getAt(0).get("garsia_tipoPosto"):null,garsia_distrettoContratto:c.tracciatoGarsia?f.getAt(0).get("garsia_distrettoContratto"):null,garsia_regioneAssistenza:c.tracciatoGarsia?f.getAt(0).get("garsia_regioneAssistenza"):
null,garsia_distrettoAssistenza:c.tracciatoGarsia?f.getAt(0).get("garsia_distrettoAssistenza"):null}),c.chiusuraForzata&&(b=d.findField("aCaricoFRNA").getValue(),c.getCbRegPagante().setVisible(c.tracciatoGarsia||1==b),c.getCbRegPagante().allowBlank=!c.tracciatoGarsia&&1!=b,c.getCbDstPagante().setVisible(c.tracciatoGarsia||1==b),c.getCbDstPagante().allowBlank="080"!=d.findField("regionePagante").getValue(),d.isValid()),g.recUltimoTrimestre=g.storeTrimestri.getAt(0))}else return d=[],msgAddError(d,
"FAR_CODSTRUTTURA_OBBLIGATORIO"),msgShow("",d)},nuovo:function(){var b=this,c=b.getFARDatiForm(),d=b.getGridPratiche().getStore();if(b.chiusuraForzata)controller_nuovoRecord(c,b.getFlagFRNA()),b.impostaNuovo(!0);else{if(0<d.count()&&null==d.getAt(0).get("data_fine"))return Messaggio("ATTENZIONE",traduci("FAR_PRATICA_APERTA"),"OK","WARNING"),controller_abilitaBottoni(c),!1;0<d.count()&&null!=d.getAt(0).get("data_fine")?Messaggio("INFO","FAR_COPIA_PRATICA","YESNO","QUESTION","",function(){controller_nuovoRecord(c,
b.getFlagFRNA());b.impostaNuovo(!0)},function(){controller_nuovoRecord(c,b.getFlagFRNA());b.impostaNuovo(!1)}):(controller_nuovoRecord(c,b.getFlagFRNA()),b.impostaNuovo(!1))}},elimina:function(){var b=this,c=b.getFARDatiForm(),d=c.getForm(),f=d.findField("id").getValue(),g=b.getCbPosContabile().getValue();!Ext.isEmpty(f)&&g&&("T"==g||"8"==g||"9"==g?controller_eliminaRecord(c.store,{idPratica:f},function(){b.aggiornaStore()},null,traduci("FAR_ELIMINA_PRATICA")):Messaggio("ELIMINA",traduci("MSG_ELIMINA"),
"YESNO","QUESTION","",function(){d.setValues({recordModificato:"8"});b.salva()}))},verificaCampiForm:function(){var b=[],c=this.getFARDatiForm().getForm(),d=currRicovero.dataDal;c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");c.findField("data_fine").getValue()&&(c.findField("data_inizio").getValue()>c.findField("data_fine").getValue()&&msgAddError(b,"MSG_DATADAL_MAGGIORE_DATAAL"),c.findField("tipo_dimissione").getValue()||msgAddError(b,"FAR_TIPODIMISSIONE_OBBLIGATORIO"));c.findField("data_inizio").getValue()<
d.setHours(0,0,0,0)&&msgAddError(b,"FAR_DATAINIZIO_PRATICA_NON_VALIDA1");1<=this.getGridPratiche().getStore().count()&&(d=this.getGridPratiche().getSelectionModel().getSelection()[0],d=0<c.findField("id").getValue()?this.getGridPratiche().getStore().indexOf(d):-1,d=null!=this.getGridPratiche().getStore().getAt(d+1)?this.getGridPratiche().getStore().getAt(d+1).get("data_fine"):null,null!=d&&c.findField("data_inizio").getValue()<d&&msgAddError(b,"FAR_DATAINIZIO_PRATICA_NON_VALIDA2"));return msgShow("",
b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=this.getFARDatiForm(),d=c.getForm();idPratica=d.findField("id").getValue();codiceStruttura=d.findField("codStruttura").getValue();flagFRNA=d.findField("aCaricoFRNA").getValue();idAnagrGarsia=d.findField("id_anagr_garsia").getValue();idEsternoGarsia=d.findField("id_esterno_garsia").getValue();posContabile=d.findField("recordModificato").getValue();recModificato=this.forzaPosContabile||"F"!=posContabile?posContabile:"M";numPraticaZero=
d.findField("numPraticaZero").getValue()?"T":"F";d=c.getForm().getFieldValues();Ext.apply(d,{id:idPratica,idRicovero:currRicovero.idRicovero,codStruttura:codiceStruttura,aCaricoFRNA:1==flagFRNA?"1":"2",id_anagr_garsia:idAnagrGarsia?idAnagrGarsia:currRicovero.idRicovero,id_esterno_garsia:idEsternoGarsia,recordModificato:recModificato,numPraticaZero:numPraticaZero});controller_salvaRecord(c,d,b,{idPraticaPrecedente:this.chiusuraForzata?this.getGridPratiche().getStore().getAt(0).get("id"):0,motivoDimissione:this.chiusuraForzata?
this.motivoDimForzato:0})},impostaDati:function(b){this.getGridPratiche().setDisabled(!1);clearForm(this.getFARDatiForm());if(b){this.getFARDatiForm().loadRecord(b);this.getLblStruttura().setValue(b.get("codStruttura")+" - "+currRicovero.desServizio);this.getBoxBottoni().queryById("btnElimina").setDisabled(8==b.get("recordModificato")||9==b.get("recordModificato"));this.getNumeroPratica().setReadOnly("T"!=b.get("recordModificato"));var c=b.get("aCaricoFRNA");this.getCbRegPagante().setVisible(this.tracciatoGarsia||
1==c);this.getCbRegPagante().allowBlank=!this.tracciatoGarsia&&1!=c;this.getCbDstPagante().setVisible(this.tracciatoGarsia||1==c);this.getCbDstPagante().allowBlank="080"!=b.get("regionePagante");c=this.getCntDatiTrimestrali().items.items[0].items.items[0].controller;c.impostaDati(b);c.aggiornaStore(null,null,b.get("id"))}else this.getCntDatiTrimestrali().setDisabled(!0)},aggiornaStore:function(b){var c=this,d=c.getGridPratiche().getStore();clearForm(c.getFARDatiForm());d.load({params:{idRicovero:currRicovero.idRicovero},
callback:function(f,g,h){h?Ext.isEmpty(f)?(c.getCntDatiTrimestrali().setDisabled(!0),clearForm(c.getFARDatiForm()),setTimeout(function(){c.getDataDal().focus()},200)):(c.chiusuraForzata=!1,c.motivoDimForzato=null,c.cambioTipoAccoglienza=null,b||(b=c.getRecordId().getValue()),f=trovaRecord(d,"id",b),g=c.getGridPratiche(),g.getSelectionModel().deselectAll(),g.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}});c.getCbPosContabile().setReadOnly(!0);c.forzaPosContabile=!1},loadCombo:function(){this.getCbPosContabile().getStore().load();
this.storeRegioni=Ext.create("Generali.store.Regione");this.storeRegioni.load();this.getCbRegPagante().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeRegioni}));this.getCbAssistenzaRegione().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeRegioni}));this.getCbDimissione().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche}));this.getCbDimissione().getStore().filter({filterFn:function(b){return"MD"==b.data.extra?!0:!1}});this.getCbDstPagante().bindStore(Ext.create("Ext.data.ChainedStore",
{source:this.storeCodifiche}));this.getCbDstPagante().getStore().filter({filterFn:function(b){return"DS"==b.data.extra?!0:!1}});this.getCbStrutturaProvenienza().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche}));this.getCbStrutturaProvenienza().getStore().filter({filterFn:function(b){return"SP"==b.data.extra?!0:!1}});this.getCbMotivazioneRichiesta().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche}));this.getCbMotivazioneRichiesta().getStore().filter({filterFn:function(b){return"MR"==
b.data.extra?!0:!1}});this.getCbRichiestaInserimento().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche}));this.getCbRichiestaInserimento().getStore().filter({filterFn:function(b){return"RI"==b.data.extra?!0:!1}});this.getCbTipoAccoglienza().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche}));this.getCbTipoAccoglienza().getStore().filter({filterFn:function(b){return"TAC"==b.data.extra?!0:!1}});this.getCbTipoPosto().bindStore(Ext.create("Ext.data.ChainedStore",
{source:this.storeCodifiche}));this.getCbTipoPosto().getStore().filter({filterFn:function(b){return"GTP"==b.data.extra?!0:!1}});this.getCbDistrettoContratto().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche}));this.getCbDistrettoContratto().getStore().filter({filterFn:function(b){return"DS"==b.data.extra||"DSG"==b.data.extra?!0:!1}});this.getCbAssistenzaDistretto().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche}));this.getCbAssistenzaDistretto().getStore().filter({filterFn:function(b){return"DS"==
b.data.extra?!0:!1}})},onLaunch:function(){var b=this;b.forzaPosContabile=!1;b.chiusuraForzata=!1;b.motivoDimForzato=null;b.cambioTipoAccoglienza=null;ImpostaUrl([b.getCbPosContabile().getStore()]);var c=b.getFARDatiForm();c.boxBottoni=b.getBoxBottoni();c.store=b.getGridPratiche().getStore();c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},
elimina_callback:function(){b.elimina()},esci_callback:function(){var d=c.up("window");controller_puoiUscire(d,c,function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),
d);b.storeCodifiche=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/osp/far/ws/prszn/codifiche/cbox"}});b.storeCodifiche.load();b.tracciatoGarsia=!1;Ext.Ajax.request({url:"/cba/osp/far/ws/prszn/person/src",method:"GET",async:!1,params:{idOrganizzazione:getIdOrg()},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?(b.tracciatoGarsia=2==c.data.tipoTracciati?!0:!1,b.getPnlGarsia().setVisible(b.tracciatoGarsia),b.getCbTipoPosto().allowBlank=!b.tracciatoGarsia,b.getCbDistrettoContratto().allowBlank=
!b.tracciatoGarsia,b.getCbAssistenzaRegione().allowBlank=!b.tracciatoGarsia):msgShowError("",c.message)}});b.tracciatoGarsia||(b.getPnlFRNA().setMargin("40 0 0 0"),b.getPnlCombo().setMargin("40 0 0 0"));this.loadCombo();this.aggiornaStore();d=Ext.create("FAR.fascicolo.view.FARDatiTrimestre",{cbaConfig:{datiController:b,storeCodifiche:b.storeCodifiche,tracciatoGarsia:b.tracciatoGarsia}});b.getCntDatiTrimestrali().add(d);b.getCntDatiTrimestrali().title=traduci("FAR_TRIM_DATI");if("L"!=b.cbaConfig.permesso)c.getForm().on("dirtychange",
function(d,g){controller_abilitaBottoni(c);8!=b.getCbPosContabile().getValue()&&9!=b.getCbPosContabile().getValue()||b.getBoxBottoni().queryById("btnElimina").setDisabled(!0);b.getGridPratiche().setDisabled(g);b.getCntDatiTrimestrali().setDisabled(g)});else containerSolaLettura(c),controller_bottoniSolaLettura(c.boxBottoni)},destroy:function(){eliminaStore(this.storeCodifiche);eliminaStore(this.storeRegioni)}});
Ext.define("GeneraliOSP.portlet.controller.FRValutazioni",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"PnlGridValutazioni",selector:b+"#PnlGridValutazioni"},{ref:"GridValutazioni",selector:b+"#GridValutazioni"},{ref:"IdValutazioneREG",selector:b+"#IdValutazioneREG"},{ref:"CntValutazioni",selector:b+"#CntValutazioni"},{ref:"HeaderValutazione",selector:b+"#HeaderValutazione"},{ref:"DataValutazione",selector:b+
"#DataValutazione"},{ref:"CbTipoValutazione",selector:b+"#CbTipoValutazione"},{ref:"CodiceStruttura",selector:b+"#CodiceStruttura"},{ref:"RecordId",selector:b+"#RecordId"},{ref:"TabValutazione",selector:b+"#TabValutazione"},{ref:"CntPatologie",selector:b+"#CntPatologie"},{ref:"EdtPatologia1",selector:b+"#EdtPatologia1"},{ref:"EdtPatologia1Des",selector:b+"#EdtPatologia1Des"},{ref:"BtnPatologia1",selector:b+"#BtnPatologia1"},{ref:"EdtPatologia2",selector:b+"#EdtPatologia2"},{ref:"EdtPatologia2Des",
selector:b+"#EdtPatologia2Des"},{ref:"BtnPatologia2",selector:b+"#BtnPatologia2"},{ref:"EdtPatologia3",selector:b+"#EdtPatologia3"},{ref:"EdtPatologia3Des",selector:b+"#EdtPatologia3Des"},{ref:"BtnPatologia3",selector:b+"#BtnPatologia3"},{ref:"EdtPatologia4",selector:b+"#EdtPatologia4"},{ref:"EdtPatologia4Des",selector:b+"#EdtPatologia4Des"},{ref:"BtnPatologia4",selector:b+"#BtnPatologia4"},{ref:"EdtPatologia5",selector:b+"#EdtPatologia5"},{ref:"EdtPatologia5Des",selector:b+"#EdtPatologia5Des"},{ref:"BtnPatologia5",
selector:b+"#BtnPatologia5"},{ref:"EdtPatologia6",selector:b+"#EdtPatologia6"},{ref:"EdtPatologia6Des",selector:b+"#EdtPatologia6Des"},{ref:"BtnPatologia6",selector:b+"#BtnPatologia6"},{ref:"EditFRNote",selector:b+"#EditFRNote"},{ref:"CntSintomi",selector:b+"#CntSintomi"},{ref:"CntPrestazioni",selector:b+"#CntPrestazioni"},{ref:"CntSchede",selector:b+"#CntSchede"},{ref:"CntSvama",selector:b+"#CntSvama"},{ref:"GridSvama",selector:b+"#GridSvama"},{ref:"DataKarnofsky",selector:b+"#DataKarnofsky"},{ref:"PunteggioKarnofsky",
selector:b+"#PunteggioKarnofsky"}]);this.control(b+"#GridValutazioni",{select:this.onGridValutazioniSelect});this.control(b+"#BtnPatologia1",{click:this.clickPatologiaSearch});this.control(b+"#BtnPatologia2",{click:this.clickPatologiaSearch});this.control(b+"#BtnPatologia3",{click:this.clickPatologiaSearch});this.control(b+"#BtnPatologia4",{click:this.clickPatologiaSearch});this.control(b+"#BtnPatologia5",{click:this.clickPatologiaSearch});this.control(b+"#BtnPatologia6",{click:this.clickPatologiaSearch});
this.control(b+"#EdtPatologia1",{change:this.changePatologia1});this.control(b+"#EdtPatologia2",{change:this.changePatologia2});this.control(b+"#EdtPatologia3",{change:this.changePatologia3});this.control(b+"#EdtPatologia4",{change:this.changePatologia4});this.control(b+"#EdtPatologia5",{change:this.changePatologia5});this.control(b+"#EdtPatologia6",{change:this.changePatologia6});this.storeCodificheValutazioniSosia=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["0",traduci("VALUTAZIONE_AMMISSIONE"),
""],["1",traduci("VALUTAZIONE_INTERMEDIA"),""],["2",traduci("VALUTAZIONE_STRAORDINARIA"),""]],autoLoad:!0});this.storeCodificheValutazioniSvama=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["A",traduci("VALUTAZIONE_AMMISSIONE"),""],["D",traduci("VALUTAZIONE_DIMISSIONE"),""],["I",traduci("VALUTAZIONE_INTERMEDIA"),""],["S",traduci("VALUTAZIONE_STRAORDINARIA"),""]],autoLoad:!0});this.storeCodificheValutazioniSCDI=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["1",traduci("VALUTAZIONE_AMMISSIONE"),
""],["2",traduci("VALUTAZIONE_INTERMEDIA"),""],["3",traduci("VALUTAZIONE_STRAORDINARIA"),""],["4",traduci("VALUTAZIONE_DIMISSIONE"),""]],autoLoad:!0})},changePatologia1:function(b,c,d,f){c!=d&&this.cbaConfig.praticheController.getIcdByCode(c,this.getEdtPatologia1Des())},changePatologia2:function(b,c,d,f){c!=d&&this.cbaConfig.praticheController.getIcdByCode(c,this.getEdtPatologia2Des())},changePatologia3:function(b,c,d,f){c!=d&&this.cbaConfig.praticheController.getIcdByCode(c,this.getEdtPatologia3Des())},
changePatologia4:function(b,c,d,f){c!=d&&this.cbaConfig.praticheController.getIcdByCode(c,this.getEdtPatologia4Des())},changePatologia5:function(b,c,d,f){c!=d&&this.cbaConfig.praticheController.getIcdByCode(c,this.getEdtPatologia5Des())},changePatologia6:function(b,c,d,f){c!=d&&this.cbaConfig.praticheController.getIcdByCode(c,this.getEdtPatologia6Des())},clickPatologiaSearch:function(b){var c=b.textItemId,d=b.descItemId,f=null!=c?b.up().queryById(c):null,g=null!=d?b.up().queryById(d):null;Ext.create("winCBA",
{name:"GeneraliOSP.icd9Search.view.ICD9_Search",titolo:this.desRicercaICD9,iconCls:"icon-search16",dimensione:1,closable:!0,configItem:{icdUtilizzato:3,showIcdFrequenti:!1,exactMatch:!1,callbackRitorno:function(b,c){null==f?msgShowWarning("","COMPONENT_NOT_FOUND"):(f.setValue(b),g.setValue(c))}}}).show()},onGridValutazioniSelect:function(b,c){this.impostaDati(c)},loadDatiHSP:function(b,c){var d=this;Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/fr/valutazioniHSP/get",method:"GET",params:{idValutazioneREG:b},
success:function(f){f=Ext.JSON.decode(f.responseText);f.success?(d.getCntSintomi().items.items[0].controller.impostaDati(b,c,f.data),d.getCntPrestazioni().items.items[0].controller.impostaDati(b,f.data)):msgShowError("",f.message)}})},loadDatiValutazione:function(b){var c=this.cbaConfig.praticheController.getFRDatiForm(),d=b.get("data"),f=b.get("tipoValutazione");c.getForm().setValues({idValutazioneREG:b.get("idValutazioneREG"),data:d,tipoValutazione:f,patologia1:b.get("patologia1"),note:b.get("note")});
this.getHeaderValutazione().setVisible(3===this.cbaConfig.tipoFlusso&&(null==d||null==f))},loadDatiSchede:function(b){this.getDataKarnofsky().setValue(b.get("dataKarnofsky"));this.getPunteggioKarnofsky().setValue(b.get("punteggioKarnofsky"))},loadDatiSvama:function(){this.getGridSvama().getStore().load({params:{idRicoveroCSS:currRicovero.idRicoveroCSS}})},impostaDati:function(b){b?(this.loadDatiValutazione(b),Ext.isEmpty(b.get("patologia1"))||this.getEdtPatologia1().getValue()==b.get("patologia1")||
this.cbaConfig.praticheController.getIcdByCode(b.get("patologia1"),this.getEdtPatologia1Des()),this.loadDatiHSP(b.get("idValutazioneREG"),!1),this.getCntSchede().disabled||this.loadDatiSchede(b),this.getCntSvama().isVisible()&&!Ext.isEmpty(currRicovero.idRicoveroCSS)&&this.loadDatiSvama()):(b=new Ext.data.Model({idValutazioneREG:null,idRicovero:currRicovero.idRicovero,idPratica:this.idPratica,data:null,tipoValutazione:null,patologia1:null,patologia2:null,patologia3:null,patologia4:null,patologia5:null,
patologia6:null,note:null}),this.loadDatiValutazione(b))},clearData:function(){if(7==this.cbaConfig.tipoFlusso||9==this.cbaConfig.tipoFlusso){var b=this.getTabValutazione(),c=b.down("#Valutazioni_Sosia"),b=b.down("#Tariffe_Sosia");c.controller.aggiornaDati();b.controller.aggiornaDati()}},aggiornaStore:function(b,c){if(7==this.cbaConfig.tipoFlusso||9==this.cbaConfig.tipoFlusso){var d=this.getTabValutazione(),f=d.down("#Valutazioni_Sosia"),d=d.down("#Tariffe_Sosia");f.controller.aggiornaDati(currRicovero.idRicovero,
b);d.controller.aggiornaDati(currRicovero.idRicovero,b)}else{var g=this,h=g.getGridValutazioni().getStore();g.idPratica=b;h.load({params:{idPratica:b},callback:function(b,d,f){f?Ext.isEmpty(b)||(c||(c=g.getIdValutazioneREG().getValue()),b=trovaRecord(h,"idValutazioneREG",c),d=g.getGridValutazioni(),d.getSelectionModel().deselectAll(),d.getSelectionModel().select(b?[b]:0)):msgShowError("",d.getError())}})}},loadCombo:function(){this.getCbTipoValutazione().bindStore(Ext.create("Ext.data.ChainedStore",
{source:this.cbaConfig.storeCodifiche}));this.getCbTipoValutazione().getStore().filter({filterFn:function(b){return"TV"==b.data.extra?!0:!1}})},onLaunch:function(){ImpostaUrl([this.getGridValutazioni().getStore(),this.getGridSvama().getStore()]);this.loadCombo();var b=Ext.create("GeneraliOSP.portlet.view.FRValutazioni_HSP_RES",{cbaConfig:{valutazioniController:this,storeCodifiche:this.cbaConfig.storeCodifiche}});this.getCntSintomi().add(b);b=Ext.create("GeneraliOSP.portlet.view.FRValutazioni_HSP_PRS",
{cbaConfig:{valutazioniController:this,storeCodifiche:this.cbaConfig.storeCodifiche}});this.getCntPrestazioni().add(b);if(7==this.cbaConfig.tipoFlusso||9==this.cbaConfig.tipoFlusso){this.getPnlGridValutazioni().setVisible(!1);this.getCntValutazioni().setMargin(0);b=this.getTabValutazione();b.items.items.forEach(function(b){b.tab.hide();b.hide()});var c=Ext.create("GeneraliOSP.portlet.view.FRValutazioni_Sosia",{title:7==this.cbaConfig.tipoFlusso?"FR_SOSIA":"FR_CDI",itemId:"Valutazioni_Sosia",tipoFlusso:this.cbaConfig.tipoFlusso,
sbloccaStatoInvio:this.cbaConfig.sbloccaStatoInvio,praticheController:this.cbaConfig.praticheController});b.add(c);b.setActiveTab(c);c=Ext.create("GeneraliOSP.portlet.view.FRValutazioni_Sosia_Tariffe",{title:"FR_SOSIA_TARIFFE",itemId:"Tariffe_Sosia",tipoFlusso:this.cbaConfig.tipoFlusso,praticheController:this.cbaConfig.praticheController});b.add(c)}else[13,14,15].includes(this.cbaConfig.tipoFlusso)&&(this.getPnlGridValutazioni().setVisible(!1),this.getCntValutazioni().setMargin(0),b=this.getTabValutazione(),
c=Ext.create("GeneraliOSP.portlet.view.FRValutazioni_Sdo",{itemId:"Valutazioni_Sdo",tipoFlusso:this.cbaConfig.tipoFlusso,sbloccaStatoInvio:this.cbaConfig.sbloccaStatoInvio,praticheController:this.cbaConfig.praticheController}),b.add(c))},destroy:function(){eliminaStore(this.storeCodificheValutazioniSvama);eliminaStore(this.storeCodificheValutazioniSosia);eliminaStore(this.storeCodificheValutazioniSCDI)}});
Ext.define("GeneraliOSP.portlet.controller.FRValutazioni_HSP_PRS",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.desRicercaICD9=traduci("RICERCA_ICD9");this.addRef([{ref:"CbPrestazione1",selector:b+"#CbPrestazione1"},{ref:"CbPrestazione2",selector:b+"#CbPrestazione2"},{ref:"CbPrestazione3",selector:b+"#CbPrestazione3"},{ref:"CbPrestazione4",selector:b+"#CbPrestazione4"},{ref:"CbPrestazione5",selector:b+"#CbPrestazione5"},{ref:"CbPrestazione6",
selector:b+"#CbPrestazione6"},{ref:"CbPrestazione7",selector:b+"#CbPrestazione7"},{ref:"CbPrestazione8",selector:b+"#CbPrestazione8"},{ref:"CbPrestazione9",selector:b+"#CbPrestazione9"},{ref:"CbPrestazione10",selector:b+"#CbPrestazione10"}])},impostaDati:function(b,c){var d;d=Ext.isEmpty(c)?new Ext.data.Model({prestazione1:null,prestazione2:null,prestazione3:null,prestazione4:null,prestazione5:null,prestazione6:null,prestazione7:null,prestazione8:null,prestazione9:null,prestazione10:null}):new Ext.data.Model(c);
this.cbaConfig.valutazioniController.cbaConfig.praticheController.getFRDatiForm().loadRecord(d)},creaStorePrestazioni:function(){var b=Ext.create("Ext.data.ChainedStore",{source:this.cbaConfig.storeCodifiche});b.filter({filterFn:function(b){return"TPR"==b.data.extra?!0:!1}});return b},loadCombo:function(){this.getCbPrestazione1().bindStore(this.creaStorePrestazioni());this.getCbPrestazione2().bindStore(this.creaStorePrestazioni());this.getCbPrestazione3().bindStore(this.creaStorePrestazioni());this.getCbPrestazione4().bindStore(this.creaStorePrestazioni());
this.getCbPrestazione5().bindStore(this.creaStorePrestazioni());this.getCbPrestazione6().bindStore(this.creaStorePrestazioni());this.getCbPrestazione7().bindStore(this.creaStorePrestazioni());this.getCbPrestazione8().bindStore(this.creaStorePrestazioni());this.getCbPrestazione9().bindStore(this.creaStorePrestazioni());this.getCbPrestazione10().bindStore(this.creaStorePrestazioni())},onLaunch:function(){this.loadCombo()},destroy:function(){}});
Ext.define("GeneraliOSP.portlet.controller.FRValutazioni_HSP_RES",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.desRicercaICD9=traduci("RICERCA_ICD9");this.addRef([{ref:"IdValutazioneHSP",selector:b+"#IdValutazioneHSP"},{ref:"EdtSS1",selector:b+"#EdtSS1"},{ref:"EdtSS1Des",selector:b+"#EdtSS1Des"},{ref:"BtnSS1",selector:b+"#BtnSS1"},{ref:"EdtSS2",selector:b+"#EdtSS2"},{ref:"EdtSS2Des",selector:b+"#EdtSS2Des"},{ref:"BtnSS2",
selector:b+"#BtnSS2"},{ref:"EdtMNC1",selector:b+"#EdtMNC1"},{ref:"EdtMNC1Des",selector:b+"#EdtMNC1Des"},{ref:"BtnMNC1",selector:b+"#BtnMNC1"},{ref:"EdtMNC2",selector:b+"#EdtMNC2"},{ref:"EdtMNC2Des",selector:b+"#EdtMNC2Des"},{ref:"BtnMNC2",selector:b+"#BtnMNC2"},{ref:"EdtSSP1",selector:b+"#EdtSSP1"},{ref:"EdtSSP1Des",selector:b+"#EdtSSP1Des"},{ref:"BtnSSP1",selector:b+"#BtnSSP1"},{ref:"EdtSSP2",selector:b+"#EdtSSP2"},{ref:"EdtSSP2Des",selector:b+"#EdtSSP2Des"},{ref:"BtnSSP2",selector:b+"#BtnSSP2"},
{ref:"EdtSSS1",selector:b+"#EdtSSS1"},{ref:"EdtSSS1Des",selector:b+"#EdtSSS1Des"},{ref:"BtnSSS1",selector:b+"#BtnSSS1"},{ref:"EdtSSS2",selector:b+"#EdtSSS2"},{ref:"EdtSSS2Des",selector:b+"#EdtSSS2Des"},{ref:"BtnSSS2",selector:b+"#BtnSSS2"}]);this.control(b+"#BtnSS1",{click:this.clickSegniSintomi});this.control(b+"#BtnSS2",{click:this.clickSegniSintomi});this.control(b+"#BtnMNC1",{click:this.clickSegniSintomi});this.control(b+"#BtnMNC2",{click:this.clickSegniSintomi});this.control(b+"#BtnSSP1",{click:this.clickSegniSintomi});
this.control(b+"#BtnSSP2",{click:this.clickSegniSintomi});this.control(b+"#BtnSSS1",{click:this.clickSegniSintomi});this.control(b+"#BtnSSS2",{click:this.clickSegniSintomi});this.control(b+"#EdtSS1",{change:this.changeSS1});this.control(b+"#EdtSS2",{change:this.changeSS2});this.control(b+"#EdtMNC1",{change:this.changeMNC1});this.control(b+"#EdtMNC2",{change:this.changeMNC2});this.control(b+"#EdtSSP1",{change:this.changeSSP1});this.control(b+"#EdtSSP2",{change:this.changeSSP2});this.control(b+"#EdtSSS1",
{change:this.changeSSS1});this.control(b+"#EdtSSS2",{change:this.changeSSS2})},changeSS1:function(b,c,d,f){b=this.cbaConfig.valutazioniController.cbaConfig.praticheController;c!=d&&b.getIcdByCode(c,this.getEdtSS1Des())},changeSS2:function(b,c,d,f){b=this.cbaConfig.valutazioniController.cbaConfig.praticheController;c!=d&&b.getIcdByCode(c,this.getEdtSS2Des())},changeMNC1:function(b,c,d,f){b=this.cbaConfig.valutazioniController.cbaConfig.praticheController;c!=d&&b.getIcdByCode(c,this.getEdtMNC1Des())},
changeMNC2:function(b,c,d,f){b=this.cbaConfig.valutazioniController.cbaConfig.praticheController;c!=d&&b.getIcdByCode(c,this.getEdtMNC2Des())},changeSSP1:function(b,c,d,f){b=this.cbaConfig.valutazioniController.cbaConfig.praticheController;c!=d&&b.getIcdByCode(c,this.getEdtSSP1Des())},changeSSP2:function(b,c,d,f){b=this.cbaConfig.valutazioniController.cbaConfig.praticheController;c!=d&&b.getIcdByCode(c,this.getEdtSSP2Des())},changeSSS1:function(b,c,d,f){b=this.cbaConfig.valutazioniController.cbaConfig.praticheController;
c!=d&&b.getIcdByCode(c,this.getEdtSSS1Des())},changeSSS2:function(b,c,d,f){b=this.cbaConfig.valutazioniController.cbaConfig.praticheController;c!=d&&b.getIcdByCode(c,this.getEdtSSS2Des())},impostaDati:function(b,c,d){var f=this.cbaConfig.valutazioniController.cbaConfig.praticheController;b=Ext.isEmpty(d)?new Ext.data.Model({idValutazioneHSP:null,idValutazioneREG:b,ss1:null,ss2:null,mnc1:null,mnc2:null,ssp1:null,ssp2:null,sss1:null,sss2:null}):new Ext.data.Model(d);c&&(b.data.idValutazioneHSP=null,
b.data.idValutazioneREG=null);f.getFRDatiForm().loadRecord(b);Ext.isEmpty(b.get("ss1"))||this.getEdtSS1().getValue()==b.get("ss1")||f.getIcdByCode(b.get("ss1"),this.getEdtSS1Des());Ext.isEmpty(b.get("ss2"))||this.getEdtSS2().getValue()==b.get("ss2")||f.getIcdByCode(b.get("ss2"),this.getEdtSS2Des());Ext.isEmpty(b.get("mnc1"))||this.getEdtMNC1().getValue()==b.get("mnc1")||f.getIcdByCode(b.get("mnc1"),this.getEdtMNC1Des());Ext.isEmpty(b.get("mnc2"))||this.getEdtMNC2().getValue()==b.get("mnc2")||f.getIcdByCode(b.get("mnc2"),
this.getEdtMNC2Des());Ext.isEmpty(b.get("ssp1"))||this.getEdtSSP1().getValue()==b.get("ssp1")||f.getIcdByCode(b.get("ssp1"),this.getEdtSSP1Des());Ext.isEmpty(b.get("ssp2"))||this.getEdtSSP2().getValue()==b.get("ssp2")||f.getIcdByCode(b.get("ssp2"),this.getEdtSSP2Des());Ext.isEmpty(b.get("sss1"))||this.getEdtSSS1().getValue()==b.get("sss1")||f.getIcdByCode(b.get("sss1"),this.getEdtSSS1Des());Ext.isEmpty(b.get("sss2"))||this.getEdtSSS2().getValue()==b.get("sss2")||f.getIcdByCode(b.get("sss2"),this.getEdtSSS2Des())},
clickSegniSintomi:function(b){var c=b.textItemId,d=b.descItemId,f=null!=c?b.up().queryById(c):null,g=null!=d?b.up().queryById(d):null;Ext.create("winCBA",{name:"GeneraliOSP.icd9Search.view.ICD9_Search",titolo:this.desRicercaICD9,iconCls:"icon-search16",dimensione:1,closable:!0,configItem:{icdUtilizzato:3,showIcdFrequenti:!0,tipoFlussoRegionale:currRicovero.servizio.tipoFlusso,exactMatch:!1,callbackRitorno:function(b,c){null==f?msgShowWarning("","COMPONENT_NOT_FOUND"):(f.setValue(b),g.setValue(c))}}}).show()},
onLaunch:function(){},destroy:function(){}});
Ext.define("GeneraliOSP.portlet.controller.FRValutazioni_Sdo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"TabPnl",selector:this.selContainer+"#TabPnl"},{ref:"BtnScheda",selector:this.selContainer+"#BtnScheda"}]);this.control(this.selContainer+"#BtnScheda",{click:this.apriPopup});this.initListPanel();this.callParent(arguments)},apriPopup:function(b,c,d){var f=this,g="FR_DIAGNOSI"==this.getTabPnl().getActiveTab().itemId,h=
[],k={},l;f.cbaConfig.praticheController&&f.cbaConfig.praticheController.cbaConfig&&f.cbaConfig.praticheController.cbaConfig.idRicoveroCss?l=f.cbaConfig.praticheController.cbaConfig.idRicoveroCss:CBA.moduli.modulo49&&CBA.moduli.modulo49.storeAnagraficaSel&&CBA.moduli.modulo49.storeAnagraficaSel.getAt(0)&&CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data&&CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero&&(l=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero);Ext.Ajax.request({method:"GET",
url:"/cba/css/cs/ws/anagrafica/anagraficautentebyidricovero",params:{idRicovero:l},success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){b=b.data;var c={descrizione:g?traduci("DIAGNOSI_DIMISSIONE"):traduci("INTERVENTI"),iconCls:"icons-css-90 icon-diagnosidimissione css-blu",id:g?80086:80098,idModuloPrg:CBA.moduli.moduloAttivo,idVoceAgenda:null,nascondiTestata:!1,nomeForm:g?"CS.diagnosi.view.DiagnosiDimissione":"CS.diagnosi.view.Interventi",stampa:"T",text:g?traduci("DIAGNOSI_DIMISSIONE"):
traduci("INTERVENTI"),titolo:g?traduci("DIAGNOSI_DIMISSIONE"):traduci("INTERVENTI")};Ext.apply(k,{codEnte:CBA.parametriGenerali.codEnte,codModulo:CBA.moduli.moduloAttivo,codProfilo:CBA.parametriGenerali.codProfilo,codVideata:g?traduci("DIAGNOSI_DIMISSIONE"):traduci("INTERVENTI"),desVideata:g?traduci("DIAGNOSI_DIMISSIONE"):traduci("INTERVENTI"),idVideata:g?5036:5038,tipoPermesso:f.cbaConfig.praticheController.cbaConfig.permesso,voceMenu:c});h.push(k);h=checkChiusuraSanitaria(h,b.chiusuraSanitaria);
Ext.create("CSS_winCBA",{name:"GeneraliCS.popup.view.Popup",titolo:" ",visualizzaAnagrafica:b,configItem:{elencoVideate:h||[],anagraficaExtra:b,iconaPortlet:f.cbaConfig.iconaPortlet,nuovoDefault:!1,sottoTipoTestata:!1,videataDettaglio:"",selezioneTestata:!1,permesso:h[0].tipoPermesso,codOspitePopUp:b.codOspite,nominativoPopUp:b.cognome+b.nome,portlet:!1,callbackOnExit:function(){f.getTabPnl().getActiveTab().controller.aggiornaStore()}}}).cssDefaultShow()}else msgShowError("",b.message)}})},initListPanel:function(){var b=
this.cbaConfig;cols=[];this.ListGrid=[];var c={xtype:"toolbar",dock:"bottom",items:[{xtype:"tbfill",flex:1},{xtype:"button",itemId:"BtnScheda",reference:"BtnScheda",text:traduci("SCHEDA"),icon:"/cba/css/generali/images/generali/apri.svg",cls:"cbaCssBtnFunzione",scale:"small",width:90,nonDisabilitare:!0,margin:"0 5 0 0",hidden:49!=CBA.moduli.moduloAttivo}]};cols=[];cols.push({xtype:"gridcolumn",dataIndex:"id",text:"ID",align:"center",width:70,hidden:!0});cols.push({xtype:"gridcolumn",dataIndex:"ordine",
text:"POSIZIONE",align:"center",width:85});cols.push({xtype:"datecolumn",dataIndex:"data",text:"DATA",align:"center",format:"d/m/Y",width:90});cols.push({xtype:"gridcolumn",dataIndex:"icd9",text:"ICD9",align:"center",width:60});cols.push({xtype:"gridcolumn",dataIndex:"icd9Descrizione",text:"DESCRIZIONE",align:"left",flex:1});cols.push({xtype:"gridcolumn",dataIndex:"principale",text:"FR_STATO",align:"center",width:85,renderer:function(b,c,g,h,k,l,n){c=g.get("tipoSdo");h="height: 18px; width: 18px; background-color: #266fb0; border-radius: 50%; \n\t\t\t\t\t\t\t\t\t\tdisplay: flex; align-items: center; justify-content: center; color: #FFF;";
g=g.get("descrizioneTipoSdo");if(!Ext.isEmpty(b)&&("T"==b&&(c="P",h="height: 18px; width: 18px; background-color: green; border-radius: 50%; \n\t\t\t\t\t\t\t\t\t\tdisplay: flex; align-items: center; justify-content: center; color: #FFF;",g=traduci("FR_PRINCIPALE")),null!=c))return'\n\t\t\t\t\t\t\t\t    <div style="display: flex; justify-content: center; align-items: center;">\n\t\t\t\t\t\t\t\t        <div style="'+h+'"  title="'+g+'">\t\t\t\t\t\t\t        \n\t\t\t\t\t\t\t\t            '+c+"\n\t\t\t\t\t\t\t\t        </div>\n\t\t\t\t\t\t\t\t    </div>"}});
cols.push({xtype:"gridcolumn",dataIndex:"stadioDescrizione",text:"STADIO",align:"center",width:70});cols.push({xtype:"gridcolumn",dataIndex:"latoDescrizione",text:"LATO",align:"center",width:70});cols.push({xtype:"gridcolumn",dataIndex:"presente",text:"PRESENTE",align:"center",width:80,renderer:function(b,c,g,h,k,l,n){Ext.isEmpty(b)||"T"!=b||(c.tdCls="icon-selezionato")}});this.ListGrid.push({nameRef:"FR_DIAGNOSI",store:Ext.create("GeneraliOSP.portlet.store.FRDiagnosi",{autoLoad:!1}),params:{idRicoveroCU:b.idRicovero,
tipoFlusso:b.tipoFlusso,data:b.dataPratica},columns:cols,dockedItems:c});cols=[];cols.push({xtype:"gridcolumn",dataIndex:"id",text:"ID",align:"center",width:70,hidden:!0});cols.push({xtype:"gridcolumn",dataIndex:"ordine",text:"POSIZIONE",align:"center",width:85});cols.push({xtype:"datecolumn",dataIndex:"data",text:"DATA",align:"center",format:"d/m/Y",width:90});cols.push({xtype:"gridcolumn",dataIndex:"icd9",text:"ICD9",align:"center",width:60});cols.push({xtype:"gridcolumn",dataIndex:"icd9Descrizione",
text:"DESCRIZIONE",align:"left",flex:1,editor:{xtype:"combobox",displayField:"valore",valueField:"codice",queryParam:"descrizione",minChars:0,emptyText:"Seleziona Intervento"}});cols.push({xtype:"gridcolumn",dataIndex:"principale",text:"FR_PRINCIPALE",align:"center",width:85,renderer:function(b,c,g,h,k,l,n){Ext.isEmpty(b)||"T"!=b||(c.tdCls="icon-selezionato")}});cols.push({xtype:"gridcolumn",dataIndex:"stadio",text:"STADIO",align:"center",width:70});cols.push({xtype:"gridcolumn",dataIndex:"lato",
text:"LATO",align:"center",width:70});cols.push({xtype:"gridcolumn",dataIndex:"presente",text:"PRESENTE",align:"center",width:80});this.ListGrid.push({nameRef:"FR_INTERVENTI",store:Ext.create("GeneraliOSP.portlet.store.FRInterventi",{autoLoad:!1}),params:{idRicoveroCU:b.idRicovero,tipoFlusso:b.tipoFlusso,data:b.dataPratica},columns:cols,dockedItems:c});this.ListGrid.push({nameRef:"FR_INTEXTRASTRUTTURA",params:{idRicovero:b.idRicovero,tipoFlusso:b.tipoFlusso},pnlDisabled:!0,columns:cols});cols=[];
cols.push({xtype:"datecolumn",dataIndex:"data",text:"DATA",align:"center",format:"d/m/Y",width:80});cols.push({xtype:"gridcolumn",dataIndex:"trasferimento",text:"FR_TRASFERIMENTO",align:"center",width:110});cols.push({xtype:"gridcolumn",dataIndex:"icd9Descrizione",text:"DESCRIZIONE",align:"left",flex:1});this.ListGrid.push({nameRef:"FR_TRASFERIMENTI",params:{idRicovero:b.idRicovero,tipoFlusso:b.tipoFlusso},pnlDisabled:!0,columns:cols});this.ListGrid.push(Ext.create("GeneraliOSP.portlet.view.FRValutazioni_Sosia",
{title:"FR_SCHEDE",itemId:"Valutazioni_Sosia",tipoFlusso:this.cbaConfig.tipoFlusso,sbloccaStatoInvio:this.cbaConfig.sbloccaStatoInvio,praticheController:this.cbaConfig.praticheController}));cols=[];this.ListGrid.push(Ext.create("GeneraliOSP.portlet.view.FRValutazioni_Sdo_Dimissione",{title:"FR_DIMISSIONE",itemId:"Sdo_Dimissione",cbaConfig:b,tipoFlusso:this.cbaConfig.tipoFlusso,sbloccaStatoInvio:this.cbaConfig.sbloccaStatoInvio,praticheController:this.cbaConfig.praticheController}));Ext.each(this.ListGrid,
function(b){})},onLaunch:function(){var b=this.getTabPnl(),c;Ext.suspendLayouts();Ext.each(this.ListGrid,function(d){d=d.nameRef?Ext.create("GeneraliOSP.portlet.view.FRValutazioni_Sdo_Panel",{cbaConfig:d,title:d.nameRef,itemId:d.nameRef}):d;c||(c=d);b.add(d)});b.setActiveTab(c);Ext.resumeLayouts()},destroy:function(){Ext.each(this.ListGrid,function(b){eliminaStore(b.store)});this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.FRValutazioni_Sdo_Dimissione",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"CbGradoSupporto",selector:this.selContainer+"#CbGradoSupporto"},{ref:"CbTraumIntoss",selector:this.selContainer+"#CbTraumIntoss"},{ref:"CmbMdc",selector:this.selContainer+"#CmbMdc"},{ref:"RilevDolore",selector:this.selContainer+"#RilevDolore"}]);this.control(this.selContainer+"#CmbMdc",{change:this.changeMdc});
this.callParent(arguments)},changeMdc:function(b,c,d,f){var g=this.getCmbMdc();d&&c&&c!=d&&Messaggio("MODIFICA MDC",{msg:"FR_WARN_MODIFICA_MDC",type:"strongStr"},"YESNOCANCEL","QUESTION",null,function(){msgShowWarning("MDC MODIFICATO","FR_MSG_MDC_MODFICATO")},null,function(b){g.suspendEvent("change");g.reset();g.resumeEvent("change")})},aggiornaStore:function(b){},loadStore:function(){this.getCmbMdc().getStore().load({params:{idServizio:this.cbaConfig.idServizio,type:5}})},loadRilevazioneDolore:function(){var b=
{idRicoveroCU:this.cbaConfig.idRicovero,tipoFlusso:this.cbaConfig.tipoFlusso},c=this.getRilevDolore(),d=c.items.items[0].items.items[0];cmpRilDoloreNO=c.items.items[1].items.items[0];StdSipcar.promiseGetRequest(getUrlGen()+"/ws/genOsp/fr/valutazioni/rilevazioneDolore",b).then(function(b){b=Ext.isEmpty(b)||"T"!=b?!1:!0;c.setHidden(!1);d.setHidden(!b);cmpRilDoloreNO.setHidden(b)})["catch"](function(b){msgShowError("",b)})},leggiDatiTab:function(){return{gradoSupporto:this.getCbGradoSupporto().getValue(),
trauma:this.getCbTraumIntoss().getValue(),mdc:this.getCmbMdc().getValue()}},onLaunch:function(){this.storeClassReg=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/classificazioni"},autoLoad:!1,autoDestroy:!1});this.getCmbMdc().bindStore(this.storeClassReg);this.loadStore();this.loadRilevazioneDolore()},destroy:function(){this.storeClassReg&&eliminaStore(this.storeClassReg);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.FRValutazioni_Sdo_Panel",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments)},aggiornaStore:function(b){store=this.getView().down("#Grid"+this.cbaConfig.nameRef).getStore();param={};store&&(ImpostaUrl([store]),Ext.apply(param,this.cbaConfig.params),store.load({params:param,callback:function(b,d,f){}}))},addOtherCmp:function(){this.cbaConfig.cnt&&(cnt=this.cbaConfig.cnt,cntSdoPnl=
this.getView().down("#Cnt"+this.cbaConfig.nameRef),cntSdoPnl.add(cnt),cnt.store&&(ImpostaUrl([cnt.store]),cnt.store.load({params:cnt.storeParams})))},onLaunch:function(){this.addOtherCmp();this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.FRValutazioni_Sosia",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridValutazioneSosia",selector:b+"#GridValutazioneSosia"}]);this.control(b+"#GridValutazioneSosia",{beforeedit:this.beforeeditGridValutazioneSosia,edit:this.editGridValutazioneSosia,canceledit:this.canceleditGridValutazioneSosia,validateedit:this.validateeditGridValutazioneSosia,cellclick:this.gridCellClick});
this.storeCodificheValutazioniSosia=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["0",traduci("VALUTAZIONE_AMMISSIONE"),""],["1",traduci("VALUTAZIONE_INTERMEDIA"),""],["2",traduci("VALUTAZIONE_STRAORDINARIA"),""]],autoLoad:!0});this.storeCodificheValutazioniSvama=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["A",traduci("VALUTAZIONE_AMMISSIONE"),""],["D",traduci("VALUTAZIONE_DIMISSIONE"),""],["I",traduci("VALUTAZIONE_INTERMEDIA"),""],["S",traduci("VALUTAZIONE_STRAORDINARIA"),
""]],autoLoad:!0});this.storeCodificheValutazioniSCDI=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["1",traduci("VALUTAZIONE_AMMISSIONE"),""],["2",traduci("VALUTAZIONE_INTERMEDIA"),""],["3",traduci("VALUTAZIONE_STRAORDINARIA"),""],["4",traduci("VALUTAZIONE_DIMISSIONE"),""]],autoLoad:!0})},gridCellClick:function(b,c,d,f,g,h,k,l){0==d&&null!=f.data.data&&(0!=h&&1!=h||this.getVideata(80178,!0,!1,!1,f.data.id),2==h&&this.getVideata(80260,!0,!1,!1,f.data.id),3!=h&&4!=h||this.getVideata(80012,
!0,!1,!1,f.data.id),5!=h&&6!=h||this.getVideata(80259,!0,!1,!1,f.data.id),7!=h&&8!=h||this.getVideata(80215,!0,!1,!1,f.data.id),9!=h&&10!=h||this.getVideata(80262,!0,!1,!1,f.data.id))},getVideata:function(b,c,d,f,g){var h=this;h.openSchedaEsterna=!0;Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/parametri/visite/openPopup",params:{idGeMenuS2:b,idTestata:Ext.isEmpty(g)?"-9999":g,idProfiloPwdDeCss:CBA.parametriGenerali.idProfiloPwdDeCss,idRicovero:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).get("idRicovero")},
success:function(g){var k=Ext.JSON.decode(g.responseText);k.success&&(g=null,c&&(g=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0),Ext.isEmpty(k.data)||("N"!==k.data.tipoPermesso?cssUtenteByCodospite(g.get("codOspite"),function(c){cssOpenGestFree(k.data,c,k.data.idTestata,!1,!1,function(){h.onCloseVideata(b)},f,!1,"F")}):Messaggio("ATTENZIONE","CS_NO_PERMESSO_VIDEATA","OK","WARNING"))),d&&d(k))}})},beforeeditGridValutazioneSosia:function(b,c){if(!0===b.editing||!this.praticheController.sbloccaStatoInvio)return!1;
var d=b.getEditor().getForm();this.storeStatoInvio&&d.findField("statoInvio").bindStore(this.storeStatoInvio)},editGridValutazioneSosia:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();f.controller=this;f.store=c.view.getStore();delete d.desStatoInvio;controller_salvaRecord(f,d,!1,{tipoFlusso:this.tipoFlusso})||b.startEdit(c.record,0)},canceleditGridValutazioneSosia:function(b,c){this.aggiornaStore(c.record.get("id"))},validateeditGridValutazioneSosia:function(){return!0},aggiornaDati:function(b,
c){b&&c?(this.idRicovero=b,this.idPratica=c,this.aggiornaStore()):svuotaStore(this.getGridValutazioneSosia().getStore())},aggiornaStore:function(b){this.getGridValutazioneSosia().getStore().load({params:{idRicovero:this.idRicovero,idPratica:this.idPratica,tipoFlusso:this.tipoFlusso}})},onLaunch:function(){var b=this.getGridValutazioneSosia().getStore();ImpostaUrl([b]);this.getView().controller=this;9==this.tipoFlusso&&(this.storeStatoInvio=Ext.create("GeneraliOSP.portlet.store.FRStatoInvio"),ImpostaUrl([this.storeStatoInvio]),
this.storeStatoInvio.load())},destroy:function(){eliminaStore(this.storeStatoInvio);eliminaStore(this.storeCodificheValutazioniSosia)}});
Ext.define("GeneraliOSP.portlet.controller.FRValutazioni_Sosia_Tariffe",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridTariffeSosia",selector:b+"#GridTariffeSosia"},{ref:"BtnNuovoTariffeSosia",selector:b+"#BtnNuovoTariffeSosia"},{ref:"BtnEliminaTariffeSosia",selector:b+"#BtnEliminaTariffeSosia"}]);this.control(b+"#BtnNuovoTariffeSosia",{click:this.clickBtnNuovoTariffeSosia});this.control(b+"#BtnEliminaTariffeSosia",
{click:this.clickBtnEliminaTariffeSosia});this.control(b+"#GridTariffeSosia",{beforeedit:this.beforeeditGridTariffeSosia,edit:this.editGridTariffeSosia,canceledit:this.canceleditGridTariffeSosia,validateedit:this.validateeditGridTariffeSosia})},beforeeditGridTariffeSosia:function(b,c,d){if(!0===b.editing||"T"==c.record.get("recordVirtuale"))return!1;this.abilitaBottoniGridTariffeSosia(!1)},editGridTariffeSosia:function(b,c,d){d=c.record.getData();var f=b.getEditor().getForm();f.controller=this;f.store=
c.view.getStore();Ext.apply(d,{idRicovero:this.idRicovero,idPratica:this.idPratica});controller_salvaRecord(f,d,!1,!1)?this.abilitaBottoniGridTariffeSosia(!0):b.startEdit(c.record,0)},canceleditGridTariffeSosia:function(b,c,d){this.abilitaBottoniGridTariffeSosia(!0);this.aggiornaStore(c.record.get("id"))},validateeditGridTariffeSosia:function(b,c,d){return msgShow("",[])},abilitaBottoniGridTariffeSosia:function(b){this.getBtnNuovoTariffeSosia().setDisabled(!b);this.getBtnEliminaTariffeSosia().setDisabled(!b);
this.praticheController.enableForm(b)},clickBtnNuovoTariffeSosia:function(b){controller_nuovoRecordGrid({recordVirtuale:"F",dal:new Date},this.getGridTariffeSosia())},clickBtnEliminaTariffeSosia:function(b){var c=this;b=c.getGridTariffeSosia();var d=b.getSelectionModel().getSelection()[0];"T"!=d.get("recordVirtuale")&&controller_eliminaRecord(b.getStore(),{id:d?d.get("id"):""},function(){c.aggiornaStore()})},aggiornaDati:function(b,c){b&&c?(this.idRicovero=b,this.idPratica=c,this.aggiornaStore()):
svuotaStore(this.getGridTariffeSosia().getStore())},aggiornaStore:function(b){var c=this.getGridTariffeSosia(),d=c.getStore();d.load({params:{idRicovero:this.idRicovero,idPratica:this.idPratica},callback:function(f,g,h){h?(f=null,b&&(f=trovaRecord(d,"id",b)),c.getSelectionModel().deselectAll(),c.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}})},onLaunch:function(){var b=this.getGridTariffeSosia(),c=b.getStore();ImpostaUrl([c]);b.controller=this}});
Ext.define("GeneraliOSP.portlet.controller.FlussiRegionali",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);CBA.StdUtenti&&CBA.StdUtenti.loadFlussiRegionaliConst(this);this.FR_DATA_EVENTO_INDICE_SV=traduci("FR_DATA_EVENTO_INDICE_SV");this.FR_SITUAZIONE_PENSIONISTICA=traduci("FR_SITUAZIONE_PENSIONISTICA");this.FR_PROFESSIONE_INGRESSO=traduci("FR_PROFESSIONE_INGRESSO");this.FR_DIAGNOSI_DIMISSIONE=traduci("FR_DIAGNOSI_DIMISSIONE");
this.FR_INIZIATIVA_RICHIESTA=traduci("FR_INIZIATIVA_RICHIESTA");this.FR_MOTIVO_APERTURA_PRATICA=traduci("FR_MOTIVO_APERTURA_PRATICA");this.FR_PROVENIENZA_UTENTE=traduci("FR_PROVENIENZA_UTENTE");this.addRef([{ref:"PnlUp",selector:this.selContainer+"#PnlUp"},{ref:"CntDatiPrincipali",selector:this.selContainer+"#CntDatiPrincipali"},{ref:"CntDatiExtraPratica",selector:this.selContainer+"#CntDatiExtraPratica"},{ref:"CntDatiExtraPraticaSdo",selector:this.selContainer+"#CntDatiExtraPraticaSdo"},{ref:"CntValutazioni",
selector:this.selContainer+"#CntValutazioni"},{ref:"GridPratiche",selector:this.selContainer+"#GridPratiche"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"FRDatiForm",selector:this.selContainer+"#FRDatiForm"},{ref:"IdPratica",selector:this.selContainer+"#IdPratica"},{ref:"CbStatoInvio",selector:this.selContainer+"#CbStatoInvio"},{ref:"PnlPratica",selector:this.selContainer+"#PnlPratica"},{ref:"CodiceStruttura",selector:this.selContainer+"#CodiceStruttura"},{ref:"CodiceStrutturaDestinazione",
selector:this.selContainer+"#CodiceStrutturaDestinazione"},{ref:"NumeroPratica",selector:this.selContainer+"#NumeroPratica"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"DataAl",selector:this.selContainer+"#DataAl"},{ref:"CbMotivoApertura",selector:this.selContainer+"#CbMotivoApertura"},{ref:"CbEsitoCongedo",selector:this.selContainer+"#CbEsitoCongedo"},{ref:"CbMotivoChiusura",selector:this.selContainer+"#CbMotivoChiusura"},{ref:"FlagFSR",selector:this.selContainer+"#FlagFSR"},{ref:"CbSoggettoPagante",
selector:this.selContainer+"#CbSoggettoPagante"},{ref:"CbValutazioneRichiesta",selector:this.selContainer+"#CbValutazioneRichiesta"},{ref:"CbTipoPostoLetto",selector:this.selContainer+"#CbTipoPostoLetto"},{ref:"TipologiaUtente",selector:this.selContainer+"#TipologiaUtente"},{ref:"InfoTipologiaUtente",selector:this.selContainer+"#InfoTipologiaUtente"},{ref:"btnStampaDati",selector:this.selContainer+"#btnStampaDati"},{ref:"CbProvenienzaUtente",selector:this.selContainer+"#CbProvenienzaUtente"},{ref:"CbClassifUtente",
selector:this.selContainer+"#CbClassifUtente"},{ref:"TipologiaAssistenza",selector:this.selContainer+"#TipologiaAssistenza"},{ref:"InfoPratica",selector:this.selContainer+"#InfoPratica"},{ref:"CodiceTipologiaUtente",selector:this.selContainer+"#CodiceTipologiaUtente"},{ref:"CntContainer1",selector:this.selContainer+"#CntContainer1"}]);this.control(this.selContainer+"#btnStampaDati",{click:this.btnStampaDatiClick});this.control(this.selContainer+"#GridPratiche",{select:this.onGridPraticheSelect});
this.control(this.selContainer+"#CbStatoInvio",{afterrender:this.afterrenderStatoInvio,select:this.selectStatoInvio});this.control(this.selContainer+"#DataDal",{change:this.changeDataDal,blur:this.exitDataDal});this.control(this.selContainer+"#DataAl",{change:this.changeDataAl});this.control(this.selContainer+"#TipologiaAssistenza",{select:this.selectTipologiaAssistenza});this.control(this.selContainer+"#CbTipoPostoLetto",{change:this.changeCbTipoPostoLetto});this.control(this.selContainer+"#CbMotivoChiusura",
{change:this.changeCbMotivoChiusura})},changeCbMotivoChiusura:function(b,c,d,f){if(this.tipoFlusso!=this._FAR_VENETO||508!=currRicovero.servizio.codAsl)return!1;c&&c.startsWith(7)?(this.getCodiceStrutturaDestinazione().setVisible(!0),this.getCodiceStrutturaDestinazione().allowBlank=!1,this.getCodiceStrutturaDestinazione().validate()):(this.getCodiceStrutturaDestinazione().setVisible(!1),this.getCodiceStrutturaDestinazione().allowBlank=!0,this.getCodiceStrutturaDestinazione().setValue(null))},changeCbTipoPostoLetto:function(b,
c,d,f){if(Ext.isEmpty(c)||Ext.isEmpty(d)||this.tipoFlusso!=this._SOSIA_LOMBARDIA)return!1;var g=this,h=g.getFRDatiForm().getForm();b=h.findField("idPratica").getValue();Ext.isEmpty(g.motivoDimForzato)&&this.getCbMotivoChiusura().getStore().each(function(b){if(b.get("valore").startsWith(6)||-1!=b.get("valore").indexOf("trasferimento ad altra tipologia")||b.get("extra")&&b.get("extra").startsWith(6))g.motivoDimForzato=b.get("codice")});Ext.isEmpty(g.tipoProvenienzaForzato)&&this.getCbProvenienzaUtente().getStore().each(function(b){if(b.get("valore").startsWith(7)||
-1!=b.get("valore").indexOf("dimesso da altro regime")||b.get("extra")&&b.get("extra").startsWith(7))g.tipoProvenienzaForzato=b.get("codice")});if(0<b&&!g.chiusuraForzata&&Ext.isEmpty(g.getDataAl().getValue()))return g.chiusuraForzata=!0,Messaggio("ATTENZIONE","FAR_CHIUSURA_FORZATA","YESNO","WARNING","",function(){g.getFRDatiForm().getForm().setValues({tipoPostoLetto:d});g.cambioTipoPostoLetto=c;g.getBoxBottoni().queryById("btnNuovo").handler()},function(){g.chiusuraForzata=!1;h.isValid()}),!1;g.chiusuraForzata||
g.getCbTipoPostoLetto().setValue(c)},btnStampaDatiClick:function(){var b=null,c=this.getIdPratica().getValue();dataAl=this.getDataAl().getValue();tipoFlusso=currRicovero&&currRicovero.servizio?currRicovero.servizio.tipoFlusso:null;codStruttura=this.getCodiceStruttura().getValue();if(tipoFlusso&&[this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA].includes(tipoFlusso)){var d=this.getCntValutazioni().down("#GridValutazioneSosia");d&&d.getSelection()&&0<d.getSelection().length&&(dataAl=d.getSelection()[0].get("data"),
b=d.getSelection()[0].get("id"));if(tipoFlusso==this._SCDI_LOMBARDIA&&!b){msgShowError("","Seleziona una valutazione da stampare");return}}showWinStampa(CBA.moduli.moduloAttivo,CBA.parametriGenerali.codEnte,"StampaDatiFR",{configBtnStampa:{reportDaEsportare:!1,hideCsv:!0,hideXls:!0,hideXml:!0,hideExcel:!0,hideText:!0,params:{format:"PDF",tipoFlusso:this.tipoFlusso,strutture:codStruttura,idPratica:c,idValutazione:null==b?0:b}},dataDal:this.getDataDal().getValue(),dataAl:dataAl,elencoUtenti:currRicovero.codOspite,
raggruppamento:-1})},afterrenderStatoInvio:function(b,c){var d=this;b.getEl().on("contextmenu",function(b){b.preventDefault();d.menu||(d.menu=Ext.create("Ext.menu.Menu",{items:[{text:traduci("FR_SBLOCCA_STATOINVIO"),singoloRecord:!0,handler:function(b){Messaggio("ATTENZIONE",traduci("FR_WARN_SBLOCCO_STATO_PRATICA"),"YESNO","QUESTION",!1,function(){d.getCbStatoInvio().setReadOnly(!1);d.cbaConfig.controllerPortlet.cbaConfig.sbloccaStatoInvio=!0;d.sbloccaStatoInvio=!0})}}]}));1==d.getCbStatoInvio().readOnly&&
d.menu.showAt(b.getXY())})},selectStatoInvio:function(){this.forzaStatoInvio=!0},filtraStoreClassifUtente:function(){if(this.tipoFlusso==this._SOSIA_LOMBARDIA){var b=this.getCbClassifUtente(),c=this.getCodiceTipologiaUtente().getValue(),d=b.getValue();b.getStore().clearFilter();b.getStore().filter({filterFn:function(f){var g="CS"==f.data.extra&&f.get("gruppo")==c?!0:!1;d&&d==f.data.codice&&"CS"==f.data.extra&&!g&&b.setValue(null);return g}})}},handleClassificazioneUtente:function(b){b=void 0===b?
null:b;var c=this,d=this.getCbClassifUtente();d.allowBlank=!(this.tipoFlusso==this._SOSIA_LOMBARDIA&&0<d.getStore().getCount());b||(b=this.getDataDal());if(isValidDate(b)&&this.tipoFlusso==this._SOSIA_LOMBARDIA){var f=this.getFRDatiForm(),g=this.getTipologiaAssistenza().getValue();f.isDirty()&&this.requestCodiceTipologiaUtente(b.getValue(),g).then(function(b){b=b.data;c.getCodiceTipologiaUtente().setValue(b[0]);c.getTipologiaUtente().setValue(b[1]);c.filtraStoreClassifUtente();d.allowBlank=0==d.getStore().getCount();
d.validate()})["catch"](function(b){return msgShowError("",b)})}},selectTipologiaAssistenza:function(b,c){this.handleClassificazioneUtente(null)},exitDataDal:function(b,c){this.handleClassificazioneUtente(b)},changeDataAl:function(b,c,d,f){this.getCbMotivoChiusura().setDisabled(!isValidDate(b));this.getCbMotivoChiusura().allowBlank=!isValidDate(b);this.getCbMotivoChiusura().validate();Ext.isEmpty(c)&&this.getCbMotivoChiusura().clearValue();[this._SCDI_LOMBARDIA,this._ODC_VENETO].includes(this.tipoFlusso)&&
(this.getCbEsitoCongedo().setDisabled(!isValidDate(b)),this.getCbEsitoCongedo().allowBlank=!isValidDate(b),this.getCbEsitoCongedo().validate(),Ext.isEmpty(c)&&this.getCbEsitoCongedo().clearValue())},changeDataDal:function(b,c,d,f){var g=this.getFRDatiForm().getForm();if(isValidDate(b)){c=g.findField("annoPratica").getValue();b=Ext.util.Format.date(b.getValue(),"Y");if(0<g.findField("idPratica").getValue()&&!Ext.isEmpty(c)&&c!=b)return Messaggio("ATTENZIONE",traduci("FAR_INIZIOPRATICA_KO"),"OK","WARNING"),
this.getDataDal().setValue(d),!1;g.findField("idPratica").getValue()||this.impostaNuovo(!1);0>g.findField("idPratica").getValue()&&(g.setValues({annoPratica:b}),Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/fr/pratiche/newNumero",method:"GET",params:{annoPratica:b,codStruttura:g.findField("codStruttura").getValue(),tipoFlusso:this.tipoFlusso},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?g.setValues({numPratica:b.data}):msgShowError("",b.message)}}))}},onGridPraticheSelect:function(b,
c){this.impostaDati(c)},impostaNuovo:function(b){var c=this.getDataDal(),d=this.getFRDatiForm().getForm(),f=this.getGridPratiche().getStore(),g=0==f.getCount();if(currRicovero.servizio.codiceStruttura){[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso)&&(c=this.controllerSdo.getDataDalSdo(),this.controllerSdo.enableFormSdoCss(!0),this.controllerSdo.nuovo());this.getCntDatiPrincipali().setDisabled(!1);this.getCntValutazioni().setDisabled(!1);var h=null,k=
null;g&&currRicovero.parametriRegionali&&(h=currRicovero.parametriRegionali.idTipoProvenienza||null,k=currRicovero.parametriRegionali.tipoRicovero||null);d.setValues({codStruttura:currRicovero.servizio.codiceStruttura,idPratica:"-9999",idValutazioneREG:null,idValutazioneHSP:null,statoInvio:"T",aCaricoFSR:"T",tipoProvenienzaUtente:h,tipologiaAssistenza:k});h=new Date;0!=this.getGridPratiche().getStore().count()||this.chiusuraForzata||(h=currRicovero.dataDal);b&&!this.chiusuraForzata&&(g=f.getAt(0),
h=8==g.get("statoInvio")||9==g.get("statoInvio")?g.get("dal"):g.get("al")?moment(g.get("al")).add(1,"days").toDate():new Date);c.setValue(h);this.handleClassificazioneUtente();this.setToolTipPratica();Ext.isEmpty(currRicovero.dataAl)||this.getDataAl().setValue(currRicovero.dataAl);k=g=!1;[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE,this._FILEC_MARCHE,this._FILER_MARCHE].includes(this.tipoFlusso)||(g=this.getCntValutazioni().items.items[0].controller,k=g.getCbTipoValutazione(),
g.getDataValutazione().setValue(h));k&&1==k.getStore().data.items.length&&k.setValue(k.getStore().data.items[0].get("codice"));b&&(b={},f=f.getAt(0),this.tipoFlusso==this._SOSIA_LOMBARDIA?Ext.apply(b,{tipoProvenienzaUtente:this.chiusuraForzata?this.tipoProvenienzaForzato:f.get("tipoProvenienzaUtente"),tipologiaAssistenza:f.get("tipologiaAssistenza"),classificazioneUtente:f.get("classificazioneUtente"),tipoPostoLetto:this.chiusuraForzata&&this.cambioTipoPostoLetto?this.cambioTipoPostoLetto:f.get("tipoPostoLetto")}):
this.tipoFlusso==this._SCDI_LOMBARDIA?Ext.apply(b,{valutazioneRichiesta:f.get("valutazioneRichiesta"),tipoPostoLetto:f.get("tipoPostoLetto")}):[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE,this._FILEC_MARCHE,this._FILER_MARCHE].includes(this.tipoFlusso)?[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso)&&Ext.apply(b,{classeAsa:f.get("classeAsa")}):Ext.apply(b,{aCaricoFSR:f.get("aCaricoFSR"),motApertura:f.get("motApertura"),tipoValutazione:g.getGridValutazioni().getStore().getAt(0).get("tipoValutazione"),
patologia1:g.getGridValutazioni().getStore().getAt(0).get("patologia1"),note:g.getGridValutazioni().getStore().getAt(0).get("note")}),d.setValues(b),[this._CURE_PALLIATIVE_RES_LOMBARDIA,this._CURE_PALLIATIVE_DOM_LOMBARDIA,this._CURE_PALLIATIVE_RES_VENETO].includes(this.tipoFlusso)&&g.getCntPrestazioni().items.items[0].controller.loadDatiHSP(g.getGridValutazioni().getStore().getAt(0).get("idValutazioneREG"),!0));g&&g.clearData();[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso)&&
this.controllerSdo&&this.controllerSdo.loadPresaInCaricoParamSan();setTimeout(function(){c.focus()},500)}else return d=[],msgAddError(d,"FR_CODSTRUTTURA_OBBLIGATORIO"),msgShow("",d)},nuovo:function(){var b=this,c=b.getFRDatiForm(),d=b.getFlagFSR(),f=b.getGridPratiche().getStore();if([b._SDO_ALTOADIGE,b._SDOFIM_ALTOADIGE,b._SDERIA_ALTOADIGE].includes(b.tipoFlusso)){if(0<f.count()){var g=!1;f.each(function(b){if(8!=b.get("statoInvio")&&9!=b.get("statoInvio")&&"F"!=b.get("statoInvio"))return g=!0});
if(g){var f=b.getCmpBtn().queryById("btnElimina"),h=f.isDisabled();Messaggio("ATTENZIONE","FR_MSG_PRATICA_ERRORE_APERTA","OK","WARNING");controller_abilitaBottoni(c);f.setDisabled(h);return!1}}b.controllerSdo.nuovo();c=b.controllerSdo.getFormSdo();d=b.controllerSdo.getIdTipoProvenienza()}if(b.chiusuraForzata)controller_nuovoRecord(c,d),b.impostaNuovo(!0),b.getCbProvenienzaUtente().setReadOnly(!0);else if(0<f.count()){var k=-1;f.each(function(b){k++;if(8!=b.get("statoInvio")&&9!=b.get("statoInvio"))return!0});
if(null==f.getAt(k).get("al"))return Messaggio("ATTENZIONE",traduci("FAR_PRATICA_APERTA"),"OK","WARNING"),controller_abilitaBottoni(c),!1;f=traduci("FAR_COPIA_PRATICA")+" "+f.getAt(0).get("annoNumPratica");Messaggio("INFO",f,"YESNO","QUESTION","",function(){controller_nuovoRecord(c,d);b.impostaNuovo(!0)},function(){controller_nuovoRecord(c,d);b.impostaNuovo(!1)})}else controller_nuovoRecord(c,d),b.impostaNuovo(!1)},elimina:function(){var b=this,c=b.getFRDatiForm(),d=c.getForm(),f=d.findField("idPratica").getValue(),
g=b.getCbStatoInvio().getValue();!Ext.isEmpty(f)&&g&&("T"==g||"8"==g||"9"==g?controller_eliminaRecord(c.store,{idPratica:f},function(){b.aggiornaStore()},null,traduci("FR_ELIMINA_PRATICA")):Messaggio("ELIMINA",traduci("MSG_ELIMINA"),"YESNO","QUESTION","",function(){d.setValues({statoInvio:"8"});b.salva()}))},verificaCampiForm:function(){var b=[],c=this.getFRDatiForm().getForm(),d=new Date(currRicovero.dataDal),f=currRicovero.dataAl?new Date(currRicovero.dataAl):null,g=c.findField("dal").getValue(),
h=c.findField("al").getValue(),k=c.findField("motChiusura").getValue();[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso)&&(g=c.findField("dalSdo").getValue(),h=c.findField("alSdo").getValue(),k=c.findField("motChiusuraSdo").getValue());c.isValid()||!this.controllerSdo||this.controllerSdo.validFormSdo()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");c.isValid()||(this.tipoFlusso!=this._FAR_VENETO||508!=currRicovero.servizio.codAsl)&&this.tipoFlusso!=this._CURE_PALLIATIVE_RES_LOMBARDIA||
msgAddError(b,"MSG_CAMPI_OBBLIGATORI");c.isValid()||this.tipoFlusso!=this._FAR_VENETO||508!=currRicovero.servizio.codAsl||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");if(h&&(g>h&&msgAddError(b,"MSG_DATADAL_MAGGIORE_DATAAL"),k||msgAddError(b,"FR_MOTIVOCHIUSURA_OBBLIGATORIO"),[this._SCDI_LOMBARDIA,this._ODC_VENETO].includes(this.tipoFlusso)&&!c.findField("esitoCongedo").getValue()&&msgAddError(b,"FR_ESITOCONGEDO_OBBLIGATORIO"),[this._CURE_PALLIATIVE_RES_LOMBARDIA,this._CURE_PALLIATIVE_RES_VENETO].includes(this.tipoFlusso))){c.findField("ss1").allowBlank=
!1;c.findField("ssp1").allowBlank=!1;c.findField("ssp2").allowBlank=!1;c.findField("prestazione1").allowBlank=!1;var l=!0;Ext.each(c.getFields().items,function(b){b.validate()||l&&(l=!1)});l||msgAddError(b,"FR_DATI_VALUTAZIONE_OBBLIGATORI")}(g<d.setHours(0,0,0,0)||!Ext.isEmpty(f)&&g>f.setHours(23,59,59,0))&&msgAddError(b,"FR_DATAINIZIO_PRATICA_NON_VALIDA1");1<=this.getGridPratiche().getStore().count()&&![this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso)&&
(d=this.getGridPratiche().getSelectionModel().getSelection()[0],d=0<c.findField("idPratica").getValue()?this.getGridPratiche().getStore().indexOf(d):-1,d=null!=this.getGridPratiche().getStore().getAt(d+1)?this.getGridPratiche().getStore().getAt(d+1).get("al"):null,null!=d&&g<d&&msgAddError(b,"FR_DATAINIZIO_PRATICA_NON_VALIDA2"));if(![this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA,this._ODC_VENETO,this._FILEC_MARCHE,this._FILER_MARCHE,this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso)){g=
c.findField("data");isValidDate(g)&&(isValidDate(c.findField("dal"))&&g.getValue()<c.findField("dal").getValue()||isValidDate(c.findField("al"))&&g.getValue()>c.findField("al").getValue()||!Ext.isEmpty(f)&&g.getValue()>f.setHours(23,59,59,0))&&msgAddError(b,"FR_DATA_VALUTAZIONE_NON_VALIDA");f=["-1"];for(g=1;10>=g;g++)f.push(c.findField("prestazione"+g).getValue());c=traduci("FR_PRESTAZIONI_UGUALI");d=traduci("FR_PRESTAZIONI_BUCO");h=0;for(g=1;9>=g;g++)if(null!=f[g])for(h!=g-1&&msgAddError(b,d+" "+
h+" e "+g),h=g,k=g+1;10>=k;k++)null!=f[k]&&f[g]==f[k]&&msgAddError(b,c+" "+g+" e "+k);null!=f[10]&&9>h&&msgAddError(b,"Rilevato buco tra prestazione "+h+" e 10")}return msgShow("",b)},leggiDatiForm:function(){var b=this.getFRDatiForm().getForm().getFieldValues(),c,d,f,g,h;d=[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso);var k=[this._FILEC_MARCHE,this._FILER_MARCHE].includes(this.tipoFlusso);c=this.getFRDatiForm().getForm().findField("statoInvio").getValue();
var l=this.getFRDatiForm().getForm().findField("aCaricoFSR").getValue();f=d||k?null:this.getFRDatiForm().getForm().findField("data").getValue();k=d||k?null:this.getFRDatiForm().getForm().findField("tipoValutazione").getValue();this.forzaStatoInvio||"F"!=c||(c="M");c={idPratica:b.idPratica,idRicovero:currRicovero.idRicovero,annoPratica:b.annoPratica,numPratica:b.numPratica,codStruttura:b.codStruttura,codStrutturaDestinazione:Ext.isEmpty(b.codStrutturaDestinazione)?null:b.codStrutturaDestinazione,tipoFlusso:this.tipoFlusso,
dal:d?this.controllerSdo.getDataDalSdo():b.dal,al:d?this.controllerSdo.getDataAlSdo():b.al,aCaricoFSR:b.aCaricoFSR||l?"T":"F",statoInvio:c,motApertura:b.motApertura,motChiusura:b.motChiusura,esitoCongedo:b.esitoCongedo,soggettoPagante:b.soggettoPagante,valutazioneRichiesta:b.valutazioneRichiesta,tipoPostoLetto:b.tipoPostoLetto,codiceTipologiaUtente:b.codiceTipologiaUtente,tipologiaAssistenza:b.tipologiaAssistenza,tipoProvenienzaUtente:b.tipoProvenienzaUtente,classificazioneUtente:b.classificazioneUtente};
if(d){l=this.controllerSdo.leggiDatiFormSdo();d={};f={};if(!l)return;g=this.controllerSdo.leggiDatiFormSdoCompilatore();g.annullaPratica&&Ext.apply(c,{statoInvio:8});delete g.annullaPratica;g&&Ext.apply(d,g);Ext.apply(d,{idValutazioneREG:b.idValutazioneREG,tipoValutazione:d&&d.tipoValutazione?d.tipoValutazione:999,idRicoveroCU:currRicovero.idRicovero,idRicovero:currRicovero.idRicoveroCSS,idPratica:b.idPraticaSdo});g=this.controllerSdo.getFormSdo().recPresaInCarico;Ext.apply(g,{idTipoProvenienza:l.tipoProvenienzaUtenteSdo,
tipoRicovero:l.tipoRicovero,onereDegenza:l.onereDegenza,regimeRicovero:l.regimeRicovero,motivoIngresso:l.motivoIngresso,classePrioritaria:l.classePrioritaria});if(h=this.controllerSdo.getFormSdo().recParamSanitari)Ext.apply(h,{diagnosiIngresso:l.diagnosiIngresso,diagnosiIngressoICD9:l.diagnosiIngressoICD9}),delete h.proroghe;b=null;k=this.getFRDatiForm().getForm().findField("onereDegenza").getStore();l.onereDegenza&&(b=(b=k?trovaRecord(k,"codice",l.onereDegenza):!1)&&null!=b.get("valore")?b.get("valore"):
null);Ext.apply(c,{aCaricoFSR:null!=b&&["4.","9."].includes(b.substring(0,2))?"F":"T"});delete l.idTipoProvenienza;delete l.tipoRicovero;delete l.onereDegenza;delete l.classePrioritaria;delete l.regimeRicovero;delete l.motivoIngresso;delete l.diagnosiIngresso;delete l.diagnosiIngressoICD9;delete l.tipoProvenienzaUtenteSdo;delete l.insertData;Ext.apply(c,l);b=this.getCntValutazioni().down("#Sdo_Dimissione").controller.leggiDatiTab();Ext.apply(c,b)}else d={idValutazioneREG:b.idValutazioneREG,idRicovero:currRicovero.idRicovero,
idPratica:b.idPratica,data:b.data?b.data:f,tipoValutazione:b.tipoValutazione?b.tipoValutazione:k,patologia1:b.patologia1?b.patologia1.toUpperCase():null,patologia2:b.patologia2?b.patologia2.toUpperCase():null,patologia3:b.patologia3?b.patologia3.toUpperCase():null,patologia4:b.patologia4?b.patologia4.toUpperCase():null,patologia5:b.patologia5?b.patologia5.toUpperCase():null,patologia6:b.patologia6?b.patologia6.toUpperCase():null,note:b.note},f={idValutazioneHSP:b.idValutazioneHSP,idValutazioneREG:b.idValutazioneREG,
ss1:b.ss1?b.ss1.toUpperCase():null,ss2:b.ss2?b.ss2.toUpperCase():null,mnc1:b.mnc1?b.mnc1.toUpperCase():null,mnc2:b.mnc2?b.mnc2.toUpperCase():null,ssp1:b.ssp1?b.ssp1.toUpperCase():null,ssp2:b.ssp2?b.ssp2.toUpperCase():null,sss1:b.sss1?b.sss1.toUpperCase():null,sss2:b.sss2?b.sss2.toUpperCase():null,prestazione1:b.prestazione1,prestazione2:b.prestazione2,prestazione3:b.prestazione3,prestazione4:b.prestazione4,prestazione5:b.prestazione5,prestazione6:b.prestazione6,prestazione7:b.prestazione7,prestazione8:b.prestazione8,
prestazione9:b.prestazione9,prestazione10:b.prestazione10};return[c,d,f,g,h]},salva:function(b){var c=this,d=c.leggiDatiForm();if(!this.verificaCampiForm())return!1;var f=c.getIdPratica().getValue();b=d[0];var g=d[1],h=d[2],k=[],l=!0,n=null===f||0>=f?"new":"update";if(c.chiusuraForzata&&!c.motivoDimForzato)return Messaggio("ATTENZIONE",traduci("FR_MSG_ERROR_MOTIVO_CHIUSURA_PRECEDENTE_ERRATO"),"OK","ERROR"),c.chiusuraForzata=!1,c.impostaDati(c.getGridPratiche().getSelectionModel().getSelection()[0]),
!1;c.currentNumPratica=b.numPratica;c.currentAnnoPratica=b.annoPratica;Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/fr/pratiche/"+n,method:"POST",jsonData:b,async:!1,params:{idPraticaPrecedente:c.chiusuraForzata?c.getGridPratiche().getSelectionModel().getSelection()[0].get("idPratica"):0,motivoChiusura:c.chiusuraForzata?c.motivoDimForzato:0},success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){if(null===f||0>=f)f=b.data.idPratica,Ext.apply(g,{idPratica:f});if(![c._SOSIA_LOMBARDIA,
c._SDORIA_LOMBARDIA,c._SCDI_LOMBARDIA,c._FILEC_MARCHE,c._FILER_MARCHE,c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(c.tipoFlusso)){var n=c.salvaValutazione(g,h,k,l);0<n.length&&(k=k.concat(n),l=!1)}[c._SDOFIM_ALTOADIGE,c._SDO_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(c.tipoFlusso)&&(g&&(n=c.salvaValutazione(g,h,k,l),0<n.length&&(k=k.concat(n),l=!1)),0<c.salvaPresaIncaricoParamSanitari(d[3],d[4],k,l).length&&(l=!1));l&&(msgAdd(k,b.message),c.aggiornaStore(f));c.currentNumPratica!=
b.data.numPratica&&msgShowWarning("ATTENZIONE",[{tipo:1,testo:Ext.String.format(traduci("FR_WARNING_NUMERO_PRATICA_AGGIORNATO"),c.currentAnnoPratica+"-"+c.currentNumPratica)}])}else msgAdd(k,b.message),l=!1}});l?msgShow("MSG_SALVATAGGIO_DATI",k):(controller_abilitaBottoni(c.getFRDatiForm()),msgShowError("MSG_SALVATAGGIO_DATI",k));return l},salvaValutazione:function(b,c,d,f){var g=this;f="";var h=Ext.isEmpty(b.idValutazioneREG)||0>=b.idValutazioneREG?"new":"update";f=getUrlGen()+"/ws/genOsp/fr/valutazioni/";
[g._SDOFIM_ALTOADIGE,g._SDO_ALTOADIGE,g._SDERIA_ALTOADIGE].includes(g.tipoFlusso)&&(49!=CBA.moduli.moduloAttivo?(void 0==b.insertData&&(h=new Date,b.insertData=h,b.data=h),Ext.apply(b,{idValutazioneREG:b.id,idRicoveroCSS:b.idRicovero,idRicovero:b.idRicoveroCU}),delete b.id,delete b.idRicoveroCU,h=Ext.isEmpty(b.idValutazioneREG)||0>=b.idValutazioneREG?"new":"update"):(h=Ext.isEmpty(b.id)||0>=b.id?"new":"update",f="/cba/css/cs/ws/schedeRegionali/valutazioni/"));Ext.Ajax.request({url:f+h,method:"POST",
jsonData:b,async:!1,success:function(f){f=Ext.JSON.decode(f.responseText);f.success?(f=f.data.idValutazioneREG,Ext.apply(b,{idValutazioneREG:f}),c&&![g._SDOFIM_ALTOADIGE,g._SDO_ALTOADIGE,g._SDERIA_ALTOADIGE,g._FILEC_MARCHE,g._FILER_MARCHE].includes(g.tipoFlusso)&&(Ext.apply(c,{idValutazioneREG:f}),f=g.salvaValutazioneHSP(c,d),0<f.length&&(d=d.concat(f)))):msgAdd(d,f.message)}});return d},salvaValutazioneHSP:function(b,c){var d=Ext.isEmpty(b.idValutazioneHSP)||0>=b.idValutazioneHSP?"new":"update";
Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/fr/valutazioniHSP/"+d,method:"POST",jsonData:b,async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success||msgAdd(c,b.message)}});return c},salvaPresaIncaricoParamSanitari:function(b,c,d,f){var g=49==CBA.moduli.moduloAttivo?this.cbaConfig.controller.cbaConfig.recRicovero:this.cbaConfig.recRicovero,h=[];b&&(Ext.apply(b,{dataRichiestaRicovero:(new Date(b.dataRichiestaRicovero)).getTime(),dataRicezioneRichiesta:(new Date(b.dataRicezioneRichiesta)).getTime(),
dataValutazioneRichiesta:(new Date(b.dataValutazioneRichiesta)).getTime()}),delete b.tipoProvenienzaUtenteSdo,h.push({dati:b,tipo:1}));c&&(Ext.apply(c,{dataDimissionePrevista:(new Date(c.dataDimissionePrevista)).getTime()}),h.push({dati:c,tipo:4}));h&&(Ext.apply(g,{altreInfo:h}),g.parametriRegionali&&delete g.parametriRegionali,delete g.dataDimissionePrevista,delete g.servDesc,delete g.classificazionePresente);Ext.isEmpty(g.praticaSDOConvalidata)||delete g.praticaSDOConvalidata;f&&Ext.Ajax.request({url:getUrlGen()+
"/ws/genOsp/ricoveri/update",method:"POST",jsonData:g,async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success||(msgAdd(d,b.message),SalvataggioOK=!1)}});return d},impostaDati:function(b){this.getGridPratiche().setDisabled(!1);clearForm(this.getFRDatiForm());if(b){this.getTipologiaUtente().setValue(traduci("FR_DATO_KO"));"Errore1"===b.get("tipologiaUtente")?this.getInfoTipologiaUtente().setTooltip(traduci("FR_TIPOLOGIA_UTENTE_KO1_TOOLTIP")):"Errore2"===b.get("tipologiaUtente")?this.getInfoTipologiaUtente().setTooltip(traduci("FR_TIPOLOGIA_UTENTE_KO2_TOOLTIP")):
"Errore3"===b.get("tipologiaUtente")?this.getInfoTipologiaUtente().setTooltip(traduci("FR_TIPOLOGIA_UTENTE_KO3_TOOLTIP")):"Errore4"===b.get("tipologiaUtente")?this.getInfoTipologiaUtente().setTooltip(traduci("FR_TIPOLOGIA_UTENTE_KO4_TOOLTIP")):this.getTipologiaUtente().setValue(b.get("tipologiaUtente"));[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso)?(this.controllerSdo.impostaDatiSdo(b),this.controllerSdo.loadPresaInCaricoParamSan(b)):this.getFRDatiForm().loadRecord(b);
this.filtraStoreClassifUtente();var c=this.getCmpBtn().queryById("btnElimina");49==CBA.moduli.moduloAttivo&&(c||(c=this.getCmpBtn().queryById("BtnElimina")));var d=b.get("statoInvio");c.setDisabled(8==d||9==d);this.getNumeroPratica().setReadOnly("T"!=d);[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE,this._FILEC_MARCHE,this._FILER_MARCHE].includes(this.tipoFlusso)||this.getCntValutazioni().items.items[0].controller.aggiornaStore(b.get("idPratica"))}this.setToolTipPratica(b)},aggiornaStore:function(b){var c=
this,d=c.getGridPratiche().getStore();d.load({params:{idRicovero:currRicovero.idRicovero},callback:function(f,g,h){h?(g=c.getBtnStampaDati(),49==CBA.moduli.moduloAttivo&&(g=c.getCmpBtn().queryById("btnStampa")),Ext.isEmpty(f)?(clearForm(c.getFRDatiForm()),svuotaStore(c.getGridPratiche().getStore()),f=c.getCntValutazioni(),[c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(c.tipoFlusso)?49==CBA.moduli.moduloAttivo?(c.controllerSdo.enableFormSdoCss(!1),c.controllerSdo.abilitaBottoniCss(!1)):
c.getCntDatiPrincipali().setDisabled(!0):(c.tipoFlusso==c._SOSIA_LOMBARDIA?(svuotaStore(f.down("#GridValutazioneSosia").getStore()),svuotaStore(f.down("#GridTariffeSosia").getStore())):[c._FILEC_MARCHE,c._FILER_MARCHE].includes(c.tipoFlusso)||svuotaStore(f.items.items[0].controller.getGridValutazioni().getStore()),c.getCntDatiPrincipali().setDisabled(!0)),f.setDisabled(!0),g.setDisabled(!0)):(c.chiusuraForzata=!1,c.cambioTipoPostoletto=null,c.getCbProvenienzaUtente().setReadOnly(!1),b||(b=c.getIdPratica().getValue()),
f=trovaRecord(d,"idPratica",b),h=c.getGridPratiche(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(f?[f]:0),g&&![c._FAR_VENETO,c._SDORIA_LOMBARDIA,c._ODC_VENETO].includes(c.tipoFlusso)&&g.setDisabled(!1))):msgShowError("",g.getError())}});c.forzaStatoInvio=!1},loadCombo:function(b){[this._FAR_VENETO,this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA].includes(b)&&(this.getCbValutazioneRichiesta().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche})),this.getCbValutazioneRichiesta().getStore().filter({filterFn:function(b){return"VR"==
b.data.extra?!0:!1}}),this.getCbTipoPostoLetto().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche})),this.getCbTipoPostoLetto().getStore().filter({filterFn:function(b){return"PL"==b.data.extra?!0:!1}}));[this._FAR_VENETO,this._ODC_VENETO].includes(b)&&(this.getCbSoggettoPagante().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche})),this.getCbSoggettoPagante().getStore().filter({filterFn:function(b){return"PGN"==b.data.extra?!0:!1}}));[this._SCDI_LOMBARDIA,
this._ODC_VENETO].includes(b)?(this.getCbEsitoCongedo().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche})),this.getCbEsitoCongedo().getStore().filter({filterFn:function(b){return"EF"==b.data.extra?!0:!1}})):(this.getCbMotivoApertura().bindStore(Ext.create("Ext.data.ChainedStore",{source:this.storeCodifiche})),this.getCbMotivoApertura().getStore().filter({filterFn:function(b){return"MR"==b.data.extra?!0:!1}}));[this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA].includes(b)&&this.getCbClassifUtente().bindStore(Ext.create("Ext.data.ChainedStore",
{source:this.storeCodifiche}))},getIcdByCode:function(b,c){var d={tipoIcd:3,codice:b};2>d.codice.length?c.setValue(""):Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/icd9/search",params:d,async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?c.setValue(1==b.data.length?b.data[0].valore:""):msgShowError("",b.message)}})},checkAbilitaCampi:function(b){this.getFlagFSR().setDisabled(b===this._CURE_PALLIATIVE_RES_VENETO);this.getFlagFSR().setVisible(![this._FAR_VENETO,this._SOSIA_LOMBARDIA,
this._SCDI_LOMBARDIA].includes(b));this.getTipologiaUtente().setDisabled(b===this._CURE_PALLIATIVE_RES_VENETO);this.getInfoTipologiaUtente().setDisabled(b===this._CURE_PALLIATIVE_RES_VENETO);var c=this.getCbMotivoApertura();c.setVisible(![this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA,this._ODC_VENETO].includes(b));c.allowBlank=[this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA,this._ODC_VENETO].includes(b);this.getCbEsitoCongedo().setVisible([this._SCDI_LOMBARDIA,this._ODC_VENETO].includes(b));this.getCbValutazioneRichiesta().setVisible([this._FAR_VENETO,
this._SCDI_LOMBARDIA].includes(b));this.getCbValutazioneRichiesta().allowBlank=![this._FAR_VENETO,this._SCDI_LOMBARDIA].includes(b);c=this.getCbTipoPostoLetto();c.setVisible([this._FAR_VENETO,this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA].includes(b));c.allowBlank=![this._FAR_VENETO,this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA].includes(b);var d=this.getCbSoggettoPagante();d.setVisible([this._FAR_VENETO,this._ODC_VENETO].includes(b));d.allowBlank=b!==this._FAR_VENETO;b===this._ODC_VENETO&&(d.setMargin("0 0 0 100"),
d.labelWidth=145,d.setFlex(1));[this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA].includes(b)&&(c.setMargin(0),b===this._SOSIA_LOMBARDIA?(c=this.getTipologiaAssistenza(),c.allowBlank=!1,c.show(),this.getCbClassifUtente().show(),this.getCbStatoInvio().hide(),c=this.getCbProvenienzaUtente(),c.allowBlank=!1,c.show()):b==this._SCDI_LOMBARDIA&&(this.getCntContainer1().setMargin(0),this.getTipologiaUtente().hide(),this.getInfoTipologiaUtente().hide()));[this._FILEC_MARCHE,this._FILER_MARCHE].includes(this.tipoFlusso)&&
(this.getCbStatoInvio().hide(),this.getCbMotivoApertura().hide(),this.getCbMotivoApertura().allowBlank=!0,this.getFlagFSR().hide(),this.getTipologiaUtente().hide(),this.getInfoTipologiaUtente().hide(),c=this.getTipologiaAssistenza(),c.setMargin("0 0 0 -10"),c.allowBlank=!1,c.show(),this.getCntValutazioni().hide());c=this.getCntValutazioni();[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE,this._FILEC_MARCHE,this._FILER_MARCHE].includes(b)?c.setTitle(null):(c=c.items.items[0].controller,
c.getDataValutazione().setDisabled(b===this._CURE_PALLIATIVE_RES_VENETO),c.getDataValutazione().allowBlank=[this._CURE_PALLIATIVE_RES_VENETO,this._FAR_VENETO,this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA,this._ODC_VENETO].includes(b),c.getCbTipoValutazione().setDisabled(b===this._CURE_PALLIATIVE_RES_VENETO),c.getCbTipoValutazione().allowBlank=[this._CURE_PALLIATIVE_RES_VENETO,this._FAR_VENETO,this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA,this._ODC_VENETO].includes(b),d=c.getCntSchede(),d.setDisabled(b!==
this._CURE_PALLIATIVE_RES_VENETO),d.tab.setVisible(b==this._CURE_PALLIATIVE_RES_VENETO),c.getEdtPatologia1().allowBlank=[this._FAR_VENETO,this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA,this._ODC_VENETO].includes(b),[this._FAR_VENETO,this._ODC_VENETO].includes(b)?(c.getPnlGridValutazioni().setVisible(!1),c.getHeaderValutazione().setVisible(!1),c.getCntPatologie().tab.setVisible(!1),c.getCntSintomi().tab.setVisible(!1),c.getCntPrestazioni().tab.setVisible(!1),c.getCntValutazioni().setMargin(0),c.getTabValutazione().setActiveTab(3)):
(c.getHeaderValutazione().setVisible(b===this._CURE_PALLIATIVE_RES_LOMBARDIA&&c.getDataValutazione().getValue()),c.getCntSvama().tab.setVisible(!1)))},requestCodiceTipologiaUtente:function(b,c){null==c&&(c=0);return new Promise(function(d,f){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/fr/codTipUte/get",params:{idRicovero:currRicovero.idRicovero,data:b,tipAss:c},success:function(b){(b=Ext.JSON.decode(b.responseText))?d(b):f()}})})},setToolTipPratica:function(b){b=void 0===b?null:b;var c=
this;if([this._SOSIA_LOMBARDIA,this._SCDI_LOMBARDIA].includes(this.tipoFlusso)){var d=b?b.get("idPratica"):0;(new Promise(function(b,g){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/fr/infoAgg/pratica",params:{idRicovero:currRicovero.idRicovero,idPratica:d,tipoflusso:c.tipoFlusso},success:function(c){(c=Ext.JSON.decode(c.responseText))&&c.success?b(c):g(c?c.message:"ERRORE")}})})).then(function(b){if(b&&b.data){b=new Ext.data.Model(b.data);var d=FormattaData(b.get("dataEventoIndiceSV")),
f=b.get("situazionePensionistica")?b.get("situazionePensionistica"):"<b>NON COMPILATO</b>",k=b.get("professioneIngresso")?b.get("professioneIngresso"):"<b>NON COMPILATO</b>",l=b.get("diagnosiDimissione")?b.get("diagnosiDimissione"):"";iniziativaRichiesta=b.get("iniziativaRichiesta")?b.get("iniziativaRichiesta"):"";motivoAperturaPratica=b.get("motivoAperturaPratica")?b.get("motivoAperturaPratica"):"";provenienzaUtente=b.get("provenienzaUtente")?b.get("provenienzaUtente"):"";var n="";c.tipoFlusso==
c._SOSIA_LOMBARDIA?n='\n\t\t\t\t\t\t<div style="padding: 5px"><span class="cbaLabel">'+c.FR_DATA_EVENTO_INDICE_SV+" : </span>"+d+'</div>\n\t\t\t\t\t\t<div style="padding: 5px"><span class="cbaLabel">'+c.FR_SITUAZIONE_PENSIONISTICA+" : </span>"+f+'</div>\n\t\t\t\t\t\t<div style="padding: 5px"><span class="cbaLabel">'+c.FR_PROFESSIONE_INGRESSO+" : </span>"+k+'</div>\n\t\t\t\t\t\t<div style="padding: 5px"><span class="cbaLabel">'+c.FR_DIAGNOSI_DIMISSIONE+" : </span>"+l+"</div>\n\t\t\t\t\t":c.tipoFlusso==
c._SCDI_LOMBARDIA&&(n='\n\t\t\t\t\t\t<div style="padding: 5px"><span class="cbaLabel">'+c.FR_INIZIATIVA_RICHIESTA+" : </span>"+iniziativaRichiesta+'</div>\n\t\t\t\t\t\t<div style="padding: 5px"><span class="cbaLabel">'+c.FR_MOTIVO_APERTURA_PRATICA+" : </span>"+motivoAperturaPratica+'</div>\n\t\t\t\t\t\t<div style="padding: 5px"><span class="cbaLabel">'+c.FR_PROVENIENZA_UTENTE+" : </span>"+provenienzaUtente+"</div>\n\t\t\t\t\t");c.getInfoPratica().setTooltip("\n\t\t\t\t\t"+n+"\n\t\t\t\t");c.tipoFlusso==
c._SOSIA_LOMBARDIA&&(-1<f.indexOf("<b>NON COMPILATO</b>")||-1<k.indexOf("<b>NON COMPILATO</b>"))&&c.getInfoPratica().setIconCls("icon-grado-istruzione-ko");b.destroy()}})["catch"](function(b){return msgShowError("",b)})}},enableForm:function(b){this.getCntDatiPrincipali().setDisabled(!b);this.getGridPratiche().setDisabled(!b);this.getBoxBottoni().setDisabled(!b)},getCmpBtn:function(){return 49==CBA.moduli.moduloAttivo&&[this._SDO_ALTOADIGE,this._SDOFIM_ALTOADIGE,this._SDERIA_ALTOADIGE].includes(this.tipoFlusso)?
this.controllerSdo.getBoxBottoniCss():this.getBoxBottoni()},gestioneSDO:function(){var b=this.getPnlUp(),c=this.getCntDatiExtraPratica(),d=this.getCntDatiExtraPraticaSdo();this.getCntValutazioni();b.setHeight(325);b=Ext.create("GeneraliOSP.portlet.view.FlussiRegionaliSDO",{cbaConfig:{controllerMain:this,tipoFlusso:this.tipoFlusso,recList:this.cbaConfig.recList}});d.add(b);d.setHidden(!1);d.setDisabled(!1);c.setDisabled(!0);c.setHidden(!0)},onLaunch:function(){var b=this,c=this,d=c.getCbStatoInvio(),
f=c.getCbMotivoChiusura();store_motivo_chiusura=null;myForm=c.getFRDatiForm();c.chiusuraForzata=!1;c.motivoDimForzato=null;c.tipoProvenienzaForzato=null;c.cambioTipoPostoLetto=null;c.tipoFlusso=currRicovero.servizio.tipoFlusso;c.sbloccaStatoInvio=!1;c.storeCodifiche=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/fr/codifiche/cbox"}});if([c._SOSIA_LOMBARDIA,c._SCDI_LOMBARDIA,c._FILEC_MARCHE,c._FILER_MARCHE].includes(c.tipoFlusso)){var g=c.getTipologiaAssistenza(),
h=Ext.create("GeneraliOSP.fascicoloNoApp.store.TipoRicovero");store_motivo_chiusura=Ext.create("GeneraliOSP.fascicoloNoApp.store.MotivoDimissione");ImpostaUrl([h,store_motivo_chiusura]);g.bindStore(h);loadStore(h,{idServizio:currRicovero.idServizio});[c._SOSIA_LOMBARDIA,c._SCDI_LOMBARDIA].includes(this.tipoFlusso)&&(c.getInfoPratica().show(),this.tipoFlusso==c._SOSIA_LOMBARDIA&&(g=Ext.create("GeneraliOSP.fascicoloNoApp.store.TipoProvenienza"),ImpostaUrl([g]),c.getCbProvenienzaUtente().bindStore(g),
loadStore(g,{idServizio:currRicovero.idServizio,tipoFlusso:this.tipoFlusso})))}[c._SOSIA_LOMBARDIA,c._SCDI_LOMBARDIA].includes(this.tipoFlusso)||(store_motivo_chiusura=Ext.create("Ext.data.ChainedStore",{source:c.storeCodifiche}));f.bindStore(store_motivo_chiusura);[c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(c.tipoFlusso)&&c.gestioneSDO();ImpostaUrl([c.getGridPratiche().getStore(),d.getStore()]);c.forzaStatoInvio=!1;f={conferma_callback:function(b){c.salva(b)},annulla_callback:function(){c.aggiornaStore()},
nuovo_callback:function(){c.nuovo()},elimina_callback:function(){49==CBA.moduli.moduloAttivo&&[c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(c.tipoFlusso)?c.controllerSdo.eliminaSdoCss():c.elimina()},esci_callback:function(){var b=myForm.up("window");controller_puoiUscire(b,myForm,function(){c.salva(!0)},function(){c.cbaConfig.controllerPortlet&&c.cbaConfig.controllerPortlet.updatePortlet&&c.cbaConfig.controllerPortlet.updatePortlet();b.close()},function(){c.cbaConfig.controllerPortlet&&
c.cbaConfig.controllerPortlet.updatePortlet&&c.cbaConfig.controllerPortlet.updatePortlet();b.close()})},stampa_dati:function(){c.btnStampaDatiClick()},verificaCampiForm_callback:function(){return c.verificaCampiForm()}};myForm.boxBottoni=c.getCmpBtn();myForm.store=c.getGridPratiche().getStore();myForm.controller=c;49==CBA.moduli.moduloAttivo?c.controllerSdo.addBtnCss(f):(f=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:f}),inserisciBottoni(c.getBoxBottoni(),f));f=Ext.create("Ext.container.Container",
{items:[{xtype:"button",itemId:"btnStampaDati",reference:"btnStampaDati",iconCls:"icon-stampa32",text:traduci("STAMPA"),scale:"small",width:100,margin:"0 0 5 0",hidden:49==CBA.moduli.moduloAttivo,disabled:49!=CBA.moduli.moduloAttivo}]});myForm.boxBottoni.insert(10,f);d.setReadOnly(c.cbaConfig.controllerPortlet&&!c.cbaConfig.controllerPortlet.cbaConfig.sbloccaStatoInvio);f=StdUtenti.promiseLoadStore(c.storeCodifiche,{tipoFlusso:c.tipoFlusso});g=StdUtenti.promiseLoadStore(d.getStore());h=null;[c._SOSIA_LOMBARDIA,
c._SCDI_LOMBARDIA].includes(this.tipoFlusso)?h=StdUtenti.promiseLoadStore(store_motivo_chiusura,{idServizio:currRicovero.idServizio,tipoFlusso:this.tipoFlusso}):[c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(this.tipoFlusso)||(h=new Promise(function(c,d){var f="MD";b.tipoFlusso==b._FAR_VENETO&&508==currRicovero.servizio.codAsl&&(f="MD_ULSS8");store_motivo_chiusura.filter({filterFn:function(b){return b.data.extra==f?!0:!1}});c(!0)}));Promise.all([f,g,h]).then(function(d){b.loadCombo(c.tipoFlusso);
c.aggiornaStore()})["catch"](function(b){return msgShowError("",b)});[c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(c.tipoFlusso)?(f=Ext.create("GeneraliOSP.portlet.view.FRValutazioni_Sdo",{flex:1,cbaConfig:{praticheController:c,idRicovero:currRicovero.idRicovero,idServizio:currRicovero.idServizio,idPratica:currRicovero.idPratica,data:c.controllerSdo.getDataDalSdo().getValue(),storeCodifiche:c.storeCodifiche,tipoFlusso:c.tipoFlusso}}),c.getCntValutazioni().header=!1,c.getCntValutazioni().add(f)):
[c._FILEC_MARCHE,c._FILER_MARCHE].includes(c.tipoFlusso)||(f=Ext.create("GeneraliOSP.portlet.view.FRValutazioni",{flex:1,cbaConfig:{praticheController:c,storeCodifiche:c.storeCodifiche,tipoFlusso:c.tipoFlusso}}),c.getCntValutazioni().add(f));c.checkAbilitaCampi(c.tipoFlusso);if("L"!=c.cbaConfig.permesso)myForm.getForm().on("dirtychange",function(b,f){controller_abilitaBottoni(myForm);if(8==d.getValue()||9==d.getValue()){var g=c.getCmpBtn().queryById("btnElimina");49==CBA.moduli.moduloAttivo&&(g||
(g=c.getCmpBtn().queryById("BtnElimina")));g.setDisabled(!0)}c.getGridPratiche().setDisabled(f);c.tipoFlusso==c._SOSIA_LOMBARDIA?c.getCntValutazioni().setDisabled(f):[c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(c.tipoFlusso)?49==CBA.moduli.moduloAttivo&&c.getCmpBtn().down("#BoxBottoniSpecial").query("#btnConvalidaManuale")[0].setDisabled(f):c.getCntValutazioni().items.items[0].controller.getGridValutazioni().setDisabled(f)});else containerSolaLettura(myForm),controller_bottoniSolaLettura(myForm.boxBottoni);
49==CBA.moduli.moduloAttivo&&[c._SDO_ALTOADIGE,c._SDOFIM_ALTOADIGE,c._SDERIA_ALTOADIGE].includes(c.tipoFlusso)&&c.cbaConfig.nuovoDefault&&Ext.defer(function(){c.getCmpBtn().queryById("btnNuovo").handler()},1E3)},destroy:function(){eliminaStore(this.storeCodifiche);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.FlussiRegionaliSDO",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"boxBottoniCss",selector:this.selContainer+"#boxBottoniCss"},{ref:"BoxBottoniSpecial",selector:this.selContainer+"#BoxBottoniSpecial"},{ref:"cntCompilatoreCss",selector:this.selContainer+"#cntCompilatoreCss"},{ref:"PnlCompilatore",selector:this.selContainer+"#PnlCompilatore"},{ref:"PanelRecordAnnullato",selector:this.selContainer+
"#PanelRecordAnnullato"},{ref:"formSdo",selector:this.selContainer+"#formSdo"},{ref:"DataDalSdo",selector:this.selContainer+"#DataDalSdo"},{ref:"DataAlSdo",selector:this.selContainer+"#DataAlSdo"},{ref:"CbMotivoChiusuraSdo",selector:this.selContainer+"#CbMotivoChiusuraSdo"},{ref:"idTipoProvenienza",selector:this.selContainer+"#idTipoProvenienza"},{ref:"CntIdc9",selector:this.selContainer+"#CntIdc9"},{ref:"idTipoRicovero",selector:this.selContainer+"#idTipoRicovero"},{ref:"IdMotivoIngresso",selector:this.selContainer+
"#IdMotivoIngresso"},{ref:"DiagnosiIngressoTxt",selector:this.selContainer+"#DiagnosiIngressoTxt"},{ref:"RegimeRicovero",selector:this.selContainer+"#RegimeRicovero"},{ref:"OnereDegenza",selector:this.selContainer+"#OnereDegenza"},{ref:"ClassePriorita",selector:this.selContainer+"#ClassePriorita"},{ref:"classeAsa",selector:this.selContainer+"#classeAsa"}]);this.control(this.selContainer+"#DataDalSdo",{change:this.changeDataDalSdo,blur:this.exitDataDalSdo});this.control(this.selContainer+"#DataAlSdo",
{change:this.changeDataAlSdo});this.control(this.selContainer+"#BtnIcd9",{click:this.onClickBtnIcd9});this.callParent(arguments)},onClickBtnIcd9:function(b){var c=this;openPopupVidetaFromLocal("Diagnosi di ingresso",null,null,null,null,null,function(){c.aggiornaStore()})},changeDataAlSdo:function(b,c,d,f){b=Ext.isEmpty(c);this.getCbMotivoChiusuraSdo().allowBlank=b},changeDataDalSdo:function(b,c,d,f){this.cbaConfig.controllerMain.changeDataDal(b,c,d,f)},exitDataDalSdo:function(b,c){this.cbaConfig.controllerMain.exitDataDal(b,
c)},loadStoreCmb:function(b){var c=this.getRegimeRicovero().getStore(),d=this.getClassePriorita().getStore(),f=this.getIdMotivoIngresso().getStore(),g=[this.getCbMotivoChiusuraSdo().getStore(),this.getIdTipoProvenienza().getStore(),this.getIdTipoRicovero().getStore(),this.getOnereDegenza().getStore(),c,d,f],h=[];c.rispostaParam={scheda:"V",domanda:110};d.rispostaParam={scheda:"V",domanda:111};f.rispostaParam={scheda:"V",domanda:102};ImpostaUrl(g);Ext.each(g,function(c){var d=new Promise(function(d,
f){var g={idServizio:b};c.rispostaParam&&Ext.apply(g,c.rispostaParam);c.load({params:g,callback:function(b,c,g){g?d(b):f(c)}})});h.push(d)});return Promise.all(h).then(function(b){})["finally"](function(){return Ext.emptyFn})["catch"](function(b){alert(b)})},loadPresaInCaricoParamSan:function(b){var c=this,d=[],f={idRicovero:currRicovero.idRicovero};d.push(StdUtenti.promiseGetRequest(getUrlGen()+"/ws/genOsp/parametriSanitari/get",parametri=f));d.push(StdUtenti.promiseGetRequest(getUrlGen()+"/ws/genOsp/parametriRegionali/get",
parametri=f));Promise.all(d).then(function(d){var f={},g=d[0];Ext.isEmpty(g)||(c.getFormSdo().recParamSanitari=g,Ext.apply(f,{ggPrognosi:g.ggPrognosi,diagnosiIngresso:g.diagnosiIngresso,diagnosiIngressoICD9:g.diagnosiIngressoICD9}));g=d[1];g.id&&(c.getFormSdo().recPresaInCarico=g,d=b&&null!=b.get("classeAsa")?b.get("classeAsa"):StdSipcar.coalesce(c.getClasseAsa().getValue(),0),Ext.apply(f,{tipoProvenienzaUtenteSdo:g.idTipoProvenienza,motivoIngresso:g.motivoIngresso,iniziativaRichiesta:g.iniziativaRichiesta,
onereDegenza:g.onereDegenza,tipoRicovero:g.tipoRicovero,regimeRicovero:g.regimeRicovero,classePrioritaria:g.classePrioritaria,classeAsa:d}));b?(Ext.apply(b.data,f),c.cbaConfig.controllerMain.getFRDatiForm().loadRecord(b)):c.getFormSdo().getForm().setValues(f)})["finally"](function(){return Ext.emptyFn})["catch"](function(b){alert(b)})},validFormSdo:function(){return this.getFormSdo().getForm().isValid()},aggiornaStore:function(){this.cbaConfig.controllerMain.aggiornaStore()},leggiDatiFormSdo:function(){var b=
this.getFormSdo().getForm().getFieldValues(),c;c={idPratica:b.idPraticaSdo,dal:b.dalSdo,al:b.alSdo,motChiusura:b.motChiusuraSdo};Ext.apply(c,b);delete c.id;delete c.idPraticaSdo;delete c.dalSdo;delete c.alSdo;delete c.prognosi;delete c.motChiusuraSdo;delete c.ggPrognosi;return c},leggiDatiFormSdoCompilatore:function(){var b=this.getCntCompilatoreCss(),c={};Ext.apply(c,{id:this.testataSelezionata,idRicovero:currRicovero.idRicovero,tipoValutazione:this.recSelected&&this.recSelected.tipoValutazione?
this.recSelected.tipoValutazione:999,compilatore:this.recSelected&&this.recSelected.compilatore?this.recSelected.compilatore:49==CBA.moduli.moduloAttivo?CBA.moduli.modulo49.operatore.id:CBA.parametriGenerali.codUtente});49==CBA.moduli.moduloAttivo&&(b=b.down("#PnlCompilatore"),Ext.apply(c,{data:b.getDataOraReg(),annullaPratica:this.annullaPratica}),this.annullaPratica=!1);return c},verificaFormPrimaDiConvalida:function(){return!0},impostaBloccoSchedaSdo:function(b){var c=!1,d=this.getFormSdo(),f=
this.cbaConfig.controllerMain.getCntValutazioni();b&&(c="T"==b.statoRecord&&null!=b.deletedData?!0:"M"==b.statoRecord?!0:!1);containerSolaLettura(d,c);containerSolaLettura(f,c);this.cbaConfig.controllerMain.getBoxBottoni().down("#btnElimina").setDisabled(c)},impostaBloccoSchedaSdoCss:function(b){var c=this.getPanelRecordAnnullato(),d=this.cbaConfig.controllerMain.getCntValutazioni();blocco=!1;c.hide();if(b){var f=!Ext.isEmpty(b.tipoBlocco[0])&&"A"===b.tipoBlocco[0].valore;if(f){var g=b.deletedData,
g=traduci("IL_GIORNO")+" "+Ext.Date.format(Ext.Date.parse(g,"c"),"d/m/Y")+" "+traduci("ALLE").toLowerCase()+" "+Ext.Date.format(Ext.Date.parse(g,"c"),"H:i");c.down("#LabelAnnullatoCompilatore").setText(b.compilatoreNominativo);c.down("#LabelAnnullatoData").setText(g);c.items.items[0].show();c.items.items[1].show();c.show()}blocco=f||"L"==this.getFormSdo().permesso?!0:cssHasBloccoModifica(b.tipoBlocco);containerSolaLettura(this.getFormSdo(),blocco);containerSolaLettura(d,blocco);c=this.getBoxBottoniCss();
b=c.down("#BoxBottoniSpecial").query("#btnConvalidaManuale")[0];c=c.down("#btnElimina");this.getFormSdo().cbaConfig.idTooltipLock&&(Ext.getCmp(this.getFormSdo().cbaConfig.idTooltipLock).destroy(),this.getFormSdo().cbaConfig.idTooltipLock=!1);d.cbaConfig.idTooltipLock&&(Ext.getCmp(d.cbaConfig.idTooltipLock).destroy(),d.cbaConfig.idTooltipLock=!1);blocco?(creaToolTipLock(this.getFormSdo(),f?"deleted":!1,!1),creaToolTipLock(d,f?"deleted":!1,!1)):c.textHint=traduci("ELIMINA");b.setHidden(!1);b.setDisabled(blocco);
c.setDisabled(f||"L"==this.getFormSdo().permesso)}blocco||(this.getFormSdo().cbaConfig.idTooltipLock&&(Ext.getCmp(this.getFormSdo().cbaConfig.idTooltipLock).destroy(),this.getFormSdo().cbaConfig.idTooltipLock=!1),d.cbaConfig.idTooltipLock&&(Ext.getCmp(d.cbaConfig.idTooltipLock).destroy(),d.cbaConfig.idTooltipLock=!1))},eliminaSdoCss:function(){var b=this,c=b.cbaConfig.controllerMain.getFRDatiForm(),d=this.recSelected?this.recSelected.id:null,f=this.recSelected?this.recSelected.idPratica:null,g=this.recSelected?
cssHasBloccoModifica(this.recSelected.tipoBlocco):!1;if(Ext.isEmpty(d))Messaggio("ATTENZIONE","NESSUNA_REGISTRAZIONE_SELEZIONATA","OK","QUESTION");else{var h=g?"T":"U",g=g?traduci("MSG_ANNULLA_SCHEDA"):traduci("MSG_ELIMINA_SCHEDA");Messaggio("ATTENZIONE",g,"YESNO","QUESTION",!1,function(){var g={};"T"==h?(c.store.proxy.api.destroy="/cba/css/cs/ws/schedeRegionali/valutazioni/delete",g={id:d,stato:h}):g={idPratica:f,stato:h};controller_eliminaRecord(c.store,g,function(){"U"==h?b.esciSdo():(b.annullaPratica=
!0,b.cbaConfig.controllerMain.salva(),b.aggiornaStore())},null,null,null,!0)},function(){return!1})}},loadPnlCompilatore:function(b){var c=this,d=c.getCntCompilatoreCss();params={idPratica:b.data.idPratica};url="/ws/genOsp/fr/valutazioni/search";c.testataSelezionata=null;c.recSelected=null;49==CBA.moduli.moduloAttivo&&(url="/ws/schedeRegionali/valutazioni/list",Ext.apply(params,{idRicovero:b.data.idRicovero,tipo:"SDO"}));StdUtenti.promiseGetRequest(getUrlGen()+url,parametri=params).then(function(f){if(f=
f[0])if(c.testataSelezionata=f.id,c.recSelected=f,49==CBA.moduli.moduloAttivo){var g=d.down("#PnlCompilatore"),h=f.compilatoreNominativo+"("+f.compilatoreFigProf+")",k=Ext.isDefined(f)?f.data:new Date,k={dataRegAppo:FormattaData(k),oraRegAppo:FormattaData(k,"H:i")};g.setLabelCompilatore(h);Ext.apply(b.data,k);c.impostaBloccoSchedaSdoCss(f)}else c.impostaBloccoSchedaSdo(f)})["finally"](function(){return Ext.emptyFn})["catch"](function(b){alert(b)})},nuovo:function(){if(49==CBA.moduli.moduloAttivo){var b=
this.getCntCompilatoreCss().down("#PnlCompilatore"),c=this.getPanelRecordAnnullato();b.setNuovoRecord();c.hide();b=this.cbaConfig.controllerMain.getCntValutazioni();containerSolaLettura(this.getFormSdo(),!1);containerSolaLettura(b,!1);this.getFormSdo().cbaConfig.idTooltipLock&&(Ext.getCmp(this.getFormSdo().cbaConfig.idTooltipLock).destroy(),this.getFormSdo().cbaConfig.idTooltipLock=!1);b.cbaConfig.idTooltipLock&&(Ext.getCmp(b.cbaConfig.idTooltipLock).destroy(),b.cbaConfig.idTooltipLock=!1);this.recSelected=
this.testataSelezionata=null}},impostaDatiSdo:function(b){var c=this.getFormSdo();clearForm(c);Ext.apply(b.data,{idSdo:b.data.id,idPraticaSdo:b.data.idPratica,dalSdo:b.data.dal,alSdo:b.data.al,motChiusuraSdo:b.data.motChiusura});this.loadPnlCompilatore(b);(c=this.cbaConfig.controllerMain.getCntValutazioni().down("#Valutazioni_Sosia").controller)&&c.aggiornaDati(b.data.idRicovero,b.data.idPratica);49==CBA.moduli.moduloAttivo&&this.getBoxBottoniSpecial().query("#btnConvalidaManuale")[0].setHidden(this.getPanelRecordAnnullato().isVisible())},
addBtnCss:function(b){var c={xtype:"CSSButtonsPanel",layout:{type:"hbox",pack:"end"},items:[{xtype:"cssBoxBottoniSpecial",itemId:"BoxBottoniSpecial",reference:"BoxBottoniSpecial",layout:{type:"hbox",pack:"start"}},{xtype:"button",itemId:"btnNuovo",reference:"btnNuovo",handler:b.nuovo_callback,disabled:!1},{xtype:"button",itemId:"btnElimina",reference:"btnElimina",handler:b.elimina_callback,disabled:!0},{xtype:"button",itemId:"btnConferma",reference:"btnConferma",handler:b.conferma_callback,disabled:!0},
{xtype:"button",itemId:"btnAnnulla",reference:"btnAnnulla",handler:b.annulla_callback,disabled:!0},{xtype:"button",itemId:"btnStampa",reference:"btnStampa",handler:b.stampa_dati,hidden:!1,disabled:!0},{xtype:"button",itemId:"btnEsci",reference:"btnEsci",nonDisabilitare:!0,handler:b.esci_callback}]};this.getBoxBottoniCss().add(c);this.esciSdo=b.esci_callback;this.storeForm=Ext.create("CS.portlet.store.Sosia");this.controllerForm={containerId:this.getFormSdo().up("container").id};this.verificaPrimaDiConvalida=
!0;cssAbilitaConvalida(this)},azionePostConvalida:function(){var b=this;b.cbaConfig.firmaDigitale&&Messaggio("Richiesta","Firmare digitalmente il documento appena convalidato?","YESNO","QUESTION",!1,function(){Ext.create("winCBA",{name:"CS.archsost.view.Credenziali",maximizable:!1,titolo:"Credenziali",larghezzaWin:300,altezzaWin:150,clsWin:"cbaCssBordoPopup",configItem:{permesso:"S",idTabella:292,idRecord:b.testataSelezionata,controllerTe:b}}).show()})},functionAfterFirma:function(){Messaggio("Firma digitale",
"Procedura di firma avviata con successo","OK","INFORMATION")},abilitaBottoniCss:function(b){if(49==CBA.moduli.moduloAttivo){var c=this.getBoxBottoniCss();c.down("#BoxBottoniSpecial").query("#btnConvalidaManuale")[0].setDisabled(b);c.down("#btnNuovo").setDisabled(b);c.down("#btnElimina").setDisabled(b);c.down("#btnConferma").setDisabled(!b);c.down("#btnAnnulla").setDisabled(!b||Ext.isEmpty(this.cbaConfig.recList)||this.cbaConfig.nuovoDefault);c.down("#btnStampa").setDisabled(b)}},enableFormSdoCss:function(b){this.getFormSdo().setDisabled(!b);
49==CBA.moduli.moduloAttivo&&this.getCntCompilatoreCss().setDisabled(!b)},onLaunch:function(){var b=this;b.testataSelezionata=null;var c=currRicovero?currRicovero.servizio.id:null,d=b.cbaConfig.controllerMain;d.controllerSdo=b;b.getCntIdc9().setHidden(!1);b.loadStoreCmb(c);if("L"!=b.cbaConfig.permesso)b.getFormSdo().getForm().on("dirtychange",function(c,g){49==CBA.moduli.moduloAttivo&&b.abilitaBottoniCss(g);d.getFRDatiForm().fireEvent("dirtychange")});49==CBA.moduli.moduloAttivo&&(b.getCntCompilatoreCss().add({xtype:"cssPanelCompilatore",
itemId:"PnlCompilatore",reference:"PnlCompilatore",docked:"top",cbaDataAllowBlank:!0,cbaOraAllowBlank:!0,border:0}),d.getPnlPratica().setHidden(!0),d.getPnlUp().setHeight(388),b.getFormSdo().setMinHeight(388),b.cbaConfig.firmaDigitale=!1,Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/archsost/verificafirmadigitale",params:{idTabella:292,idProfilo:CBA.parametriGenerali.idProfiloCss},success:function(c){c=Ext.JSON.decode(c.responseText);c.success&&(b.cbaConfig.firmaDigitale=c.data)}}))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.ListaAttesa",{extend:"Generali.standard.ViewController",init:function(){var b=this;b.selContainer="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:b.selContainer+"#Container"},{ref:"gridDomandeLA",selector:b.selContainer+"#gridDomandeLA"},{ref:"boxBottoni",selector:b.selContainer+"#boxBottoni"},{ref:"gridDomandeLAServ",selector:b.selContainer+"#gridDomandeLAServ"},{ref:"appo",selector:b.selContainer+"#appo"},{ref:"CBComune",
selector:b.selContainer+"#CBComune"},{ref:"Data",selector:b.selContainer+"#Data"},{ref:"DataRicezione",selector:b.selContainer+"#DataRicezione"},{ref:"DataPrevDimissione",selector:b.selContainer+"#DataPrevDimissione"},{ref:"ResponsabileRicoveroTxt",selector:b.selContainer+"#ResponsabileRicoveroTxt"},{ref:"MedicoAccettante",selector:b.selContainer+"#MedicoAccettante"},{ref:"CBProvenienza",selector:b.selContainer+"#CBProvenienza"},{ref:"GiorniPrognosi",selector:b.selContainer+"#GiorniPrognosi"},{ref:"CBInfoAgg",
selector:b.selContainer+"#CBInfoAgg"},{ref:"CBTipoDom",selector:b.selContainer+"#CBTipoDom"},{ref:"pnlDestra",selector:b.selContainer+"#pnlDestra"},{ref:"CBMotivazione",selector:b.selContainer+"#CBMotivazione"},{ref:"CBIniziativaRichiesta",selector:b.selContainer+"#CBIniziativaRichiesta"},{ref:"OnereDegenza",selector:b.selContainer+"#OnereDegenza"},{ref:"RegimeRicovero",selector:b.selContainer+"#RegimeRicovero"},{ref:"DiagnosiIngresso",selector:b.selContainer+"#DiagnosiIngresso"},{ref:"CntIdc9",selector:b.selContainer+
"#CntIdc9"},{ref:"ChkIndAccompagnamento",selector:b.selContainer+"#ChkIndAccompagnamento"},{ref:"percInvalidita",selector:b.selContainer+"#percInvalidita"},{ref:"tbRegole",selector:b.selContainer+"#tbRegole"},{ref:"pagePunteggi",selector:b.selContainer+"#pagePunteggi"},{ref:"pageRegole",selector:b.selContainer+"#pageRegole"},{ref:"classe",selector:b.selContainer+"#classe"},{ref:"CBServizio",selector:b.selContainer+"#CBServizio"},{ref:"dataAcc",selector:b.selContainer+"#dataAcc"},{ref:"ColStato",selector:b.selContainer+
"#ColStato"},{ref:"CBSituazDom",selector:b.selContainer+"#CBSituazDom"},{ref:"CBSituazRil",selector:b.selContainer+"#CBSituazRil"},{ref:"MedicoMedGen",selector:b.selContainer+"#MedicoMedGen"},{ref:"BtnMedico",selector:b.selContainer+"#BtnMedico"},{ref:"MedicoInviante",selector:b.selContainer+"#MedicoInviante"},{ref:"PrognosiDimissione",selector:b.selContainer+"#PrognosiDimissione"},{ref:"prefNumProt",selector:b.selContainer+"#prefNumProt"},{ref:"numProt",selector:b.selContainer+"#numProt"},{ref:"suffNumProt",
selector:b.selContainer+"#suffNumProt"}]);b.control(b.selContainer+"#gridDomandeLAServ",{select:b.selectServizio,deselect:b.deselectServizio,beforeedit:b.gridServBeforeEdit,edit:b.gridServEdit,canceledit:b.gridCancelEdit});b.control(b.selContainer+"#gridDomandeLA",{select:b.selectRegola});b.control(b.selContainer+"#tbRegole",{beforetabchange:b.beforeTabChange,tabchange:b.tabChange});b.control(b.selContainer+"#BtnMedico",{click:b.clickBtnMedico});b.control(b.selContainer+"#GiorniPrognosi",{change:b.changeGiorniPrognosi});
b.on({esci:function(){b.getContainer().boxBottoni.queryById("btnEsci").handler()}});b.on({changeTab:function(){return b.changeTab()}});b.control(b.selContainer+"#Data",{change:b.changeDataRichiesta})},changeDataRichiesta:function(){var b=this.getContainer().getForm().findField("id").getValue();isValidDate(this.getData())&&(Ext.isEmpty(b)||0>b)&&this.generaNumeroProtocollo()},changeGiorniPrognosi:function(){},clickBtnMedico:function(){var b=this.cbaConfig.controllerEditFascicolo;Ext.create("winCBA",
{name:"GeneraliOSP.medicoCurante.view.MedicoCurante",titolo:"GESTIONE_MEDICI",larghezzaWin:900,altezzaWin:350,configItem:{urlGen:!0,codOspite:this.cbaConfig.recRicovero.codOspite,permesso:b?b.cbaConfig.permesso:this.cbaConfig.permesso}}).show()},afterTabChange:function(){},changeTab:function(){var b=this,c;b.getPageRegole().isVisible()?c=b.getPageRegole().up("form"):b.getPagePunteggi().isVisible()&&(c=b.getPagePunteggi().down("form"));var d=c.up("window");c.getForm().isDirty()&&controller_puoiUscire(d,
c,function(){c.boxBottoni.queryById("btnConferma").handler()},function(){c.boxBottoni.queryById("btnAnnulla").handler();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){c.controller.aggiornaStore()})},isDirtyForm:function(){return this.getContainer().getForm().isDirty()},salvaSelezione:function(){this.selezionati=this.getGridDomandeLAServ().getSelectionModel().getSelection()},reimpostaSelezione:function(b){this.getGridDomandeLAServ().getSelectionModel().select(this.selezionati,
b,!0)},gridCancelEdit:function(){this.reimpostaSelezione(!1);this.disabilitaControlli=!1},gridServEdit:function(b,c,d){this.disabilitaControlli=!1;this.reimpostaSelezione(!0);this.getAppo().setValue(this.getAppo().getValue()+".")},gridServBeforeEdit:function(b,c,d){this.disabilitaControlli=!0;b=b.getEditor().getForm();d=b.findField("statoDom");Ext.isDefined(b.primaVolta)||(b.primaVolta=!0,d.bindStore(this.storeStatoInfo),d.on("select",this.selectStato,this));this.salvaSelezione();b=this.getColStato().getEditor().getStore();
c=trovaRecord(b,"codice",c.record.data.statoDom);b=!1;c&&(b="1"!=c.data.extra.split(",")[0]);this.abilitaCampiObbl(b)},tabChange:function(b,c,d,f){c==this.getPagePunteggi()?(b=this.getGridDomandeLA().getSelectionModel().getSelection()[0])&&this.view_punteggi.controller.update(b.get("id")):c==this.getPageRegole()&&this.aggiornaStore()},beforeTabChange:function(b,c,d,f){if((b=d.down("form"))&&b.isDirty())return Messaggio("Attenzione","MSG_DATI_DA_CONFERMARE_TAB","OK"),!1},selectRegola:function(b,c){this.getTbRegole().rendered?
(this.cbaConfig.recListaAttesa=c,this.impostaDati(c)):this.getTbRegole().getActiveTab()==this.getPagePunteggi()&&this.tabChange(!1,this.getPagePunteggi())},impostaDati:function(b){var c=this.getContainer(),d="",f=null;this.getGridDomandeLA().setDisabled(!1);clearForm(c);if(b){c.loadRecord(b);for(c=b.data.servizi.length-1;0<=c;c--)b.data.servizi[c].desServizio||b.data.servizi.splice(c,1);d=b.get("numProt");f=b.get("data")}"S"==this.numProtocolloAutomatico&&this.impostaNumProtFormatted(d,f,this.cbaConfig.recRicovero.servizio.sigla);
this.getMedicoMedGen().setReadOnly(b);this.aggiornaStoreRegoleServ(b)},mostraClasse:function(){var b=this.getGridDomandeLAServ(),c=!1;Ext.each(b.getSelectionModel().getSelection(),function(b){if(b.data.selezionato&&"L"==b.data.regioneServizio)return c=!0,!1});this.getClasse().setVisible(c)},selectServizio:function(b,c,d,f){c.set("selezionato","T");this.disabilitaControlli||this.getAppo().setValue(this.getAppo().getValue()+".");null==c.data.statoDom&&(c.data.statoDom=this.codAbilitato);this.mostraClasse();
this.getMedicoMedGen().setReadOnly(!0)},deselectServizio:function(b,c,d,f){c.set("selezionato","F");this.disabilitaControlli||this.getAppo().setValue(this.getAppo().getValue()+".");this.mostraClasse()},apriStoreInfo:function(b,c,d){if(!d)return!1;var f=this;b.load({params:{domanda:c},callback:function(b,d,k){if(k){if(5==c)for(var g in b)if("1"==b[g].data.extra.split(",")[0]){f.codAbilitato=b[g].data.codice;break}}else msgShowError("",d.getError())}})},abilitaCampiObbl:function(b){getColGrid(this.getGridDomandeLAServ(),
"dataAcc").getEditor().allowBlank=!b},selectStato:function(b,c,d){c&&(rec=trovaRecord(this.storeStatoInfo,"codice",c.data.codice),this.abilitaCampiObbl("1"!=rec.data.extra.split(",")[0]))},aggiornaStore:function(b){var c=this;c.store.load({params:{codOspite:c.cbaConfig.recRicovero.codOspite,idRicovero:c.cbaConfig.recRicovero.idRicovero},callback:function(d,f,g){g?(Ext.isEmpty(d)?c.impostaDati(!1):(b||(b=c.getContainer().getForm().findField("id").getValue()),d=trovaRecord(c.store,"id",b),f=c.getGridDomandeLA(),
f.getSelectionModel().deselectAll(),f.getSelectionModel().select(d?[d]:0),0==f.getStore().count()&&c.impostaDati(!1)),c.cbaConfig.wizard&&c.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento()):msgShowError("",f.getError())}})},aggiornaStoreRegoleServ:function(b){var c=this,d=c.getGridDomandeLAServ(),f=d.getStore();f.removeAll(!0);b&&b.data.servizi&&f.loadData(b.data.servizi);c.storeServizi.load({params:{type:getTipiServizioListaAttesa(),regione:"T"},callback:function(b,h,k){k?(b&&Ext.each(b,
function(b){var d=null;c.cbaConfig.controllerPortlet&&Ext.each(c.getColStato().getEditor().getStore().data.items,function(b){if("1"==b.data.extra.split(",")[0])return d=b,!1});trovaRecord(f,"idServizio",b.get("codice"))||(rec={id:null,idRegola:c.getContainer().getForm().findField("id").getValue(),idServizio:b.get("codice"),desServizio:b.get("valore"),puntManu:null,puntAuto:null,puntTot:null,selezionato:"F",regioneServizio:b.get("extra"),statoDom:d?d.data.codice:null},f.add(rec))}),d.getSelectionModel().deselectAll(!0),
Ext.each(f.data.items,function(b){b.get("selezionato")&&d.getSelectionModel().select([b],!0,!0)}),d.getView().refresh(),c.mostraClasse(d)):msgShowError("",h.getError())}})},nuovo:function(){var b=new Date;controller_nuovoRecord(this.getContainer());this.getCBServizio().setValue(this.cbaConfig.recRicovero.idRicovero);this.getData().setValue(b);this.getDataRicezione().setValue(b);this.aggiornaStoreRegoleServ();this.getMedicoMedGen().isVisible()&&this.settaMedicoMMG();this.impostaValorePredefinito(this.getCBComune());
this.impostaValorePredefinito(this.getCBProvenienza());this.impostaValorePredefinito(this.getCBMotivazione());this.impostaValorePredefinito(this.getCBIniziativaRichiesta());this.impostaValorePredefinito(this.getOnereDegenza());this.impostaValorePredefinito(this.getCBTipoDom());this.impostaValorePredefinito(this.getRegimeRicovero())},impostaValorePredefinito:function(b){b.isVisible()&&b.getStore().each(function(c){c&&"T"===c.get("extra").split(",")[1]&&b.setValue(c.get("codice"))})},settaMedicoMMG:function(){var b=
this;StdUtenti.promiseGetRequest(getUrlGen()+"/ws/genOsp/users/medico/getMedicoAttuale",parametri={codOspite:this.cbaConfig.recRicovero.codOspite,tipoMedico:"E",dataAl:new Date}).then(function(c){var d=b.getMedicoMedGen();c&&c.idMedico?(d.setValue(c.idMedico),d.setReadOnly(!0)):d.setReadOnly(!1)})["catch"](function(b){return msgShowError("",b)})},salva:function(b){var c;c=this.getContainer().getForm().getFieldValues();delete c.appo;var d=[],f=!1;stRegoleServ=this.getGridDomandeLAServ().getStore();
var g=this.getColStato().getEditor().getStore();stRegoleServ.data.each(function(b){f||(b=trovaRecord(g,"codice",b.data.statoDom))&&(f="1"==b.data.extra.split(",")[0])});var h=stRegoleServ.getModifiedRecords();h&&Ext.each(h,function(b){b=b.data;Ext.apply(b,{selezionato:getBoolValue(b.selezionato)});delete b.dataPrognosi;d.push(b)});Ext.apply(c,{indAccompagnamento:getBoolValue(c.indAccompagnamento),codOspite:this.cbaConfig.recRicovero.codOspite,servizi:d,isAttiva:f});c.idRicovero&&0!=c.idRicovero||
Ext.apply(c,{idRicovero:this.cbaConfig.recRicovero.idRicovero});h={dataChiusuraServizio:this.dataChiusuraServizio};controller_salvaRecord(this.getContainer(),c,b,h)?this.cbaConfig.wizard&&""!=this.cbaConfig.controllerEditFascicolo.navDirection&&this.cbaConfig.controllerEditFascicolo.navigaWizard(this.cbaConfig.controllerEditFascicolo.navDirection,!0):(c.data=c,this.aggiornaStoreRegoleServ(c));this.dataChiusuraServizio=null},verificaChiusuraServizio:function(){var b=this;Messaggio("ATTENZIONE","MSG_NO_REGOLE_CHIUDI_SERVIZIO",
"YESNO","QUESTION","",function(){b.salva(!0)},function(){b.dataChiusuraServizio=null;b.salva(!1)})},verificaCampiForm:function(){var b=this,c=!0,d=!0,f=[];if(b.getPageRegole().rendered){if(b.getContainer().getForm().isValid())if(0==b.getGridDomandeLAServ().getSelectionModel().getSelection().length)msgAddError(f,"MSG_ALMENO_UN_SERVIZIO");else{b.dataChiusuraServizio=null;var g=0;if(c=b.getGridDomandeLAServ().getSelectionModel().getSelection())Ext.each(c,function(c){if(null==c.data.statoDom)msgAddError(f,
traduci("SEL_STATO_DOMANDA")+" per il servizio "+c.data.desServizio);else{var d=!1,h=b.getColStato().getEditor().getStore();(h=trovaRecord(h,"codice",c.data.statoDom))&&(d="1"!=h.data.extra.split(",")[0]);if(d){if(null==b.dataChiusuraServizio||b.dataChiusuraServizio<c.data.dataAcc)b.dataChiusuraServizio=c.data.dataAcc;g++}}}),g==c.length?b.verificaChiusuraServizio():b.dataChiusuraServizio=null}else msgAddError(f,"MSG_CAMPI_OBBLIGATORI");c=0!=f.length||null!=b.dataChiusuraServizio?!1:!0}b.getPagePunteggi().rendered&&
(form=b.getPagePunteggi().down("form"),(d=!form.isDirty())||msgAddError(f,"MSG_PUNTEGGI_DA_CONFERMARE"));d&&c||msgShow("",f);return d&&c},impostaNumProtFormatted:function(b,c,d){if(Ext.isEmpty(this.numProtocolloFormato)||b&&isNaN(b))this.getNumProt().setValue(b);else{c||(c=new Date);var f=this.numProtocolloFormato,g=c.getFullYear();if(c=f.match(/A+/))"AA"!=c[0]&&"AAAA"!=c[0]&&(f=f.replace(c,"AAAA"),c=f.match(/A+/)),"AA"==c[0]&&(g=g.toString().substr(-2)),f=f.replace(c,g);if(c=f.match(/S+/))d||(d=
""),f=f.replace(c,d);(c=f.match(/N+/))&&1!=c[0].length&&(f=f.replace(c,"N"));d=c.index+1;c=f.substr(0,c.index);g="";d<f.length&&(g=f.substr(d));this.getPrefNumProt().setText(c);this.getSuffNumProt().setText(g);this.getNumProt().setValue(b);b=10+8*(b.length+2);this.getNumProt().setWidth(b)}},generaNumeroProtocollo:function(){var b=this,c=b.cbaConfig.recRicovero.servizio.id,d=b.cbaConfig.recRicovero.servizio.sigla,f=b.getData().getValue();if("T"!=b.numProtocolloAutomatico&&"S"!=b.numProtocolloAutomatico)return!1;
Ext.Ajax.request({method:"GET",params:{idOrg:getIdOrg(),idServizio:c,dataDal:f},url:getUrlGen()+"/ws/genOsp/numfasc/gen",success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){c=c.data;var g="";0<c.indexOf("")&&(g=c.split(""),c=g[0],g=g[1]);"S"==b.numProtocolloAutomatico?b.impostaNumProtFormatted(g,f,d):b.getNumProt().setValue(c)}else msgShowError("",c.message)}})},onLaunch:function(){var b=this;b.getGridDomandeLAServ().controller=b;b.getContainer().controller=b;var c=b.getGridDomandeLA();
b.cbaConfig.recRicovero=b.cbaConfig.nuovo?b.cbaConfig.controllerEditFascicolo.currRicovero:currRicovero;b.storeMedici=Ext.create("GeneraliOSP.medicoCurante.store.Medici");b.getMedicoInviante().bindStore(Ext.create("Ext.data.ChainedStore",{source:b.storeMedici}));b.getMedicoAccettante().bindStore(Ext.create("Ext.data.ChainedStore",{source:b.storeMedici}));b.getMedicoMedGen().bindStore(Ext.create("Ext.data.ChainedStore",{source:b.storeMedici}));b.stPerson=Ext.create("LA.person.store.Person");b.ggVMax=
0;b.stPerson.load({params:{idOrganizzazione:getIdOrg()},callback:function(c,d,f){if(f){b.getGridDomandeLAServ().cbaConfig.personLa=c[0].getData();b.ggVMax=c[0].get("ggVMax");d=getColGrid(b.getGridDomandeLAServ(),"sedi_rep");f=getColGrid(b.getGridDomandeLAServ(),"dataAcc");if("T"==c[0].get("abilitaSediRep")||"T"==c[0].get("abilitaLetti"))Ext.isDefined(d)?d.setVisible(!0):f.setVisible(!0);d="F";f="";if("T"==c[0].data.numProtocolloAutomatico||"S"==c[0].data.numProtocolloAutomatico)d=c[0].data.numProtocolloAutomatico,
f=c[0].data.numProtocolloFormato;b.numProtocolloAutomatico=d;b.numProtocolloFormato=f;c=0;b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.getContainer()&&b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0]&&(c=b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0].get("idRegola"));b.aggiornaStore(c)}else msgShowError("",d.getError())}});b.store=c.getStore();b.storeServizi=Ext.create("GeneraliOSP.store.TipoServizio");ImpostaUrl([b.storeServizi,
b.storeMedici]);b.getCBComune().getStore().load({callback:function(c,d,f){f&&(b.getCBComune().allowBlank=Ext.isEmpty(c))}});b.codAbilitato=null;b.storeStatoInfo=Ext.create("LA.regole.store.Info",{autoDestroy:!1});b.apriStoreInfo(b.storeStatoInfo,5,!0);b.cbaConfig.recRicovero&&b.cbaConfig.recRicovero.idServizio&&Ext.Ajax.request({method:"GET",params:{idServizio:b.cbaConfig.recRicovero.idServizio},url:getUrlGen()+"/ws/genOsp/prszn/servizio/impostazioni",success:function(c){c=Ext.JSON.decode(c.responseText);
var d=!1,f=!1,g=!1,n=!1,p=!1,q=!1,r=!1,t=!1,u=!1,x=!1,v=!1,w=!1,y=!1,C=!1,E=!1,F=!1,A=!1,H=!1;c.success&&c.data?(d="T"==StdSipcar.coalesce(c.data.tipoProvenienza,"F"),f="T"==StdSipcar.coalesce(c.data.motivazioneIngresso,"F"),g="T"==StdSipcar.coalesce(c.data.iniziativaRichiesta,"F"),n="T"==StdSipcar.coalesce(c.data.onereDegenza,"F"),p="T"==StdSipcar.coalesce(c.data.tipoRicovero,"F"),q="T"==StdSipcar.coalesce(c.data.regimeRicovero,"F"),r="T"==StdSipcar.coalesce(c.data.accessoPrevisto,"F"),t="T"==StdSipcar.coalesce(c.data.diagnosiIngresso,
"F"),u="T"==StdSipcar.coalesce(c.data.diagnosiIcd9,"F"),x="T"==StdSipcar.coalesce(c.data.medicoInviante,"F"),v="T"==StdSipcar.coalesce(c.data.medicoGenerale,"F"),w="T"==StdSipcar.coalesce(c.data.medicoAccettante,"F"),y="T"==StdSipcar.coalesce(c.data.indennitaAccompagnamento,"F"),C="T"==StdSipcar.coalesce(c.data.infoAggiuntive,"F"),E="T"==StdSipcar.coalesce(c.data.percentualeInvalidita,"F"),F="T"==StdSipcar.coalesce(c.data.situazioneDomicilio,"F"),A="T"==StdSipcar.coalesce(c.data.situazioneRilevazione,
"F"),H="T"==StdSipcar.coalesce(c.data.giorniPrognosi,"F")):msgShowError("",c.message);b.getCBProvenienza().setVisible(d);b.apriStoreInfo(b.getCBProvenienza().getStore(),2,d);b.getCBMotivazione().setVisible(f);b.apriStoreInfo(b.getCBMotivazione().getStore(),3,f);b.getCBIniziativaRichiesta().setVisible(g);b.apriStoreInfo(b.getCBIniziativaRichiesta().getStore(),8,g);b.getOnereDegenza().setVisible(n);b.apriStoreInfo(b.getOnereDegenza().getStore(),9,n);b.getCBTipoDom().setVisible(p);b.apriStoreInfo(b.getCBTipoDom().getStore(),
4,p);b.getRegimeRicovero().setVisible(q);b.apriStoreInfo(b.getRegimeRicovero().getStore(),10,q);b.getGiorniPrognosi().setVisible(H);getColGrid(b.getGridDomandeLAServ(),"dataAccessoPrevisto").setVisible(r);getColGrid(b.getGridDomandeLAServ(),"dataPrognosi").setVisible(r);b.getPrognosiDimissione().setVisible(r);b.getDiagnosiIngresso().setVisible(t);b.getCntIdc9().setVisible(u);b.getMedicoInviante().setVisible(x);b.getMedicoMedGen().setVisible(v);b.getBtnMedico().setVisible(v);b.getMedicoAccettante().setVisible(w);
(b.getMedicoAccettante().isVisible()||b.getMedicoInviante().isVisible()||b.getMedicoMedGen().isVisible())&&b.storeMedici.load();b.getChkIndAccompagnamento().setVisible(y);b.getCBInfoAgg().setVisible(C);b.apriStoreInfo(b.getCBInfoAgg().getStore(),1,C);b.getPercInvalidita().setVisible(E);b.getCBSituazDom().setVisible(F);b.apriStoreInfo(b.getCBSituazDom().getStore(),6,F);b.getCBSituazRil().setVisible(A);b.apriStoreInfo(b.getCBSituazRil().getStore(),7,A)}});var d=b.getContainer();d.permesso=b.cbaConfig.permesso;
d.boxBottoni=b.getBoxBottoni();b.storeForm=d.store=b.store;d.controller=b;var f=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=!1;stRegoleServ=b.getGridDomandeLAServ().getStore();var f=b.getColStato().getEditor().getStore();Ext.each(b.getGridDomandeLAServ().getSelectionModel().getSelection(),function(b){c||(b=trovaRecord(f,
"codice",b.data.statoDom))&&(c="1"!=b.data.extra.split(",")[0])});if(c)return Messaggio("Attenzione","NO_ELIMINA_RICHIESTA_CHIUSA","OK"),!1;var k=d.getForm().findField("id").getValue();Ext.isEmpty(k)||controller_eliminaRecord(d.store,{id:k},function(){b.aggiornaStore()})},esci_callback:function(){var c=b.getContainer().up("window");controller_puoiUscire(c,b.getContainer(),function(){b.verificaCampiForm()&&b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});
inserisciBottoni(b.getBoxBottoni(),f);b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&d.boxBottoni.queryById("btnEsci").setVisible(!1);if("L"!=b.cbaConfig.permesso)b.getContainer().on("dirtychange",function(d,f){var g=!1,h=b.getContainer().down("#CntRichiesta");b.getPagePunteggi().isVisible()&&(g=b.getPagePunteggi().down("form").isDirty(),h.setDisabled(g));g||controller_abilitaBottoni(b.getContainer());c.setDisabled(f);b.cbaConfig.controllerEditFascicolo&&
b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(f)});f=0;b.cbaConfig.controllerPortlet?b.cbaConfig.controllerPortlet.getContainer()&&b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0]&&(f=b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0].get("idRegola")):b.cbaConfig.idRecord&&(f=b.cbaConfig.idRecord);b.view_punteggi=Ext.create("LA.regole.view.Punteggi",{gridDomandeLA:c,controllerEditFascicolo:b.cbaConfig.controllerEditFascicolo});
this.getPagePunteggi().add(b.view_punteggi);b.aggiornaStore(f)},destroy:function(){if(CBA.moduli.modulo48.portletLista){var b=this.cbaConfig.controllerFascicolo.Ricerca,c={};Ext.apply(c,{codOspite:this.cbaConfig.recRicovero.codOspite});this.cbaConfig.nuovo||b.controller.cerca(c);b&&b.$className&&(b=b.down().items.items[1].items.items[0],(b=trovaRecord(b.getStore(),"codOspite",this.cbaConfig.recRicovero.codOspite))&&b.set("attivo",0!=CBA.moduli.modulo48.portletLista.getStore().data.length))}eliminaStore(this.storeStatoInfo);
eliminaStore(this.storeMedici);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.OSP_Residenziale",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"CntUtenti",selector:c+"#CntUtenti"},{ref:"CntAccompagnatori",selector:c+"#CntAccompagnatori"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"editResSede",selector:c+"#editResSede"},{ref:"editResReparto",selector:c+"#editResReparto"},{ref:"editResStanza",selector:c+
"#editResStanza"},{ref:"btnLettiLiberi",selector:c+"#btnLettiLiberi"},{ref:"StoricoGridResidenza",selector:c+"#StoricoGridResidenza"},{ref:"StoricoGridAccompagnatori",selector:c+"#StoricoGridAccompagnatori"},{ref:"EditResidenzaForm",selector:c+"#EditResidenzaForm"},{ref:"EditResidenza",selector:c+"#EditResidenza"},{ref:"editResLetto",selector:c+"#editResLetto"},{ref:"editResDataDal",selector:c+"#editResDataDal"},{ref:"editResOraDal",selector:c+"#editResOraDal"},{ref:"editResDataAl",selector:c+"#editResDataAl"},
{ref:"editResOraAl",selector:c+"#editResOraAl"},{ref:"editResNote",selector:c+"#editResNote"},{ref:"EdtTipoRecord",selector:c+"#EdtTipoRecord"},{ref:"EdtStato",selector:c+"#EdtStato"},{ref:"CntEditResidenza",selector:c+"#CntEditResidenza"},{ref:"CntCss",selector:c+"#CntCss"},{ref:"StanzaUsoSingolo",selector:c+"#StanzaUsoSingolo"},{ref:"EditIdAccompagnatore",selector:c+"#EditIdAccompagnatore"},{ref:"EdtIdRiferimento",selector:c+"#EdtIdRiferimento"},{ref:"btnCopiaUbicazione",selector:c+"#btnCopiaUbicazione"}]);
b.control(c+"#editResSede",{select:b.onEditResSedeSelect,expand:b.applicaFiltroDisattivi,collapse:b.onCollapseCombo});b.control(c+"#editResReparto",{select:b.onEditResRepartoSelect,expand:b.applicaFiltroDisattivi,collapse:b.onCollapseCombo});b.control(c+"#editResStanza",{select:b.onEditResStanzaSelect,expand:b.applicaFiltroStanze,collapse:b.onCollapseCombo});b.control(c+"#btnLettiLiberi",{click:b.onBntClickLettiLiberi,expand:b.applicaFiltroDisattivi,collapse:b.onCollapseCombo});b.control(c+"#btnCopiaUbicazione",
{click:b.onBtnCopiaUbicazione,expand:b.applicaFiltroDisattivi,collapse:b.onCollapseCombo});b.control(c+"#CntUtenti",{expand:b.onContainerSelect});b.control(c+"#StoricoGridResidenza",{select:b.onStoricoGridResidenzaSelect});b.control(c+"#CntAccompagnatori",{expand:b.onCntAccompagnatoriExpand});b.control(c+"#StoricoGridAccompagnatori",{select:b.onStoricoGridAccompagnatoriSelect});b.on({esci:function(){b.getEditResidenzaForm().boxBottoni.queryById("btnEsci").handler()},changeTab:function(){return b.changeTab()}})},
getBtnCssAssociaGruppiUtente:function(){return this.getCntCss().down("#BtnCssAssociaGruppiUtente")},onClickBtnCssAssociaGruppiUtente:function(){if(49!=!CBA.moduli.moduloAttivo){if(Ext.isDefined(this.cbaConfig.controllerEditFascicolo)&&Ext.isDefined(this.cbaConfig.controllerEditFascicolo.currRicoveroCSS)&&Ext.isEmpty(this.cbaConfig.controllerEditFascicolo.currRicoveroCSS.id))return null;Ext.create("winCBA",{titolo:"GEST_GRUPPI_UTENTE",larghezzaWin:600,altezzaWin:360,closable:!0,maximizable:!1,name:"GeneraliCS.anagrafica.view.AssociaGruppiUtente",
configItem:{idProfilo:CBA.parametriGenerali.idProfiloCss,idRicovero:this.cbaConfig.controllerEditFascicolo.currRicoveroCSS.id}}).show()}},afterTabChange:function(){0==this.getStoricoGridResidenza().getStore().getTotalCount()&&this.getEditResDataDal().focus(!1,200);this.getStoricoGridAccompagnatori()&&0==this.getStoricoGridAccompagnatori().getStore().getTotalCount()&&this.getEditResDataDal().focus(!1,200);this.cbaConfig.cartella&&this.aggiornaStore()},changeTab:function(){var b=this,c=b.getEditResidenzaForm().up("window");
controller_puoiUscire(c,b.getEditResidenzaForm(),function(){b.salva(!1)},function(){b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){b.aggiornaStore()})},onCollapseCombo:function(b){b.getStore().clearFilter()},onContainerSelect:function(b){b=this.getEditResidenzaForm();var c=b.getForm(),d=this.storeForm,c=c.findField("id").getValue(),d=trovaRecord(d,"id",c);this.current_tipoRecord=this.current_tipoRecordUtente;this.changeContainer("UTENTE");
clearForm(b);grid=this.getStoricoGridResidenza();grid.getSelectionModel().deselectAll();grid.getSelectionModel().select(d?[d]:0);this.gestioneAccompagnatore(!1)},controlloModifiche:function(){permettiModificheDopoDimissione()||(containerSolaLettura(this.getEditResidenzaForm()),this.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),this.getBoxBottoni().queryById("btnElimina").setDisabled(!0),this.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),this.getBoxBottoni().queryById("btnConferma").setDisabled(!0),
this.getBoxBottoni().queryById("btnEsci").setDisabled(!1),this.getBtnLettiLiberi().setDisabled(!0))},onStoricoGridResidenzaSelect:function(b,c){this.impostaDati(c);this.controlloModifiche()},gestioneAccompagnatore:function(b){(void 0===b?0:b)?(this.getEditResDataAl().setReadOnly(!1),this.getEditResDataAl().removeCls("x-item-disabled"),this.abilitaGestioneOraria&&(this.getEditResOraAl().setReadOnly(!1),this.getEditResOraAl().removeCls("x-item-disabled"))):(this.getBtnCopiaUbicazione().setVisible(!1),
48==CBA.moduli.moduloAttivo&&this.cbaConfig.abilitaLetti?(this.getEditResDataAl().setReadOnly(!1),this.getEditResDataAl().removeCls("x-item-disabled"),this.abilitaGestioneOraria&&(this.getEditResOraAl().setReadOnly(!1),this.getEditResOraAl().removeCls("x-item-disabled"))):(this.getEditResDataAl().setReadOnly(!0),this.getEditResDataAl().addCls("x-item-disabled"),this.getEditResOraAl().setReadOnly(!0),this.getEditResOraAl().addCls("x-item-disabled")))},onCntAccompagnatoriExpand:function(b){var c=this,
d=c.getEditResidenzaForm(),f=d.getForm(),g=f.findField("id").getValue();this.current_tipoRecord="R";c.changeContainer("ACCOMPAGNATORE");clearForm(d);c.gestioneAccompagnatore(!0);if(c.storeAccLoaded)b=trovaRecord(c.storeAcc,"id",g),d.store=c.storeAcc,grid=c.getStoricoGridAccompagnatori(),grid.getSelectionModel().deselectAll(),grid.getSelectionModel().select(b?[b]:0);else{if("F"==CBA.StdUtenti.recImpostazioniServizio.abilitaAccompagnatore)return;c.getEditResidenzaForm().store=c.storeAcc;b=c.getEditResidenzaForm().permesso;
c.getCntEditResidenza().queryById("PanelMsg")&&c.getCntEditResidenza().queryById("PanelMsg").destroy();c.getEditResidenzaForm().setDisabled(!1);c.getContainer().setDisabled(!1);c.getBoxBottoni().queryById("btnNuovo").setDisabled("L"==b?!0:!1);c.getBoxBottoni().queryById("btnElimina").setDisabled("L"==b?!0:!1);c.abilitaGestioneOraria&&(c.getEditResOraDal().show(),c.getEditResOraAl().show(),this.getStoricoGridAccompagnatori().columns.find(function(b){return"dataDal"==b.dataIndex}).format="d/m/Y H:i");
b={idRicovero:c.cbaConfig.recRicovero.idRicovero,tipoRecord:this.current_tipoRecord};48==CBA.moduli.moduloAttivo&&Ext.apply(b,{idServDomanda:c.cbaConfig.recServizioLA.get("id")});c.storeAcc.load({params:b,callback:function(b,k,l){l?(c.storeAccLoaded=!0,Ext.isEmpty(b)?(clearForm(d),containerSolaLettura(c.getCntEditResidenza(),!0)):(containerSolaLettura(c.getCntEditResidenza(),!1),g||(g=f.findField("id").getValue()),b=trovaRecord(c.storeAcc,"id",g),k=c.getStoricoGridAccompagnatori(),k.getSelectionModel().deselectAll(),
k.getSelectionModel().select(b?[b]:0)),c.cbaConfig.wizard&&c.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento()):msgShowError("",k.getError())}})}c.controlloModifiche()},onStoricoGridAccompagnatoriSelect:function(b,c){this.impostaDati(c);this.controlloModifiche()},changeContainer:function(b){this.controlloModifiche();"UTENTE"==b?(this.getEditIdAccompagnatore().setVisible(!1),this.getStanzaUsoSingolo().setVisible(!0),this.getStoricoGridResidenza().bindStore(this.storeForm),this.getEditIdAccompagnatore().allowBlank=
!0):(this.getEditIdAccompagnatore().setVisible(!0),this.getStanzaUsoSingolo().setVisible(!1),b=this.getEditIdAccompagnatore().getStore(),this.getEditIdAccompagnatore().allowBlank=!1,this.personContabili||(this.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null)),b.load({params:{codospite:this.cbaConfig.controllerFascicolo.currentDip,tipoContatto:2,tipoContabilita:this.personContabili.tipoContabilitaAbilitata}}),this.getEditIdAccompagnatore().validateValue(this.getEditIdAccompagnatore().getValue()))},
onBntClickLettiLiberi:function(b,c,d){var f=this;c=new Date;recordLettiLiberi=f.getEditResidenzaForm().getValues();null!=f.getEditResDataDal().getValue()&&(c=f.getEditResDataDal().getValue());f.abilitaGestioneOraria&&(b=moment(f.getEditResOraDal().getValue()),c=moment(c),c.set("hour",b.get("hour")),c.set("minute",b.get("minute")),c=c.toDate());StdUtenti.apriWindowLettiLiberi({permesso:f.cbaConfig.permesso,ggDecorrenza:c,formatoData:f.abilitaGestioneOraria?"d/m/Y H:i":"d/m/Y",usaDataDimPrev:"F",cb_salva:function(b){Ext.apply(recordLettiLiberi,
{idSede:b.idSede,idReparto:b.idReparto,idStanza:b.idStanza,idLetto:b.idLetto});f.salva(!1,recordLettiLiberi)}})},onBtnCopiaUbicazione:function(b,c,d){(b=this.storeForm.data.first())&&this.impostaDati(b,!0)},onEditResStanzaSelect:function(b,c,d){SvuotaCombo(this.getEditResLetto());0<b.value&&(this.getEditResLetto().getStore().getProxy().extraParams={sede:this.getEditResSede().getValue(),reparto:this.getEditResReparto().getValue(),stanza:b.value},this.getEditResLetto().getStore().load())},onEditResRepartoSelect:function(b,
c,d){SvuotaCombo(this.getEditResStanza());SvuotaCombo(this.getEditResLetto());0<b.value&&0<this.getEditResSede().getValue()&&(this.getEditResStanza().getStore().getProxy().extraParams={sede:this.getEditResSede().getValue(),reparto:b.value},this.getEditResStanza().getStore().load())},onEditResSedeSelect:function(b,c,d){SvuotaCombo(this.getEditResReparto());SvuotaCombo(this.getEditResStanza());SvuotaCombo(this.getEditResLetto());0<b.value&&(this.getEditResReparto().getStore().getProxy().extraParams=
{sede:b.value},this.getEditResReparto().getStore().load())},impostaDati:function(b,c){c=void 0===c?!1:c;var d=this.getEditResidenzaForm();"R"!=this.current_tipoRecord?this.getStoricoGridResidenza().setDisabled(!1):this.getStoricoGridAccompagnatori().setDisabled(!1);b?(containerSolaLettura(this.getCntEditResidenza(),!1),c||(this.getEditResSede().getStore().clearFilter(),clearForm(d),d.loadRecord(b),d={oraDal:b.get("dataDal"),oraAl:b.data.dataAl?b.get("dataAl"):""},this.getEditResidenzaForm().getForm().setValues(d)),
setCombo(this.getEditResSede(),b.data.idSede),this.getEditResReparto().getStore().getProxy().extraParams={sede:b.data.idSede},setCombo(this.getEditResReparto(),b.data.idReparto),this.getEditResStanza().getStore().getProxy().extraParams={sede:b.data.idSede,reparto:b.data.idReparto},b.data.idStanza?(setCombo(this.getEditResStanza(),b.data.idStanza),c||(this.getEditResLetto().getStore().getProxy().extraParams={stanza:b.data.idStanza},setCombo(this.getEditResLetto(),b.data.idLetto))):(setCombo(this.getEditResStanza(),
""),setValue(this.getEditResLetto(),""),svuotaStore(this.getEditResLetto().getStore()))):(this.controlloModifiche(),containerSolaLettura(this.getCntEditResidenza(),!0))},nuovo:function(){controller_nuovoRecord(this.getEditResidenzaForm());var b=new Date;"R"!=this.current_tipoRecord?0==this.getStoricoGridResidenza().getStore().count()&&(b=this.cbaConfig.recRicovero.dataDal):0==this.getStoricoGridAccompagnatori().getStore().count()&&(b=this.cbaConfig.recRicovero.dataDal);b&&!this.abilitaGestioneOraria&&
b.setHours(0,0,0,0);this.cbaConfig.dataDalNuovo&&(b=this.cbaConfig.dataDalNuovo);this.getEditResDataDal().setValue(b);this.getEditResOraDal().setValue(b);this.getEdtTipoRecord().setValue(this.current_tipoRecord);this.getBtnCopiaUbicazione().setVisible("R"==this.current_tipoRecord);this.getEdtStato().setValue(48==CBA.moduli.moduloAttivo?"P":"C");b=this.getEditResSede().getStore();if(1==b.getCount()){var c=this.getEditResSede();c.setValue(b.getAt(0).get("codice"));c.fireEvent("select",c)}},verificaCampiForm:function(){var b=
[];this.getEditResidenzaForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b,c){if(!c&&!this.verificaCampiForm())return!1;var d=this.getEditResidenzaForm().getForm(),f;f=c?c:d.getValues();f.idRicovero=this.cbaConfig.recRicovero.idRicovero;f.dataDal=d.findField("dataDal").getValue();f.oraDal=d.findField("oraDal").getValue();f.dataAl=d.findField("dataAl").getValue();f.oraAl=d.findField("oraAl").getValue();f.dataAl&&f.dataAl.setHours(0,0,0,0);this.abilitaGestioneOraria&&
(f.dataDal.setHours(Ext.util.Format.date(f.oraDal,"H"),Ext.util.Format.date(f.oraDal,"i")),f.dataAl&&f.dataAl.setHours(Ext.util.Format.date(f.oraAl,"H"),Ext.util.Format.date(f.oraAl,"i")));f.dataOraDomanda=""!=f.dataOraDomanda?moment(f.dataOraDomanda).toDate():null;f.dataOraRisposta=""!=f.dataOraRisposta?moment(f.dataOraRisposta).toDate():null;"null"==f.note&&(f.note=null);delete f.oraDal;delete f.oraAl;d=48!=CBA.moduli.moduloAttivo?{idRicovero:f.idRicovero}:{idServDomanda:this.cbaConfig.recServizioLA.get("id")};
Ext.apply(d,{gestioneOraria:this.abilitaGestioneOraria});f.tipoRecord=this.current_tipoRecord;48==CBA.moduli.moduloAttivo&&(f.idServizioDomanda=this.cbaConfig.recServizioLA.get("id"),this.cbaConfig.abilitaLetti&&(f.tipoRecord="P",f.stato="P"));controller_salvaRecord(this.getEditResidenzaForm(),f,b,d,!0,!1,"id")&&this.cbaConfig.wizard&&""!=this.cbaConfig.controllerEditFascicolo.navDirection&&this.cbaConfig.controllerEditFascicolo.navigaWizard(this.cbaConfig.controllerEditFascicolo.navDirection,!0);
this.getBtnCopiaUbicazione().setVisible(!1)},aggiornaStore:function(b){var c=this,d;d="R"!=this.current_tipoRecord?c.getStoricoGridResidenza().getStore():c.storeAcc;var f=c.getEditResidenzaForm(),g=f.getForm(),h=c.getEditResidenzaForm().permesso,k=null,l={codOspite:c.cbaConfig.recRicovero.codOspite,idProfilo:CBA.parametriGenerali.idProfiloCss};c.cbaConfig.controllerEditFascicolo&&c.cbaConfig.controllerEditFascicolo.currRicoveroCSS&&(k=c.cbaConfig.controllerEditFascicolo.currRicoveroCSS);k&&Ext.apply(l,
{idRicoveroCs:k});c.cbaConfig.cartella&&Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/cu/getIdRicovero",async:!1,params:l,success:function(b){b=Ext.JSON.decode(b.responseText);var d=b.data;b.success?(c.cbaConfig.CSS_idRicoveroCU=d,c.cbaConfig.recRicovero.idRicovero=d):msgShowError("",b.message)}});if(c.cbaConfig.cartella&&!c.cbaConfig.CSS_idRicoveroCU)h=traduci("MSG_NO_RESIDENZIALE"),h=Ext.create("Ext.panel.Panel",{height:45,itemId:"PanelMsg",reference:"PanelMsg",margin:"10 10 10 10",border:!1,
style:"-webkit-box-shadow: 0px 0px 4px 1px rgba(219,81,131,1) !important;",html:'<p style="color:red;padding-left:10px;font-weight:bold;">'+h+"</p>"}),c.getCntEditResidenza().insert(0,h),c.getEditResidenzaForm().setDisabled(!0),c.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),c.getBoxBottoni().queryById("btnElimina").setDisabled(!0);else{k=c.cbaConfig.CSS_idRicoveroCU?c.cbaConfig.CSS_idRicoveroCU:c.cbaConfig.recRicovero.idRicovero;c.getCntEditResidenza().queryById("PanelMsg")&&c.getCntEditResidenza().queryById("PanelMsg").destroy();
c.getEditResidenzaForm().setDisabled(!1);c.getContainer().setDisabled(!1);c.getBoxBottoni().queryById("btnNuovo").setDisabled("L"==h?!0:!1);c.getBoxBottoni().queryById("btnElimina").setDisabled("L"==h?!0:!1);var h={idRicovero:k,tipoRecord:this.current_tipoRecord},n=c.getStoricoGridResidenza();"R"==this.current_tipoRecord&&(n=c.getStoricoGridAccompagnatori());48==CBA.moduli.moduloAttivo&&Ext.apply(h,{idServDomanda:c.cbaConfig.recServizioLA.get("id")});d.load({params:h,callback:function(h,k,l){l?(Ext.isEmpty(h)?
(clearForm(f),containerSolaLettura(c.getCntEditResidenza(),!0)):(b||(b=g.findField("id").getValue()),h=trovaRecord(d,"id",b),n.getSelectionModel().deselectAll(),n.getSelectionModel().select(h?[h]:0)),c.cbaConfig.wizard&&c.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento()):msgShowError("",k.getError())}})}c.controlloModifiche();c.getBtnCopiaUbicazione().setVisible(!1)},applicaFiltroDisattivi:function(b){b=b.getStore();b.clearFilter();var c=this.getEditResidenzaForm().getForm().findField("id").getValue();
(""==c||0>c)&&b.filter({filterFn:function(b){return"T"==b.data.extra?!1:!0}})},applicaFiltroStanze:function(b){b=b.getStore();b.clearFilter();var c=this.getEditResidenzaForm().getForm().findField("id").getValue();b.filter({filterFn:function(b){var d=!1;"T"==b.data.extra&&0<c&&(d=!0);if(""==b.data.extra||["M","F","C","G"].includes(b.data.extra))d=!0;return d}})},objPanelAccompagnatore:function(){return{xtype:"panel",itemId:"CntAccompagnatori",reference:"CntAccompagnatori",layout:{type:"fit"},title:traduci("ACCOMPAGNATORI"),
items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridAccompagnatori",reference:"StoricoGridAccompagnatori",viewConfig:{getRowClass:function(b,c,d,f){if(b.get("dataAl"))return"non_attivi"},loadMask:!1},columns:[{xtype:"datecolumn",width:80,dataIndex:"dataDal",text:traduci("RES_INIZIO_UTILIZZO"),flex:1,format:"d/m/Y",renderer:function(b,c,d,f,g,h,k){b=FormattaData(b,c.column.format)+(d.get("dataAl")?" - "+FormattaData(d.get("dataAl"),c.column.format):"");d=d.get("desAccompagnatore");return"\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<div>"+
b+"</div>\n\t\t\t\t\t\t\t\t\t<div>"+d+"</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"}}],selModel:Ext.create("Ext.selection.RowModel",{})}]}},onLaunch:function(){var b=this,c=b.getStoricoGridResidenza(),d=49===CBA.moduli.moduloAttivo,f=b.getEditResidenzaForm();b.storeAcc=Ext.create("GeneraliOSP.portlet.store.Residenziale");b.panelAccompagnatore=Ext.create(b.objPanelAccompagnatore());b.storeForm=f.store=Ext.create("GeneraliOSP.portlet.store.Residenziale");b.current_tipoRecordUtente=48==CBA.moduli.moduloAttivo?
"P":"U";b.current_tipoRecord=b.current_tipoRecordUtente;48!=CBA.moduli.moduloAttivo||b.cbaConfig.abilitaLetti||(b.storeForm.getProxy().urlGen="/ws/listaAttesa/stanza/search");c.bindStore(b.storeForm);b.storeForm=f.store=c.getStore();b.abilitaGestioneOraria=!1;var g=48==CBA.moduli.moduloAttivo?b.cbaConfig.recServizioLA.get("idServizio"):b.cbaConfig.recRicovero.idServizio;Ext.isEmpty(g)||CBA.StdUtenti.getImpostazioniServizio(CBA.moduli.moduloAttivo,g).then(function(d){b.abilitaGestioneOraria="T"==d.abilitaOraResidenziale;
b.abilitaGestioneOraria&&(b.getEditResOraDal().show(),b.getEditResOraAl().show(),c.columns.find(function(b){return"dataDal"==b.dataIndex}).format="d/m/Y H:i");48==CBA.moduli.moduloAttivo&&b.cbaConfig.abilitaLetti&&(b.getEditResDataAl().setReadOnly(!1),b.getEditResDataAl().removeCls("x-item-disabled"),b.abilitaGestioneOraria&&(b.getEditResOraAl().setReadOnly(!1),b.getEditResOraAl().removeCls("x-item-disabled")));48!=CBA.moduli.moduloAttivo&&"T"==d.abilitaAccompagnatore&&(b.getContainer().add(b.panelAccompagnatore),
b.getStoricoGridAccompagnatori().getView().bindStore(b.storeAcc))})["catch"](function(b){return msgShowError("",b)});b.getContainer().controller=b;ImpostaUrl([c.getStore(),b.getEditResSede().getStore(),b.getEditResReparto().getStore(),b.getEditResStanza().getStore(),b.getEditResLetto().getStore(),b.getEditIdAccompagnatore().getStore(),b.storeAcc]);(![50.48].includes(CBA.moduli.moduloAttivo)||48==CBA.moduli.moduloAttivo&&b.cbaConfig.abilitaLetti)&&b.getBtnLettiLiberi().setVisible(!b.cbaConfig.cartella);
b.getEditResSede().getStore().load();f.permesso=b.cbaConfig.permesso;f.boxBottoni=b.getBoxBottoni();f.controller=b;d&&(b.getCntCss().show(),b.getCntCss().add({xtype:"button",cls:"cba-stdbutton-25",width:180,nonDisabilitare:!0,margin:"0 0 0 104",text:"GEST_GRUPPI_UTENTE",iconCls:"icon-teamwork",tooltip:"GEST_GRUPPI_UTENTE",itemId:"BtnCssAssociaGruppiUtente",handler:Ext.bind(this.onClickBtnCssAssociaGruppiUtente,this)}),this.getCntEditResidenza().on("afterrender",function(b){b.up().body.setStyle("background-color",
"transparent")}));g=Ext.create("Generali.standard."+(d?"controller_PannelloBottoni":"controller_PannelloBottoniVert"),{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){containerSolaLettura(f,!1);b.nuovo()},elimina_callback:function(){var c=f.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(f.store,{id:c},function(){b.aggiornaStore()})},esci_callback:function(){var c=b.getEditResidenza().up("window");
controller_puoiUscire(c,b.getEditResidenzaForm(),function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:d?!0:null,personIcons:d?getIconButtons():null}});inserisciBottoni(b.getBoxBottoni(),
g);d&&(f.boxBottoni.queryById("btnElimina").setIconCls(getIconButtons().btnEliminaX),f.boxBottoni.queryById("btnEsci").setHidden(!0));b.getBoxBottoni().add(b.getBtnLettiLiberi());b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&f.boxBottoni.queryById("btnEsci").setVisible(!1);if("L"!=b.cbaConfig.permesso)b.getEditResidenzaForm().on("dirtychange",function(d,f){controller_abilitaBottoni(b.getEditResidenzaForm());c.setDisabled(f);b.getContainer().setDisabled(f);
b.cbaConfig.controllerEditFascicolo&&(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(f),b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(f))});var h;b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.getContainer()&&b.cbaConfig.controllerPortlet.getContainer().getForm().findField("id").getValue()&&(h=b.cbaConfig.controllerPortlet.getContainer().getForm().findField("id").getValue());48==CBA.moduli.moduloAttivo&&b.aggiornaStore();h||b.cbaConfig.cartella?
b.aggiornaStore(h):b.impostaDati()},destroy:function(){eliminaStore(this.storeAcc);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.Pensioni",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"StoricoGridPensioni",selector:c+"#StoricoGridPensioni"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"EditPensioniForm",selector:c+"#EditPensioniForm"},{ref:"pensioneTipoQuota",selector:c+"#pensioneTipoQuota"},{ref:"pensioneData",selector:c+"#pensioneData"},{ref:"pensioneDataFine",
selector:c+"#pensioneDataFine"},{ref:"pensioneTipo",selector:c+"#pensioneTipo"},{ref:"pensionePagante",selector:c+"#pensionePagante"},{ref:"EditPensioni",selector:c+"#EditPensioni"},{ref:"pensioneQuota",selector:c+"#pensioneQuota"},{ref:"pensioneDelegato",selector:c+"#pensioneDelegato"},{ref:"pensioneNote",selector:c+"#pensioneNote"},{ref:"pensioneNumero",selector:c+"#pensioneNumero"},{ref:"pensioneCassa",selector:c+"#pensioneCassa"},{ref:"EditPensioniRecordId",selector:c+"#EditPensioniRecordId"}]);
b.control(c+"#StoricoGridPensioni",{select:b.onStoricoGridPensioniItemClick});b.on({esci:function(){b.getEditPensioniForm().boxBottoni.queryById("btnEsci").handler()}});b.on({changeTab:function(){return b.changeTab()}})},afterTabChange:function(){this.getPensionePagante().getStore().load({params:{idRicovero:currRicovero.idRicovero,tipoContabilita:this.personContabili.tipoContabilitaAbilitata}});0==this.getStoricoGridPensioni().getStore().getTotalCount()&&this.getPensioneTipo().focus(!1,200)},changeTab:function(){var b=
this,c=b.getEditPensioniForm().up("window");controller_puoiUscire(c,b.getEditPensioniForm(),function(){b.salva(!1)},function(){b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){b.aggiornaStore()})},onStoricoGridPensioniItemClick:function(b,c,d,f,g,h){this.impostaDati(c);permettiModificheDopoDimissione()||(containerSolaLettura(me.getEditPensioniForm()),me.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),me.getBoxBottoni().queryById("btnElimina").setDisabled(!0),
me.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),me.getBoxBottoni().queryById("btnConferma").setDisabled(!0),me.getBoxBottoni().queryById("btnEsci").setDisabled(!1))},nuovo:function(){controller_nuovoRecord(this.getEditPensioniForm());this.getEditPensioniForm().getForm().setValues({idPensione:-9999});this.getPensioneTipoQuota().setValue("I");this.getPensioneQuota().setValue(0)},verificaCampiForm:function(){var b=[],c=this.getEditPensioniForm().getForm(),d=c.getFieldValues();c.isValid()||
msgAddError(b,"MSG_CAMPI_OBBLIGATORI");null!=d.dataFine&&d.dataFine<d.dataRilascio&&msgAddError(b,"DATA_FINE_MINORE_DI_INIZIO");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=this.getEditPensioniForm().getForm().getFieldValues();delete c.id;Ext.apply(c,{idRicovero:currRicovero.idRicovero,idCassa:-1==this.getPensioneCassa().getValue()?null:this.getPensioneCassa().getValue()});controller_salvaRecord(this.getEditPensioniForm(),c,b,null,null,null,"idPensione")&&this.cbaConfig.wizard&&
""!=this.cbaConfig.controllerEditFascicolo.navDirection&&this.cbaConfig.controllerEditFascicolo.navigaWizard(this.cbaConfig.controllerEditFascicolo.navDirection,!0)},impostaDati:function(b){this.getStoricoGridPensioni().setDisabled(!1);clearForm(this.getEditPensioniForm());b&&(Ext.apply(b.data,{idCassa:null==b.data.idCassa?-1:b.data.idCassa}),this.getEditPensioniForm().loadRecord(b));this.cbaConfig&&this.cbaConfig.wizard&&this.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento()},aggiornaStore:function(b){var c=
this,d=c.getStoricoGridPensioni().getStore();d.load({params:{idRicovero:currRicovero.idRicovero,soloAttivi:!1},callback:function(f,g,h){h?Ext.isEmpty(f)?clearForm(c.getEditPensioniForm()):(f=trovaRecord(d,"idPensione",b),g=c.getStoricoGridPensioni(),g.getSelectionModel().deselectAll(),g.getSelectionModel().select(f?[f]:0)):msgShowError("",g.getError())}});permettiModificheDopoDimissione()||(containerSolaLettura(c.getEditPensioniForm()),c.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),c.getBoxBottoni().queryById("btnElimina").setDisabled(!0),
c.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),c.getBoxBottoni().queryById("btnConferma").setDisabled(!0),c.getBoxBottoni().queryById("btnEsci").setDisabled(!1))},onLaunch:function(){var b=this;b.getContainer().controller=b;b.getStoricoGridPensioni().controller=b;b.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null);var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},
nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=b.getEditPensioniForm().getForm().findField("idPensione").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.getStoricoGridPensioni().getStore(),{idPensione:c},function(){b.aggiornaStore()})},esci_callback:function(){var c=b.getEditPensioniForm().up("window");controller_puoiUscire(c,b.getEditPensioniForm(),function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();
c.close()},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),c);c=b.getContainer().up("window");Localizer.localize(c);this.getPensioneTipoQuota().bindStore(Ext.create("Generali.store.EuroPerc"));c=Ext.create("CU.store.Pensioni");this.getPensioneTipo().bindStore(c);c.getProxy().extraParams={codSede:getIdOrg()};
c.load();c=Ext.create("CU.store.PagantiFascicolo");this.getPensionePagante().bindStore(c);c.load({params:{idRicovero:currRicovero.idRicovero,tipoContabilita:b.personContabili.tipoContabilitaAbilitata}});c=this.getPensioneCassa();c.setVisible(CBA.moduli.modulo46);if(CBA.moduli.modulo46){var d=Ext.create("CU.denaro.common.store.Casse");c.bindStore(d);d.load({params:{idOrganizzazione:getIdOrg()},callback:function(c,g,h){h&&(b.aggiornaStore(),b.personContabili.pensIncassoNoCassa&&d.insert(0,{id:-1,descrizione:traduci("NO_CASSA")}))}})}else b.aggiornaStore();
c=b.getEditPensioniForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();c.store=b.getStoricoGridPensioni().getStore();c.controller=b;b.cbaConfig.wizard&&c.boxBottoni.queryById("btnEsci").setVisible(!1);this.getEditPensioniRecordId().hide();if("L"!=b.cbaConfig.permesso)this.getEditPensioniForm().getForm().on("dirtychange",function(c,d){controller_abilitaBottoni(b.getEditPensioniForm());b.getStoricoGridPensioni().setDisabled(d);b.cbaConfig.controllerEditFascicolo&&(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(d),
b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(d))});"L"==b.cbaConfig.permesso&&(containerSolaLettura(b.getEditPensioniForm()),controller_bottoniSolaLettura(b.getBoxBottoni()))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletCMAttivitaUtente",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"CntDatiAssistenziali",selector:this.selContainer+"#CntDatiAssistenziali"},{ref:"CntBINA",selector:this.selContainer+"#CntBINA"}]);this.control(this.selContainer+"#Container",{afterrender:this.onPortletFARAfterRender})},onPortletFARAfterRender:function(b,
c){this.dblclickFAR(b)},dblclickFAR:function(b){var c=this;b.el.on("dblclick",function(){"undefined"!=typeof currRicovero&&c.cbaConfig.controllerFascicolo.idRicovero?CBA.moduli.modulo55.abilitato?eseguiModulo(55,"btnOSP_Anagrafica",{codOspite:currOspite.id}):Messaggio("Attenzione","MSG_MODULO_NON_ABILITATO","OK","WARNING"):Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")})},updatePortlet:function(){this.getCntDatiAssistenziali().down("#Container").controller.updatePortlet()},
onLaunch:function(){this.getContainer().controller=this;var b=Ext.create("GeneraliOSP.portlet.view.PortletFARDati");this.getCntDatiAssistenziali().add(b)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletCMBisogniPrimari",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"CntDatiAssistenziali",selector:this.selContainer+"#CntDatiAssistenziali"},{ref:"CntBINA",selector:this.selContainer+"#CntBINA"}]);this.control(this.selContainer+"#Container",{afterrender:this.onPortletFARAfterRender})},onPortletFARAfterRender:function(b,
c){this.dblclickFAR(b)},dblclickFAR:function(b){var c=this;b.el.on("dblclick",function(){"undefined"!=typeof currRicovero&&c.cbaConfig.controllerFascicolo.idRicovero?CBA.moduli.modulo55.abilitato?eseguiModulo(55,"btnOSP_Anagrafica",{codOspite:currOspite.id}):Messaggio("Attenzione","MSG_MODULO_NON_ABILITATO","OK","WARNING"):Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")})},updatePortlet:function(){this.getCntDatiAssistenziali().down("#Container").controller.updatePortlet()},
onLaunch:function(){this.getContainer().controller=this;var b=Ext.create("GeneraliOSP.portlet.view.PortletFARDati");this.getCntDatiAssistenziali().add(b)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletClassificazioni",{extend:"Generali.standard.ViewController",init:function(){this.lblClassRegio=traduci("RETTE_CLASS_REGIONALE");this.lblClassInt=traduci("RETTE_CLASS_INTERNA");this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"portletEditClassificazioniCenter",selector:this.selContainer+"#portletEditClassificazioniCenter"},{ref:"classRegionale",selector:this.selContainer+
"#classRegionale"},{ref:"classInterna",selector:this.selContainer+"#classInterna"},{ref:"PnlScontiSupplementi",selector:this.selContainer+"#PnlScontiSupplementi"},{ref:"GW_GrigliaPrestazioni",selector:this.selContainer+"#GW_GrigliaPrestazioni"},{ref:"BtnCauzioni",selector:this.selContainer+"#BtnCauzioni"}]);this.control(this.selContainer+"#Container",{afterrender:this.onPortletEditClassificazioniAfterRender});this.control(this.selContainer+"#portletEditClassificazioniCenter",{afterrender:this.onPortletEditClassificazioniCenter});
this.control(this.selContainer+"#GW_GrigliaPrestazioni",{afterrender:this.onGW_GrigliaPrestazioniAfterRender});this.control(this.selContainer+"#BtnCauzioni",{click:this.onBtnCauzioniClick})},onPortletEditClassificazioniAfterRender:function(b,c){creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET","",!1,150);this.apridettaglioClassificazione(b)},onPortletEditClassificazioniCenter:function(b,c){creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET","",!1,150);this.svuotaDati()},onGW_GrigliaPrestazioniAfterRender:function(b,
c){var d=this;b.el.on("dblclick",function(){"undefined"!=typeof currOspite&&d.cbaConfig.controllerFascicolo.currentDip?Ext.create("winCBA",{permesso:d.cbaConfig.permesso,name:"GeneraliOSP.portlet.view.EdtScontiSupp",titolo:"SCONTI/SUPPLEMENTI",nominativo:currOspite.nominativo,dimensione:8,configItem:{permesso:d.cbaConfig.permesso,currRicovero:currRicovero,noPortlet:!1,controllerPortlet:d,codiceClassRetta:d.codiceClassRetta,idExtraRetta:d.getGW_GrigliaPrestazioni().getSelectionModel().getSelection()[0]?
d.getGW_GrigliaPrestazioni().getSelectionModel().getSelection()[0].data.idExtraRetta:null}}).show():Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")})},onBtnCauzioniClick:function(b,c,d){"undefined"!=typeof currOspite&&this.cbaConfig.controllerFascicolo.currentDip?Ext.create("winCBA",{permesso:this.cbaConfig.permesso,name:"GeneraliOSP.portlet.view.EstrattoConto",nominativo:currOspite.nominativo,titolo:"OSP_ESTRATTOCONTO",dimensione:1,configItem:{permesso:this.cbaConfig.permesso,
itemId:"EstrattoConto",reference:"EstrattoConto"+Ext.Date.now(),soloCauzioni:!0}}).show():Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")},svuotaDati:function(){this.getContainer().removeAll();this.getClassRegionale().setText("");this.getClassInterna().setText("")},updateDati:function(b){this.svuotaDati();getModulo("EditClassificazioni");getPermesso("EditClassificazioni");var c=this.getContainer().up("portlet").header;c.tools.plus||c.insert(1,{type:"plus",tooltip:traduci("TITOLO_RILEVAZIONECDI"),
handler:function(){if("undefined"!=typeof currOspite){var b=trovaButtonMenu("btnRilevazioneCDI");if(b){var c=Sipcar.app.getController("Menu").getCardApplicativo().getLayout().getActiveItem().down("tabpanel"),d=c.queryById("tab_RilevazioneCDI");d||(b.nonCercare=!0,b.handler(),b.nonCercare=!1,d=c.queryById("tab_RilevazioneCDI"));c.setActiveTab("tab_RilevazioneCDI");d.queryById("ParametriRicerca").controller.cerca({codOspite:currOspite.codOspite})}else msgShowError("","MSG_NO_PERMESSI")}}});var d="GeneraliOSP.portlet.view.PortletClassificazioniRes";
"R"==currRicovero.servizio.tipoServizio||"G"==currRicovero.servizio.tipoServizio?c.tools.plus.hide():(d="M"==currRicovero.servizio.tipoServizio?"GeneraliOSP.portlet.view.PortletClassificazioniAmb":"GeneraliOSP.portlet.view.PortletClassificazioniSemiRes",c.tools.plus.show());c=Ext.create(d,{cbaConfig:{controllerPortlet:this}});this.getContainer().add(c);c.controller.updateDati(b);this.scriviLabel(this.getClassRegionale(),this.lblClassRegio,b.classRegionale,b.statoClassRegionale);this.scriviLabel(this.getClassInterna(),
this.lblClassInt,b.classInterna,b.statoClassInterna);if(b.extra){c=[];for(d=0;d<b.extra.length;d++)"C"==b.extra[d].tipo&&"N"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti&&c.push(b.extra[d]),"S"==b.extra[d].tipo&&"N"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi&&c.push(b.extra[d]);b.extra=c}b.extra&&0<b.extra.length&&(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)?null==b.extra[0].dataAl||!Ext.isEmpty(b.extra[0].dataAl)&&new Date(b.extra[0].dataAl)>=
new Date((new Date).setHours(0,0,0,0))?(this.getGW_GrigliaPrestazioni().getStore().loadData(b.extra),this.getGW_GrigliaPrestazioni().getSelectionModel().select(0)):svuotaStore(this.getGW_GrigliaPrestazioni().getStore()):svuotaStore(this.getGW_GrigliaPrestazioni().getStore())},scriviLabel:function(b,c,d,f){var g='class="cbaFieldDisplay"';"T"==f&&(g='style="text-decoration: line-through; font-style: italic !important;"');b.update('<span class="cbaLabel">'+(c?traduci(c):"")+"</span>  <span "+g+">"+(d?
d:"")+"</span>")},apridettaglioClassificazione:function(b){var c=this;b.el.on("dblclick",function(){if("undefined"!=typeof currOspite&&c.cbaConfig.controllerFascicolo.currentDip){var b="RES";"S"==currRicovero.servizio.tipoServizio||"A"==currRicovero.servizio.tipoServizio||"D"==currRicovero.servizio.tipoServizio?b="CDI":"M"==currRicovero.servizio.tipoServizio&&(b="AMB");Ext.create("winCBA",{permesso:c.cbaConfig.permesso,name:"GeneraliOSP.portlet.view.EdtClassificazioni",titolo:"OSP_CLASSIFICAZIONI",
nominativo:currOspite.nominativo,dimensione:8,configItem:{permesso:c.cbaConfig.permesso,currRicovero:currRicovero,noPortlet:!1,controllerPortlet:c,controllerFascicolo:c.cbaConfig.controllerFascicolo,tipoClRetta:b,hideClassReg:!1,hideClassInt:!1}}).show()}else Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")})},impostaModalitaAdtSemplificato:function(){var b=this.getGW_GrigliaPrestazioni();this.modalitaAdtSemplificato?(b.columnManager.getHeaderByDataIndex("quotaSanitariaFatt").hide(),
b.columnManager.getHeaderByDataIndex("quotaSocialeFatt").hide(),b.columnManager.getHeaderByDataIndex("totaleFatt").hide()):(b.columnManager.getHeaderByDataIndex("quotaSanitariaFatt").show(),b.columnManager.getHeaderByDataIndex("quotaSocialeFatt").show(),b.columnManager.getHeaderByDataIndex("totaleFatt").show())},updatePortlet:function(){var b=this;currRicovero&&currRicovero.idRicovero?(b.modalitaAdtSemplificato=!1,CBA.StdUtenti.getImpostazioniServizio(CBA.moduli.moduloAttivo,currRicovero.servizio.idServizio).then(function(c){b.modalitaAdtSemplificato=
1==c.modalitaIntZucchetti?!0:!1;b.impostaModalitaAdtSemplificato()})["catch"](function(b){return msgShowError("",b)}),b.store.getProxy().extraParams.idRicovero=currRicovero.idRicovero,b.store.getProxy().extraParams.dataRif=new Date(currRicovero.dataAl),b.store.load({callback:function(c,d,f){f?c&&0<c.length?(b.updateDati(c[0].data),currRicovero.classificazionePresente=null!=c[0].data.idClassRetta?!0:!1,b.codiceClassRetta=c[0].data.codiceClassRetta):(b.svuotaDati(),currRicovero.classificazionePresente=
!1):msgShowError("Portlet Classificazioni",d.getError())}})):b.svuotaDati()},onLaunch:function(){this.getContainer().controller=this;this.store=Ext.create("GeneraliOSP.portlet.store.RettePrestazioni");ImpostaUrl([this.store]);CBA.moduli.modulo43.abilitato||50==CBA.moduli.moduloAttivo||(this.getPnlScontiSupplementi().setHeight(null),this.getPnlScontiSupplementi().setVisible(!1))},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletClassificazioniAmb",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridRetteAmb",selector:this.selContainer+"#GridRetteAmb"}]);this.control(this.selContainer+"#GridRetteAmb",{afterrender:this.onGridpanelAfterRender})},onGridpanelAfterRender:function(b,c){this.cbaConfig.fromRilevazioniCdi||creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET","")},updateDati:function(b){var c=
this;c.cbaConfig.fromRilevazioniCdi||(b=currRicovero.idRicovero);c.getGridRetteAmb().store.getProxy().extraParams.idRicovero=b;c.getGridRetteAmb().store.load({callback:function(b,f,g){b&&0<b.length?(c.getGridRetteAmb().getSelectionModel().select(0),c.cbaConfig.fromRilevazioniCdi||(currRicovero.classificazionePresente=!0)):c.cbaConfig.fromRilevazioniCdi||(currRicovero.classificazionePresente=!1)}})},onLaunch:function(){this.controller=this;ImpostaUrl([this.getGridRetteAmb().getStore()])},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletClassificazioniRes",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"tableRetta",selector:this.selContainer+"#tableRetta"}])},svuotaDati:function(){this.getTableRetta().setText("")},impostaModalitaAdtSemplificato:function(b){var c="",d="",f="",g='class="cbaFieldDisplay '+(0>=b.idClassRetta?" cbaLabelRed":"")+"'\"";"T"==b.statoClassRetta&&(g='style="text-decoration: line-through; font-style: italic !important;"');
var h=b.classRetta;h||(h="");this.getTableRetta().removeCls("cbaLabel");if(this.cbaConfig.controllerPortlet.modalitaAdtSemplificato)this.getTableRetta().update('<table><tr><td class="cbaLabel" >'+traduci("RETTE_RETTA_PRESENZA")+"</td></tr><tr><td "+g+">"+h+"</td></tr></table>");else{var k=Ext.util.Format.currencySign;"T"==b.isQuotaRettaPercentuale&&(k="%");b.quotaSanitFatt&&(c=formatFloat(b.quotaSanitFatt)+k);b.quotaSocialeFatt&&(d=formatFloat(b.quotaSocialeFatt)+k);b.totaleRettaPresenza&&(f=formatFloat(b.totaleRettaPresenza)+
k);this.getTableRetta().update('<table><tr><td class="cbaLabel" style="width:150px !important">'+traduci("RETTE_RETTA_PRESENZA")+'</td><td class="cbaLabel" style="text-align:right!important; width:60px !important">'+traduci("Q_SAN")+'</td><td class="cbaLabel" style="text-align:right!important; width:60px !important">'+traduci("Q_SOC")+'</td><td class="cbaLabel" style="text-align:right!important; width:65px !important">'+traduci("TOTALE")+"</td></tr><tr><td "+g+">"+h+'</td><td class="cbaFieldDisplay cbaAlignRight">'+
c+'</td><td class="cbaFieldDisplay cbaAlignRight">'+d+'</td><td class="cbaFieldDisplay cbaAlignRight">'+f+"</td></tr></table>")}},updateDati:function(b){this.svuotaDati();this.impostaModalitaAdtSemplificato(b)},onLaunch:function(){this.controller=this},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletClassificazioniSemiRes",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridRetteSemiRed",selector:this.selContainer+"#GridRetteSemiRed"}]);this.control(this.selContainer+"#GridRetteSemiRed",{beforerender:this.onGridRetteSemiRedBeforeRender,afterrender:this.onGridpanelAfterRender})},onGridpanelAfterRender:function(b,c){creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET",
"");this.getGridRetteSemiRed().columns[getGiornoAttuale()].addCls("selezionato")},onGridRetteSemiRedBeforeRender:function(b,c){Localizer.localize(Ext.getCmp(this.id))},updateDati:function(b){var c=this;this.getGridRetteSemiRed().store.getProxy().extraParams.idRicovero=currRicovero.idRicovero;this.getGridRetteSemiRed().store.load({callback:function(b,f,g){b&&0<b.length?(c.getGridRetteSemiRed().getSelectionModel().select(0),currRicovero.classificazionePresente=!0):currRicovero.classificazionePresente=
!1}})},renderGG:function(b,c,d){"T"==c&&(d.tdCls="icon-selezionato")},onLaunch:function(){this.controller=this;ImpostaUrl([this.getGridRetteSemiRed().getStore()])},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletContatti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"}])},onLaunch:function(){this.getContainer().controller=this;var b=this.getContainer().getStore();ImpostaUrl([b])},destroy:function(){this.callParent()},updatePortlet:function(){var b=this.getContainer().getStore(),c=this.cbaConfig.controllerFascicolo.currentDip;
c&&b.load({params:{codospite:c},callback:function(b,c,g){g||msgShowError("",c.getError())}})}});
Ext.define("GeneraliOSP.portlet.controller.PortletDocumenti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"}])},onLaunch:function(){this.getContainer().controller=this;var b=this.getContainer().getStore();ImpostaUrl([b])},destroy:function(){this.callParent()},updatePortlet:function(){var b=this,c=b.getContainer(),d=c.getStore(),f=b.cbaConfig.controllerFascicolo.currentDip,
g=b.cbaConfig.controllerFascicolo.idRicovero,h=b.cbaConfig.controllerFascicolo.idRicoveroCs;if(!g||0>=g)g=-1;if(!h||0>=h)h=-1;f&&d.load({params:{codospite:f,idRicovero:g,idRicoveroCs:h},callback:function(f,g,h){h?(f=trovaButtonMenu("btnOSP_Anagrafica"))&&f.cbaConfig.cmdName&&("CU_DOC_IN_SCADENZA"==f.cbaConfig.cmdName||"CU_DOC_SCADUTO"==f.cbaConfig.cmdName)&&(g=trovaRecord(d,"id",f.cbaConfig.idDocumento),c.getSelectionModel().deselectAll(),c.getSelectionModel().select(g?[g]:0),f.cbaConfig.cmdName=
null,f.cbaConfig.idDocumento=null,b.view.container.up().up().fireEvent("dblclick")):msgShowError("",g.getError())}})}});
Ext.define("GeneraliOSP.portlet.controller.PortletEstrattoConto",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"LbCauzioneSaldo",selector:this.selContainer+"#LbCauzioneSaldo"},{ref:"LbCauzione",selector:this.selContainer+"#LbCauzione"},{ref:"LbCauzioneAltra",selector:this.selContainer+"#LbCauzioneAltra"}])},svuotaDati:function(){this.getContainer().hide();
this.getLbCauzioneSaldo().hide();this.getLbCauzione().hide();this.getLbCauzioneAltra().hide()},updatePortlet:function(){var b=this,c=b.getContainer().getStore();currRicovero&&currRicovero.servizio&&"L"!=currRicovero.servizio.tipoServizio?(b.personContabili=getPersonContabili(currRicovero.idServizio,new Date,!1,null),c.load({params:{idRicovero:currRicovero.idRicovero,dataDal:domani(),dataAl:dataFineMese(12,(new Date).getFullYear()),tipoContabilita:b.personContabili.tipoContabilitaAbilitata,idEsercizio:Ext.isEmpty(b.personContabili.idEsercizio)?
-1:b.personContabili.idEsercizio,idAttivita:Ext.isEmpty(b.personContabili.attivita)?-1:b.personContabili.attivita,hideInizioAttesa:!0},callback:function(c,f,g){var d=0,k=0,l=0;g?(Ext.Ajax.request({method:"GET",url:"/cba/osp/co/ws/escont/cauz/tot",params:{idRicovero:currRicovero.idRicovero},async:!1,success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){var d=b.getLbCauzione();b.getContainer().setVisible(!0);b.getLbCauzioneAltra().setVisible(!0);d.setVisible(c.data);k=c.data;d.setValue(formatFloat(k,
2,!0));b.getLbCauzioneSaldo().setVisible(!0);b.getLbCauzioneSaldo().setValue(k)}else msgShowError("",c.message)}}),Ext.Ajax.request({method:"GET",url:"/cba/osp/co/ws/escont/cauzOther/tot",params:{idRicovero:currRicovero.idRicovero,al:currRicovero.al},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?(b.getLbCauzioneAltra().setVisible(c.success),l=c.data,b.getLbCauzioneAltra().setValue(formatFloat(l,2,!0)),d=k+l,b.getLbCauzioneSaldo().setValue(formatFloat(d,2,!0))):msgShowError("",c.message)}})):
msgShowError("",f.getError())}})):b.svuotaDati()},onLaunch:function(){this.getContainer().controller=this;this.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null);["2","4","5"].includes(this.personContabili.tipoContabilitaAbilitata)||this.getContainer().hide();var b=this.getContainer().getStore();ImpostaUrl([b])},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletFAR",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"CntDatiAssistenziali",selector:this.selContainer+"#CntDatiAssistenziali"},{ref:"CntBINA",selector:this.selContainer+"#CntBINA"}]);this.control(this.selContainer+"#Container",{afterrender:this.onPortletFARAfterRender})},onPortletFARAfterRender:function(b,
c){creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET","",!1,150);this.dblclickFAR(b)},dblclickFAR:function(b){var c=this;b.el.on("dblclick",function(){"undefined"!=typeof currRicovero&&c.cbaConfig.controllerFascicolo.idRicovero?CBA.moduli.modulo55.abilitato?eseguiModulo(55,"btnOSP_Anagrafica",{codOspite:currOspite.id}):Messaggio("Attenzione","MSG_MODULO_NON_ABILITATO","OK","WARNING"):Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")})},updatePortlet:function(){this.getCntDatiAssistenziali().down("#Container").controller.updatePortlet();
this.getCntBINA().down("#Container").controller.updatePortlet()},onLaunch:function(){this.getContainer().controller=this;var b=Ext.create("GeneraliOSP.portlet.view.PortletFARDati"),c=Ext.create("GeneraliOSP.portlet.view.PortletFARBina");this.getCntDatiAssistenziali().add(b);this.getCntBINA().add(c);this.getCntBINA().title=traduci("OSP_FARBINA")},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletFARBina",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"StatoBINA",selector:this.selContainer+"#StatoBINA"}]);this.control(this.selContainer+"#Container",{afterrender:this.onPortletFARBinaAfterRender})},onPortletFARBinaAfterRender:function(b,c){creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET","",
!1,150);this.dblclickFARBina(b)},apriBina:function(){if("undefined"!=typeof currRicovero&&currRicovero.idRicovero){if(55==getModuloAttivo()){var b={idRicovero:null,idRicoveroCu:currRicovero.idRicovero,codOspite:currOspite.codOspite},c=[],d={},f={nomeForm:"GeneraliCS.schede.bina.view.Bina",titolo:traduci("OSP_FARBINA"),iconCls:"menu-fascicolo-utenti"};Ext.apply(d,{codEnte:CBA.parametriGenerali.codEnte,codModulo:55,codProfilo:CBA.parametriGenerali.codProfilo,codVideata:32,desVideata:traduci("OSP_FARBINA"),
id:null,idProfiloPwdDe:null,idVideata:null,tipoPermesso:"S",voceMenu:f});c.push(d);Ext.create("CSS_winCBA",{name:"GeneraliCS.popup.view.Popup",titolo:traduci("OSP_FARBINA"),visualizzaAnagrafica:currOspite,configItem:{elencoVideate:c,standAlone:!0,portlet:!1,nuovoDefault:!1,permesso:this.cbaConfig.permesso,codOspitePopUp:currOspite.codOspite,nominativoPopUp:currOspite.cognome+currOspite.nome,videataDettaglio:"GeneraliCS.schede.bina.view.Bina",sottoTipoTestata:32,compilatore:this.compilatore,anagraficaExtra:b,
dataInizioPratica:currRicovero.dataInizioPratica,areaValutazioneExists:this.areaValutazioneExists,controllerPortlet:this}}).cssDefaultShow()}}else Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")},dblclickFARBina:function(b){var c=this;b.el.on("dblclick",function(){if(currRicovero.servizio.codiceStruttura)c.apriBina();else{var b=[];msgAddError(b,"FAR_CODSTRUTTURA_OBBLIGATORIO");return msgShow("",b)}})},updatePortlet:function(){var b=this,c=b.getContainer(),d=null!=currRicovero?
currRicovero.idRicovero:null;b.getStatoBINA().setVisible(!1);clearForm(c);if(d){var f=(new Date).setHours(0,0,0,0),g=currRicovero.dataDal.getTime();b.store.load({params:{idRicovero:d},callback:function(d,k,l){l?d&&((k=d[0])?(c.getForm().setValues({id:k.data.id,compilatore:k.data.compilatore,desPunteggio:k.data.desPunteggio,dataValutazione:FormattaData(k.data.dataValutazione),dataScadenza:FormattaData(k.data.dataScadenza)}),d=864E5*k.data.giorniModifiche,k=k.data.dataScadenza.getTime(),f<k-d?b.getStatoBINA().setSrc("/cba/generali/images/16/css-icon-green.png"):
f<=k&&f>=k-d?b.getStatoBINA().setSrc("/cba/generali/images/16/css-icon-orange.png"):f>k&&b.getStatoBINA().setSrc("/cba/generali/images/16/css-icon-red.png"),(d=trovaButtonMenu("btnOSP_Anagrafica"))&&d.cbaConfig.cmdName&&"FAR_BINA_RIVALUTAZIONE"==d.cbaConfig.cmdName&&(d.cbaConfig.cmdName=null,b.apriBina())):f>g+1296E6?b.getStatoBINA().setSrc("/cba/generali/images/16/css-icon-red.png"):b.getStatoBINA().setSrc("/cba/generali/images/16/css-icon-blue.png"),b.getStatoBINA().setVisible(!0)):msgShowError("",
k.getError())}})}d=b.getContainer().up("portlet").header;d.tools.plus||d.insert(1,{type:"plus",tooltip:traduci("FAR_BINA_NEW"),handler:function(){}});55==getModuloAttivo()?d.tools.plus.show():d.tools.plus.hide()},areaValutazioneExists:function(){var b=!1;if(55==getModuloAttivo()){var c={},d=0;CBA.moduli.modulo38.abilitato&&CBA.moduli.modulo38.installato&&(d=38);CBA.moduli.modulo49.abilitato&&CBA.moduli.modulo49.installato&&(d=49);if(38==d||49==d)Object.assign(c,{codModulo:d}),Ext.Ajax.request({method:"GET",
url:"/cba/osp/far/ws/schedaFAR/areaValutazione/exists",params:c,async:!1,success:function(c){c=Ext.JSON.decode(c.responseText);c.success?b=!Ext.isEmpty(c.data):msgShowError("",c.message)}})}return b},onLaunch:function(){var b=this;b.getContainer().controller=b;b.store=Ext.create("GeneraliOSP.portlet.store.FARBina");ImpostaUrl([b.store]);55==getModuloAttivo()&&(b.compilatore={idCompilatore:null,idOperatore:null,nominativo:"",tipo:"",figuraProfessionale:""},Ext.Ajax.request({url:"/cba/osp/far/ws/schedaFAR/compilatore/get",
method:"GET",async:!0,params:{idOperatore:CBA.parametriGenerali.codUtente},success:function(c){c=Ext.JSON.decode(c.responseText);c.success&&c.data&&(b.compilatore=c.data)}}));b.areaValutazioneExists=this.areaValutazioneExists()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletFARDati",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"StatoFRNA",selector:this.selContainer+"#StatoFRNA"}]);this.control(this.selContainer+"#Container",{afterrender:this.onPortletFARDatiAfterRender})},onPortletFARDatiAfterRender:function(b,c){43==getModuloAttivo()?this.dblclickFARDati(b):!1},
dblclickFARDati:function(b){b.el.on("dblclick",function(){"undefined"!=typeof currRicovero&&currRicovero.idRicovero||Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING")})},updatePortlet:function(){var b=this,c=b.getContainer(),d=null!=currRicovero?currRicovero.idRicovero:null;b.getStatoFRNA().setVisible(!1);clearForm(c);d&&b.store.load({params:{idRicovero:d},callback:function(d,g,h){h?d&&(d=d[0])&&(currRicovero.dataInizioPratica=d.data.data_inizio?d.data.data_inizio:null,
c.getForm().setValues({id:d.data.id,numPratica:d.data.annoPratica+" - "+d.data.numPratica,desStruttura:d.data.codStruttura+" - "+currRicovero.desServizio,data_inizio:FormattaData(d.data.data_inizio),data_fine:FormattaData(d.data.data_fine),desPosContabile:d.data.desPosContabile,aCaricoFRNA:d.data.aCaricoFRNA}),b.getStatoFRNA().setVisible(!0),"1"==d.data.aCaricoFRNA?(b.getStatoFRNA().removeCls("icon-elimina"),b.getStatoFRNA().addCls("icon-ok")):(b.getStatoFRNA().removeCls("icon-ok"),b.getStatoFRNA().addCls("icon-elimina")),
(d=trovaButtonMenu("btnOSP_Anagrafica"))&&d.cbaConfig.cmdName&&"FAR_DATI_PERMANENZABREVE"==d.cbaConfig.cmdName&&(d.cbaConfig.cmdName=null,b.view.container.up().up().fireEvent("dblclick"))):msgShowError("",g.getError())}})},onLaunch:function(){this.getContainer().controller=this;this.store=Ext.create("GeneraliOSP.portlet.store.FARDati");ImpostaUrl([this.store])},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletFlussiRegionali",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"StatoFSR",selector:this.selContainer+"#StatoFSR"},{ref:"MotChiusura",selector:this.selContainer+"#MotChiusura"}])},updatePortlet:function(b){var c=this;49==CBA.moduli.moduloAttivo?loadCurrRicoveroFromCSS(b,function(){c.updatePortletFR()}):
this.updatePortletFR()},updatePortletFR:function(){var b=this,c=b.getContainer(),d=null!=currRicovero?currRicovero.idRicovero:null;clearForm(c);if(d){if(49==CBA.moduli.moduloAttivo){var f=!0,g="";currRicovero?currRicovero&&![13,14,15].includes(currRicovero.servizio.tipoFlusso)?g="FR_MSG_PORTLET_ERR_NOSDO":f=!1:g="FR_MSG_PORTLET_ERR_RICOVEROCU2";b.getContainer().setDisabled(f);if(f){msgShowError("PORTLET_SDO",g);return}}else currRicovero.servizio&&currRicovero.servizio.tipoFlusso&&(f=CBA.StdUtenti.getFlussoRegionaleDesc(currRicovero.servizio.tipoFlusso),
c.setTitle(f?f:""));Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/fr/pratiche/search",params:{idRicovero:d,conValutazioni:currRicovero.servizio&&[13,14,15].includes(currRicovero.servizio.tipoFlusso)?"T":"F"},success:function(d){d=Ext.JSON.decode(d.responseText);d.success?!Ext.isEmpty(d.data)&&(d=d.data[0])&&(c.getForm().setValues({id:d.id,annoNumPratica:d.annoNumPratica,desStruttura:d.codStruttura+" - "+currRicovero.desServizio,dal:FormattaData(d.dal),al:FormattaData(d.al),desMotChiusura:d.desMotChiusura}),
currRicovero.servizio&&currRicovero.servizio.tipoFlusso&&([13,14,15].includes(currRicovero.servizio.tipoFlusso)?(b.getMotChiusura().setVisible(!0),currRicovero.praticaSDOConvalidata="T"==d.isConvalidata):b.getMotChiusura().setVisible(!1))):msgShowError("",d.message)}})}},onLaunch:function(){this.getContainer().controller=this},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletListaAttesa",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"}])},onLaunch:function(){this.getContainer().controller=this;this.cbaConfig.larghezzaWin=1024;this.cbaConfig.altezzaWin=580;CBA.moduli.modulo48.portletLista=this.getContainer()},destroy:function(){this.callParent()},updatePortlet:function(){var b=
this.getContainer().getStore(),c=this.cbaConfig.controllerFascicolo.idRicovero;c&&b.load({params:{idRicovero:c,dataDal:domani(),dataAl:dataFineMese(12,(new Date).getFullYear())},callback:function(b,c,g){g||msgShowError("",c.getError())}})}});
Ext.define("GeneraliOSP.portlet.controller.PortletOSP_Residenziale",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"BtnGestioneAssenze",selector:this.selContainer+"#BtnGestioneAssenze"},{ref:"AbilitaAccompagnatore",selector:this.selContainer+"#AbilitaAccompagnatore"}]);this.control(this.selContainer+"#BtnGestioneAssenze",{click:this.onButtonAssenzeClick})},
onButtonAssenzeClick:function(b,c,d){(b=this.cbaConfig.controllerFascicolo)&&b.idRicovero&&(c=2,"S"!=currRicovero.servizio.tipoServizio&&"A"!=currRicovero.servizio.tipoServizio&&"M"!=currRicovero.servizio.tipoServizio&&(c=8),Ext.create("winCBA",{permesso:b.cbaConfig.permessoEditAssenze,name:"GeneraliOSP.portlet.view.Assenze",titolo:"TITOLO_EDITASSENZE",nominativo:currOspite.nominativo,dimensione:c,altezzaWin:665,configItem:{permesso:b.cbaConfig.permessoEditAssenze,codOspite:b.currentDip,ricerca:b.Ricerca}}).show())},
onLaunch:function(){this.getContainer().controller=this;this.store=Ext.create("GeneraliOSP.portlet.store.Residenziale");ImpostaUrl([this.store]);48==CBA.moduli.moduloAttivo&&this.getBtnGestioneAssenze().setVisible(!1)},destroy:function(){this.callParent()},updatePortlet:function(){var b=this.cbaConfig.controllerFascicolo.idRicovero,c=this.getContainer();clearForm(c);var d=this.getAbilitaAccompagnatore();d.hide();if(b)if(currRicovero){var f="d/m/Y",g=currRicovero.idServizio;Ext.isEmpty(g)||CBA.StdUtenti.getImpostazioniServizio(CBA.moduli.moduloAttivo,
g).then(function(b){d.setVisible("T"==b.abilitaAccompagnatore);b.abilitaOraResidenziale&&(f="d/m/Y H:i")})["catch"](function(b){return msgShowError("",b)});this.getContainer().setVisible(!0);this.store.load({params:{idRicovero:b},callback:function(b,d,g){if(g){if(b&&(d=b.find(function(b){return"U"===b.get("tipoRecord")}))){g=(d.data.numeroStanza?d.data.numeroStanza:"")+(d.data.numeroStanza?" - ":"")+(d.data.desStanza?d.data.desStanza:"");var h=(d.data.numeroLetto?d.data.numeroLetto:"")+(d.data.numeroLetto?
" - ":"")+(d.data.desLetto?d.data.desLetto:"");b=b.findLast(function(b){return"R"===b.get("tipoRecord")})?"PRESENTE":"NON PRESENTE";c.getForm().setValues({id:d.data.idResidenza,dataDal:FormattaData(d.data.dataDal,f),desSede:d.data.desSede,desReparto:d.data.desReparto,desStanza:g,desLetto:h,desAccompagnatore:b})}}else msgShowError("",d.getError())}})}else this.svuotaDati()},svuotaDati:function(){this.getContainer().hide()}});
Ext.define("GeneraliOSP.portlet.controller.PortletPensioni",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"}])},updatePortlet:function(){var b=this.getContainer().getStore(),c=this.cbaConfig.controllerFascicolo.idRicovero;c&&(currRicovero?(this.getContainer().setVisible(!0),b.load({params:{idRicovero:c,data:new Date,soloAttivi:!0},callback:function(b,
c,g){g||msgShowError("",c.getError())}})):this.getContainer().hide())},onLaunch:function(){this.getContainer().controller=this},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletRAPBudget",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"InfoBdgStruttura",selector:this.selContainer+"#InfoBdgStruttura"},{ref:"residuostruttura",selector:this.selContainer+"#residuostruttura"},{ref:"Residuoutente",selector:this.selContainer+"#Residuoutente"}])},updatePortlet:function(){var b=
this,c=b.getContainer();b.svuotaForm(c);if(0<b.cbaConfig.controllerFascicolo.view.down("#DatiAggiuntivi").items.map.DatiAggiuntivi.refs.GridRicoveri.getStore().getData().length){var d=b.cbaConfig.controllerFascicolo.currentDip,f=b.cbaConfig.controllerFascicolo.currentServizio,g=(new Date).getFullYear();null!=d&&null!=f&&null!=g&&b.store.load({params:{idAnagrafica:d,idServizio:f,anno:g},callback:function(d,f,g){g&&d&&((g=d[0])?(c.loadRecord(g),0>d.residuostruttura&&b.getResiduostruttura().setFieldStyle("color: red;"),
0>d.residuoutente&&b.getResiduoutente().setFieldStyle("color: red;")):msgShowError("",f.getError()))}})}},svuotaForm:function(b){clearForm(b)},onLaunch:function(){this.getContainer().controller=this;this.store=Ext.create("GeneraliOSP.portlet.store.RapBudget")},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletRAPPai",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"ElencoPrestazioni",selector:this.selContainer+"#ElencoPrestazioni"}])},updatePortlet:function(){var b=this.getContainer(),c=this.getElencoPrestazioni().getStore(),d=this.cbaConfig.controllerFascicolo.idRicovero;clearForm(b);c.removeAll();
0<this.cbaConfig.controllerFascicolo.view.down("#DatiAggiuntivi").items.map.DatiAggiuntivi.refs.GridRicoveri.getStore().getData().length&&d&&b.store.load({params:{idRicovero:d},callback:function(d,g,h){h?(clearForm(b),c.removeAll(),Ext.isEmpty(d)||(b.loadRecord(d[0]),d[0].data&&0<d[0].data.id&&c.load({params:{idPai:d[0].data.id},callback:function(b,c,d){d||msgShowError("",c.getError())}}))):msgShowError("",g.getError())}})},onLaunch:function(){this.getContainer().controller=this;this.getContainer().store=
Ext.create("GeneraliOSP.portlet.store.RapPai",{proxy:{url:"/cba/osp/rap/ws/rsaAperta/paiTe/byIdRicovero",api:{read:"",create:"",update:"",destroy:""}}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletRAPRequisiti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"imgEsitoPratica",selector:this.selContainer+"#imgEsitoPratica"},{ref:"imgIndennAcc",selector:this.selContainer+"#imgIndennAcc"},{ref:"imgServSoc",selector:this.selContainer+"#imgServSoc"}])},updatePortlet:function(){var b=this,c=b.getContainer();
b.svuotaForm(c);if(0<b.cbaConfig.controllerFascicolo.view.down("#DatiAggiuntivi").items.map.DatiAggiuntivi.refs.GridRicoveri.getStore().getData().length){var d=b.cbaConfig.controllerFascicolo.idRicovero;d&&b.store.load({params:{idRicovero:d},callback:function(d,g,h){h?d&&(d=d[0])&&(c.loadRecord(d),"T"==d.get("indAccompagnamento")?b.getImgIndennAcc().setSrc("/cba/generali/images/16/tree/checked.png"):b.getImgIndennAcc().setSrc("/cba/generali/images/16/tree/unchecked.png"),"T"==d.get("altriServSociali")?
b.getImgServSoc().setSrc("/cba/generali/images/16/tree/checked.png"):b.getImgServSoc().setSrc("/cba/generali/images/16/tree/unchecked.png"),"F"==d.get("requisitiEsito")&&null!=d.get("requisitiData")?b.getImgEsitoPratica().setSrc("/cba/generali/images/svg/others/circle-red.svg"):"T"==d.get("requisitiEsito")?b.getImgEsitoPratica().setSrc("/cba/generali/images/svg/others/circle-green.svg"):b.getImgEsitoPratica().setSrc("/cba/generali/images/svg/others/circle-gray.svg")):msgShowError("",g.getError())}})}},
svuotaForm:function(b){clearForm(b);this.getImgEsitoPratica().setSrc("/cba/generali/images/svg/others/circle-gray.svg");this.getImgIndennAcc().setSrc("/cba/generali/images/16/tree/unchecked.png");this.getImgServSoc().setSrc("/cba/generali/images/16/tree/unchecked.png")},onLaunch:function(){this.getContainer().controller=this;this.store=Ext.create("GeneraliOSP.portlet.store.RapRequisiti")},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletRAPSospensioni",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"}])},onLaunch:function(){this.getContainer().controller=this;var b=this.getContainer().getStore();ImpostaUrl([b])},destroy:function(){this.callParent()},updatePortlet:function(){var b=this.getContainer().getStore(),c=this.cbaConfig.controllerFascicolo.currentAss;
0<this.cbaConfig.controllerFascicolo.view.down("#DatiAggiuntivi").items.map.DatiAggiuntivi.refs.GridRicoveri.getStore().getData().length&&c&&b.load({params:{idRicovero:c},callback:function(c,f,g){if(g){var d=0;Ext.each(c,function(c){4<d&&b.remove(c);d++})}else msgShowError("",f.getError())}})}});
Ext.define("GeneraliOSP.portlet.controller.PortletRAPVmd",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"ImgErogMisura",selector:this.selContainer+"#ImgErogMisura"},{ref:"DataFinePraticaPortletVmd",selector:this.selContainer+"#DataFinePraticaPortletVmd"}])},updatePortlet:function(){var b=this,c=b.getContainer();b.svuotaForm(c);0<b.cbaConfig.controllerFascicolo.view.down("#DatiAggiuntivi").items.map.DatiAggiuntivi.refs.GridRicoveri.getStore().getData().length&&
(idRicovero=b.cbaConfig.controllerFascicolo.idRicovero)&&b.store.load({params:{idRicovero:idRicovero},callback:function(d,f,g){g?d&&(d=d[0])&&(c.loadRecord(d),null!=d.get("annoPratica")&&null!=d.get("numPratica")&&c.getForm().setValues({numPratica:d.get("annoPratica")+" - "+d.get("numPratica")}),"1"==d.get("erogazioneMisura")?b.getImgErogMisura().setSrc("/cba/generali/images/svg/others/circle-green.svg"):"2"==d.get("erogazioneMisura")||"3"==d.get("erogazioneMisura")?b.getImgErogMisura().setSrc("/cba/generali/images/svg/others/circle-red.svg"):
b.getImgErogMisura().setSrc("/cba/generali/images/svg/others/circle-gray.svg")):msgShowError("",f.getError())}})},svuotaForm:function(b){clearForm(b);this.getImgErogMisura().setSrc("/cba/generali/images/svg/others/circle-gray.svg")},onLaunch:function(){this.getContainer().controller=this;this.store=Ext.create("GeneraliOSP.portlet.store.RAPVmd")},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletReferenti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"}])},clearCampi:function(){},updatePortlet:function(){var b=this.getContainer().getStore(),c=this.cbaConfig.controllerFascicolo.currentDip;c&&b.load({params:{codospite:c},callback:function(b,c,g){g||msgShowError("",c.getError())}})},onLaunch:function(){this.getContainer().controller=
this;var b=this.getContainer().getStore();ImpostaUrl([b])},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.PortletRegionale",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"CntVeneto",selector:this.selContainer+"#CntVeneto"}]);this.control(this.selContainer+"#Container",{afterrender:this.onPortletRegionaleAfterRender})},onPortletRegionaleAfterRender:function(b,c){creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET",
"",!1,150);this.dblclickRegionale(b)},dblclickRegionale:function(b){var c=this;b.el.on("dblclick",function(){switch(c.cbaConfig.regione){case "V":c.apriPortletVeneto();break;default:msgShowError("REGION_NOT_P","REGION_NOT_P_DES")}})},updatePortlet:function(){var b=this;if(b.cbaConfig.controllerFascicolo.idRicovero&&currRicovero)switch(b.getContainer().setVisible(!0),b.store.load({params:{idRicovero:b.cbaConfig.controllerFascicolo.currentAss},callback:function(c,d,f){f&&(b.getContainer().getForm().reset(),
c&&((c=c[0])?b.getContainer().getForm().setValues({dataDal:FormattaData(c.data.dataDal),codiceClassificazione:c.data.desClassificazione,idImpegnativa:c.data.impegnativa}):b.getContainer().getForm().setValues({dataDal:null,codiceClassificazione:null,idImpegnativa:null})))}}),b.cbaConfig.tipoServizio=currRicovero.servizio.tipoServizio,b.cbaConfig.regione=currRicovero.servizio.regione,b.cbaConfig.regione){case "V":b.getCntVeneto().show()}else b.getContainer().hide()},apriPortletVeneto:function(){Ext.create("winCBA",
{permesso:this.cbaConfig.permesso,name:"GeneraliOSP.portlet.view.Regionale",titolo:traduci("OSP_Regionale"),nominativo:"undefined"!==typeof currOspite?currOspite.nominativo:null,dimensione:1,configItem:{permesso:this.cbaConfig.permesso,controllerFascicolo:this.cbaConfig.controllerFascicolo,controllerPortlet:this,portlet:this,tipoServizio:this.cbaConfig.tipoServizio,regione:this.cbaConfig.regione}}).show()},onLaunch:function(){this.getContainer().controller=this;this.store=Ext.create("GeneraliOSP.portlet.store.ClassRegionale");
ImpostaUrl([this.store])},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.RAPBudget",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:b+"#Container"},{ref:"BtnEsci",selector:b+"#BtnEsci"},{ref:"StanziatostruttperTrim2",selector:b+"#StanziatostruttperTrim2"},{ref:"StanziatostruttperTrim3",selector:b+"#StanziatostruttperTrim3"},{ref:"StanziatostruttperTrim4",selector:b+"#StanziatostruttperTrim4"},{ref:"TotaleStanziatoStruttura",
selector:b+"#TotaleStanziatoStruttura"},{ref:"Trim1resUtente",selector:b+"#Trim1resUtente"},{ref:"Trim2resUtente",selector:b+"#Trim2resUtente"},{ref:"Trim3resUtente",selector:b+"#Trim3resUtente"},{ref:"trim4resUtente",selector:b+"#trim4resUtente"},{ref:"Trim1resStrutt",selector:b+"#Trim1resStrutt"},{ref:"Trim2resStrutt",selector:b+"#Trim2resStrutt"},{ref:"Trim3resStrutt",selector:b+"#Trim3resStrutt"},{ref:"Trim4resStrutt",selector:b+"#Trim4resStrutt"},{ref:"TotaleResiduoUtente",selector:b+"#TotaleResiduoUtente"},
{ref:"TotaleResiduoStruttura",selector:b+"#TotaleResiduoStruttura"}]);this.control(b+"#BtnEsci",{click:this.clickBtnEsci})},clickBtnEsci:function(b){this.getContainer().up("window").close()},onLaunch:function(){var b=this;b.getContainer().controller=b;b.store=Ext.create("GeneraliOSP.portlet.store.RapBudget");var c=b.getContainer(),d=b.cbaConfig.controllerFascicolo.currentDip,f=b.cbaConfig.controllerFascicolo.currentServizio,g=(new Date).getFullYear();null!=d&&null!=f&&null!=g&&b.store.load({params:{idAnagrafica:d,
idServizio:f,anno:g},callback:function(d,f,g){g&&d&&((d=d[0])?(c.loadRecord(d),b.getStanziatostruttperTrim2().setValue(d.data.trim1resStrutt),b.getStanziatostruttperTrim3().setValue(d.data.trim2resStrutt),b.getStanziatostruttperTrim4().setValue(d.data.trim3resStrutt),b.getTotaleStanziatoStruttura().setValue(d.data.stanziatostruttura),0>d.data.trim1resUtente&&b.getTrim1resUtente().setFieldStyle("color: red;"),0>d.data.trim2resUtente&&b.getTrim2resUtente().setFieldStyle("color: red;"),0>d.data.trim3resUtente&&
b.getTrim3resUtente().setFieldStyle("color: red;"),0>d.data.trim4resUtente&&b.getTrim4resUtente().setFieldStyle("color: red;"),0>d.data.totaleResiduoUtente&&b.getTotaleResiduoUtente().setFieldStyle("color: red;"),0>d.data.trim1resStrutt&&b.getTrim1resStrutt().setFieldStyle("color: red;"),0>d.data.trim2resStrutt&&b.getTrim2resStrutt().setFieldStyle("color: red;"),0>d.data.trim3resStrutt&&b.getTrim3resStrutt().setFieldStyle("color: red;"),0>d.data.trim4resStrutt&&b.getTrim4resStrutt().setFieldStyle("color: red;"),
0>d.data.totaleResiduoStruttura&&b.getTotaleResiduoStruttura().setFieldStyle("color: red;")):msgShowError("",f.getError()))}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.RAPPai",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.mesi=[traduci("GEN"),traduci("FEB"),traduci("MAR"),traduci("APR"),traduci("MAG"),traduci("GIU"),traduci("LUG"),traduci("AGO"),traduci("SET"),traduci("OTT"),traduci("NOV"),traduci("DIC")];this.addRef([{ref:"CtnStorico",selector:this.selContainer+"#CtnStorico"},{ref:"CmbChiusura",selector:this.selContainer+"#CmbChiusura"},
{ref:"ColProfessione",selector:this.selContainer+"#ColProfessione"},{ref:"ColPrestazione",selector:this.selContainer+"#ColPrestazione"},{ref:"CntEditPai",selector:this.selContainer+"#CntEditPai"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"StoricoGridVMD",selector:this.selContainer+"#StoricoGridVMD"},{ref:"GrigliaPAI",selector:this.selContainer+"#GrigliaPAI"},{ref:"btnNuovo",selector:this.selContainer+"#btnNuovo"},{ref:"btnElimina",selector:this.selContainer+"#btnElimina"},{ref:"btnRilevazione",
selector:this.selContainer+"#btnRilevazione"},{ref:"FrmTestata",selector:this.selContainer+"#FrmTestata"},{ref:"DataInizioPai",selector:this.selContainer+"#DataInizioPai"},{ref:"DataChiusuraPai",selector:this.selContainer+"#DataChiusuraPai"},{ref:"LblVMDRossa",selector:this.selContainer+"#LblVMDRossa"},{ref:"DataScadenzaPai",selector:this.selContainer+"#DataScadenzaPai"},{ref:"RecordId",selector:this.selContainer+"#RecordId"},{ref:"ColMese1",selector:this.selContainer+"#ColMese1"},{ref:"ColMese2",
selector:this.selContainer+"#ColMese2"},{ref:"ColMese3",selector:this.selContainer+"#ColMese3"},{ref:"ColMese4",selector:this.selContainer+"#ColMese4"},{ref:"ColPrestazione",selector:this.selContainer+"#ColPrestazione"},{ref:"IdRicovero",selector:this.selContainer+"#IdRicovero"},{ref:"LblDescSoglia",selector:this.selContainer+"#LblDescSoglia"},{ref:"BtnTrimSX",selector:this.selContainer+"#BtnTrimSX"},{ref:"BtnTrimDX",selector:this.selContainer+"#BtnTrimDX"},{ref:"BudgetSX",selector:this.selContainer+
"#BudgetSX"},{ref:"CtnConfrontoTrim",selector:this.selContainer+"#CtnConfrontoTrim"},{ref:"LblTrimSX",selector:this.selContainer+"#LblTrimSX"},{ref:"LblTrimDX",selector:this.selContainer+"#LblTrimDX"},{ref:"ResiduoDX",selector:this.selContainer+"#ResiduoDX"},{ref:"ResiduoSX",selector:this.selContainer+"#ResiduoSX"},{ref:"btnStmpPai",selector:this.selContainer+"#btnStmpPai"}]);this.control(this.selContainer+"#btnStmpPai",{click:this.btStampaPAIClick});this.control(this.selContainer+"#StoricoGridVMD",
{select:this.selectStoricoGridVMD});this.control(this.selContainer+"#DataInizioPai",{blur:this.onDataInizioPaiBlur});this.control(this.selContainer+"#DataChiusuraPai",{blur:this.onDataChiusuraPaiBlur});this.control(this.selContainer+"#btnNuovo",{click:this.btnNuovoClick});this.control(this.selContainer+"#btnElimina",{click:this.btnEliminaClick});this.control(this.selContainer+"#btnRilevazione",{click:this.btnRilevazioneClick});this.control(this.selContainer+"#GrigliaPAI",{beforeedit:this.beforeEditGrigliaPAI,
canceledit:this.cancelEditGrigliaPAI,edit:this.editGrigliaPAI,validateedit:this.validateEditGrigliaPAI,select:this.selectGrigliaPAI});this.control(this.selContainer+"#BtnTrimSX",{click:this.btnTrimSXClick});this.control(this.selContainer+"#BtnTrimDX",{click:this.btnTrimDXClick})},btnTrimSXClick:function(){--this.trimBdgSX;this.getBtnTrimDX().setDisabled(!1);this.impostaDatiBudget()},btnTrimDXClick:function(){this.trimBdgSX+=1;this.getBtnTrimSX().setDisabled(!1);this.impostaDatiBudget()},impostaDatiBudget:function(){var b=
this,c=b.cbaConfig.controllerFascicolo.currentDip,d=b.cbaConfig.controllerFascicolo.currentServizio,f=[];if(null!=b.getDataInizioPai().getValue()){b.getBtnTrimDX().setDisabled(!1);b.getBtnTrimSX().setDisabled(!1);var g=b.cbaConfig.controllerPortlet.cbaConfig.controllerFascicolo.view.down("#DatiAggiuntivi").items.map.DatiAggiuntivi.refs.GridRicoveri.getStore(),g=trovaRecord(g,"idRicovero",b.idRicovero);(null==g.data.dataAl&&3==b.trimBdgSX&&b.annoBdgTrimSX==(new Date).getFullYear()&&0==b.cavalloAnni||
null==g.data.dataAl&&3==b.trimBdgSX&&b.annoBdgTrimSX==(new Date).getFullYear()+1&&b.getDataInizioPai().getValue().getFullYear()==(new Date).getFullYear()&&1==b.cavalloAnni||null==g.data.dataAl&&3==b.trimBdgSX&&b.annoBdgTrimSX==(new Date).getFullYear()&&b.getDataInizioPai().getValue().getFullYear()<(new Date).getFullYear()&&1==b.cavalloAnni||null!=g.data.dataAl&&g.data.dataAl.getFullYear()==b.annoBdgTrimSX&&3==b.trimBdgSX)&&b.getBtnTrimDX().setDisabled(!0);g.data.dataDal.getFullYear()==b.annoBdgTrimSX&&
1==b.trimBdgSX&&b.getBtnTrimSX().setDisabled(!0);if(5==b.trimBdgSX||0==b.trimBdgSX)5==b.trimBdgSX?(b.trimBdgSX=1,b.annoBdgTrimSX+=1):0==b.trimBdgSX&&(b.trimBdgSX=4,--b.annoBdgTrimSX);for(g=0;g<b.datiBdgAnnui.length;g++)b.datiBdgAnnui[g][0]==b.annoBdgTrimSX&&(f=b.datiBdgAnnui[g][1],g==b.datiBdgAnnui.length);0==f.length&&Ext.Ajax.request({url:"/cba/osp/rap/ws/rsaAperta/budget/search",params:{idAnagrafica:c,idServizio:d,anno:b.annoBdgTrimSX},method:"GET",async:!1,success:function(c){c=Ext.decode(c.responseText);
c.success?c.data?(b.datiBdgAnnui.push([b.annoBdgTrimSX,c.data]),f=c.data):msgShowError("",operation.getError()):msgShowError("",c.message)}});if(4==b.trimBdgSX){b.getLblTrimSX().setText("4 trimestre "+b.annoBdgTrimSX);b.getLblTrimDX().setText("1 trimestre "+(b.annoBdgTrimSX+1));for(var g=[],h=[],k=0;k<b.datiBdgAnnui.length;k++)b.datiBdgAnnui[k][0]==b.annoBdgTrimSX?g=b.datiBdgAnnui[k][1]:b.datiBdgAnnui[k][0]==b.annoBdgTrimSX+1&&(h=b.datiBdgAnnui[k][1]);0==h.length&&Ext.Ajax.request({url:"/cba/osp/rap/ws/rsaAperta/budget/search",
params:{idAnagrafica:c,idServizio:d,anno:b.annoBdgTrimSX+1},method:"GET",async:!1,success:function(c){c=Ext.decode(c.responseText);c.success?c.data?(b.datiBdgAnnui.push([b.annoBdgTrimSX+1,c.data]),h=dati):msgShowError("",operation.getError()):msgShowError("",c.message)}});b.getCntEditPai().getForm().setValues({budgetSX:g.stanziatoutentetrim4,previstoSX:g.trim4prevUtente,effettivoSX:g.trim4effUtente,residuoSX:g.trim4resUtente,budgetDX:h.stanziatoutentetrim1,previstoDX:h.trim1prevUtente,effettivoDX:h.trim1effUtente,
residuoDX:h.trim1resUtente})}else b.getLblTrimSX().setText(b.trimBdgSX+" trimestre "+b.annoBdgTrimSX),b.getLblTrimDX().setText(b.trimBdgSX+1+" trimestre "+b.annoBdgTrimSX),b.getCntEditPai().getForm().setValues({budgetSX:f["stanziatoutentetrim"+b.trimBdgSX],previstoSX:f["trim"+b.trimBdgSX+"prevUtente"],effettivoSX:f["trim"+b.trimBdgSX+"effUtente"],residuoSX:f["trim"+b.trimBdgSX+"resUtente"],budgetDX:f["stanziatoutentetrim"+(b.trimBdgSX+1)],previstoDX:f["trim"+(b.trimBdgSX+1)+"prevUtente"],effettivoDX:f["trim"+
(b.trimBdgSX+1)+"effUtente"],residuoDX:f["trim"+(b.trimBdgSX+1)+"resUtente"]})}else b.getBtnTrimDX().setDisabled(!0),b.getBtnTrimSX().setDisabled(!0);0>b.getResiduoSX().getValue()?b.getResiduoSX().setFieldStyle("color: red;"):b.getResiduoSX().setFieldStyle("color: black;");0>b.getResiduoDX().getValue()?b.getResiduoDX().setFieldStyle("color: red;"):b.getResiduoDX().setFieldStyle("color: black;")},aggiornaBudget:function(){var b=this;b.getCtnConfrontoTrim().store=Ext.create("GeneraliOSP.portlet.store.RapBudget");
var c=b.cbaConfig.controllerFascicolo.currentDip,d=b.cbaConfig.controllerFascicolo.currentServizio,f=b.getDataInizioPai().getValue().getFullYear();b.trimBdgSX=parseInt(b.getDataInizioPai().getValue().getMonth()/3+1);b.annoBdgTrimSX=f;b.datiBdgAnnui=[];b.cavalloAnni=!1;null!=c&&null!=d&&null!=f&&b.getCtnConfrontoTrim().store.load({params:{idAnagrafica:c,idServizio:d,anno:f},callback:function(g,h,k){k&&g&&((g=g[0].data)?(b.datiBdgAnnui.push([f,g]),4==b.trimBdgSX?b.getCtnConfrontoTrim().store.load({params:{idAnagrafica:c,
idServizio:d,anno:f+1},callback:function(c,d,g){g&&c&&((c=c[0].data)?(b.datiBdgAnnui.push([f+1,c]),b.impostaDatiBudget(),b.cavalloAnni=!0):msgShowError("",d.getError()))}}):b.impostaDatiBudget()):msgShowError("",h.getError()))}})},btnNuovoClick:function(){var b={idPai:parseInt(this.getRecordId().getValue())};controller_nuovoRecordGrid(b,this.getGrigliaPAI());this.getLblDescSoglia().setText("")},btnEliminaClick:function(){var b=this,c;b.getGrigliaPAI().getSelectionModel().getSelection()[0]&&(c=b.getGrigliaPAI().getSelectionModel().getSelection()[0].get("id"));
controller_eliminaRecord(b.getGrigliaPAI().store,{id:c},function(){b.aggiornaStoreGrid()});b.getLblDescSoglia().setText("")},btnRilevazioneClick:function(){0<this.getGrigliaPAI().getStore().data.length&&isValidDate(this.getDataInizioPai())?Ext.create("winCBA",{name:"RAP.rilevazione.view.RAPRilevazione",titolo:"Rilevazione",dimensione:7,configItem:{idRicovero:this.idRicovero,codOspite:this.cbaConfig.controllerFascicolo.currentDip,codiceEsitoVmd:this.codiceEsitoVmd,idPai:this.getRecordId().getValue(),
meseAvvio:this.cbaConfig.meseAvvio,desEsitoVMD:this.cbaConfig.desEsitoVMD,dataInizioPAI:this.getDataInizioPai().getValue(),dataFinePAI:this.getDataChiusuraPai().getValue(),dataScadenzaPAI:this.getDataScadenzaPai().getValue(),numPratica:this.getStoricoGridVMD().getSelection()[0].get("annoPratica")+" - "+this.getStoricoGridVMD().getSelection()[0].get("numPratica"),callbackEsci:function(){},controllerPai:this},closable:!0}).show():msgShowWarning("","Nessun PAI valido selezionato")},beforeEditGrigliaPAI:function(b,
c,d){if(c.record.data.id&&0>c.record.data.id&&-9999!=c.record.data.id)return msgShowError("Attenzione","Dato non modificabile!"),!1;this.onChangeFigProfessionale(this.getGrigliaPAI().getSelection()[0].get("codFigProf"));this.abilitaVideata(!1)},cancelEditGrigliaPAI:function(b,c,d){this.aggiornaStoreGrid(c.record.data.id);this.abilitaVideata(!0)},editGrigliaPAI:function(b,c,d){d=c.record.data;var f=this.getGrigliaPAI();c.record.dirty&&(controller_salvaRecord(f,d,!1,{idPai:this.getRecordId()})||b.startEdit(c.record,
0));this.abilitaVideata(!0)},validateEditGrigliaPAI:function(b,c,d){b=[];var f=c.record.get("id");d=c.newValues;c=c.store.data.items;for(var g=1;g<c.length;g++){var h=c[g].get("id"),k=c[g].get("codFigProf"),l=c[g].get("idPrestazione");if((null==f||f!=h)&&k==d.codFigProf&&l==d.idPrestazione){msgAddError(b,"RAP_ERR_PREST_INSERITA");break}}f=this.getDataInizioPai().getValue();c=this.getGrigliaPAI().getColumns()[1].getEditor().getStore();g=trovaRecord(c,"codice",d.idPrestazione);c=g.get("data1");g=g.get("data2");
c&&(c=new Date(c));g&&(g=new Date(g));c&&f<c&&msgAddError(b,traduci("RAP_ERR_PREST_EROGABILE_DAL")+" "+FormattaData(c));g&&f>g&&msgAddError(b,traduci("RAP_ERR_PREST_EROGABILE_AL")+" "+FormattaData(g));d.qtaPrevista!=d.qtaMese1+d.qtaMese2+d.qtaMese3+d.qtaMese4&&msgAddError(b,"RAP_ERR_QTAPRESTAZIONI");return msgShow("",b)},abilitaVideata:function(b){this.getBtnNuovo().setDisabled(!b);this.getBtnElimina().setDisabled(!b);this.getBtnRilevazione().setDisabled(!b);this.getBoxBottoni().queryById("btnElimina").setDisabled(!b)},
selectGrigliaPAI:function(b,c){c&&this.getLblDescSoglia().setText(c.get("desSoglia"))},onChangeFigProfessionale:function(b,c,d,f){c=this.getDataInizioPai().getValue();d=this.getGrigliaPAI().getColumns()[1].getEditor().getStore();loadStore(d,{dataDal:c,esitoValutazione:this.codiceEsitoVmd});d.clearFilter();d.filter(function(c){var d=!1;b==c.get("extra")&&(d=!0);return d})},onDataInizioPaiBlur:function(){me=this;if(isValidDate(me.getDataInizioPai())&&me.getCntEditPai().isDirty()){var b=Ext.Date.add(me.getDataInizioPai().getValue(),
Ext.Date.DAY,89);me.getDataScadenzaPai().setValue(b)}},onDataChiusuraPaiBlur:function(){me=this;null==me.getDataChiusuraPai().getValue()&&me.getCmbChiusura().setValue(null)},selectStoricoGridVMD:function(b,c){this.recordSelezionatoVMD=c;this.getLblVMDRossa().setVisible(!1);this.getFrmTestata().setVisible(!1);this.getGrigliaPAI().setDisabled(!0);this.getBtnRilevazione().setDisabled(!0);c&&(1==c.get("erogazioneMisura")||2==c.get("erogazioneMisura")&&7==c.get("esitoVmd")?this.getFrmTestata().setVisible(!0):
(this.getLblVMDRossa().setVisible(!0),this.getLblVMDRossa().setText(c.data.desEsitoMisura)),this.impostaDati(c),this.getLblDescSoglia().setText(""))},aggiornaGrigliaServizio:function(){if(!Ext.isEmpty(this.getDataChiusuraPai())){var b=this.getDataChiusuraPai().getValue(),c=this.cbaConfig.controllerFascicolo.idRicovero,d=this.cbaConfig.controllerPortlet.cbaConfig.controllerFascicolo.view.down("#DatiAggiuntivi").items.map.DatiAggiuntivi.refs.GridRicoveri.getStore(),c=trovaRecord(d,"idRicovero",c);Ext.isEmpty(c.data.dataAl)&&
c.set("dataAl",b)}},gestioneForm:function(){var b=this,c=b.getCntEditPai();c.store=Ext.create("GeneraliOSP.portlet.store.RapPai");c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var d=c.getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,
{id:d},function(){b.aggiornaStore()})},esci_callback:function(){var c=b.getCntEditPai().up("window");controller_puoiUscire(c,b.getCntEditPai(),function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()},function(){b.chiusuraFascicolo&&b.aggiornaGrigliaServizio();if(b.getStoricoGridVMD().store.getAt(0)==b.getStoricoGridVMD().getSelectionModel().getSelected().items[0]){var d=b.getDataChiusuraPai().getValue();
b.cbaConfig.controllerPortlet.cbaConfig.controllerFascicolo.view.down("#DataFinePraticaPortletVmd").setValue(d)}b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(c.boxBottoni,d);d=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},items:[{xtype:"button",itemId:"btnRilevazione",reference:"btnRilevazione",
iconCls:"icon-day-btn",text:"Rilevazione",scale:"medium"},{xtype:"button",itemId:"btnStmpPai",reference:"btnStmpPai",iconCls:"icon-stampa32",text:"Stampa PAI",scale:"medium",margin:"10 0 0 0"}]});c.boxBottoni.insert(10,d);c.boxBottoni.queryById("btnNuovo").hide();if("L"!=c.permesso)c.getForm().on("dirtychange",function(d,g){controller_abilitaBottoni(c);g&&b.getGrigliaPAI().setDisabled(!0);b.getBtnRilevazione().setDisabled(!0);c.boxBottoni.queryById("btnEsci").setDisabled(g)});"L"!=b.cbaConfig.permesso&&
permettiModificheDopoDimissione()?b.currentDip&&containerSolaLettura(c):(containerSolaLettura(c),controller_bottoniSolaLettura(b.getBoxBottoni()))},btStampaPAIClick:function(){var b=this.cbaConfig.controllerFascicolo.currentDip,c=this.cbaConfig.controllerFascicolo.currentServizio;showWinStampa(CBA.moduli.moduloAttivo,CBA.parametriGenerali.codEnte,"RAP_PAI",{configBtnStampa:{reportDaEsportare:!1,hideCsv:!0,hideXls:!0,hideXml:!0,hideExcel:!0,hideText:!0,format:"PDF",params:{elencoUtenti:b.toString(),
format:"PDF",dataDal:this.getDataInizioPai().getValue(),dataAl:this.getDataInizioPai().getValue(),servizi:c}},eseguiStampa:!0,elencoUtenti:b.toString(),format:"PDF",dataDal:this.getDataInizioPai().getValue(),dataAl:this.getDataInizioPai().getValue(),servizi:c})},impostaDati:function(b){var c=this.getCntEditPai();this.codiceEsitoVmd=b.getData().esitoVmd;clearForm(c);this.getGrigliaPAI().setTitle(b.data.desEsitoVMD);this.cbaConfig.desEsitoVMD=b.data.desEsitoVMD;loadStore(this.getGrigliaPAI().getColumns()[0].getEditor().getStore(),
{esitoValutazione:this.codiceEsitoVmd});c.idValutazione=b.id;this.aggiornaStore()},verificaCampiForm:function(){var b=[];this.getCntEditPai().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");null!=this.getDataChiusuraPai().getValue()&&null==this.getCmbChiusura().getValue()&&msgAddError(b,"RAP_OBBLIGO_MOTCHIUSURA");this.getDataScadenzaPai().getValue()<this.getDataInizioPai().getValue()&&msgAddError(b,"RAP_ERR_PAI_SCAD_INFERIORE");var c=Ext.Date.add(this.getDataInizioPai().getValue(),Ext.Date.DAY,
89);this.getDataScadenzaPai().getValue()>c&&msgAddError(b,"RAP_ERR_PAI_SUPERO_SCAD");c=this.recordSelezionatoVMD.get("data");this.getDataInizioPai().getValue()<c&&msgAddError(b,"RAP_ERR_PAI_INZIO_INFERIORE");c=Ext.Date.parse("04/01/2018","m/d/Y");this.getDataInizioPai().getValue()<c&&msgAddError(b,"RAP_ERR_PAI_INZIO_KO");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c=this.getCntEditPai(),d=c.getForm(),f={};f.id=d.getFieldValues().id;f.dal=d.getFieldValues().dal;
f.al=d.getFieldValues().al;f.motivoChiusura=d.getFieldValues().motivoChiusura;f.scadenza=d.getFieldValues().scadenza;f.idValutazione=c.idValutazione;f.idRicovero=me.cbaConfig.controllerFascicolo.idRicovero;null!==f.al&&4!=f.motivoChiusura?Messaggio("ELIMINA","RAP_PAI_CONFERMA_DIM","YESNO","QUESTION","",function(){me.chiusuraFascicolo=!0;controller_salvaRecord(c,f,b,{forzaDimissione:!0})},function(){controller_salvaRecord(c,f,b,{forzaDimissione:!1})}):controller_salvaRecord(c,f,b,{forzaDimissione:!1})},
aggiornaStore:function(b){var c=this,d=c.getCntEditPai();svuotaStore(c.getGrigliaPAI().getStore());d.store.load({params:{idValutazione:d.idValutazione},callback:function(b,g,h){h?(clearForm(d),Ext.isEmpty(b)?(svuotaStore(c.getGrigliaPAI().getStore()),c.getGrigliaPAI().setDisabled(!0),c.getBtnRilevazione().setDisabled(!0),c.getCtnConfrontoTrim().setDisabled(!0),c.getBtnStmpPai().setDisabled(!0)):(b=b[0],d.loadRecord(b),c.getGrigliaPAI().setDisabled(!1),c.getBtnRilevazione().setDisabled(!1),c.getCtnConfrontoTrim().setDisabled(!1),
g=b.data.dal.getMonth()+1,c.cbaConfig.meseAvvio=g,c.impostaMesiGridPAi(g),c.aggiornaStoreGrid(b.id),c.getBtnStmpPai().setDisabled(!1))):msgShowError("",g.getError())}})},impostaMesiGridPAi:function(b){--b;this.getColMese1().setText(this.mesi[b]);this.getColMese2().setText(this.mesi[12<=b+1?b-11:b+1]);this.getColMese3().setText(this.mesi[12<=b+2?b-10:b+2]);this.getColMese4().setText(this.mesi[12<=b+3?b-9:b+3])},aggiornaStoreGrid:function(b){var c=this,d=c.getGrigliaPAI();d.getStore().load({params:{idPai:c.getRecordId().getValue()},
callback:function(b,g,h){h?Ext.isEmpty(b)||(d.getSelectionModel().select(0),c.getBtnRilevazione().setDisabled(!1)):msgShowError("",g.getError())}});c.aggiornaBudget()},onLaunch:function(){var b=this;b.getCntEditPai().controller=b;loadStore(b.getCmbChiusura().getStore(),{tipoCodifica:"MCP"});b.gestioneForm();var c;b.idRicovero=b.cbaConfig.controllerFascicolo.idRicovero;b.chiusuraFascicolo=!1;var d=b.getStoricoGridVMD(),f=d.getStore(),g=b.getCntEditPai();g.getForm();b.cbaConfig.controllerEditFascicolo&&
b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&g.boxBottoni.queryById("btnEsci").setVisible(!1);clearForm(g);c||(c=b.cbaConfig.controllerFascicolo.idRicovero);f.load({params:{idRicovero:b.idRicovero},callback:function(c,f,l){l?Ext.isEmpty(c)?(g.setDisabled(!0),b.getBtnRilevazione().setDisabled(!0),b.getCtnConfrontoTrim().setDisabled(!0)):d.getSelectionModel().select(0):msgShowError("",f.getError())}});b.getBtnStmpPai().setDisabled(!0)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.RAPRequisiti",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:b+"#Container"},{ref:"BoxBottoni",selector:b+"#BoxBottoni"},{ref:"EditPraticaForm",selector:b+"#EditPraticaForm"},{ref:"cmbConviventi",selector:b+"#cmbConviventi"},{ref:"cmblivInvalidita",selector:b+"#cmblivInvalidita"},{ref:"checkDemenza",selector:b+"#checkDemenza"},{ref:"DateDemenza",selector:b+
"#DateDemenza"},{ref:"RecordId",selector:b+"#RecordId"},{ref:"IdRicovero",selector:b+"#IdRicovero"},{ref:"ricoveroDataDal",selector:b+"#ricoveroDataDal"},{ref:"dateVerificaRequisiti",selector:b+"#dateVerificaRequisiti"},{ref:"CheckRequisiti",selector:b+"#CheckRequisiti"}]);this.control(b+"#checkDemenza",{change:this.onCheckDemenzaChange});this.control(b+"#dateVerificaRequisiti",{change:this.ondataRequisitiChange})},ondataRequisitiChange:function(){null==this.getEditPraticaForm().getForm().getFieldValues().requisitiData?
(this.getCheckRequisiti().setDisabled(!0),this.getCheckRequisiti().setStyle("opacity","0.5")):(this.getCheckRequisiti().setDisabled(!1),this.getCheckRequisiti().setStyle("opacity","1"))},onCheckDemenzaChange:function(b,c,d,f){b.getValue()?this.getDateDemenza().setDisabled(!1):this.getDateDemenza().setDisabled(!0)},aggiornaGrigliaServizio:function(){datiRecord=this.getEditPraticaForm().getForm().getFieldValues();if("F"==datiRecord.requisitiEsito){var b=this.getDateVerificaRequisiti().getValue(),c=
this.cbaConfig.controllerFascicolo.idRicovero,d=this.cbaConfig.controllerPortlet.cbaConfig.controllerFascicolo.view.down("#DatiAggiuntivi").items.map.DatiAggiuntivi.refs.GridRicoveri.getStore(),c=trovaRecord(d,"idRicovero",c);Ext.isEmpty(c.data.dataAl)&&c.set("dataAl",b)}},gestioneForm:function(){var b=this,c=b.getEditPraticaForm();c.controller=b;c.store=Ext.create("GeneraliOSP.portlet.store.RapRequisiti");b.aggiornaStore();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},esci_callback:function(){var c=b.getEditPraticaForm().up("window");controller_puoiUscire(c,b.getEditPraticaForm(),function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()},function(){b.chiusuraFascicolo&&b.aggiornaGrigliaServizio();b.cbaConfig.controllerPortlet&&
b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(c.boxBottoni,d);c.boxBottoni.queryById("btnNuovo").hide();c.boxBottoni.queryById("btnElimina").hide();if("L"!=c.permesso)c.getForm().on("dirtychange",function(b,d){controller_abilitaBottoni(c);c.boxBottoni.queryById("btnEsci").setDisabled(d)});"L"==b.cbaConfig.permesso?(containerSolaLettura(c),controller_bottoniSolaLettura(b.getBoxBottoni())):
b.currentDip&&containerSolaLettura(c)},impostaDati:function(b){var c=this.getEditPraticaForm();clearForm(c);b&&(c.loadRecord(b),this.getCheckDemenza().getValue()&&this.getDateDemenza().setDisabled(!1),""==b.data.requisitiEsito||null==b.data.requisitiEsito)&&(this.getCheckRequisiti().setDisabled(!0),this.getCheckRequisiti().setStyle("opacity","0.5"))},verificaCampiForm:function(){var b=[],c=this.getEditPraticaForm().getForm();c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");c=c.getFieldValues();
""==c.requisitiEsito&&null!=c.requisitiData&&msgAddError(b,"RAP_CONTROLLO_REQUISITI");!c.certDemenza&&"T"==c.requisitiEsito&&75>Ext.Date.diff(currOspite.dataNascita,c.requisitiData,Ext.Date.YEAR)&&msgAddError(b,"RAP_CONTROLLO_REQUISITI_ETA");return msgShow("",b)},salva:function(b){var c=this,d=c.getEditPraticaForm().getForm().getFieldValues();d.certDemenza=getBoolValue(d.certDemenza);d.altriServSociali=getBoolValue(d.altriServSociali);d.indAccompagnamento=getBoolValue(d.indAccompagnamento);delete d.descrLivInvalidita;
delete d.descrConvivenza;delete d.labelrequisiti;""===d.idRicovero&&(d.idRicovero=c.cbaConfig.controllerFascicolo.idRicovero);if(!c.verificaCampiForm())return!1;"F"==d.requisitiEsito?Messaggio("CONFERMA","RAP_REQUISITI_CONFERMA_DIM","YESNO","QUESTION","",function(){c.chiusuraFascicolo=!0;controller_salvaRecord(c.getEditPraticaForm(),d,b)},function(){controller_salvaRecord(c.getEditPraticaForm(),d,b)}):controller_salvaRecord(c.getEditPraticaForm(),d,b)},aggiornaStore:function(b){var c=this,d=c.getEditPraticaForm();
d.getForm();c.getEditPraticaForm();b||(b=c.cbaConfig.controllerFascicolo.idRicovero);d.store.load({params:{idRicovero:b},callback:function(b,g,h){h?(clearForm(d),Ext.isEmpty(b)||c.impostaDati(b[0])):msgShowError("",g.getError())}})},onLaunch:function(){this.getContainer().controller=this;this.primaVolta=!0;this.chiusuraFascicolo=!1;var b=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/osp/rap/ws/prszn/codifiche/cbox"}});b.load();this.getCmbConviventi().bindStore(Ext.create("Ext.data.ChainedStore",
{source:b}));this.getCmbConviventi().getStore().filter({filterFn:function(b){return"CON"==b.data.extra?!0:!1}});this.getCmblivInvalidita().bindStore(Ext.create("Ext.data.ChainedStore",{source:b}));this.getCmblivInvalidita().getStore().filter({filterFn:function(b){return"LI"==b.data.extra?!0:!1}});this.gestioneForm();b=this.getEditPraticaForm();this.cbaConfig.controllerEditFascicolo&&this.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&b.boxBottoni.queryById("btnEsci").setVisible(!1);b=b.store.first();
this.impostaDati(b)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.RAPVmd",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CtnStorico",selector:b+"#CtnStorico"},{ref:"BoxBottoni",selector:b+"#BoxBottoni"},{ref:"EditVmdForm",selector:b+"#EditVmdForm"},{ref:"StoricoGridVMD",selector:b+"#StoricoGridVMD"},{ref:"Vmdata",selector:b+"#Vmdata"},{ref:"EditVmdTipoValutazione",selector:b+"#EditVmdTipoValutazione"},{ref:"CmbMedico",selector:b+"#CmbMedico"},
{ref:"CkMedico",selector:b+"#CkMedico"},{ref:"CBIManuale",selector:b+"#CBIManuale"},{ref:"CDRManuale",selector:b+"#CDRManuale"},{ref:"MMSEManuale",selector:b+"#MMSEManuale"},{ref:"recordId",selector:b+"#recordId"},{ref:"skDemenzaManMMSE",selector:b+"#skDemenzaManMMSE"},{ref:"SceltaTest",selector:b+"#SceltaTest"},{ref:"CbEsitoVmd",selector:b+"#CbEsitoVmd"},{ref:"CbEsitoErogazioneMisura",selector:b+"#CbEsitoErogazioneMisura"},{ref:"FrmPI",selector:b+"#FrmPI"},{ref:"TabEditVmd",selector:b+"#TabEditVmd"},
{ref:"RecordId",selector:b+"#RecordId"},{ref:"CDRAuto",selector:b+"#CDRAuto"},{ref:"MMSEAuto",selector:b+"#MMSEAuto"},{ref:"DataPi",selector:b+"#DataPi"},{ref:"FormAllegato",selector:b+"#FormAllegato"},{ref:"iconAllegato",selector:b+"#iconAllegato"},{ref:"BtnAllega",selector:b+"#BtnAllega"},{ref:"BtnEliminaAllegato",selector:b+"#BtnEliminaAllegato"},{ref:"nomeFilePi",selector:b+"#nomeFilePi"},{ref:"idAllegatoPi",selector:b+"#docIdAllegato"},{ref:"nomeFilePi",selector:b+"#nomeFilePi"},{ref:"CmbcareManager",
selector:b+"#CmbcareManager"}]);this.control(b+"#StoricoGridVMD",{select:this.selectStoricoGridVMD});this.control(b+"#CkMedico",{change:this.onCheckMedicoChange});this.control(b+"#SceltaTest",{choicechange:this.onTestChange});this.control(b+"#CbEsitoErogazioneMisura",{change:this.onEsitoErogazioneMisuraChange});this.control(b+"#DataPi",{change:this.onDataPiChange});this.control(b+"#iconAllegato",{afterrender:this.onIconAllegatoAfterRender});this.control(b+"#BtnAllega",{change:this.onBtnAllegaChange});
this.control(b+"#BtnEliminaAllegato",{click:this.onBtnEliminaAllegatoClick})},onDataPiChange:function(){isValidDate(this.getDataPi())&&permettiModificheDopoDimissione()?(this.getBtnAllega().setDisabled(!1),this.getBtnEliminaAllegato().setDisabled(!1)):(this.getBtnAllega().setDisabled(!0),this.getBtnEliminaAllegato().setDisabled(!0))},onEsitoErogazioneMisuraChange:function(b,c,d,f){abilitaPi=!1;(abilitaPi=7==this.getCbEsitoVmd().getValue()?2==c:1==c)?this.getFrmPI().tab.setVisible(!0):null!=c&&(this.getFrmPI().tab.setVisible(!1),
this.getFrmPI().hide())},onTestChange:function(b,c,d){if(1==c)this.getCDRManuale().setHidden(!1),this.getMMSEManuale().setHidden(!0),this.getCDRAuto().setHidden(!1),this.getMMSEAuto().setHidden(!0);else if(2==c)this.getCDRManuale().setHidden(!0),this.getMMSEManuale().setHidden(!1),this.getCDRAuto().setHidden(!0),this.getMMSEAuto().setHidden(!1);else if(3==c||4==c)this.getCDRManuale().setHidden(!0),this.getMMSEManuale().setHidden(!0),this.getCDRAuto().setHidden(!0),this.getMMSEAuto().setHidden(!0)},
onCheckMedicoChange:function(b,c,d,f){b.getValue()?this.getCmbMedico().setDisabled(!1):this.getCmbMedico().setDisabled(!0)},selectStoricoGridVMD:function(b,c){var d=this.getTabEditVmd().getActiveTab().getItemId();this.impostaDati(c,d)},onIconAllegatoAfterRender:function(b,c){var d=this;if(!d.impostatoClickAllegato)b.getEl().on("click",function(){var c=d.getStoricoGridVMD().getStore().findRecord("id",d.getRecordId().getValue()),g=c.data.nomeFile;g||(g="");c=c.data.idAllegatoPi;null==c&&(c=0);setWindow(1);
stampaEsporta(b,{url:getUrlGen()+"/ws/genOsp/docs/attach/getFileRefById",params:{idAllegato:c},titolo:g})});d.impostatoClickAllegato=!0},estensioneValida:function(b){return"rar"==b.slice((b.lastIndexOf(".")>>>0)+1)||"7z"==b.slice((b.lastIndexOf(".")>>>0)+1)||"exe"==b.slice((b.lastIndexOf(".")>>>0)+1)||"tar"==b.slice((b.lastIndexOf(".")>>>0)+1)||"zip"==b.slice((b.lastIndexOf(".")>>>0)+1)?(Messaggio("MSG_TITOLO_ERRORE","MSG_ERRORE_ESTENSIONE_ALLEGATI","OK","ERROR"),!1):!0},setIconAllegato:function(b){for(var c=
getEstensioni(),d=0;d<c.length;d++)this.getIconAllegato().removeCls("icon-"+c[d]);d=b.lastIndexOf(".");d=b.length-d-1;(d=b.substr(b.length-d,d).toLowerCase())&&(0<=Ext.Array.indexOf(c,d)?this.getIconAllegato().addCls("icon-"+d):this.getIconAllegato().addCls("icon-unknown"));""!==b?(this.getIconAllegato().show(),setToolTip(this.getIconAllegato().id,this.getIconAllegato().getEl(),b)):this.getIconAllegato().hide()},onBtnAllegaChange:function(b,c,d){var f=this;d=c.lastIndexOf("\\")||c.lastIndexOf("/");
c=c.substring(d+1);if(50<c.length)return Messaggio("ATTENZIONE","MSG_NOMEFILE_LUNGHEZZA","OK","WARNING"),clearForm(f.getDocFormAllegato()),!1;var g=f.getRecordId().getValue();f.getFormAllegato().getForm();""!==c&&f.estensioneValida(c)&&(d=b.fileInputEl.dom.files[0],b=new FormData,b.append("file",d),c=getUrlGen()+"/ws/rsaAperta/vmd/uploadAttachment?idValutazione="+g+"&nomeFile="+c,Ext.Ajax.request({url:c,method:"POST",rawData:b,headers:{"Content-Type":null},success:function(b){b=Ext.JSON.decode(b.responseText);
b.success?(msgShowText("TRASFERIMENTO_FILE",b.message),f.ImpostaActiveTab="PI",f.aggiornaStore(g)):msgShowError("",b.message)}}))},onBtnEliminaAllegatoClick:function(b,c,d){if(""===this.getNomeFilePi().text)return Messaggio("ELIMINA","MSG_NESSUN_ALLEGATO","OK","WARNING"),!1;Messaggio("ELIMINA","MSG_ELIMINA_ALLEGATO","YESNO","QUESTION","",Ext.bind(this.eliminaAllegato,this))},eliminaAllegato:function(){var b=this,c=b.getRecordId().getValue();Ext.Ajax.request({url:getUrlGen()+"/ws/rsaAperta/vmd/deleteAttachment",
params:{idValutazione:c},method:"GET",async:!1,success:function(d){d=Ext.JSON.decode(d.responseText);d.success?(msgShowText("",d.message),b.ImpostaActiveTab="PI",b.aggiornaStore(c)):msgShowError("",d.message)}})},aggiornaPortletPAI:function(){var b=this.cbaConfig.controllerPortlet.cbaConfig.controllerFascicolo.view.down("#Portlet_RAPPai");b&&b.controller.updatePortlet()},gestioneForm:function(){var b=this,c=b.getEditVmdForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();b.storeForm=
c.store=b.getStoricoGridVMD().getStore();c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){0<b.getStoricoGridVMD().getStore().data.length?b.aggiornaStore():clearForm(c)},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var d=c.getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,{id:d},function(){b.aggiornaStore()})},esci_callback:function(){var c=
b.getEditVmdForm().up("window");controller_puoiUscire(c,b.getEditVmdForm(),function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();c.close()},function(){b.cbaConfig.controllerPortlet&&(b.aggiornaPortletPAI(),b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet());c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(c.boxBottoni,
d);b.getVmdata().maxValue=Ext.Date.clearTime(new Date);if("L"!=c.permesso)c.getForm().on("dirtychange",function(b,d){controller_abilitaBottoni(c);c.boxBottoni.queryById("btnEsci").setDisabled(d)});"L"!=b.cbaConfig.permesso&&permettiModificheDopoDimissione()?b.currentDip&&containerSolaLettura(c):(containerSolaLettura(c),controller_bottoniSolaLettura(b.getBoxBottoni()),b.getBtnAllega().setDisabled(!0),b.getBtnEliminaAllegato().setDisabled(!0))},impostaDati:function(b,c){var d=this.getEditVmdForm();
1==b.data.skDemenzaTipo?b.data.skDemenzaManCDR=b.data.skDemenzaMan:2==b.data.skDemenzaTipo&&(b.data.skDemenzaManMMSE=b.data.skDemenzaMan);clearForm(d);d.loadRecord(b);this.getTabEditVmd().setActiveTab(this.cbaConfig.inSalva?c:0);this.getCkMedico().getValue()&&this.getCmbMedico().setDisabled(!1);this.cbaConfig.inSalva=null;this.getBtnAllega().setDisabled(!0);this.getBtnEliminaAllegato().setDisabled(!0);isValidDate(this.getDataPi())&&permettiModificheDopoDimissione()&&(this.getBtnAllega().setDisabled(!1),
this.getBtnEliminaAllegato().setDisabled(!1));this.setIconAllegato(b&&b.data.nomeFilePi?b.data.nomeFilePi:"")},copiaVMD:function(b){var c=b.getStoricoGridVMD().getStore().getData().first().getData();b.getEditVmdForm().getForm().setValues({desEsitoMisura:c.desEsitoMisura,desEsitoVMD:c.desEsitoVMD,desQualificaMedico:c.desQualificaMedico,tipoValutazione:2,erogazioneMisura:c.erogazioneMisura,esitoVmd:c.esitoVmd,idCareManager:c.idCareManager,presAssSoc:c.presAssSoc,presEducatore:c.presEducatore,presInfermiere:c.presInfermiere,
presEducatore:c.presEducatore,presMMG:c.presMMG,presMedico:c.presMedico,presMedicoQualifica:c.presMedicoQualifica,presPsicologo:c.presPsicologo,presRapprComune:c.presRapprComune,presTerapisti:c.presTerapisti,skBarthelId:c.skBarthelId,skBarthelMan:c.skBarthelMan,skCbiId:c.skCbiId,skCbiMan:c.skCbiMan,skDemenzaId:c.skDemenzaId,skDemenzaTipo:c.skDemenzaTipo,skDemenzaManCDR:c.skDemenzaManCDR,skDemenzaManMMSE:c.skDemenzaManMMSE});1==c.desEsitoVMD&&b.getFrmPI().tab.setVisible(!0);b.getVmdata().focus()},
noCopiaVMD:function(b){b.getSceltaTest().setValueExclusive(1);b.getFrmPI().tab.setVisible(!1);b.getFrmPI().hide();b.getTabEditVmd().setActiveTab(0);b.getVmdata().focus()},nuovo:function(){var b=this,c=this.getEditVmdForm(),d=b.getStoricoGridVMD().getStore();controller_nuovoRecord(c);0<d.getData().length?Messaggio("COPIARECORD","RAP_MSG_COPIA_VMD","YESNO","QUESTION","",function(){b.copiaVMD(b)},function(){b.noCopiaVMD(b)}):b.noCopiaVMD(b);c.getForm().setValues({data:Ext.Date.clearTime(new Date),codStruttura:b.codStruttura});
var f=(new Date).getFullYear();Ext.Ajax.request({method:"GET",url:"/cba/osp/rap/ws/rsaAperta/vmd/newNumPratica",params:{codStruttura:b.codStruttura,annoPratica:f},success:function(d){d=Ext.JSON.decode(d.responseText);d.success?c.getForm().setValues({IdRicovero:b.idRicovero,annoPratica:f,numPratica:d.data}):msgShowError("",d.message)}});b.setIconAllegato("");b.getBtnAllega().setDisabled(!0);b.getBtnEliminaAllegato().setDisabled(!0)},verificaCampiForm:function(){var b=[],c=this.getEditVmdForm().getForm(),
d=c.getFieldValues();if(!c.isValid()){msgAddError(b,"MSG_CAMPI_OBBLIGATORI");var f="";Ext.each(c.getFields().items,function(b){b.validate()||(""!=f&&(f+=", "),f+=b.fieldLabel)});msgAddError(b,f)}this.getCkMedico().getValue()&&null==this.getCmbMedico().getValue()&&msgAddError(b,"RAP_ERR_MEDICO_COMBO");null!=d.skCbiMan&&(0>d.skCbiMan||96<d.skCbiMan)&&msgAddError(b,"RAP_RANGE_CBI");null!=d.skBarthelMan&&(0>d.skBarthelMan||100<d.skBarthelMan)&&msgAddError(b,"RAP_RANGE_BARTHEL");2==d.skDemenzaTipo&&null!=
d.skDemenzaManMMSE&&(0>d.skDemenzaManMMSE||30<d.skDemenzaManMMSE)&&msgAddError(b,"RAP_RANGE_MMSE");0==b.length&&1==d.skDemenzaTipo&&null!=d.esitoVmd&&4>=d.esitoVmd&&(1==d.esitoVmd&&(1==d.skDemenzaManCDR||3<d.skDemenzaManCDR)||2==d.esitoVmd&&4!=d.skDemenzaManCDR||3==d.esitoVmd&&5!=d.skDemenzaManCDR||4==d.esitoVmd&&6>d.skDemenzaManCDR)&&msgAddError(b,"RAP_ERR_ESITO_DEMENZA");0==b.length&&6==d.esitoVmd&&1==d.erogazioneMisura&&msgAddError(b,"RAP_ERR_VMD_ESITO6");return msgShow("",b)},salva:function(b){var c=
this.getEditVmdForm(),d=c.getForm().getFieldValues();Ext.apply(d,{idRicovero:this.idRicovero,presMedico:getBoolValue(d.presMedico),presAssSoc:getBoolValue(d.presAssSoc),presPsicologo:getBoolValue(d.presPsicologo),presEducatore:getBoolValue(d.presEducatore),presInfermiere:getBoolValue(d.presInfermiere),presTerapisti:getBoolValue(d.presTerapisti),presRapprComune:getBoolValue(d.presRapprComune),presMMG:getBoolValue(d.presMMG)});this.cbaConfig.inSalva=!0;d.skDemenzaMan=1==d.skDemenzaTipo?d.skDemenzaManCDR:
d.skDemenzaManMMSE;delete d.skDemenzaManCDR;delete d.skDemenzaManMMSE;delete d.f_allegato;delete d.scadenza;delete d.dataFine;controller_salvaRecord(c,d,b)},aggiornaStore:function(b){var c=this,d=c.getStoricoGridVMD(),f=d.getStore(),g=c.getEditVmdForm(),h=g.getForm();clearForm(g);f.load({params:{idRicovero:c.idRicovero},callback:function(g,l,n){n&&(Ext.isEmpty(g)?(c.getEditVmdForm().setDisabled(!0),Ext.Ajax.request({method:"GET",url:"/cba/osp/rap/ws/rsaAperta/requisiti/checkRequisiti",params:{idRicovero:c.idRicovero},
success:function(b){b=Ext.JSON.decode(b.responseText);b.success?b.data?(c.getEditVmdForm().setDisabled(!1),c.nuovo()):(c.getBoxBottoni().queryById("btnEsci").setDisabled(!1),c.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),c.getBoxBottoni().queryById("btnElimina").setDisabled(!0),c.getBoxBottoni().queryById("btnConferma").setDisabled(!0)):msgShowError("",b.message)}})):(b||(b=h.findField("id").getValue()),g=trovaRecord(f,"id",b),d.getSelectionModel().deselectAll(),d.getSelectionModel().select(g?
[g]:0)))}})},onLaunch:function(){var b=this;b.primaVolta=!0;b.getCtnStorico().controller=b;var c=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/osp/rap/ws/prszn/codifiche/cbox"}});c.load();var d=b.getEditVmdTipoValutazione(),f=b.getCmbMedico(),g=b.getCbEsitoVmd(),h=b.getCbEsitoErogazioneMisura();h.bindStore(Ext.create("Ext.data.ChainedStore",{source:c}));h.getStore().filter({filterFn:function(b){return"EM"==b.get("extra")?!0:!1}});d.bindStore(Ext.create("Ext.data.ChainedStore",{source:c}));
d.getStore().filter({filterFn:function(b){return"TV"==b.get("extra")?!0:!1}});f.bindStore(Ext.create("Ext.data.ChainedStore",{source:c}));f.getStore().filter({filterFn:function(b){return"SM"==b.get("extra")?!0:!1}});g.bindStore(Ext.create("Ext.data.ChainedStore",{source:c}));g.getStore().filter({filterFn:function(b){return"EVD"==b.get("extra")?!0:!1}});c=Ext.create("Ext.data.Store",{fields:["codice","valore"],data:[{codice:1,valore:"0"},{codice:2,valore:"0.5 Demenza dubbia"},{codice:3,valore:"1 Demenza lieve"},
{codice:4,valore:"2 Demenza moderata"},{codice:5,valore:"3 Demenza grave"},{codice:6,valore:"4 Demenza molto grave"},{codice:7,valore:"5 Demenza terminale"}]});b.getCDRManuale().setStore(c);loadStore(b.getCmbcareManager().getStore(),{nomeUtente:""});b.gestioneForm();b.idRicovero=b.cbaConfig.controllerFascicolo.idRicovero;Ext.Ajax.request({method:"GET",url:"/cba/osp/rap/ws/rsaAperta/vmd/getCodStruttura",params:{idRicovero:b.idRicovero},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?
b.codStruttura=c.data:msgShowError("",c.message)}});b.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.Referenti",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"Container",selector:c+"#Container"},{ref:"EditReferentiForm",selector:c+"#EditReferentiForm"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"StoricoGridRef",selector:c+"#StoricoGridRef"},{ref:"refGradoParentela",selector:c+"#refGradoParentela"},{ref:"pnlRatingRef",selector:c+"#pnlRatingRef"},{ref:"refRating",
selector:c+"#refRating"},{ref:"refPnlIndirizzi",selector:c+"#refPnlIndirizzi"},{ref:"refDelegato",selector:c+"#refDelegato"},{ref:"EditReferentiForm",selector:c+"#EditReferentiForm"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"RecordId",selector:c+"#RecordId"},{ref:"refNome",selector:c+"#refNome"},{ref:"refTelefono1",selector:c+"#refTelefono1"},{ref:"refTelefono2",selector:c+"#refTelefono2"},{ref:"refTelefono3",selector:c+"#refTelefono3"},{ref:"refFax",selector:c+"#refFax"},{ref:"RefEmail",
selector:c+"#RefEmail"},{ref:"refDelegato",selector:c+"#refDelegato"},{ref:"refGarante",selector:c+"#refGarante"},{ref:"refNote",selector:c+"#refNote"},{ref:"BtnEmail",selector:c+"#BtnEmail"},{ref:"BtnCreaAnagraficaREF",selector:c+"#BtnCreaAnagraficaREF"},{ref:"dataNascita",selector:c+"#dataNascita"},{ref:"comuneNascita",selector:c+"#comuneNascita"},{ref:"nazioneNascita",selector:c+"#nazioneNascita"},{ref:"codiceFiscale",selector:c+"#codiceFiscale"},{ref:"refPagante",selector:c+"#refPagante"},{ref:"ImportPagante",
selector:c+"#ImportPagante"}]);b.control(c+"#StoricoGridRef",{select:b.onStoricoGridReferentiItemClick});b.control(c+"#BtnEmail",{click:b.BtnEmailclick});b.control(c+"#BtnCreaAnagraficaREF",{click:b.BtnCreaAnagraficaREFclick});b.control(c+"#comuneNascita",{beforequery:b.onComuneNascitaBeforeQuery});b.control(c+"#nazioneNascita",{change:b.onNazioneNascitaChange});b.control(c+"#codiceFiscale",{change:b.onCodiceFiscaleChange});b.control(c+"#refNome",{change:b.onRefNomeChange});b.control(c+"#refPagante",
{select:b.onRefPaganteSelect});b.control(c+"#ImportPagante",{change:b.onImportPaganteChange});b.on({esci:function(){b.getEditReferentiForm().boxBottoni.queryById("btnEsci").handler()}});b.on({changeTab:function(){return b.changeTab()}})},filterPaganti:function(b){var c=this;b.getStore().clearFilter();b.getStore().filter({filterFn:function(b){return("4"==c.personContabili.tipoContabilitaAbilitata||"5"==c.personContabili.tipoContabilitaAbilitata)&&b.data.extra&&b.data.extra.split(",")?"T"==b.data.extra.split(",")[1]?
!0:!1:!0}})},onImportPaganteChange:function(b,c,d,f){var g=this;g.getRefPagante().setVisible(c);g.getRefNome().setVisible(!c);c?(g.getRefPagante().clearValue(),g.getRefPagante().focus(!1,200),g.storePaganti||(g.personContabili||(g.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null)),g.storePaganti=g.getRefPagante().getStore(),g.storePaganti.getProxy().setExtraParam("tipoContabilita",g.personContabili.tipoContabilitaAbilitata),g.storePaganti.getProxy().setExtraParam("limit",0),g.storePaganti.load({callback:function(b,
c,d){d&&g.filterPaganti(g.getRefPagante())}}))):g.nuovo()},onRefPaganteSelect:function(b,c,d){b.value&&(b=this.getDatiPagante(b.value),this.getEditReferentiForm().getForm().setValues(b.data),b={cap:b.data.cap,comune:b.data.codIstatComune,desComune:b.data.citta,desNazione:b.data.desNazione?b.data.desNazione:"",indirizzo:b.data.indirizzo,nazione:b.data.cfNazione?b.data.cfNazione:"0",provincia:b.data.provincia},this.getRefPnlIndirizzi().items.items[0].controller.updateDati(b))},getDatiPagante:function(b){var c=
{};Ext.Ajax.request({url:"/cba/gen/ws/general/anfocl/get",params:{id:b,tipoContabilita:this.personContabili.tipoContabilitaAbilitata},method:"GET",async:!1,success:function(b){c=Ext.JSON.decode(b.responseText);c.success?(c.data.nomePersona=c.data.ragioneSociale,c.data.email=c.data.mail,c.data.pfDataNascita&&(c.data.dataNascita=new Date(c.data.pfDataNascita)),c.data.pfComuneNascita&&(c.data.comuneNascita=c.data.pfComuneNascita),c.data.pfNazioneNascita&&(c.data.nazioneNascita="I"===c.data.pfNazioneNascita||
"100"===c.data.pfNazioneNascita?0:c.data.pfNazioneNascita)):msgShowError("",c.message)}});return c},onRefNomeChange:function(b,c,d,f){Ext.isEmpty(d)&&0==this.getStoricoGridRef().getStore().count()&&this.getRefPnlIndirizzi().items.items[0].controller.updateNazione("0")},onComuneNascitaBeforeQuery:function(b,c){if(!b.query)return!1;forceQueryCombo(this.getComuneNascita(),2," ")},onCodiceFiscaleChange:function(b,c,d,f){var g=this;!this.getCodiceFiscale().isValid()||Ext.isEmpty(d)&&!Ext.isEmpty(g.getDataNascita().getValue())?
16!=c.length||this.getCodiceFiscale().isValid()||(g.getNazioneNascita().clearValue(),g.getDataNascita().reset(),g.getComuneNascita().clearValue()):(b=g.getCodiceFiscale().getValue(),16==b.length&&(g.valoriCF=getValoriCodiceFiscale(b),g.getNazioneNascita().setValue(g.valoriCF.nazioneNascita),g.getDataNascita().setValue(g.valoriCF.dataNascita),"Z"!=(g.valoriCF.comuneNascita?g.valoriCF.comuneNascita.substr(0,1):"")&&g.storeComuniTmp.load({params:{codFiscale:g.valoriCF.comuneNascita,dataControllo:g.valoriCF.dataNascita},
callback:function(b,c,d){d?Ext.isEmpty(b)||(c=b[0].get("codice"),b=b[0].get("valore"),g.getComuneNascita().setValue(c),setCombo(g.getComuneNascita(),c,b.substr(0,3))):msgShowError("",c.getError())}}),g.getComuneNascita().setValue("")))},onNazioneNascitaChange:function(b,c,d,f){"0"!=c?(this.getComuneNascita().setValue(null),abilitaCmp(this.getComuneNascita(),!1)):abilitaCmp(this.getComuneNascita(),!0);this.getComuneNascita().validateValue(this.getComuneNascita().getValue())},afterTabChange:function(){0==
this.getStoricoGridRef().getStore().getTotalCount()&&this.getRefNome().focus(!1,200)},BtnEmailclick:function(){var b=window.open("mailto:"+this.getRefEmail().getValue());setTimeout(function(){b.close()},1E3)},BtnCreaAnagraficaREFclick:function(b,c,d){var f=c="";if(this.getRefPnlIndirizzi().items.items[0].controller.getNazione().getValue()){if(d=this.getRefPnlIndirizzi().items.items[0].controller.getNazione().getValue(),"0"==this.getRefPnlIndirizzi().items.items[0].controller.getNazione().getValue())if(this.getRefPnlIndirizzi().items.items[0].controller.getComune().getValue())b=
this.getRefPnlIndirizzi().items.items[0].controller.getComune().getRawValue().split(" ("),c=b[0].slice(0,-1),f=b[1].slice(0,-1);else return Messaggio("CREA_ANAGRAFICA_PAGANTE","SELEZIONARE_CITTA","OK","INFORMATION"),!1}else return Messaggio("CREA_ANAGRAFICA_PAGANTE","SELEZIONARE_NAZIONE","OK","INFORMATION"),!1;b=this.getRefPnlIndirizzi().items.items[0].controller.getIndirizzo().getValue();var g=this.getRefPnlIndirizzi().items.items[0].controller.getNumero().getValue(),h=this.getRefPnlIndirizzi().items.items[0].controller.getEsponente().getValue(),
k=this.getRefPnlIndirizzi().items.items[0].controller.getInterno().getValue();this.personContabili||(this.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null));4==this.personContabili.tipoContabilitaAbilitata||5==this.personContabili.tipoContabilitaAbilitata?b=(Ext.isEmpty(b)?null:b)+"#"+(Ext.isEmpty(g)?null:g)+"#"+(Ext.isEmpty(h)?null:h)+"#"+(Ext.isEmpty(k)?null:k):g&&(b=b+", "+g,h&&(b=b+"/"+h),k&&(b=b+" Int. "+k));c={fromPersRif:!0,nominativo:this.getRefNome().getValue(),indResidenza:{desComune:c,
provincia:f,cap:this.getRefPnlIndirizzi().items.items[0].controller.getCap().getValue(),nazione:d,comune:this.getRefPnlIndirizzi().items.items[0].controller.getComune().getValue()},codiceFiscale:Ext.isEmpty(this.getCodiceFiscale().getValue())?null:this.getCodiceFiscale().getValue()};if(this.getCodiceFiscale().isValid()){Ext.isDefined(this.valoriCF)||(this.valoriCF=getValoriCodiceFiscale(this.getCodiceFiscale().getValue()));d=this.getRefNome().getValue().split(" ");1<=d.length&&Ext.apply(c,{cognome:d[0]});
if(2<=d.length){f=d[1];for(g=2;g<d.length;g++)f=f+d[g]+" ";Ext.apply(c,{nome:f})}Ext.apply(c,{sesso:this.valoriCF.sesso});Ext.apply(c,{dataNascita:this.getDataNascita().getValue()});Ext.apply(c,{comuneNascita:this.getComuneNascita().getValue()});Ext.apply(c,{nazioneNascita:this.getNazioneNascita().getValue()})}checkInsertNewPagante(c,b,this.personContabili)},changeTab:function(){var b=this,c=b.getEditReferentiForm().up("window");controller_puoiUscire(c,b.getEditReferentiForm(),function(){b.salva(!1)},
function(){b.aggiornaStore();b.cbaConfig.controllerEditFascicolo.navigaWizard(b.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){b.aggiornaStore()})},onStoricoGridReferentiItemClick:function(b,c,d,f){this.impostaDati(c)},impostaDati:function(b){this.getStoricoGridRef().setDisabled(!1);clearForm(this.getEditReferentiForm().id);b?(0===b.data.gradoParentela&&(b.data.gradoParentela=null),this.getEditReferentiForm().loadRecord(b),this.getPnlRatingRef().down().setValue(b.get("rating")),this.getRefRating().setValue(""),
b.data.indirizzo?this.getRefPnlIndirizzi().items.items[0].controller.updateDati(b.data.indirizzo):(this.getRefPnlIndirizzi().items.items[0].controller.svuotaDati(),this.getRefPnlIndirizzi().items.items[0].controller.updateNazione("0")),b.data.comuneNascita&&setCombo(this.getComuneNascita(),b.data.comuneNascita,b.data.desComuneNascita),this.getBtnCreaAnagraficaREF().setDisabled(Ext.isEmpty(this.getCodiceFiscale().getValue())||!this.getCodiceFiscale().isValid())):(this.getRefPnlIndirizzi().items.items[0].controller.updateNazione("0"),
this.getPnlRatingRef().down().setValue(0),this.getEditReferentiForm().getForm().setValues({RatingModificato:""}))},nuovo:function(){controller_nuovoRecord(this.getEditReferentiForm());this.getRefPnlIndirizzi().items.items[0].controller.updateNazione("0");this.getPnlRatingRef().down().setValue(0);this.getImportPagante().setVisible(50==CBA.moduli.moduloAttivo||43==CBA.moduli.moduloAttivo)},verificaCampiForm:function(){if((this.getRefPnlIndirizzi().items.items[0].controller.getIndirizzo().getValue()||
this.getRefPnlIndirizzi().items.items[0].controller.getNumero().getValue()||this.getRefPnlIndirizzi().items.items[0].controller.getEsponente().getValue()||this.getRefPnlIndirizzi().items.items[0].controller.getInterno().getValue()||this.getRefPnlIndirizzi().items.items[0].controller.getCap().getValue()||this.getRefPnlIndirizzi().items.items[0].controller.getComune().getValue()||"0"!=this.getRefPnlIndirizzi().items.items[0].controller.getNazione().getValue())&&!1===this.getRefPnlIndirizzi().items.items[0].controller.verificaIndirizzo())return!1;
var b=[];this.getEditReferentiForm().getForm().isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},salva:function(b){if(!this.verificaCampiForm())return!1;var c={codOspite:this.cbaConfig.nuovo?this.cbaConfig.nuovo:this.cbaConfig.controllerFascicolo.currentDip,id:this.getRecordId().getValue(),nomePersona:this.getRefNome().getValue(),gradoParentela:this.getRefGradoParentela().getValue(),telefono1:this.getRefTelefono1().getValue(),telefono2:this.getRefTelefono2().getValue(),telefono3:this.getRefTelefono3().getValue(),
fax:this.getRefFax().getValue(),email:this.getRefEmail().getValue(),rating:this.getPnlRatingRef().down().getValue(),delegaDenaro:getBoolValue(this.getRefDelegato().getValue()),garante:getBoolValue(this.getRefGarante().getValue()),note:this.getRefNote().getValue(),dataNascita:this.getDataNascita().getValue(),codiceFiscale:this.getCodiceFiscale().getValue(),comuneNascita:this.getComuneNascita().getValue(),nazioneNascita:this.getNazioneNascita().getValue()};if(this.getRefPnlIndirizzi().items.items[0].controller.getIndirizzo().getValue()||
this.getRefPnlIndirizzi().items.items[0].controller.getComune().getValue()||"0"!=this.getRefPnlIndirizzi().items.items[0].controller.getNazione().getValue()){var d=this.getRefPnlIndirizzi().items.items[0].controller.getForm().getForm().getFieldValues();delete d.dataDecorrenza;delete d.tipoIndirizzo;Ext.apply(c,{indirizzo:d})}controller_salvaRecord(this.getEditReferentiForm(),c,b)&&!b&&this.cbaConfig.wizard&&""!=this.cbaConfig.controllerEditFascicolo.navDirection&&this.cbaConfig.controllerEditFascicolo.navigaWizard(this.cbaConfig.controllerEditFascicolo.navDirection,
!0)},aggiornaStore:function(b){var c=this,d=c.getStoricoGridRef().getStore();c.getRefPagante().clearValue();c.getRefPagante().setVisible(!1);c.getImportPagante().setValue("F");c.getImportPagante().setVisible(!1);d.load({params:{codospite:c.cbaConfig.nuovo?c.cbaConfig.nuovo:c.cbaConfig.controllerFascicolo.currentDip},callback:function(f,g,h){h?(Ext.isEmpty(f)?clearForm(c.getEditReferentiForm().id):(b||(b=c.getRecordId().getValue()),f=trovaRecord(d,"id",b),g=c.getStoricoGridRef(),g.getSelectionModel().deselectAll(),
g.getSelectionModel().select(f?[f]:0)),c.cbaConfig.wizard&&c.cbaConfig.controllerEditFascicolo.aggiornaPercCompletamento()):msgShowError("",g.getError())}})},onLaunch:function(){var b=this;b.getContainer().controller=b;ImpostaUrl([b.getStoricoGridRef().getStore(),b.getRefGradoParentela().getStore(),b.getNazioneNascita().getStore(),b.getComuneNascita().getStore()]);b.getComuneNascita().getStore().getProxy().extraParams={excom:!0};loadStore(b.getNazioneNascita().getStore(),{exnaz:!0});var c=b.getEditReferentiForm();
c.boxBottoni=b.getBoxBottoni();c.store=b.getStoricoGridRef().getStore();c.controller=b;var d=49===CBA.moduli.moduloAttivo,f=Ext.create("Generali.standard."+(d?"controller_PannelloBottoni":"controller_PannelloBottoniVert"),{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var d=b.getEditReferentiForm().getForm().findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(c.store,
{idPersona:d},function(){b.aggiornaStore()})},esci_callback:function(){var d=c.up("window");controller_puoiUscire(d,c,function(){b.salva(!0)},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()},function(){b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.updatePortlet&&b.cbaConfig.controllerPortlet.updatePortlet();d.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:d?
!0:null,personIcons:d?getIconButtons():null}});inserisciBottoni(b.getBoxBottoni(),f);d&&(b.getBoxBottoni().queryById("btnElimina").setIconCls(getIconButtons().btnEliminaX),b.getBoxBottoni().queryById("btnEsci").setHidden(!0));CBA.moduli.modulo43.abilitato&&CBA.moduli.modulo50.abilitato&&b.getRefPagante().setStore(Ext.create("GeneraliOSP.store.FattListaPaganti",{autoLoad:!1}));b.getPnlRatingRef().add({xtype:"rating",itemId:"RatingRef",reference:"RatingRef",clickStar:function(){b.getRefRating().setValue("T")}});
b.getRefRating().hide();d=Ext.create("GeneraliOSP.fascicoloNoApp.view.BoxIndirizzi",{itemId:"pnlIndirizzi",reference:"pnlIndirizzi"+Ext.Date.now(),cbaConfig:{nascondiButtonModifica:!0,gestioneTipoIndirizzo:!1,gestioneDataDecorrenza:!1,cittaObbligatoria:!1,visualizzaAsl:!1,visualizzaAsst:!1}});b.getRefPnlIndirizzi().add(d);d=b.getRefPnlIndirizzi();for(f=0;f<d.items.items[0].items.getCount();f++)d.items.items[0].items.items[f].setPosition(d.items.items[0].items.items[f].x,d.items.items[0].items.items[f].y-
30);b.getRefPnlIndirizzi().items.items[0].setHeight(150);b.getRefPnlIndirizzi().setHeight(175);b.getRefDelegato().setVisible(CBA.moduli.modulo46.abilitato||CBA.moduli.modulo23.abilitato);var g;b.cbaConfig.controllerPortlet&&b.cbaConfig.controllerPortlet.getContainer()&&b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0]&&(g=b.cbaConfig.controllerPortlet.getContainer().getSelectionModel().getSelection()[0].get("id"));this.aggiornaStore(g);loadStore(b.getRefGradoParentela().getStore());
b.cbaConfig.controllerEditFascicolo&&b.cbaConfig.controllerEditFascicolo.cbaConfig.nuovo&&(c.boxBottoni.queryById("btnEsci").setVisible(!1),clearForm(b.getEditReferentiForm().id));if("L"!=b.cbaConfig.permesso)c.getForm().on("dirtychange",function(d,f){controller_abilitaBottoni(c);b.getStoricoGridRef().setDisabled(f);b.getBtnCreaAnagraficaREF().setDisabled(f||Ext.isEmpty(b.getCodiceFiscale().getValue())||!b.getCodiceFiscale().isValid());b.getBtnEmail().setDisabled(f);b.cbaConfig.controllerEditFascicolo&&
(b.cbaConfig.controllerEditFascicolo.getBtnEsci().setDisabled(f),b.cbaConfig.controllerEditFascicolo.getBtnCreaAnagrafica().setDisabled(f))});"L"!=b.cbaConfig.permesso&&permettiModificheDopoDimissione()||(containerSolaLettura(c),controller_bottoniSolaLettura(b.getBoxBottoni()),abilitaCmp(b.getPnlRatingRef(),!1),b.getBtnCreaAnagraficaREF().setDisabled(!0),b.getBtnEmail().setDisabled(!0));50==CBA.moduli.moduloAttivo||43==CBA.moduli.moduloAttivo?(b.getBtnCreaAnagraficaREF().setVisible(!0),b.getImportPagante().setVisible(!0),
b.getRefPagante().bindStore(Ext.create("GestioneFatture.store.FattListaPaganti",{autoLoad:!1}))):(b.getBtnCreaAnagraficaREF().setVisible(!1),b.getImportPagante().setVisible(!1));b.storeComuniTmp=Ext.create("Generali.comuni.store.cboxComuniGenCodFisc")},destroy:function(){this.cbaConfig.portlet&&this.cbaConfig.portlet.down("#Container").controller.updatePortlet();eliminaStore(this.storeComuniTmp);this.callParent()}});
Ext.define("GeneraliOSP.portlet.controller.Regionale",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"EditRegione",selector:c+"#EditRegione"},{ref:"Container",selector:c+"#Container"},{ref:"boxBottoni",selector:c+"#boxBottoni"},{ref:"EditRegionaleForm",selector:c+"#EditRegionaleForm"},{ref:"StoricoGridRegionale",selector:c+"#StoricoGridRegionale"}]);b.control(c+"#StoricoGridRegionale",{select:b.selectStoricoGridRegionale});
b.on({esci:function(){b.getEditRegionaleForm().boxBottoni.queryById("btnEsci").handler()},changeTab:function(){return b.changeTab()}})},impostaDati:function(b){},nuovo:function(){},verificaCampiForm:function(){},salva:function(b,c){},getStoricoGrid:function(){return this.getStoricoGridResidenza()},aggiornaStore:function(b){},caricaGrid:function(b,c,d){var f=b.getStore();f.load({params:{idRicovero:this.cbaConfig.controllerFascicolo.currentAss},callback:function(d,h,k){k?Ext.isEmpty(d)||(d=trovaRecord(f,
"id",c),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d?[d]:0)):msgShowError("",h.getError())}})},selectStoricoGridRegionale:function(b,c,d,f){this.edtClassIntReg.controller.impostaDati(c)},gestClassIntReg:function(){var b=this,c=b.getStoricoGridRegionale();b.edtClassIntReg=Ext.create("GeneraliOSP.portlet.view.EdtClassIntReg",{itemId:"EdtClass",reference:"EdtClass",cbaConfig:{permesso:b.cbaConfig.permesso,gridStorico:c,classType:5,idServizio:b.cbaConfig.controllerFascicolo.currentServizio,
idRicovero:b.cbaConfig.controllerFascicolo.currentAss,codOspite:b.cbaConfig.controllerFascicolo.currentDip,caricaGrid:function(c,f){b.caricaGrid(c,f)},noPortlet:b.cbaConfig.noPortlet,controllerPortlet:b.cbaConfig.controllerPortlet,wizard:b.cbaConfig.wizard,tipoServizio:b.cbaConfig.tipoServizio,regione:b.cbaConfig.regione,fromRegionali:!0}});b.edtClassIntReg.controller.inizializzaForm(5,b.getStoricoGridRegionale());b.getEditRegionaleForm().add(b.edtClassIntReg)},onLaunch:function(){var b=this;b.getContainer().controller=
b;b.getStoricoGridRegionale().bindStore(Ext.create("GeneraliOSP.portlet.store.ClassRegionale"));ImpostaUrl([b.getStoricoGridRegionale().getStore()]);b.gestClassIntReg();b.caricaGrid(b.getStoricoGridRegionale(),b.cbaConfig.controllerFascicolo.currentDip);!b.cbaConfig.codOspite&&b.cbaConfig.controllerEditFascicolo&&(b.cbaConfig.codOspite=b.cbaConfig.nuovo);var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},
nuovo_callback:function(){b.nuovo()},elimina_callback:function(){},esci_callback:function(){b.getEditRegione().up("window").close()},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),c)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.portlet.store.Accompagnatori",{extend:"Ext.data.Store",fields:[{name:"codOspite"},{name:"id"},{name:"nomePersona"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},extraParams:{idRicovero:""},urlGen:"/ws/genOsp/prsrif/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.Assenze",{extend:"Ext.data.Store",fields:[{name:"idAssenza"},{name:"idRicovero"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"motivoUscita"},{name:"desMotivoUscita"},{name:"codiceOspedale"},{name:"tipoUscita"},{name:"conAssistenza"},{name:"note"},{name:"idAssenzaCs"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},extraParams:{idRicovero:""},urlGen:"/ws/genOsp/asstemp/search",reader:{type:"json",idProperty:"idAssenza",messageProperty:"message",
rootProperty:"data"}},autoDestroy:!0});Ext.define("GeneraliOSP.portlet.store.CBEsenzioniTicket",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/docs/tipiesenz",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.CDIDettaglio",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCdiPlanTestata"},{name:"dataDecorrenza",type:"date"},{name:"giornoSettimana"},{name:"idRisposta"},{name:"desPrestazione"},{name:"quantita"},{name:"quotaSanitaria"},{name:"quotaSociale"},{name:"quotaSanPers"},{name:"quotaSocPers"},{name:"previsto"},{name:"pianificato"},{name:"erogato"},{name:"nonErogato"},{name:"residuo"},{name:"statoRisposta"},{name:"lun"},{name:"mar"},{name:"mer"},{name:"gio"},
{name:"ven"},{name:"sab"},{name:"dom"}],proxy:{api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/cdi/weekplan/get"},autoLoad:!1});
Ext.define("GeneraliOSP.portlet.store.CDIPaganti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idRisposta"},{name:"idCdiPlanTestata"},{name:"tipoQuota"},{name:"codfocl"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"quotaSanitaria"},{name:"quotaSociale"},{name:"quotaSanitariaAssenza"},{name:"quotaSocialeAssenza"},{name:"ragioneSociale"}],proxy:{urlGen:"/ws/genOsp/cdi/pgnt/src",api:{read:".",create:".",update:".",destroy:"."}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.CDIPlanWeek",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idCdiPlanTestata"},{name:"idRisposta"},{name:"desPrestazione"},{name:"statoRisposta"},{name:"lun"},{name:"mar"},{name:"mer"},{name:"gio"},{name:"ven"},{name:"sab"},{name:"dom"}],proxy:{type:"ajax",extraParams:{idRicovero:""},urlGen:"/ws/genOsp/cdi/weekplan/last",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.CRM",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"codOspite"},{name:"data",type:"date"},{name:"tipoContatto"},{name:"idContatto"},{name:"nominativo"},{name:"motivo"},{name:"stato"},{name:"oggetto"},{name:"note"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/crm/src",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:".",create:".",update:".",destroy:"."}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.CRM_Modalita",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/crm/modalita",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.CRM_Nominativi",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/crm/listcntt",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.CRM_TipoContatto",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/crm/tipocntt",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.CalendarioAssenze",{extend:"Ext.data.Store",fields:[{name:"mese"},{name:"gg1"},{name:"gg2"},{name:"gg3"},{name:"gg4"},{name:"gg5"},{name:"gg6"},{name:"gg7"},{name:"gg8"},{name:"gg9"},{name:"gg10"},{name:"gg11"},{name:"gg12"},{name:"gg13"},{name:"gg14"},{name:"gg15"},{name:"gg16"},{name:"gg17"},{name:"gg18"},{name:"gg19"},{name:"gg20"},{name:"gg21"},{name:"gg22"},{name:"gg23"},{name:"gg24"},{name:"gg25"},{name:"gg26"},{name:"gg27"},{name:"gg28"},{name:"gg29"},
{name:"gg30"},{name:"gg31"}],proxy:{type:"ajax"}});Ext.define("GeneraliOSP.portlet.store.ClRettaAmbTe",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idRicovero"},{name:"dataDecorrenza",type:"date"},{name:"dataFine",type:"date"},{name:"note"},{name:"statoInvio"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},extraParams:{idRicovero:""},urlGen:"/ws/genOsp/cdi/head/search",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.ClRettaCdiTe",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idRicovero"},{name:"dataDecorrenza",type:"date"},{name:"dataFine",type:"date"},{name:"note"},{name:"idProfilazione"},{name:"desProfilazione"},{name:"motivoAssenzaDefault"},{name:"desMotivoAssenzaDef"}],proxy:{api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/cdi/head/search"},autoLoad:!1});
Ext.define("GeneraliOSP.portlet.store.ClassInterna",{extend:"Ext.data.Store",fields:[{name:"idClassificazione"},{name:"idRicovero"},{name:"tipoClassificazione"},{name:"codiceClassificazione"},{name:"noteClassificazione"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"desClassificazione"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/rette/class/int",reader:{type:"json",idProperty:"idClassificazione",messageProperty:"message",rootProperty:"data"}},
autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.ClassRegionale",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idClassificazione"},{name:"idRicovero"},{name:"tipoClassificazione"},{name:"codiceClassificazione"},{name:"noteClassificazione"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"desClassificazione"},{name:"classeSosia"},{name:"datiRegionali"},{name:"id_reg",mapping:"datiRegionali.id"},{name:"utNonStd",mapping:"datiRegionali.utNonStd"},{name:"importoSupplementare",mapping:"datiRegionali.importoSupplementare"},
{name:"regione",mapping:"datiRegionali.regione"},{name:"gruppo",mapping:"datiRegionali.gruppo"},{name:"associataA",mapping:"datiRegionali.associataA"},{name:"importoSSR",mapping:"datiRegionali.importoSSR"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/rette/class/reg",reader:{type:"json",idProperty:"idClassificazione",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.ClassRetta",{extend:"Ext.data.Store",fields:[{name:"idProfilazione"},{name:"idClassificazione"},{name:"idRicovero"},{name:"tipoClassificazione"},{name:"codiceClassificazione"},{name:"noteClassificazione"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"quotaSanitariaRetta"},{name:"quotaSocialeRetta"},{name:"desClassificazione"},{name:"quotaSanitariaDefault"},{name:"quotaSocialeDefault"},{name:"quotaSanitariaFatt"},{name:"quotaSocialeFatt"},{name:"totaleRettaFatt"},
{name:"statoRisposta"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/rette/class/retta",reader:{type:"json",idProperty:"idClassificazione",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("GeneraliOSP.portlet.store.Classe",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore"}],data:[[1,1],[2,2],[3,3],[4,4],[5,5],[6,6],[7,7],[8,8]],autoLoad:!0,autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.CodiciTeam",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/teamcard/getstati",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.Consenso",{extend:"Ext.data.Store",alias:"store.dossier",fields:[{name:"id"},{name:"dal",type:"date"},{name:"al",type:"date"},{name:"compilatore"},{name:"consenso"},{name:"codUtente"},{name:"updateData"},{name:"updateCompilatore"},{name:"numAllegati"},{name:"_oraDal",type:"date",convert:function(b,c){return Ext.clone(c.get("dal"))}},{name:"_oraAl",type:"date",convert:function(b,c){return Ext.clone(c.get("al"))}}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/dossier/list",
api:{read:"/cba/css/cs/ws/dossier/list",update:"/cba/css/cs/ws/dossier/update",create:"/cba/css/cs/ws/dossier/new",destroy:"/cba/css/cs/ws/dossier/delete"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},sorters:[{property:"id",direction:"DESC"}],autoLoad:!1,autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.Documenti",{extend:"Ext.data.Store",fields:[{mapping:"codOspite",name:"codOspite"},{mapping:"idDocumento",name:"idDocumento"},{mapping:"dataEmissione",name:"dataEmissione",type:"date"},{mapping:"desTipoDocumento",name:"desTipoDocumento"},{mapping:"nomeIdIstituzione",name:"nomeIdIstituzione"},{mapping:"numIdIstituzione",name:"numIdIstituzione"},{mapping:"numeroTessera",name:"numeroTessera"},{mapping:"numero",name:"numero"},{mapping:"dataScadenza",name:"dataScadenza",
type:"date"},{mapping:"tipoDocumento",name:"tipoDocumento"},{mapping:"descrizioneBreve",name:"descrizioneBreve"},{mapping:"nazione",name:"nazione"},{mapping:"nomeFile",name:"nomeFile"},{mapping:"idAllegato",name:"idAllegato"},{mapping:"idRisposta",name:"idRisposta"},{name:"teamCard"},{name:"ticket"},{name:"priorita"},{name:"tipoImp"},{name:"tipoRicetta"},{name:"note"},{name:"idMedico"},{name:"codEsenzione"},{name:"idEsenzioneTicket"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/docs/get",reader:{type:"json",
messageProperty:"message",rootProperty:"data"},api:{read:".",create:".",update:".",destroy:"."}},autoDestroy:!0,sorters:[{property:"desTipoDocumento",transform:function(b){return null==b?b:b.toLowerCase()}}]});
Ext.define("GeneraliOSP.portlet.store.ExtraImporti",{extend:"Ext.data.Store",idProperty:"idExtraRetta",fields:[{name:"idRicovero"},{name:"idExtraRetta"},{name:"descrizione"},{name:"tipoImporto"},{name:"tipo"},{name:"fattoreMoltiplicazione"},{name:"desFattoreMoltiplicazione"},{name:"giorniMoltiplicazione"},{name:"quotaSanitaria"},{name:"quotaSociale"},{name:"quotaSanitariaDefault"},{name:"quotaSocialeDefault"},{name:"quotaSanitariaFatt"},{name:"quotaSocialeFatt"},{name:"totaleFatt"}],autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.ExtraRetta",{extend:"Ext.data.Store",fields:[{name:"idExtraRetta"},{name:"idRicovero"},{name:"tipo"},{name:"idRisposta"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"fattoreMoltiplicazione"},{name:"giorniMoltiplicazione"},{name:"tipoImporto"},{name:"descrizioneAggiuntiva"},{name:"desRisposta"},{name:"isActive"},{name:"quotaSanitaria"},{name:"quotaSociale"},{name:"quotaSanitariaDefault"},{name:"quotaSocialeDefault"},{name:"quotaSanitariaFatt"},
{name:"quotaSocialeFatt"},{name:"totaleFatt"},{name:"giorniPianificazione"},{name:"generatoDa"},{name:"conguaglioDa",type:"date"},{name:"conguaglioA",type:"date"},{name:"statoRisposta"},{name:"noteInterne"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},extraParams:{idRicovero:""},urlGen:"/ws/genOsp/rette/extra/src",reader:{type:"json",idProperty:"idExtraRetta",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.FARBina",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"compilatore"},{name:"punteggio"},{name:"desPunteggio"},{name:"dataValutazione",type:"date"},{name:"dataScadenza",type:"date"},{name:"giorniModifiche"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/far/getDatiBINA",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.FARDati",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"annoPratica"},{name:"numPratica"},{name:"codStruttura"},{name:"data_inizio",type:"date"},{name:"data_fine",type:"date"},{name:"desPosContabile"},{name:"aCaricoFRNA"},{name:"numPraticaZero"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/far/getDatiPratica",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.FRDatiSosia",{extend:"Generali.data.Store",fields:[{name:"id"},{name:"idRicovero"},{name:"idRicoveroCS"},{name:"data",type:"date"},{name:"tipoValutazione"},{name:"tipoFlussoVal"},{name:"scadenza",type:"date"},{name:"stato"},{name:"statoInvio"},{name:"punteggio",convert:function(b,c){if(c.get("punteggio"))return c.get("totPunteggio")?c.get("punteggio")+"/"+c.get("totPunteggio"):c.get("punteggio")}},{name:"ica",convert:function(b,c){return"T"==c.get("ica")?traduci("SI"):
traduci("NO")}},{name:"totPunteggio"},{name:"nomeScheda"},{name:"resultM"},{name:"resultC"},{name:"resultS"},{name:"classe"},{name:"desClasse"},{name:"desStatoInvio"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/fr/valutazioniExtended/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/ws/genOsp/fr/valutazioniExtended/get",update:"/ws/genOsp/fr/valutazioniExtended/update"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.FRDatiSosia_Tariffe",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idPratica"},{name:"idRicovero"},{name:"dal",type:"date"},{name:"al",type:"date"},{name:"qComuni"},{name:"qPrivati"},{name:"qEnti"},{name:"recordVirtuale"},{name:"tariffaSupplementare"},{name:"assegnoAccompagnamento"}],proxy:{urlGen:"/ws/genOsp/fr/tariffe/search",api:{read:"/ws/genOsp/fr/tariffe/search",create:"/ws/genOsp/fr/tariffe/new",update:"/ws/genOsp/fr/tariffe/update",destroy:"/ws/genOsp/fr/tariffe/delete"},
reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("GeneraliOSP.portlet.store.FRDatiSvama",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idRicovero"},{name:"dataSvama",type:"date"},{name:"tipoValutazione"},{name:"stato"},{name:"punteggioSvama"},{name:"profilo"},{name:"dataKarnofsky",type:"date"},{name:"punteggioKarnofsky"}],proxy:{urlGen:"/ws/genOsp/fr/datiSvama/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.FRDiagnosi",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"data",type:"date"},{name:"idDiagnosiOut"},{name:"ordine"},{name:"principale"},{name:"icd9"},{name:"icd9Descrizione"},{name:"icpc"},{name:"icpcDescrizione"},{name:"idRicovero"},{name:"idRicoveroCss"},{name:"lato"},{name:"latoDescrizione"},{name:"latoCodifica"},{name:"stadio"},{name:"stadioDescrizione"},{name:"stadioCodifica"},{name:"presente"},{name:"tipoSdo"},{name:"descrizioneTipoSdo"}],
proxy:{urlGen:"/ws/genOsp/fr/valutazioni/diagnosi"},autoDestroy:!0});Ext.define("GeneraliOSP.portlet.store.FRInterventi",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"data",type:"date"},{name:"idDiagnosiIn"},{name:"icd9"},{name:"ordine"},{name:"icpc"},{name:"icpcDescrizione"},{name:"icd9Descrizione"},{name:"idRicovero"},{name:"idRicoveroCss"},{name:"idRicovero"}],proxy:{urlGen:"/ws/genOsp/fr/valutazioni/interventi"},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.FRPratica",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idPratica"},{name:"idRicovero"},{name:"annoPratica"},{name:"numPratica"},{name:"annoNumPratica"},{name:"codStruttura"},{name:"tipoFlusso"},{name:"dal",type:"date"},{name:"al",type:"date"},{name:"statoInvio"},{name:"aCaricoFSR"},{name:"soggettoPagante"},{name:"motApertura"},{name:"motChiusura"},{name:"esitoCongedo"},{name:"tipologiaUtente"},{name:"tipologiaAssistenza"},{name:"valutazioneRichiesta"},
{name:"tipoPostoLetto"},{name:"tipoRicRiab"},{name:"numAccessi"},{name:"classeAsa"},{name:"gradoSupporto"},{name:"trauma"},{name:"mdc"},{name:"dalSdo",mapping:"dal"},{name:"alSdo",mapping:"al"},{name:"motChiusuraSdo",mapping:"motChiusura"}],proxy:{api:{read:"/ws/genOsp/fr/pratiche/search",create:"/ws/genOsp/fr/pratiche/new",update:"/ws/genOsp/fr/pratiche/update",destroy:"/ws/genOsp/fr/pratiche/delete"},urlGen:"/ws/genOsp/fr/pratiche/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.FRStatoInvio",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/fr/statoinvio/cbox"}});
Ext.define("GeneraliOSP.portlet.store.FRValutazione",{extend:"Generali.data.StoreJson",fields:[{name:"idValutazioneREG"},{name:"idRicovero"},{name:"idPratica"},{name:"data",type:"date"},{name:"tipoValutazione"},{name:"tipoFlussoVal"},{name:"patologia1"},{name:"patologia2"},{name:"patologia3"},{name:"patologia4"},{name:"patologia5"},{name:"patologia6"},{name:"note"},{name:"patologia1Des"},{name:"patologia2Des"},{name:"patologia3Des"},{name:"patologia4Des"},{name:"patologia5Des"},{name:"patologia6Des"},
{name:"dataKarnofsky",type:"date"},{name:"punteggioKarnofsky"}],proxy:{urlGen:"/ws/genOsp/fr/valutazioni/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.FRValutazione_HSP_RES",{extend:"Generali.data.StoreJson",fields:[{name:"idValutazioneHSP"},{name:"idValutazioneREG"},{name:"ss1"},{name:"ss2"},{name:"mnc1"},{name:"mnc2"},{name:"ssp1"},{name:"ssp2"},{name:"sss1"},{name:"sss2"},{name:"ss1Des"},{name:"ss2Des"},{name:"mnc1Des"},{name:"mnc2Des"},{name:"ssp1Des"},{name:"ssp2Des"},{name:"sss1Des"},{name:"sss2Des"},{name:"prestazione1"},{name:"prestazione2"},{name:"prestazione3"},{name:"prestazione4"},{name:"prestazione5"},
{name:"prestazione6"},{name:"prestazione7"},{name:"prestazione8"},{name:"prestazione9"},{name:"prestazione10"}],proxy:{urlGen:"/ws/genOsp/fr/getFRvalutazione_HSP_RES"},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.ListaPaganti",{lastTotal:0,extend:"Generali.data.StoreCodiceValore",proxy:{url:"/cba/gen/ws/general/anfocl/cbox"},listeners:{beforeload:function(b,c){console.log(this.lastParams);var d=c.getProxy(),f=d.getExtraParams(),g=c.getParams()?c.getParams().valore:"";this.lastParams&&""!=g&&this.lastParams!=g&&(this.lastTotal=0);f.totale=this.lastTotal;d.setExtraParams(f);c.getParams()&&(this.lastParams=c.getParams().valore)},load:function(b,c,d,f,g){b=Ext.decode(f.getResponse().responseText);
0<b.total&&(this.lastTotal=b.total)}}});
Ext.define("GeneraliOSP.portlet.store.Paganti",{extend:"Ext.data.Store",fields:[{name:"idClassificazione"},{name:"id"},{name:"codiceClassificazione"},{name:"pensione"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"tipoQuota"},{name:"codfocl"},{name:"quotaSanitariaPresenza"},{name:"quotaSocialePresenza"},{name:"quotaSanitariaAssenza"},{name:"quotaSocialeAssenza"},{name:"ClientiFornitori"},{name:"ragioneSociale"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},
urlGen:"/ws/genOsp/rette/paganti/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.Pensioni",{extend:"Ext.data.Store",fields:[{name:"idPensione"},{name:"dataRilascio",type:"date"},{name:"dataFine",type:"date"},{name:"idRicovero"},{name:"tipoPensione"},{name:"numeroPensione"},{name:"delegatoIncasso"},{name:"note"},{name:"tipoQuota"},{name:"quota"},{name:"desPensione"},{name:"pagante"},{name:"idCassa"}],proxy:{type:"ajax",api:{read:"/cba/osp/co/ws/AnagraficaOspiti/pensioni/search",create:"/cba/osp/co/ws/AnagraficaOspiti/pensioni/new",update:"/cba/osp/co/ws/AnagraficaOspiti/pensioni/update",
destroy:"/cba/osp/co/ws/AnagraficaOspiti/pensioni/delete"},extraParams:{idRicovero:"",data:new Date},url:"/cba/osp/co/ws/AnagraficaOspiti/pensioni/search",reader:{type:"json",idProperty:"idPensione",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.RAPVmd",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idRicovero"},{name:"data",type:"date"},{name:"dataFine",type:"date"},{name:"annoPratica"},{name:"numPratica"},{name:"tipoValutazione"},{name:"presMedico"},{name:"presMedicoQualifica"},{name:"presAssSoc"},{name:"presPsicologo"},{name:"presEducatore"},{name:"presTerapisti"},{name:"presInfermiere"},{name:"presRapprComune"},{name:"presMMG"},{name:"skCbiId"},{name:"skCbiMan"},{name:"skBarthelId"},
{name:"skBarthelMan"},{name:"skDemenzaTipo"},{name:"skDemenzaId"},{name:"skDemenzaMan"},{name:"esitoVmd"},{name:"erogazioneMisura"},{name:"note"},{name:"dataPi",type:"date"},{name:"notePi"},{name:"idAllegatoPi"},{name:"nomeFilePi"},{name:"idCareManager"},{name:"codStruttura"},{name:"desTipoValutazione"},{name:"desQualificaMedico"},{name:"desEsitoVMD"},{name:"desEsitoMisura"},{name:"certDemenza"}],proxy:{url:"/cba/osp/rap/ws/rsaAperta/vmd/search",api:{read:"/cba/osp/rap/ws/rsaAperta/vmd/search",create:"/cba/osp/rap/ws/rsaAperta/vmd/new",
update:"/cba/osp/rap/ws/rsaAperta/vmd/update",destroy:"/cba/osp/rap/ws/rsaAperta/vmd/delete"}}});
Ext.define("GeneraliOSP.portlet.store.RapBudget",{extend:"Generali.data.StoreJson",fields:[{name:"stanziatoutente"},{name:"stanziatostruttura"},{name:"previstoutente"},{name:"previstostruttura"},{name:"effettivoutente"},{name:"effettivostruttura"},{name:"residuoutente"},{name:"residuostruttura"},{name:"trim1effStrutt"},{name:"trim1prevStrutt"},{name:"trim2effStrutt"},{name:"trim2prevStrutt"},{name:"trim3effStrutt"},{name:"trim3prevStrutt"},{name:"trim4effStrutt"},{name:"trim4prevStrutt"},{name:"trim1resStrutt"},
{name:"trim2resStrutt"},{name:"trim3resStrutt"},{name:"trim4resStrutt"},{name:"trim1effUtente"},{name:"trim1prevUtente"},{name:"trim2effUtente"},{name:"trim2prevUtente"},{name:"trim3effUtente"},{name:"trim3prevUtente"},{name:"trim4effUtente"},{name:"trim4prevUtente"},{name:"trim1resUtente"},{name:"trim2resUtente"},{name:"trim3resUtente"},{name:"trim4resUtente"},{name:"stanziatoutentetrim1"},{name:"stanziatoutentetrim2"},{name:"stanziatoutentetrim3"},{name:"stanziatoutentetrim4"},{name:"totalePrevistoUtente"},
{name:"totalePrevistoStruttura"},{name:"totaleResiduoUtente"},{name:"totaleResiduoStruttura"},{name:"totaleEffettivoUtente"},{name:"totaleEffettivoStruttura"}],proxy:{url:"/cba/osp/rap/ws/rsaAperta/budget/search",api:{read:"/cba/osp/rap/ws/rsaAperta/budget/search"}}});
Ext.define("GeneraliOSP.portlet.store.RapPai",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idRicovero"},{name:"idValutazione"},{name:"dal",type:"date"},{name:"scadenza",type:"date"},{name:"al",type:"date"},{name:"motivoChiusura"}],proxy:{url:"/cba/osp/rap/ws/rsaAperta/paiTe/search",api:{read:"/cba/osp/rap/ws/rsaAperta/paiTe/search",create:"/cba/osp/rap/ws/rsaAperta/paiTe/new",update:"/cba/osp/rap/ws/rsaAperta/paiTe/update",destroy:"/cba/osp/rap/ws/rsaAperta/paiTe/delete"}}});
Ext.define("GeneraliOSP.portlet.store.RapPaiDE",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idPai"},{name:"codFigProf"},{name:"idPrestazione"},{name:"qtaPrevista"},{name:"qtaMese1"},{name:"qtaMese2"},{name:"qtaMese3"},{name:"qtaMese4"},{name:"importoSSN"},{name:"importoCompartecipato"},{name:"desFigProf"},{name:"desPrestazione"},{name:"desSoglia"},{name:"idMese1"},{name:"idMese2"},{name:"idMese3"},{name:"idMese4"},{name:"qtaRilevataMese1"},{name:"qtaRilevataMese2"},{name:"qtaRilevataMese3"},
{name:"qtaRilevataMese4"},{name:"luogo"},{name:"totale"},{name:"prestValidaDal",type:"date"},{name:"prestValidaAl",type:"date"}],proxy:{url:"/cba/osp/rap/ws/rsaAperta/paiDe/search",api:{read:"/cba/osp/rap/ws/rsaAperta/paiDe/search",create:"/cba/osp/rap/ws/rsaAperta/paiDe/new",update:"/cba/osp/rap/ws/rsaAperta/paiDe/update",destroy:"/cba/osp/rap/ws/rsaAperta/paiDe/delete"}}});
Ext.define("GeneraliOSP.portlet.store.RapRequisiti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idRicovero"},{name:"annoPratica"},{name:"numPratica"},{name:"requisitiData",type:"date"},{name:"requisitiEsito"},{name:"convivenza"},{name:"altriServSociali"},{name:"indAccompagnamento"},{name:"livelloInvalidita"},{name:"certDemenza"},{name:"certDemenzaData",type:"date"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"codStruttura"},{name:"descrLivInvalidita"},{name:"descrConvivenza"}],
proxy:{url:"/cba/osp/rap/ws/rsaAperta/requisiti/search",api:{read:"/cba/osp/rap/ws/rsaAperta/requisiti/search",create:"/cba/osp/rap/ws/rsaAperta/requisiti/new",update:"/cba/osp/rap/ws/rsaAperta/requisiti/update",destroy:"/cba/osp/rap/ws/rsaAperta/requisiti/delete"}}});
Ext.define("GeneraliOSP.portlet.store.Referenti",{extend:"Ext.data.Store",fields:[{name:"codOspite"},{name:"id"},{name:"gradoParentela"},{name:"desGradoParentela"},{name:"nomePersona"},{name:"note"},{name:"telefono1"},{name:"telefono2"},{name:"telefono3"},{name:"fax"},{name:"delegaDenaro"},{name:"garante"},{name:"indirizzo"},{name:"rating"},{name:"email"},{name:"dataNascita",type:"date"},{name:"codiceFiscale"},{name:"comuneNascita"},{name:"desComuneNascita"},{name:"nazioneNascita"}],proxy:{type:"ajax",
urlGen:"/ws/genOsp/prsrif/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:".",create:".",update:".",destroy:"."}},sorters:[{property:"nomePersona",transform:function(b){return null==b?b:b.toLowerCase()}}],autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.Residenziale",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idRicovero"},{name:"idSede"},{name:"idReparto"},{name:"idStanza"},{name:"idLetto"},{name:"note"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"desSede"},{name:"codiceSede"},{name:"desStanza"},{name:"desLetto"},{name:"desReparto"},{name:"codiceReparto"},{name:"numeroStanza"},{name:"numeroLetto"},{name:"tipoRecord"},{name:"stato"},{name:"idRiferimento"},{name:"idOpDomanda"},
{name:"dataOraDomanda",type:"date"},{name:"idOpRisposta"},{name:"dataOraRisposta",type:"date"},{name:"idServizioDomanda"},{name:"tipoMov"},{name:"desStato"},{name:"usoSingolo"},{name:"desAccompagnatore"}],proxy:{urlGen:"/ws/genOsp/residenza/search",api:{read:".",create:".",update:".",destroy:"."}}});
Ext.define("GeneraliOSP.portlet.store.RettePrestazioni",{extend:"Ext.data.Store",uses:["GeneraliOSP.portlet.store.ExtraImporti"],idProperty:"idRicovero",fields:[{name:"idRicovero"},{name:"classRetta"},{name:"classRegionale"},{name:"classInterna"},{name:"quotaSanitPers"},{name:"quotaSocialePers"},{name:"quotaSanitDefault"},{name:"quotaSocialeDefault"},{name:"quotaSanitFatt"},{name:"quotaSocialeFatt"},{name:"totaleRettaPresenza"},{name:"isQuotaRettaPercentuale"},{name:"idClassRetta"},{name:"codiceClassRetta"},
{name:"extra"},{name:"statoClassRetta"},{name:"statoClassRegionale"},{name:"statoClassInterna"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},extraParams:{idRicovero:""},urlGen:"/ws/genOsp/rette/riep",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},hasMany:{associationKey:"extra",primaryKey:"idRicovero",model:"GeneraliOSP.portlet.store.ExtraImporti"},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.ScontiSuppFattMoltiplicazione",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/fattmolt/get",reader:{type:"json",idProperty:"",implicitIncludes:!1,rootProperty:"",record:""}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.ScontiSuppPaganti",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idExtraRetta"},{name:"tipoQuota"},{name:"codfocl"},{name:"quotaSanitaria"},{name:"quotaSociale"},{name:"ragioneSociale"},{name:"numFattContabilizzate"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/rette/extpgn/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.TipiDoc",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/docs/tipidoc"},autoDestroy:!0});Ext.define("GeneraliOSP.portlet.store.TipiParentela",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/gradoparent/search",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.portlet.store.TipoQuotaAmbulatoriale",{extend:"Generali.store.EuroPerc",data:[["P",decodeTipoQuota("P")],["T",traduci("TICKET")]]});
Ext.define("GeneraliOSP.portlet.view.Assenze",{extend:"Generali.standard.ControlledContainer",border:0,layout:{type:"border"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",region:"east",border:!1,items:[{xtype:"container",defaults:{margin:"0 5 0 0"},margin:"0 5 0 0",layout:{type:"hbox"},items:[]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",margin:"0 10 0 10"}]},{xtype:"panel",region:"west",width:170,layout:{type:"fit"},title:traduci("ASS_ELENCO"),itemId:"Container",
reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridAssenze",reference:"StoricoGridAssenze",store:Ext.create("GeneraliOSP.portlet.store.Assenze"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"dataDal",text:"DATA_INIZIO",flex:1,format:"d/m/Y"},{xtype:"datecolumn",dataIndex:"dataAl",text:"DATA_FINE",flex:1,format:"d/m/Y"}],selModel:Ext.create("Ext.selection.RowModel",{})}]},{xtype:"form",bodyPadding:5,region:"center",border:0,itemId:"EditAssenzeForm",reference:"EditAssenzeForm",
layout:{type:"vbox"},title:"",trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"hbox"},margin:"0 0 5 0",flex:1,items:[{xtype:"datefield",itemId:"editAssenzaDataDal",reference:"editAssenzaDataDal",width:210,margin:"0 10 0 0",fieldLabel:"DATA_INIZIO",labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:!1},{xtype:"timefield",validator:function(b){return!0},itemId:"editAssenzaOraInizio",reference:"editAssenzaOraInizio",width:160,margin:"0 10 0 0",fieldLabel:"ORA_INIZIO",name:"oraInizio",labelClsExtra:"cbaLabel",
format:"H:i",increment:30},{xtype:"image",height:16,itemId:"ImgOraInizio",reference:"ImgOraInizio",width:16}]},{xtype:"container",layout:{type:"hbox"},margin:"0 0 5 0",flex:1,items:[{xtype:"datefield",itemId:"editAssenzaDataAl",reference:"editAssenzaDataAl",width:210,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",name:"dataAl",margin:"0 10 0 0"},{xtype:"timefield",validator:function(b){return!0},itemId:"editAssenzaOraFine",reference:"editAssenzaOraFine",width:160,margin:"0 10 0 0",fieldLabel:"ORA_FINE",
name:"oraFine",labelClsExtra:"cbaLabel",format:"H:i",increment:30},{xtype:"image",height:16,itemId:"ImgOraFine",reference:"ImgOraFine",width:16}]},{xtype:"container",layout:{type:"hbox"},margin:"0 0 5 0",flex:1,items:[{xtype:"combobox",itemId:"editAssenzaMotivo",reference:"editAssenzaMotivo",width:380,margin:"0 10 0 0",fieldLabel:"MOTIVI_USCITA_TEMP",labelClsExtra:"cbaLabel",name:"motivoUscita",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.MotivoAssenzaRegole"),
valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"displayfield",itemId:"giorniAssenza",reference:"giorniAssenza",width:160,fieldLabel:"GG_ASSENZA",labelClsExtra:"cbaLabel",name:"giorniAssenza",labelAlign:"right"}]},{xtype:"container",itemId:"cntOspedale",reference:"cntOspedale",layout:{type:"hbox"},margin:"5 0 0 0",flex:1,hidden:!0,items:[{xtype:"combobox",itemId:"cbOspedale",reference:"cbOspedale",width:380,fieldLabel:"OSPEDALE",queryMode:"local",queryParam:"valore",
labelClsExtra:"cbaLabel",name:"codiceOspedale",displayField:"valore",valueField:"codice"},{xtype:"checkboxfield",itemId:"cbConAssistenza",reference:"cbConAssistenza",margin:"0 0 0 15",fieldLabel:"CON_ASSISTENZA",labelClsExtra:"cbaLabel",name:"conAssistenza",boxLabel:"",inputValue:"T",hidden:!0}]},{xtype:"htmleditor",itemId:"notes",reference:"notes",flex:4,align:"stretch",labelAlign:"top",fieldLabel:"NOTE",labelClsExtra:"cbaLabel",name:"notes",labelClsExtra:"cbaLabel"},{xtype:"textfield",hidden:!0,
fieldLabel:"id",name:"id"},{xtype:"textfield",hidden:!0,fieldLabel:"id Assenza Colleagata",itemId:"EditAssenzeIdAssenzaCs",reference:"EditAssenzeIdAssenzaCs",name:"idAssenzaCs"},{xtype:"textfield",hidden:!0,itemId:"EditAssenzeRecordId",reference:"EditAssenzeRecordId",fieldLabel:"id",name:"idAssenza"}]},{xtype:"panel",region:"south",height:350,itemId:"EditAssenzeCal",reference:"EditAssenzeCal",layout:{align:"stretch",type:"vbox"},title:traduci("ASS_CALENDARIO_PRESENZE"),hidden:64==CBA.moduli.moduloAttivo,
items:[{xtype:"panel",border:0,height:40,itemId:"pnlTestataCal",reference:"pnlTestataCal",layout:{type:"hbox"},title:"",items:[{xtype:"numberfield",itemId:"EditAssenzeAnno",reference:"EditAssenzeAnno",margin:"6 10 0 10",useThousandSeparator:!1,width:120,fieldLabel:"ANNO",labelClsExtra:"cbaLabel",labelWidth:50,editable:!1,allowDecimals:!1}]},{xtype:"gridpanel",flex:1,border:0,itemId:"EditAssenzeCalendario",reference:"EditAssenzeCalendario",title:"",store:Ext.create("GeneraliOSP.portlet.store.CalendarioAssenze"),
columnLines:!0,columns:[{xtype:"gridcolumn",width:70,dataIndex:"mese",text:"MESE"},{xtype:"gridcolumn",draggable:!1,minWidth:25,align:"center",dataIndex:"gg1",text:"1",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg2",text:"2",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg3",text:"3",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg4",text:"4",flex:1,renderer:this.rendererCol},
{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg5",text:"5",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg6",text:"6",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg7",text:"7",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg8",text:"8",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg9",text:"9",flex:1,
renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg10",text:"10",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg11",text:"11",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg12",text:"12",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg13",text:"13",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",
dataIndex:"gg14",text:"14",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg15",text:"15",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg16",text:"16",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg17",text:"17",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg18",text:"18",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",
minWidth:25,align:"center",dataIndex:"gg19",text:"19",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg20",text:"20",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg21",text:"21",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg22",text:"22",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg23",text:"23",flex:1,renderer:this.rendererCol},
{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg24",text:"24",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg25",text:"25",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg26",text:"26",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg27",text:"27",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg28",text:"28",
flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg29",text:"29",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg30",text:"30",flex:1,renderer:this.rendererCol},{xtype:"gridcolumn",minWidth:25,align:"center",dataIndex:"gg31",text:"31",flex:1,renderer:this.rendererCol}],viewConfig:{loadMask:!1}}]}]});this.callParent(arguments)},rendererCol:function(b,c,d,f,g,h){"P"==b?c.style="background-color:#CCFFCC !important":
"A"==b?c.style="background-color:#FF9999 !important":"X"==b?c.style="background-color:silver !important":"D"==b?c.style="background-color:#f2f2f2 !important":"N"==b&&(c.style="background-color:none !important")}});
Ext.define("GeneraliOSP.portlet.view.Consenso",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=new Date;Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},padding:0,flex:1,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,margin:"0 0 0 0",items:[{xtype:"container",margin:"5 5 5 5",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:3,items:[{xtype:"CBAGridAnnullabile",title:"TERAPIE_SOSPENSIONI",
header:!1,width:250,padding:"0 0 10 0",itemId:"Grid",reference:"Grid",store:Ext.create("GeneraliOSP.portlet.store.Consenso"),emptyText:traduci("NESSUN_DATO_PRESENTE"),flex:1,columns:[{xtype:"gridcolumn",hidden:!0,dataIndex:"id"},{xtype:"gridcolumn",hidden:!0,dataIndex:"numAllegati"},{xtype:"datecolumn",text:"DAL",format:"d/m/Y H:i",dataIndex:"dal",reference:"dal",flex:1},{xtype:"datecolumn",text:"AL",dataIndex:"al",reference:"al",format:"d/m/Y H:i",flex:1},{xtype:"gridcolumn",text:"CONSENSO",dataIndex:"consenso",
flex:1,renderer:function(b,d,f){return"T"==b?"SI":"NO"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",hidden:!0,items:[{xtype:"button",itemId:"BtnEliminaFake",reference:"BtnEliminaFake"}]}]}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:2,items:[{xtype:"container",layout:{type:"hbox",pack:"end"},items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",margin:"0 2 0 0"}]},{xtype:"form",
cls:"cbaCssForm",itemId:"Form",reference:"Form",trackResetOnLoad:!0,layout:{type:"vbox",align:"stretch"},flex:1,padding:"0 0 0 5",items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnAllegati",reference:"BtnAllegati",text:traduci("ALLEGATI"),margin:"10 10 5 0",cls:"cbaCssBtnFunzione",width:100,nonDisabilitare:!0,listeners:{afterrender:function(b){b=b.getEl().query("span");Ext.each(b,function(b){-1!=b.classList.contains("x-btn-inner")&&(b.style.margin=
"0px 10px 0px 0px")})}}}]},{xtype:"numberfield",name:"id",hidden:!0},{xtype:"numberfield",name:"compilatore",hidden:!0},{xtype:"fieldset",layout:{type:"vbox",align:"stretch",pack:"center"},flex:1,padding:8,title:"PERIODO_CONSENSO",items:[{xtype:"container",padding:4,layout:{type:"hbox",align:"stretch"},items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",labelWidth:120,width:280,minValue:b,fieldLabel:"DATA_CONSENSO",format:"d/m/Y",name:"dal",labelClsExtra:"cbaCssLabel",allowBlank:!1},{xtype:"timefield",
margin:"0 0 0 4",width:60,itemId:"OraDal",reference:"OraDal",format:"H:i",name:"_oraDal",labelClsExtra:"cbaCssLabel"}]},{xtype:"container",margin:"4 0 0 0",layout:{type:"hbox",align:"stretch"},modificaTerzi:!0,padding:4,items:[{xtype:"datefield",itemId:"DataAl",reference:"DataAl",fieldLabel:"DATA_REVOCA",labelWidth:120,width:280,format:"d/m/Y",name:"al",labelClsExtra:"cbaCssLabel"},{xtype:"timefield",margin:"0 0 0 4",width:60,itemId:"OraAl",reference:"OraAl",format:"H:i",name:"_oraAl",labelClsExtra:"cbaCssLabel"}]},
{xtype:"radiogroup",itemId:"RadioConsenso",reference:"RadioConsenso",fieldLabel:"CONSENSO_DOSSIER",margin:"10 0 5 4",labelWidth:120,allowblank:!1,labelClsExtra:"cbaCssLabel",items:[{xtype:"radiofield",name:"consenso",boxLabel:"SI",inputValue:"T"},{xtype:"radiofield",name:"consenso",boxLabel:"NO",inputValue:"F"}]},{xtype:"container",margin:"10 0 0 5",items:[{xtype:"label",cls:"cbaCssLabel cbaGrassetto",itemId:"LabelUpdateCompilatore",reference:"LabelUpdateCompilatore"}]}]}],dockedItems:[{xtype:"cssPanelCompilatore",
disableRetrodatazione:!0,itemId:"PnlCompilatore",reference:"PnlCompilatore",docked:"top",cbaDataAllowBlank:!0,cbaOraAllowBlank:!0}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.Contatti",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"EditCRM",reference:"EditCRM",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",region:"center",border:0,itemId:"EditCRMForm",reference:"EditCRMForm",layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"combobox",itemId:"EditCRMTipoContatto",reference:"EditCRMTipoContatto",width:350,fieldLabel:"CRM_TIPO_CONTATTO",
labelClsExtra:"cbaLabel",name:"tipoContatto",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.CRM_TipoContatto"),valueField:"codice"},{xtype:"combobox",itemId:"EditCRMIdContatto",reference:"EditCRMIdContatto",width:350,fieldLabel:"CRM_NOMINATIVO",labelClsExtra:"cbaLabel",name:"idContatto",displayField:"valore",minChars:3,queryMode:"local",queryParam:"valore",hidden:!0,store:Ext.create("GeneraliOSP.portlet.store.CRM_Nominativi",{sorters:[{property:"valore",
transform:function(b){return null==b?b:b.toLowerCase()}}]}),valueField:"codice"},{xtype:"textfield",itemId:"EditCRMNominativo",reference:"EditCRMNominativo",width:450,fieldLabel:"CRM_NOMINATIVO",labelClsExtra:"cbaLabel",name:"nominativo",maxLength:255,enforceMaxLength:!0},{xtype:"combobox",itemId:"EditCRMMotivo",reference:"EditCRMMotivo",width:350,fieldLabel:"MODALITA_CONTATTO",labelClsExtra:"cbaLabel",name:"motivo",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.CRM_Modalita"),
valueField:"codice"},{xtype:"combobox",itemId:"EditCRMStato",reference:"EditCRMStato",width:160,fieldLabel:"CRM_STATO",labelClsExtra:"cbaLabel",name:"stato",editable:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"datefield",itemId:"EditCRMData",reference:"EditCRMData",width:210,fieldLabel:"DATA",labelClsExtra:"cbaLabel",name:"data",allowBlank:!1},{xtype:"timefield",validator:function(b){return!0},itemId:"EditCRMOra",reference:"EditCRMOra",name:"CRMOra",
width:160,fieldLabel:"ORA",labelClsExtra:"cbaLabel",value:"08:00",allowBlank:!1,format:"H:i",increment:30},{xtype:"textfield",itemId:"EditCRMOggetto",reference:"EditCRMOggetto",width:400,fieldLabel:"CRM_OGGETTO",labelClsExtra:"cbaLabel",name:"oggetto",maxLength:255,enforceMaxLength:!0},{xtype:"htmleditor",flex:1,itemId:"EditCRMNote",reference:"EditCRMNote",fieldLabel:"NOTE",labelAlign:"top",labelClsExtra:"cbaLabel",name:"note",width:500},{xtype:"textfield",itemId:"RecordId",reference:"RecordId",fieldLabel:"id",
name:"id",hidden:!0}]},{xtype:"panel",region:"west",width:250,layout:{type:"fit"},title:"CRM_ELENCO",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridCRM",reference:"StoricoGridCRM",title:"",store:Ext.create("GeneraliOSP.portlet.store.CRM"),columns:[{xtype:"datecolumn",width:100,dataIndex:"data",text:"data",format:"d/m/Y H:i"},{xtype:"gridcolumn",dataIndex:"nominativo",text:traduci("CRM_NOMINATIVO"),flex:1}],selModel:Ext.create("Ext.selection.RowModel",{}),viewConfig:{loadMask:!1}}]},{xtype:"panel",
region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.Documenti",{extend:"Generali.standard.ControlledContainer",itemId:"cntEditDocumenti",reference:"cntEditDocumenti",initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"EditDocumenti",reference:"EditDocumenti",layout:{type:"border"},title:"",items:[{xtype:"form",autoScroll:b?!1:!0,flex:1,region:"center",border:0,itemId:"EditDocumentiForm",reference:"EditDocumentiForm",layout:{type:"vbox"},cls:b?"css-form-label-blue":
null,margin:b?"20 0 0 0":null,bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"combobox",itemId:"docTipoDoc",reference:"docTipoDoc",width:400,fieldLabel:"TIPO_DOCUMENTO",labelClsExtra:"cbaLabel",name:"tipoDocumento",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.TipiDoc"),valueField:"codice"},{xtype:"textfield",itemId:"descrizioneBreve",reference:"descrizioneBreve",width:400,fieldLabel:"DES_BREVE",labelClsExtra:"cbaLabel",
name:"descrizioneBreve",maxLength:100,enforceMaxLength:!0,allowBlank:!0},{xtype:"combobox",itemId:"docTicket",reference:"docTicket",width:400,fieldLabel:"DOC_TICKET",labelClsExtra:"cbaLabel",name:"idRisposta",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.CBEsenzioniTicket"),valueField:"codice"},{xtype:"container",height:330,itemId:"pnlAltriDoc",reference:"pnlAltriDoc",margin:"5 0 5 0",layout:{type:"vbox"},items:[{xtype:"container",margin:"0 0 5 0",
layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"docDataEmissione",reference:"docDataEmissione",width:210,fieldLabel:"DOC_DATA_DAL",labelClsExtra:"cbaLabel",name:"dataEmissione"},{xtype:"combobox",margin:"0 0 0 10",itemId:"priImp",reference:"priImp",fieldLabel:"PRIORITA",name:"priorita",labelClsExtra:"cbaLabel",width:285,labelWidth:50,matchFieldWidth:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/docs/priImp"},
autoDestroy:!0})}]},{xtype:"datefield",itemId:"docDataScadenza",reference:"docDataScadenza",width:210,fieldLabel:"DOC_DATA_AL",labelClsExtra:"cbaLabel",name:"dataScadenza"},{xtype:"textfield",itemId:"docNomeIstituzione",reference:"docNomeIstituzione",width:b?400:505,fieldLabel:"DOC_ENTE_RILASCIANTE",labelClsExtra:"cbaLabel",name:"nomeIdIstituzione",maxLength:100,enforceMaxLength:!0},{xtype:"textfield",itemId:"docNumero",reference:"docNumero",width:b?210:505,fieldLabel:"DOC_NUMERO",labelClsExtra:"cbaLabel",
name:"numero",maxLength:20,enforceMaxLength:!0},{xtype:"combobox",fieldLabel:"TIPO_IMPEGNATIVA",itemId:"tipoImpegnativa",reference:"tipoImpegnativa",labelClsExtra:"cbaLabel",width:505,name:"tipoImp",matchFieldWidth:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/risposte/cbox"},autoDestroy:!0})},{xtype:"combobox",fieldLabel:"TIPO_RICETTA",itemId:"tipoRicetta",reference:"tipoRicetta",width:505,labelClsExtra:"cbaLabel",
name:"tipoRicetta",matchFieldWidth:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/risposte/cbox"},autoDestroy:!0})},{xtype:"textfield",itemId:"quesito",reference:"quesito",width:505,fieldLabel:"QUESITO_DIAGNOSTICO",labelClsExtra:"cbaLabel",name:"note"},{xtype:"combobox",fieldLabel:"MEDICO_RICHIEDENTE",itemId:"medicoRic",reference:"medicoRic",width:505,labelClsExtra:"cbaLabel",name:"idMedico",matchFieldWidth:!1,
displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.medicoCurante.store.Medici"),valueField:"codice"},{xtype:"container",margin:"0 0 10 0",layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"codEse",reference:"codEse",width:220,fieldLabel:"CODICE_ESENZIONE",labelClsExtra:"cbaLabel",name:"codEsenzione",maxLength:20,enforceMaxLength:!0},{xtype:"combobox",margin:"4 0 0 0",itemId:"cmbCodEse",reference:"cmbCodEse",width:30,labelClsExtra:"cbaLabel",matchFieldWidth:!1,displayField:"valore",
queryMode:"local",valueField:"codice",autoEl:{tag:"div","data-qtip":traduci("MSG_COPIA_CODESENZIONE")}},{xtype:"combobox",margin:"0 0 0 5",itemId:"docTicketImp",reference:"docTicketImp",width:250,labelWidth:70,fieldLabel:"DOC_TICKET",labelClsExtra:"cbaLabel",name:"idRispostaEseImp",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.CBEsenzioniTicket"),valueField:"codice"},{xtype:"textfield",itemId:"IdEsenzioneTicket",reference:"IdEsenzioneTicket",
hidden:!0,name:"idEsenzioneTicket"}]},{xtype:"container",height:110,itemId:"pnlTEAM",reference:"pnlTEAM",margin:"5 0 5 0",width:b?500:540,layout:{type:"vbox"},items:[{xtype:"container",margin:"0 0 5 0",width:b?500:540,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"docDataScadenzaTEAM",reference:"docDataScadenzaTEAM",width:110,fieldLabel:"DOC_DATA_AL",labelAlign:"top",labelClsExtra:"cbaLabel",name:"dataScadenzaTEAM"},{xtype:"textfield",itemId:"docNomeIstituzioneTEAM",
reference:"docNomeIstituzioneTEAM",width:b?250:290,fieldLabel:"DOC_NOME_ISTITUZIONE_TEAM",labelAlign:"top",labelClsExtra:"cbaLabel",name:"nomeIdIstituzioneTEAM"},{xtype:"textfield",itemId:"docNumeroIdIstituzioneTEAM",reference:"docNumeroIdIstituzioneTEAM",width:130,fieldLabel:"DOC_NUMERO_ISTITUZIONE",labelAlign:"top",labelClsExtra:"cbaLabel",name:"numIdIstituzioneTEAM"}]},{xtype:"container",width:b?500:540,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"combobox",
itemId:"docTEAM",reference:"docTEAM",width:50,fieldLabel:"DOC_COD_NAZIONE",labelAlign:"top",labelClsExtra:"cbaLabel",name:"nazioneTEAM",matchFieldWidth:!1,displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.portlet.store.CodiciTeam"),valueField:"codice"},{xtype:"textfield",itemId:"docNumeroTEAM",reference:"docNumeroTEAM",width:b?210:230,fieldLabel:"DOC_NUMERO_TEAM",labelAlign:"top",labelClsExtra:"cbaLabel",name:"numeroTEAM"},{xtype:"textfield",itemId:"docNumTesseraTEAM",reference:"docNumTesseraTEAM",
width:b?230:250,fieldLabel:"DOC_TESSERA",labelAlign:"top",labelClsExtra:"cbaLabel",name:"numeroTesseraTEAM"}]}]},{xtype:"container",width:b?500:540,layout:{type:"hbox"},items:[{xtype:"label",cls:b?"cbaCssLabel":"cbaLabel",itemId:"docLabelAllegato",reference:"docLabelAllegato",width:105,text:"DOC_ALLEGATO"},{xtype:"image",cls:"cbaLabelLink",height:32,itemId:"linkDocAllegato",reference:"linkDocAllegato",margin:"0 5 0 0",width:32,nonDisabilitare:!0},{xtype:"filefield",formBind:!1,itemId:"docAllega",
reference:"docAllega",fieldLabel:"",hideLabel:!0,readOnly:!1,name:"f_allegato",buttonConfig:{cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",iconCls:"icon-allegato",width:120,height:25},buttonOnly:!0,buttonText:traduci("DOC_ALLEGA_FILE")},{xtype:"button",itemId:"docEliminaAllegato",reference:"docEliminaAllegato",width:b?130:120,cls:b?"cbaCssBtnFunzione":"cba-stdbutton-25",iconCls:"icon-elimina",text:"DOC_ELIMINA_ALLEGATO"}]}]},{xtype:"label",cls:"cbaLabelLink",itemId:"docLbAllegato",reference:"docLbAllegato",
overCls:"cbaLabelLinkOver",text:"nome file"},{xtype:"textfield",itemId:"recordId",reference:"recordId",fieldLabel:"id",hidden:!0,name:"id"},{xtype:"textfield",itemId:"docNomeFile",reference:"docNomeFile",fieldLabel:"nomeFile",hidden:!0,name:"nomeFile"},{xtype:"textfield",itemId:"docIdAllegato",reference:"docIdAllegato",fieldLabel:"idAllegato",hidden:!0,name:"idAllegato"}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:b?"auto":120,margin:b?"2 2 0 0":null,title:""},
{xtype:"panel",region:"west",width:210,layout:{type:"fit"},title:"DOC_ELENCO",itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridDoc",reference:"StoricoGridDoc",store:Ext.create("GeneraliOSP.portlet.store.Documenti"),viewConfig:{getRowClass:function(b,d,f,g){if(b.data.dataScadenza&&b.data.dataScadenza<new Date)return"non_attivi"},itemId:"GW_portletEditDocumenti",reference:"GW_portletEditDocumenti",loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"desTipoDocumento",
text:"DOC_TIPO_DOCUMENTO",flex:1},{xtype:"datecolumn",width:80,dataIndex:"dataScadenza",text:"DOC_DATA_AL",format:"d/m/Y"}],selModel:Ext.create("Ext.selection.RowModel",{})}]}],listeners:{afterrender:function(c){b&&c.body.setStyle("background-color","transparent")}}}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtClassIntReg",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntForm",reference:"CntForm",layout:{type:"hbox",align:"stretch"},items:[{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"container",margin:"0 0 5 0",width:500,defaults:{margin:{top:0,right:5,bottom:0,left:0}},
layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",width:210,fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:!1},{xtype:"datefield",readOnly:!0,itemId:"DataAl",reference:"DataAl",width:190,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",labelWidth:80,name:"dataAl"}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"CbClassificazione",reference:"CbClassificazione",width:410,fieldLabel:"CLASSIFICAZIONE",labelClsExtra:"cbaLabel",
name:"codiceClassificazione",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Classificazioni"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",itemId:"CbClasse",reference:"CbClasse",width:100,labelWidth:50,fieldLabel:"CLASSE",labelClsExtra:"cbaLabel",name:"classeSosia",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.portlet.store.Classe"),valueField:"codice",
margin:"0 0 0 10"}]},{xtype:"fieldset",itemId:"FSSosia",reference:"FSSosia",title:"REND_LOMB",margin:"20 0 0 0",padding:10,hidden:!0,items:[{xtype:"displayfield",fieldLabel:"ASSOCIATAA",labelClsExtra:"cbaLabelDati",name:"associataA"},{xtype:"displayfield",fieldLabel:"FR_SSR",labelClsExtra:"cbaLabelDati",name:"importoSSR",renderer:function(b,c,d){return b?formatFloat(b):""}},{xtype:"numberfield",fieldLabel:"FR_TARIFFA_SUPP_GG_ASL",labelClsExtra:"cbaLabel",name:"importoSupplementare",decimalPrecision:2},
{xtype:"combobox",fieldLabel:"FR_CASI_PARTICOLARI",labelClsExtra:"cbaLabel",name:"utNonStd",displayField:"valore",valueField:"codice",queryMode:"local",store:Ext.create("Ext.data.ArrayStore",{fields:["codice","valore","disabled"],data:[["O",traduci("FR_EX_OP"),!1],["A",traduci("FR_AIDS"),!1],["M",traduci("FR_SMC"),!1],["L",traduci("FR_SLA"),!1],["S",traduci("FR_SV"),!0]]}),listeners:{beforeselect:function(b,c){return!c.get("disabled")}},tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<tpl if="disabled">',
'<div class="x-boundlist-item" style="font-style: italic !important; color: #707070 !important; opacity:0.6">{valore}</div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")}]},{xtype:"container",itemId:"cntImp",reference:"cntImp",trackResetOnLoad:!0,flex:1,margin:"5 0 0 0",layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"impegnativa",reference:"impegnativa",trackResetOnLoad:!0,width:400,labelClsExtra:"cbaLabel",name:"impegnativa",fieldLabel:"IMPEGNATIVA",labelWidth:100,
width:410,displayField:"valore",queryMode:"local",valueField:"valore",queryParam:"valore",hidden:!0},{xtype:"button",itemId:"BtnCreaImpegnativa",reference:"BtnCreaImpegnativa",scale:"small",width:25,iconCls:"icon-piu",tooltip:"INSERISCI_IMPEGNATIVA",margin:"0 0 0 5",hidden:!0},{xtype:"button",cls:"btnLarge",margin:"0 0 0 5",itemId:"infoImpegnativa",reference:"infoImpegnativa",iconCls:"icon-info",scale:"medium",tooltip:"TOOLTIP_INSERISCI_IMPEGNATIVA",hidden:!0}]},{xtype:"htmleditor",height:180,itemId:"NoteClassificazione",
reference:"NoteClassificazione",fieldLabel:"NOTE",labelAlign:"top",labelClsExtra:"cbaLabel",name:"noteClassificazione"},{xtype:"textfield",name:"id",hidden:!0},{xtype:"textfield",name:"id_reg",hidden:!0},{xtype:"textfield",name:"idClassificazione",hidden:!0},{xtype:"textfield",itemId:"TipoClassificazione",reference:"TipoClassificazione",name:"tipoClassificazione",hidden:!0},{xtype:"textfield",name:"regione",hidden:!0},{xtype:"textfield",name:"gruppo",hidden:!0}]},{xtype:"container",itemId:"BoxBottoni",
reference:"BoxBottoni",width:120}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtClassRetta_Amb",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",width:700,height:205,itemId:"CntForm",reference:"CntForm",layout:{type:"hbox"},title:"",items:[{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:6,trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"hbox",
align:"stretch"},title:"",items:[{xtype:"datefield",itemId:"EditClassificazioniDataDal",reference:"EditClassificazioniDataDal",width:180,fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",labelWidth:75,name:"dataDecorrenza",allowBlank:!1},{xtype:"combobox",itemId:"CbStatoInvio",reference:"CbStatoInvio",allowBlank:!1,width:285,margin:"0 0 0 55",labelWidth:75,fieldLabel:traduci("FR_STATO_INVIO_IMPEGNATIVA"),labelClsExtra:"cbaLabel",name:"statoInvio",readOnly:!0,displayField:"valore",queryMode:"local",
queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.FRStatoInvio"),valueField:"codice"}]},{xtype:"container",itemId:"cntImp",reference:"cntImp",margin:"10 0 0 0",trackResetOnLoad:!0,flex:1,layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"Impegnativa",reference:"Impegnativa",trackResetOnLoad:!0,labelClsExtra:"cbaLabel",name:"idImpegnativa",allowBlank:!0,fieldLabel:"IMPEGNATIVA",labelWidth:75,width:520,displayField:"valore",queryMode:"local",valueField:"codice",queryParam:"valore",
store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/docsImp/get"}})},{xtype:"button",itemId:"BtnCreaImpegnativa",reference:"BtnCreaImpegnativa",scale:"small",width:25,iconCls:"icon-piu",tooltip:"INSERISCI_IMPEGNATIVA",margin:"2 0 0 5"}]},{xtype:"fieldset",itemId:"pnlTicketEsenzioni",reference:"pnlTicketEsenzioni",margin:"19 0 0 0",title:"TICKET_ESENZIONI",width:550,layout:{type:"vbox",flex:1},items:[{xtype:"container",flex:1,layout:{type:"vbox"},margin:"5 0 10 5",items:[{xtype:"container",
flex:1,layout:{type:"hbox"},items:[{xtype:"combobox",fieldLabel:"POSIZIONE_TICKET",itemId:"CBPosizioneTicket",reference:"CBPosizioneTicket",labelClsExtra:"cbaLabel",name:"posizioneTicket",displayField:"valore",queryMode:"local",valueField:"codice",hidden:!1,width:390,labelWidth:64,store:Ext.create("GeneraliOSP.fascicoloNoApp.store.PosizioneTicket",{autoload:!1})},{xtype:"numberfield",itemId:"QuotaTicket",reference:"QuotaTicket",fieldLabel:"IMPORTO_TICKET",labelClsExtra:"cbaLabel",name:"importoTicket",
fieldStyle:"text-align:right",margin:"0 0 0 10",width:132,labelWidth:65,allowBlank:!0,allowDecimals:!0,readOnly:!0}]},{xtype:"container",flex:1,layout:{type:"hbox"},margin:"10 0 0 0",items:[{xtype:"textfield",itemId:"CodiceEsenzione",reference:"CodiceEsenzione",fieldLabel:"CODICE_ESENZIONE",labelClsExtra:"cbaLabel",name:"codiceEsenzione",readOnly:!0,isFormField:!1,fieldStyle:"text-align:center",width:150,labelWidth:64},{xtype:"combobox",fieldLabel:"TIPO_ESENZIONE",itemId:"CBTipoEsenzione",reference:"CBTipoEsenzione",
labelClsExtra:"cbaLabel",name:"tipoEsenzione",displayField:"valore",queryMode:"local",valueField:"codice",hidden:!1,margin:"0 0 0 10",width:230,labelWidth:64,store:Ext.create("GeneraliOSP.fascicoloNoApp.store.TipoEsenzioneTicket")},{xtype:"numberfield",itemId:"TotalePrestazioni",reference:"TotalePrestazioni",fieldLabel:"TOTALE_PRESTAZIONI",labelClsExtra:"cbaLabel",fieldStyle:"text-align:right",margin:"0 0 0 10",width:132,labelWidth:65,allowBlank:!0,allowDecimals:!0,readOnly:!0,isFormField:!1}]}]}]},
{xtype:"textfield",name:"id",hidden:!0}]},{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120,height:145},{xtype:"button",cls:"cba-button-25",itemId:"BtnCreaAnagrafica",reference:"BtnCreaAnagrafica",iconCls:"icon-pagante16",text:"ANAGRAFICA",tooltip:"CREA_ANAGRAFICA_PAGANTE",margin:"0 0 0 10",hidden:!CBA.moduli.modulo43.abilitato&&!CBA.moduli.modulo50.abilitato},{xtype:"button",cls:"cba-button-25",itemId:"BtnElaboraFattura",reference:"BtnElaboraFattura",
iconCls:"menu-fattura",text:traduci("ELABORA"),tooltip:traduci("ELABORA_FATTURA"),margin:"5 0 0 10",hidden:!CBA.moduli.modulo43.abilitato}]}]},{xtype:"container",itemId:"ContainerPrestazioni",reference:"ContainerPrestazioni",flex:1,layout:{type:"fit"},border:0,margin:"0 0 0 0",hidden:!0,bodyBorder:!1},{xtype:"container",itemId:"ContainerPaganti",reference:"ContainerPaganti",flex:1,layout:{type:"fit"},border:0,hidden:!0,bodyBorder:!1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtClassRetta_Cdi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",width:700,height:175,itemId:"CntForm",reference:"CntForm",layout:{type:"hbox"},title:"",items:[{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",layout:{type:"vbox"},bodyPadding:5,trackResetOnLoad:!0,items:[{xtype:"container",width:500,defaults:{margin:"0 5 3 0"},
layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"EditClassificazioniDataDal",reference:"EditClassificazioniDataDal",width:230,fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",labelWidth:120,name:"dataDecorrenza",allowBlank:!1},{xtype:"datefield",readOnly:!0,width:190,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",labelWidth:80,name:"dataFine"}]},{xtype:"combobox",itemId:"CbProfiloUtente",reference:"CbProfiloUtente",width:450,margin:"0 0 3 0",fieldLabel:"PROFILAZIONI_UTENTE",labelClsExtra:"cbaLabel",
labelWidth:120,name:"idProfilazione",allowBlank:!1,valueField:"codice",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/prszn/profilazioneAnagrafica/cbox"},autoLoad:!1}),listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",itemId:"EditCDIMotivoAss",reference:"EditCDIMotivoAss",width:450,margin:"0 0 0 0",fieldLabel:"CDI_MOT_ASS_PRED",labelClsExtra:"cbaLabel",labelWidth:120,name:"motivoAssenzaDefault",
allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/motass/search"}}),listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"htmleditor",height:80,margin:"0 0 0 0",fieldLabel:"NOTE",labelAlign:"top",labelClsExtra:"cbaLabel",name:"note",width:520},{xtype:"textfield",name:"id",hidden:!0}]},{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",itemId:"BoxBottoni",
reference:"BoxBottoni",width:120,height:145},{xtype:"button",cls:"cba-button-25",itemId:"BtnCreaAnagrafica",reference:"BtnCreaAnagrafica",iconCls:"icon-pagante16",text:"ANAGRAFICA",tooltip:"CREA_ANAGRAFICA_PAGANTE",margin:"0 0 0 10",hidden:!CBA.moduli.modulo43.abilitato&&!CBA.moduli.modulo50.abilitato}]}]},{xtype:"container",itemId:"ContainerPrestazioni",reference:"ContainerPrestazioni",flex:1,layout:{type:"fit"},border:0,margin:"0 0 0 0",hidden:!0,bodyBorder:!1},{xtype:"container",itemId:"ContainerPaganti",
reference:"ContainerPaganti",flex:1,layout:{type:"fit"},border:0,hidden:!0,bodyBorder:!1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtClassRetta_CdiPaganti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"gridpanel",itemId:"Grid",reference:"Grid",store:Ext.create("GeneraliOSP.portlet.store.CDIPaganti"),columns:[{xtype:"gridcolumn",renderer:function(b,d,f,g,h,k,l){return f.data.ragioneSociale},dataIndex:"codfocl",hideable:!1,text:"PAGANTE",flex:1,editor:{xtype:"combobox",itemId:"CbPagante",reference:"CbPagante",store:Ext.create("GeneraliOSP.portlet.store.ListaPaganti"),
queryMode:"remote",displayField:"valore",matchFieldWidth:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='' || extra.indexOf('null')!=-1 || extra.indexOf(',')==0\">",'<div class="x-boundlist-item">{valore}</div>',"<tpl else>","<tpl if=\"extra.indexOf(',')!=-1\">","<tpl if=\"extra.split(',')[1]=='F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore} [CF: {[values.extra.split(\',\')[0]]}]</div>',"<tpl else>","<div class=\"x-boundlist-item\">{valore} [CF: {[values.extra.split(',')[0]]}]</div>",
"</tpl>","<tpl else>",'<div class="x-boundlist-item">{valore} [CF: {extra}]</div>',"</tpl>","</tpl>","</tpl>"),valueField:"codice",queryParam:"valore",pageSize:25,triggerAction:"all",typeAhead:!0,minChars:3,allowBlank:!1,forceSelection:!0,listConfig:{width:500,heigth:200,loadMask:!1}}},{xtype:"datecolumn",width:70,align:"center",dataIndex:"dataDal",text:"DATA_INIZIO",format:"d/m/Y",editor:{xtype:"datefield",allowBlank:!1}},{xtype:"datecolumn",width:70,align:"center",dataIndex:"dataAl",text:"DATA_FINE",
format:"d/m/Y",editor:{xtype:"datefield"}},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){return"M"==b.cbaConfig.tipoServizio&&"T"==f.data.tipoQuota?traduci("TICKET"):decodeTipoQuota(c,!0)},width:75,align:"center",dataIndex:"tipoQuota",hideable:!1,text:"TIPO_QUOTA",editor:{xtype:"combo",itemId:"CbTipoQuota",reference:"CbTipoQuota",allowBlank:!1,store:"M"==b.cbaConfig.tipoServizio?Ext.create("GeneraliOSP.portlet.store.TipoQuotaAmbulatoriale"):Ext.create("Generali.store.EuroPercMese"),displayField:"valore",
valueField:"codice",mode:"local",triggerAction:"all",editable:!1,matchFieldWidth:!1,listeners:{change:function(b,d,f,g){b=b.up("grid").getPlugin().getEditor().getForm();d="P"==d?"100":"";f=b.findField("quotaSanitaria");g=b.findField("quotaSociale");var c=b.findField("quotaSanitariaAssenza");b=b.findField("quotaSocialeAssenza");f.setValue(d);g.setValue(d);c.setValue(d);b.setValue(d)}}}},{xtype:"booleancolumn",itemId:"GridQuotePresenza",reference:"GridQuotePresenza",hideable:!1,text:"M"!=b.cbaConfig.tipoServizio?
"PRESENZA":"",columns:[{xtype:"gridcolumn",itemId:"GridQPresSanitaria",reference:"GridQPresSanitaria",dataIndex:"quotaSanitaria",hideable:!0,text:"M"!=b.cbaConfig.tipoServizio?"Q_SAN":"Q_AMB_SSN",width:60,renderer:function(c,d,f,g,h,k,l){g="";"M"==b.cbaConfig.tipoServizio&&"T"==f.data.tipoQuota&&(g="opacity: 0.1;");d.style=g+"text-align:right !important";return formatFloat(c)},editor:{xtype:"numberfield",allowBlank:!1}},{xtype:"gridcolumn",itemId:"GridQPresSociale",reference:"GridQPresSociale",dataIndex:"quotaSociale",
hideable:!0,text:"M"!=b.cbaConfig.tipoServizio?"Q_SOC":"Q_AMB_PRIVATO",width:60,renderer:function(c,d,f,g,h,k,l){g="";"M"==b.cbaConfig.tipoServizio&&"T"==f.data.tipoQuota&&(g="opacity: 0.1;");d.style=g+"text-align:right !important";return formatFloat(c)},editor:{xtype:"numberfield",allowBlank:!1}}]},{xtype:"booleancolumn",itemId:"GridQuoteAssenza",reference:"GridQuoteAssenza",hideable:!0,text:"ASSENZA",columns:[{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){g="";"M"==b.cbaConfig.tipoServizio&&
"T"==f.data.tipoQuota&&(g="opacity: 0.1;");d.style=g+"text-align:right !important";return formatFloat(c)},width:55,dataIndex:"quotaSanitariaAssenza",text:"Q_SAN",editor:{xtype:"numberfield",allowBlank:!1}},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){g="";"M"==b.cbaConfig.tipoServizio&&"T"==f.data.tipoQuota&&(g="opacity: 0.1;");d.style=g+"text-align:right !important";return formatFloat(c)},width:55,dataIndex:"quotaSocialeAssenza",text:"Q_SOC",editor:{xtype:"numberfield",allowBlank:!1}}]}],
viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",cls:"baseBgColor",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"checkboxfield",itemId:"CBPagantiAtt",reference:"CBPagantiAtt",fieldLabel:"",boxLabel:"VISUALIZZA_SOLO_PAGANTI_ATTIVI",
inputValue:"T",uncheckedValue:"F",checked:"M"!=b.cbaConfig.tipoServizio?!0:!1,listeners:{change:{fn:b.onCBPagantichange,scope:b}}},{xtype:"radiogroup",itemId:"RdgEdtPaganti",reference:"RdgEdtPaganti",hidden:!0,labelWidth:40,fieldLabel:traduci("PAGANTI")+":",items:[{xtype:"radiofield",name:"filtroPaganti",boxLabel:"fascicolo",checked:!0,inputValue:"F"},{xtype:"radiofield",name:"filtroPaganti",boxLabel:"tutti",inputValue:"U"}]},{xtype:"tbfill"},{xtype:"label",html:traduci("CDI_PAGANTI_PREST_SELE"),
cls:"cbaLabel"},{xtype:"tbfill"},{xtype:"button",cls:"btnLarge",iconCls:"icon-info",scale:"small",text:"",tooltip:'<TABLE><TR><TD colspan="2"><B>'+traduci("TIPO_QUOTA").toUpperCase()+"</B></TD></TR><TR><TD><B>"+decodeTipoQuota("P",!0)+"</B></TD><TD>"+traduci("DESC_QUOTA_PERC")+"</TD></TR><TR><TD><B>"+decodeTipoQuota("G",!0)+"</B></TD><TD>"+traduci("DESC_QUOTA_GG")+" </TD></TR><TR><TD><B>"+decodeTipoQuota("M",!0)+"</B></TD><TD>"+traduci("DESC_QUOTA_MESE")+"</TD></TR><TR><TD><B>"+("M"==b.cbaConfig.tipoServizio?
traduci("TICKET"):decodeTipoQuota("T",!0))+"</B></TD><TD>"+("M"==b.cbaConfig.tipoServizio?traduci("DESC_QUOTA_TICKET"):traduci("DESC_QUOTA_MESE_TMAX"))+"</TD></TR></TABLE>",hidden:!1}]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtClassRetta_CdiPrestazioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;b.renderGG=function(b,d,f){"T"==d&&(f.tdCls="icon-selezionato")};Ext.applyIf(b,{items:[{xtype:"gridpanel",itemId:"Grid",reference:"Grid",store:Ext.create("GeneraliOSP.portlet.store.CDIDettaglio"),columns:[{xtype:"gridcolumn",dataIndex:"idRisposta",hideable:!1,text:"PRESTAZIONE",flex:1,renderer:function(b,d,f,g,h,k,l){"T"==f.get("statoRisposta")&&(d.tdStyle=
"font-style: italic !important; color: #707070 !important; text-decoration: line-through;");return f.get("desPrestazione")},editor:{xtype:"combobox",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)},select:function(b,d,f){"T"==d.data.extra&&msgShowWarning("ATTENZIONE","MSG_ELEMENTO_DISATTIVATO")}}}},{xtype:"gridcolumn",itemId:"GridQuotaSanitaria",reference:"GridQuotaSanitaria",text:b.cbaConfig.isAmbulatoriale?
"Q_AMB_SSN":"Q_SAN",dataIndex:"quotaSanitaria",align:"center",width:60,editor:{xtype:"numberfield",itemId:"ColumQuotaSan",reference:"ColumQuotaSan",disabled:!this.cbaConfig.abilitaTariffaRettaPers},renderer:function(b,d,f,g,h,k,l){d.style="text-align:right !important";"T"==f.get("quotaSanPers")&&(d.tdCls="bgOrange");return formatFloat(b)}},{xtype:"gridcolumn",itemId:"GridQuotaSociale",reference:"GridQuotaSociale",text:b.cbaConfig.isAmbulatoriale?"Q_AMB_PRIVATO":"Q_SOC",dataIndex:"quotaSociale",align:"center",
width:60,editor:{xtype:"numberfield",itemId:"ColumQuotaAlb",reference:"ColumQuotaAlb",disabled:!this.cbaConfig.abilitaTariffaRettaPers},renderer:function(b,d,f,g,h,k,l){d.style="text-align:right !important";"T"==f.get("quotaSocPers")&&(d.tdCls="bgOrange");return formatFloat(b)}},{xtype:"numbercolumn",text:"TOTALE",itemId:"ColumTotale",reference:"ColumTotale",dataIndex:"totale",width:60,hidden:b.cbaConfig.isAmbulatoriale,renderer:function(b,d,f,g,h,k,l){d.style="text-align:right !important";if(f.get("quotaSanitaria")||
f.get("quotaSociale"))return formatFloat(f.get("quotaSanitaria")+f.get("quotaSociale"))}},{xtype:"gridcolumn",width:35,align:"center",text:"LUN",dataIndex:"lun",hideable:!1,renderer:function(c,d,f,g,h,k,l){b.renderGG(1,c,d)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",width:35,align:"center",text:"MAR",dataIndex:"mar",hideable:!1,renderer:function(c,d,f,g,h,k,l){b.renderGG(2,c,d)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",
width:35,align:"center",text:"MER",dataIndex:"mer",hideable:!1,renderer:function(c,d,f,g,h,k,l){b.renderGG(3,c,d)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",width:35,align:"center",text:"GIO",dataIndex:"gio",hideable:!1,renderer:function(c,d,f,g,h,k,l){b.renderGG(4,c,d)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",width:35,align:"center",text:"VEN",dataIndex:"ven",hideable:!1,renderer:function(c,d,f,g,h,k,l){b.renderGG(5,
c,d)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",width:35,align:"center",text:"SAB",dataIndex:"sab",hideable:!1,renderer:function(c,d,f,g,h,k,l){b.renderGG(6,c,d)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",width:35,align:"center",text:"DOM",dataIndex:"dom",hideable:!1,renderer:function(c,d,f,g,h,k,l){b.renderGG(7,c,d)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",width:80,
align:"center",text:"QUANTITA",dataIndex:"quantita",hidden:!0,editor:{xtype:"numberfield",itemId:"ColumQuantita",reference:"ColumQuantita",value:1},renderer:function(b,d,f,g,h,k,l){d.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",width:140,align:"center",hidden:!0,dataIndex:"pianificato",text:"A_CALENDARIO",sortable:!1,renderer:function(b,d,f,g,h,k,l){d.style="word-wrap: break-word";return StdUtenti.renderRilevatoCalendario(f.get("pianificato"),f.get("erogato"),f.get("nonErogato"))},
listeners:{afterrender:function(b){StdUtenti.createTooltipRilevatoCalendario(b)}}},{xtype:"gridcolumn",width:55,align:"center",hidden:!0,dataIndex:"residuo",text:"RESIDUO",sortable:!1,renderer:function(b,d,f,g,h,k,l){d.style="text-align:right !important";d=formatFloat(b);return 0<=b?d:'<b><span style="color:red">'+d+"</span></b>"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",cls:"baseBgColor",
items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"},{xtype:"tbfill"},{xtype:"label",html:traduci("CDI_GIORNI_PRESTAZIONI"),cls:"cbaLabel"},{xtype:"tbfill"},{xtype:"container",layout:"hbox",items:[{xtype:"label",margin:"3 5 0 0",itemId:"LblAuto",reference:"LblAuto",text:"GESTIONE_AUTOMATICA",hidden:!0},{xtype:"checkboxfield",itemId:"CBClasInt",
reference:"CBClasInt",id:"CBClasInt",fieldLabel:"",boxLabel:"GESTIONE_AUTOMATICA_CLASSIFICAZIONE_INTERNA",boxLabel:"class. interna",inputValue:"T",uncheckedValue:"F",isFormField:!0,disabled:!1,hidden:!0,checked:!b.cbaConfig.isAmbulatoriale},{xtype:"checkboxfield",itemId:"CBClasReg",reference:"CBClasReg",id:"CBClasReg",fieldLabel:"",boxLabel:"GESTIONE_AUTOMATICA_CLASSIFICAZIONE_REGIONALE",boxLabel:"class. regionale",inputValue:"T",uncheckedValue:"F",isFormField:!0,disabled:!1,hidden:!0}]}]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtClassRetta_Res",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",width:700,height:285,itemId:"CntForm",reference:"CntForm",layout:{type:"hbox"},title:"",items:[{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},margin:"10 0 0 10",trackResetOnLoad:!0,items:[{xtype:"container",margin:"0 0 5 0",
width:500,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"EditClassificazioniDataDal",reference:"EditClassificazioniDataDal",width:210,fieldLabel:"DATA_DECORRENZA",labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:!1},{xtype:"datefield",readOnly:!0,itemId:"EditClassificazioniDataAl",reference:"EditClassificazioniDataAl",width:190,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",labelWidth:80,name:"dataAl"}]},{xtype:"combobox",itemId:"CbProfiloUtente",
reference:"CbProfiloUtente",width:450,fieldLabel:"PROFILAZIONI_UTENTE",labelClsExtra:"cbaLabel",name:"idProfilazione",allowBlank:!1,valueField:"codice",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/prszn/profilazioneAnagrafica/cbox"},autoLoad:!1}),listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",itemId:"CbPrestazione",reference:"CbPrestazione",width:450,fieldLabel:"CLASSIFICAZIONE",
labelClsExtra:"cbaLabel",name:"codiceClassificazione",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Classificazioni"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"textfield",itemId:"EditClassificazioniTipoClassificazione",reference:"EditClassificazioniTipoClassificazione",fieldLabel:"Tipo",labelClsExtra:"cbaLabel",hidden:!0,name:"tipoClassificazione"},{xtype:"htmleditor",itemId:"EditNote",
reference:"EditNote",height:80,fieldLabel:"NOTE",labelAlign:"top",labelClsExtra:"cbaLabel",name:"noteClassificazione"},{xtype:"textfield",itemId:"EditClassificazioniRecordId",reference:"EditClassificazioniRecordId",fieldLabel:"id",hidden:!0,name:"idClassificazione"},{xtype:"container",border:0,itemId:"PnlImporti",reference:"PnlImporti",width:530,layout:{type:"hbox"},items:[{xtype:"container",flex:1,height:95,layout:{type:"vbox"},items:[{xtype:"label",cls:"cbaLabel",margin:"20 0 0 0",text:"QUOTA_SAN"},
{xtype:"label",cls:"cbaLabel",margin:"8 0 0 0",text:"QUOTA_SOC"}]},{xtype:"container",flex:1,height:95,layout:{type:"vbox"},items:[{xtype:"label",cls:"cbaLabel",text:"DATABELLA"},{xtype:"numberfield",formBind:!1,disabled:!0,disabledCls:"cba-readonly-element",itemId:"EdtQuotaSanDefault",reference:"EdtQuotaSanDefault",width:80,decimalPrecision:5,labelClsExtra:"cbaLabel",name:"quotaSanitariaDefault"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EdtQuotaSocDefault",reference:"EdtQuotaSocDefault",
width:80,decimalPrecision:5,fieldLabel:"",labelClsExtra:"cbaLabel",labelStyle:"",name:"quotaSocialeDefault"}]},{xtype:"container",flex:1,height:95,layout:{type:"vbox"},items:[{xtype:"label",cls:"cbaLabel",text:"PERSONALIZZATO"},{xtype:"numberfield",itemId:"EdtQuotaSan",reference:"EdtQuotaSan",width:80,decimalPrecision:5,fieldLabel:"",labelClsExtra:"cbaLabel",name:"quotaSanitariaRetta"},{xtype:"numberfield",itemId:"EdtQuotaSoc",reference:"EdtQuotaSoc",width:80,decimalPrecision:5,fieldLabel:"",labelClsExtra:"cbaLabel",
name:"quotaSocialeRetta"},{xtype:"label",cls:"cbaLabel",text:"TOTALE"}]},{xtype:"container",flex:1,height:95,layout:{type:"vbox"},items:[{xtype:"label",flex:1,cls:"cbaLabel",text:"QUOTA_EFFETTIVA",margin:"0 0 13 0"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EdtQuotaSanFatt",reference:"EdtQuotaSanFatt",width:80,decimalPrecision:5,fieldLabel:"",labelClsExtra:"cbaLabel",name:"quotaSanitariaFatt"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EdtQuotaSocFatt",
reference:"EdtQuotaSocFatt",width:80,decimalPrecision:5,fieldLabel:"",labelClsExtra:"cbaLabel",name:"quotaSocialeFatt"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EdtQuotaTot",reference:"EdtQuotaTot",width:80,decimalPrecision:5,labelClsExtra:"cbaLabel",name:"totaleRettaFatt"}]}]},{xtype:"textfield",name:"id",hidden:!0}]},{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120},{xtype:"button",cls:"cba-button-25",
itemId:"BtnSimula",reference:"BtnSimula",iconCls:"icon-elabora",text:"RETTE_SIMULA",margin:"0 0 0 10",disabled:!0},{xtype:"button",cls:"cba-button-25",itemId:"BtnCreaAnagrafica",reference:"BtnCreaAnagrafica",iconCls:"icon-pagante16",text:"ANAGRAFICA",tooltip:"CREA_ANAGRAFICA_PAGANTE",margin:"5 0 0 10",disabled:!0,hidden:!CBA.moduli.modulo43.abilitato},{xtype:"label",margin:"10 0 0 0",itemId:"LblAuto",reference:"LblAuto",text:"GESTIONE_AUTOMATICA",hidden:!0},{xtype:"checkboxfield",itemId:"CBClasInt",
reference:"CBClasInt",fieldLabel:"",boxLabel:"GESTIONE_AUTOMATICA_CLASSIFICAZIONE_INTERNA",inputValue:"T",uncheckedValue:"F",checked:!0,margin:"0 0 0 0",isFormField:!1,disabled:!0,hidden:!0},{xtype:"checkboxfield",itemId:"CBClasReg",reference:"CBClasReg",fieldLabel:"",boxLabel:"GESTIONE_AUTOMATICA_CLASSIFICAZIONE_REGIONALE",inputValue:"T",uncheckedValue:"F",hidden:"L"==this.cbaConfig.regione,isFormField:!1,disabled:!0,hidden:!0}]}]},{xtype:"container",itemId:"ContainerPaganti",reference:"ContainerPaganti",
flex:1,layout:{type:"fit"},border:0,hidden:!0,bodyBorder:!1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtClassRetta_ResPaganti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){this.storeTipoQuota=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["P",decodeTipoQuota("P",!0)],["G",decodeTipoQuota("G",!0)],["M",decodeTipoQuota("M",!0)],["T",decodeTipoQuota("T",!0)],["N",decodeTipoQuota("N",!0)],["Z",decodeTipoQuota("Z",!0)]],autoLoad:!0,autoDestroy:!0});Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"Grid",reference:"Grid",title:"PAGANTI",
store:Ext.create("GeneraliOSP.portlet.store.Paganti"),header:{padding:3},columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return d.data.ragioneSociale},dataIndex:"codfocl",hideable:!1,text:"PAGANTE",flex:1,editor:{xtype:"combobox",itemId:"CbPagante",reference:"CbPagante",store:Ext.create("GeneraliOSP.portlet.store.ListaPaganti"),queryMode:"remote",displayField:"valore",matchFieldWidth:!1,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='' || extra.indexOf('null')!=-1 || extra.indexOf(',')==0\">",
'<div class="x-boundlist-item">{valore}</div>',"<tpl else>","<tpl if=\"extra.indexOf(',')!=-1\">","<tpl if=\"extra.split(',')[1]=='F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore} [CF: {[values.extra.split(\',\')[0]]}]</div>',"<tpl else>","<div class=\"x-boundlist-item\">{valore} [CF: {[values.extra.split(',')[0]]}]</div>","</tpl>","<tpl else>",'<div class="x-boundlist-item">{valore} [CF: {extra}]</div>',"</tpl>","</tpl>","</tpl>"),valueField:"codice",
queryParam:"valore",pageSize:25,triggerAction:"all",typeAhead:!0,minChars:1,allowBlank:!1,forceSelection:!0,listConfig:{width:500,heigth:200,loadMask:!1},listeners:{beforequery:function(b){if(!b.query)return!1}}}},{xtype:"datecolumn",width:70,align:"center",dataIndex:"dataDal",text:"DATA_INIZIO",format:"d/m/Y",editor:{xtype:"datefield"}},{xtype:"datecolumn",width:70,align:"center",dataIndex:"dataAl",text:"DATA_FINE",format:"d/m/Y",editor:{xtype:"datefield"}},{xtype:"gridcolumn",renderer:function(b,
c,d,f,g,h,k){return renderCheckColumn(c,b)},width:55,align:"center",dataIndex:"pensione",text:"PENSIONE",editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return decodeTipoQuota(b,!0)},width:75,align:"center",dataIndex:"tipoQuota",hideable:!1,text:"TIPO_QUOTA",editor:{xtype:"combo",itemId:"CbTipoQuota",reference:"CbTipoQuota",allowBlank:!1,store:this.storeTipoQuota,displayField:"valore",valueField:"codice",mode:"local",triggerAction:"all",
editable:!1,matchFieldWidth:!1}},{xtype:"booleancolumn",hideable:!1,text:"PRESENZA",columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},width:55,dataIndex:"quotaSanitariaPresenza",text:"Q_SAN",editor:{xtype:"numberfield",allowBlank:!1}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},width:55,dataIndex:"quotaSocialePresenza",text:"Q_SOC",editor:{xtype:"numberfield",
allowBlank:!1}}]},{xtype:"booleancolumn",hideable:!1,text:"ASSENZA",columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},width:55,dataIndex:"quotaSanitariaAssenza",text:"Q_SAN",editor:{xtype:"numberfield",allowBlank:!1}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},width:55,dataIndex:"quotaSocialeAssenza",text:"Q_SOC",editor:{xtype:"numberfield",allowBlank:!1}}]}],
viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"CBPagantiAtt",reference:"CBPagantiAtt",fieldLabel:"",boxLabel:"VISUALIZZA_SOLO_PAGANTI_ATTIVI",
inputValue:"T",uncheckedValue:"F",checked:!0,listeners:{change:{fn:this.onCBPagantichange,scope:this}}},{xtype:"button",cls:"btnLarge",iconCls:"icon-info",scale:"small",text:"",margin:"0 0 0 60",tooltip:'<TABLE><TR><TD colspan="2"><B>'+traduci("TIPO_QUOTA").toUpperCase()+"</B></TD></TR><TR><TD><B>"+decodeTipoQuota("P",!0)+"</B></TD><TD>"+traduci("DESC_QUOTA_PERC")+"</TD></TR><TR><TD><B>"+decodeTipoQuota("G",!0)+"</B></TD><TD>"+traduci("DESC_QUOTA_GG")+" </TD></TR><TR><TD><B>"+decodeTipoQuota("M",
!0)+"</B></TD><TD>"+traduci("DESC_QUOTA_MESE")+"</TD></TR><TR><TD><B>"+decodeTipoQuota("T",!0)+"</B></TD><TD>"+traduci("DESC_QUOTA_MESE_TMAX")+"</TD></TR><TR><TD><B>"+decodeTipoQuota("N",!0)+"</B></TD><TD>"+traduci("DESC_QUOTA_MESE_PROPORZIONATO")+"</TD></TR><TR><TD><B>"+traduci("SOLO_PENSIONE")+"</B></TD><TD>"+traduci("DESC_QUOTA_SOLO_PENSIONE")+"</TD></TR></TABLE>",hidden:!1}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtClassificazioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",itemId:"TabClass",reference:"TabClass",width:210,layout:{type:"accordion"},title:"RETTE_CLASSIFICAZIONI",items:[{xtype:"panel",itemId:"Container",reference:"Container",layout:{type:"fit"},title:"RETTA",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridRetta",
reference:"StoricoGridRetta",title:"",columns:[{xtype:"datecolumn",itemId:"ColDataCDI",reference:"ColDataCDI",width:80,dataIndex:"dataDecorrenza",text:"DATA_DECORRENZA",flex:1,align:"center",format:"d/m/Y"},{xtype:"datecolumn",itemId:"ColDataRetta",reference:"ColDataRetta",width:70,dataIndex:"dataDal",text:"DATA",format:"d/m/Y"},{xtype:"gridcolumn",itemId:"ColDesClass",reference:"ColDesClass",dataIndex:"desClassificazione",text:"CLASSIFICAZIONE",flex:1,renderer:function(c,d,f,g,h,k,l){"T"==f.get("statoRisposta")&&
(d.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");return b.controller.setStyleErroreClass(c,d,f)}}],selModel:Ext.create("Ext.selection.RowModel",{}),viewConfig:{getRowClass:function(b,d,f,g){if(8==b.get("statoInvio")||9==b.get("statoInvio"))return"cba-deleted-record-clean"},border:0,loadMask:!1}}]},{xtype:"panel",itemId:"PnlRegionale",reference:"PnlRegionale",layout:{type:"fit"},collapsed:!0,title:"REGIONALE",items:[{xtype:"gridpanel",border:0,
itemId:"StoricoGridRegionale",reference:"StoricoGridRegionale",title:"",columns:[{xtype:"datecolumn",width:70,dataIndex:"dataDal",text:"DATA",format:"d/m/Y"},{xtype:"gridcolumn",dataIndex:"desClassificazione",text:"CLASSIFICAZIONE",flex:1,renderer:function(c,d,f,g,h,k,l){"T"==f.get("statoRisposta")&&(d.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");return b.controller.setStyleErroreClass(c,d,f)}}],selModel:Ext.create("Ext.selection.RowModel",{}),
viewConfig:{loadMask:!1}}]},{xtype:"panel",itemId:"PnlInterna",reference:"PnlInterna",layout:{type:"fit"},collapsed:!0,title:"INTERNA",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridInterna",reference:"StoricoGridInterna",title:"",columns:[{xtype:"datecolumn",width:70,dataIndex:"dataDal",text:"DATA",format:"d/m/Y"},{xtype:"gridcolumn",dataIndex:"desClassificazione",text:"CLASSIFICAZIONE",flex:1,renderer:function(c,d,f,g,h,k,l){"T"==f.get("statoRisposta")&&(d.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");
return b.controller.setStyleErroreClass(c,d,f)}}],selModel:Ext.create("Ext.selection.RowModel",{}),viewConfig:{loadMask:!1}}]}]},{xtype:"container",itemId:"PnlMain",reference:"PnlMain",flex:1,layout:{type:"fit"}},{xtype:"container",itemId:"PnlIntReg",reference:"PnlIntReg",flex:1,hidden:!0,layout:{type:"fit"}}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtScontiSupp",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"EditScontiSupp",reference:"EditScontiSupp",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",region:"west",itemId:"Container",reference:"Container",width:210,layout:{type:"fit"},title:"SCONTI_ELENCO",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridScontiSupp",reference:"StoricoGridScontiSupp",title:"",store:Ext.create("GeneraliOSP.portlet.store.ExtraRetta"),
viewConfig:{getRowClass:function(b,c,d,f){if("F"===b.data.isActive)return"non_attivi"},loadMask:!1},columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.tdCls="S"==d.data.tipo?"icon-piu":"icon-meno"},width:25,text:""},{xtype:"datecolumn",dataIndex:"dataDal",text:"DATA_INIZIO",flex:1,format:"d/m/Y"},{xtype:"datecolumn",dataIndex:"dataAl",text:"DATA_FINE",flex:1,format:"d/m/Y"}],selModel:Ext.create("Ext.selection.RowModel",{})}]},{xtype:"panel",region:"center",itemId:"EditScontiSuppDett",
reference:"EditScontiSuppDett",layout:{type:"border"},title:"",border:0,items:[{xtype:"panel",region:"east",itemId:"BoxBottoni",reference:"BoxBottoni",width:120,title:""},{xtype:"button",cls:"cba-button-25",itemId:"BtnElaboraFattura",reference:"BtnElaboraFattura",iconCls:"menu-fattura",text:traduci("ELABORA"),tooltip:traduci("ELABORA_FATTURA"),hidden:!0},{xtype:"form",region:"center",border:0,itemId:"EditScontiSuppForm",reference:"EditScontiSuppForm",layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,
items:[{xtype:"container",margin:"0 0 5 0",width:530,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"EditScontiSuppTipo",reference:"EditScontiSuppTipo",width:240,margin:"3 0 0 0",labelWidth:75,fieldLabel:"SCONTI_TIPO",labelClsExtra:"cbaLabel",name:"tipo",allowBlank:!1,editable:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"datefield",itemId:"EditScontiSuppDataDal",reference:"EditScontiSuppDataDal",
margin:"0 0 0 5",width:140,labelWidth:35,fieldLabel:"DATA_INIZIO",labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:!1},{xtype:"datefield",itemId:"EditScontiSuppDataAl",reference:"EditScontiSuppDataAl",margin:"0 0 0 5",width:140,labelWidth:35,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",name:"dataAl"}]},{xtype:"combobox",itemId:"EditScontiSuppRisposta",reference:"EditScontiSuppRisposta",width:530,fieldLabel:"SCONTI_SCONTO_SUPP",labelClsExtra:"cbaLabel",name:"idRisposta",allowBlank:!1,displayField:"valore",
queryMode:"local",queryParam:"valore",store:Ext.create("CU.store.TipoSupplementiSconti",{autoDestroy:!1}),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"textfield",itemId:"EditScontiSuppDesc",reference:"EditScontiSuppDesc",width:530,fieldLabel:"SCONTI_DESC_AGG",labelClsExtra:"cbaLabel",name:"descrizioneAggiuntiva",maxLength:200},{xtype:"container",margin:"0 0 5 0",width:530,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"combobox",
itemId:"EditScontiSuppFattore",reference:"EditScontiSuppFattore",width:370,fieldLabel:"SCONTI_FATTORE_MOL",labelClsExtra:"cbaLabel",name:"fattoreMoltiplicazione",allowBlank:!1,editable:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.ScontiSuppFattMoltiplicazione",{autoLoad:!1}),valueField:"codice"},{xtype:"combobox",itemId:"EditScontiSuppTipoImporto",reference:"EditScontiSuppTipoImporto",width:155,fieldLabel:"SCONTI_TIPO_IMPORTO",labelClsExtra:"cbaLabel",
name:"tipoImporto",allowBlank:!1,editable:!1,displayField:"valore",minChars:2,queryMode:"local",queryParam:"valore",valueField:"codice"}]},{xtype:"numberfield",itemId:"EditScontiSuppNumGG",reference:"EditScontiSuppNumGG",width:190,fieldLabel:"SCONTI_NUMEROGG",labelClsExtra:"cbaLabel",name:"giorniMoltiplicazione"},{xtype:"panel",border:0,itemId:"GiorniPianificazione",reference:"GiorniPianificazione",hidden:!0,layout:{type:"vbox"},items:[{xtype:"gridpanel",itemId:"GGPianificazione",reference:"GGPianificazione",
width:352,store:new Ext.data.ArrayStore({fields:[{name:"lun"},{name:"mar"},{name:"mer"},{name:"gio"},{name:"ven"},{name:"sab"},{name:"dom"}]}),viewConfig:{loadMask:!1},columns:[{xtype:"checkcolumn",cls:"baseBgColor",style:"fontWeight:bold",text:"lun",dataIndex:"lun",align:"center",text:"lun",width:50,height:25,sortable:!1,listeners:{checkChange:function(){this.up("#EditScontiSuppForm").controller.ckChangeGiorno()}}},{xtype:"checkcolumn",cls:"baseBgColor",style:"fontWeight:bold",text:"mar",dataIndex:"mar",
align:"center",text:"mar",width:50,height:25,sortable:!1,listeners:{checkChange:function(){this.up("#EditScontiSuppForm").controller.ckChangeGiorno()}}},{xtype:"checkcolumn",cls:"baseBgColor",style:"fontWeight:bold",text:"mer",dataIndex:"mer",align:"center",text:"mer",width:50,height:25,sortable:!1,listeners:{checkChange:function(){this.up("#EditScontiSuppForm").controller.ckChangeGiorno()}}},{xtype:"checkcolumn",cls:"baseBgColor",style:"fontWeight:bold",text:"gio",dataIndex:"gio",align:"center",
text:"gio",width:50,height:25,sortable:!1,listeners:{checkChange:function(){this.up("#EditScontiSuppForm").controller.ckChangeGiorno()}}},{xtype:"checkcolumn",cls:"baseBgColor",style:"fontWeight:bold",text:"ven",dataIndex:"ven",align:"center",text:"ven",width:50,height:25,sortable:!1,listeners:{checkChange:function(){this.up("#EditScontiSuppForm").controller.ckChangeGiorno()}}},{xtype:"checkcolumn",cls:"baseBgColor",style:"fontWeight:bold",text:"sab",dataIndex:"sab",align:"center",text:"sab",width:50,
height:25,sortable:!1,listeners:{checkChange:function(){this.up("#EditScontiSuppForm").controller.ckChangeGiorno()}}},{xtype:"checkcolumn",cls:"baseBgColor",style:"fontWeight:bold",text:"dom",dataIndex:"dom",align:"center",text:"dom",width:50,height:25,sortable:!1,listeners:{checkChange:function(){this.up("#EditScontiSuppForm").controller.ckChangeGiorno()}}}]}]},{xtype:"container",border:0,itemId:"PnlImportiScontiSupp",reference:"PnlImportiScontiSupp",margin:"5 0 0 0",width:430,layout:{type:"hbox"},
items:[{xtype:"container",flex:1,height:95,layout:{type:"vbox"},items:[{xtype:"label",cls:"cbaLabel",margin:"20 0 0 0",text:"QUOTA_SAN"},{xtype:"label",cls:"cbaLabel",margin:"8 0 0 0",text:"QUOTA_SOC"}]},{xtype:"container",flex:1,height:95,layout:{type:"vbox"},items:[{xtype:"label",cls:"cbaLabel",text:"DATABELLA"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EditScontiSuppQuotaSanDefault",reference:"EditScontiSuppQuotaSanDefault",width:80,fieldLabel:"",labelClsExtra:"cbaLabel",
name:"quotaSanitariaDefault"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EditScontiSuppQuotaSocDefault",reference:"EditScontiSuppQuotaSocDefault",width:80,fieldLabel:"",labelClsExtra:"cbaLabel",name:"quotaSocialeDefault"}]},{xtype:"container",flex:1,height:95,layout:{type:"vbox"},items:[{xtype:"label",cls:"cbaLabel",text:"PERSONALIZZATO"},{xtype:"numberfield",itemId:"EditScontiSuppQuotaSan",reference:"EditScontiSuppQuotaSan",width:80,labelClsExtra:"cbaLabel",name:"quotaSanitaria"},
{xtype:"numberfield",itemId:"EditScontiSuppQuotaSoc",reference:"EditScontiSuppQuotaSoc",width:80,fieldLabel:"",labelClsExtra:"cbaLabel",name:"quotaSociale"},{xtype:"label",flex:1,cls:"cbaLabel",text:"TOTALE"}]},{xtype:"container",flex:1,height:100,layout:{type:"vbox"},items:[{xtype:"label",cls:"cbaLabel",text:"QUOTA_EFFETTIVA"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EditScontiSuppQuotaSanFatt",reference:"EditScontiSuppQuotaSanFatt",width:80,fieldLabel:"",labelClsExtra:"cbaLabel",
name:"quotaSanitariaFatt"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EditScontiSuppQuotaSocFatt",reference:"EditScontiSuppQuotaSocFatt",width:80,fieldLabel:"",labelClsExtra:"cbaLabel",name:"quotaSocialeFatt"},{xtype:"numberfield",disabled:!0,disabledCls:"cba-readonly-element",itemId:"EditScontiSuppQuotaTot",reference:"EditScontiSuppQuotaTot",width:80,fieldLabel:"",labelClsExtra:"cbaLabel",name:"totaleFatt"}]}]},{xtype:"container",margin:"5 0 0 0",flex:1,height:25,
layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"EditScontiSuppNote",reference:"EditScontiSuppNote",width:530,fieldLabel:"NOTE_INTERNE",labelClsExtra:"cbaLabel",name:"noteInterne",maxLength:200}]},{xtype:"label",cls:"cbaLabel",itemId:"LblCompConguaglio",reference:"LblCompConguaglio",hidden:!0},{xtype:"datefield",itemId:"EditConguaglioDa",reference:"EditConguaglioDa",name:"conguaglioDa",hidden:!0},{xtype:"datefield",itemId:"EditConguaglioA",reference:"EditConguaglioA",name:"conguaglioA",hidden:!0},
{xtype:"textfield",itemId:"EditGeneratoDa",reference:"EditGeneratoDa",name:"generatoDa",hidden:!0},{xtype:"numberfield",itemId:"EditScontiSuppRecordId",reference:"EditScontiSuppRecordId",fieldLabel:"id",name:"idExtraRetta",hidden:!0,allowDecimals:!1},{xtype:"numberfield",name:"id",hidden:!0,allowDecimals:!1}]},{xtype:"container",itemId:"ContainerDettaglio",reference:"ContainerDettaglio",height:190,layout:{type:"fit"},region:"south",border:0,hidden:!0,bodyBorder:!1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EdtScontiSuppDe",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",region:"south",border:0,itemId:"EditScontiSuppPaganti",reference:"EditScontiSuppPaganti",bodyBorder:!1,title:"PAGANTI",store:Ext.create("GeneraliOSP.portlet.store.ScontiSuppPaganti"),columns:[{xtype:"gridcolumn",width:30,sortable:!1,resizable:!1,hidden:"G"!=this.cbaConfig.controllerTestata.tipoServizio,renderer:function(b,c,d){0<
d.get("numFattContabilizzate")&&(c.tdCls="icon-warning",c.tdAttr='data-qtip="'+traduci("MSG_ELABORA_EXTRA_CONTABILIZZATO")+'"')}},{xtype:"gridcolumn",itemId:"ColEditPagante",reference:"ColEditPagante",renderer:function(b,c,d,f,g,h,k){return d.data.ragioneSociale},dataIndex:"codfocl",hideable:!1,text:"PAGANTE",flex:1,editor:{xtype:"combo",displayField:"valore",valueField:"codice",triggerAction:"all",queryParam:"valore",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='' || extra.indexOf('null')!=-1 || extra.indexOf(',')==0\">",
'<div class="x-boundlist-item">{valore}</div>',"<tpl else>","<tpl if=\"extra.indexOf(',')!=-1\">","<tpl if=\"extra.split(',')[1]=='F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore} [CF: {[values.extra.split(\',\')[0]]}]</div>',"<tpl else>","<div class=\"x-boundlist-item\">{valore} [CF: {[values.extra.split(',')[0]]}]</div>","</tpl>","<tpl else>",'<div class="x-boundlist-item">{valore} [CF: {extra}]</div>',"</tpl>","</tpl>","</tpl>"),typeAhead:!0,
minChars:3,allowBlank:!1,forceSelection:!0,listConfig:{width:300,heigth:200,loadMask:!1},listeners:{focus:function(b){b.reset()}}}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return decodeTipoQuota(b)},width:110,dataIndex:"tipoQuota",hideable:!1,text:"TIPO_QUOTA",editor:{xtype:"combo",allowBlank:!1,store:Ext.create("Generali.store.EuroPerc"),displayField:"valore",valueField:"codice",mode:"local",triggerAction:"all",editable:!1,matchFieldWidth:!1,listeners:{change:function(b,c,d,f){d=b.up("grid").getPlugin().getEditor().getForm();
b=d.findField("quotaSanitaria");d=d.findField("quotaSociale");"P"==c?(b.setValue("100"),d.setValue("100")):(b.setValue(""),d.setValue(""))}}}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},dataIndex:"quotaSanitaria",hideable:!1,text:"Q_SAN",editor:{xtype:"numberfield"}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)},dataIndex:"quotaSociale",hideable:!1,text:"Q_SOC",
editor:{xtype:"numberfield"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovoScontiSuppPaganti",reference:"BtnNuovoScontiSuppPaganti",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnEliminaScontiSuppPaganti",reference:"BtnEliminaScontiSuppPaganti",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"container",height:23,style:"margin-left:30px",
width:402,items:[{xtype:"radiogroup",itemId:"RdgScontiSuppPaganti",reference:"RdgScontiSuppPaganti",disabled:!0,width:350,fieldLabel:"",items:[{xtype:"radiofield",name:"filtroPaganti",boxLabel:"SCONTI_PAG_FAS",checked:!0,inputValue:"F"},{xtype:"radiofield",name:"filtroPaganti",boxLabel:"SCONTI_TUTTI_PAG",inputValue:"U"}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.EliminaRettaeClassificazione",{extend:"Ext.container.Container",id:"EliminaRettaeClassificazioni",itemId:"EliminaRettaeClassificazioni",reference:"EliminaRettaeClassificazioni",layout:{type:"border"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",region:"center",id:"EliminaRettaeClassificazioniForm",border:0,itemId:"EliminaRettaeClassificazioniForm",reference:"EliminaRettaeClassificazioniForm",trackResetOnLoad:!0,layout:{align:"center",type:"vbox"},
defaults:{margin:"0 5 0 0"},items:[{xtype:"label",margin:"20 0 0 0",border:0,dock:"bottom",itemId:"LblText",reference:"LblText",style:{fontSize:"12px"},text:traduci("MSG_ELIMINA")},{xtype:"label",border:0,dock:"bottom",style:{fontSize:"12px"},text:traduci("MSG_ELIMINAZIONE_RETTE_CLASSIFICAZIONE")},{xtype:"container",margin:"13 0 0 0",itemId:"CtnDate",reference:"CtnDate",layout:{type:"vbox"},items:[{xtype:"checkboxfield",itemId:"CBClasIntElimina",reference:"CBClasIntElimina",id:"CBClasIntElimina",
name:"CBClasIntElimina",cls:"cbaLabel",fieldLabel:"",boxLabel:traduci("RETTE_CLASS_INTERNA"),inputValue:"T",uncheckedValue:"F",checked:!0,margin:"0 10 0 0",isFormField:!0,disabled:!1,hidden:!this.config.cbaConfig.config.autoInt},{xtype:"checkboxfield",itemId:"CBClasRegElimina",reference:"CBClasRegElimina",id:"CBClasRegElimina",name:"CBClasRegElimina",cls:"cbaLabel",fieldLabel:"",boxLabel:traduci("RETTE_CLASS_REGIONALE"),inputValue:"T",uncheckedValue:"F",isFormField:!0,hidden:!this.config.cbaConfig.config.autoReg,
disabled:!1,checked:!0}]}]},{xtype:"form",region:"south",bodyPadding:4,layout:{align:"stretch",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",id:"btnSi",itemId:"btnSi",reference:"btnSi",width:80,scale:"large",text:"SI",listeners:{click:{fn:this.onButtonSiClick,scope:this}}},{xtype:"button",itemId:"btnNo",reference:"btnNo",width:80,margin:"0 0 0 20",scale:"large",text:"NO",listeners:{click:{fn:this.onButtonNoClick,scope:this}}},{xtype:"tbfill"}]}],listeners:{afterrender:{fn:this.onContainerAfterRender,
scope:this}}});this.callParent(arguments)},onButtonSiClick:function(b,c,d){var f=this,g=f.cbaConfig.callbackEsci;b={};b=isNaN(f.config.cbaConfig.config.idTestata)?{idClassificazione:f.config.cbaConfig.config.idClassificazione,autoInt:f.config.cbaConfig.config.autoInt&&Ext.getCmp("CBClasIntElimina").getValue(),autoReg:f.config.cbaConfig.config.autoReg&&Ext.getCmp("CBClasRegElimina").getValue()}:{idTestata:f.config.cbaConfig.config.idTestata,idRisposta:f.config.cbaConfig.config.idRisposta,autoInt:f.config.cbaConfig.config.autoInt&&
Ext.getCmp("CBClasIntElimina").getValue(),autoReg:f.config.cbaConfig.config.autoReg&&Ext.getCmp("CBClasRegElimina").getValue()};Ext.Ajax.request({method:"GET",url:null==f.config.cbaConfig.config.idTestata?"/cba/osp/co/ws/genOsp/rette/class/delete":"/cba/osp/co/ws/genOsp/cdi/weekplan/delete",params:b,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?msgShow("MSG_OPERAZIONE_OK",traduci("MSG_SALVATAGGIO_DATI")):msgShowError("",b.message[0].testo);g();f.up("window").close()}});msgShow("",
[])},onButtonNoClick:function(b,c,d){b=this.cbaConfig.callbackEsci;b();this.up("window").close()},onContainerAfterRender:function(b,c){}});
Ext.define("GeneraliOSP.portlet.view.EstrattoConto",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"stampaCBA",showAnteprima:!1,useNewButtonStampa:!1,border:0,itemId:"EstrattoConto",reference:"EstrattoConto",items:[{xtype:"container",itemId:"TpEstrattoConto",reference:"TpEstrattoConto",title:"CU_ESTRATTO_CONTO",layout:{type:"fit"}},{xtype:"container",itemId:"TpCauzione",reference:"TpCauzione",title:"CU_CAUZIONI",layout:{type:"fit"}}]},{xtype:"container",
itemId:"Container",reference:"Container",hidden:!0}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FARDati",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"FARDati",reference:"FARDati",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",region:"center",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",itemId:"CntDati",reference:"CntDati",width:700,height:425,layout:{type:"hbox"},title:"",items:[{xtype:"form",flex:1,border:0,itemId:"FARDatiForm",reference:"FARDatiForm",
autoScroll:!0,layout:{type:"vbox"},bodyPadding:5,trackResetOnLoad:!0,items:[{xtype:"container",width:620,margin:"0 0 0 7",layout:{type:"hbox"},title:"",items:[{xtype:"combobox",itemId:"CbPosContabile",reference:"CbPosContabile",width:300,labelWidth:60,fieldLabel:traduci("FAR_POS_CONTABILE"),labelClsExtra:"cbaLabel",name:"recordModificato",readOnly:!0,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("FAR.fascicolo.store.CboxPosContabile"),valueField:"codice"},{xtype:"textfield",
itemId:"LblStruttura",reference:"LblStruttura",isFormField:!1,readOnly:!0,allowBlank:!1,width:300,labelWidth:60,margin:"0 0 0 20",labelClsExtra:"cbaLabel",fieldLabel:traduci("FR_STRUTTURA")}]},{xtype:"fieldset",itemId:"PnlPratica",reference:"PnlPratica",width:627,margin:"10 0 0 0",title:"",items:[{xtype:"container",margin:"5 0 0 0",layout:{type:"hbox"},title:"",items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",width:210,fieldLabel:traduci("FAR_DATA_INIZIO_PRATICA"),labelClsExtra:"cbaLabel",
name:"data_inizio",allowBlank:!1},{xtype:"textfield",readOnly:!0,allowBlank:!1,labelClsExtra:"cbaLabel",fieldLabel:traduci("FR_NUMERO_PRATICA"),width:165,labelWidth:120,margin:"0 0 0 20",name:"annoPratica"},{xtype:"label",text:"-",margin:"3 0 0 5"},{xtype:"numberfield",itemId:"NumeroPratica",reference:"NumeroPratica",allowDecimals:!1,allowBlank:!1,labelClsExtra:"cbaLabel",fieldStyle:"text-align:left",fieldLabel:"",width:205,margin:"0 0 0 5",name:"numPratica"},{xtype:"checkboxfield",itemId:"NumPraticaZero",
reference:"NumPraticaZero",cls:"cbaLabel",boxLabel:traduci("FAR_NUMERO_PRATICA_ZERO"),inputValue:"T",uncheckedValue:"F",name:"numPraticaZero",margin:"0 0 0 5",hidden:!0}]},{xtype:"container",margin:"5 0 5 0",layout:{type:"hbox"},title:"",items:[{xtype:"datefield",itemId:"DataAl",reference:"DataAl",width:210,fieldLabel:traduci("FAR_DATA_FINE_PRATICA"),labelClsExtra:"cbaLabel",name:"data_fine"},{xtype:"combobox",itemId:"CbDimissione",reference:"CbDimissione",disabled:!0,width:385,margin:"0 0 0 20",
fieldLabel:traduci("FAR_TIPO_DIMISSIONE"),labelWidth:120,labelClsExtra:"cbaLabel",name:"tipo_dimissione",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0}]}]},{xtype:"fieldset",itemId:"PnlFRNA",reference:"PnlFRNA",width:627,margin:"10 0 0 0",title:"",items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"FlagFRNA",reference:"FlagFRNA",cls:"cbaLabel",boxLabel:traduci("FAR_CARICO_FRNA"),inputValue:"1",uncheckedValue:"0",name:"aCaricoFRNA"},
{xtype:"textfield",itemId:"IdAnagrGarsia",reference:"IdAnagrGarsia",name:"id_anagr_garsia",hidden:!0,fieldLabel:"Id Anagr. Garsia",width:200,margin:"0 0 5 40"},{xtype:"textfield",itemId:"IdEsternoGarsia",reference:"IdEsternoGarsia",name:"id_esterno_garsia",hidden:!0,fieldLabel:"Id Esterno garsia",width:200,margin:"0 0 5 20"}]},{xtype:"container",width:620,margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"CbRegPagante",reference:"CbRegPagante",width:300,fieldLabel:traduci("FAR_REGIONE_PAGANTE"),
labelClsExtra:"cbaLabel",name:"regionePagante",allowBlank:!0,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"extra",hidden:!0},{xtype:"combobox",itemId:"CbDstPagante",reference:"CbDstPagante",width:305,labelWidth:105,margin:"0 0 0 10",fieldLabel:traduci("FAR_DISTRETTO_PAGANTE"),labelClsExtra:"cbaLabel",name:"distrettoPagante",allowBlank:!0,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",hidden:!0,disabled:!0}]}]},{xtype:"container",itemId:"PnlCombo",
reference:"PnlCombo",width:620,margin:"10 0 0 7",layout:{type:"hbox"},title:"",items:[{xtype:"container",width:310,layout:{type:"vbox"},title:"",items:[{xtype:"combobox",itemId:"CbStrutturaProvenienza",reference:"CbStrutturaProvenienza",width:300,fieldLabel:traduci("FAR_STRUTTURA_PROVENIENZA"),labelClsExtra:"cbaLabel",name:"tipo_struttura_prov",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"combobox",itemId:"CbMotivazioneRichiesta",reference:"CbMotivazioneRichiesta",
width:300,margin:"2 0 0 0",fieldLabel:traduci("FAR_MOTIVAZIONE_RICHIESTA"),labelClsExtra:"cbaLabel",name:"motivazione_richiesta",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"combobox",itemId:"CbRichiestaInserimento",reference:"CbRichiestaInserimento",width:300,fieldLabel:traduci("FAR_RICHIESTA_INSERIMENTO"),labelClsExtra:"cbaLabel",name:"iniziativa_richiesta",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"}]},
{xtype:"container",width:310,layout:{type:"vbox"},title:"",items:[{xtype:"combobox",itemId:"CbTipoAccoglienza",reference:"CbTipoAccoglienza",width:310,labelWidth:103,fieldLabel:traduci("FAR_TIPO_ACCOGLIENZA"),labelClsExtra:"cbaLabel",name:"tipologia_accoglienza",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"htmleditor",itemId:"Note",reference:"Note",labelAlign:"top",labelClsExtra:"cbaLabel",name:"note",width:310,height:78,listeners:{change:function(b,
c,d){c&&80<c.length&&b.setValue(d)}}}]}]},{xtype:"fieldset",itemId:"PnlGarsia",reference:"PnlGarsia",width:627,layout:{type:"hbox"},title:"Garsia",items:[{xtype:"container",width:310,layout:{type:"vbox"},title:"",items:[{xtype:"label",text:traduci("FAR_CONTRATTO_SERVIZIO"),width:310,style:"text-align:center",margin:"0 0 5 0"},{xtype:"combobox",itemId:"CbTipoPosto",reference:"CbTipoPosto",width:300,labelWidth:110,fieldLabel:traduci("FAR_TIPO_POSTO"),labelClsExtra:"cbaLabel",name:"garsia_tipoPosto",
allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"combobox",itemId:"CbDistrettoContratto",reference:"CbDistrettoContratto",width:300,labelWidth:110,fieldLabel:traduci("FAR_DISTRETTO_CONTRATTO"),labelClsExtra:"cbaLabel",name:"garsia_distrettoContratto",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"}]},{xtype:"container",width:310,layout:{type:"vbox"},title:"",items:[{xtype:"label",text:traduci("FAR_ASSISTENZA"),
width:310,style:"text-align:center",margin:"0 0 5 0"},{xtype:"combobox",itemId:"CbAssistenzaRegione",reference:"CbAssistenzaRegione",width:305,labelWidth:120,fieldLabel:traduci("FAR_ASSISTENZA_REGIONE"),labelClsExtra:"cbaLabel",name:"garsia_regioneAssistenza",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"extra"},{xtype:"combobox",itemId:"CbAssistenzaDistretto",reference:"CbAssistenzaDistretto",width:305,labelWidth:120,fieldLabel:traduci("FAR_ASSISTENZA_DISTRETTO"),
labelClsExtra:"cbaLabel",name:"garsia_distrettoAssistenza",allowBlank:!0,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",disabled:!0}]}]},{xtype:"textfield",itemId:"CodiceStruttura",reference:"CodiceStruttura",name:"codStruttura",hidden:!0},{xtype:"textfield",itemId:"RecordId",reference:"RecordId",name:"id",hidden:!0}]},{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]},{xtype:"panel",itemId:"CntDatiTrimestrali",
reference:"CntDatiTrimestrali",flex:1,layout:{type:"fit"},border:0,margin:"5 0 0 0",bodyBorder:!1,header:{padding:3}}]},{xtype:"panel",region:"west",width:250,layout:{type:"fit"},title:"FR_PRATICA",items:[{xtype:"gridpanel",border:0,itemId:"GridPratiche",reference:"GridPratiche",title:"",store:Ext.create("FAR.fascicolo.store.FARDatiExt"),columns:[{xtype:"datecolumn",width:70,dataIndex:"data_inizio",text:traduci("FAR_DATA_INIZIO_PRATICA"),format:"d/m/Y"},{xtype:"datecolumn",width:70,dataIndex:"data_fine",
text:traduci("FAR_DATA_FINE_PRATICA"),format:"d/m/Y"},{xtype:"gridcolumn",dataIndex:"desStruttura",text:traduci("FR_STRUTTURA"),flex:1,renderer:function(b,c,d,f,g,h,k){return d.get("codStruttura")+" - "+currRicovero.desServizio}}],selModel:Ext.create("Ext.selection.RowModel",{}),viewConfig:{getRowClass:function(b,c,d,f){if(8==b.get("recordModificato")||9==b.get("recordModificato"))return"cba-deleted-record-clean";if(null!=b.get("data_fine"))return"non_attivi"},border:0,loadMask:!1}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FRValutazioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"panel",layout:{type:"hbox",align:"stretch"},border:0,bodyBorder:!1,items:[{xtype:"panel",itemId:"PnlGridValutazioni",reference:"PnlGridValutazioni",region:"west",width:170,layout:{type:"fit"},border:0,bodyBorder:!1,items:[{xtype:"gridpanel",itemId:"GridValutazioni",reference:"GridValutazioni",store:Ext.create("GeneraliOSP.portlet.store.FRValutazione"),
columns:[{xtype:"datecolumn",flex:1,dataIndex:"data",text:traduci("FR_DATA_VALUTAZIONE"),format:"d/m/Y"}],selModel:Ext.create("Ext.selection.RowModel",{}),viewConfig:{border:0,loadMask:!1}}]},{xtype:"container",itemId:"CntValutazioni",reference:"CntValutazioni",flex:1,border:0,bodyBorder:!1,margin:"0 0 0 5",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",itemId:"HeaderValutazione",reference:"HeaderValutazione",layout:{type:"hbox",align:"stretch"},border:0,margin:"5 0 0 0",bodyBorder:!1,
hidden:!0,items:[{xtype:"datefield",itemId:"DataValutazione",reference:"DataValutazione",width:210,fieldLabel:traduci("FR_DATA_VALUTAZIONE"),labelClsExtra:"cbaLabel",name:"data",allowBlank:!1},{xtype:"combobox",itemId:"CbTipoValutazione",reference:"CbTipoValutazione",width:365,margin:"0 0 0 120",fieldLabel:traduci("FR_TIPO_VALUTAZIONE"),labelWidth:105,labelClsExtra:"cbaLabel",name:"tipoValutazione",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!1},{xtype:"textfield",
itemId:"IdValutazioneREG",reference:"IdValutazioneREG",name:"idValutazioneREG",hidden:!0}]},{xtype:"tabpanel",itemId:"TabValutazione",reference:"TabValutazione",margin:"5 0 0 0",flex:1,items:[{xtype:"container",itemId:"CntPatologie",reference:"CntPatologie",border:0,tabConfig:{title:"FR_PATOLOGIE"},margin:"5 5 5 5",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",margin:"25 0 0 0",width:808,layout:{type:"vbox",align:"stretch"},border:0,bodyBorder:!1,items:[{xtype:"container",layout:{type:"hbox"},
items:[{xtype:"button",itemId:"BtnPatologia1",reference:"BtnPatologia1",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",tooltip:"FR_PATOLOGIA_SEARCH",margin:"0 0 10 0",textItemId:"EdtPatologia1",descItemId:"EdtPatologia1Des"},{xtype:"textfield",itemId:"EdtPatologia1",reference:"EdtPatologia1",width:140,margin:"-4 0 10 10",fieldLabel:"FR_PATOLOGIA_RESP",labelWidth:85,labelClsExtra:"cbaLabel",name:"patologia1",enforceMaxLength:!0,maxLength:5,allowBlank:!1},{xtype:"textfield",itemId:"EdtPatologia1Des",
reference:"EdtPatologia1Des",width:625,margin:"1 0 10 8",name:"patologia1Des",isFormField:!1,readOnly:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnPatologia2",reference:"BtnPatologia2",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",tooltip:"FR_PATOLOGIA_SEARCH",margin:"0 0 10 0",textItemId:"EdtPatologia2",descItemId:"EdtPatologia2Des",hidden:!0},{xtype:"textfield",itemId:"EdtPatologia2",reference:"EdtPatologia2",width:140,margin:"0 0 10 10",fieldLabel:"FR_PATOLOGIA2",
labelClsExtra:"cbaLabel",labelWidth:85,name:"patologia2",enforceMaxLength:!0,maxLength:5,hidden:!0},{xtype:"textfield",itemId:"EdtPatologia2Des",reference:"EdtPatologia2Des",width:625,margin:"0 0 10 8",name:"patologia2Des",isFormField:!1,readOnly:!0,hidden:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnPatologia3",reference:"BtnPatologia3",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",tooltip:"FR_PATOLOGIA_SEARCH",margin:"0 0 10 0",textItemId:"EdtPatologia3",
descItemId:"EdtPatologia3Des",hidden:!0},{xtype:"textfield",itemId:"EdtPatologia3",reference:"EdtPatologia3",width:140,margin:"0 0 10 10",fieldLabel:"FR_PATOLOGIA3",labelClsExtra:"cbaLabel",labelWidth:85,name:"patologia3",enforceMaxLength:!0,maxLength:5,hidden:!0},{xtype:"textfield",itemId:"EdtPatologia3Des",reference:"EdtPatologia3Des",width:625,margin:"0 0 10 8",name:"patologia3Des",isFormField:!1,readOnly:!0,hidden:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnPatologia4",
reference:"BtnPatologia4",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",tooltip:"FR_PATOLOGIA_SEARCH",margin:"0 0 10 0",textItemId:"EdtPatologia4",descItemId:"EdtPatologia4Des",hidden:!0},{xtype:"textfield",itemId:"EdtPatologia4",reference:"EdtPatologia4",width:140,margin:"0 0 10 10",fieldLabel:"FR_PATOLOGIA4",labelClsExtra:"cbaLabel",labelWidth:85,name:"patologia4",enforceMaxLength:!0,maxLength:5,hidden:!0},{xtype:"textfield",itemId:"EdtPatologia4Des",reference:"EdtPatologia4Des",width:625,
margin:"0 0 10 8",name:"patologia4Des",isFormField:!1,readOnly:!0,hidden:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnPatologia5",reference:"BtnPatologia5",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",tooltip:"FR_PATOLOGIA_SEARCH",margin:"0 0 10 0",textItemId:"EdtPatologia5",descItemId:"EdtPatologia5Des",hidden:!0},{xtype:"textfield",itemId:"EdtPatologia5",reference:"EdtPatologia5",width:140,margin:"0 0 10 10",fieldLabel:"FR_PATOLOGIA5",labelClsExtra:"cbaLabel",
labelWidth:85,name:"patologia5",enforceMaxLength:!0,maxLength:5,hidden:!0},{xtype:"textfield",itemId:"EdtPatologia5Des",reference:"EdtPatologia5Des",width:625,margin:"0 0 10 8",name:"patologia5Des",isFormField:!1,readOnly:!0,hidden:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnPatologia6",reference:"BtnPatologia6",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",tooltip:"FR_PATOLOGIA_SEARCH",margin:"0 0 10 0",textItemId:"EdtPatologia6",descItemId:"EdtPatologia6Des",
hidden:!0},{xtype:"textfield",itemId:"EdtPatologia6",reference:"EdtPatologia6",width:140,margin:"0 0 10 10",fieldLabel:"FR_PATOLOGIA6",labelClsExtra:"cbaLabel",labelWidth:85,name:"patologia6",enforceMaxLength:!0,maxLength:5,hidden:!0},{xtype:"textfield",itemId:"EdtPatologia6Des",reference:"EdtPatologia6Des",width:625,margin:"0 0 10 8",name:"patologia6Des",isFormField:!1,readOnly:!0,hidden:!0}]}]},{xtype:"htmleditor",itemId:"EditFRNote",reference:"EditFRNote",fieldLabel:"NOTE",labelAlign:"top",labelClsExtra:"cbaLabel",
name:"note"}]},{xtype:"panel",itemId:"CntSintomi",reference:"CntSintomi",flex:1,layout:{type:"hbox",align:"stretch"},border:0,bodyBorder:!1,tabConfig:{title:"FR_SINTOMI"}},{xtype:"panel",itemId:"CntPrestazioni",reference:"CntPrestazioni",flex:1,layout:{type:"hbox",align:"stretch"},border:0,bodyBorder:!1,tabConfig:{title:"FR_PRESTAZIONI"}},{xtype:"panel",title:traduci("PORTLET_SVAMA"),itemId:"CntSvama",reference:"CntSvama",width:993,layout:{type:"fit"},border:0,bodyBorder:!1,padding:5,defaults:{margin:5},
items:[{xtype:"gridpanel",itemId:"GridSvama",reference:"GridSvama",store:Ext.create("GeneraliOSP.portlet.store.FRDatiSvama"),flex:1,height:490,reference:"GridSvama",columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"idRicovero",hidden:!0},{xtype:"datecolumn",text:"DATA",align:"center",dataIndex:"dataSvama",width:125,sortable:!1,format:"d/m/Y"},{xtype:"gridcolumn",text:"VALUTAZIONE",align:"center",dataIndex:"tipoValutazione",width:120,sortable:!1,renderer:function(c,
d,f,g,h,k){return(c=7==b.controller.cbaConfig.tipoFlusso?b.controller.storeCodificheValutazioniSosia.findRecord("codice",c):9==b.controller.cbaConfig.tipoFlusso?b.controller.storeCodificheValutazioniSCDI.findRecord("codice",c):b.controller.storeCodificheValutazioniSvama.findRecord("codice",c))?c.get("valore"):""}},{xtype:"gridcolumn",header:"VALIDAZIONE",align:"center",dataIndex:"stato",width:80,renderer:function(b,d,f,g,h,k,l){Ext.isEmpty(b)||(d.tdCls="M"==b?"icon-selezionato":"icon-errore")}},{xtype:"gridcolumn",
text:"Karnofsky",align:"center",dataIndex:"punteggioKarnofsky",width:100,sortable:!1},{xtype:"gridcolumn",text:"PROFILO",align:"left",dataIndex:"profilo",flex:1,sortable:!1,renderer:function(b,d,f,g,h,k){return null!=b?b+" - "+traduci("SVAMA_PROFILO_"+b):traduci("SVAMA_PROFILO_KO")}},{xtype:"gridcolumn",text:"PUNTEGGIO",align:"center",dataIndex:"punteggioSvama",width:100,sortable:!1,renderer:function(b,d,f,g,h,k){if(b)return parseFloat(b).toFixed(2)}}],viewConfig:{loadMask:!1}}]},{xtype:"panel",itemId:"CntSchede",
reference:"CntSchede",flex:1,layout:{type:"hbox",align:"stretch"},border:0,bodyBorder:!1,tabConfig:{title:"FR_SCHEDE"},items:[{xtype:"container",margin:"25 0 0 0",width:818,layout:{type:"vbox",align:"stretch"},border:0,bodyBorder:!1,items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"PunteggioKarnofsky",reference:"PunteggioKarnofsky",width:175,margin:"0 0 0 10",fieldLabel:"FR_SCHEDE_PUNTEGGIO_KARNOFKY",labelWidth:130,labelClsExtra:"cbaLabel",name:"punteggioKarnofsky",
isFormField:!1,readOnly:!0},{xtype:"datefield",itemId:"DataKarnofsky",reference:"DataKarnofsky",margin:"0 0 0 10",fieldLabel:traduci("DATA"),labelWidth:35,width:125,labelClsExtra:"cbaLabel",name:"dataKarnofsky",isFormField:!1,readOnly:!0}]}]}]}]}]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FRValutazioni_HSP_PRS",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",width:808,layout:{type:"vbox",align:"stretch"},border:0,bodyBorder:!1,margin:"5 5 5 5",items:[{xtype:"combobox",itemId:"CbPrestazione1",reference:"CbPrestazione1",fieldLabel:traduci("FR_PRESTAZIONE1"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione1",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",
allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione2",reference:"CbPrestazione2",fieldLabel:traduci("FR_PRESTAZIONE2"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione2",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione3",reference:"CbPrestazione3",fieldLabel:traduci("FR_PRESTAZIONE3"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione3",displayField:"valore",queryMode:"local",queryParam:"valore",
valueField:"codice",allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione4",reference:"CbPrestazione4",fieldLabel:traduci("FR_PRESTAZIONE4"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione4",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione5",reference:"CbPrestazione5",fieldLabel:traduci("FR_PRESTAZIONE5"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione5",displayField:"valore",queryMode:"local",
queryParam:"valore",valueField:"codice",allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione6",reference:"CbPrestazione6",fieldLabel:traduci("FR_PRESTAZIONE6"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione6",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione7",reference:"CbPrestazione7",fieldLabel:traduci("FR_PRESTAZIONE7"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione7",displayField:"valore",
queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione8",reference:"CbPrestazione8",fieldLabel:traduci("FR_PRESTAZIONE8"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione8",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione9",reference:"CbPrestazione9",fieldLabel:traduci("FR_PRESTAZIONE9"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione9",
displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0},{xtype:"combobox",itemId:"CbPrestazione10",reference:"CbPrestazione10",fieldLabel:traduci("FR_PRESTAZIONE10"),labelWidth:100,labelClsExtra:"cbaLabel",name:"prestazione10",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FRValutazioni_HSP_RES",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",width:808,layout:{type:"vbox",align:"stretch"},border:0,bodyBorder:!1,margin:"5 5 5 5",items:[{xtype:"textfield",itemId:"IdValutazioneHSP",reference:"IdValutazioneHSP",name:"idValutazioneHSP",hidden:!0},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnSS1",reference:"BtnSS1",cls:"cba-stdbutton-25",
width:25,iconCls:"icon-search",margin:"0 0 10 0",textItemId:"EdtSS1",descItemId:"EdtSS1Des"},{xtype:"textfield",itemId:"EdtSS1",reference:"EdtSS1",width:140,margin:"0 0 10 10",fieldLabel:"FR_SS1",labelWidth:45,labelClsExtra:"cbaLabel",name:"ss1",enforceMaxLength:!0,maxLength:5},{xtype:"textfield",itemId:"EdtSS1Des",reference:"EdtSS1Des",width:625,margin:"0 0 10 8",name:"ss1Des",isFormField:!1,readOnly:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnSS2",reference:"BtnSS2",
cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",margin:"0 0 10 0",textItemId:"EdtSS2",descItemId:"EdtSS2Des"},{xtype:"textfield",itemId:"EdtSS2",reference:"EdtSS2",width:140,margin:"0 0 10 10",fieldLabel:"FR_SS2",labelWidth:45,labelClsExtra:"cbaLabel",name:"ss2",enforceMaxLength:!0,maxLength:5},{xtype:"textfield",itemId:"EdtSS2Des",reference:"EdtSS2Des",width:625,margin:"0 0 10 8",name:"ss2Des",isFormField:!1,readOnly:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnMNC1",
reference:"BtnMNC1",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",margin:"0 0 10 0",textItemId:"EdtMNC1",descItemId:"EdtMNC1Des"},{xtype:"textfield",itemId:"EdtMNC1",reference:"EdtMNC1",width:140,margin:"0 0 10 10",fieldLabel:"FR_MNC1",labelWidth:45,labelClsExtra:"cbaLabel",name:"mnc1",enforceMaxLength:!0,maxLength:5},{xtype:"textfield",itemId:"EdtMNC1Des",reference:"EdtMNC1Des",width:625,margin:"0 0 10 8",name:"mnc1Des",isFormField:!1,readOnly:!0}]},{xtype:"container",layout:{type:"hbox"},
items:[{xtype:"button",itemId:"BtnMNC2",reference:"BtnMNC2",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",margin:"0 0 10 0",textItemId:"EdtMNC2",descItemId:"EdtMNC2Des"},{xtype:"textfield",itemId:"EdtMNC2",reference:"EdtMNC2",width:140,margin:"0 0 10 10",fieldLabel:"FR_MNC2",labelWidth:45,labelClsExtra:"cbaLabel",name:"mnc2",enforceMaxLength:!0,maxLength:5},{xtype:"textfield",itemId:"EdtMNC2Des",reference:"EdtMNC2Des",width:625,margin:"0 0 10 8",name:"mnc2Des",isFormField:!1,readOnly:!0}]},
{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnSSP1",reference:"BtnSSP1",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",margin:"0 0 10 0",textItemId:"EdtSSP1",descItemId:"EdtSSP1Des"},{xtype:"textfield",itemId:"EdtSSP1",reference:"EdtSSP1",width:140,margin:"0 0 10 10",fieldLabel:"FR_SSP1",labelWidth:45,labelClsExtra:"cbaLabel",name:"ssp1",enforceMaxLength:!0,maxLength:5},{xtype:"textfield",itemId:"EdtSSP1Des",reference:"EdtSSP1Des",width:625,margin:"0 0 10 8",name:"ssp1Des",
isFormField:!1,readOnly:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnSSP2",reference:"BtnSSP2",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",margin:"0 0 10 0",textItemId:"EdtSSP2",descItemId:"EdtSSP2Des"},{xtype:"textfield",itemId:"EdtSSP2",reference:"EdtSSP2",width:140,margin:"0 0 10 10",fieldLabel:"FR_SSP2",labelWidth:45,labelClsExtra:"cbaLabel",name:"ssp2",enforceMaxLength:!0,maxLength:5},{xtype:"textfield",itemId:"EdtSSP2Des",reference:"EdtSSP2Des",width:625,
margin:"0 0 10 8",name:"ssp2Des",isFormField:!1,readOnly:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnSSS1",reference:"BtnSSS1",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",margin:"0 0 10 0",textItemId:"EdtSSS1",descItemId:"EdtSSS1Des"},{xtype:"textfield",itemId:"EdtSSS1",reference:"EdtSSS1",width:140,margin:"0 0 10 10",fieldLabel:"FR_SSS1",labelWidth:45,labelClsExtra:"cbaLabel",name:"sss1",enforceMaxLength:!0,maxLength:5},{xtype:"textfield",itemId:"EdtSSS1Des",
reference:"EdtSSS1Des",width:625,margin:"0 0 10 8",name:"sss1Des",isFormField:!1,readOnly:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnSSS2",reference:"BtnSSS2",cls:"cba-stdbutton-25",width:25,iconCls:"icon-search",margin:"0 0 10 0",textItemId:"EdtSSS2",descItemId:"EdtSSS2Des"},{xtype:"textfield",itemId:"EdtSSS2",reference:"EdtSSS2",width:140,margin:"0 0 10 10",fieldLabel:"FR_SSS2",labelWidth:45,labelClsExtra:"cbaLabel",name:"sss2",enforceMaxLength:!0,maxLength:5},
{xtype:"textfield",itemId:"EdtSSS2Des",reference:"EdtSSS2Des",width:625,margin:"0 0 10 8",name:"sss2Des",isFormField:!1,readOnly:!0}]}]}]});this.callParent(arguments)}});Ext.define("GeneraliOSP.portlet.view.FRValutazioni_Sdo",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"tabpanel",border:0,flex:1,bodyBorder:!1,itemId:"TabPnl",reference:"TabPnl",items:[]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FRValutazioni_Sdo_Dimissione",{extend:"Generali.standard.ControlledContainer",initComponent:function(){this.storeGradoSupporto=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["1",traduci("FR_GRADO_SUPPORTO_LEGGERO"),""],["2",traduci("FR_GRADO_SUPPORTO_CONTENUTO"),""],["3",traduci("FR_GRADO_SUPPORTO_COMPLESSSO"),""]],autoLoad:!0,autoDestroy:!0});this.storeTraumaIntossica=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["1",traduci("FR_TRAUMATISMI_INTOSSICAZIONI_AMBIENTELAVORO"),
""],["2",traduci("FR_TRAUMATISMI_INTOSSICAZIONI_AMBIENTEDOMESTICO"),""],["3",traduci("FR_TRAUMATISMI_INTOSSICAZIONI_INCIDENTESTRADALE"),""],["4",traduci("FR_TRAUMATISMI_INTOSSICAZIONI_VIOLENZA"),""],["5",traduci("FR_TRAUMATISMI_INTOSSICAZIONI_AUTOLESIONE"),""],["6",traduci("FR_TRAUMATISMI_INTOSSICAZIONI_ICIDENTESPORTIVO"),""],["9",traduci("FR_TRAUMATISMI_INTOSSICAZIONI_ALTRO"),""]],autoLoad:!0,autoDestroy:!0});Ext.applyIf(this,{items:[{xtype:"panel",flex:1,border:0,bodyBorder:!1,items:[{xtype:"container",
margin:"5 0 0 0",layout:{type:"vbox"},items:[{xtype:"combobox",itemId:"CbGradoSupporto",reference:"CbGradoSupporto",flex:1,fieldLabel:traduci("FR_GRADO_SUPPORTO"),width:500,labelAlign:"top",labelClsExtra:"cbaLabel",name:"gradoSupporto",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",store:this.storeGradoSupporto},{xtype:"combobox",itemId:"CbTraumIntoss",reference:"CbTraumIntoss",flex:1,fieldLabel:traduci("FR_TRAUMATISMI_INTOSSICAZIONI"),width:500,labelAlign:"top",labelClsExtra:"cbaLabel",
name:"trauma",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",store:this.storeTraumaIntossica},{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"label",text:"FR_RILEVAZIONE_DOLORE",cls:"cbaClsExtra",width:150,margin:"5 5 0 0"},{xtype:"cbaMultipleChoice",itemId:"RilevDolore",reference:"RilevDolore",layout:{type:"hbox"},style:"border: none !important;",name:"rilevazioneDolore",margin:"0 15 0 0",disabled:!0,cbaConfig:{itemsCfg:[{html:traduci("SI"),
margin:"0 0 0 0",style:"font-size: 16px !important;padding-left: 5px !important;",name:"rilevazioneDolore",isFormField:!0,hidden:!0},{html:traduci("NO"),margin:"0 0 0 0",style:"font-size: 16px !important;padding-left: 3px !important;",name:"rilevazioneDolore",isFormField:!0,hidden:!0}]}}]},{xtype:"fieldset",title:"FR_DRG",margin:"10 0 0 0",layout:{type:"vbox"},items:[{xtype:"combobox",itemId:"CmbMdc",reference:"CmbMdc",width:500,margin:5,fieldLabel:"MDC",labelClsExtra:"cbaLabel",name:"mdc",hidden:!1,
queryMode:"local",valueField:"codice",displayField:"valore"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FRValutazioni_Sdo_Panel",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this.cbaConfig.nameRef;Ext.applyIf(this,{items:[{xtype:"panel",flex:1,layout:{align:"stretch"},border:0,bodyBorder:!1,disabled:this.cbaConfig.pnlDisabled?this.cbaConfig.pnlDisabled:!1,items:[{xtype:"container",itemId:"Cnt"+b,reference:"Cnt"+b},{xtype:"gridpanel",hidden:this.cbaConfig.hideGrid?this.cbaConfig.hideGrid:!1,itemId:"Grid"+b,reference:"Grid"+b,store:this.cbaConfig.store,
columns:this.cbaConfig.columns,dockedItems:this.cbaConfig.dockedItems?this.cbaConfig.dockedItems:{}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FRValutazioni_Sosia",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"panel",flex:1,layout:"fit",border:0,bodyBorder:!1,items:[{xtype:"gridpanel",itemId:"GridValutazioneSosia",reference:"GridValutazioneSosia",store:Ext.create("GeneraliOSP.portlet.store.FRDatiSosia"),columns:[{xtype:"gridcolumn",width:50,hidden:49!=CBA.moduli.moduloAttivo||![13,14,15].includes(b.tipoFlusso),renderer:function(b,d,f,
g,h){null!=f.data.data&&(d.tdCls+=" icon-edit-document")}},{xtype:"datecolumn",dataIndex:"data",text:traduci("DATA"),align:"center",format:"d/m/Y",sortable:!1},{xtype:"gridcolumn",text:"TIPO_SCHEDA",dataIndex:"nomeScheda",width:350,sortable:!1,hidden:![9,13,14].includes(b.tipoFlusso)},{xtype:"gridcolumn",text:"VALUTAZIONE",align:"center",dataIndex:"tipoValutazione",width:150,sortable:!1,renderer:function(c,d,f,g,h,k){d="";6==b.controller.tipoFlusso?d=b.controller.storeCodificheValutazioniSvama.findRecord("codice",
c):7==b.controller.tipoFlusso?d=b.controller.storeCodificheValutazioniSosia.findRecord("codice",c):9==b.controller.tipoFlusso&&(d=b.controller.storeCodificheValutazioniSCDI.findRecord("codice",c));return d?d.get("valore"):c}},{xtype:"datecolumn",dataIndex:"scadenza",text:traduci("SCADENZA"),align:"center",format:"d/m/Y",sortable:!1,hidden:[13,14].includes(b.tipoFlusso)},{xtype:"gridcolumn",text:"STATO",align:"center",dataIndex:"stato",width:70,sortable:!1,renderer:function(b,d,f,g,h,k,l){Ext.isEmpty(b)||
(d.tdCls=["M","S"].includes(b)?"icon-selezionato":"icon-errore")},hidden:[13,14].includes(b.tipoFlusso)},{xtype:"gridcolumn",text:"PUNTEGGIO",align:"center",dataIndex:"punteggio",width:80,sortable:!1,hidden:![13,14].includes(b.tipoFlusso)},{xtype:"gridcolumn",text:"CLASSE",align:"center",dataIndex:"classe",width:70,sortable:!1,hidden:[9,13,14].includes(b.tipoFlusso)},{xtype:"gridcolumn",text:"ICA",align:"center",dataIndex:"ica",width:70,sortable:!1,hidden:7!=b.tipoFlusso},{xtype:"gridcolumn",text:"DESCRIZIONE",
dataIndex:"desClasse",flex:1,sortable:!1,hidden:[9,13,14].includes(b.tipoFlusso)},{xtype:"gridcolumn",text:"FR_STATO_INVIO_PRATICA",dataIndex:"statoInvio",sortable:!1,flex:1,hidden:9!=b.tipoFlusso,editor:{xtype:"combobox",queryMode:"local",valueField:"codice",displayField:"valore"},renderer:function(b,d,f,g,h,k){return f?f.get("desStatoInvio"):""}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FRValutazioni_Sosia_Tariffe",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",flex:1,layout:"fit",border:0,bodyBorder:!1,items:[{xtype:"gridpanel",itemId:"GridTariffeSosia",reference:"GridTariffeSosia",store:Ext.create("GeneraliOSP.portlet.store.FRDatiSosia_Tariffe"),columns:[{xtype:"datecolumn",dataIndex:"dal",text:traduci("DATA"),align:"center",format:"d/m/Y",sortable:!1,editor:{xtype:"datefield",
allowBlank:!1}},{xtype:"gridcolumn",text:"FR_IMPORTO_COMUNE",align:"center",dataIndex:"qComuni",width:120,sortable:!1,editor:{xtype:"numberfield"},renderer:cell_renderer_importo},{xtype:"gridcolumn",text:"FR_IMPORTO_PRIVATO",align:"center",dataIndex:"qPrivati",width:120,sortable:!1,editor:{xtype:"numberfield"},renderer:cell_renderer_importo},{xtype:"gridcolumn",text:"FR_IMPORTO_ALTRO",align:"center",dataIndex:"qEnti",width:120,sortable:!1,editor:{xtype:"numberfield"},renderer:cell_renderer_importo},
{xtype:"gridcolumn",text:"FR_TARIFFA_SUPPL",align:"center",dataIndex:"tariffaSupplementare",flex:1,sortable:!1,renderer:function(b,c){return b=cell_renderer_importo(b,c)}},{xtype:"gridcolumn",text:"FR_ASSEGNO_ACCOMPAGNAMENTO",align:"center",dataIndex:"assegnoAccompagnamento",flex:1,sortable:!1,renderer:function(b,c){return renderCheckColumn(c,b)}}],viewConfig:{loadMask:!1,getRowClass:function(b,c,d,f){if("T"==b.get("recordVirtuale"))return"non_attivi"}},plugins:[Ext.create("Ext.grid.plugin.RowEditing",
{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovoTariffeSosia",reference:"BtnNuovoTariffeSosia",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnEliminaTariffeSosia",reference:"BtnEliminaTariffeSosia",iconCls:"icon-eliminaGrtiglia",text:"Elimina"},{xtype:"label",html:'<span style="font-style: italic">'+traduci("FR_SCDI_INFO_TARIFFE")+"</span>",hidden:9!=this.tipoFlusso}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FlussiRegionali",{extend:"Generali.standard.ControlledContainer",itemId:"FlussiRegionali",reference:"FlussiRegionali",border:0,bodyBorder:!1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",border:0,itemId:"FRDatiForm",reference:"FRDatiForm",autoScroll:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:5,trackResetOnLoad:!0,items:[{xtype:"panel",itemId:"PnlUp",reference:"PnlUp",layout:{type:"hbox",align:"stretch"},height:270,border:0,bodyBorder:!1,
items:[{xtype:"panel",width:180,layout:{type:"fit"},border:0,bodyBorder:!1,items:[{xtype:"gridpanel",itemId:"GridPratiche",reference:"GridPratiche",store:Ext.create("GeneraliOSP.portlet.store.FRPratica"),columns:[{xtype:"datecolumn",width:90,dataIndex:"dal",text:traduci("DATA"),format:"d/m/Y"},{xtype:"gridcolumn",dataIndex:"annoNumPratica",text:traduci("FR_NUMERO_PRATICA"),flex:1,renderer:function(b,c,d,f,g,h,k){return d.get("annoNumPratica")}}],selModel:Ext.create("Ext.selection.RowModel",{}),viewConfig:{getRowClass:function(b,
c,d,f){if(8==b.get("statoInvio")||9==b.get("statoInvio"))return"cba-deleted-record-clean";if(null!=b.get("al"))return"non_attivi"},border:0,loadMask:!1}}]},{xtype:"container",itemId:"CntDatiPrincipali",reference:"CntDatiPrincipali",margin:"0 0 0 5",layout:{type:"vbox",align:"stretch"},items:[{xtype:"fieldset",itemId:"PnlPratica",reference:"PnlPratica",style:{borderColor:"#A2A2A2",borderStyle:"solid",borderRadius:"4px",backgroundColor:"#fbf5ff"},width:705,items:[{xtype:"container",layout:{type:"hbox",
align:"stretch"},items:[{xtype:"textfield",itemId:"CodiceStruttura",reference:"CodiceStruttura",readOnly:!0,allowBlank:!1,width:150,labelWidth:60,margin:"0 0 0 5",labelClsExtra:"cbaLabel",fieldLabel:traduci("FR_STRUTTURA"),name:"codStruttura"},{xtype:"textfield",readOnly:!0,allowBlank:!1,labelClsExtra:"cbaLabel",fieldLabel:traduci("FR_NUMERO_PRATICA"),width:125,labelWidth:50,margin:"0 0 0 20",name:"annoPratica"},{xtype:"label",text:"-",margin:"8 0 0 5"},{xtype:"numberfield",itemId:"NumeroPratica",
reference:"NumeroPratica",allowDecimals:!1,allowBlank:!1,labelClsExtra:"cbaLabel",fieldStyle:"text-align:left",fieldLabel:"",width:70,margin:"0 0 0 5",name:"numPratica"},{xtype:"combobox",itemId:"CbStatoInvio",reference:"CbStatoInvio",allowBlank:!1,flex:1,margin:"0 0 0 20",labelWidth:65,fieldLabel:traduci("FR_STATO_INVIO_PRATICA"),labelClsExtra:"cbaLabel",name:"statoInvio",readOnly:!0,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.FRStatoInvio"),
valueField:"codice"},{xtype:"button",cls:"btnLarge",margin:"0 0 0 5",itemId:"InfoPratica",reference:"InfoPratica",iconCls:"icon-grado-istruzione",scale:"medium",hidden:!0}]}]},{xtype:"container",itemId:"CntDatiExtraPratica",reference:"CntDatiExtraPratica",items:[{xtype:"container",margin:"5 0 0 0",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",width:210,fieldLabel:traduci("FR_DATA_INIZIO_PRATICA"),labelClsExtra:"cbaLabel",name:"dal",allowBlank:!1},{xtype:"combobox",
itemId:"CbProvenienzaUtente",reference:"CbProvenienzaUtente",flex:1,margin:"0 0 0 15",fieldLabel:traduci("FR_PROVENIENZA_UTENTE"),labelWidth:145,labelClsExtra:"cbaLabel",name:"tipoProvenienzaUtente",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",hidden:!0},{xtype:"combobox",itemId:"CbMotivoApertura",reference:"CbMotivoApertura",flex:1,margin:"0 0 0 15",fieldLabel:traduci("FR_MOTIVO_APERTURA_PRATICA"),labelWidth:145,labelClsExtra:"cbaLabel",name:"motApertura",displayField:"valore",
queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!1},{xtype:"combobox",itemId:"CbEsitoCongedo",reference:"CbEsitoCongedo",flex:1,margin:"0 0 0 15",fieldLabel:traduci("FR_ESITO_CONGEDO"),labelWidth:145,labelClsExtra:"cbaLabel",name:"esitoCongedo",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",hidden:!0}]},{xtype:"container",margin:"5 0 5 0",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"DataAl",reference:"DataAl",width:210,fieldLabel:traduci("FR_DATA_FINE_PRATICA"),
labelClsExtra:"cbaLabel",name:"al"},{xtype:"combobox",itemId:"CbMotivoChiusura",reference:"CbMotivoChiusura",flex:1,margin:"0 0 0 15",fieldLabel:traduci("FR_MOTIVO_CHIUSURA_PRATICA"),labelWidth:145,labelClsExtra:"cbaLabel",name:"motChiusura",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0,disabled:!0}]},{xtype:"container",margin:"5 0 5 0",itemId:"CntContainer1",reference:"CntContainer1",layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"FlagFSR",
reference:"FlagFSR",cls:"cbaLabel",fieldLabel:traduci("FR_CARICO_FSR"),labelWidth:98,inputValue:"T",uncheckedValue:"F",name:"aCaricoFSR"},{xtype:"combobox",itemId:"CbValutazioneRichiesta",reference:"CbValutazioneRichiesta",width:170,margin:"0 10 0 0",fieldLabel:traduci("FR_VALUTAZIONE_RICHIESTA"),labelWidth:65,labelClsExtra:"cbaLabel",name:"valutazioneRichiesta",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",hidden:!0},{xtype:"combobox",itemId:"CbTipoPostoLetto",reference:"CbTipoPostoLetto",
width:265,margin:"0 0 0 10",fieldLabel:traduci("FR_TIPO_POSTO_LETTO"),labelWidth:65,labelClsExtra:"cbaLabel",name:"tipoPostoLetto",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",hidden:!0},{xtype:"combobox",itemId:"CbClassifUtente",reference:"CbClassifUtente",flex:1,margin:"0 0 0 15",fieldLabel:traduci("FR_CLASSIFICAZIONE_UTENTE"),labelClsExtra:"cbaLabel",name:"classificazioneUtente",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",hidden:!0},
{xtype:"combobox",itemId:"CbSoggettoPagante",reference:"CbSoggettoPagante",width:250,margin:"0 0 0 10",fieldLabel:traduci("FR_SOGGETTO_PAGANTE"),labelWidth:55,labelClsExtra:"cbaLabel",name:"soggettoPagante",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",hidden:!0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"TipologiaUtente",reference:"TipologiaUtente",isFormField:!1,readOnly:!0,flex:1,labelWidth:100,labelClsExtra:"cbaLabel",fieldLabel:traduci("FR_TIPOLOGIA_UTENTE"),
name:"tipologiaUtente"},{xtype:"button",cls:"btnLarge",margin:"0 0 0 5",itemId:"InfoTipologiaUtente",reference:"InfoTipologiaUtente",iconCls:"icon-info",scale:"medium",tooltip:traduci("FR_TIPOLOGIA_UTENTE_TOOLTIP")},{xtype:"container",width:10},{xtype:"combobox",itemId:"TipologiaAssistenza",reference:"TipologiaAssistenza",flex:1,labelWidth:130,fieldLabel:traduci("FR_TIPOLOGIA_ASSISTENZA"),labelClsExtra:"cbaLabel",name:"tipologiaAssistenza",displayField:"valore",queryMode:"local",queryParam:"valore",
valueField:"codice",hidden:!0,matchFieldWidth:!1}]},{xtype:"textfield",itemId:"CodiceStrutturaDestinazione",reference:"CodiceStrutturaDestinazione",allowBlank:!0,flex:1,labelWidth:100,labelClsExtra:"cbaLabel",fieldLabel:traduci("FR_STRUTTURA_DESTINAZIONE"),name:"codStrutturaDestinazione",hidden:!0,maxLength:6,enforceMaxLength:!0},{xtype:"textfield",itemId:"TipoFlusso",reference:"TipoFlusso",name:"tipoFlusso",hidden:!0},{xtype:"textfield",itemId:"IdPratica",reference:"IdPratica",name:"idPratica",hidden:!0},
{xtype:"textfield",name:"id",hidden:!0},{xtype:"textfield",name:"codiceTipologiaUtente",itemId:"CodiceTipologiaUtente",reference:"CodiceTipologiaUtente",hidden:!0}]},{xtype:"container",itemId:"CntDatiExtraPraticaSdo",reference:"CntDatiExtraPraticaSdo",layout:"vbox",hidden:!0}]},{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]},{xtype:"panel",itemId:"CntValutazioni",reference:"CntValutazioni",flex:1,layout:{type:"hbox",align:"stretch"},
title:"FR_VALUTAZIONI",border:0,bodyBorder:!1,header:{height:20,padding:2},margin:"2px 0 0 0"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.FlussiRegionaliSDO",{extend:"Generali.standard.ControlledContainer",initComponent:function(){this.storeClasseAsa=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["1",traduci("FR_CLASSEASA_1"),""],["2",traduci("FR_CLASSEASA_2"),""],["3",traduci("FR_CLASSEASA_3"),""],["4",traduci("FR_CLASSEASA_4"),""],["5",traduci("FR_CLASSEASA_5"),""]],autoLoad:!0,autoDestroy:!0});this.storeTipoRicovRiab=new Ext.data.ArrayStore({fields:["codice","valore"],data:[["1",traduci("FR_TIPORICOVERORIAB_1"),
""],["2",traduci("FR_TIPORICOVERORIAB_2"),""],["3",traduci("FR_TIPORICOVERORIAB_3"),""]],autoLoad:!0,autoDestroy:!0});Ext.applyIf(this,{items:[{xtype:"container",itemId:"boxBottoniCss",reference:"boxBottoniCss"},{xtype:"container",itemId:"cntCompilatoreCss",reference:"cntCompilatoreCss"},{xtype:"form",border:0,flex:1,itemId:"formSdo",reference:"formSdo",layout:"vbox",items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"textfield",name:"idPraticaSdo",hidden:!0},{xtype:"container",margin:"5 0 0 0",
layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"DataDalSdo",reference:"DataDalSdo",width:160,labelWidth:50,fieldLabel:traduci("FR_DATA_INIZIO_PRATICA"),labelClsExtra:"cbaLabel",name:"dalSdo",allowBlank:!1},{xtype:"datefield",margin:"0 0 0 5",itemId:"DataAlSdo",reference:"DataAlSdo",width:160,labelWidth:50,fieldLabel:traduci("FR_DATA_FINE_PRATICA"),labelClsExtra:"cbaLabel",name:"alSdo"},{xtype:"combobox",itemId:"CbMotivoChiusuraSdo",reference:"CbMotivoChiusuraSdo",width:360,labelWidth:100,margin:"0 0 0 15",
fieldLabel:traduci("MOTIVO_DIMISSIONE"),labelClsExtra:"cbaLabel",name:"motChiusuraSdo",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice",allowBlank:!0,store:Ext.create("GeneraliOSP.fascicoloNoApp.store.MotivoDimissione")}]},{xtype:"container",margin:"5 0 5 0",layout:{type:"hbox"},items:[{xtype:"container",layout:"vbox",flex:1,items:[{xtype:"combobox",itemId:"idTipoProvenienza",reference:"idTipoProvenienza",width:345,labelWidth:80,labelAlign:"top",margin:0,fieldLabel:"TIPO_PROVENIENZA",
labelClsExtra:"cbaLabel",name:"tipoProvenienzaUtenteSdo",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.TipoProvenienza")},{xtype:"combobox",itemId:"idTipoRicovero",reference:"idTipoRicovero",width:345,labelWidth:80,labelAlign:"top",margin:0,labelClsExtra:"cbaLabel",fieldLabel:"TIPO_RICOVERO",name:"tipoRicovero",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.TipoRicovero")},
{xtype:"combobox",itemId:"OnereDegenza",reference:"OnereDegenza",width:345,labelWidth:80,labelAlign:"top",margin:0,labelClsExtra:"cbaLabel",fieldLabel:"ONERE_DEGENZA",name:"onereDegenza",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.OnereDegenza")},{xtype:"combobox",itemId:"ClassePriorita",reference:"ClassePriorita",fieldLabel:"FR_CLASSEDIPRIORITA",width:345,labelWidth:80,labelAlign:"top",margin:0,labelClsExtra:"cbaLabel",
name:"classePrioritaria",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.ClassePriorita")},{xtype:"combobox",itemId:"classeAsa",reference:"classeAsa",width:345,labelWidth:80,labelAlign:"top",margin:0,labelClsExtra:"cbaLabel",fieldLabel:"FR_CLASSEASA",name:"classeAsa",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:this.storeClasseAsa}]},{xtype:"container",flex:1,margin:"0 0 0 5",layout:"vbox",items:[{xtype:"textfield",
itemId:"DiagnosiIngresssoTxt",reference:"DiagnosiIngresssoTxt",width:345,labelWidth:80,labelAlign:"top",margin:0,fieldLabel:"DIAGNOSI_INGRESSO",labelClsExtra:"cbaLabel",name:"diagnosiIngresso",readOnly:!0,nonDisabilitare:!0},Ext.create("GeneraliOSP.icd9.view.icd9",{itemId:"CntIdc9",labelAlignIcd9:"top",reference:"CntIdc9",hidden:!0,widthLabelIcd9:100}),{xtype:"combobox",itemId:"RegimeRicovero",reference:"RegimeRicovero",width:345,labelWidth:80,labelAlign:"top",margin:0,fieldLabel:"FR_REGIME",labelClsExtra:"cbaLabel",
name:"regimeRicovero",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.RegimeRicovero"),valueField:"codice"},{xtype:"container",layout:"hbox",items:[{xtype:"combobox",itemId:"IdMotivoIngresso",reference:"IdMotivoIngresso",labelWidth:80,width:285,margin:0,labelAlign:"top",labelClsExtra:"cbaLabel",fieldLabel:"MOTIVAZIONE_INGRESSO",name:"motivoIngresso",hidden:!1,queryMode:"local",valueField:"codice",displayField:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.MotivoIngresso")},
{xtype:"numberfield",allowDecimals:!1,width:60,margin:"0 0 0 5",labelClsExtra:"cbaLabel",labelAlign:"top",fieldLabel:"FR_NUM_ACCESSI",name:"numAccessi"}]},{xtype:"container",layout:"hbox",items:[{xtype:"combobox",itemId:"TipoRicRiabilitazione",reference:"TipoRicRiabilitazione",width:285,labelWidth:80,margin:0,fieldLabel:"FR_TIPORICOVERO_RIABILITAZIONE",labelClsExtra:"cbaLabel",labelAlign:"top",margin:0,name:"tipoRicRiab",displayField:"valore",queryMode:"local",store:this.storeTipoRicovRiab,valueField:"codice"},
{xtype:"numberfield",allowDecimals:!1,readOnly:!0,margin:"0 0 0 5",width:60,labelAlign:"top",labelClsExtra:"cbaLabel",fieldLabel:"PROGNOSI",name:"ggPrognosi"}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.ListaAttesa",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",itemId:"Container",reference:"Container",trackResetOnLoad:!0,layout:{type:"vbox",align:"stretch"},items:[{layout:{type:"hbox",align:"stretch"},height:130,items:[{xtype:"gridpanel",itemId:"gridDomandeLA",reference:"gridDomandeLA",store:Ext.create("LA.store.Richiesta"),trackResetOnLoad:!0,flex:1,title:"ELENCO_RICHIESTE",viewConfig:{loadMask:!1},
columns:[{xtype:"datecolumn",dataIndex:"data",align:"center",text:"DATA_RICHIESTA",format:"d/m/Y"},{xtype:"gridcolumn",text:"SERVIZI",flex:1,dataIndex:"serviziDescr"}]},{xtype:"container",itemId:"CntRichiesta",reference:"CntRichiesta",layout:{type:"vbox",align:"middle",pack:"center"},padding:3,items:[{xtype:"panel",itemId:"boxBottoni",reference:"boxBottoni"},{xtype:"fieldset",title:"RICHIESTA",layout:{type:"hbox",align:"end",pack:"center"},margin:"5 0 0 0",defaults:{padding:3},items:[{xtype:"textfield",
name:"id",hidden:!0},{xtype:"textfield",name:"appo",itemId:"appo",reference:"appo",hidden:!0},{xtype:"textfield",hidden:!0,itemId:"CBServizio",reference:"CBServizio",name:"idRicovero"},{xtype:"datefield",itemId:"Data",reference:"Data",fieldLabel:"DATA_RICHIESTA_RICOVERO",labelClsExtra:"cbaLabel",labelAlign:"top",allowBlank:!1,name:"data",format:"d/m/Y",width:150},{xtype:"datefield",itemId:"DataRicezione",reference:"DataRicezione",fieldLabel:"DATA_RICEZIONE_RICHIESTA",labelClsExtra:"cbaLabel",labelAlign:"top",
allowBlank:!1,name:"dataRicezioneRichiesta",format:"d/m/Y",width:100,margin:"2 45 0 45"},{xtype:"container",margin:"-6 0 0 0",layout:{type:"vbox"},items:[{xtype:"label",itemId:"labelNumProt",reference:"labelNumProt",baseCls:"cbaLabel",margin:"0 0 0 00",text:traduci("NUM_PROTOCOLLO")+":"},{xtype:"container",margin:"5 0 5 0",layout:{type:"hbox",align:"stretch"},items:[{xtype:"label",itemId:"prefNumProt",reference:"prefNumProt",margin:"3 0 0 0",labelClsExtra:"cbaLabel"},{xtype:"textfield",itemId:"numProt",
reference:"numProt",width:150,labelClsExtra:"cbaLabel",name:"numProt",fieldStyle:"text-align:center",maxLength:20,enforceMaxLength:!0},{xtype:"label",itemId:"suffNumProt",reference:"suffNumProt",margin:"3 0 0 0",labelClsExtra:"cbaLabel"}]}]}]}]}]},{xtype:"tabpanel",flex:1,border:0,itemId:"tbRegole",reference:"tbRegole",items:[{title:"PRESA_IN_CARICO",itemId:"pageRegole",reference:"pageRegole",border:0,layout:{type:"vbox",align:"stretch"},padding:3,items:[Ext.create("GeneraliOSP.portlet.view.ListaAttesa_presa_in_carico",
{listaAttesa:this}),Ext.create("GeneraliOSP.portlet.view.ListaAttesa_dati_agg",{listaAttesa:this}),Ext.create("GeneraliOSP.portlet.view.ListaAttesa_servizi",{flex:1,listaAttesa:this})]},{title:"PUNTEGGI_LA",itemId:"pagePunteggi",reference:"pagePunteggi",layout:"fit"},{title:"NOTE",layout:"fit",items:[Ext.create("GeneraliOSP.portlet.view.ListaAttesa_note",{listaAttesa:this})]},{title:"DICHIARAZIONI",hidden:!0}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.ListaAttesa_dati_agg",{extend:"Ext.form.FieldSet",title:"DATI_AGGIUNTIVI",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox"},defaults:{labelWidth:150},items:[{xtype:"combobox",itemId:"CBInfoAgg",reference:"CBInfoAgg",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"INFO_AGG",name:"infoAgg",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Info")},
{xtype:"checkboxfield",itemId:"ChkIndAccompagnamento",reference:"ChkIndAccompagnamento",cls:"cbaLabel",name:"indAccompagnamento",boxLabel:"IND_ACCOMPAGNAMENTO",inputValue:"T",uncheckedValue:"F"}]},{xtype:"container",layout:{type:"vbox"},defaults:{labelWidth:100},margin:"0 10 0 10",items:[{xtype:"numberfield",allowDecimals:!1,fieldLabel:"PERC_INVALIDITA",itemId:"percInvalidita",reference:"percInvalidita",minValue:0,maxValue:100,name:"percInvalidita",labelClsExtra:"cbaLabel"},{xtype:"combobox",itemId:"classe",
reference:"classe",fieldLabel:"CLASSE_SOSIA",labelClsExtra:"cbaLabel",name:"classe",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.ClasseSosia")}]},{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},defaults:{labelWidth:200},items:[{xtype:"combobox",itemId:"CBSituazDom",reference:"CBSituazDom",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"SITUAZIONE_DOMICILIO",name:"situazDomicilio",displayField:"valore",queryMode:"local",valueField:"codice",
store:Ext.create("LA.regole.store.Info")},{xtype:"combobox",itemId:"CBSituazRil",reference:"CBSituazRil",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"SITUAZIONE_RILEVAZIONE",name:"situazRilevazione",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Info")}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.ListaAttesa_note",{extend:"Ext.container.Container",layout:{type:"hbox",align:"stretch"},defaults:{padding:10},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"htmleditor",border:0,labelAlign:"top",flex:1,labelClsExtra:"cbaLabel",fieldLabel:"NOTE",name:"note",itemId:"note",reference:"note"},{xtype:"htmleditor",border:0,labelAlign:"top",flex:1,labelClsExtra:"cbaLabel",fieldLabel:"NOTE_REGIONALI",name:"noteRegionali",itemId:"noteRegionali",reference:"noteRegionali"}]});
this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.ListaAttesa_presa_in_carico",{extend:"Ext.form.FieldSet",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},padding:3,defaults:{labelWidth:170},items:[{xtype:"combobox",itemId:"CBComune",reference:"CBComune",labelClsExtra:"cbaLabel",allowBlank:!1,fieldLabel:"AREA_PRIORITARIA",name:"comune",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Comuni")},
{xtype:"combobox",itemId:"CBProvenienza",reference:"CBProvenienza",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"TIPO_PROVENIENZA",name:"codProvenienza",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Info")},{xtype:"combobox",itemId:"CBMotivazione",reference:"CBMotivazione",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"MOTIVAZIONE_INGRESSO",name:"motivazione",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Info")},
{xtype:"combobox",itemId:"CBIniziativaRichiesta",reference:"CBIniziativaRichiesta",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"INIZIATIVA_RICHIESTA",name:"iniziativaRichiesta",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Info")},{xtype:"combobox",itemId:"OnereDegenza",reference:"OnereDegenza",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"ONERE_DEGENZA",name:"onereDegenza",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Info")},
{xtype:"combobox",itemId:"CBTipoDom",reference:"CBTipoDom",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"TIPO_RICOVERO",name:"tipologia",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Info")},{xtype:"combobox",itemId:"RegimeRicovero",reference:"RegimeRicovero",labelClsExtra:"cbaLabel",allowBlank:!0,fieldLabel:"REGIME_RICOVERO",name:"regimeRicovero",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("LA.regole.store.Info")}]},
{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},padding:3,defaults:{labelWidth:170},items:[{xtype:"container",itemId:"PrognosiDimissione",reference:"PrognosiDimissione",margin:"0 0 5 0",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",itemId:"GiorniPrognosi",reference:"GiorniPrognosi",fieldLabel:"GIORNI_PROGNOSI",labelClsExtra:"cbaLabel",name:"ggPrognosi",minValue:0,allowDecimals:!1,labelWidth:170,width:220}]},{xtype:"textfield",itemId:"DiagnosiIngresso",reference:"DiagnosiIngresso",
maxLength:200,enforceMaxLength:!0,labelClsExtra:"cbaLabel",fieldLabel:"DIAGNOSI_INGRESSO",name:"diagnosiDescr"},Ext.create("GeneraliOSP.icd9.view.icd9",{itemId:"CntIdc9",reference:"CntIdc9",margin:"0 0 5 0",labelWidthIcd9:170,widthIcd9:250}),{xtype:"combobox",itemId:"MedicoInviante",reference:"MedicoInviante",fieldLabel:"MEDICO_INVIANTE",labelClsExtra:"cbaLabel",name:"medicoInviante",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"container",margin:"0 0 5 0",
layout:{type:"hbox",align:"middle"},items:[{xtype:"combobox",itemId:"MedicoMedGen",reference:"MedicoMedGen",flex:1,labelWidth:170,fieldLabel:"MEDICO_MEDICINA_GEN",labelClsExtra:"cbaLabel",name:"idMedicoMMG",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"button",margin:"0 0 0 3",itemId:"BtnMedico",reference:"BtnMedico",iconCls:"icon-doctor20",width:25,tooltip:"TT_MEDICO_MEDICINA_GEN"}]},{xtype:"combobox",itemId:"MedicoAccettante",reference:"MedicoAccettante",
fieldLabel:"MEDICO_ACCETTANTE",labelClsExtra:"cbaLabel",name:"medicoAccettante",displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.ListaAttesa_servizi",{extend:"Ext.container.Container",layout:{type:"fit"},initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"gridpanel",itemId:"gridDomandeLAServ",reference:"gridDomandeLAServ",multiSelect:!0,store:Ext.create("LA.store.RichiestaServ"),columns:[{xtype:"gridcolumn",flex:1,dataIndex:"desServizio",align:"left",text:"SERVIZI"},{xtype:"datecolumn",format:"d/m/Y",width:98,dataIndex:"dataAccessoPrevisto",text:"DATA_ACCESSO_PREVISTO",align:"center",
editor:{xtype:"datefield"}},{xtype:"datecolumn",format:"d/m/Y",width:75,dataIndex:"dataPrognosi",text:"DATA_SCADENZA",align:"center"},{xtype:"numbercolumn",width:70,dataIndex:"puntAuto",text:"PUNTEGGIO_AUTO",align:"center",renderer:function(b,d,f){return 0!=f.get("selezionato")?b:""}},{xtype:"numbercolumn",width:70,dataIndex:"puntManu",text:"PUNTEGGIO_MANUALE",editor:{xtype:"numberfield"},align:"center",renderer:cell_renderer_importo},{xtype:"numbercolumn",width:70,dataIndex:"puntTot",text:"PUNTEGGIO_TOTALE",
align:"center",renderer:function(b,d,f){return 0!=f.get("selezionato")?b:""}},{xtype:"gridcolumn",itemId:"ColStato",reference:"ColStato",dataIndex:"statoDom",text:"STATO_DOMANDA",width:98,editor:{xtype:"combobox",hideLabel:!0,displayField:"valore",queryMode:"local",typeAhead:!0,valueField:"codice"},renderer:function(c,d,f,g,h,k,l){d=f.get("selezionato");return(c=trovaRecord(b.listaAttesa.controller.storeStatoInfo,"codice",c))&&d?c.get("valore"):""}},{xtype:"datecolumn",format:"d/m/Y",width:75,dataIndex:"dataAcc",
text:"DATA_CHIUSURA",allowBlank:!0,align:"center",editor:{xtype:"datefield"}},{xtype:"actioncolumn",name:"sedi_rep",dataIndex:"sedi_rep",width:75,text:"SEDI_REP",align:"center",hidden:!0,renderer:function(b,d,f){f.data.selezionato&&(d.tdCls=null==f.data.dataAcc&&null!=f.data.infoStato?"icon-inserisci":"icon-ricerca16");return b},items:[{handler:function(c,d,f){d=c.getStore().getAt(d);c="T"==c.up().cbaConfig.personLa.abilitaLetti;(f=d.data.dataAccessoPrevisto)&&f.setHours(9,0,0,0);d.data.selezionato&&
0==d.dirty&&Ext.create("winCBA",{permesso:b.listaAttesa.cbaConfig.permesso,name:"GeneraliOSP.portlet.view.OSP_Residenziale",titolo:traduci("RESIDENZE_PRENOTATE"),dimensione:8,configItem:{recRicovero:b.listaAttesa.cbaConfig.recRicovero,titolo:"EditResidenza",recServizioLA:d,dataDalNuovo:f?f:null,cartella:49===CBA.moduli.moduloAttivo?!0:!1,abilitaLetti:c}}).show()}}]}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0}),plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],
listeners:{validateedit:function(c,d){var f=[];d.originalValues.puntManu!=d.newValues.puntManu&&0<b.listaAttesa.controller.ggVMax&&d.newValues.puntManu>b.listaAttesa.controller.ggVMax&&msgAddError(f,traduci("QTIP_ERROR_GG_MAX"));return msgShow("",f)}}}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.OSP_Residenziale",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=49===CBA.moduli.moduloAttivo,c=50==CBA.moduli.moduloAttivo||48==CBA.moduli.moduloAttivo&&!this.cbaConfig.abilitaLetti;Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"EditResidenza",reference:"EditResidenza",layout:{type:"border"},bodyPadding:"",title:"",items:[{xtype:"panel",itemId:"Container",reference:"Container",region:"west",width:210,layout:{type:"accordion"},
items:[{xtype:"panel",itemId:"CntUtenti",reference:"CntUtenti",layout:{type:"fit"},title:"UTENTI",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridResidenza",reference:"StoricoGridResidenza",title:"",store:Ext.create("GeneraliOSP.portlet.store.Residenziale"),viewConfig:{getRowClass:function(b,c,g,h){if(b.get("dataAl"))return"non_attivi"},loadMask:!1},columns:[{xtype:"datecolumn",width:80,dataIndex:"dataDal",text:"RES_INIZIO_UTILIZZO",flex:1,format:"d/m/Y",hidden:48==CBA.moduli.moduloAttivo,renderer:function(b,
c,g,h,k,l,n){return"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>"+(FormattaData(b,c.column.format)+(g.get("dataAl")?" - "+FormattaData(g.get("dataAl"),c.column.format):""))+"</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t"}},{xtype:"gridcolumn",width:80,dataIndex:"desReparto",text:"REP_STANZA",flex:1,hidden:48!=CBA.moduli.moduloAttivo}],selModel:Ext.create("Ext.selection.RowModel",{})}]}]},{xtype:"panel",bodyPadding:4,region:"center",itemId:"CntEditResidenza",
reference:"CntEditResidenza",layout:{type:"vbox",align:"stretch"},flex:1,border:b?0:null,items:[{xtype:"form",autoScroll:!0,flex:1,border:0,itemId:"EditResidenzaForm",reference:"EditResidenzaForm",layout:{type:"vbox"},bodyPadding:10,title:"",cls:b?"css-form-label-blue":null,margin:b?"20 0 0 0":null,trackResetOnLoad:!0,items:[{xtype:"combobox",itemId:"EditIdAccompagnatore",reference:"EditIdAccompagnatore",width:400,fieldLabel:"ACCOMPAGNATORE",labelClsExtra:"cbaLabel",name:"idRiferimento",displayField:"valore",
minChars:3,queryMode:"local",queryParam:"valore",hidden:!0,store:Ext.create("GeneraliOSP.portlet.store.CRM_Nominativi",{sorters:[{property:"valore",transform:function(b){return null==b?b:b.toLowerCase()}}]}),valueField:"codice"},{xtype:"container",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"editResDataDal",reference:"editResDataDal",width:210,fieldLabel:"RES_INIZIO_UTILIZZO",labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:48==CBA.moduli.moduloAttivo&&!this.cbaConfig.abilitaLetti,
hidden:48==CBA.moduli.moduloAttivo&&!this.cbaConfig.abilitaLetti},{xtype:"timefield",margin:"0 0 0 10",itemId:"editResOraDal",reference:"editResOraDal",width:140,fieldLabel:"ORA_INIZIO",labelClsExtra:"cbaLabel",labelWidth:80,name:"oraDal",value:"08:00",format:"H:i",increment:30,hidden:!0}]},{xtype:"container",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"datefield",readOnly:!0,cls:"x-item-disabled",itemId:"editResDataAl",reference:"editResDataAl",width:210,fieldLabel:"DATA_FINE",labelClsExtra:"cbaLabel",
name:"dataAl",hidden:48==CBA.moduli.moduloAttivo&&!this.cbaConfig.abilitaLetti},{xtype:"timefield",margin:"0 0 0 10",readOnly:!0,cls:"x-item-disabled",itemId:"editResOraAl",reference:"editResOraAl",width:140,fieldLabel:"ORA_FINE",labelClsExtra:"cbaLabel",labelWidth:80,name:"oraAl",format:"H:i",increment:30,hidden:!0}]},{xtype:"combobox",itemId:"editResSede",reference:"editResSede",width:400,fieldLabel:"SEDE",labelClsExtra:"cbaLabel",name:"idSede",allowBlank:!1,displayField:"valore",queryMode:"local",
store:Ext.create("GeneraliOSP.cercaFascicolo.store.Sedi"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",itemId:"editResReparto",reference:"editResReparto",width:400,fieldLabel:"REPARTO",labelClsExtra:"cbaLabel",name:"idReparto",allowBlank:!1,displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Reparti"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"combobox",itemId:"editResStanza",
reference:"editResStanza",width:400,fieldLabel:"STANZA",labelClsExtra:"cbaLabel",name:"idStanza",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Stanze"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"container",margin:"0 0 5 0",width:500,hidden:c,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"editResLetto",reference:"editResLetto",width:200,fieldLabel:"LETTO",
labelClsExtra:"cbaLabel",name:"idLetto",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Letti"),valueField:"codice",matchFieldWidth:!1,listConfig:{width:300},hidden:c,listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"StanzaUsoSingolo",reference:"StanzaUsoSingolo",margin:"0 0 0 55",name:"usoSingolo",fieldLabel:"STANZA_USO_SINGOLO",labelClsExtra:"cbaLabel",labelWidth:115,inputValue:"T",uncheckedValue:"F"},
{xtype:"button",cls:"cba-stdbutton-25",itemId:"btnCopiaUbicazione",reference:"btnCopiaUbicazione",iconCls:"icon-copia",text:"BTN_COPIA_UBICAZIONE",tooltip:"BTN_COPIA_UBICAZIONE_TT",hidden:!0,margin:"0 0 0 30"},{xtype:"button",cls:b?"cbaCssBtnFunzione":"cba-button-25",itemId:"btnLettiLiberi",reference:"btnLettiLiberi",width:100,iconCls:"icon-lettiLiberi",text:"LETTI_LIBERI",hidden:c}]},{xtype:"container",hidden:!0,itemId:"CntCss",reference:"CntCss",items:[]},{xtype:"htmleditor",flex:1,itemId:"editResNote",
reference:"editResNote",fieldLabel:"NOTE",labelAlign:"top",labelClsExtra:"cbaLabel",name:"note",width:530,hidden:48==CBA.moduli.moduloAttivo&&!this.cbaConfig.abilitaLetti},{xtype:"textfield",itemId:"RecordId",reference:"RecordId",name:"id",hidden:!0},{xtype:"textfield",itemId:"EdtIdRicovero",reference:"EdtIdRicovero",name:"idRicovero",hidden:!0},{xtype:"textfield",itemId:"EdtTipoRecord",reference:"EdtTipoRecord",name:"tipoRecord",hidden:!0},{xtype:"textfield",itemId:"EdtStato",reference:"EdtStato",
name:"stato",hidden:!0},{xtype:"textfield",itemId:"EdtIdOpDomanda",reference:"EdtIdOpDomanda",name:"idOpDomanda",hidden:!0},{xtype:"textfield",itemId:"EdtDataOraDomanda",reference:"EdtDataOraDomanda",name:"dataOraDomanda",hidden:!0},{xtype:"textfield",itemId:"EdtIdOpRisposta",reference:"EdtIdOpRisposta",name:"idOpRisposta",hidden:!0},{xtype:"textfield",itemId:"EdtDataOraRisposta",reference:"EdtDataOraRisposta",name:"dataOraRisposta",hidden:!0},{xtype:"textfield",itemId:"EdtIdServizioDomanda",reference:"EdtIdServizioDomanda",
name:"idServizioDomanda",hidden:!0}]}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,margin:b?"2 8 0 0":null,title:""}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.Pensioni",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"EditPensioni",reference:"EditPensioni",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",flex:1,region:"center",border:0,itemId:"EditPensioniForm",reference:"EditPensioniForm",layout:{type:"vbox"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"combobox",itemId:"pensioneTipo",reference:"pensioneTipo",width:400,fieldLabel:traduci("PENS_TIPO"),
labelClsExtra:"cbaLabel",name:"tipoPensione",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"datefield",itemId:"pensioneData",reference:"pensioneData",width:210,fieldLabel:traduci("PENS_DATA_RILASCIO"),labelClsExtra:"cbaLabel",name:"dataRilascio",allowBlank:!1},{xtype:"datefield",itemId:"pensioneDataFine",reference:"pensioneDataFine",width:210,fieldLabel:traduci("PENS_DATA_FINE"),labelClsExtra:"cbaLabel",name:"dataFine"},{xtype:"textfield",itemId:"pensioneNumero",
reference:"pensioneNumero",width:300,fieldLabel:traduci("PENS_NUMERO"),labelClsExtra:"cbaLabel",name:"numeroPensione",allowBlank:!1},{xtype:"combobox",itemId:"pensionePagante",reference:"pensionePagante",width:400,fieldLabel:traduci("PAGANTE"),labelClsExtra:"cbaLabel",name:"pagante",allowBlank:!1,displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"fieldset",width:400,defaults:{margin:{top:0,right:10,bottom:0,left:0}},layout:{type:"hbox"},title:traduci("PENS_QUOTA_UTENTE"),items:[{xtype:"combobox",
itemId:"pensioneTipoQuota",reference:"pensioneTipoQuota",width:150,labelWidth:94,fieldLabel:traduci("PENS_TIPO_QUOTA"),labelClsExtra:"cbaLabel",name:"tipoQuota",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",valueField:"codice"},{xtype:"numberfield",itemId:"pensioneQuota",reference:"pensioneQuota",width:180,margin:"4 0 0 0",fieldLabel:traduci("PENS_QUOTA_UTENTE"),labelClsExtra:"cbaLabel",name:"quota",allowBlank:!1,minValue:0}]},{xtype:"textfield",itemId:"pensioneDelegato",
reference:"pensioneDelegato",width:400,fieldLabel:traduci("PENS_DELEGATO_INCASSO"),labelClsExtra:"cbaLabel",name:"delegatoIncasso"},{xtype:"combobox",itemId:"pensioneCassa",reference:"pensioneCassa",width:400,fieldLabel:traduci("CASSA_DENARO"),labelClsExtra:"cbaLabel",name:"idCassa",editable:!1,displayField:"descrizione",queryMode:"local",valueField:"id"},{xtype:"htmleditor",itemId:"pensioneNote",reference:"pensioneNote",fieldLabel:traduci("NOTE"),labelAlign:"top",labelClsExtra:"cbaLabel",name:"note",
width:440,flex:1},{xtype:"textfield",hidden:!0,fieldLabel:"id",name:"id"},{xtype:"textfield",hidden:!0,itemId:"EditPensioniRecordId",reference:"EditPensioniRecordId",fieldLabel:"id",name:"idPensione"}]},{xtype:"panel",region:"west",width:270,layout:{type:"fit"},title:traduci("PENS_ELENCO"),itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridPensioni",reference:"StoricoGridPensioni",title:"",store:Ext.create("GeneraliOSP.portlet.store.Pensioni"),viewConfig:{getRowClass:function(b,
c,d,f){if(b.data.dataFine&&new Date(b.data.dataFine)<=new Date)return"non_attivi"},itemId:"GW_EditPensioni",reference:"GW_EditPensioni",loadMask:!1},columns:[{xtype:"gridcolumn",width:90,dataIndex:"desPensione",text:traduci("PENS_TIPO"),flex:1},{xtype:"datecolumn",width:90,dataIndex:"dataRilascio",text:traduci("PENS_DATA_RILASCIO"),flex:1,format:"d/m/Y"},{xtype:"datecolumn",width:90,dataIndex:"dataFine",text:traduci("PENS_DATA_FINE"),flex:1,format:"d/m/Y"}],selModel:Ext.create("Ext.selection.RowModel",
{})}]},{xtype:"panel",region:"east",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:"",bodyPadding:"5 0 0 0"}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletCMAttivitaUtente",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"Container",reference:"Container",border:0,items:[{xtype:"panel",itemId:"CntDatiAssistenziali",reference:"CntDatiAssistenziali",height:85,layout:{type:"fit"},region:"south",border:0,bodyBorder:!1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletCMBisogniPrimari",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"Container",reference:"Container",border:0,items:[{xtype:"panel",itemId:"CntDatiAssistenziali",reference:"CntDatiAssistenziali",height:85,layout:{type:"fit"},region:"south",border:0,bodyBorder:!1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletClassificazioni",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"portletEditClassificazioni",reference:"portletEditClassificazioni",layout:{align:"stretch",type:"vbox"},title:"",defaults:{margin:0,readOnlyCls:"",disabledCls:""},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",flex:.4,border:0,itemId:"Container",reference:"Container",title:"",layout:"fit"},{xtype:"container",itemId:"portletEditClassificazioniCenter",reference:"portletEditClassificazioniCenter",
margin:"0 0 0 5",border:0,layout:{align:"stretch",type:"hbox"},items:[{xtype:"container",layout:{align:"stretch",type:"vbox"},title:"",items:[{xtype:"label",itemId:"classRegionale",reference:"classRegionale",text:"labelRegionale"},{xtype:"label",itemId:"classInterna",reference:"classInterna",text:"labelInterna"}]}]},{xtype:"panel",itemId:"PnlScontiSupplementi",reference:"PnlScontiSupplementi",flex:.5,listeners:{afterrender:function(b){creaToolTip(b.getId(),"MSG_DBLCLICK_PORTLET","",!1,150)}},border:0,
layout:{align:"stretch",type:"fit"},title:"",items:[{xtype:"gridpanel",itemId:"GW_GrigliaPrestazioni",reference:"GW_GrigliaPrestazioni",store:Ext.create("GeneraliOSP.portlet.store.ExtraImporti"),columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.tdCls="S"==d.data.tipo?"icon-piu":"icon-meno"},width:28},{xtype:"gridcolumn",width:1196,dataIndex:"descrizione",text:"SCONTI_DESCRIZIONE",flex:1,renderer:function(b,c,d,f,g,h,k){"T"==d.get("statoRisposta")&&(c.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");
return b}},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){"A"==d.get("fattoreMoltiplicazione")&&(b=b+" "+d.get("giorniMoltiplicazione"));return b},dataIndex:"desFattoreMoltiplicazione",text:"SCONTI_FATTMOLT_QTA",flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formattaImporto(b,d.data.tipoImporto)},width:60,dataIndex:"quotaSanitariaFatt",text:"Q_SAN",flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";
return formattaImporto(b,d.data.tipoImporto)},width:60,dataIndex:"quotaSocialeFatt",text:"Q_SOC",flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){if(b)return c.style="text-align:right !important",formatFloat(b)+decodeTipoQuota(d.data.tipoImporto)},width:70,dataIndex:"totaleFatt",text:"Totale",flex:1}],viewConfig:{loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",frame:!1,layout:{pack:"center",type:"hbox"},items:[{xtype:"label",cls:"titoloGriglia",text:"SCONTI/SUPPLEMENTI"}]}]}],dockedItems:[{xtype:"button",
dock:"bottom",cls:"cba-stdbutton-25",hidden:!0,itemId:"BtnCauzioni",reference:"BtnCauzioni",width:150,iconCls:"icon-assenze",text:"CU_CAUZIONI",tooltip:"RES_GESTIONE_CAUZIONI_TT"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletClassificazioniAmb",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridRetteAmb",reference:"GridRetteAmb",store:Ext.create("GeneraliOSP.portlet.store.CDIDettaglio",{proxy:{urlGen:"/ws/genOsp/amb/prest/list"}}),border:this.cbaConfig.fromRilevazioniCdi?1:0,scrollable:!0,columns:[{xtype:"datecolumn",width:71,align:"center",dataIndex:"dataDecorrenza",text:"DATA",format:"d/m/Y"},{xtype:"gridcolumn",
dataIndex:"desPrestazione",text:"PRESTAZIONE",flex:1,align:"center",renderer:function(b,c,d,f,g,h,k){c.style="text-align:left !important";return b}},{xtype:"gridcolumn",width:55,align:"center",dataIndex:"quantita",text:"QUANTITA",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",width:140,align:"center",dataIndex:"pianificato",sortable:!1,text:"A_CALENDARIO",renderer:function(b,c,d,f,g,h,k){c.style="word-wrap: break-word";return StdUtenti.renderRilevatoCalendario(d.get("pianificato"),
d.get("erogato"),d.get("nonErogato"))},listeners:{afterrender:function(b){StdUtenti.createTooltipRilevatoCalendario(b)}}},{xtype:"gridcolumn",width:55,align:"center",dataIndex:"residuo",sortable:!1,text:"RESIDUO",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";c=formatFloat(b);return 0<=b?c:'<b><span style="color:red">'+c+"</span></b>"}}],viewConfig:{getRowClass:function(b,c,d,f){if(8==b.get("statoImpegnativa")||9==b.get("statoImpegnativa"))return"cba-deleted-record-clean"},
loadMask:!1}}]});this.callParent(arguments)}});Ext.define("GeneraliOSP.portlet.view.PortletClassificazioniRes",{extend:"Generali.standard.ControlledContainer",border:0,height:160,itemId:"portletEditClassificazioniRes",reference:"portletEditClassificazioniRes",padding:5,layout:{type:"absolute"},title:"",defaults:{margin:0,readOnlyCls:"",disabledCls:""},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"label",itemId:"tableRetta",reference:"tableRetta",text:"tableRetta"}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletClassificazioniSemiRes",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"gridpanel",itemId:"GridRetteSemiRed",reference:"GridRetteSemiRed",store:Ext.create("GeneraliOSP.portlet.store.CDIPlanWeek",{autoLoad:!1}),border:0,scrollable:!0,columns:[{xtype:"gridcolumn",dataIndex:"desPrestazione",text:"PRESTAZIONE",flex:1,renderer:function(b,d,f,g,h,k,l){"T"==f.get("statoRisposta")&&(d.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");
return b}},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){b.controller.renderGG(1,c,d)},width:25,align:"center",dataIndex:"lun",text:"LU"},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){b.controller.renderGG(2,c,d)},width:25,align:"center",dataIndex:"mar",text:"MA"},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){b.controller.renderGG(3,c,d)},width:25,align:"center",dataIndex:"mer",text:"ME"},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){b.controller.renderGG(4,c,d)},width:25,
align:"center",dataIndex:"gio",text:"GI"},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){b.controller.renderGG(5,c,d)},width:25,align:"center",dataIndex:"ven",text:"VE"},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){b.controller.renderGG(6,c,d)},width:25,align:"center",dataIndex:"sab",text:"SA"},{xtype:"gridcolumn",renderer:function(c,d,f,g,h,k,l){b.controller.renderGG(7,c,d)},width:25,align:"center",dataIndex:"dom",text:"DO"}],viewConfig:{loadMask:!1}}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletContatti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"Container",reference:"Container",store:Ext.create("GeneraliOSP.portlet.store.CRM"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"data",text:"CRM_DATA_ORA",format:"d/m/Y H:i"},{xtype:"gridcolumn",dataIndex:"nominativo",text:"CRM_NOMINATIVO",flex:1},{xtype:"gridcolumn",dataIndex:"oggetto",text:"Oggetto",
flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){"1"==d.data.stato?c.tdCls="icon-angry":"2"==d.data.stato?c.tdCls="icon-stright":"3"==d.data.stato&&(c.tdCls="icon-smile")},width:45,dataIndex:"stato",text:"CRM_STATO"}],selModel:Ext.create("Ext.selection.RowModel",{})}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletDocumenti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",border:0,itemId:"Container",reference:"Container",store:Ext.create("GeneraliOSP.portlet.store.Documenti"),viewConfig:{getRowClass:function(b,c,d,f){if(b.data.dataScadenza&&b.data.dataScadenza<new Date)return"non_attivi"},itemId:"GW_portletEditDocumenti",reference:"GW_portletEditDocumenti",loadMask:!1},columns:[{xtype:"gridcolumn",
dataIndex:"desTipoDocumento",text:"TIPO_DOCUMENTO",flex:1,renderer:function(b,c,d,f,g,h,k){return 1==d.data.ticket&&d.data.desTipoEsenzione?d.data.desTipoDocumento+" ("+d.data.desTipoEsenzione+")":d.data.desTipoDocumento}},{xtype:"datecolumn",width:90,dataIndex:"dataEmissione",text:"DOC_DATA_DAL",format:"d/m/Y"},{xtype:"datecolumn",width:85,dataIndex:"dataScadenza",text:"DOC_DATA_AL",format:"d/m/Y"},{xtype:"gridcolumn",align:"center",width:125,dataIndex:"numeroTessera",text:"DOC_NUM_TESSERA",renderer:function(b,
c,d){b=d.get("numero");d=d.get("numeroTessera");b=null==b?"":b.trim();d=null==d?"":d.trim();return b+(""!=b?"<br>":"")+d}},{xtype:"gridcolumn",align:"center",width:125,dataIndex:"descrizioneBreve",text:"DES_BREVE",renderer:function(b,c,d){c="";null!=d.get("descrizioneBreve")&&(c=b);return c}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletEstrattoConto",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"container",layout:{type:"hbox",pack:"end"},items:[{xtype:"displayfield",margin:"5 5 5 10",labelWidth:90,fieldLabel:"CU_CAUZIONI_SALDO",labelClsExtra:"cbaLabel",itemId:"LbCauzioneSaldo",reference:"LbCauzioneSaldo",hidden:!0},{xtype:"displayfield",margin:"5 5 5 10",labelWidth:130,fieldLabel:"CU_CAUZIONI_ALTRI",
labelClsExtra:"cbaLabel",itemId:"LbCauzioneAltra",reference:"LbCauzioneAltra",hidden:!0},{xtype:"displayfield",margin:"5 5 5 10",labelWidth:60,fieldLabel:"CU_CAUZIONI",labelClsExtra:"cbaLabel",itemId:"LbCauzione",reference:"LbCauzione",hidden:!0}]},{xtype:"gridpanel",flex:1,itemId:"Container",reference:"Container",store:Ext.create("GeneraliOSP.estrattoConto.store.Paganti"),viewConfig:{loadMask:!1},sortableColumns:!1,features:[{ftype:"summary"}],columns:[{xtype:"gridcolumn",dataIndex:"ragioneSociale",
text:"PAGANTE",flex:1,summaryRenderer:function(b,d,f){return'<div class="cbaGrassetto" style= "text-align: right">'+traduci("TOTALE")+"</div>"}},{xtype:"gridcolumn",width:80,dataIndex:"saldo",text:"SALDO",align:"right",summaryType:"sum",renderer:function(c,d,f){b.nessunAmm2=5==b.controller.personContabili.tipoContabilitaAbilitata;null==c&&(c=0);b.nessunAmm2&&(c*=-1);0<c&&(d.tdCls="labelErrore");return cell_renderer_importo(c,d)},summaryRenderer:function(c,d,f){b.nessunAmm2=5==b.controller.personContabili.tipoContabilitaAbilitata;
null==c&&(c=0);b.nessunAmm2&&(c*=-1);return'<div class="'+(0<=c?"cbaGrassetto labelErrore":"cbaGrassetto")+'" style= "text-align: right">'+Ext.util.Format.number(c,"0.00,")+"</div>"}}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletFAR",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"Container",reference:"Container",border:0,items:[{xtype:"panel",itemId:"CntDatiAssistenziali",reference:"CntDatiAssistenziali",height:85,layout:{type:"fit"},region:"south",border:0,bodyBorder:!1},{xtype:"panel",itemId:"CntBINA",reference:"CntBINA",height:128,layout:{type:"fit"},region:"south",border:0,bodyBorder:!1,header:{padding:3}}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletFARBina",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",itemId:"Container",reference:"Container",margin:5,border:0,layout:{align:"stretch",type:"vbox"},title:"",trackResetOnLoad:!0,items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",layout:{type:"vbox"},margin:"-5 0 0 0",flex:.6,items:[{xtype:"displayfield",fieldLabel:"FAR_DATA_VALUTAZIONE",
labelClsExtra:"cbaLabelDati",name:"dataValutazione",width:220},{xtype:"displayfield",fieldLabel:"FAR_PUNTEGGIO",labelClsExtra:"cbaLabelDati",name:"desPunteggio",margin:"-10 0 0 0",width:220}]},{xtype:"container",layout:{type:"vbox"},margin:"-5 0 0 5",flex:.4,items:[{xtype:"displayfield",fieldLabel:"FAR_COMPILATORE",labelClsExtra:"cbaLabelDati",name:"compilatore"},{xtype:"displayfield",fieldLabel:"FAR_SCADENZA",labelClsExtra:"cbaLabelDati",name:"dataScadenza",margin:"-10 0 0 0",width:240},{xtype:"image",
itemId:"StatoBINA",reference:"StatoBINA",margin:"-5 0 0 0",height:20,width:20}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletFARDati",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",itemId:"Container",reference:"Container",margin:5,border:0,layout:{align:"stretch",type:"vbox"},title:"",trackResetOnLoad:!0,items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",layout:{type:"vbox"},flex:.6,items:[{xtype:"displayfield",fieldLabel:"FR_NUMERO_PRATICA",labelClsExtra:"cbaLabelDati",
name:"numPratica"},{xtype:"displayfield",fieldLabel:"FR_STRUTTURA",labelClsExtra:"cbaLabelDati",name:"desStruttura",margin:"-10 0 0 0"},{xtype:"displayfield",fieldLabel:"FAR_POS_CONTABILE",labelClsExtra:"cbaLabelDati",name:"desPosContabile",margin:"25 0 0 0"}]},{xtype:"container",layout:{type:"vbox"},margin:"0 0 0 5",flex:.4,items:[{xtype:"displayfield",fieldLabel:"FAR_DATA_INIZIO_PRATICA",labelClsExtra:"cbaLabelDati",name:"data_inizio"},{xtype:"displayfield",fieldLabel:"FAR_DATA_FINE_PRATICA",labelClsExtra:"cbaLabelDati",
name:"data_fine",margin:"-10 0 0 0"},{xtype:"label",text:"FAR_CARICO_FRNA",margin:"35 0 0 0"},{xtype:"hiddenfield",name:"aCaricoFRNA"},{xtype:"image",itemId:"StatoFRNA",reference:"StatoFRNA",height:20,width:20,margin:"0 0 0 25"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletFlussiRegionali",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",itemId:"Container",reference:"Container",margin:5,border:0,layout:{align:"stretch",type:"vbox"},title:"",trackResetOnLoad:!0,items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",layout:{type:"vbox"},flex:.5,items:[{xtype:"displayfield",fieldLabel:"FR_NUMERO_PRATICA",labelClsExtra:"cbaLabelDati",
name:"annoNumPratica"},{xtype:"displayfield",fieldLabel:"FR_STRUTTURA",labelClsExtra:"cbaLabelDati",name:"desStruttura",margin:"-10 0 0 0"},{xtype:"displayfield",fieldLabel:"FR_STATO_INVIO_PRATICA",labelClsExtra:"cbaLabelDati",name:"statoInvio",margin:"25 0 0 0",hidden:!0}]},{xtype:"container",layout:{type:"vbox"},margin:"0 0 0 5",flex:.6,items:[{xtype:"displayfield",fieldLabel:"FR_DATA_INIZIO_PRATICA",labelClsExtra:"cbaLabelDati",name:"dal"},{xtype:"displayfield",fieldLabel:"FR_DATA_FINE_PRATICA",
labelClsExtra:"cbaLabelDati",name:"al",margin:"-10 0 0 0"},{xtype:"displayfield",itemId:"MotChiusura",reference:"MotChiusura",fieldLabel:"MOTIVO_DIMISSIONE",labelClsExtra:"cbaLabelDati",name:"desMotChiusura",margin:"-5 0 0 0",hidden:!0},{xtype:"label",text:"FR_CARICO_FSR",margin:"35 0 0 0",hidden:!0},{xtype:"hiddenfield",name:"aCaricoFSR"},{xtype:"image",itemId:"StatoFSR",reference:"StatoFSR",height:20,width:20,margin:"0 0 0 25",hidden:!0}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletListaAttesa",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"Container",reference:"Container",store:Ext.create("LA.store.Lista"),viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"ordine",width:60,align:"center",text:"POSIZIONE"},{xtype:"datecolumn",dataIndex:"dataDom",format:"d/m/Y",width:70,align:"center",text:"DATA_RICHIESTA"},{xtype:"gridcolumn",dataIndex:"comune",
flex:1,text:"AREA_PRIORITARIA"},{xtype:"gridcolumn",dataIndex:"responsabileRicovero",flex:1,text:"RESPONSABILE_RICOVERO"},{xtype:"gridcolumn",dataIndex:"punt_Tot",width:60,text:"PUNTEGGIO_TOTALE",align:"center",renderer:cell_renderer_numero}],features:[{ftype:"grouping",groupHeaderTpl:["<div>{name:this.desServ}</div>",{desServ:function(b){return"Servizi: "+b}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletOSP_Residenziale",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",border:0,itemId:"Container",reference:"Container",padding:5,layout:{align:"stretch",type:"hbox"},trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"vbox"},flex:1,items:[{xtype:"textfield",hidden:!0,name:"id"},{xtype:"displayfield",fieldLabel:"RES_INIZIO_UTILIZZO",labelClsExtra:"cbaLabelDati",name:"dataDal"},{xtype:"displayfield",
fieldLabel:"SEDE",labelClsExtra:"cbaLabelDati",name:"desSede"},{xtype:"displayfield",fieldLabel:"REPARTO",labelClsExtra:"cbaLabelDati",name:"desReparto"},{xtype:"displayfield",fieldLabel:"STANZA",labelClsExtra:"cbaLabelDati",name:"desStanza"},{xtype:"displayfield",flex:1,fieldLabel:"LETTO",labelClsExtra:"cbaLabelDati",name:"desLetto",hidden:50==CBA.moduli.moduloAttivo}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"displayfield",fieldLabel:"ACCOMPAGNATORE",labelClsExtra:"cbaLabelDati",
name:"desAccompagnatore",itemId:"AbilitaAccompagnatore",reference:"AbilitaAccompagnatore",hidden:!0},{xtype:"container",flex:1},{xtype:"button",cls:"cba-stdbutton-25",itemId:"BtnGestioneAssenze",reference:"BtnGestioneAssenze",iconCls:"icon-assenze",text:"RES_GESTIONE_ASSENZE",tooltip:"RES_GESTIONE_ASSENZE_TT",nonDisabilitare:!0}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletPensioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"Container",reference:"Container",store:Ext.create("GeneraliOSP.portlet.store.Pensioni"),viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"desPensione",text:"PENS_TIPO",flex:1},{xtype:"datecolumn",width:85,dataIndex:"dataRilascio",text:"PENS_DATA_RILASCIO",format:"d/m/Y"},{xtype:"datecolumn",width:85,dataIndex:"dataFine",
text:"PENS_DATA_FINE",format:"d/m/Y"},{xtype:"gridcolumn",width:100,dataIndex:"numeroPensione",tdCls:"",text:"PENS_NUMERO",flex:1},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style="text-align:right !important";return formattaImporto(b,d.data.tipoQuota)},width:106,dataIndex:"quota",text:"PENS_QUOTA_UTENTE",flex:1}],selModel:Ext.create("Ext.selection.RowModel",{})}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletRAPBudget",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",border:0,itemId:"Container",reference:"Container",padding:5,defaults:{border:2},title:"",trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",layout:{type:"hbox"},defaults:{margin:{top:5,right:5,bottom:5,left:5}},items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"label",width:145,html:"<br />"},
{xtype:"displayfield",labelWidth:60,fieldLabel:"RAP_BDG",listeners:{afterrender:function(b){creaToolTipInfo(b,traduci("TOOLTIP_BUDGET"))}}},{xtype:"displayfield",fieldLabel:"RAP_BDG_PREVISTO",labelWidth:60,listeners:{afterrender:function(b){creaToolTipInfo(b,traduci("TOOLTIP_PREVISTO"))}}},{xtype:"displayfield",labelWidth:60,fieldLabel:"RAP_BDG_EFFETTIVO",listeners:{afterrender:function(b){creaToolTipInfo(b,traduci("TOOLTIP_EFFETTIVO"))}}}]},{xtype:"container",layout:{type:"vbox",align:"right"},items:[{xtype:"label",
width:100,html:traduci("RAP_STRUTTURA"),style:{opacity:"0.8",textAlign:"center"}},{xtype:"displayfield",name:"stanziatostruttura",style:{textAlign:"right"},renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"previstostruttura",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"effettivostruttura",renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",
width:100,html:traduci("UTENTE"),style:{opacity:"0.8",textAlign:"center"}},{xtype:"displayfield",padding:"0 30 0 0",name:"stanziatoutente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"previstoutente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"effettivoutente",renderer:function(b){return formatFloat(b,2,".")}}]}]}]},{xtype:"container",layout:{type:"hbox"},style:{borderTop:"1px solid #000000 !important"},padding:"5 0 0 5",items:[{xtype:"displayfield",
labelWidth:60,fieldLabel:"RESIDUO",listeners:{afterrender:function(b){creaToolTipInfo(b,traduci("TOOLTIP_RESIDUO"))}}},{xtype:"label",width:65,html:"<br />"},{xtype:"container",layout:{type:"vbox",align:"right"},margin:"0 0 0 5",width:100,items:[{xtype:"displayfield",itemId:"residuostruttura",reference:"residuostruttura",name:"residuostruttura",renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"displayfield",padding:"0 0 0 10",itemId:"Residuoutente",reference:"Residuoutente",width:170,name:"residuoutente",
style:{textAlign:"right"},renderer:function(b){return formatFloat(b,2,".")}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletRAPPai",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",border:0,itemId:"Container",reference:"Container",padding:5,title:"",autoScroll:!0,trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},defaults:{margin:"5 5 5 5"},items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",labelWidth:20,margin:"0 50 0 0",fieldLabel:"RAP_DAL",name:"dal",renderer:function(b,
c){return FormattaData(b)}},{xtype:"displayfield",labelWidth:15,margin:"0 50 0 0",fieldLabel:"RAP_AL",name:"al",renderer:function(b,c){return FormattaData(b)}},{xtype:"displayfield",labelWidth:55,fieldLabel:"FAR_SCADENZA",name:"scadenza",renderer:function(b,c){return FormattaData(b)}}]},{xtype:"gridpanel",border:0,itemId:"ElencoPrestazioni",reference:"ElencoPrestazioni",store:Ext.create("GeneraliOSP.portlet.store.RapPaiDE"),viewConfig:{loadMask:!1},columns:[{dataIndex:"desPrestazione",text:"PRESTAZIONI",
flex:5},{dataIndex:"qtaPrevista",text:"PENS_NUMERO",flex:1}],selModel:Ext.create("Ext.selection.RowModel",{})}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletRAPRequisiti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",border:0,itemId:"Container",reference:"Container",padding:5,defaults:{border:2},title:"",trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"container",layout:{type:"hbox"},defaults:{margin:{top:5,right:5,bottom:5,left:5}},items:[{xtype:"container",width:275,layout:{type:"vbox"},items:[{xtype:"displayfield",
labelWidth:125,fieldLabel:"RAP_DATE_ACCESSO",name:"dataDal",renderer:function(b,c){return FormattaData(b)}},{xtype:"displayfield",fieldLabel:"RAP_PERS_CONVIVENTI",labelWidth:109,name:"descrConvivenza"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",labelWidth:172,fieldLabel:traduci("RAP_USO_SERV_SOCIALI")+":"},{xtype:"image",itemId:"imgServSoc",reference:"imgServSoc",style:{opacity:"0.5",margin:"5px 0 0 0"},height:16,width:16,src:"/cba/generali/images/16/tree/unchecked.png"}]}]},
{xtype:"container",layout:{type:"vbox"},items:[{xtype:"displayfield",labelWidth:92,fieldLabel:"RAP_LIV_INVALIDITA",name:"descrLivInvalidita"},{xtype:"displayfield",labelWidth:130,fieldLabel:"RAP_CERTIF_DEMENZA",name:"certDemenzaData",renderer:function(b,c){return FormattaData(b)}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",labelWidth:163,fieldLabel:traduci("IND_ACCOMPAGNAMENTO")+":"},{xtype:"image",itemId:"imgIndennAcc",reference:"imgIndennAcc",style:{opacity:"0.5",margin:"5px 0 0 0"},
height:16,width:16,src:"/cba/generali/images/16/tree/unchecked.png"}]}]}]}]},{xtype:"container",layout:{type:"hbox"},style:{borderTop:"1px solid #000000 !important"},margin:"10 0 0 0",padding:"15 0 0 5",items:[{xtype:"displayfield",width:275,labelWidth:130,fieldLabel:"RAP_DATA_VERIFICA_PREREQUISITI",name:"requisitiData",renderer:function(b,c){return FormattaData(b)}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",margin:"0 5 0 10",labelWidth:110,fieldLabel:traduci("RAP_PREREQUISITI")+
":"},{xtype:"image",margin:"3 0 0 0",itemId:"imgEsitoPratica",reference:"imgEsitoPratica",height:20,width:20,src:"/cba/generali/images/svg/others/circle-gray.svg"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletRAPSospensioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"Container",reference:"Container",store:Ext.create("GeneraliOSP.portlet.store.Assenze"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"dataDal",text:"DATA_DAL",format:"d/m/Y H:i"},{xtype:"gridcolumn",dataIndex:"desMotivoUscita",text:"MOTIVI_USCITA_TEMP",flex:1},{xtype:"datecolumn",dataIndex:"dataAl",
text:"DATA_AL",format:"d/m/Y H:i"},{xtype:"gridcolumn",text:"RAP_TOT_GG_ASS",renderer:function(b,c,d,f,g,h,k){b=Math.abs((d.get("dataAl")?d.get("dataAl").getTime():(new Date).getTime())-d.get("dataDal").getTime());return Math.ceil(b/864E5)}}],selModel:Ext.create("Ext.selection.RowModel",{})}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletRAPVmd",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",border:0,itemId:"Container",reference:"Container",padding:5,defaults:{border:2},title:"",trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"hbox"},defaults:{margin:{top:5,right:5,bottom:5,left:5}},items:[{xtype:"container",width:275,flex:1,layout:{type:"vbox"},items:[{xtype:"displayfield",labelWidth:170,fieldLabel:traduci("FAR_DATA_VALUTAZIONE")+
"/"+traduci("RAP_INIZIO_PRATICA"),name:"data",renderer:function(b,c){return FormattaData(b)}},{xtype:"displayfield",itemId:"DataFinePraticaPortletVmd",reference:"DataFinePraticaPortletVmd",fieldLabel:"RAP_DATA_CHIUSURA_PRATICA",name:"dataFine",renderer:function(b,c){return FormattaData(b)}},{xtype:"displayfield",fieldLabel:"FR_NUMERO_PRATICA",name:"numPratica"}]},{xtype:"container",flex:1,layout:{type:"vbox"},items:[{xtype:"displayfield",fieldLabel:"RAP_TIPO_VALUTAZIONE",name:"desTipoValutazione"},
{xtype:"displayfield",fieldLabel:"RAP_ESITO_VALUTAZIONE",name:"desEsitoVMD"},{xtype:"displayfield",fieldLabel:"RAP_ESITO_MISURA",name:"desEsitoMisura",labelWidth:135},{xtype:"image",margin:"3 0 0 0",itemId:"ImgErogMisura",reference:"ImgErogMisura",height:20,width:20,src:"/cba/generali/images/svg/others/circle-gray.svg"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletReferenti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"Container",reference:"Container",store:Ext.create("GeneraliOSP.portlet.store.Referenti",{cbaConfig:{idModulo:48},sorters:[{property:"rating",direction:"DESC"}]}),readOnly:!0,columns:[{xtype:"gridcolumn",width:25,align:"center",dataIndex:"rating",text:"",renderer:function(b,c,d,f,g,h){c.tdCls="icon-star";return b?b:""}},
{xtype:"gridcolumn",width:1020,dataIndex:"nomePersona",text:"REF_NOMINATIVO",flex:1},{xtype:"gridcolumn",width:105,dataIndex:"desGradoParentela",text:"GRADO_PARENTELA",flex:1},{xtype:"gridcolumn",width:85,dataIndex:"telefono1",text:"Telefono",flex:1},{xtype:"gridcolumn",width:50,dataIndex:"garante",text:"REF_GARANTE",renderer:function(b,c,d,f,g,h){return renderCheckColumn(c,b)}}],viewConfig:{loadMask:!1}}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.PortletRegionale",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",border:0,itemId:"Container",reference:"Container",padding:5,layout:{align:"stretch",type:"vbox"},defaults:{margin:"0 1 2 0",border:2},title:"",trackResetOnLoad:!0,items:[{xtype:"container",itemId:"CntVeneto",reference:"CntVeneto",items:[{xtype:"displayfield",fieldLabel:"DATA_DAL",labelClsExtra:"cbaLabelDati",dataIndex:"dataDal",format:"d/m/Y H:i",
hidden:!1},{xtype:"displayfield",fieldLabel:traduci("CLASSIFICAZIONE"),labelClsExtra:"cbaLabelDati",dataIndex:"codiceClassificazione",hidden:!1},{xtype:"displayfield",dataIndex:"idImpegnativa",fieldLabel:"IMPEGNATIVA",labelClsExtra:"cbaLabelDati",hidden:!1}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.RAPBudget",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",itemId:"Container",reference:"Container",layout:{type:"border"},items:[{xtype:"form",border:0,region:"center",trackResetOnLoad:!0,items:[{xtype:"container",padding:"30 0 0 0",bodyPadding:4,layout:{align:"center",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"label",style:{fontSize:"22px"},text:traduci("RAP_STRUTTURA"),html:'<span style="height:16px; width:26px; "></span>'},
{xtype:"tbfill"}]},{xtype:"container",border:1,padding:"10 10 10 10",layout:{type:"vbox"},style:{borderColor:"#A2A2A2",borderStyle:"solid",borderRadius:"4px"},margin:"30 30 30 30",items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",width:110,layout:{type:"vbox"},items:[{xtype:"label",width:110,html:"<br />"},{xtype:"displayfield",labelWidth:110,fieldLabel:"RAP_BDG",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",fieldLabel:"RAP_BDG_PREVISTO",labelWidth:110,labelClsExtra:"cbaLabelDati"},
{xtype:"displayfield",labelWidth:110,fieldLabel:"RAP_BDG_EFFETTIVO",labelClsExtra:"cbaLabelDati"}]},{xtype:"container",layout:{type:"vbox",align:"right"},items:[{xtype:"label",width:100,html:"1  "+traduci("TRIMESTRE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",name:"stanziatostruttura",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim1prevStrutt",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim1effStrutt",
renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",width:100,html:"2  "+traduci("TRIMESTRE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",itemId:"StanziatostruttperTrim2",reference:"StanziatostruttperTrim2",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim2prevStrutt",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",
name:"trim2effStrutt",renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",width:100,html:"3  "+traduci("TRIMESTRE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",itemId:"StanziatostruttperTrim3",reference:"StanziatostruttperTrim3",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim3prevStrutt",renderer:function(b){return formatFloat(b,
2,".")}},{xtype:"displayfield",name:"trim3effStrutt",renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",width:100,html:"4  "+traduci("TRIMESTRE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",itemId:"StanziatostruttperTrim4",reference:"StanziatostruttperTrim4",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim4prevStrutt",renderer:function(b){return formatFloat(b,
2,".")}},{xtype:"displayfield",name:"trim4effStrutt",renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",width:100,html:traduci("TOTALE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",itemId:"TotaleStanziatoStruttura",reference:"TotaleStanziatoStruttura",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"totalePrevistoStruttura",renderer:function(b){return formatFloat(b,
2,".")}},{xtype:"displayfield",name:"totaleEffettivoStruttura",renderer:function(b){return formatFloat(b,2,".")}}]}]},{xtype:"container",layout:{type:"hbox"},style:{borderTop:"1px solid #000000 !important"},padding:"0 0 0 0",items:[{xtype:"displayfield",labelWidth:105,fieldLabel:"RESIDUO",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",width:100,style:{textAlign:"right"},itemId:"Trim1resStrutt",reference:"Trim1resStrutt",name:"trim1resStrutt",renderer:function(b){return formatFloat(b,2,".")}},
{xtype:"displayfield",padding:"0 0 0 70",width:100,style:{textAlign:"right"},itemId:"Trim2resStrutt",reference:"Trim2resStrutt",name:"trim2resStrutt",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",padding:"0 0 0 70",width:100,style:{textAlign:"right"},itemId:"Trim3resStrutt",reference:"Trim3resStrutt",name:"trim3resStrutt",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",width:100,padding:"0 0 0 70",itemId:"Trim4resStrutt",reference:"Trim4resStrutt",
style:{textAlign:"right"},name:"trim4resStrutt",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",width:100,padding:"0 0 0 70",itemId:"TotaleResiduoStruttura",reference:"TotaleResiduoStruttura",style:{textAlign:"right"},name:"totaleResiduoStruttura",renderer:function(b){return formatFloat(b,2,".")}}]}]},{xtype:"container",bodyPadding:4,layout:{align:"stretch",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"label",style:{fontSize:"22px"},text:traduci("TIPOLOGIA_UTENTE"),html:'<span style="height:16px; width:26px; "></span>'},
{xtype:"tbfill"}]},{xtype:"container",border:1,padding:"10 10 10 10",layout:{type:"vbox"},style:{borderColor:"#A2A2A2",borderStyle:"solid",borderRadius:"4px"},margin:"30 30 30 30",items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",layout:{type:"vbox"},width:110,items:[{xtype:"label",width:110,html:"<br />"},{xtype:"displayfield",labelWidth:110,fieldLabel:"RAP_BDG",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",labelWidth:110,fieldLabel:"RAP_BDG_PREVISTO",labelClsExtra:"cbaLabelDati"},
{xtype:"displayfield",labelWidth:110,fieldLabel:"RAP_BDG_EFFETTIVO",labelClsExtra:"cbaLabelDati"}]},{xtype:"container",layout:{type:"vbox",align:"right"},items:[{xtype:"label",width:100,html:"1  "+traduci("TRIMESTRE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",name:"stanziatoutentetrim1",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim1prevUtente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim1effUtente",
renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",width:100,html:"2  "+traduci("TRIMESTRE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",name:"stanziatoutentetrim2",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim2prevUtente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim2effUtente",renderer:function(b){return formatFloat(b,
2,".")}}]},{xtype:"container",layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",width:100,html:"3  "+traduci("TRIMESTRE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",name:"stanziatoutentetrim3",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim3prevUtente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim3effUtente",renderer:function(b){return formatFloat(b,2,".")}}]},
{xtype:"container",layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",width:100,html:"4  "+traduci("TRIMESTRE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",name:"stanziatoutentetrim4",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim4prevUtente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"trim4effUtente",renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",
layout:{type:"vbox",align:"right"},padding:"0 0 0 70",items:[{xtype:"label",width:100,html:traduci("TOTALE"),style:{opacity:"0.8",textAlign:"center",fontWeight:"bold"}},{xtype:"displayfield",name:"stanziatoutente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"totalePrevistoUtente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",name:"totaleEffettivoUtente",renderer:function(b){return formatFloat(b,2,".")}}]}]},{xtype:"container",layout:{type:"hbox",
align:"right"},style:{borderTop:"1px solid #000000 !important"},padding:"0 0 0 0",items:[{xtype:"displayfield",labelWidth:105,fieldLabel:"RESIDUO",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",width:100,itemId:"Trim1resUtente",reference:"Trim1resUtente",style:{textAlign:"right"},name:"trim1resUtente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",padding:"0 0 0 70",width:100,style:{textAlign:"right"},itemId:"Trim2resUtente",reference:"Trim2resUtente",name:"trim2resUtente",
renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",padding:"0 0 0 70",width:100,style:{textAlign:"right"},itemId:"Trim3resUtente",reference:"Trim3resUtente",name:"trim3resUtente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",padding:"0 0 0 70",width:100,style:{textAlign:"right"},itemId:"trim4resUtente",reference:"trim4resUtente",name:"trim4resUtente",renderer:function(b){return formatFloat(b,2,".")}},{xtype:"displayfield",padding:"0 0 0 70",width:100,
style:{textAlign:"right"},itemId:"TotaleResiduoUtente",reference:"TotaleResiduoUtente",name:"totaleResiduoUtente",renderer:function(b){return formatFloat(b,2,".")}}]}]}]},{xtype:"form",region:"south",bodyPadding:4,layout:{align:"stretch",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esci32",iconAlign:"right",scale:"large",minWidth:85,text:"ESCI",margin:3,nonDisabilitare:!0},{xtype:"tbfill"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.RAPPai",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;b.hintTariffaZero=traduci("RAP_ERR_PREST_TARIFFA_ZERO");Ext.applyIf(b,{items:[{xtype:"panel",border:0,itemId:"EditPai",reference:"EditPai",layout:{type:"border"},bodyPadding:"",title:"",items:[{xtype:"form",bodyPadding:4,region:"center",itemId:"CntEditPai",reference:"CntEditPai",layout:{type:"vbox",align:"stretch"},flex:1,trackResetOnLoad:!0,items:[{xtype:"panel",layout:{type:"hbox"},
border:0,itemId:"CtnStorico",reference:"CtnStorico",flex:2,items:[{xtype:"gridpanel",border:0,width:200,itemId:"StoricoGridVMD",reference:"StoricoGridVMD",store:Ext.create("GeneraliOSP.portlet.store.RAPVmd"),autoScroll:!0,height:100,viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"data",text:"DATA",flex:1,format:"d/m/Y"},{text:"FR_NUMERO_PRATICA",flex:1,dataIndex:"annoPratica",renderer:function(b,d,f){return f.data.annoPratica+"-"+f.data.numPratica}}],viewConfig:{getRowClass:function(b,
d,f,g){if(2==b.get("erogazioneMisura")||3==b.get("erogazioneMisura"))return"non_attivi"},border:0,loadMask:!1},selModel:Ext.create("Ext.selection.RowModel",{})},{xtype:"label",margin:"10 0 0 20",itemId:"LblVMDRossa",reference:"LblVMDRossa",html:'<span style="height:16px; width:26px; "></span>',hidden:!0,style:{color:"#ec0606",fontSize:"22px"},text:""},{xtype:"container",itemId:"FrmTestata",reference:"FrmTestata",border:0,layout:{type:"vbox"},padding:"5 5 5 40",items:[{xtype:"textfield",itemId:"RecordId",
reference:"RecordId",name:"id",hidden:!0},{xtype:"textfield",itemId:"IdRicovero",reference:"IdRicovero",name:"idRicovero",hidden:!0},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"container",flex:1,layout:{type:"vbox"},items:[{xtype:"datefield",itemId:"DataInizioPai",reference:"DataInizioPai",width:220,labelWidth:110,fieldLabel:"RAP_AVVIO_PAI",labelClsExtra:"cbaLabel",allowBlank:!1,name:"dal"},{xtype:"datefield",itemId:"DataChiusuraPai",reference:"DataChiusuraPai",width:220,labelWidth:110,
fieldLabel:"RAP_CHIUSURA_PAI",labelClsExtra:"cbaLabel",allowBlank:!0,name:"al"}]},{xtype:"datefield",itemId:"DataScadenzaPai",reference:"DataScadenzaPai",width:210,margin:"0 0 0 30",flex:1,fieldLabel:"RAP_SCADENZA_PAI",labelClsExtra:"cbaLabelDati",name:"scadenza"}]},{xtype:"combobox",itemId:"CmbChiusura",reference:"CmbChiusura",width:600,labelWidth:110,fieldLabel:"RAP_MOTIVO_CHIUSURA",labelClsExtra:"cbaLabel",name:"motivoChiusura",queryMode:"local",displayField:"valore",valueField:"codice",store:Ext.create("Generali.data.StoreCodiceValore",
{proxy:{url:"/cba/osp/rap/ws/prszn/codifiche/cbox"}})}]}]},{xtype:"gridpanel",itemId:"GrigliaPAI",reference:"GrigliaPAI",flex:7,store:Ext.create("GeneraliOSP.portlet.store.RapPaiDE"),title:"tipologia di utente",autoScroll:!0,dockedItems:[{xtype:"toolbar",dock:"top",border:0,itemId:"toolbar",reference:"toolbar",items:[{xtype:"button",itemId:"btnNuovo",reference:"btnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"btnElimina",reference:"btnElimina",iconCls:"icon-eliminaGriglia",
text:"Elimina"},{xtype:"tbfill"},{xtype:"label",itemId:"LblDescSoglia",reference:"LblDescSoglia",style:"text-align: right"}]}],columns:[{xtype:"gridcolumn",itemId:"ColProfessione",reference:"ColProfessione",dataIndex:"codFigProf",text:"RAP_FIG_PROFESSIONALE",renderer:function(b,d,f,g,h,k,l){return f.get("desFigProf")},flex:3,allowBlank:!1,editor:{xtype:"combobox",hideLabel:!0,name:"codFigProf",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/osp/rap/ws/rsaAperta/cbox/pai/figProf"}}),
typeAhead:!0,valueField:"codice",listeners:{change:function(){var b=this.up().up().up().up().up().controller,d=this.getSelection().data.codice;b.onChangeFigProfessionale(d)}}}},{xtype:"gridcolumn",itemId:"ColPrestazione",reference:"ColPrestazione",renderer:function(b,d,f,g,h,k,l){return f.get("desPrestazione")},dataIndex:"idPrestazione",text:"RAP_TIPO_INTERVENTO",allowBlank:!1,flex:8,editor:{xtype:"combobox",hideLabel:!0,name:"idPrestazione",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValoreDataData",
{proxy:{url:"/cba/osp/rap/ws/rsaAperta/cbox/pai/prestazioni"}}),typeAhead:!0,valueField:"codice"}},{xtype:"gridcolumn",dataIndex:"qtaPrevista",text:"RAP_PREST_PREVISTE",width:65,sortable:!1,align:"center",editor:{xtype:"numberfield",maxLength:2,enforceMaxLength:!0,alwaysDisplayDecimals:!1}},{xtype:"gridcolumn",itemId:"ColMese1",reference:"ColMese1",dataIndex:"qtaMese1",text:"mese1",width:35,sortable:!1,align:"center",editor:{xtype:"numberfield",maxLength:2,enforceMaxLength:!0,alwaysDisplayDecimals:!1}},
{xtype:"gridcolumn",itemId:"ColMese2",reference:"ColMese2",dataIndex:"qtaMese2",text:"mese2",width:35,sortable:!1,align:"center",editor:{xtype:"numberfield",maxLength:2,enforceMaxLength:!0,alwaysDisplayDecimals:!1}},{xtype:"gridcolumn",itemId:"ColMese3",reference:"ColMese3",dataIndex:"qtaMese3",text:"mese3",width:35,sortable:!1,align:"center",editor:{xtype:"numberfield",maxLength:2,enforceMaxLength:!0,alwaysDisplayDecimals:!1}},{xtype:"gridcolumn",itemId:"ColMese4",reference:"ColMese4",dataIndex:"qtaMese4",
text:"mese4",width:35,sortable:!1,align:"center",editor:{xtype:"numberfield",maxLength:2,enforceMaxLength:!0,alwaysDisplayDecimals:!1}},{xtype:"gridcolumn",dataIndex:"importoSSN",text:"RAP_IMP_UNITARIO",width:70,sortable:!1,align:"right",renderer:function(c,d,f,g,h,k,l){null==f.get("importoSSN")&&(d.tdStyle="background-color: #FFFF66",d.tdAttr='data-qtip="'+b.hintTariffaZero+'"');return formatFloat(c,2,".")}},{xtype:"gridcolumn",dataIndex:"importoCompartecipato",text:"RAP_IMP_COMPARTECIPATO",flex:2,
sortable:!1,allowBlank:!1,align:"right",renderer:function(b,d,f,g,h,k,l){return formatFloat(b,2,".")},editor:{xtype:"numberfield",minValue:0,maxValue:1E3,value:0}},{xtype:"gridcolumn",text:"TOTALE",dataIndex:"totale",width:70,sortable:!1,align:"right",renderer:function(b,d,f,g,h,k,l){return formatFloat(b,2,".")}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]},{xtype:"container",itemId:"CtnConfrontoTrim",reference:"CtnConfrontoTrim",id:"confrontoTrim",
layout:{type:"hbox",align:"stretch"},margin:"10 0 0 0",items:[{xtype:"button",itemId:"BtnTrimSX",reference:"BtnTrimSX",margin:"0 20 0 0",cls:"cba-stdbutton-25",iconCls:"icon-indietro20",scale:"medium",style:"background:transparent;border:none"},{xtype:"container",layout:{type:"vbox"},flex:1,items:[{xtype:"label",itemId:"LblTrimSX",reference:"LblTrimSX",name:"nomeTrimSX",style:{fontSize:"12px",fontWeight:"bold"},text:"n trimestre"},{xtype:"container",layout:{type:"hbox"},flex:1,items:[{xtype:"displayfield",
labelWidth:130,fieldLabel:"RAP_BDG",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",name:"budgetSX",width:130,style:{textAlign:"right"},renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"hbox"},flex:1,items:[{xtype:"displayfield",labelWidth:60,fieldLabel:"RAP_BDG_PREVISTO",labelClsExtra:"cbaLabelDati",listeners:{afterrender:function(b){creaToolTipInfo(b,traduci("TOOLTIP_PREVISTO_PAI"))}}},{xtype:"label",width:50,html:"<br />"},{xtype:"displayfield",name:"previstoSX",
width:130,style:{textAlign:"right"},renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"hbox"},flex:1,items:[{xtype:"displayfield",labelWidth:130,fieldLabel:"RAP_BDG_EFFETTIVO",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",name:"effettivoSX",width:130,style:{textAlign:"right"},renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"hbox"},width:360,style:{borderTop:"1px solid #000000 !important"},flex:1,items:[{xtype:"displayfield",
labelWidth:130,fieldLabel:"RESIDUO",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",width:130,itemId:"ResiduoSX",reference:"ResiduoSX",name:"residuoSX",style:{textAlign:"right"},renderer:function(b){return formatFloat(b,2,".")}}]}]},{xtype:"container",layout:{type:"vbox"},flex:1,items:[{xtype:"label",itemId:"LblTrimDX",reference:"LblTrimDX",name:"nomeTrimDX",style:{fontSize:"12px",fontWeight:"bold"},text:"n trimestre"},{xtype:"container",layout:{type:"hbox"},flex:1,items:[{xtype:"displayfield",
labelWidth:130,fieldLabel:"RAP_BDG",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",name:"budgetDX",style:{textAlign:"right"},width:130,renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"hbox"},flex:1,items:[{xtype:"displayfield",labelWidth:60,fieldLabel:"RAP_BDG_PREVISTO",labelClsExtra:"cbaLabelDati",listeners:{afterrender:function(b){creaToolTipInfo(b,"TOOLTIP_PREVISTO_PAI")}}},{xtype:"label",width:50,html:"<br />"},{xtype:"displayfield",name:"previstoDX",
style:{textAlign:"right"},width:130,renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"hbox"},flex:1,items:[{xtype:"displayfield",labelWidth:130,fieldLabel:"RAP_BDG_EFFETTIVO",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",name:"effettivoDX",style:{textAlign:"right"},width:130,renderer:function(b){return formatFloat(b,2,".")}}]},{xtype:"container",layout:{type:"hbox"},style:{borderTop:"1px solid #000000 !important"},flex:1,width:360,items:[{xtype:"displayfield",
labelWidth:130,fieldLabel:"RESIDUO",labelClsExtra:"cbaLabelDati"},{xtype:"displayfield",name:"residuoDX",itemId:"ResiduoDX",reference:"ResiduoDX",style:{textAlign:"right"},width:130,renderer:function(b){return formatFloat(b,2,".")}}]}]},{xtype:"button",itemId:"BtnTrimDX",reference:"BtnTrimDX",cls:"cba-stdbutton-25",iconCls:"icon-avanti20",scale:"medium",margin:"0 0 0 20",style:"background:transparent;border:none"}]}]},{xtype:"panel",region:"east",itemId:"BoxBottoni",reference:"BoxBottoni",width:120,
title:""}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.RAPRequisiti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"form",autoScroll:!0,flex:1,border:0,width:600,margin:"10 0 10 10",itemId:"EditPraticaForm",reference:"EditPraticaForm",trackResetOnLoad:!0,layout:{align:"stretch",type:"vbox"},items:[{xtype:"textfield",itemId:"RecordId",reference:"RecordId",
name:"id",hidden:!0},{xtype:"textfield",itemId:"IdRicovero",reference:"IdRicovero",name:"idRicovero",hidden:!0},{xtype:"container",border:1,padding:"10 10 10 10",style:{borderColor:"#A2A2A2",borderStyle:"solid",borderRadius:"4px",backgroundColor:"#fbf5ff"},margin:"0 0 10 0",itemId:"containerIntestazione",reference:"containerIntestazione",layout:{type:"vbox"},items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",labelWidth:120,fieldLabel:"RAP_STRUTT_EROGANTE",labelClsExtra:"cbaLabelDati",
name:"codStruttura"},{xtype:"displayfield",itemId:"ricoveroDataDal",reference:"ricoveroDataDal",labelWidth:150,margin:"0 0 0 37",fieldLabel:"RAP_DATE_ACCESSO",labelClsExtra:"cbaLabelDati",name:"dataDal",renderer:function(b,c){return b?FormattaData(b):""}}]}]},{xtype:"container",border:1,padding:"10 10 10 10",margin:"0 0 10 0",style:{borderColor:"#A2A2A2",borderStyle:"solid",borderRadius:"4px"},layout:{type:"vbox"},items:[{xtype:"combobox",itemId:"cmbConviventi",reference:"cmbConviventi",width:450,
labelWidth:200,fieldLabel:"RAP_PERS_CONVIVENTI",labelClsExtra:"cbaLabelDati",name:"convivenza",queryMode:"local",allowBlank:!1,displayField:"valore",valueField:"codice"},{xtype:"checkboxfield",itemId:"checkserviziSociali",reference:"checkserviziSociali",labelWidth:200,fieldLabel:"RAP_USO_SERV_SOCIALI",labelClsExtra:"cbaLabelDati",name:"altriServSociali",inputValue:"T",uncheckedValue:"F",allowBlank:!1},{xtype:"checkboxfield",itemId:"checkindAccompagnamento",reference:"checkindAccompagnamento",labelWidth:200,
fieldLabel:"IND_ACCOMPAGNAMENTO",labelClsExtra:"cbaLabelDati",name:"indAccompagnamento",inputValue:"T",uncheckedValue:"F",allowBlank:!1},{xtype:"combobox",itemId:"cmblivInvalidita",reference:"cmblivInvalidita",width:325,labelWidth:200,fieldLabel:"RAP_LIV_INVALIDITA",labelClsExtra:"cbaLabelDati",name:"livelloInvalidita",allowBlank:!1,displayField:"valore",valueField:"codice",queryMode:"local"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"checkboxfield",margin:"0 50 0 0",itemId:"checkDemenza",
reference:"checkDemenza",labelWidth:200,fieldLabel:"RAP_CERTIF_DEMENZA",labelClsExtra:"cbaLabelDati",name:"certDemenza",inputValue:"T",uncheckedValue:"F",allowBlank:!1},{xtype:"datefield",itemId:"DateDemenza",reference:"DateDemenza",width:315,labelWidth:200,fieldLabel:"RAP_DATA_CERTIF_DEMENZA",labelClsExtra:"cbaLabel",allowBlank:!1,disabled:!0,name:"certDemenzaData"}]}]},{xtype:"container",border:1,margin:"0 0 10 0",padding:"10 10 10 10",style:{borderColor:"#A2A2A2",borderStyle:"solid",borderRadius:"4px"},
margin:"0 0 10 0",itemId:"containerConferma",reference:"containerConferma",layout:{type:"hbox"},items:[{xtype:"datefield",margin:"10 100 0 0",itemId:"dateVerificaRequisiti",reference:"dateVerificaRequisiti",width:315,labelWidth:200,fieldLabel:"RAP_DATA_VERIFICA_PREREQUISITI",labelClsExtra:"cbaLabel",name:"requisitiData"},{xtype:"displayfield",labelClsExtra:"cbaLabelDati",fieldLabel:"RAP_PREREQUISITI",labelWidth:120,name:"labelrequisiti",margin:"10 0 0 30"},{xtype:"cbaMultipleChoice",labelWidth:150,
itemId:"CheckRequisiti",reference:"CheckRequisiti",style:{border:"0px !important"},cbaConfig:{itemsCfg:[{html:"SI",isFormField:!0,inputValue:"T",name:"requisitiEsito",width:40,style:{"font-size":"12px !important"}},{html:"NO",isFormField:!1,inputValue:"F",name:"requisitiEsito",width:40,style:{"font-size":"12px !important"}}],esclusivo:!0}}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120,margin:"10 0 0 0"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.RAPVmd",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"EditVmd",reference:"EditVmd",layout:{type:"border"},bodyPadding:"",title:"",items:[{xtype:"panel",bodyPadding:4,region:"center",itemId:"CntEditVmd",reference:"CntEditVmd",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"form",autoScroll:!0,flex:1,border:0,itemId:"EditVmdForm",reference:"EditVmdForm",layout:{type:"vbox",
align:"stretch"},bodyPadding:10,title:"",trackResetOnLoad:!0,items:[{xtype:"textfield",itemId:"RecordId",reference:"RecordId",name:"id",hidden:!0},{xtype:"textfield",name:"idRicovero",hidden:!0},{xtype:"textfield",name:"scadenza",hidden:!0},{xtype:"container",border:1,padding:"10 10 10 10",style:{borderColor:"#A2A2A2",borderStyle:"solid",borderRadius:"4px",backgroundColor:"#fbf5ff"},margin:"0 0 10 0",itemId:"containerIntestazione",reference:"containerIntestazione",layout:{type:"vbox"},items:[{xtype:"container",
layout:{type:"hbox"},items:[{xtype:"displayfield",labelWidth:110,margin:"0 20 0 0",fieldLabel:"RAP_STRUTT_EROGANTE",labelClsExtra:"cbaLabelDati",name:"codStruttura"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"numberfield",itemId:"AnnoPratica",reference:"AnnoPratica",width:150,allowDecimals:!1,fieldLabel:"FR_NUMERO_PRATICA",labelClsExtra:"cbaLabelDati",allowBlank:!1,enforceMaxLength:!0,maxLength:4,hideTrigger:!0,keyNavEnabled:!1,mouseWheelEnabled:!1,name:"annoPratica",useThousandSeparator:!1},
{xtype:"label",padding:"0 5 0 5",text:" - ",labelClsExtra:"cbaLabelDati",name:"-"},{xtype:"numberfield",itemId:"NumPratica",reference:"NumPratica",width:60,allowDecimals:!1,allowBlank:!1,name:"numPratica",enforceMaxLength:!0,maxLength:6,hideTrigger:!0,keyNavEnabled:!1,mouseWheelEnabled:!1,useThousandSeparator:!1}]}]}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"Vmdata",reference:"Vmdata",margin:"0 30 0 0",width:297,labelWidth:187,fieldLabel:traduci("FAR_DATA_VALUTAZIONE")+
"/"+traduci("RAP_INIZIO_PRATICA"),labelClsExtra:"cbaLabel",name:"data"},{xtype:"displayfield",itemId:"dataFine",reference:"dataFine",width:210,labelWidth:100,fieldLabel:"RAP_DATA_CHIUSURA_PRATICA",labelClsExtra:"cbaLabel",name:"dataFine",renderer:function(b,c){return FormattaData(b)}}]},{xtype:"container",layout:{type:"vbox"},items:[{xtype:"combobox",itemId:"EditVmdTipoValutazione",reference:"EditVmdTipoValutazione",margin:"10 0 0 0",width:325,fieldLabel:"RAP_TIPO_VALUTAZIONE",labelClsExtra:"cbaLabel",
name:"tipoValutazione",allowBlank:!1,displayField:"valore",queryMode:"local",valueField:"codice"}]},{xtype:"tabpanel",itemId:"TabEditVmd",reference:"TabEditVmd",margin:"25 0 0 0",flex:1,items:[{xtype:"form",itemId:"frmPresenti",reference:"frmPresenti",bodyPadding:10,border:0,tabConfig:{title:"RAP_PRESENTI",height:44},fieldDefaults:{margin:"5 5 5 5"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"CkMedico",reference:"CkMedico",
labelWidth:200,fieldLabel:"MEDICO",labelClsExtra:"cbaLabelDati",name:"presMedico",inputValue:"T",uncheckedValue:"F"},{xtype:"combobox",itemId:"CmbMedico",reference:"CmbMedico",flex:1,name:"presMedicoQualifica",queryMode:"local",displayField:"valore",valueField:"codice",disabled:!0}]},{xtype:"checkboxfield",itemId:"ckAssistenteSociale",reference:"ckAssistenteSociale",labelWidth:200,fieldLabel:"RAP_ASSISTENTE_SOCIALE",labelClsExtra:"cbaLabelDati",name:"presAssSoc",inputValue:"T",uncheckedValue:"F"},
{xtype:"checkboxfield",itemId:"ckPsicologo",reference:"ckPsicologo",labelWidth:200,fieldLabel:"RAP_PSICOLOGO",labelClsExtra:"cbaLabelDati",name:"presPsicologo",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"ckEducatore",reference:"ckEducatore",labelWidth:200,fieldLabel:"RAP_EDUCATORE",labelClsExtra:"cbaLabelDati",name:"presEducatore",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"ckInfermiere",reference:"ckInfermiere",labelWidth:200,fieldLabel:"RAP_INFERMIERE",
labelClsExtra:"cbaLabelDati",name:"presInfermiere",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"ckTerapista",reference:"ckTerapista",labelWidth:200,fieldLabel:"RAP_TERAPISTA",labelClsExtra:"cbaLabelDati",name:"presTerapisti",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"ckComune",reference:"ckComune",labelWidth:200,fieldLabel:"FAR_TRIM_QUOTA_COMUNE",labelClsExtra:"cbaLabelDati",name:"presRapprComune",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",
itemId:"ckMMG",reference:"ckMMG",labelWidth:200,fieldLabel:"RAP_MMG",labelClsExtra:"cbaLabelDati",name:"presMMG",inputValue:"T",uncheckedValue:"F"},{xtype:"combobox",itemId:"CmbcareManager",reference:"CmbcareManager",width:200,fieldLabel:"RESPONSABILE_RICOVERO",labelClsExtra:"cbaLabelDati",name:"idCareManager",queryMode:"local",allowBlank:!1,displayField:"valore",valueField:"codice",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:"/cba/osp/rap/ws/rsaAperta/cbox/operatori"}})}]},{xtype:"form",
itemId:"frmVmd",reference:"frmVmd",bodyPadding:10,border:0,tabConfig:{title:"RAP_TEST_SOMMINISTRATI",height:44},fieldDefaults:{margin:"5 5 5 5"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",itemId:"containerDati",reference:"containerDati",layout:{type:"vbox"},items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"label",width:"172px",margin:"0 10 10 270",text:traduci("RAP_DATI_SCHEDA_VAL"),componentCls:"cbaLabelDati"},{xtype:"label",width:"100px",margin:"0 10 10 30",text:traduci("RAP_DATI_MANUALI"),
componentCls:"cbaLabelDati"}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"label",width:"172px",padding:"3 0 0 15",text:traduci("RAP_CBI"),componentCls:"cbaLabelDati"},{xtype:"numberfield",itemId:"CBIAuto",reference:"CBIAuto",name:"skCbiId",margin:"0 0 0 80",alwaysDisplayDecimals:!1,value:0,disabled:!0},{xtype:"numberfield",itemId:"CBIManuale",reference:"CBIManuale",name:"skCbiMan",margin:"0 0 0 10",allowDecimals:!1,alwaysDisplayDecimals:!1,hideTrigger:!1,keyNavEnabled:!0,mouseWheelEnabled:!0,
value:0,allowBlank:!1}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"label",width:"172px",padding:"10 0 0 15",text:traduci("RAP_BARTHEL"),componentCls:"cbaLabelDati"},{xtype:"numberfield",itemId:"BarthelAuto",reference:"BarthelAuto",margin:"10 0 0 80",name:"skBarthelId",alwaysDisplayDecimals:!1,value:0,disabled:!0},{xtype:"numberfield",itemId:"BarthelManuale",reference:"BarthelManuale",name:"skBarthelMan",margin:"10 0 0 10",alwaysDisplayDecimals:!1,allowDecimals:!1,hideTrigger:!1,keyNavEnabled:!0,
mouseWheelEnabled:!0,value:0}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"cbaMultipleChoice",itemId:"SceltaTest",reference:"SceltaTest",style:{border:"0px !important",tooltip:"Strumento"},cbaConfig:{itemsCfg:[{html:"CDR",isFormField:!0,inputValue:"1",name:"skDemenzaTipo",width:40,style:{"font-size":"10px !important"}},{html:"MMSE",isFormField:!1,inputValue:"2",name:"skDemenzaTipo",width:50,style:{"font-size":"10px !important"}},{html:"Altro",isFormField:!1,inputValue:"3",name:"skDemenzaTipo",
width:45,style:{"font-size":"10px !important"}},{html:"Nessuno",isFormField:!1,inputValue:"4",name:"skDemenzaTipo",width:60,style:{"font-size":"10px !important"}}],esclusivo:!0}},{hidden:!1,itemId:"CDRAuto",reference:"CDRAuto",xtype:"textfield",name:"CDRAuto",margin:"10 0 0 7",alwaysDisplayDecimals:!1,value:0,disabled:!0},{hidden:!0,xtype:"numberfield",itemId:"MMSEAuto",reference:"MMSEAuto",name:"MMSEAuto",margin:"10 0 0 7",alwaysDisplayDecimals:!1,value:0,disabled:!0},{hidden:!0,xtype:"combobox",
itemId:"CDRManuale",reference:"CDRManuale",name:"skDemenzaManCDR",margin:"10 0 0 10",labelClsExtra:"cbaLabel",displayField:"valore",queryMode:"local",valueField:"codice"},{hidden:!0,xtype:"numberfield",itemId:"MMSEManuale",reference:"MMSEManuale",name:"skDemenzaManMMSE",margin:"10 0 0 10",alwaysDisplayDecimals:!1,allowDecimals:!1,hideTrigger:!1,keyNavEnabled:!0,mouseWheelEnabled:!0,value:0}]},{xtype:"combobox",itemId:"CbEsitoVmd",reference:"CbEsitoVmd",fieldLabel:"RAP_ESITO_VALUTAZIONE",labelClsExtra:"cbaLabel",
labelWidth:120,width:475,name:"esitoVmd",queryMode:"local",allowBlank:!1,displayField:"valore",valueField:"codice"},{xtype:"combobox",itemId:"CbEsitoErogazioneMisura",reference:"CbEsitoErogazioneMisura",width:350,margin:"10 0 0 5",labelWidth:150,fieldLabel:"RAP_ESITO_MISURA",labelClsExtra:"cbaLabel",name:"erogazioneMisura",allowBlank:!1,displayField:"valore",queryMode:"local",valueField:"codice"}]},{xtype:"htmleditor",flex:1,itemId:"NoteVMD",reference:"NoteVMD",fieldLabel:"NOTE",labelAlign:"top",
labelClsExtra:"cbaLabel",name:"note",width:540}]},{xtype:"form",itemId:"FrmPI",reference:"FrmPI",bodyPadding:10,border:0,tabConfig:{title:"RAP_PI",height:44},fieldDefaults:{margin:"5 5 5 5"},layout:{type:"vbox"},items:[{xtype:"datefield",itemId:"DataPi",reference:"DataPi",width:210,labelWidth:100,fieldLabel:"RAP_DATA_PI",labelClsExtra:"cbaLabel",name:"dataPi"},{xtype:"htmleditor",itemId:"NotePI",reference:"NotePI",labelAlign:"top",labelClsExtra:"cbaLabel",name:"notePi",width:595},{xtype:"form",border:0,
margin:"20 0 0 5",itemId:"FormAllegato",reference:"FormAllegato",layout:{type:"hbox"},items:[{xtype:"label",itemId:"LabelAllegato",reference:"LabelAllegato",width:105,text:"DOC_ALLEGATO"},{xtype:"image",cls:"cbaLabelLink",height:32,itemId:"iconAllegato",reference:"iconAllegato",margin:"0 5 0 0",width:32},{xtype:"filefield",margin:"0 5 0 0",formBind:!1,cls:"cba-stdbutton-25",itemId:"BtnAllega",reference:"BtnAllega",fieldLabel:"",hideLabel:!0,readOnly:!1,name:"f_allegato",buttonText:traduci("DOC_ALLEGA_FILE"),
buttonOnly:!0,buttonConfig:{iconCls:"icon-allegato",width:120,height:25},listeners:{change:{fn:this.onBtnAllegaChange,scope:this}}},{xtype:"button",cls:"cba-stdbutton-25",itemId:"BtnEliminaAllegato",reference:"BtnEliminaAllegato",width:120,iconCls:"icon-elimina",text:"DOC_ELIMINA_ALLEGATO"}]},{xtype:"textfield",itemId:"nomeFilePi",reference:"nomeFilePi",hidden:!0,name:"nomeFilePi"},{xtype:"textfield",itemId:"idAllegatoPi",reference:"idAllegatoPi",hidden:!0,name:"idAllegatoPi"}]}]}]}]},{xtype:"panel",
region:"east",itemId:"BoxBottoni",reference:"BoxBottoni",width:120,title:""},{xtype:"panel",region:"west",width:210,layout:{type:"fit"},title:"RES_ELENCO",itemId:"CtnStorico",reference:"CtnStorico",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridVMD",reference:"StoricoGridVMD",store:Ext.create("GeneraliOSP.portlet.store.RAPVmd"),viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",dataIndex:"data",text:"DATA",flex:1,format:"d/m/Y"},{text:"FR_NUMERO_PRATICA",flex:1,dataIndex:"annoPratica",renderer:function(b,
c,d){return d.data.annoPratica+"-"+d.data.numPratica}}],selModel:Ext.create("Ext.selection.RowModel",{})}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.Referenti",{extend:"Generali.standard.ControlledContainer",border:0,itemId:"EditReferenti",reference:"EditReferenti",layout:{type:"border"},bodyPadding:"",title:"",initComponent:function(){var b=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{style:{"background-color":"transparent"},items:[{xtype:"panel",region:"east",width:120,margin:b?"2 8 0 0":null,title:"",layout:{type:"vbox"},items:[{xtype:"container",itemId:"boxBottoni",reference:"boxBottoni",width:120},{xtype:"button",
itemId:"BtnCreaAnagraficaREF",reference:"BtnCreaAnagraficaREF",cls:"cba-button-25",text:"ANAGRAFICA",iconCls:"icon-pagante16",tooltip:"CREA_ANAGRAFICA_PAGANTE",margin:"-5 0 0 10",hidden:!CBA.moduli.modulo43.abilitato&&!CBA.moduli.modulo50.abilitato,disabled:!0}]},{xtype:"panel",region:"west",width:210,layout:{type:"fit"},title:"REF_ELENCO",itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridRef",reference:"StoricoGridRef",title:"",store:Ext.create("GeneraliOSP.portlet.store.Referenti",
{sorters:[{property:"rating",direction:"DESC"}]}),viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"nomePersona",text:"REF_NOMINATIVO",flex:1}],selModel:Ext.create("Ext.selection.RowModel",{})}]},{xtype:"form",autoScroll:!0,flex:1,region:"center",border:0,itemId:"EditReferentiForm",reference:"EditReferentiForm",layout:{type:"vbox"},bodyPadding:10,title:"",margin:b?"10 0 0 0":null,trackResetOnLoad:!0,cls:b?"css-form-label-blue":null,items:[{xtype:"container",margin:"0 0 5 0",width:510,
layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"refNome",reference:"refNome",width:350,fieldLabel:"REF_NOMINATIVO",labelClsExtra:"cbaLabel",name:"nomePersona",allowBlank:!1,maxLength:60,enforceMaxLength:!0,emptyText:"COGNOME_NOME"},{xtype:"combobox",itemId:"refPagante",reference:"refPagante",width:350,fieldLabel:"PAGANTE",labelClsExtra:"cbaLabel",displayField:"valore",minChars:3,queryParam:"valore",valueField:"codice",isFormField:!1,hidden:!CBA.moduli.modulo43.abilitato&&!CBA.moduli.modulo50.abilitato},
{xtype:"checkboxfield",cls:"cbaLabel",labelClsExtra:"cbaLabel",labelWidth:125,margin:"0 0 0 10",itemId:"ImportPagante",reference:"ImportPagante",fieldLabel:"IMPORT_PAGANTE",inputValue:"T",uncheckedValue:"F",isFormField:!1,hidden:!CBA.moduli.modulo43.abilitato&&!CBA.moduli.modulo50.abilitato}]},{xtype:"textfield",validator:function(b){return ControllaCF(b)},itemId:"codiceFiscale",reference:"codiceFiscale",width:350,fieldLabel:"CODICE_FISCALE",labelClsExtra:"cbaLabel",name:"codiceFiscale",allowBlank:!0,
enforceMaxLength:!0,maxLength:16},{xtype:"combobox",itemId:"refGradoParentela",reference:"refGradoParentela",width:350,fieldLabel:"GRADO_PARENTELA",labelClsExtra:"cbaLabel",name:"gradoParentela",allowBlank:!1,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.portlet.store.TipiParentela"),valueField:"codice"},{xtype:"container",width:500,defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox"},items:[{xtype:"label",cls:b?"cbaCssLabel":"cbaLabel",
height:14,width:105,text:"REF_RATING"},{xtype:"panel",border:0,height:20,itemId:"pnlRatingRef",reference:"pnlRatingRef",margin:"0 10 0 0",width:120,title:""},{xtype:"checkboxfield",cls:b?"cbaCssLabel":"cbaLabel",itemId:"refGarante",reference:"refGarante",margin:"0 5 0 0",fieldLabel:"",name:"garante",boxLabel:"REF_GARANTE",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:b?"cbaCssLabel":"cbaLabel",itemId:"refDelegato",reference:"refDelegato",fieldLabel:"",name:"delegaDenaro",boxLabel:"REF_DELEGATO",
inputValue:"T",uncheckedValue:"F"}]},{xtype:"fieldset",itemId:"refPnlIndirizzi",reference:"refPnlIndirizzi",width:520,title:"INDIRIZZO"},{xtype:"container",width:520,layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"dataNascita",reference:"dataNascita",width:210,margin:"0 25 5 0",fieldLabel:"DATA_NASCITA",labelClsExtra:"cbaLabel",name:"dataNascita",allowBlank:!0},{xtype:"combobox",itemId:"comuneNascita",reference:"comuneNascita",width:285,fieldLabel:"COMUNE_NASCITA",labelClsExtra:"cbaLabel",
name:"comuneNascita",allowBlank:!0,displayField:"valore",minChars:3,queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Comuni"),valueField:"codice"}]},{xtype:"combobox",itemId:"nazioneNascita",reference:"nazioneNascita",width:300,fieldLabel:"NAZIONE_NASCITA",labelClsExtra:"cbaLabel",name:"nazioneNascita",allowBlank:!0,displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Nazioni"),typeAhead:!0,valueField:"codice"},{xtype:"container",
width:500,margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"refTelefono1",reference:"refTelefono1",width:230,margin:"0 5 5 0",fieldLabel:"TELEFONO1",labelClsExtra:"cbaLabel",name:"telefono1",maxLength:15,enforceMaxLength:!0},{xtype:"textfield",itemId:"refTelefono2",reference:"refTelefono2",width:230,fieldLabel:"TELEFONO2",labelClsExtra:"cbaLabel",name:"telefono2",maxLength:15,enforceMaxLength:!0}]},{xtype:"container",width:500,margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"textfield",
itemId:"refTelefono3",reference:"refTelefono3",width:230,margin:"0 5 5 0",fieldLabel:"TELEFONO3",labelClsExtra:"cbaLabel",name:"telefono3",maxLength:15,enforceMaxLength:!0},{xtype:"textfield",itemId:"refFax",reference:"refFax",width:230,fieldLabel:"FAX",labelClsExtra:"cbaLabel",name:"fax",maxLength:15,enforceMaxLength:!0}]},{xtype:"container",margin:"0 0 5 0",width:520,layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"RefEmail",reference:"RefEmail",width:490,fieldLabel:"EMAIL",labelClsExtra:"cbaLabel",
name:"email",maxLength:256,enforceMaxLength:!0,margin:"0 5 0 0",vtype:49===CBA.moduli.moduloAttivo?"email":null},{xtype:"button",width:25,cls:null,itemId:"BtnEmail",reference:"BtnEmail",iconCls:"icon-email16",scale:"small"}]},{xtype:"htmleditor",width:520,height:75,itemId:"refNote",reference:"refNote",fieldLabel:"NOTE",labelClsExtra:"cbaLabel",name:"note"},{xtype:"textfield",itemId:"RecordId",reference:"RecordId",fieldLabel:"id",name:"id",hidden:!0},{xtype:"textfield",itemId:"refRating",reference:"refRating",
fieldLabel:"RatingModificato"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.portlet.view.Regionale",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,itemId:"EditRegione",reference:"EditRegione",layout:{type:"border"},bodyPadding:"",title:"",items:[{xtype:"form",autoScroll:!1,flex:1,region:"center",border:0,itemId:"EditRegionaleForm",reference:"EditRegionaleForm",layout:{type:"vbox",align:"stretch"},title:"",trackResetOnLoad:!0},{xtype:"panel",region:"east",itemId:"boxBottoni",
reference:"boxBottoni",width:120,title:"",hidden:!0},{xtype:"panel",region:"west",width:200,layout:{type:"fit"},title:"RES_ELENCO",itemId:"Container",reference:"Container",items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridRegionale",reference:"StoricoGridRegionale",title:"",viewConfig:{loadMask:!1},columns:[{xtype:"datecolumn",width:70,dataIndex:"dataDal",text:"DATA",format:"d/m/Y"},{xtype:"gridcolumn",dataIndex:"desClassificazione",text:"CLASSIFICAZIONE",flex:1}],selModel:Ext.create("Ext.selection.RowModel",
{})}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.prestazioniCdi.controller.Prestazioni",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnAnnulla",selector:b+"#BtnAnnulla"},{ref:"BtnConferma",selector:b+"#BtnConferma"},{ref:"GridPrestazioni",selector:b+"#GridPrestazioni"}]);this.control(b+"#BtnAnnulla",{click:this.clickBtnAnnulla});this.control(b+"#BtnConferma",{click:this.clickBtnConferma})},clickBtnAnnulla:function(b){if(this.cbaConfig.gestioneAnnulla){var c=
this.cbaConfig.prestazioni.split(","),d=[];Ext.each(this.getGridPrestazioni().getSelectionModel().getSelection(),function(b){d.push(b.get("codice").toString())});c.sort();d.sort();Ext.Array.equals(c,d)||this.cbaConfig.annullaCallBack()}b.up("window").close()},clickBtnConferma:function(b){var c=[];Ext.each(this.getGridPrestazioni().getSelectionModel().getSelection(),function(b){c.push(b.get("codice"))});0<c.length?(this.cbaConfig.confermaCallBack(c),b.up("window").close()):msgShowError("","PRESTAZIONE_OBBLIGATORIA")},
onLaunch:function(){var b=this,c=b.getGridPrestazioni();ImpostaUrl([c.getStore()]);c.getStore().load({params:{idRicovero:b.cbaConfig.idRicovero,data:b.cbaConfig.data},callback:function(){var d=b.cbaConfig.prestazioni.split(",");Ext.each(d,function(b){(b=trovaRecord(c.getStore(),"codice",b))&&c.getSelectionModel().select(b,!0)})}});b.getBtnConferma().setDisabled("L"==b.permesso)}});
Ext.define("GeneraliOSP.prestazioniCdi.store.Prestazioni",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idTestata"},{name:"tipoRecord"},{name:"idRisposta"},{name:"desRisposta"},{name:"statoRisposta"},{name:"quantita"},{name:"stato"},{name:"idTipoStato"},{name:"idOperatore"},{name:"idStanza"},{name:"desIdStanza"},{name:"desIdOperatore"},{name:"dataOra",type:"date"},{name:"dataOraFine",type:"date"}],proxy:{type:"ajax",api:{read:".",create:".",update:".",destroy:"."},urlGen:"/ws/genOsp/cdi/rilevazione/detail/src",
reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.prestazioniCdi.view.Prestazioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,layout:{type:"fit"},items:[{xtype:"gridpanel",border:0,itemId:"GridPrestazioni",reference:"GridPrestazioni",autoScroll:!0,title:"",store:Ext.create("GeneraliOSP.prestazioniCdi.store.Prestazioni"),columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"PRESTAZIONE",flex:1}],viewConfig:{border:0,loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",
{checkOnly:!0}),dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:"CONFERMA"},{xtype:"button",itemId:"BtnAnnulla",reference:"BtnAnnulla",iconCls:"icon-annulla16",text:"RIPRISTINA"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.raccordoAssenze.controller.WinRaccordoAssenze",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CbAssenze",selector:b+"#CbServiziEsterni"},{ref:"BtnConfermaAssenza",selector:b+"#BtnConfermaServizio"},{ref:"BtnAnnullaAssenza",selector:b+"#BtnAnnullaAssenza"},{ref:"Panel",selector:b+"#Panel"}]);this.control(b+"#BtnConfermaAssenza",{click:this.onClickBtnConfermaAssenza});this.control(b+"#BtnAnnullaAssenza",
{click:this.onClickBtnAnnullaAssenza})},onClickBtnAnnullaAssenza:function(b){this.cbaConfig.onCancel();b.up("window").close()},onClickBtnConfermaAssenza:function(b){var c=b.up("panel").down("combobox");if(c){c=c.getSelectedRecord().getData();if(c.idEsterno&&c.idPadre)if(Ext.isEmpty(this.cbaConfig.editor)||Ext.isEmpty(this.cbaConfig.context))this.cbaConfig.onSave(this.cbaConfig.esci,c.idEsterno,c.idPadre);else this.cbaConfig.onSave(this.cbaConfig.editor,this.cbaConfig.context,c.idEsterno,c.idPadre);
b.up("window").close()}},onLaunch:function(){var b=this.cbaConfig.store.getData().items[0].data.idEsterno;this.getPanel().html=this.cbaConfig.testoHtml;this.getCbAssenze().setStore(this.cbaConfig.store);this.getCbAssenze().setValue(b);this.getCbAssenze().fieldLabel=this.cbaConfig.lbl},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.raccordoAssenze.controller.WinSincroAssenzaCollegata",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CbAssenze",selector:b+"#CbAssenze"},{ref:"BtnConferma",selector:b+"#BtnConferma"},{ref:"BtnAnnulla",selector:b+"#BtnAnnulla"},{ref:"Panel",selector:b+"#Panel"}]);this.control(b+"#BtnConferma",{click:this.onClickBtnConferma});this.control(b+"#BtnAnnulla",{click:this.onClickBtnAnnulla})},
onClickBtnConferma:function(b){var c=this.getCbAssenze();c&&(c=c.getSelectedRecord(),this.sincronizzaAssenza(c,"F"),b.up("window").close())},onClickBtnAnnulla:function(b){var c=this.getCbAssenze();c&&(c=c.getSelectedRecord(),this.sincronizzaAssenza(c,"T"),b.up("window").close())},sincronizzaAssenza:function(b,c){b.set(this.cbaConfig.dalProperty,new Date(b.get(this.cbaConfig.dalProperty)));b.set(this.cbaConfig.alProperty,new Date(b.get(this.cbaConfig.alProperty)));var d=b.getData();delete d.descrizineFormatted;
Ext.Ajax.request({method:"POST",url:getUrlGen()+this.cbaConfig.url,jsonData:d,params:{soloNotifica:c,idMotivoAssenzaCs:this.cbaConfig.idMotivo?this.cbaConfig.idMotivo:-1},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?"F"==c&&msgShow("MSG_SALVATAGGIO_DATI",b.message):msgShow("ERRORE",b.message)}})},onLaunch:function(){var b=this.cbaConfig.store.getData().items[0].data.id;this.getPanel().html=this.cbaConfig.htmlText;this.getCbAssenze().setStore(this.cbaConfig.store);this.getCbAssenze().setValue(b)},
destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.raccordoAssenze.view.WinRaccordoAssenze",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",cls:"cbaCssPnlPopup",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",itemId:"Panel",reference:"Panel",layout:{type:"vbox",align:"stretch"},bodyPadding:20,cls:"cbaCssLabel",flex:1,items:[{xtype:"combobox",itemId:"CbAssenze",reference:"CbAssenze",displayField:"descrizioneFormatted",
valueField:"idEsterno",queryMode:"local",allowBlank:!1,labelWidth:70,margin:"35 0 0 0",maxWidth:400}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"button",itemId:"BtnConfermaAssenza",reference:"BtnConfermaAssenza",text:traduci("CONFERMA"),cls:"cbaCssBtnFunzione",iconCls:"icon-ok"},{xtype:"button",itemId:"BtnAnnullaAssenza",reference:"BtnAnnullaAssenza",iconCls:"icon-elimina",cls:"cbaCssBtnFunzione",text:traduci("ANNULLA")}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.raccordoAssenze.view.WinSincroAssenzaCollegata",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",cls:"cbaCssPnlPopup",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",itemId:"Panel",reference:"Panel",layout:{type:"vbox",align:"stretch"},bodyPadding:20,cls:"cbaCssLabel",flex:1,items:[{xtype:"combobox",itemId:"CbAssenze",reference:"CbAssenze",displayField:"descrizineFormatted",
valueField:"id",queryMode:"local",allowBlank:!1,fieldLabel:"Assenza",labelWidth:70,margin:"50 0 0 0",maxWidth:370}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",text:traduci("CONFERMA"),cls:"cbaCssBtnFunzione",iconCls:"icon-ok"},{xtype:"button",itemId:"BtnAnnulla",reference:"BtnAnnulla",iconCls:"icon-elimina",cls:"cbaCssBtnFunzione",text:traduci("ANNULLA")}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.controller.BloccoCalendario",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"StoricoGridBloccoCalendario",selector:b+"#StoricoGridBloccoCalendario"},{ref:"boxBottoni",selector:b+"#boxBottoni"},{ref:"BloccoCalendarioForm",selector:b+"#BloccoCalendarioForm"},{ref:"LblBlocco",selector:b+"#LblBlocco"},{ref:"DatiInserimento",selector:b+"#DatiInserimento"},{ref:"DatiEliminazione",
selector:b+"#DatiEliminazione"},{ref:"CBDeletedData",selector:b+"#CBDeletedData"},{ref:"GridServizi",selector:b+"#GridServizi"},{ref:"PnlBlocco_DalAl",selector:b+"#PnlBlocco_DalAl"},{ref:"PnlBlocco_Serv",selector:b+"#PnlBlocco_Serv"},{ref:"BloccoCalendarioDal",selector:b+"#BloccoCalendarioDal"},{ref:"BloccoCalendarioAl",selector:b+"#BloccoCalendarioAl"}]);this.control(b+"#StoricoGridBloccoCalendario",{select:this.onStoricoGridBloccoCalendarioSelect});this.control(b+"#CBDeletedData",{change:this.changeCBDeletedData})},
changeCBDeletedData:function(b,c,d,f){this.filtraRecordCancellati(c)},filtraRecordCancellati:function(b){var c=this.getStoricoGridBloccoCalendario().getStore();c.clearFilter();c.filter(function(c){var d=!0;b||(d=null==c.get("deleted_data"));return d})},onStoricoGridBloccoCalendarioSelect:function(b,c){this.impostaDati(c)},nuovo:function(){this.getGridServizi().getSelectionModel().deselectAll();this.getLblBlocco().hide();this.getDatiInserimento().hide();this.getDatiEliminazione().hide();this.getPnlBlocco_DalAl().show();
this.getPnlBlocco_Serv().show();controller_nuovoRecord(this.getBloccoCalendarioForm())},verificaCampiForm:function(){var b=[],c=this.getBloccoCalendarioForm().getForm(),d=this.getBloccoCalendarioDal().getValue(),f=this.getBloccoCalendarioAl().getValue();c.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");Ext.isEmpty(this.getGridServizi().getSelectionModel().getSelection())&&msgAddError(b,"MSG_NO_SERVICE_SELECTED");if(!Ext.isEmpty(d)&&!Ext.isEmpty(f)){var g=!1;d>f&&(msgAddError(b,"DATA_INIZIO_BLOCCO_KO"),
g=!0);var h=[];this.getGridServizi().getSelectionModel().getSelection().forEach(function(b){h.push(b.get("codice"))});this.getStoricoGridBloccoCalendario().getStore().data.items.forEach(function(c){!g&&null==c.get("deleted_data")&&h.includes(c.get("idServizio"))&&(d<=c.get("dal")&&f>=c.get("dal")?(msgAddError(b,"INTERVALLO_BLOCCO_KO"),g=!0):d>=c.get("dal")&&d<=c.get("al")&&(msgAddError(b,"INTERVALLO_BLOCCO_KO"),g=!0))})}return msgShow("",b)},salva:function(b){var c=this;if(!this.verificaCampiForm())return!1;
Messaggio("ATTENZIONE","MSG_SALVA_BLOCCO_CALENDARIO","YESNOCANCEL","QUESTION","",function(){var d={idServizio:null,dal:c.getBloccoCalendarioDal().getValue(),al:c.getBloccoCalendarioAl().getValue()};c.getGridServizi().getSelectionModel().getSelection().forEach(function(f){d.idServizio=f.get("codice");controller_salvaRecord(c.getBloccoCalendarioForm(),d,b)})},function(){c.aggiornaStore()})},impostaDati:function(b){var c=this.getLblBlocco();this.getStoricoGridBloccoCalendario().setDisabled(!1);this.getGridServizi().getSelectionModel().deselectAll();
clearForm(this.getBloccoCalendarioForm().id);b?(this.getBloccoCalendarioForm().loadRecord(b),c.setHtml(traduci("MSG_BLOCCO_CALENDARIO",[b.data.desServizio,FormattaData(b.data.dal),FormattaData(b.data.al)])),this.getDatiInserimento().show(),null!=b.data.deleted_data?this.getDatiEliminazione().show():this.getDatiEliminazione().hide()):(c.setHtml(traduci("MSG_NESSUN_BLOCCO")),this.getDatiInserimento().hide(),this.getDatiEliminazione().hide());c.show()},aggiornaStore:function(){var b=this,c=b.getStoricoGridBloccoCalendario().getStore(),
d=[];b.getGridServizi().getStore().data.items.forEach(function(b){d.push(b.get("codice"))});b.getPnlBlocco_DalAl().hide();b.getPnlBlocco_Serv().hide();c.load({params:{servizi:d.toString()},callback:function(c,d,h){h?(Ext.isEmpty(c)?clearForm(b.getBloccoCalendarioForm().id):(c=b.getStoricoGridBloccoCalendario(),c.getSelectionModel().deselectAll(),c.getSelectionModel().select(0)),b.filtraRecordCancellati(b.getCBDeletedData().getValue())):msgShowError("",d.getError())}});permettiModificheDopoDimissione()||
(containerSolaLettura(b.getBloccoCalendarioForm()),b.getBoxBottoni().queryById("btnNuovo").setDisabled(!0),b.getBoxBottoni().queryById("btnElimina").setDisabled(!0),b.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),b.getBoxBottoni().queryById("btnConferma").setDisabled(!0),b.getBoxBottoni().queryById("btnEsci").setDisabled(!1))},loadData:function(){var b=this;StdSipcar.promiseLoadStore(this.getGridServizi().getStore(),{}).then(function(c){!Ext.isEmpty(c)&&0<c.length&&b.aggiornaStore()})["catch"](function(b){return alert(b)})},
onLaunch:function(){var b=this,c=b.getStoricoGridBloccoCalendario().getStore();ImpostaUrl([c,b.getGridServizi().getStore()]);var d=b.getBloccoCalendarioForm();d.boxBottoni=b.getBoxBottoni();d.store=c;d.controller=b;b.impostaDati();b.loadData();c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){b.salva(c)},annulla_callback:function(){b.aggiornaStore()},nuovo_callback:function(){b.nuovo()},elimina_callback:function(){var c=b.getBloccoCalendarioForm().getForm().findField("id").getValue();
Ext.isEmpty(c)||controller_eliminaRecord(b.getStoricoGridBloccoCalendario().getStore(),{id:c},function(){b.aggiornaStore()},null,traduci("MSG_ELIMINA_BLOCCO_CALENDARIO"))},esci_callback:function(){var c=d.up("window");controller_puoiUscire(c,d,function(){b.salva(!0)},function(){c.close()},function(){c.close()})},verificaCampiForm_callback:function(){return b.verificaCampiForm()}}});inserisciBottoni(b.getBoxBottoni(),c);b.getBoxBottoni().queryById("btnEsci").setVisible(!1);if("L"==b.cbaConfig.permesso)containerSolaLettura(d),
controller_bottoniSolaLettura(b.getBoxBottoni());else d.getForm().on("dirtychange",function(c,g){controller_abilitaBottoni(d);b.getStoricoGridBloccoCalendario().setDisabled(g)})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.controller.EditPrestazioniSupp",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:b+"#BtnEsci"},{ref:"BtnAnnullaPrestazioni",selector:b+"#BtnAnnullaPrestazioni"},{ref:"BtnConfermaPrestazioni",selector:b+"#BtnConfermaPrestazioni"},{ref:"GridPrestazioni",selector:b+"#GridPrestazioni"},{ref:"BtnEliminaPrestaz",selector:b+"#BtnEliminaPrestaz"},{ref:"BtnNuovoPrestaz",
selector:b+"#BtnNuovoPrestaz"},{ref:"GridScontiSupp",selector:b+"#GridScontiSupp"},{ref:"BtnNuovoSconto",selector:b+"#BtnNuovoSconto"},{ref:"BtnEliminaSconto",selector:b+"#BtnEliminaSconto"},{ref:"EditorTipoSS",selector:b+"#EditorTipoSS"},{ref:"CbSupplementiSconti",selector:b+"#CbSupplementiSconti"},{ref:"EditorPrestazione",selector:b+"#EditorPrestazione"},{ref:"ImgLockedPrestaz",selector:b+"#ImgLockedPrestaz"},{ref:"ImgLockedSconto",selector:b+"#ImgLockedSconto"}]);this.control(b+"#EditorTipoSS",
{change:this.changeEditorTipoSS});this.control(b+"#EditorPrestazione",{select:this.selectEditorPrestazione});this.control(b+"#BtnEsci",{click:this.clickBtnEsci});this.control(b+"#BtnNuovoPrestaz",{click:this.clickBtnNuovoPrestaz});this.control(b+"#BtnEliminaPrestaz",{click:this.clickBtnEliminaPrestaz});this.control(b+"#GridPrestazioni",{beforeedit:this.beforeeditGridPrestaz,edit:this.editGridPrestaz,canceledit:this.canceleditGridPrestaz,validateedit:this.validateeditGridPrestaz});this.control(b+"#GridScontiSupp",
{beforeedit:this.beforeeditGridScontiSupp,edit:this.editGridScontiSupp,canceledit:this.canceleditGridScontiSupp,validateedit:this.validateeditGridScontiSupp});this.control(b+"#BtnNuovoSconto",{click:this.clickBtnNuovoSconto});this.control(b+"#BtnEliminaSconto",{click:this.clickBtnEliminaSconto})},beforeeditGridScontiSupp:function(b,c,d){if(!0===b.editing||this.cbaConfig.bloccoCalendario)return!1;this.getEditorTipoSS().bindStore(this.storeIcnSS);this.getEditorTipoSS().tpl=this.tplCbSS;this.getCbSupplementiSconti().bindStore(this.storeCbScontiSupp);
b=c.record.get("tipoRecord");if(2==b&&"S"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti||3==b&&"S"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi)return!1;b?this.loadCbScontiSupp(3==b?"S":"C"):this.loadCbScontiSupp("S");this.abilitaBottoniGrid(!1,this.getGridScontiSupp());this.modifiche++},loadCbScontiSupp:function(b){var c=this.cbaConfig.controllerRilevazioneCdi,d=c&&c.permessoScontiSupp&&"S"==c.permessoScontiSupp,f;this.cbaConfig.rilGiorno?this.cbaConfig.pnlGiorno||
(f={tipo:b,idServizio:this.cbaConfig.controllerRilevazioneCdi.getCBServizio().value,idRicovero:this.cbaConfig.recordTestata.idRicovero,data:this.cbaConfig.dataSelezionata,soloPianificati:d?"F":"T"}):f={tipo:b,idServizio:c.getGridServizi().getSelectionModel().getSelection()[0].get("idServizio"),idRicovero:c.getGridServizi().getSelectionModel().getSelection()[0].get("idRicovero"),data:creaData(this.cbaConfig.pnlGiorno.down("label").text,c.currentMonth,c.currentYear),soloPianificati:d?"F":"T"};this.storeCbScontiSupp.load({params:f})},
changeEditorTipoSS:function(b,c){this.loadCbScontiSupp(3==c?"S":"C")},selectEditorPrestazione:function(b,c){this.isTipoServAmb&&(this.prestazioneNoImpegnativa=Ext.isEmpty(c.get("extra").split(",")[1]))},canceleditGridScontiSupp:function(b,c,d){this.abilitaBottoniGrid(!0,this.getGridScontiSupp());this.aggiornaStores(!1,!0);this.modifiche--},validateeditGridScontiSupp:function(b,c,d){b=[];0>=c.newValues.quantita&&msgAddError(b,"OSP_QUANTITA_MAG_ZERO");return msgShow("",b)},editGridScontiSupp:function(b,
c,d){var f=this;d=c.record.getData();var g=!d.id,h=f.cbaConfig.recordTestata,k=!h;delete d.desRisposta;Ext.apply(d,{id:g?null:d.id,tipoRecord:d.tipoRecord});var l,n;f.cbaConfig.rilGiorno?f.cbaConfig.pnlGiorno||(l=f.cbaConfig.controllerRilevazioneCdi.calendario.getGridCalendario().getStore(),h=f.cbaConfig.recordTestata.idRicovero,n=l.findRecord("idRicovero",h),n.data.idServizio=f.cbaConfig.controllerRilevazioneCdi.getCBServizio().getValue(),n.data.servizio={tipoServizio:50==CBA.moduli.moduloAttivo?
"A":f.cbaConfig.controllerRilevazioneCdi.getCBServizio().getSelection().get("extra").split(",")[1],regione:f.cbaConfig.regione?f.cbaConfig.regione:f.cbaConfig.controllerRilevazioneCdi.getCBServizio().getSelection().get("extra").split(",")[0]},l={idRicovero:h,dataRicovero:f.cbaConfig.recordTestata.dataRicovero,data:f.cbaConfig.dataSelezionata,presente:f.cbaConfig.recordTestata.id?f.cbaConfig.recordTestata.presente:"T",idServizio:n.data.idServizio}):(n=f.cbaConfig.controllerRilevazioneCdi.getGridServizi().getSelectionModel().getSelection()[0],
l={idRicovero:k?n.get("idRicovero"):h.get("idRicovero"),dataRicovero:n.get("dataDal"),data:k?creaData(f.cbaConfig.pnlGiorno.down("label").text,f.cbaConfig.controllerRilevazioneCdi.currentMonth,f.cbaConfig.controllerRilevazioneCdi.currentYear):h.get("data"),presente:k?"T":h.get("presente"),idServizio:n.data.idServizio},!k&&h.get("motivoAssenza")&&Ext.apply(l,{motivoAssenza:h.get("motivoAssenza")}));Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/detail"+(g?"/new":"/update"),method:"POST",
async:!1,jsonData:d,params:l,success:function(d){d=Ext.JSON.decode(d.responseText);if(d.success){var g=[];msgAdd(g,d.message);msgShow("MSG_SALVATAGGIO_DATI",g);f.idTestata=d.data.idTestata;f.aggiornaStores(!1,!0);f.abilitaBottoniGrid(!0,f.getGridScontiSupp());g=b.getEditor().getForm().findField("idRisposta");0==g.getStore().findRecord("codice",g.getValue()).get("idGruppo")&&Ext.create("winCBA",{name:"GeneraliOSP.portlet.view.EdtScontiSupp",titolo:"TITOLO_EDITSCONTISUPP",dimensione:1,configItem:{permesso:"S",
currRicovero:n.data,noPortlet:!0,selezionaRecord:d.data}}).show()}else msgShowError("",d.message),b.startEdit(c.record,0)}});f.abilitaBottoniGrid(!0,f.getGridScontiSupp())},clickBtnNuovoSconto:function(b){controller_nuovoRecordGrid({idTestata:this.idTestata},this.getGridScontiSupp())},clickBtnEliminaSconto:function(b){this.eliminaDettaglio(this.getGridScontiSupp())},abilitaBottoniGrid:function(b,c){"GridPrestazioni"==c.getItemId()?(this.getBtnNuovoPrestaz().setDisabled(!b),this.getGridScontiSupp().setDisabled(!b)):
"GridScontiSupp"==c.getItemId()&&(this.getBtnNuovoSconto().setDisabled(!b),this.getGridPrestazioni().setDisabled(!b));this.getBtnEsci().setDisabled(!b)},onChangeComboStato:function(b,c,d){this.getGridPrestazioni().queryById("IdTipoStato").field.setDisabled("N"!=c)},getParametriCbPrestazioni:function(){var b=this.cbaConfig.controllerRilevazioneCdi,c=b&&b.permessoClassif&&"S"==b.permessoClassif,d;this.cbaConfig.rilGiorno?this.cbaConfig.pnlGiorno||(d={idServizio:this.cbaConfig.controllerRilevazioneCdi.getCBServizio().value,
idRicovero:this.cbaConfig.recordTestata.idRicovero,data:this.cbaConfig.dataSelezionata,soloPianificati:c?"F":"T"}):(d=b.getGridServizi().getSelectionModel().getSelection()[0],d={idServizio:d.get("idServizio"),idRicovero:d.get("idRicovero"),data:creaData(this.cbaConfig.pnlGiorno.down("label").text,b.currentMonth,b.currentYear),soloPianificati:c?"F":"T"});return d},beforeeditGridPrestaz:function(b,c,d){var f=this;if(!0===b.editing||f.cbaConfig.bloccoCalendario)return!1;d=b.getEditor().getForm();d.findField("idRisposta").bindStore(f.storeCbPrestaz);
if(f.isTipoServAmb){b=d.findField("stato");d=d.findField("idTipoStato");var g=b.getStore(),h=f.getGridPrestazioni().queryById("Operatore").getEditor().getStore();b.allowBlank=!1;d.setDisabled("N"!=c.record.data.stato);f.getGridPrestazioni().queryById("Stanza").getEditor().bindStore(f.storeStanze);svuotaStore(g);svuotaStore(h);ImpostaUrl([g,h]);g.load();h.load({params:{codEnte:CBA.parametriGenerali.codEntePwd,codiceModulo:CBA.moduli.moduloAttivo,idOrganizzazione:getIdOrg(),soloUtentiIdOrg:"T"}});Ext.isEmpty(f.getGridPrestazioni().getSelection()[0].data.desRisposta)||
f.storeCbPrestaz.filter({filterFn:function(b){return"NOIMP"==f.getGridPrestazioni().getSelection()[0].data.descrizione?void 0===b.data.extra.split(",")[1]:f.getGridPrestazioni().getSelection()[0].data.extra==b.data.extra.split(",")[1]||void 0!==b.data.extra.split(",")[1]}})}else c=f.getParametriCbPrestazioni(),f.storeCbPrestaz.load({params:c});f.abilitaBottoniGrid(!1,f.getGridPrestazioni());f.modifiche++},editGridPrestaz:function(b,c,d){var f=this;d=c.record.getData();var g=!d.id,h=f.cbaConfig.recordTestata,
k=!h;delete d.desRisposta;delete d.extra;Ext.apply(d,{id:g?null:d.id,tipoRecord:d.tipoRecord?d.tipoRecord:1});if(f.isTipoServAmb){var l=d.dataOra;if(!Ext.isEmpty(l)&&l<new Date("1999-01-01")&&"P"!=d.stato){var n=f.cbaConfig.rilGiorno?f.cbaConfig.dataSelezionata:k?creaData(f.cbaConfig.pnlGiorno.down("label").text,f.cbaConfig.controllerRilevazioneCdi.currentMonth,f.cbaConfig.controllerRilevazioneCdi.currentYear):h.get("data"),n=new Date(n.getFullYear(),n.getMonth(),n.getDate(),l.getHours(),l.getMinutes());
Ext.apply(d,{dataOra:n})}(l=f.getGridPrestazioni().queryById("Stanza").getEditor().getSelection())&&Ext.apply(d,{idStanza:l.get("idStanza")});Ext.apply(d,{descrizione:f.prestazioneNoImpegnativa?"NOIMP":d.descrizione})}var p,q;f.cbaConfig.rilGiorno?f.cbaConfig.pnlGiorno||(p=f.cbaConfig.controllerRilevazioneCdi.calendario.getGridCalendario().getStore(),h=f.cbaConfig.recordTestata.idRicovero,q=p.findRecord("idRicovero",h),q.data.idServizio=f.cbaConfig.controllerRilevazioneCdi.getCBServizio().getValue(),
q.data.servizio={tipoServizio:50==CBA.moduli.moduloAttivo?"A":f.cbaConfig.controllerRilevazioneCdi.getCBServizio().getSelection().get("extra").split(",")[1],regione:f.cbaConfig.regione?f.cbaConfig.regione:f.cbaConfig.controllerRilevazioneCdi.getCBServizio().getSelection().get("extra").split(",")[0]},p={idRicovero:h,dataRicovero:f.cbaConfig.recordTestata.dataRicovero,data:f.cbaConfig.dataSelezionata,presente:f.cbaConfig.recordTestata.id?f.cbaConfig.recordTestata.presente:"T",idServizio:q.data.idServizio}):
(q=f.cbaConfig.controllerRilevazioneCdi.getGridServizi().getSelectionModel().getSelection()[0],p={idRicovero:k?q.get("idRicovero"):h.get("idRicovero"),dataRicovero:q.get("dataDal"),data:k?creaData(f.cbaConfig.pnlGiorno.down("label").text,f.cbaConfig.controllerRilevazioneCdi.currentMonth,f.cbaConfig.controllerRilevazioneCdi.currentYear):h.get("data"),presente:k?"T":h.get("presente"),idServizio:q.data.idServizio},!k&&h.get("motivoAssenza")&&Ext.apply(p,{motivoAssenza:h.get("motivoAssenza")}));Ext.Ajax.request({url:getUrlGen()+
"/ws/genOsp/cdi/rilevazione/detail"+(g?"/new":"/update"),method:"POST",async:!1,jsonData:d,params:p,success:function(d){d=Ext.JSON.decode(d.responseText);if(d.success){var g=[];msgAdd(g,d.message);msgShow("MSG_SALVATAGGIO_DATI",g);f.idTestata=d.data.idTestata;f.aggiornaStores(!1,!0);f.abilitaBottoniGrid(!0,f.getGridPrestazioni());g=b.getEditor().getForm().findField("idRisposta");0==g.getStore().findRecord("codice",g.getValue()).get("idGruppo")&&Ext.create("winCBA",{name:"GeneraliOSP.portlet.view.EdtClassificazioni",
titolo:"OSP_CLASSIFICAZIONI",dimensione:1,configItem:{permesso:"S",currRicovero:q.data,noPortlet:!0,selezionaRecord:d.data,tipoClRetta:"CDI",hideClassReg:!1,hideClassInt:!1}}).show()}else msgShowError("",d.message),b.startEdit(c.record,0)}});f.abilitaBottoniGrid(!0,f.getGridPrestazioni())},canceleditGridPrestaz:function(b,c,d){this.abilitaBottoniGrid(!0,this.getGridPrestazioni());this.aggiornaStores(!1,!0);this.modifiche--},validateeditGridPrestaz:function(b,c,d){b=[];c=c.newValues;0>=c.quantita&&
msgAddError(b,"OSP_QUANTITA_MAG_ZERO");this.isTipoServAmb&&"E"==c.stato&&(Ext.isEmpty(c.idOperatore)&&msgAddError(b,"operatore mancante"),Ext.isEmpty(c.dataOra)&&msgAddError(b,"dataOra mancante"));return msgShow("",b)},clickBtnNuovoPrestaz:function(b){b={idTestata:this.idTestata};this.isTipoServAmb&&Ext.apply(b,{stato:"P"});this.storeCbPrestaz.clearFilter();controller_nuovoRecordGrid(b,this.getGridPrestazioni())},clickBtnEliminaPrestaz:function(b){this.eliminaDettaglio(this.getGridPrestazioni())},
eliminaDettaglio:function(b){var c=this,d=b.getSelectionModel().getSelection()[0];if(2==d.data.tipoRecord&&"S"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti||3==d.data.tipoRecord&&"S"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi)return!1;Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/detail/delete",async:!1,params:{id:d.get("id")},success:function(d){d=Ext.JSON.decode(d.responseText);if(d.success){var f=[];msgAdd(f,
d.message);msgShow("MSG_SALVATAGGIO_DATI",f);c.aggiornaStores(!1,!0);c.abilitaBottoniGrid(!0,b);c.modifiche++}else msgShowError("",d.message)}})},clickBtnEsci:function(b){b=b.up("window");this.idTestata&&0<this.modifiche&&(this.cbaConfig.controllerRilevazioneCdi.fireEvent("getGiornoById",this.cbaConfig.pnlGiorno,this.idTestata),this.cbaConfig.controllerRilevazioneCdi.fireEvent("loadTotali",!0),b.retValue={idTestata:this.idTestata,modifiche:this.modifiche});b.close()},aggiornaStores:function(b,c){function d(b,
c,d,f){inizioAttesa();c.forEach(function(c){if(1==c.tipoRecord)d.add(c),b.idTestata=c.idTestata;else if(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)(2==c.tipoRecord&&"N"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti||3==c.tipoRecord&&"N"!=CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi)&&f.add(c),b.idTestata=c.idTestata});fineAttesa();0<d.getCount()?(b.getGridPrestazioni().getSelectionModel().select(0),b.getBtnEliminaPrestaz().setDisabled(!1)):
b.getBtnEliminaPrestaz().setDisabled(!0);(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)&&0<f.getCount()?(b.getGridScontiSupp().getSelectionModel().select(0),b.getBtnEliminaSconto().setDisabled(!1)):b.getBtnEliminaSconto().setDisabled(!0)}var f=this,g=f.getGridPrestazioni().getStore(),h=f.getGridScontiSupp().getStore(),k=c?[]:b;svuotaStore(g);(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)&&svuotaStore(h);c&&f.idTestata?Ext.Ajax.request({method:"GET",url:getUrlGen()+
"/ws/genOsp/cdi/rilevazione/detail/src",async:!1,params:{idTestata:f.idTestata},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(k=b.data,d(f,k,g,h)):msgShowError("",b.message)}}):d(f,k,g,h)},loadStoreStanze:function(){!this.storeStanze&&this.isTipoServAmb&&(this.storeStanze=Ext.create("GeneraliOSP.store.ListaStanze"),this.storeStanze.load({params:{stanzeAdibiteA:"'A'"},callback:function(b,c,d){d||msgShowError("",c.getError())}}),this.getGridPrestazioni().controller=this)},loadStoreTipoStato:function(){cmp=
this.getGridPrestazioni().queryById("IdTipoStato");cmp.editor.store.load({params:{scheda:"V",domanda:107},callback:function(b,c,d){d&&b.forEach(function(b){b.data.valore=traduci(b.data.valore.toUpperCase())})}})},loadStorePrestazioni:function(){if(this.storeCbPrestaz){var b=this,c=b.getParametriCbPrestazioni();b.isTipoServAmb&&(b.storeCbPrestaz.getProxy().urlGen="/ws/genOsp/cdi/prestaz/byRicovero");ImpostaUrl([b.storeCbPrestaz]);b.storeCbPrestaz.load({params:c,callback:function(c,f,g){g&&b.getGridPrestazioni().getView().refresh()}})}},
onLaunch:function(){CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi||(CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi=[]);if(!CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi){for(var b=["GestioneSconti","GestioneSupplementi"],c=0;c<b.length;c++)CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi[b[c]]=this.cbaConfig.permesso;Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/permesso/videata",params:{idModulo:CBA.moduli.moduloAttivo,idVideata:b.toString()},success:function(c){c=
Ext.JSON.decode(c.responseText);if(c.success)for(var d=0;d<b.length;d++)CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi[b[d]]=c.data[d];else msgShowError("",c.message)}})}this.idTestata=null!=this.cbaConfig.recordTestata?this.cbaConfig.recordTestata.id:null;this.modifiche=0;this.isTipoServAmb=isTipoServAmb(this.cbaConfig.tipoServizio);this.cbaConfig.soloScontiSupp?(this.getGridPrestazioni().hide(),this.getGridScontiSupp().on("afterrender",function(b){b.getHeader().hide()})):this.storeCbPrestaz=
Ext.create("GeneraliOSP.rilevazioneGgCdi.store.CbPrestazioni");c=this.getGridPrestazioni().queryById("IdTipoStato").editor.store;ImpostaUrl([this.getGridPrestazioni().getStore(),this.getGridScontiSupp().getStore(),this.storeCbPrestaz,c]);this.isTipoServAmb&&(this.loadStoreTipoStato(),this.loadStoreStanze());this.loadStorePrestazioni();CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato||this.getGridScontiSupp().hide();c=[];"S"==CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSconti&&
c.push([2,traduci("SCONTI"),"icon-meno"]);"S"==CBA.moduli["modulo"+CBA.moduli.moduloAttivo].permessi.GestioneSupplementi&&c.push([3,traduci("SUPPLEMENTI"),"icon-piu"]);this.storeIcnSS=Ext.create("Ext.data.ArrayStore",{fields:["codice","valore","img"],data:c,autoLoad:!0});this.tplCbSS=Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item {img}" style="height: 20px"></div>',"</tpl>");if(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)this.storeCbScontiSupp=Ext.create("GeneraliOSP.rilevazioneGgCdi.store.TipoSupplementiSconti"),
ImpostaUrl([this.storeCbScontiSupp]);this.cbaConfig.nuovaPianificazione||this.aggiornaStores(this.cbaConfig.recordTestata.data.rilevazioneDettaglio,!1);"L"==this.cbaConfig.permesso&&(this.getGridPrestazioni().setDisabled(!0),this.getGridScontiSupp().setDisabled(!0));this.getGridPrestazioni().queryById("Stato").setHidden(!this.isTipoServAmb);this.getGridPrestazioni().queryById("IdTipoStato").setHidden(!this.isTipoServAmb);this.getGridPrestazioni().queryById("Operatore").setHidden(!this.isTipoServAmb);
this.getGridPrestazioni().queryById("Stanza").setHidden(!this.isTipoServAmb);this.getGridPrestazioni().queryById("dataOra").setHidden(!this.isTipoServAmb);this.cbaConfig.bloccoCalendario&&(this.getBtnNuovoPrestaz().setDisabled(!0),this.getBtnEliminaPrestaz().setDisabled(!0),this.getBtnNuovoSconto().setDisabled(!0),this.getBtnEliminaSconto().setDisabled(!0),this.getImgLockedPrestaz().setVisible(!0),this.getImgLockedSconto().setVisible(!0))},destroy:function(){this.storeCbPrestaz&&eliminaStore(this.storeCbPrestaz);
(CBA.moduli.modulo43.abilitato||CBA.moduli.modulo50.abilitato)&&eliminaStore(this.storeCbScontiSupp);eliminaStore(this.storeStanze);eliminaStore(this.storeIcnSS);this.callParent()}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.controller.ListaMotiviAssenza",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:b+"#BtnEsci"},{ref:"BtnConferma",selector:b+"#BtnConferma"},{ref:"Grid",selector:b+"#Grid"}]);this.control(b+"#BtnEsci",{click:this.clickBtnEsci});this.control(b+"#Grid",{itemdblclick:this.itemdblclickMotivoAss,select:this.selectGrid});this.control(b+"#BtnConferma",{click:this.clickBtnConferma})},
itemdblclickMotivoAss:function(b,c,d){this.saveMotivoAss()},selectGrid:function(b,c){this.getBtnConferma().setDisabled(!1)},clickBtnConferma:function(b){this.saveMotivoAss()},saveMotivoAss:function(){var b=this.getGrid().getSelectionModel().getSelection()[0];this.cbaConfig.controllerRilevazioneCdi.fireEvent("editMotivoAssenza",this.cbaConfig.btnMotAssenza,b);this.getGrid().up("window").close()},clickBtnEsci:function(b){b.up("window").close()},onLaunch:function(){this.getBtnConferma().setHidden("L"==
this.cbaConfig.permesso);this.getGrid().setDisabled("L"==this.cbaConfig.permesso);ImpostaUrl([this.getGrid().getStore()]);this.getGrid().getStore().load({params:{idServizio:this.cbaConfig.rilevGg?this.cbaConfig.servizio:this.cbaConfig.servizio.get("idServizio")},callback:function(b,c,d){}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.controller.RicalcolaPianif",{extend:"Generali.standard.ViewController",init:function(){var b="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DataDal",selector:b+"#DataDal"},{ref:"DataAl",selector:b+"#DataAl"},{ref:"FiltroUtenti",selector:b+"#FiltroUtenti"},{ref:"Sede",selector:b+"#Sede"},{ref:"Reparto",selector:b+"#Reparto"},{ref:"GridRicoveri",selector:b+"#GridRicoveri"},{ref:"GridServizi",selector:b+"#GridServizi"},{ref:"AggiornaPrestaz",
selector:b+"#AggiornaPrestaz"},{ref:"OverridePrestaz",selector:b+"#OverridePrestaz"},{ref:"GgChiusuraPrestaz",selector:b+"#GgChiusuraPrestaz"},{ref:"AggiornaExtra",selector:b+"#AggiornaExtra"},{ref:"Elabora",selector:b+"#Elabora"},{ref:"BtnEsci",selector:b+"#BtnEsci"}]);this.control(b+"#BtnEsci",{click:this.clickBtnEsci});this.control(b+"#Elabora",{click:this.clickBtnElabora});this.control(b+"#FiltroUtenti",{change:this.changeFiltroUtenti});this.control(b+"#Sede",{change:this.changeSede});this.control(b+
"#GridServizi",{});this.control(b+"#AggiornaPrestaz",{change:this.changeAggiornaPrestaz});this.control(b+"#OverridePrestaz",{change:this.changeOverridePrestaz});this.control(b+"#GgChiusuraPrestaz",{change:this.changeGgChiusuraPrestaz});this.control(b+"#AggiornaExtra",{change:this.changeAggiornaExtra})},elabora:function(b){var c=this,d=[],f=c.getDataDal().getValue(),g=c.getDataAl().getValue(),h,k=365;f>g&&msgAddError(d,"MSG_DATADAL_MAGGIORE_DATAAL");h=(g-f)/864E5;if(Ext.Date.isLeapYear(f)||Ext.Date.isLeapYear(g))k=
366;h>k&&msgAddError(d,"MSG_SCARTO_MAGGIORE_ANNO");if(!msgShow("",d))return!1;h=0;var k=c.getSede().getValue()?c.getSede().getValue():0,l=c.getReparto().getValue()?c.getReparto().getValue():0,n=[];if(0==c.getFiltroUtenti().getValue().filtro){h=this.cbaConfig.codOspite;var p=c.getGridRicoveri();Ext.each(p.getSelectionModel().getSelection(),function(b){-1==n.indexOf(b.get("idServizio"))&&n.push(b.get("idServizio"))})}else p=c.getGridServizi(),Ext.each(p.getSelectionModel().getSelection(),function(b){n.push(b.get("codice"))});
n=n.toString();c.cbaConfig.rilevGg&&(n=c.cbaConfig.listaServizi);p=newIdElab();Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/cdi/calcplan",params:{idElab:p,codOspite:h,servizi:n,dataDal:f,dataAl:g,codSede:k,codReparto:l,aggiornaPrestaz:getBoolValue(c.getAggiornaPrestaz().getValue()),overridePrestaz:getBoolValue(c.getOverridePrestaz().getValue()),ggChiusuraPrestaz:getBoolValue(c.getGgChiusuraPrestaz().getValue()),aggiornaExtra:getBoolValue(c.getAggiornaExtra().getValue())},method:"GET",async:!0,timeout:3E5,
success:function(f){f=Ext.JSON.decode(f.responseText);var g="";f.success?(g="MSG_SALVATAGGIO_DATI",msgAdd(d,f.message),c.cbaConfig.controllerRilevazioneCdi.fireEvent("aggiornaCalendario",[!0]),b.up("window").close()):msgAddError(d,f.message);msgShow(g,d)},failure:function(b){}});Ext.create("winElaborazione",{idElaborazione:p}).start()},clickBtnElabora:function(b){var c=this;c.getOverridePrestaz().getValue()?Messaggio("Sovrascrivi",traduci("MSG_SOVRASCRIVI_MOVIMENTAZIONE"),"YESNO","QUESTION",null,
function(){c.elabora(b)}):c.elabora(b)},changeAggiornaPrestaz:function(b,c,d){c||this.getAggiornaPrestaz().setValue("F");this.abilitaElabora()},changeAggiornaExtra:function(b,c,d){c||this.getAggiornaExtra().setValue("F");this.abilitaElabora()},changeOverridePrestaz:function(b,c,d){c&&this.getOverridePrestaz().setValue("T")},changeGgChiusuraPrestaz:function(b,c,d){c&&this.getGgChiusuraPrestaz().setValue("T")},abilitaElabora:function(){this.getElabora().setDisabled(!this.getAggiornaPrestaz().getValue()&&
!this.getAggiornaExtra().getValue())},changeSede:function(b,c,d){b=this.getReparto();d=b.getStore();b.clearValue();b.setValue("");b.hide();50==CBA.moduli.moduloAttivo&&this.getReparto().setEmptyText(traduci("AGGP_TUTTI_REPARTI_ALUNNI"));svuotaStore(d);c&&!isNaN(c)?(b.show(),d.load({params:{sede:c}})):b.hide()},changeFiltroUtenti:function(b,c,d){this.getSede().setDisabled(1!=c.filtro);this.getReparto().setDisabled(1!=c.filtro);this.getGridServizi().setVisible(1==c.filtro);this.getGridRicoveri().setVisible(1!=
c.filtro);1==c.filtro&&this.getGridServizi().getSelectionModel().selectAll()},clickBtnEsci:function(b){b.up("window").close()},onLaunch:function(){var b=this,c=b.getGridRicoveri().getStore(),d=b.cbaConfig.rilevGg,f=b.getFiltroUtenti(),g=0;ImpostaUrl([c,b.getSede().getStore(),b.getReparto().getStore(),b.getGridServizi().getStore()]);50==CBA.moduli.moduloAttivo&&b.getReparto().setEmptyText(traduci("AGGP_TUTTI_REPARTI_ALUNNI"));b.getSede().getStore().load();b.getGridServizi().getStore().load({params:{type:getTipiServizio()}});
c.getProxy().extraParams.codospite=b.cbaConfig.codOspite;c.getProxy().extraParams.dataDal=b.cbaConfig.dataInizio;c.getProxy().extraParams.dataAl=b.cbaConfig.dataFine;d?(f.disable(),g=1,b.getGgChiusuraPrestaz().setValue(!0),b.getGridServizi().disable(),b.getGridRicoveri().hide()):c.load({callback:function(c,d,f){0<c.length&&(b.getGridServizi().hide(),b.getGridRicoveri().getSelectionModel().selectAll(!0))}});b.getDataDal().setValue(this.cbaConfig.dataInizio);b.getDataAl().setValue(this.cbaConfig.dataFine);
f.setValue({filtro:g})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.controller.RilevazioneCdi",{extend:"Generali.standard.ViewController",init:function(){var b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{ref:"CntGest",selector:c+"#CntGest"},{ref:"PnlRicerca",selector:c+"#PnlRicerca"},{ref:"CntTestata",selector:c+"#CntTestata"},{ref:"CntCalendar",selector:c+"#CntCalendar"},{ref:"LabMeseAnno",selector:c+"#LabMeseAnno"},{ref:"BtnCDIRicalcola",selector:c+"#BtnCDIRicalcola"},{ref:"BoxBottoni",selector:c+"#BoxBottoni"},
{ref:"GridServizi",selector:c+"#GridServizi"},{ref:"NomeUtente",selector:c+"#NomeUtente"},{ref:"GridTotScontiSupp",selector:c+"#GridTotScontiSupp"},{ref:"CntTotPrestAmb",selector:c+"#CntTotPrestAmb"},{ref:"MsgNotRil",selector:c+"#MsgNotRil"},{ref:"BtnMeseUp",selector:c+"#BtnMeseUp"},{ref:"BtnMeseDown",selector:c+"#BtnMeseDown"},{ref:"BtnStampa",selector:c+"#BtnStampa"}]);b.control(c+"#GridServizi",{select:b.onServiziSelect});b.control(c+"#BtnCDIRicalcola",{click:b.clickBtnCDIRicalcola});b.on("aggiornaCalendario",
function(c){c=b.getGridServizi().getSelectionModel();var d=c.getSelection()[0];c.deselectAll();d?c.select([d]):msgShowText("Errore caricamento dati","Riselezionare l'utente")});b.control(c+"#BtnMeseUp",{click:function(){b.navigaMese("avanti")}});b.control(c+"#BtnMeseDown",{click:function(){b.navigaMese("indietro")}});b.control(c+"#BtnStampa",{click:b.clickBtnStampa});b.on("editMotivoAssenza",function(c,f){b.editMotivoAssenza(c,f)});b.on("loadTotali",function(c){b.loadGridTotali(c)});b.on("getGiornoById",
function(c,f){b.getGiornoById(c,f)})},clickBtnStampa:function(){var b=this.getGridServizi().getSelectionModel().getSelection();b[0]&&showWinStampa(CBA.moduli.moduloAttivo,CBA.parametriGenerali.codEnte,"CURilevazGiornaliera",{eseguiStampa:!0,dataDal:creaData(1,this.currentMonth,this.currentYear),dataAl:dataFineMese(this.currentMonth,this.currentYear),servizi:"("+b[0].get("idServizio")+")",tipoClassificazione:-1,elencoUtenti:"("+b[0].get("codOspite")+")"})},navigaMese:function(b){var c;"avanti"==b?
(b=12==this.currentMonth?1:this.currentMonth+1,c=12==this.currentMonth?this.currentYear+1:this.currentYear):(b=1==this.currentMonth?12:this.currentMonth-1,c=1==this.currentMonth?this.currentYear-1:this.currentYear);this.currentMonth=b;this.currentYear=c;this.fireEvent("aggiornaCalendario")},clickBtnCDIRicalcola:function(b){var c=[];this.getGridServizi().getStore().each(function(b){c.push(b.get("idServizio"))});c=c.toString();Ext.create("winCBA",{name:"GeneraliOSP.rilevazioneGgCdi.view.RicalcolaPianif",
titolo:"TITOLO_AGG_PIANIFICAZIONE",dimensione:3,configItem:{permesso:"S",dataInizio:creaData(1,this.currentMonth,this.currentYear),dataFine:dataFineMese(this.currentMonth,this.currentYear),codOspite:this.getPnlRicerca().down("#GridRicerca").getSelectionModel().getSelection()[0].data.codOspite,listaServizi:c,controllerRilevazioneCdi:this}}).show()},apriWinPrestazSupp:function(b,c,d){var f=c?traduci("TITOLO_EDITSCONTISUPPCDI"):traduci("TITOLO_EDITPRESTAZIONICDI"),f=f+(" "+b.down("#LabelNumGG").text+
" "+Ext.Date.monthNames[this.currentMonth-1]+" "+this.currentYear),g=isTipoServAmb(this.cbaConfig.tipoServizio)?800:500;Ext.create("winCBA",{name:"GeneraliOSP.rilevazioneGgCdi.view.EditPrestazioniSupp",titolo:f,altezzaWin:450,larghezzaWin:g,configItem:{permesso:"S",controllerRilevazioneCdi:this,soloScontiSupp:c,pnlGiorno:b,recordTestata:d,nuovaPianificazione:-999==b.down("#IdGiorno").getValue(),tipoServizio:this.cbaConfig.tipoServizio,bloccoCalendario:!b.down("#BtnLocked").isHidden()}}).show()},loadGiorni:function(b,
c,d,f){var g=this,h=g.getCntCalendar().down("#CbaPeriodo"),k,l;c&&g.clearGiorni(!0,f);var n;b.forEach(function(b){n=b.isModel?b.data:b;k=new Date(n.data);k=k.getDate();l=h.listaGg[h.listaIdGg.indexOf("WidgetGG"+k)];l.addCls("F"==n.modificato?"accessiPianificati":"pianificazioneModificata");b=l.down("#BtnPresente");var c=l.down("#LblAmbulatoriale"),d=0,f=0,p=0,x=0,v=isTipoServAmb(g.cbaConfig.tipoServizio);b.cbaConfig.isTipoServAmb=v;n.rilevazioneDettaglio.forEach(function(b){1==b.tipoRecord&&d++;v&&
("P"==b.stato&&f++,"E"==b.stato&&p++,"N"==b.stato&&x++)});c.setHidden(!0);if(isTipoServAmb(g.cbaConfig.tipoServizio)){if(0<d){var w="icon-circle-red-empty",y="";0<f&&(y=traduci("PIANIFICATO"),w="icon-circle-blue");0<p&&0==f&&(y="EROGATO",w="icon-circle-green");0<x&&0==f&&(y=traduci("NON_EROGATO"),w="icon-circle-orange");0<x&&0<p&&(y=traduci("PARZ_EROGATO"),w="icon-circle-violet");b.cbaConfig.isTipoServAmb=!0;b.show();b.setIconCls(w);b.setTooltip(traduci(y));c.setHidden(!1);c.setText(y)}}else 0<d&&
(n.presente?(w="T"==n.presente,b.show(),b.setIconCls(w?"presente":"assente"),b.setTooltip(w?traduci("PRESENTE"):traduci("ASSENTE"))):b.hide(),b=l.down("#BtnMotivoAssenza"),b.setHidden(w),b.setText(n.desMotivoAssenza),b.setTooltip(n.desMotivoAssenza));l.down("#IcnScontiSupp").setHidden(n.scontiSupplementi?!1:!0);g.genTooltipGiorno(l,!0);l.down("#IdGiorno").setValue(n.id);l.down("#GiornoVuoto").setValue("F")});g.getGridTotScontiSupp().getStore();c?g.loadGridTotali(!0):g.setGiorniFestiviChisura(h)},
clearGiorni:function(b,c){if(b)c.removeCls("accessiPianificati"),c.removeCls("pianificazioneModificata"),c.down("#BtnMotivoAssenza").hide(),c.down("#BtnPresente").hide(),c.down("#BtnLocked").hide(),c.down("#IdGiorno").setValue(-999),this.genTooltipGiorno(c);else{var d=this.currentYear,f=this.currentMonth,g=this.getCntCalendar().down("#CbaPeriodo");g&&g.destroy();this.creaCalendario(f,d);this.getLabMeseAnno().setText(Ext.Date.monthNames[f-1]+" "+d);this.totaleAssenze=this.totalePresenze=0;svuotaStore(this.getGridTotScontiSupp().getStore())}},
creaCalendario:function(b,c){var d=this,f=Ext.create("Generali.standard.datePicker.View",{itemId:"CbaPeriodo",flex:1,title:"",cbaConfig:{labelGgExt:!0,scartaHeaderStd:!0,scartaCellClickStd:!0,usaWidgetCella:!0,widget:{xtype:"panel",itemId:"PanelGiorno",cls:"",flex:1,minHeight:62,header:!1,layout:{align:"stretch",type:"vbox"},margin:"-3 -1 -3 -1",items:[{xtype:"container",layout:{type:"hbox"},height:30,padding:5,margin:"0 0 3 0",items:[{xtype:"numberfield",itemId:"IdGiorno",value:-999,hidden:!0},{xtype:"textfield",
itemId:"GiornoVuoto",value:"T",hidden:!0},{xtype:"label",itemId:"LabelNumGG",cls:"cbaLabel",text:"00",style:{"font-size":"16px !important"},margin:"5 0 0 5"},{xtype:"button",itemId:"BtnEliminaGG",iconCls:"icon-elimina",cls:"btnAssenzaRil",width:24,height:24,hidden:!0,listeners:{mouseout:function(b){var c=b.up("#PanelGiorno");b.hide();c.down("#LabelNumGG").show()},show:function(b){var c=b.up("#PanelGiorno").down("#LabelNumGG");c.cbaConfig.giaUscito&&(c.show(),b.hide())}},handler:function(b){var c=
this.up("#PanelGiorno");c.cbaConfig.suspendClick=!0;Ext.defer(function(){c.cbaConfig.suspendClick=!1},50);d.eliminaGiornata(b)}},{xtype:"container",flex:1},{xtype:"image",itemId:"BtnLocked",src:"/cba/generali/images/svg/others/locked.svg",height:16,width:16,margin:"0 3 0 0",hidden:!0},{xtype:"image",itemId:"IcnScontiSupp",src:"/cba/generali/images/32/plusminus.png",height:24,width:24,margin:"0 3 0 0",hidden:!0},{xtype:"button",itemId:"BtnPresente",iconCls:"presente",cls:"btnAssenzaRil",width:24,height:24,
hidden:!0,handler:function(b){if(!b.cbaConfig.isTipoServAmb){var c=this.up("#PanelGiorno");c.cbaConfig.suspendClick=!0;Ext.defer(function(){c.cbaConfig.suspendClick=!1},50);if(!c.down("#BtnLocked").isHidden())return msgShowWarning("ATTENZIONE",traduci("MSG_WARN_BLOCCO_CALENDARIO")),!1;"presente"==b.iconCls?Messaggio("ATTENZIONE","MSG_WARNING_ELIMINARE_SCONTI_SUPPLEMENTI","YESNO","WARNING",!1,function(){d.editStatoPresenza(b,"T")},function(){d.editStatoPresenza(b,"F")}):d.editStatoPresenza(b,"F")}}}]},
{xtype:"container",layout:{type:"hbox",pack:"center"},flex:1,margin:"2 5 0 5",items:[{xtype:"label",itemId:"LblAmbulatoriale",flex:1,maxWidth:170,text:"",margin:"0 0 5 0",hidden:!0},{xtype:"button",itemId:"BtnMotivoAssenza",flex:1,maxWidth:170,margin:"0 0 5 0",hidden:!0,handler:function(b){if("L"==d.cbaConfig.permesso)return!1;var c=this.up("#PanelGiorno");c.cbaConfig.suspendClick=!0;Ext.defer(function(){c.cbaConfig.suspendClick=!1},50);if(!c.down("#BtnLocked").isHidden())return msgShowWarning("ATTENZIONE",
traduci("MSG_WARN_BLOCCO_CALENDARIO")),!1;Ext.create("winCBA",{name:"GeneraliOSP.rilevazioneGgCdi.view.ListaMotiviAssenza",titolo:"MOTIVI_ASSENZA",altezzaWin:200,larghezzaWin:300,configItem:{permesso:"S",controllerRilevazioneCdi:d,panelGiorno:c,servizio:d.getGridServizi().getSelectionModel().getSelection()[0],btnMotAssenza:b}}).showBy(c,!1)}}]}],listeners:{render:function(b){var c=d.cbaConfig.tipoServizio;d.genTooltipGiorno(b);d.tooltip=Ext.create("Ext.tip.ToolTip",{target:b.getId(),height:130,width:150,
listeners:{beforeshow:function(c){c.removeAll();c.setTitle(traduci(b.titolo));c.add(b.contenuto)}}});b.getEl().on("click",function(c){b.cbaConfig.suspendClick||d.clickWidgetGiorno(b)});var f=Ext.create("Ext.Button",{itemId:"BtnEliminaGG",iconCls:"icon-elimina",width:26,height:26,margin:"-4 -4 0 0",floating:!0,cbaConfig:{mouseOver:!1},listeners:{mouseover:function(b){b.cbaConfig.mouseOver=!0},mouseout:function(c){c.cbaConfig.mouseOver=!1;b.cbaConfig.mouseOver||(c.hide(),b.removeCls("hoverGgCalendarCDI"))},
render:function(b){b.addCls("hoverGgCalendarCDI")},click:function(c){d.eliminaGiornata(c,b)}}});b.getEl().on("mouseenter",function(g){"M"!=c&&-999!=b.down("#IdGiorno").getValue()&&"S"==d.cbaConfig.permesso&&(b.cbaConfig.mouseOver=!0,b.addCls("hoverGgCalendarCDI"),f.showAt(b.getXY()[0]-15+b.width,b.getXY()[1]-15))});b.getEl().on("mouseleave",function(d){"M"!=c&&(b.cbaConfig.mouseOver=!1,Ext.defer(function(){f.cbaConfig.mouseOver||(f.hide(),b.removeCls("hoverGgCalendarCDI"))},50))})}},cbaConfig:{suspendClick:!1,
mouseOver:!1}},onWidgetAttach:function(b,c){var d=this.up("cbaDatePicker");if(c.title&&"Invalid Date"!==(new Date(c.title)).toString()){var f=c.title.getDate();c.down("label").setText(f);d.listaIdGg.push("WidgetGG"+f);d.listaGg.push(c)}else c.hide()},mese:b,anno:c},listeners:{}});d.getCntCalendar().add(f)},genTooltipGiorno:function(b,c,d){var f;f=d?[{xtype:"container",width:140,layout:{align:"stretch",type:"vbox",pack:"center"},padding:5,items:[{xtype:"fieldset",layout:{type:"vbox",align:"stretch",
pack:"center"},items:[{xtype:"container",layout:{type:"hbox",align:"center"},margin:"5 0 5 0",items:[{xtype:"container",flex:1},{xtype:"image",src:"/cba/generali/images/32/cancel.png",height:32,width:32},{xtype:"container",flex:1}]},{xtype:"label",html:"<center>"+traduci("CU_GIORNO_NON_INCL_RICOVERO")+"</center>",cls:"cbaLabel",margin:"0 0 5 0"}]}]}]:c?[{xtype:"container",width:140,layout:{align:"stretch",type:"vbox",pack:"center"},padding:5,items:[{xtype:"fieldset",layout:{type:"vbox",align:"stretch",
pack:"center"},items:[{xtype:"container",layout:{type:"hbox",align:"center"},margin:"5 0 5 0",items:[{xtype:"container",flex:1},{xtype:"button",iconCls:"icon-finger-click",scale:"large"},{xtype:"container",flex:1}]},{xtype:"label",html:"<center>"+traduci("CLICK_MODIFICARE_PIANIFICAZIONE")+"</center>",cls:"cbaLabel",margin:"0 0 5 0"}]}]}]:[{xtype:"container",width:140,layout:{align:"stretch",type:"vbox",pack:"center"},padding:5,items:[{xtype:"fieldset",layout:{type:"vbox",align:"stretch",pack:"center"},
items:[{xtype:"container",layout:{type:"hbox",align:"center"},margin:"5 0 5 0",items:[{xtype:"container",flex:1},{xtype:"button",iconCls:"icon-finger-click",scale:"large"},{xtype:"container",flex:1}]},{xtype:"label",html:"<center>"+traduci("CLICK_INSERIRE_PIANIFICAZIONE")+"</center>",cls:"cbaLabel",margin:"0 0 5 0"}]}]}];b.titolo=d?"GIORNO_NON_PIANIFICABILE":c?"GIORNO_PIANIFICATO":"GIORNO_NON_PIANIFICATO";b.contenuto=f},clickWidgetGiorno:function(b){if(b.isDisabled())return!1;var c=b.down("#IdGiorno").getValue(),
c=this.storeRil.getById(c);this.apriWinPrestazSupp(b,this.getCntCalendar().cbaConfig.disabilitaPrestazioni,c)},caricaServizi:function(b,c){var d=this,f=d.getGridServizi().getStore(),g=d.getPnlRicerca();d.gridTotPrestAmb&&svuotaStore(d.gridTotPrestAmb.controller.getGridRetteAmb().store);if(!b){var h=g.down("#GridRicerca").getSelectionModel().getSelection()[0];b=h?h.data.codOspite:-1}d.getCntCalendar().setDisabled(!0);f.getProxy().extraParams.codospite=b;f.getProxy().extraParams.dataDal=g.down("#DataDal").getValue();
f.getProxy().extraParams.dataAl=g.down("#DataAl").getValue();f.load({callback:function(b,g,h){b&&0<b.length?(d.getCntCalendar().setDisabled(!1),b=0,c&&(b=trovaRecord(f,"idRicovero",c)),g=d.getGridServizi(),g.getSelectionModel().deselect(b),g.getSelectionModel().select(b),g.getSelectionModel().getSelection()):(d.getCntCalendar().setDisabled(!0),svuotaStore(f))}})},onServiziSelect:function(b,c,d,f){var g=this,h=g.storeExtraRetta;b=g.getPnlRicerca().down("#GridRicerca").getSelectionModel().getSelection()[0];
d=c.get("servizio").tipoServizio;f="S"==d||"A"==d||"D"==d;var k=isTipoServAmb(d);g.cbaConfig.tipoServizio=c.get("servizio").tipoServizio;g.getCntCalendar().cbaConfig.disabilitaPrestazioni=!f&&!k;g.getGridTotScontiSupp().setVisible(f);g.getCntTotPrestAmb().setVisible(k);g.getNomeUtente().setText(b.get("nominativo"));Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/cdi/bloccoCalendario/getGGBloccati",params:{idServizio:g.getGridServizi().getSelectionModel().getSelection()[0].get("idServizio"),
dataDal:creaData(1,g.currentMonth,g.currentYear),dataAl:dataFineMese(g.currentMonth,g.currentYear)},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?g.ggBloccoCalendario=b.data:msgShowError("",b.message);k?(g.gridTotPrestAmb||(g.gridTotPrestAmb=Ext.create("GeneraliOSP.portlet.view.PortletClassificazioniAmb",{cbaConfig:{fromRilevazioniCdi:!0}}),g.getCntTotPrestAmb().add(g.gridTotPrestAmb)),g.gridTotPrestAmb.controller.updateDati(c.get("idRicovero")),g.aggiornaGiorniCalendario()):(h.getProxy().extraParams.idRicovero=
c.get("idRicovero"),h.filter("fattoreMoltiplicazione","R"),h.filter("isActive","T"),h.load({callback:function(b,c,d){g.aggiornaGiorniCalendario()}}))}})},aggiornaGiorniCalendario:function(b){var c=this,d=c.storeRil;c.clearGiorni();c.cbaConfig.inElaborazione=!0;Ext.apply(d.getProxy().extraParams,{idRicovero:b?b:c.getGridServizi().getSelectionModel().getSelection()[0].get("idRicovero"),dataDal:creaData(1,c.currentMonth,c.currentYear),dataAl:dataFineMese(c.currentMonth,c.currentYear)});d.load({callback:function(b,
d,h){h?(c.loadGiorni(b),c.cbaConfig.inElaborazione=!1,c.controllaGiorniRicovero(),c.controllaGiorniBloccoCalendario(),c.loadGridTotali(!0)):msgShowError("",d.getError())}})},controllaGiorniRicovero:function(){var b=this.getGridServizi().getSelectionModel().getSelection()[0],c=dataFineMese(this.currentMonth,this.currentYear).getDate(),d=b.get("dataDal").getFullYear(),f=b.get("dataDal").getMonth()+1,g=b.get("dataDal").getDate();d==this.currentYear&&f==this.currentMonth?this.disattivaSingoliGiorni(1,
g):(f>this.currentMonth&&d==this.currentYear||d>this.currentYear)&&this.disattivaSingoliGiorni(1,c+1);b.get("dataAl")&&(d=b.get("dataAl").getFullYear(),f=b.get("dataAl").getMonth()+1,b=b.get("dataAl").getDate(),d==this.currentYear&&f==this.currentMonth?this.disattivaSingoliGiorni(b+1,c+1):(this.currentMonth>f&&this.currentYear==d||this.currentYear>d)&&this.disattivaSingoliGiorni(1,c+1))},controllaGiorniBloccoCalendario:function(){this.getGridServizi().getSelectionModel().getSelection();for(var b=
this.getCntCalendar().down("#CbaPeriodo"),c=dataFineMese(this.currentMonth,this.currentYear).getDate(),d,f=1;f<c+1;f++)d=b.listaGg[b.listaIdGg.indexOf("WidgetGG"+f)],d.isDisabled()||Ext.isEmpty(this.ggBloccoCalendario)||!this.ggBloccoCalendario.split(",").includes(f.toString())||(d.down("#BtnLocked").show(),d.titolo="Blocco registro<br>presenze",d.contenuto=null)},disattivaSingoliGiorni:function(b,c){for(var d=this.getCntCalendar().down("#CbaPeriodo"),f,g=b;g<c;g++)f=d.listaGg[d.listaIdGg.indexOf("WidgetGG"+
g)],f.setDisabled(!0),this.genTooltipGiorno(f,!1,!0)},loadGridTotali:function(b){var c=this,d=c.getGridServizi().getSelectionModel().getSelection()[0].get("idRicovero");if(isTipoServAmb(c.cbaConfig.tipoServizio))c.gridTotPrestAmb.controller.updateDati(d);else{var f=c.getGridTotScontiSupp().getStore();svuotaStore(f);f.load({params:{idRicovero:d,dataDal:creaData(1,c.currentMonth,c.currentYear),dataAl:dataFineMese(c.currentMonth,c.currentYear)},callback:function(){b&&c.updateTotPresenzeAssenze()}})}},
updateTotPresenzeAssenze:function(){var b=this,c=b.getGridTotScontiSupp().getStore(),d=c.findRecord("valore",traduci("PRESENZE")),f=c.findRecord("valore",traduci("ASSENZE"));d&&c.remove(d);f&&c.remove(f);b.totalePresenze=0;b.totaleAssenze=0;var g,h;b.storeRil.each(function(c){h=!1;g=c.get("rilevazioneDettaglio");0<g.length&&g.forEach(function(b){1==b.tipoRecord&&(h=!0)});h&&("T"==c.get("presente")?b.totalePresenze++:b.totaleAssenze++)});if(0!=b.totalePresenze||0!=b.totaleAssenze)c.insert(0,{valore:traduci("ASSENZE"),
extra:b.totaleAssenze}),c.insert(0,{valore:traduci("PRESENZE"),extra:b.totalePresenze}),Ext.defer(function(){b.getGridTotScontiSupp().getView().focusRow(0)},10)},setGiorniFestiviChisura:function(b){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/prszn/chiusuraApertura/situazioneGiorno",params:{idServizio:this.getGridServizi().getSelectionModel().getSelection()[0].get("idServizio"),dataDal:creaData(1,this.currentMonth,this.currentYear),dataAl:dataFineMese(this.currentMonth,this.currentYear)},
success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){var d,f;c.data.forEach(function(c){c.chiuso&&(d=new Date(c.data),d=d.getDate(),f=b.listaGg[b.listaIdGg.indexOf("WidgetGG"+d)],f.down("#LabelNumGG").addCls("cbaLabelRed"))})}else msgShowError("",c.message)}})},getGiornoById:function(b,c){var d=this,f=d.storeRil.findRecord("id",c);Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/head/get",params:{id:c},success:function(c){c=Ext.JSON.decode(c.responseText);
c.success?(d.updateStoreSingoloGg(c.data,f),d.loadGiorni([c.data],!0,f,b)):msgShowError("",c.message)}})},eliminaGiornata:function(b,c){if(!c.down("#BtnLocked").isHidden())return msgShowWarning("ATTENZIONE",traduci("MSG_WARN_BLOCCO_CALENDARIO")),!1;var d=this,f=c.down("#IdGiorno").getValue(),g=d.storeRil.findRecord("id",f);Messaggio("ATTENZIONE","CU_ELIMINARE_PIANIFICAZIONE_GIORNATA","YESNO","QUESTION",!1,function(){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/detail/deleteAll",
params:{idTestata:f},success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){var f=[];msgAdd(f,b.message);msgShow("MSG_SALVATAGGIO_DATI",f);b=b.data;f=[];d.updateStoreSingoloGg(b,g);f.push(b);d.loadGiorni(f,!0,g,c)}else msgShowError("",b.message)}})},function(){},!1,!0)},editStatoPresenza:function(b,c){var d=this;if("L"==d.cbaConfig.permesso)return!1;var f=b.up("#PanelGiorno"),g="presente"==b.iconCls,h=f.down("#IdGiorno").getValue(),k=d.storeRil.findRecord("id",h).data,l=Ext.clone(k);
Ext.apply(k,{presente:g?"F":"T",modificato:"T"});g&&Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/cdi/head/dayass",params:{idRicovero:d.getGridServizi().getSelectionModel().getSelection()[0].get("idRicovero"),day:creaData(f.down("#LabelNumGG").text,d.currentMonth,d.currentYear)},method:"GET",async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);Ext.apply(k,{motivoAssenza:b.data.codice})},failure:function(b){b=Ext.JSON.decode(b.responseText);msgShowError("",b.message)}});Ext.Ajax.request({url:getUrlGen()+
"/ws/genOsp/cdi/rilevazione/head/update",method:"POST",async:!1,jsonData:k,deleteScontSupp:c,params:{deleteScontSupp:c},success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){var c=[];msgAdd(c,b.message);msgShow("MSG_SALVATAGGIO_DATI",c);d.updateStoreSingoloGg(b.data,k);d.loadGiorni([b.data],!0,l,f)}else msgShowError("",b.message)}})},editMotivoAssenza:function(b,c){var d=this,f=b.up("#PanelGiorno"),g=f.down("#IdGiorno").getValue(),h=d.storeRil.findRecord("id",g).data,k=Ext.clone(h);
Ext.apply(h,{motivoAssenza:c.get("codice"),modificato:"T"});delete h.desMotivoAssenza;Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/head/update",method:"POST",async:!1,jsonData:h,params:{},success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){var c=[];msgAdd(c,b.message);msgShow("MSG_SALVATAGGIO_DATI",c);d.updateStoreSingoloGg(b.data,h);d.loadGiorni([b.data],!0,k,f)}else msgShowError("",b.message)}})},updateStoreSingoloGg:function(b,c){this.storeRil.remove(c);this.storeRil.insert(0,
b)},setStyleModificato:function(b,c){b.removeCls(c?"accessiPianificati":"pianificazioneModificata");b.addCls(c?"pianificazioneModificata":"accessiPianificati")},onLaunch:function(){var b=this,c=Ext.create("GeneraliOSP.cercaFascicolo.view.Cerca",{cbaConfig:{filtroClassificazione:!0,filtroSede:!0,afterLoadGridRicerca:function(c,f){var d=f.getGridRicerca().getSelectionModel().getSelection()[0];b.getCntGest().setDisabled(!d);svuotaStore(b.getGridServizi().getStore());d=b.getPnlRicerca().down("#Anno");
d.on("change",function(c,d,f){b.currentYear=d;b.fireEvent("aggiornaCalendario")});b.currentYear=d.getValue();d=b.getPnlRicerca().down("#Mese");d.on("change",function(c,d,f){b.currentMonth=d;b.fireEvent("aggiornaCalendario")});b.currentMonth=d.getValue();b.clearGiorni()},selectGridRicerca:function(c,f){b.currentMonth=b.getPnlRicerca().down("#Mese").getValue();b.currentYear=b.getPnlRicerca().down("#Anno").getValue();b.getCntGest().setDisabled(!1);b.caricaServizi();var d=f.get("codOspite");d&&(d=Ext.create("CU.incassoPensioni.view.PnlDatiUtente",
{cbaConfig:{idUtente:d}}),setToolTip("ToolTipUtente",b.getNomeUtente().id,"","DATI_UTENTE",200,370,d))},changeCampiRicerca:function(b){},annoMese:!0,hideNumFascicolo:!0}});b.getPnlRicerca().add(c);b.storeRil=Ext.create("GeneraliOSP.rilevazioneGgCdi.store.RilevazioneCdi",{autodestroy:!0});b.storeExtraRetta=Ext.create("GeneraliOSP.portlet.store.ExtraRetta",{autodestroy:!0});ImpostaUrl([b.storeExtraRetta,b.getGridServizi().getStore(),b.storeRil,b.getGridTotScontiSupp().getStore()]);b.totalePresenze=
0;b.totaleAssenze=0;b.getBtnCDIRicalcola().setHidden("L"==b.cbaConfig.permesso);b.permessoClassif="N";Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/permesso/videata",params:{idModulo:CBA.moduli.moduloAttivo,idVideata:"Classificazioni"},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?b.permessoClassif=c.data:msgShowError("",c.message)}});b.permessoScontiSupp="N";Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/permesso/videata",params:{idModulo:CBA.moduli.moduloAttivo,idVideata:"EditScontiSupp"},
success:function(c){c=Ext.JSON.decode(c.responseText);c.success?b.permessoScontiSupp=c.data:msgShowError("",c.message)}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.controller.RilevazioneCdiGiornaliera",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"},{ref:"PnlRicerca",selector:this.selContainer+"#PnlRicerca"},{ref:"CntCalendario",selector:this.selContainer+"#CntCalendario"},{ref:"CBServizio",selector:this.selContainer+"#CBServizio"},{ref:"CBSedeRepStanza",selector:this.selContainer+
"#CBSedeRepStanza"},{ref:"CBPrestazione",selector:this.selContainer+"#CBPrestazione"},{ref:"CBMotiviAssenza",selector:this.selContainer+"#CBMotiviAssenza"},{ref:"SgmBtnPeriodo",selector:this.selContainer+"#SgmBtnPeriodo"},{ref:"BtnAvantiDay",selector:this.selContainer+"#BtnAvantiDay"},{ref:"DataRilev",selector:this.selContainer+"#DataRilev"},{ref:"MeseRilev",selector:this.selContainer+"#MeseRilev"},{ref:"AnnoRilev",selector:this.selContainer+"#AnnoRilev"},{ref:"BtnIndietroDay",selector:this.selContainer+
"#BtnIndietroDay"},{ref:"BtnCerca",selector:this.selContainer+"#BtnCerca"},{ref:"BtnCalcPianificazione",selector:this.selContainer+"#BtnCalcPianificazione"},{ref:"SgmBtnModalita",selector:this.selContainer+"#SgmBtnModalita"}]);this.control(this.selContainer+"#CBServizio",{change:this.changeServizio});this.control(this.selContainer+"#CBSedeRepStanza",{});this.control(this.selContainer+"#SgmBtnPeriodo",{change:this.changeSgmBtnPeriodo});this.control(this.selContainer+"#BtnIndietroDay",{click:this.onClickBtnDay});
this.control(this.selContainer+"#BtnAvantiDay",{click:this.onClickBtnDay});this.control(this.selContainer+"#MeseRilev",{select:this.changeMeseRilev});this.control(this.selContainer+"#BtnCerca",{click:this.onClickBtnCerca});this.control(this.selContainer+"#BtnCalcPianificazione",{click:this.onClickBtnCalcPianificazione});this.control(this.selContainer+"#SgmBtnModalita",{change:this.onchangeSgmBtnModalita})},onClickBtnCalcPianificazione:function(b){var c=this;b=c.getCBServizio().getValue();var d=c.getDataRilev().getValue(),
f=c.calendario.getStartStopDayRange(d)[1];b=Ext.create("winCBA",{name:"GeneraliOSP.rilevazioneGgCdi.view.RicalcolaPianif",titolo:"TITOLO_AGG_PIANIFICAZIONE",dimensione:3,configItem:{permesso:"S",dataInizio:d,dataFine:f,codOspite:0,listaServizi:b,controllerRilevazioneCdi:c,rilevGg:!0},closable:!0});b.show();b.on("close",function(){c.onClickBtnCerca()})},changeSgmBtnPeriodo:function(b,c,d,f){b=27<c;d=this.getDataRilev().getValue().getMonth();f=this.calendario.getCercaNominativo().getValue();this.cbaConfig.cfgCalendario.rilevGgRangeDays=
c;this.getDataRilev().setHidden(b);this.getMeseRilev().setHidden(!b);this.getMeseRilev().setValue(d+1);this.getAnnoRilev().setHidden(!b);this.getAnnoRilev().setHtml(this.getDataRilev().getValue().getFullYear());b&&(c=this.changeMeseRilev());this.paramRicerca&&c&&(this.onClickBtnCerca(),f&&this.calendario.getCercaNominativo().setValue(f))},changeMeseRilev:function(b,c,d){c=this.getMeseRilev().getValue();b=this.getDataRilev();b.setValue(giornoInizioMese(creaData(1,c,b.getValue().getFullYear())));c=
giornoFineMese(b.getValue()).getDate();this.cbaConfig.cfgCalendario.rilevGgRangeDays=c;this.getAnnoRilev().setHtml(b.getValue().getFullYear());return c},onClickBtnDay:function(b,c,d){c=this.getDataRilev();d=c.value?new Date(c.value):new Date;var f=Ext.Date.add(d,Ext.Date.DAY,b.tDay*this.cbaConfig.cfgCalendario.rilevGgRangeDays);28<=this.cbaConfig.cfgCalendario.rilevGgRangeDays&&(f=creaData(1,d.getMonth()+1+b.tDay,d.getFullYear()),this.cbaConfig.cfgCalendario.rilevGgRangeDays=giornoFineMese(f).getDate());
c.setValue(f);this.getMeseRilev().setValue(c.getValue().getMonth()+1);this.getAnnoRilev().setHtml(c.getValue().getFullYear());this.onClickBtnCerca()},initIconGrid:function(){this._idMotAssPredefinita=0;this._clsPresente="icon-circle-green";this._clsAssente="icon-circle-red";this._clsPrestazione="icon-circle-blue";this._bgColorPlanMod=this._bgColor="#ff6";this._txtLabelPresente="P";this._txtLabelAssente="A";this._txtLabelPrestazione="Pr";this._txtLabelPlanMod="*";this._txtDescLabelPresente="Presente";
this._txtDescLabelAssente="Assente";this._txtDescLabelPrestazione="Prestazione/Sconto/Supplemento";this._txtDescLabelPlanMod="Pianificazione Modificata"},getCharCircle:function(b){var c="",d=this.getTdClsGridCell(b);d==this._clsPresente&&(c=this._txtLabelPresente);d==this._clsAssente&&(c=this._txtLabelAssente);d==this._clsPrestazione&&(c=this._txtLabelPrestazione);this.getBackGroundColor(b)=="background-color: "+this._bgColorPlanMod+";"&&(c+=this._txtLabelPlanMod);""!=c&&(c='<font color="white">'+
c+"</font>");return c},getTipMotivoAssenza:function(b){var c=b.split(";");b="";if("null"!=c[2]){var d=this.getCBMotiviAssenza().getStore();(c=trovaRecord(d,"codice",c[2]))&&c.get("valore")&&(b='data-qtip="'+c.get("valore")+'"')}return b},getTdClsGridCell:function(b){var c="";if(b&&"-"!=b[0]){b=b.split(";");var d="null"!=b[1]&&0!=b[1],f=b[2]&&"null"!=b[2]&&"-"!=b[2][0];isTipoServAmb(this.cbaConfig.cfgCalendario.tipoServizio)?c=this._clsPrestazione:(d&&(c=this._clsPrestazione),f?(1!=this.cbaConfig.cfgCalendario.modalitaGriglia&&
(c=this._clsAssente),0==b[2]&&"+"!=b[2][0]&&(c=""),0==b[1]&&"+"!=b[1][0]&&(c="")):d||(c=this._clsPresente,0==b[1]&&(c="")))}return c},getBackGroundColor:function(b){var c="";b&&(b=b.split(";"),"M"==b[3]||"+"==b[0]||"-"==b[0][0]?c="background-color: "+this._bgColor+";":b[3]&&"PM"==b[3]&&(c="background-color: "+this._bgColorPlanMod+";"));return c},loadLegenda:function(b){var c,d=this.cbaConfig.cfgCalendario.modalitaGriglia;c="<table><td>LEGENDA: </td>";c=1==d||isTipoServAmb(this.cbaConfig.tipoServizio)?
c+('<td class="x-grid-cell x-grid-td '+this._clsPrestazione+' x-grid-cell-first x-unselectable" style="width: 18px; text-align:center;" ><font color="white">'+this._txtLabelPrestazione+"</font></td><td>"+this._txtDescLabelPrestazione+"</td>"):c+('<td class="x-grid-cell x-grid-td '+this._clsPresente+' x-grid-cell-first x-unselectable" style="width: 18px; text-align:center;" ><font color="white">'+this._txtLabelPresente+"</font></td><td>"+this._txtDescLabelPresente+'</td><td class="x-grid-cell x-grid-td '+
this._clsAssente+' x-grid-cell-first x-unselectable" style="width: 18px; text-align:center;" ><font color="white">'+this._txtLabelAssente+"</font></td><td>"+this._txtDescLabelAssente+"</td>");c+='<td class="x-grid-cell x-grid-td x-grid-cell-first x-unselectable" style="width: 18px; text-align:center; background-color:'+this._bgColorPlanMod+';" >'+this._txtLabelPlanMod+"</td><td>"+this._txtDescLabelPlanMod+"</td><table>";1200<Ext.getBody().getViewSize().width?(b=this.calendario.getLegenda(),b.show(),
b.setHtml(c)):(b.show(),creaToolTipInfo(b,c,"LEGENDA"));return c},validaCampiRicerca:function(){var b=this.getCBServizio(),c=this.getCBSedeRepStanza(),d="",f=this.cbaConfig.cfgCalendario.modalitaGriglia;b.isValid()||(d+=b.fieldLabel+"<BR>");c.isValid()||(d+=c.fieldLabel+"<BR>");1==f?(b=this.getCBPrestazione(),b.isValid()||(d+=b.emptyText+"<BR>")):2==f&&(b=this.getCBMotiviAssenza(),b.isValid()||(d+=b.emptyText+"<BR>"));0<d.length&&msgShowWarning(traduci("MSG_CAMPI_OBBLIGATORI"),d);return 0==d.length},
onDirtyGrid:function(b){b?this.getPnlRicerca().disable():this.getPnlRicerca().enable()},onClickBtnCerca:function(){var b=this;b.validaCampiRicerca()&&(b.getBtnCalcPianificazione().enable(!0),b.calendario.grigliaModificata?Messaggio("ATTENZIONE","MSG_FORM_DIRTY","YESNO","WARNING",!1,function(){b.cerca();b.calendario.grigliaModificata=!1},function(){}):b.cerca())},cerca:function(){var b=this;if(b.leggiParamRicerca()){var c=b.calendario.getGridCalendario(),d=c.getStore(),f=c.columns[1];svuotaStore(d);
c=Ext.create("GeneraliOSP.rilevazioneGgCdi.store.RilevazioneCdiGiornalieraCalendario");c.getProxy().extraParams=b.paramRicerca;c.load({callback:function(c,h,k){if(k){var g=[];b.ggBloccoCalendario=Ext.isEmpty(c)?"":c[0].get("ggBloccoCalendario");b.calendario.createGrid(b.cbaConfig.cfgCalendario.rilevGgRangeDays,b.getDataRilev().getValue());c.forEach(function(b){b=b.getData();for(var c={id:b.codOspite,idRicovero:b.idRicovero,nominativo:b.nominativo,dataNascita:b.dataNascita},d=0;d<b.giorno.length;d++)c["giorno"+
(d+1)]=b.giorno[d];Ext.apply(c,{oldRec:b});g.push(c)});d.loadData(g);d.commitChanges();b.getCntCalendario().isHidden()&&b.getCntCalendario().show();b.loadLegenda();f&&f.setText(traduci("UTENTI")+": "+d.getData().length)}else msgShowError("",h.getError())}})}},getTipoRecordCbPrestazioni:function(){var b=this.getCBPrestazione().getSelection(),c=0;null!=b&&(c=b.get("gruppo"),c="PRESTAZIONI"==c?1:"SCONTI"==c?2:"SUPPLEMENTI"==c?3:0);return c},leggiParamRicerca:function(){var b=this.getDataRilev().getValue(),
b=this.calendario.getStartStopDayRange(b),c=this.getCBPrestazione().getSelection(),d=this.getCBSedeRepStanza().getSelection();this.calendario.view.cbaConfig.rispostaSearch=this.getCBPrestazione().getValue();this.paramRicerca={dataDal:b[0],servizio:this.getCBServizio().getValue(),sede:null==d||null==d.get("idSede")?0:d.get("idSede"),reparto:null==d||null==d.get("idReparto")?0:d.get("idReparto"),stanza:null==d||null==d.get("idStanza")?0:d.get("idStanza"),rangeDay:this.cbaConfig.cfgCalendario.rilevGgRangeDays,
risposta:null==c?0:c.get("codice"),tipoRisposta:this.getTipoRecordCbPrestazioni(),start:0,limit:0};return!0},onClickAnagrafica:function(b){var c=this.cbaConfig.idModuloPrg,d=b.data.oldRec.codOspite,f=b.data.idRicovero,g=b.data.nominativo;b=FormattaData(b.data.dataNascita);b=traduci("MSG_APRI_FASCICOLO",[g+" ("+b+") "]);Messaggio("FASCICOLO",b,"YESNO","WARNING",!1,function(){eseguiModulo(c,"btnOSP_Anagrafica",{codOspite:d,idRicovero:f});setTimeout(function(){var b=null,c=0;Ext.each(Sipcar.app.getController("Menu").getCardApplicativo().items.items,
function(d){if(43==d.cbaConfig.idModulo||50==d.cbaConfig.idModulo)Sipcar.app.getController("Menu").getTabApplicativi().setActiveTab(c),b=d.down("#Cerca");c++});b&&(trovaButtonMenu("btnOSP_Anagrafica").cbaConfig.idRicovero=0<f?f:null,g&&b.controller.getCognome().setValue(g),b.controller.cerca({codOspite:d}))},3500)},function(){})},gridCellClick:function(b){var c=b.cellIndex,c=new Date(this.paramRicerca.dataDal.getTime()+864E5*c),d=null==b.record.getData().oldRec.pianificataValiditaDal?null:new Date(b.record.getData().oldRec.pianificataValiditaDal);
(null==d||c<d)&&this.savePlan(b,c)},gridCellClickPA:function(b){return this.getCBMotiviAssenza().getValue()},savePlan:function(b,c){var d=this,f=b.record,g={},h=[],k=f.getData().oldRec,l=k.idRisposta,n=k.tipoRisposta,k={},p=d.getCBServizio().getSelection().get("extra").split(",")[1];f.data.idServizio=d.getCBServizio().getValue();f.data.servizio={tipoServizio:p,regione:d.cbaConfig.regione?d.cbaConfig.regione:d.getCBServizio().getSelection().get("extra").split(",")[0]};Ext.apply(k,{idRisposta:f.getData().oldRec.idRisposta,
tipoRecord:n});h.push(k);Ext.apply(g,{id:null,idRicovero:f.getData().idRicovero,data:giornoInizioMese(c),presente:"T",motivoAssenza:null,rilevazioneDettaglio:h});extraParams={dataRicovero:new Date(f.getData().oldRec.dataRicovero)};var q="RES";"S"==p||"A"==p?q="CDI":"M"==p&&(q="AMB");Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/gg/savePlan",method:"POST",async:!1,jsonData:Ext.JSON.encode(g),params:extraParams,success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){var g=
[];msgAdd(g,c.message);msgShow("MSG_SALVATAGGIO_DATI",g);1==n?(nameWin="GeneraliOSP.portlet.view.EdtClassificazioni",titoloWin="OSP_CLASSIFICAZIONI"):(nameWin="GeneraliOSP.portlet.view.EdtScontiSupp",titoloWin="TITOLO_EDITSCONTISUPP");c.data={idRisposta:l};Ext.create("winCBA",{name:nameWin,titolo:titoloWin,dimensione:1,configItem:{rilevazioneGg:!0,permesso:"S",currRicovero:f,noPortlet:!0,selezionaRecord:c.data,tipoClRetta:q,hideClassReg:!1,hideClassInt:!1},closable:!0}).show().on("close",function(){d.aggiornaCellaModInsMas(b)})}else msgShowError("",
c.message)}})},gridCellDblClick:function(b){var c=this,d=c.getCBServizio().getSelection(),f=b.record,g=b.cellIndex;idTestata=(giorno=f.data["giorno"+(g+1)])?giorno.split(";")[0]:null;idRicovero=f.get("idRicovero");dataRil=c.paramRicerca.dataDal;daySelected=new Date(dataRil.getTime()+864E5*g);recTestata=[];titoloWin=traduci("TITOLO_EDITPRESTAZIONICDI");soloScontiSupp=!1;servizio=d.get("codice");tipoServizio=d.get("extra").split(",")[1];tipoServizio.includes("R")&&(soloScontiSupp=!0,titoloWin=traduci("TITOLO_EDITSCONTISUPPCDI"));
titoloWin+=" "+Ext.Date.format(daySelected,"j F Y")+" "+f.get("nominativo");if(idTestata){for(var h,d=[],k=[],k=f.get("oldRec").giornate,l=0;l<k.length;l++){var n=k[l];0==Ext.Date.getElapsed(new Date(n.data),daySelected)&&(h=n,d=n.rilevazioneDettaglio)}recTestata={id:idTestata,idRicovero:idRicovero,dataRicovero:new Date(f.get("oldRec").dataRicovero),idServizio:servizio,presente:h.presente,data:{rilevazioneDettaglio:d}}}else recTestata={idRicovero:idRicovero,dataRicovero:new Date(f.get("oldRec").dataRicovero),
idServizio:servizio,presente:soloScontiSupp?"T":"F"};f=isTipoServAmb(tipoServizio)?800:500;Ext.create("winCBA",{name:"GeneraliOSP.rilevazioneGgCdi.view.EditPrestazioniSupp",titolo:titoloWin,altezzaWin:450,larghezzaWin:f,configItem:{permesso:c.cbaConfig.permesso,controllerRilevazioneCdi:c,soloScontiSupp:soloScontiSupp,pnlGiorno:null,recordTestata:recTestata,nuovaPianificazione:idTestata?!1:!0,rilGiorno:!0,dataSelezionata:daySelected,tipoServizio:tipoServizio,bloccoCalendario:b.th.headerCt.items.items[g].locked}}).show().on("close",
function(){c.aggiornaCellaModVista(b,this.retValue)})},aggiornaCellaModInsMas:function(b){var c=this.paramRicerca.dataDal,d=this.paramRicerca.risposta,f=this.paramRicerca.tipoRisposta,g=b.record.get("idRicovero"),h="",k={};"1"==f?(h=getUrlGen()+"/ws/genOsp/cdi/head/search",d=b.cellIndex,c=new Date(c.getTime()+864E5*d),k={idRicovero:g,dataDal:c,dataAl:c}):(h=getUrlGen()+"/ws/genOsp/rette/extra/src",k={eleExtra:d,idRicovero:g,dataRile:c});Ext.Ajax.request({method:"GET",url:h,params:k,success:function(c){c=
Ext.JSON.decode(c.responseText);if(c.success){if(c.data){var d;0<c.data.length&&(d=c.data[0],d="1"==f?d.dataDecorrenza:d.dataDal);d&&(b.record.data.oldRec.pianificataValiditaDal=d)}}else msgShowError("",c.message)}})},aggiornaCellaModVista:function(b,c){var d=this,f=null,g=c?c.idTestata:null,h=c?c.modifiche:null;g&&0<h&&(f=g+";null;null",Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/head/get",params:{id:g,forceLazyLoad:!0},success:function(c){c=Ext.JSON.decode(c.responseText);
if(c.success){var h=b.record.data.oldRec.giornate.findIndex(function(b){return b.id==g});0>h?b.record.data.oldRec.giornate.push(c.data):b.record.data.oldRec.giornate[h]=c.data;d.calendario.callBack_GridCellDblClick(b,f+";M")}else msgShowError("",c.message)}}))},onchangeSgmBtnModalita:function(b,c,d,f){isTipoServAmb(this.cbaConfig.tipoServizio)&&0<c?(msgShowWarning("","non selezionabile per servizio ambulatoriale"),b.setValue([0])):this.impostaModalita(c)},impostaModalita:function(b){var c=this.getCBMotiviAssenza(),
d=this.getCBPrestazione(),f=this.getCntCalendario();this.cbaConfig.cfgCalendario.modalitaGriglia=b;this.calendario.mostraBottoni(b);d.setValue(null);c.setValue(null);0!=b&&c.setValue(this._idMotAssPredefinita);d.setHidden(1!=b);c.setHidden(2!=b);f.hide()},onClickAnnullaGriglia:function(){this.calendario.grigliaModificata=!1;this.onClickBtnCerca()},onClickConfermaGriglia:function(b){var c=this;2==c.cbaConfig.cfgCalendario.modalitaGriglia?Messaggio("ATTENZIONE","MSG_WARNING_ELIMINARE_SCONTI_SUPPLEMENTI",
"YESNO","WARNING",!1,function(){c.save(b,!0)},function(){c.save(b,!1)}):c.save(b,!0)},save:function(b,c){var d=this,f=[],g={};Ext.apply(g,{dataDal:d.getDataRilev().getValue(),deleteScontSupp:c?"T":"F"});(f=d.setRecordTosave(b))&&Ext.Ajax.request({url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/giornaliera/save",method:"POST",async:!1,jsonData:Ext.JSON.encode(f),params:g,success:function(b){b=Ext.JSON.decode(b.responseText);if(b.success){var c=[];msgAdd(c,b.message);msgShow("MSG_SALVATAGGIO_DATI",c);d.calendario.grigliaModificata=
!1;d.onClickBtnCerca()}else msgShowError("",b.message)}})},setRecordTosave:function(b){var c=this,d=[];b.forEach(function(b){var f=b.get("oldRec"),h={};Ext.apply(h,f);for(var k=1;k<=f.giorno.length;k++){var l=b.data["giorno"+k],n=f.giorno[k-1];void 0!==l&&l!==n&&(1==c.cbaConfig.cfgCalendario.modalitaGriglia?"+"==l?h.giorno[k-1]=l:n&&"-"!=n[0]&&(h.giorno[k-1]="-;"+n):2==c.cbaConfig.cfgCalendario.modalitaGriglia&&(h.giorno[k-1]=l))}h.dataRicovero=new Date(h.dataRicovero);h.pianificataValiditaDal=new Date(h.pianificataValiditaDal);
for(b=0;b<h.giornate.length;b++)for(h.giornate[b].data=new Date(h.giornate[b].data),f=0;f<h.giornate[b].rilevazioneDettaglio.length;f++)null!=h.giornate[b].rilevazioneDettaglio[f].dataOra&&(h.giornate[b].rilevazioneDettaglio[f].dataOra=new Date(h.giornate[b].rilevazioneDettaglio[f].dataOra));d.push(h)});return d},changeServizio:function(b,c,d){d=this.getCBPrestazione();var f=this.getCBMotiviAssenza();Ext.isEmpty(c)?(svuotaStore(d.getStore()),svuotaStore(f.getStore())):(c="",f=b?b.getValue():0,b={idServizio:f,
tipoServizio:b.getSelection().get("extra").split(",")[1]},this.cbaConfig.tipoServizio=b.tipoServizio,this.cbaConfig.cfgCalendario.tipoServizio=b.tipoServizio,isTipoServAmb(b.tipoServizio)?(this.getSgmBtnModalita().setValue([0]),this.getSgmBtnModalita().hide()):this.getSgmBtnModalita().show(),b.tipoServizio.includes("R")||(c=traduci("PRESTAZIONI")+"/"),c+=traduci("SCONTI")+"/"+traduci("SUPPLEMENTI"),d.setEmptyText(c),this.loadIdxStoreRicerca(2,f?b:0),b={idServizio:f,scheda:"H",domanda:2},this.loadIdxStoreRicerca(3,
f?b:0))},loadIdxStoreRicerca:function(b,c){var d=this,f=d.storeRicerca[b],g=f.getStore();SvuotaCombo(f);ImpostaUrl(g);f.setValue(null);0!==c&&(c&&(g.getProxy().extraParams=c),g.cbaConfig.idxStore=b,g.load({callback:function(b,c,l){l?(1===b.length&&f.setValue(b[0].get("codice")),3==g.cbaConfig.idxStore&&(g.insert(0,{codice:d._idMotAssPredefinita,extra:"F",regole:null,valore:"ASSENZA PREDEFINITA"}),f.setValue(d._idMotAssPredefinita))):msgShowError("",c.getError())}}))},caricaStoreCbox:function(){var b=
this.getCBServizio(),c=this.getCBSedeRepStanza(),d=this.getCBPrestazione(),f=this.getCBMotiviAssenza();this.storeRicerca=[];this.storeRicerca.push(b);this.storeRicerca.push(c);this.storeRicerca.push(d);this.storeRicerca.push(f);this.loadIdxStoreRicerca(0);this.loadIdxStoreRicerca(1,{rootNode:"F"})},loadPermessiVideate:function(){var b=this;b.permessoClassif="N";Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/permesso/videata",params:{idModulo:CBA.moduli.moduloAttivo,idVideata:"Classificazioni"},
success:function(c){c=Ext.JSON.decode(c.responseText);c.success?b.permessoClassif=c.data:msgShowError("",c.message)}});b.permessoScontiSupp="N";Ext.Ajax.request({method:"GET",url:"/cba/gen/auth/permesso/videata",params:{idModulo:CBA.moduli.moduloAttivo,idVideata:"EditScontiSupp"},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?b.permessoScontiSupp=c.data:msgShowError("",c.message)}})},onLaunch:function(){var b,c=this.getCntCalendario();this.initIconGrid();this.cbaConfig.cfgCalendario=
{modalitaGriglia:0,rilevGgRangeDays:7};this.getSgmBtnPeriodo().setValue(this.cbaConfig.cfgCalendario.rilevGgRangeDays);this.getSgmBtnModalita().setValue(0);this.caricaStoreCbox();b=Ext.create("GeneraliOSP.rilevazioneGgCdi.view.RilevazioneCdiGiornalieraCalendario");b.controller.ctrlPrincipale=this;c.add(b);this.calendario=b.controller;this.calendario.cbaConfig=this.cbaConfig.cfgCalendario;this.loadPermessiVideate()},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.controller.RilevazioneCdiGiornalieraCalendario",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"PnlCalendario",selector:this.selContainer+"#PnlCalendario"},{ref:"GridCalendario",selector:this.selContainer+"#GridCalendario"},{ref:"CercaNominativo",selector:this.selContainer+"#CercaNominativo"},{ref:"CBTipoPeriodo",selector:this.selContainer+"#CBTipoPeriodo"},
{ref:"NascondiRigheVuote",selector:this.selContainer+"#NascondiRigheVuote"},{ref:"Legenda",selector:this.selContainer+"#Legenda"},{ref:"BtnInfo",selector:this.selContainer+"#BtnInfo"},{ref:"BtnStampaGriglia",selector:this.selContainer+"#BtnStampaGriglia"},{ref:"BtnStampaGrigliaConQta",selector:this.selContainer+"#BtnStampaGrigliaConQta"},{ref:"BtnConferma",selector:this.selContainer+"#BtnConferma"},{ref:"BtnAnnulla",selector:this.selContainer+"#BtnAnnulla"}]);this.control(this.selContainer+"#BtnInfo",
{afterrender:this.loadBtnInfo});this.control(this.selContainer+"#NascondiRigheVuote",{change:this.onChangeNascondiRigheVuote});this.control(this.selContainer+"#GridCalendario",{cellclick:this.gridCellClick,celldblclick:this.gridCellDblClick});this.control(this.selContainer+"#BtnStampaGriglia",{click:this.btnStampaGrigliaClick});this.control(this.selContainer+"#BtnStampaGrigliaConQta",{click:this.btnStampaGrigliaClick});this.control(this.selContainer+"#BtnConferma",{click:this.btnConfermaClick});this.control(this.selContainer+
"#BtnAnnulla",{click:this.btnAnnullaClick})},btnStampaGrigliaClick:function(b,c){var d=this.getGridCalendario().getStore(),f={},d=this.ctrlPrincipale.setRecordTosave(d.getRange());f.url=getUrlGen()+"/ws/genOsp/cdi/rilevazione/giornaliera/prtCalendario";f.jsonData=Ext.JSON.encode(d);f.params={dataDal:this.ctrlPrincipale.getDataRilev().getValue(),rangeDay:this.view.cbaConfig.cfgCalendario.rilevGgRangeDays,printQta:b.printQta};stampaEsporta(this.getBtnStampaGriglia(),f,null)},onChangeNascondiRigheVuote:function(b,
c,d,f){var g=this;b=g.getGridCalendario().getStore();c?b.filter(function(b){for(var c=!1,d=1,f=b.get(["giorno"+d++]);void 0!==f;)1==g.cbaConfig.modalitaGriglia?null!=f&&(f=f.split(";"),"null"!=f[1]&&"0"!=f[1]&&(c=!0)):null!=f&&(c=!0),f=b.get(["giorno"+d++]);return c}):b.clearFilter()},btnConfermaClick:function(){var b=this.getGridCalendario().getStore().getModifiedRecords();if(0<b.length)this.ctrlPrincipale.onClickConfermaGriglia(b);else msgShowWarning("","Nessun dato da salvare");this.grigliaModificata=
!1;this.ctrlPrincipale.onDirtyGrid(!1)},btnAnnullaClick:function(){this.abilitaBottoni(!1);this.getGridCalendario().getStore().rejectChanges();this.grigliaModificata=!1;this.ctrlPrincipale.onDirtyGrid(!1);this.ctrlPrincipale.onClickAnnullaGriglia()},mostraBottoni:function(b){var c=0!=b,d=this.getBtnConferma(),f=this.getBtnAnnulla();stampaQta=this.getBtnStampaGrigliaConQta();c?(d.show(),f.show(),stampaQta.enable()):(d.hide(),f.hide(),stampaQta.disable());2==b&&stampaQta.disable()},abilitaBottoni:function(b){var c=
this.getBtnConferma(),d=this.getBtnAnnulla();b?(c.enable(),d.enable()):(c.disable(),d.disable())},gridCellDblClick:function(b,c,d,f,g,h,k,l){g={th:b,td:c,cellIndex:d,record:f,tr:g,rowIndex:h,e:k,eOpts:l};0!=this.cbaConfig.modalitaGriglia||b.up().isLocked||(b=this.ctrlPrincipale.gridCellDblClick(g),void 0!=b&&("#ff6"!=c.bgColor&&(c.bgColor="#ff6"),f.set("giorno"+(d+1),b)))},callBack_GridCellDblClick:function(b,c){b.record.set("giorno"+(b.cellIndex+1),c)},gridCellClick:function(b,c,d,f,g,h,k,l){var n=
f.get("giorno"+(d+1));c={th:b,td:c,cellIndex:d,record:f,tr:g,rowIndex:h,e:k,eOpts:l};if(b.up().isLocked){if(0==d)this.ctrlPrincipale.onClickAnagrafica(f)}else if(setTimeout(function(){},300),1==this.cbaConfig.modalitaGriglia){this.ctrlPrincipale.gridCellClick(c);b=[];if(null!=n){b=n.split(";");c=b[2];if("null"==b[1]||0==b[1])n=null;if("null"!=c&&void 0!=c){msgShowWarning("","MSG_WARNING_REGISTRAZIONE_SU_ASSENZA");return}}b="";b=n?"+"==n[0]?null:"-"==n[0]?n.substr(1):"-"+n:"+";f.set("giorno"+(d+1),
b);this.abilitaBottoni(this.isDirtyStore(f))}else 2==this.cbaConfig.modalitaGriglia&&null!=n&&(g=n.split(";"),b=g[0]+";null;","0"!=g[1]&&n&&(n=g[2],g=g[3],c=this.ctrlPrincipale.gridCellClickPA(c),b="null"==n?b+("+"+c):"-"==n[0]?b+n.substr(1):"+"==n[0]?b+"null":b+("-"+n),g&&(b+=";"+g),f.set("giorno"+(d+1),b),this.abilitaBottoni(this.isDirtyStore(f))))},isDirtyStore:function(b){b=b.store.getData();for(var c=!1,d=0;d<b.items.length;d++)b.items[d].dirty&&(c=!0);this.grigliaModificata=c;this.ctrlPrincipale.onDirtyGrid(c);
return c},createGrid:function(b,c){var d=this.getGridCalendario();d&&(this.view.cbaConfig.cfgCalendario.rilevGgRangeDays!=b&&(this.view.cbaConfig.cfgCalendario.rilevGgRangeDays=b,d.destroy(),d=this.view.loadGridCalendario(this.view),this.getPnlCalendario().add(d)),this.impostaTitoliGgCol(c),this.abilitaBottoni(!1))},impostaTitoliGgCol:function(b){var c=this.getGridCalendario();this.colNoDate=2;c.listaIdGg=[];for(var d=this.colNoDate;d<c.columns.length;d++){var f=new Date(b),g=c.columns[d];f.setDate(f.getDate()+
(d-this.colNoDate));var h;g.cbaConfig.style=null;h=15<=this.view.cbaConfig.cfgCalendario.rilevGgRangeDays?Ext.Date.format(f,"D <br> j/n"):Ext.Date.format(f,"D j/n");g.setText(h);g.dataEstesa=f;g.el&&(g.locked&&(g.locked=!1,g.el.removeChild(g.el.getFirstChild())),g.locked||Ext.isEmpty(this.ctrlPrincipale.ggBloccoCalendario)||!this.ctrlPrincipale.ggBloccoCalendario.split(",").includes(f.getDate().toString())||(g.locked=!0,g.el.insertFirst({tag:"img",src:"/cba/generali/images/svg/others/locked.svg",
style:"width: 16px; height:16px; margin: 3px 0 0 3px; float: left;",title:traduci("MSG_WARN_BLOCCO_CALENDARIO")})))}},getStartStopDayRange:function(b){var c;c=new Date(b.getTime());b=new Date(b.getTime()+864E5*(this.view.cbaConfig.cfgCalendario.rilevGgRangeDays-1));Ext.Date.isDST(c)&&!Ext.Date.isDST(b)&&b.setHours(b.getHours()+1);return[c,b]},loadBtnInfo:function(b,c,d){this.ctrlPrincipale.loadLegenda(b)},onLaunch:function(){},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.store.BloccoCalendario",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idServizio"},{name:"dal",type:"date"},{name:"al",type:"date"},{name:"desServizio"},{name:"insert_data",type:"date"},{name:"insert_operatore"},{name:"desOperatoreInsert"},{name:"deleted_data",type:"date"},{name:"deleted_operatore"},{name:"desOperatoreDelete"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/cdi/bloccoCalendario/src",reader:{type:"json",messageProperty:"message",rootProperty:"data"},
api:{read:".",create:".",update:".",destroy:"."}},sorters:[{property:"deleted_data",direction:"DESC"},{property:"dal",direction:"DESC"},{property:"desServizio",direction:"ASC"}],autoDestroy:!0});
Ext.define("GeneraliOSP.rilevazioneGgCdi.store.CbPrestScontiSupplGrp",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"},{name:"idGruppo"},{name:"gruppo"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/cdi/prestazEextras/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.rilevazioneGgCdi.store.CbPrestazioni",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"},{name:"gruppo"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/cdi/prestaz/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.rilevazioneGgCdi.store.RilevazioneCdi",{extend:"Ext.data.Store",fields:[{mapping:"id",name:"id"},{mapping:"idRicovero",name:"idRicovero"},{mapping:"idRisposta",name:"idRisposta"},{mapping:"data",name:"data",type:"date"},{mapping:"presente",name:"presente"},{mapping:"modificato",name:"modificato"},{name:"tipoRecord"},{mapping:"motivoAssenza",name:"motivoAssenza"},{name:"prestazioni"},{name:"giornoEdit"}],proxy:{type:"ajax",api:{read:"."},extraParams:{dataDal:"",dataAl:"",idRicovero:""},
urlGen:"/ws/genOsp/cdi/rilevazione/mese/src",reader:{type:"json",idProperty:"id",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.rilevazioneGgCdi.store.RilevazioneCdiGiornalieraCalendario",{extend:"Generali.data.StoreJson",fields:[{name:"codospite"},{name:"nominativo"},{name:"dataNascita",type:"date"},{name:"giorno"}],constructor:function(b){b=b||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/genOsp/cdi/rilevazione/giornaliera/src",api:{read:getUrlGen()+"/ws/genOsp/cdi/rilevazione/giornaliera/src"}}},b)])},autoDestroy:!0});
Ext.define("GeneraliOSP.rilevazioneGgCdi.store.StatoRilevazione",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/cdi/statoRil/cbox"},autoDestroy:!0});Ext.define("GeneraliOSP.rilevazioneGgCdi.store.TipoSupplementiSconti",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"},{name:"idGruppo"},{name:"gruppo"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/cdi/extras/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.rilevazioneGgCdi.store.TotaliScSupp",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"},{name:"gruppo"}],proxy:{type:"ajax",api:{},urlGen:"/ws/genOsp/cdi/rilevazione/mese/elencoScontiSupplementi",reader:{type:"json",idProperty:"idRicovero",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.rilevazioneGgCdi.view.BloccoCalendario",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",width:500,layout:{type:"fit"},header:{title:"ELENCO",titleAlign:"center",items:[{xtype:"checkboxfield",itemId:"CBDeletedData",reference:"CBDeletedData",boxLabel:traduci("VISUALIZZA_BLOCCHI_ELIMINATI"),checked:!1}]},items:[{xtype:"gridpanel",border:0,itemId:"StoricoGridBloccoCalendario",
reference:"StoricoGridBloccoCalendario",store:Ext.create("GeneraliOSP.rilevazioneGgCdi.store.BloccoCalendario"),columns:[{xtype:"gridcolumn",dataIndex:"desServizio",text:"SERVIZIO",flex:1},{xtype:"datecolumn",width:100,dataIndex:"dal",text:"DAL",format:"d/m/Y"},{xtype:"datecolumn",width:100,dataIndex:"al",text:"AL",format:"d/m/Y"}],selModel:Ext.create("Ext.selection.RowModel",{}),viewConfig:{getRowClass:function(b,c,d,f){if(b&&b.get("deleted_data"))return"testoAnnullato non_attivi"},loadMask:!1}}]},
{xtype:"form",flex:1,border:0,itemId:"BloccoCalendarioForm",reference:"BloccoCalendarioForm",layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"label",cls:"cbaUtente",itemId:"LblBlocco",reference:"LblBlocco",style:"text-align:center",width:410,height:100},{xtype:"fieldset",itemId:"DatiInserimento",reference:"DatiInserimento",layout:{type:"hbox"},title:"INSERIMENTO",width:400,items:[{xtype:"displayfield",cls:"cbaLabel",fieldLabel:"DATAORA",name:"insert_data",renderer:function(b,
c){return b?FormattaData(b):""}},{xtype:"displayfield",cls:"cbaLabel",fieldLabel:"OPERATORE",name:"desOperatoreInsert",margin:"0 0 0 20"}]},{xtype:"fieldset",itemId:"DatiEliminazione",reference:"DatiEliminazione",layout:{type:"hbox"},title:"ELIMINAZIONE",width:400,items:[{xtype:"displayfield",cls:"cbaLabel",fieldLabel:"DATAORA",name:"deleted_data",renderer:function(b,c){return b?FormattaData(b):""}},{xtype:"displayfield",cls:"cbaLabel",fieldLabel:"OPERATORE",name:"desOperatoreDelete",margin:"0 0 0 20"}]},
{xtype:"fieldset",itemId:"PnlBlocco_DalAl",reference:"PnlBlocco_DalAl",title:"COMPETENZA_BLOCCO",width:400,hidden:!0,margin:"5 0 0 0",items:[{xtype:"datefield",itemId:"BloccoCalendarioDal",reference:"BloccoCalendarioDal",width:290,margin:"5 0 0 50",fieldLabel:"DATA_INIZIO_BLOCCO",labelWidth:180,labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:!1},{xtype:"datefield",itemId:"BloccoCalendarioAl",reference:"BloccoCalendarioAl",width:290,margin:"10 0 10 50",fieldLabel:"DATA_FINE_BLOCCO",labelWidth:180,
labelClsExtra:"cbaLabel",name:"dataAl",allowBlank:!1}]},{xtype:"fieldset",itemId:"PnlBlocco_Serv",reference:"PnlBlocco_Serv",title:"SERVIZI",width:400,hidden:!0,margin:"0 0 0 0",flex:1,layout:{type:"fit"},items:[{xtype:"gridpanel",itemId:"GridServizi",reference:"GridServizi",multiSelect:!0,margin:"2 5 5 5",store:Ext.create("GeneraliOSP.store.TipoServizio"),columns:[{xtype:"gridcolumn",flex:1,dataIndex:"valore",align:"left",text:"SERVIZI"}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0}),
plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]},{xtype:"textfield",fieldLabel:"id",name:"id",hidden:!0}]},{xtype:"panel",itemId:"boxBottoni",reference:"boxBottoni",width:120,title:""}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.view.EditPrestazioniSupp",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"panel",border:0,layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"gridpanel",itemId:"GridPrestazioni",reference:"GridPrestazioni",border:0,flex:1,autoScroll:!0,store:Ext.create("GeneraliOSP.prestazioniCdi.store.Prestazioni"),columns:[{xtype:"gridcolumn",text:"PRESTAZIONI",flex:2,
dataIndex:"idRisposta",itemId:"Prestazioni",reference:"Prestazioni",renderer:function(c,d,f,g,h,k,l){"T"==f.get("statoRisposta")&&(d.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");c=f.get("desRisposta");b.controller&&b.controller.storeCbPrestaz&&"NOIMP"!=f.get("descrizione")&&(d=trovaRecord(b.controller.storeCbPrestaz,"codice",f.get("idRisposta")))&&(d=void 0!==d.get("extra").split(",")[1]?d.get("extra").split(",")[1]:null,Ext.isEmpty(f.get("stato"))||
Ext.isEmpty(d)||(f.data.extra=d,c+=" <b>[Imp. n "+d+"]</b>"));return c},editor:{xtype:"combobox",itemId:"EditorPrestazione",reference:"EditorPrestazione",displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!1,listConfig:{tpl:new Ext.XTemplate('<tpl for=".">',"<tpl if=\"extra!=null && extra.split(',')[1]!==undefined\">","<tpl if=\"extra.split(',')[0]=='T'\">","<div class=\"x-boundlist-item\"><i>{valore}</i> <b>[Imp. n {[values.extra.split(',')[1]]}]</b></div>","<tpl else>","<div class=\"x-boundlist-item\">{valore} <b>[Imp. n {[values.extra.split(',')[1]]}]</b></div>",
"</tpl>","<tpl else>","<tpl if=\"extra!=null && extra.split(',')[0]=='T'\">",'<div class="x-boundlist-item" style="font-style: italic !important; color: #707070 !important; text-decoration: line-through;">{valore}</div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>","</tpl>",{compiled:!0})},listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}}},{xtype:"gridcolumn",dataIndex:"quantita",header:"QUANTITA",width:60,align:"center",editor:{xtype:"numberfield",allowDecimals:!0,
allowBlank:!1,value:1}},{xtype:"gridcolumn",text:traduci("AMBULATORIO"),itemId:"Stanza",reference:"Stanza",hidden:!0,flex:1,dataIndex:"idStanza",renderer:function(c,d,f,g,h,k,l){c=f.get("desIdStanza");Ext.isEmpty(c)&&0<f.get("idStanza")&&(c=f.get("idStanza")+"(no descrizione)");b.controller&&b.controller.storeStanze&&0<f.get("idStanza")&&(c=trovaRecord(b.controller.storeStanze,"idStanza",f.get("idStanza")).get("desStanzaExtended"));return c},editor:{xtype:"combobox",hideLabel:!0,name:"idStanza",displayField:"desStanzaExtended",
queryMode:"local",typeAhead:!0,valueField:"idStanza",matchFieldWidth:!1,listConfig:{width:500,heigth:100,loadMask:!1}}},{xtype:"datecolumn",text:"ORA",format:"H:i",align:"center",dataIndex:"dataOra",width:50,itemId:"dataOra",reference:"dataOra",editor:{xtype:"timefield24",format:"H:i"}},{xtype:"gridcolumn",text:"OPERATORE",itemId:"Operatore",reference:"Operatore",hidden:!0,flex:.5,dataIndex:"idOperatore",renderer:function(b,d,f,g,h,k,l){b=f.get("desIdOperatore");Ext.isEmpty(b);return f.get("desIdOperatore")},
editor:{xtype:"combobox",hideLabel:!0,name:"idOperatore",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Operatori"),typeAhead:!0,valueField:"codice",matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}},{xtype:"gridcolumn",text:"STATO",itemId:"Stato",reference:"Stato",flex:.5,dataIndex:"stato",hidden:!0,renderer:function(b,d,f,g,h,k,l){return f.get("desStato")},editor:{xtype:"combobox",hideLabel:!0,name:"stato",displayField:"valore",queryMode:"local",
store:Ext.create("GeneraliOSP.rilevazioneGgCdi.store.StatoRilevazione"),typeAhead:!0,valueField:"codice",matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1},listeners:{change:"onChangeComboStato"}}},{xtype:"gridcolumn",text:"MOTIVO",itemId:"IdTipoStato",reference:"IdTipoStato",flex:.5,dataIndex:"idTipoStato",hidden:!0,renderer:function(c,d,f,g,h,k,l){c=f.get("desIdTipoStato");Ext.isEmpty(c)&&(d=f.get("idTipoStato"),g=b.controller.getGridPrestazioni().queryById("IdTipoStato").getEditor().getStore(),
(g=trovaRecord(g,"codice",d))&&(c=g?g.get("valore"):d));"N"!=f.get("stato")&&(c="-");return c},editor:{xtype:"combobox",hideLabel:!0,name:"idTipoStato",displayField:"valore",queryMode:"local",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/risposte/cbox"},autoDestroy:!0}),typeAhead:!0,valueField:"codice",matchFieldWidth:!1,listConfig:{width:150,heigth:100,loadMask:!1}}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],
dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovoPrestaz",reference:"BtnNuovoPrestaz",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnEliminaPrestaz",reference:"BtnEliminaPrestaz",iconCls:"icon-eliminaGriglia",text:"Elimina"},{xtype:"tbfill"},{xtype:"container",layout:"hbox",itemId:"ImgLockedPrestaz",reference:"ImgLockedPrestaz",hidden:!0,items:[{xtype:"image",src:"/cba/generali/images/svg/others/locked.svg",height:16,width:16},{xtype:"label",
text:"BLOCCO_CALENDARIO",margin:"2 0 0 5",cls:"cbaLabel"}]}]}]},{xtype:"gridpanel",itemId:"GridScontiSupp",reference:"GridScontiSupp",autoScroll:!0,border:0,flex:1,store:Ext.create("GeneraliOSP.prestazioniCdi.store.Prestazioni"),title:"SCONTI/SUPPLEMENTI",columns:[{xtype:"gridcolumn",header:"SCONTI_TIPO",renderer:function(b,d,f,g,h,k,l){d.tdCls=3==f.data.tipoRecord?"icon-piu":"icon-meno"},width:70,dataIndex:"tipoRecord",editor:{xtype:"combobox",itemId:"EditorTipoSS",reference:"EditorTipoSS",displayField:"valore",
queryMode:"local",valueField:"codice",allowBlank:!1,value:3}},{xtype:"gridcolumn",text:"SUPPLEMENTI_SCONTI",flex:1,dataIndex:"idRisposta",renderer:function(b,d,f,g,h,k,l){"T"==f.get("statoRisposta")&&(d.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");return f.get("desRisposta")},editor:{xtype:"combobox",itemId:"CbSupplementiSconti",reference:"CbSupplementiSconti",displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!1,listConfig:{tpl:new Ext.XTemplate('<tpl if="this.launch() == true"><tpl for="."><tpl if="this.isGruppo(gruppo) == true"><hr style="background-color: blue; height: 5px; margin:2px 0 2px; 0"><div style="color:blue;">{gruppo}</div><hr style="background-color: blue; height: 5px; margin:2px 0 2px; 0"><tpl if="extra!=null && extra.split(\',\')[1]==\'T\'">',
'<div class="x-boundlist-item" style="font-style: italic !important; color: #707070 !important; text-decoration: line-through;">{valore}</div><tpl else>',"<div class=\"x-boundlist-item\">{valore}</div></tpl><tpl else><tpl if=\"extra!=null && extra.split(',')[1]=='T'\">",'<div class="x-boundlist-item" style="font-style: italic !important; color: #707070 !important; text-decoration: line-through;">{valore}</div><tpl else>','<div class="x-boundlist-item">{valore}</div></tpl></tpl></tpl></tpl>',{compiled:!0,
gruppoOld:null,isGruppo:function(b){var c=this.gruppoOld;null!=b&&(this.gruppoOld=b);return null!=b&&b!=c},launch:function(){this.gruppoOld=null;return!0}})},listeners:{afterrender:function(b){b.setStyleNonAttivo(b,1)}}}},{xtype:"gridcolumn",dataIndex:"quantita",header:"QUANTITA",width:60,align:"center",editor:{xtype:"numberfield",allowDecimals:!0,allowBlank:!1,value:1}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",
dock:"top",items:[{xtype:"button",itemId:"BtnNuovoSconto",reference:"BtnNuovoSconto",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnEliminaSconto",reference:"BtnEliminaSconto",iconCls:"icon-eliminaGriglia",text:"Elimina"},{xtype:"tbfill"},{xtype:"container",layout:"hbox",itemId:"ImgLockedSconto",reference:"ImgLockedSconto",hidden:!0,items:[{xtype:"image",src:"/cba/generali/images/svg/others/locked.svg",height:16,width:16},{xtype:"label",text:"BLOCCO_CALENDARIO",margin:"2 0 0 5",
cls:"cbaLabel"}]}]}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{pack:"center",type:"hbox"},flex:1,items:[{xtype:"button",cls:"cba-button-25",itemId:"BtnEsci",reference:"BtnEsci",width:100,iconCls:"icon-esci",text:"ESCI"}]}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.view.ListaMotiviAssenza",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,layout:{type:"vbox",align:"stretch"},autoScroll:!0,flex:1,items:[{xtype:"gridpanel",border:0,itemId:"Grid",reference:"Grid",title:"",store:Ext.create("Generali.data.StoreCodiceValore",{proxy:{urlGen:"/ws/genOsp/motass/search"}}),columns:[{xtype:"gridcolumn",dataIndex:"valore",
text:"DESCRIZIONE",flex:1}],viewConfig:{getRowClass:function(b,c,d,f){if("T"==b.get("extra"))return"cba-deleted-record-clean"},border:0,loadMask:!1},dockedItems:[]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{pack:"center",type:"hbox"},flex:1,items:[{xtype:"button",cls:"cba-button-25",itemId:"BtnConferma",reference:"BtnConferma",width:100,iconCls:"icon-ok",text:"CONFERMA",disabled:!0},{xtype:"button",cls:"cba-button-25",itemId:"BtnEsci",reference:"BtnEsci",width:100,iconCls:"icon-esci",text:"ESCI"}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.view.RicalcolaPianif",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,layout:{type:"vbox",align:"stretch",pack:"center"},flex:1,items:[{xtype:"container",layout:"hbox",padding:5,margin:"0 0 0 10",items:[{xtype:"container",layout:"vbox",flex:1,items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",fieldLabel:"DAL",labelClsExtra:"cbaLabel",labelWidth:50,
width:160,fieldCls:"cbaInputData",allowBlank:!1},{xtype:"datefield",itemId:"DataAl",reference:"DataAl",fieldLabel:"AL",labelClsExtra:"cbaLabel",labelWidth:50,width:160,fieldCls:"cbaInputData",allowBlank:!1},{xtype:"radiogroup",height:50,itemId:"FiltroUtenti",reference:"FiltroUtenti",width:200,fieldLabel:"",columns:1,items:[{xtype:"radiofield",labelClsExtra:"cbaLabel",name:"filtro",boxLabel:"AGGP_UTENTE_SEL",inputValue:"0"},{xtype:"radiofield",labelClsExtra:"cbaLabel",name:"filtro",boxLabel:"AGGP_TUTTI_UTENTI",
inputValue:"1"}]},{xtype:"combobox",disabled:!0,itemId:"Sede",reference:"Sede",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Sedi",{autodestroy:!0}),width:220,fieldLabel:"",labelClsExtra:"cbaLabel",emptyText:"AGGP_TUTTE_SEDI",displayField:"valore",queryMode:"local",valueField:"codice"},{xtype:"combobox",disabled:!0,hidden:!0,itemId:"Reparto",reference:"Reparto",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Reparti",{autodestroy:!0}),width:220,fieldLabel:"",labelClsExtra:"cbaLabel",emptyText:"AGGP_TUTTI_REPARTI",
displayField:"valore",queryMode:"local",valueField:"codice"}]},{xtype:"container",layout:"vbox",flex:1,items:[{xtype:"gridpanel",itemId:"GridRicoveri",reference:"GridRicoveri",flex:1,minHeight:100,maxHeight:200,width:310,title:"",store:Ext.create("GeneraliOSP.store.ListaRicoveri",{autoDestroy:!0}),columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return d.data.servizio.descrizione},dataIndex:"idServizio",text:"SERVIZIO",flex:1},{xtype:"datecolumn",width:70,dataIndex:"dataDal",text:"DATA_INIZIO",
format:"d/m/Y"},{xtype:"datecolumn",width:70,dataIndex:"dataAl",text:"DATA_FINE",format:"d/m/Y"}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{})},{xtype:"gridpanel",margin:"5 0 0 0",flex:1,minHeight:100,maxHeight:200,width:310,itemId:"GridServizi",reference:"GridServizi",store:Ext.create("GeneraliOSP.store.TipoServizio",{autoDestroy:!0}),title:"",viewConfig:{loadMask:!1},columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"SERVIZIO",flex:1}],selModel:Ext.create("Ext.selection.CheckboxModel",
{checkOnly:!0})}]}]},{xtype:"container",layout:"hbox",padding:5,margin:"0 0 0 10",items:[{xtype:"container",layout:"vbox",flex:1,items:[{xtype:"checkboxfield",cls:"cbaLabel",itemId:"AggiornaPrestaz",reference:"AggiornaPrestaz",fieldLabel:"",boxLabel:"AGGP_PRESTAZIONI",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"AggiornaExtra",reference:"AggiornaExtra",fieldLabel:"",boxLabel:"AGGP_SCSOVR",checked:!0,inputValue:"T",uncheckedValue:"F"}]},{xtype:"container",
layout:"vbox",flex:1,items:[{xtype:"checkboxfield",cls:"cbaLabel",itemId:"OverridePrestaz",reference:"OverridePrestaz",name:"filtro",boxLabel:"AGGP_SOVRASCRIVI_MOV_MAN",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"GgChiusuraPrestaz",reference:"GgChiusuraPrestaz",name:"filtro",boxLabel:"AGGP_CONSIDERA_FEST_GG_CHIUSURA",inputValue:"T",uncheckedValue:"F"}]}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{pack:"center",type:"hbox"},flex:1,items:[{xtype:"button",
cls:"cba-button-25",itemId:"Elabora",reference:"Elabora",width:100,iconCls:"icon-elabora",text:"ELABORA"},{xtype:"button",cls:"cba-button-25",itemId:"BtnEsci",reference:"BtnEsci",width:100,iconCls:"icon-esci",text:"ESCI"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.view.RilevazioneCdi",{extend:"Generali.standard.ControlledContainer",uses:["Generali.standard.datePicker.View"],layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"PnlRicerca",reference:"PnlRicerca",width:260,layout:"fit",title:"RICERCA",collapsible:!0,collapseDirection:"left"},{xtype:"container",itemId:"CntGest",reference:"CntGest",flex:1,layout:{align:"stretch",type:"vbox"},items:[{xtype:"panel",itemId:"CntTestata",
reference:"CntTestata",height:140,padding:3,layout:{align:"stretch",type:"hbox"},items:[{xtype:"container",layout:{align:"stretch",type:"vbox"},flex:1,items:[{xtype:"container",layout:{align:"stretch",type:"hbox"},padding:3,items:[{xtype:"container",maxWidth:320,margin:"0 10 0 10",items:[{xtype:"label",cls:"cbaUtente",text:"",itemId:"NomeUtente",reference:"NomeUtente"}]},{xtype:"container",flex:1,maxWidth:70}]},{xtype:"container",layout:{align:"stretch",type:"hbox"},flex:1,padding:3,items:[{xtype:"gridpanel",
itemId:"GridServizi",reference:"GridServizi",width:250,title:"",store:Ext.create("GeneraliOSP.store.ListaRicoveri",{autoDestroy:!0}),margin:"0 0 0 5",columns:[{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){return d.data.servizio.descrizione},dataIndex:"idServizio",text:"Servizio",flex:1},{xtype:"datecolumn",width:70,dataIndex:"dataDal",text:"data_inizio",format:"d/m/Y"},{xtype:"datecolumn",width:70,dataIndex:"dataAl",text:"data_fine",format:"d/m/Y"}],viewConfig:{loadMask:!1}},{xtype:"gridpanel",
itemId:"GridTotScontiSupp",reference:"GridTotScontiSupp",maxWidth:200,flex:1,hidden:!0,disableSelection:!0,store:Ext.create("GeneraliOSP.rilevazioneGgCdi.store.TotaliScSupp",{autoDestroy:!0}),margin:"0 0 0 10",columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"TOTALI_RILEVAZIONI",flex:1},{xtype:"gridcolumn",dataIndex:"extra",width:40}],viewConfig:{loadMask:!1}},{xtype:"container",itemId:"CntTotPrestAmb",reference:"CntTotPrestAmb",maxWidth:500,flex:1,hidden:!0,scrollable:!0,margin:"0 0 0 10"},{xtype:"fieldset",
itemId:"MsgNotRil",reference:"MsgNotRil",hidden:!0,layout:{type:"vbox",align:"stretch",pack:"center"},maxWidth:340,flex:1,margin:"10 5 10 10",items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"label",text:"MSG_NESSUNA_RILEVAZIONE",cls:"cbaLabel",flex:1,margin:"0 5 0 10"}]}]}]}]},{xtype:"container",width:140,margin:"9 10 0 10",layout:{align:"stretch",type:"vbox",pack:"center"},items:[{xtype:"fieldset",title:"LEGENDA",layout:{align:"stretch",type:"vbox"},defaults:{margin:{top:5,right:5,bottom:5,
left:5}},items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"panel",height:15,width:15,margin:"0 2 0 0"},{xtype:"label",style:{"font-size":"11px"},text:"RILCDI_GG_SENZA_ACCESSI"}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"panel",cls:"accessiPianificati",height:15,width:15,margin:"0 2 0 0"},{xtype:"label",style:{"font-size":"11px"},text:"RILCDI_GG_ACCESSI_PIANIFICATI"}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"panel",cls:"pianificazioneModificata",height:15,width:15,
margin:"0 2 0 0"},{xtype:"label",flex:1,style:{"font-size":"11px"},text:"RILCDI_GG_PIANIFICAZIONE_MOD"}]}]}]}]},{xtype:"panel",itemId:"CntCalendar",reference:"CntCalendar",flex:1,minHeight:400,padding:3,layout:{align:"stretch",type:"hbox"},items:[],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnMeseDown",reference:"BtnMeseDown",iconCls:"icon-indietro",scale:"large"},{xtype:"button",itemId:"BtnMeseUp",reference:"BtnMeseUp",iconCls:"icon-avanti",scale:"large",margin:"0 20 0 5"},
{xtype:"label",itemId:"LabMeseAnno",reference:"LabMeseAnno",text:"",cls:"cbaLabel"},{xtype:"tbfill"},{xtype:"button",cls:"cba-stdbutton-25",itemId:"BtnCDIRicalcola",reference:"BtnCDIRicalcola",iconCls:"icon-elabora",text:"RILCDI_RICALCOLA"},{xtype:"button",itemId:"BtnStampa",reference:"BtnStampa",iconCls:"icon-stampa",text:traduci("STAMPA"),margin:"0 5 0 5"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.view.RilevazioneCdiGiornaliera",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntPrincipale",reference:"CntPrincipale",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",itemId:"PnlRicerca",reference:"PnlRicerca",frame:!0,minHeight:50,layout:"fit",items:[{xtype:"container",margin:"0 0 0 5",layout:1200>Ext.getBody().getViewSize().width?
"column":"hbox",items:[{xtype:"container",layout:"column",items:[{xtype:"combobox",margin:"0 5 0 0",labelAlign:"top",labelClsExtra:"cbaLabel",fieldLabel:"SERVIZIO",itemId:"CBServizio",reference:"CBServizio",name:"sede",emptyText:"SERVIZIO",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.TipoServizio"),typeAhead:!0,valueField:"codice",allowBlank:!1,width:210},{xtype:"combobox",margin:"0 5 5 0",labelAlign:"top",labelClsExtra:"cbaLabel",fieldLabel:traduci("SEDE")+
"/"+traduci("REPARTO")+"/"+traduci("STANZA"),itemId:"CBSedeRepStanza",reference:"CBSedeRepStanza",name:"stanza",emptyText:traduci("SEDE")+"/"+traduci("REPARTO")+"/"+traduci("STANZA"),displayField:"text",queryMode:"local",store:Ext.create("Generali.sediReparti.store.SediReparti",{rootVisible:!1}),valueField:"idStanza",minchars:3,anyMatch:!0,allowFolderSelect:!0,treeConfig:{maxHeight:200,scrolling:!0},allowBlank:!0,width:300,listConfig:{tpl:new Ext.XTemplate('<tpl for="."><div class="x-boundlist-item"><tpl if="this.isRoot(text) == true">Tutte<tpl else><tpl if="this.isSede(iconCls) == true">&nbsp;</tpl><tpl if="this.isReparto(iconCls) == true">&nbsp;&nbsp;&nbsp;</tpl><tpl if="this.isStanza(iconCls) == true">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tpl><img src="/cba/generali/images/16/{iconCls}.png" style="width:16px;" /> {text} </tpl></div></tpl>',
{isRoot:function(b){return"ROOT"==b},isSede:function(b){return"sede"==b},isReparto:function(b){return"reparto"==b},isStanza:function(b){return"stanza"==b},compiled:!0,isLeaf:function(b){return b}})},doLocalQuery:function(b){var c=b.query,d=this.getStore().getFilters(),f=this.queryFilter;this.queryFilter=null;this.changingFilters=!0;d.beginUpdate();f&&d.remove(f);if(c){var g=c.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),h=[];this.getStore().clearFilter();this.getStore().each(function(b){var c=b.get("text").toUpperCase();
"ROOT"==c?h.push(b):0<=c.indexOf(g.toUpperCase())&&h.push(b)});f=this.queryFilter=new Ext.util.Filter({filterFn:function(b){for(var c=!1,d=0;d<h.length;d++)if(b.contains(h[d])){c=!0;break}else if(c=b.get("text")===h[d].get("text"))break;return c}});d.add(f)}d.endUpdate();this.changingFilters=!1;this.store.getCount()||this.getPicker().emptyText?(this.getPicker().refresh(),this.expand()):this.collapse();this.afterQuery(b)}},{xtype:"fieldset",margin:"10 0 5 5",layout:{type:"hbox",align:"stretch"},items:[{xtype:"segmentedbutton",
margin:"5 0 5 0",itemId:"SgmBtnPeriodo",reference:"SgmBtnPeriodo",allowMultiple:!1,items:[{text:"1",value:1},{text:"7",value:7},{text:"15",value:15},{text:"mese",value:31}]},{xtype:"button",margin:"0 0 0 5",itemId:"BtnIndietroDay",reference:"BtnIndietroDay",cls:"btnLarge",iconCls:"icon-indietro",scale:"medium",tooltip:"INDIETRO",tDay:-1},{xtype:"datefield",itemId:"DataRilev",reference:"DataRilev",labelClsExtra:"cbaLabel",width:100,margin:"0 5 0 5",format:"d/m/Y",emptyText:"GG/MM/AAAA",value:new Date},
{xtype:"mese",fieldLabel:"",margin:"0 5 0 5",hidden:!0,itemId:"MeseRilev",reference:"MeseRilev",store:Ext.create("Generali.store.Mesi"),width:100},{xtype:"label",margin:"8 5 0 5",itemId:"AnnoRilev",reference:"AnnoRilev",hidden:!0,html:"ANNO"},{xtype:"button",cls:"btnLarge",itemId:"BtnAvantiDay",reference:"BtnAvantiDay",iconCls:"icon-avanti",scale:"medium",tooltip:"AVANTI",tDay:1}]},{xtype:"button",cls:"btnLarge",label:"CERCA",align:"left",itemId:"BtnCerca",reference:"BtnCerca",margin:"10 0 0 5",iconCls:"icon-ricerca",
scale:"large"}]},{xtype:"container",flex:1},{xtype:"container",layout:"hbox",items:[{xtype:"fieldset",margin:"10 0 5 5",layout:{type:"vbox",align:"stretch"},items:[{xtype:"segmentedbutton",margin:"5 0 5 0",itemId:"SgmBtnModalita",reference:"SgmBtnModalita",allowMultiple:!1,items:[{text:traduci("MODALITA_VISTA"),value:0},{text:traduci("MODALITA_RILEVAZIONE_MASSIVA"),value:1},{text:traduci("MODALITA_RILEVAZIONE_PRESENZA-ASSENZA"),value:2}]},{xtype:"combobox",margin:"0 0 5 40",labelAlign:"top",labelClsExtra:"cbaLabel",
emptyText:traduci("PRESTAZIONI")+"/"+traduci("SCONTI")+"/"+traduci("SUPPLEMENTI"),itemId:"CBPrestazione",reference:"CBPrestazione",store:Ext.create("GeneraliOSP.rilevazioneGgCdi.store.CbPrestScontiSupplGrp"),displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!1,listConfig:{tpl:new Ext.XTemplate('<tpl if="this.launch() == true"><tpl for="."><tpl if="this.isGruppo(gruppo) == true"><hr style="background-color: blue; height: 5px; margin:2px 0 2px; 0"><div style="color:blue;">{gruppo}</div><hr style="background-color: blue; height: 5px; margin:2px 0 2px; 0"><tpl if="extra!=null && extra.split(\',\')[0]==\'T\'">',
'<div class="x-boundlist-item" style="font-style: italic !important; color: #707070 !important; text-decoration: line-through;">{valore}</div><tpl else>',"<div class=\"x-boundlist-item\">{valore}</div></tpl><tpl else><tpl if=\"extra!=null && extra.split(',')[0]=='T'\">",'<div class="x-boundlist-item" style="font-style: italic !important; color: #707070 !important; text-decoration: line-through;">{valore}</div><tpl else>','<div class="x-boundlist-item">{valore}</div></tpl></tpl></tpl></tpl>',{compiled:!0,
gruppoOld:null,isGruppo:function(b){var c=this.gruppoOld;null!=b&&(this.gruppoOld=b);return null!=b&&b!=c},launch:function(){this.gruppoOld=null;return!0}})}},{xtype:"combobox",itemId:"CBMotiviAssenza",reference:"CBMotiviAssenza",labelAlign:"top",fieldLabel:"MOTIVI_USCITA_TEMP",emptyText:"MOTIVI_USCITA_TEMP",labelClsExtra:"cbaLabel",margin:"0 0 5 40",allowBlank:!1,displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.store.MotivoAssenzaRegole"),valueField:"codice",listeners:{afterrender:function(b){b.setStyleNonAttivo(b)}}}]},
{xtype:"button",margin:"15 5 0 5",cls:"cba-stdbutton-25",itemId:"BtnCalcPianificazione",reference:"BtnCalcPianificazione",iconCls:"icon-elabora",text:"RILCDI_RICALCOLA",disabled:!0}]}]}]},{xtype:"splitter",height:1,nonDisabilitare:!0},{xtype:"container",itemId:"CntCalendario",reference:"CntCalendario",layout:"fit",flex:1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.rilevazioneGgCdi.view.RilevazioneCdiGiornalieraCalendario",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"PnlCalendario",reference:"PnlCalendario",layout:"fit",frame:!0,flex:1,items:this.loadGridCalendario(this)}]});this.callParent(arguments)},loadGridCalendario:function(b){var c=[];c.push({xtype:"gridpanel",flex:1,itemId:"GridCalendario",reference:"GridCalendario",
scrollable:!0,selType:"cellmodel",columns:b.loadColonneGrid(b),enableLocking:!0,store:new Ext.data.ArrayStore({fields:[{name:"nominativo"},{name:"dataNascita",type:"date"},{name:"giorno1"},{name:"giorno2"},{name:"giorno3"},{name:"giorno4"},{name:"giorno5"},{name:"giorno6"},{name:"giorno7"},{name:"giorno8"},{name:"giorno9"},{name:"giorno10"},{name:"giorno11"},{name:"giorno12"},{name:"giorno13"},{name:"giorno14"},{name:"giorno15"},{name:"giorno15"},{name:"giorno16"},{name:"giorno17"},{name:"giorno18"},
{name:"giorno19"},{name:"giorno20"},{name:"giorno21"},{name:"giorno22"},{name:"giorno23"},{name:"giorno24"},{name:"giorno25"},{name:"giorno26"},{name:"giorno27"},{name:"giorno28"},{name:"giorno29"},{name:"giorno30"},{name:"giorno31"}]}),dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",itemId:"CercaNominativo",reference:"CercaNominativo",cbaConfig:{searchField:"nominativo",ricercaIniziaPer:!0}},{xtype:"checkboxfield",itemId:"NascondiRigheVuote",reference:"NascondiRigheVuote",boxLabel:traduci("NASCONDI_RIGHE_VUOTE"),
checked:!1},{xtype:"tbfill"},{xtype:"label",itemId:"Legenda",reference:"Legenda",hidden:!0,html:"LEGENDA"},{xtype:"button",margin:"0 5 0 0",cls:"btnLarge",itemId:"BtnInfo",reference:"BtnInfo",hidden:!0,scale:"medium",tooltip:""},{xtype:"splitbutton",itemId:"BtnStampaGriglia",reference:"BtnStampaGriglia",iconCls:"icon-stampa32",scale:"small",text:"ESPORTA",printQta:"F",menu:new Ext.menu.Menu({items:[{itemId:"BtnStampaGrigliaConQta",reference:"BtnStampaGrigliaConQta",text:traduci("ESPORTA")+" con "+
traduci("QTA"),iconCls:"icon-stampa32",printQta:"T"}]})},{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-conferma",scale:"small",text:"CONFERMA"},{xtype:"button",itemId:"BtnAnnulla",reference:"BtnAnnulla",iconCls:"icon-annulla32",scale:"small",text:"ANNULLA"}]}]});return c},loadColonneGrid:function(b){var c=[];c.push({xtype:"gridcolumn",dataIndex:"idRicovero",width:50,locked:!0,renderer:function(b,c,d,k,l){c.tdCls+=" menu-fascicolo-utenti"}});c.push({xtype:"gridcolumn",
text:"UTENTI",dataIndex:"nominativo",width:170,locked:!0});b.cbaConfig.cfgCalendario&&b.cbaConfig.cfgCalendario.rilevGgRangeDays||(b.cbaConfig.cfgCalendario={rilevGgRangeDays:7});for(var d=1;d<=b.cbaConfig.cfgCalendario.rilevGgRangeDays;d++)c.push({xtype:"gridcolumn",align:"center",text:d+"_Giorno",index:"giorno"+d,flex:1,sortable:!1,lockable:!1,minWidth:50,renderer:function(b,c,d,k,l){b=d.get("giorno"+(l+1));d=this.up("#PnlCalendario").up().controller.ctrlPrincipale;c.tdCls="";if(b)return c.tdCls=
"icon-circle-blue",d&&(c.tdStyle=d.getBackGroundColor(b),c.tdCls=d.getTdClsGridCell(b)),c=d.getCharCircle(b)}});return c}});
Ext.define("GeneraliOSP.sedeRepStanza.controller.SedeRepStanza",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"CbSRS",selector:this.selContainer+"#CbSRS"}]);this.control(this.selContainer+"#CbSRS",{change:this.changeCbSRS});this.callParent(arguments)},save:function(b){b=void 0===b?[]:b;localStorage.setItem(this.key_local_storage,JSON.stringify(b));if(this.cbaConfig.ctrlUp)this.cbaConfig.ctrlUp.onChangeTag()},read:function(){var b=
localStorage.getItem(this.key_local_storage);return b?JSON.parse(b):null},changeCbSRS:function(b,c,d,f){this.save(c)},openWin:function(){var b=this,c=this.cbaConfig.nameStore?this.cbaConfig.nameStore:"GeneraliOSP.store.SedeReparto";Ext.create("winCBA",{name:"GeneraliOSP.sedeRepStanza.view.SedeReparto",titolo:traduci("SEDE")+"/"+traduci("REPARTO"),dimensione:1,configItem:{permesso:"L",isWindow:!0,values:this.read(),nameStore:c,storeSedeReparto:this.storeSedeReparto,afterConferma:function(c){b.save(c);
b.loadFromLocaStorage()}}}).show()},loadFromLocaStorage:function(){var b=this.read(),c=this.getCbSRS(),d=c.getStore(),f=this.storeSedeReparto;b&&(b.forEach(function(b){var c=b;f.tree=!0;var g=trovaRecord(f,"idReparto",b);g&&(c=g.get("text")?g.get("text"):"idReparto: not found");d.add({id:b,value:c})}),c.setValue(b))},onLaunch:function(){var b=this,c=b.cbaConfig.nameStore?b.cbaConfig.nameStore:"GeneraliOSP.store.SedeReparto";b.key_local_storage=b.cbaConfig.key_local_storage;b.storeSedeReparto=Ext.create(c);
b.storeSedeReparto.load({callback:function(c,f,g){g?b.loadFromLocaStorage():msgShowError("",f.getError())}})},destroy:function(){eliminaStore(this.storeSedeReparto);this.callParent()}});
Ext.define("GeneraliOSP.sedeRepStanza.controller.SedeReparto",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"TreeSedeReparto",selector:this.selContainer+"#TreeSedeReparto"},{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"}]);this.control(this.selContainer+"#TreeSedeReparto",{beforeitemcontextmenu:this.beforeitemcontextmenuTreeRep,checkchange:this.treeCheckchange});this.control(this.selContainer+"#BtnEsci",{click:this.onBtnEsci})},
treeCheckchange:function(b,c,d){treeCheckchange(b,c,d)},beforeitemcontextmenuTreeRep:function(b,c,d,f,g,h){return getPopupMenuTree(g,b)},checkSelected:function(b){var c=this.getTreeSedeReparto();checkAllNodeTree(c,!1);c.getRootNode().cascadeBy(function(c){var d=null!=c.get("idReparto")&&0<=b.indexOf(c.get("idReparto").toString());c.set("checked",d)})},onBtnEsci:function(){var b=getListCheckedTree(this.getTreeSedeReparto(),!0,"idReparto");this.cbaConfig.afterConferma(b?b.split(","):[]);this.getView().up("window").close()},
onLaunch:function(){var b=this,c=b.config.cbaConfig,d=c.nameStore?c.nameStore:"GeneraliOSP.store.SedeReparto";treeSedeReparto=b.getTreeSedeReparto();b.storeSedeReparto=Ext.create(d);b.storeSedeReparto.load({callback:function(d,g,h){h?(treeSedeReparto.bindStore(b.storeSedeReparto),c.values&&b.checkSelected(c.values)):msgShowError("",g.getError())}})},destroy:function(){eliminaStore(this.storeSedeReparto);this.callParent()}});
Ext.define("GeneraliOSP.sedeRepStanza.view.SedeRepStanza",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this,c={xtype:"tagfield",itemId:"CbSRS",reference:"CbSRS",growMax:50,labelAlign:"top",labelClsExtra:"cbaLabel",fieldLabel:traduci("SEDE")+"/"+traduci("REPARTO"),queryMode:"local",store:Ext.create("Ext.data.Store",{fields:["id","value"]}),displayField:"value",valueField:"id",triggers:{picker:{hidden:!0},open:{handler:function(){b.controller.openWin()}},clear:{cls:"x-form-clear-trigger",
handler:function(){this.clearValue()}}}};b.cbaConfig.persMaxWidth&&Ext.apply(c,{maxWidth:b.cbaConfig.persMaxWidth});b.cbaConfig.persWidth&&Ext.apply(c,{width:b.cbaConfig.persWidth});Ext.applyIf(b,{items:[c]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.sedeRepStanza.view.SedeReparto",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",tabConfig:{title:"SELEZIONE_SEDE_REPARTO",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,dockedItems:[{xtype:"toolbar",dock:"top",height:50,items:[{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-conferma",scale:"small",text:"SELEZIONA_ESCI"}]}],items:[{xtype:"treepanel",flex:1,border:0,itemId:"TreeSedeReparto",
reference:"TreeSedeReparto",rootVisible:!1,useArrows:!0}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.simulaRetta.controller.Simula",{extend:"Generali.standard.stampe.Controller",parametriStampa:{hideMenu:!0,url:getUrlGen()+"/ws/genOsp/reports/simula"},init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"Quota",selector:this.selContainer+"#Quota"},{ref:"Data",selector:this.selContainer+"#Data"},{ref:"GridPagantiProiezione",
selector:this.selContainer+"#GridPagantiProiezione"},{ref:"GridPagantiGG",selector:this.selContainer+"#GridPagantiGG"}]);this.control(this.selContainer+"#BtnElabora",{click:this.clickBtnElabora})},clickBtnElabora:function(b){this.loadSimula()},loadSimula:function(){var b=this,c=b.getData().getValue();c.getFullYear();Ext.Date.getDaysInMonth(c);var d=c.getDate(),f=c.getMonth()+1,g=b.getGridPagantiGG().getStore(),h=b.getGridPagantiProiezione();b.getGridPagantiProiezione().setTitle(traduci("PROIEZIONE_QUOTE"));
if(null!=b.cbaConfig.dataFineClass&&b.cbaConfig.dataFineClass<b.getData().getValue())return msgShowError("","La classificazione selezionata termina prima della data di inizio elaborazione impostata; impossibile continuare!"),!1;if(b.cbaConfig.dataIniClass>b.getData().getValue())return msgShowError("","La classificazione selezionata inizia successivamente alla data di inizio elaborazione impostata; impossibile continuare!"),!1;g.load({params:{dataDal:c?c:new Date,idClassificazione:b.cbaConfig.idClassificazione},
callback:function(c,l,n){if(n){c=[];l=h.getStore();n=!1;annoElaborazione=b.getData().getValue().getFullYear();dataFineElab=new Date("12/31/"+annoElaborazione);null!=b.cbaConfig.dataFineClass&&b.cbaConfig.dataFineClass<dataFineElab&&(dataFineElab=b.cbaConfig.dataFineClass,n=!0);null!=currRicovero.dataAl&&currRicovero.dataAl<dataFineElab&&(dataFineElab=currRicovero.dataAl,n=!0);var k=12;n&&(n=annoElaborazione==dataFineElab.getFullYear())&&(k=dataFineElab.getMonth()+1,b.getGridPagantiProiezione().setTitle(traduci("PROIEZIONE_QUOTE_PARZ")+
" "+FormattaData(dataFineElab)));for(var q=f;q<=k;q++){var r=0,r=ggDelMese=dataFineMese(q,annoElaborazione).getDate();n&&q==k&&(r=dataFineElab.getDate());f==q&&(r=r-d+1);var t=b.cbaConfig.quotaSanitariaClassificazione;null==t&&(t=0);var u=b.cbaConfig.quotaSocialeClassificazione;null==u&&(u=0);switch(b.cbaConfig.tipoQuotaClassificazione){case "G":t*=r;u*=r;break;case "N":t=t/ggDelMese*r;u=u/ggDelMese*r;break;case "V":t=12*t/365*r,u=12*u/365*r}var x=0,v=0;g.each(function(c){var d=0,f=0,g=(new Date(c.get("dataDal"))).getMonth(),
h=null!=c.get("dataAl")?(new Date(c.get("dataAl"))).getMonth():null;if((new Date(c.get("dataDal"))).getFullYear()!=(new Date(c.get("dataAl"))).getFullYear()&&null!=h&&h<g){if((new Date(c.get("dataDal"))).getFullYear()==annoElaborazione||(new Date(c.get("dataDal"))).getFullYear()<=annoElaborazione&&(new Date(c.get("dataAl"))).getFullYear()>annoElaborazione)h=11;if((new Date(c.get("dataAl"))).getFullYear()==annoElaborazione||(new Date(c.get("dataAl"))).getFullYear()>=annoElaborazione&&(new Date(c.get("dataDal"))).getFullYear()<
annoElaborazione)g=0}q==(new Date(c.get("dataDal"))).getMonth()+1&&(new Date(c.get("dataDal"))).getFullYear()==annoElaborazione&&(r=ggDelMese-(new Date(c.get("dataDal"))).getDate()+1);if(!((new Date(c.get("dataDal"))).getFullYear()==annoElaborazione&&q<g+1||null!=h&&(q>h+1||q<g+1))){switch(c.get("tipoQuota")){case "P":d=(t-x)*c.get("quotaSanitariaGg")/100;f=(u-v)*c.get("quotaAlberghieraGg")/100;break;case "G":d=r*c.get("quotaSanitariaGg");f=r*c.get("quotaAlberghieraGg");break;case "M":d=c.get("quotaSanitariaGg");
f=c.get("quotaAlberghieraGg");break;case "N":d=c.get("quotaSanitariaGg")/ggDelMese*r,f=c.get("quotaAlberghieraGg")/ggDelMese*r}"P"!=c.get("tipoQuota")&&(x+=d,v+=f)}g=b.getQuota().getValue()?b.getQuota().getValue():0;d=d+f-g;c.set("mese"+q,0<d?d:0)})}g.each(function(b){c.push(b.copy())});svuotaStore(l);l.add(c)}else msgShowError("",l.getError())}})},onLaunch:function(){var b=this,c=new Ext.data.Store({model:b.getGridPagantiGG().getStore().model});b.getGridPagantiProiezione().bindStore(c);ImpostaUrl([b.getGridPagantiGG().getStore(),
c]);var c=b.getBoxBottoni(),d=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{esci_callback:function(){b.getBtnElabora().up("window").close()}}});inserisciBottoni(c,d);c.down().insert(0,b.getBtnElabora());c.down("#btnNuovo").hide();c.down("#btnElimina").hide();c.down("#btnConferma").hide();c.down("#btnAnnulla").hide();c=c.down("#BtnStampa");c.show();b.configurePrintButton(c,"preview");c=parseInt(dataAttuale("Y"));null!=b.cbaConfig.dataFineClass&&(c=b.cbaConfig.dataFineClass.getFullYear());
b.cbaConfig.dataIniClass.getFullYear()<c?b.getData().setValue(new Date("01/01/"+c)):b.getData().setValue(b.cbaConfig.dataIniClass)},stampaSimula:function(){var b=[];this.getGridPagantiProiezione().getStore().data.items.forEach(function(c){b.push(c.data)});if(0==b.length)return Messaggio("ATTENZIONE","MSG_NESSUN_DATO_DA_STAMPARE","OK","WARNING",!1,!1),!1;var c=Ext.apply(this.parametriStampa,{params:{reportId:59,format:"pdf",utente:currOspite.cognome+" "+currOspite.nome,desClassificazione:this.cbaConfig.desClassificazione,
dataDal:this.getData().getValue()},jsonData:b});Ext.apply(c.params,this.parametriStampa);return!0},doPrint:function(b,c){this.stampaSimula()&&this.callParent([b,c])}});
Ext.define("GeneraliOSP.simulaRetta.store.Simula",{extend:"Ext.data.Store",fields:[{name:"codFoCl"},{name:"ragioneSociale"},{name:"quotaSanitariaGg"},{name:"quotaAlberghieraGg"},{name:"tipoQuota"},{name:"campoOrdine",convert:function(b,c){return b="G"==c.get("tipoQuota")?1:"M"==c.get("tipoQuota")?2:"N"==c.get("tipoQuota")?3:"Z"==c.get("tipoQuota")?4:"P"==c.get("tipoQuota")?100:10}},{name:"mese1"},{name:"mese2"},{name:"mese3"},{name:"mese4"},{name:"mese5"},{name:"mese6"},{name:"mese7"},{name:"mese8"},
{name:"mese9"},{name:"mese10"},{name:"mese11"},{name:"mese12"}],sorters:[{property:"campoOrdine",direction:"ASC"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/rette/simula",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.simulaRetta.view.Simula",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",defaults:{margin:{top:0,right:5,bottom:0,left:0}},layout:{type:"hbox",padding:5},items:[{xtype:"datefield",itemId:"Data",reference:"Data",width:160,fieldLabel:"DATA",labelClsExtra:"cbaLabel",labelWidth:50},{xtype:"numberfield",fieldLabel:"QUOTA_PENSIONE",labelClsExtra:"cbaLabel",itemId:"Quota",reference:"Quota",
width:200},{xtype:"button",text:"ELABORA",itemId:"BtnElabora",reference:"BtnElabora",cls:"cba-button-25",iconCls:"icon-elabora",margin:"0 5 0 0"},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni"}]},{xtype:"gridpanel",flex:1,margin:"0 0 10 0",itemId:"GridPagantiGG",reference:"GridPagantiGG",store:Ext.create("GeneraliOSP.simulaRetta.store.Simula"),columns:[{xtype:"gridcolumn",text:"PAGANTE",width:200,dataIndex:"ragioneSociale"},{xtype:"gridcolumn",renderer:function(b,c,d,f,g,h,k){c.style=
"text-align:center !important";return decodeTipoQuota(b,!0)},flex:1,dataIndex:"tipoQuota",hideable:!1,align:"center",text:"TIPO_QUOTA"},{xtype:"gridcolumn",align:"center",flex:1,text:"Q_SAN",dataIndex:"quotaSanitariaGg",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b,5)}},{xtype:"gridcolumn",align:"center",flex:1,text:"Q_SOC",dataIndex:"quotaAlberghieraGg",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b,5)}},{xtype:"gridcolumn",
align:"center",flex:1,text:"TOTALE",dataIndex:"quotaTotaleGg",renderer:function(b,c,d){if("P"!=d.get("tipoQuota"))return c.style="text-align:right !important",formatFloat(b,5)}}],viewConfig:{loadMask:!1}},{xtype:"gridpanel",flex:1,itemId:"GridPagantiProiezione",reference:"GridPagantiProiezione",title:"PROIEZIONE_QUOTE",columns:[{xtype:"gridcolumn",text:"PAGANTE",width:190,dataIndex:"ragioneSociale"},{xtype:"gridcolumn",align:"center",flex:1,text:"GEN",dataIndex:"mese1",renderer:function(b,c,d){c.style=
"text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"FEB",dataIndex:"mese2",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"MAR",dataIndex:"mese3",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"APR",dataIndex:"mese4",renderer:function(b,c,d){c.style="text-align:right !important";
return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"MAG",dataIndex:"mese5",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"GIU",dataIndex:"mese6",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"LUG",dataIndex:"mese7",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",
align:"center",flex:1,text:"AGO",dataIndex:"mese8",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"SET",dataIndex:"mese9",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"OTT",dataIndex:"mese10",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"NOV",
dataIndex:"mese11",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}},{xtype:"gridcolumn",align:"center",flex:1,text:"DIC",dataIndex:"mese12",renderer:function(b,c,d){c.style="text-align:right !important";return formatFloat(b)}}],viewConfig:{loadMask:!1}}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.sinotticoLetti.controller.Main",{extend:"Generali.standard.ViewController",drag_source:null,drag_target:[],init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"CntTop",selector:this.selContainer+"#CntTop"},{ref:"CntMain",selector:this.selContainer+"#CntMain"},{ref:"CntSource",selector:this.selContainer+"#CntSource"},{ref:"CntTarget",selector:this.selContainer+"#CntTarget"}]);this.callParent(arguments)},key_local_storage:"idOrg"+CBA.parametriGenerali.idOrganizzazione+
"_Modulo"+CBA.moduli.moduloAttivo+"_operatore"+CBA.parametriGenerali.codUtente+"_SRSSinotticoLetti",groupBy:function(b,c){return b.reduce(function(b,f){(b[f.get(c)]=b[f.get(c)]||[]).push(f);return b},{})},onLaunch:function(){StdUtenti.setTipoMov(this);this.paramsSinottico={};this.toolBar=Ext.create("GeneraliOSP.sinotticoLetti.view.Toolbar",{controller_main:this});this.source=Ext.create("GeneraliOSP.sinotticoLetti.view.Source",{controller_main:this});this.target=Ext.create("GeneraliOSP.sinotticoLetti.view.Target",
{controller_main:this,flex:1});this.getCntTop().add(this.toolBar);this.getCntSource().add(this.source);this.getCntTarget().add(this.target);this.view.on("afterrender",this.afterrender,this);this.store_srs=Ext.create("GeneraliOSP.booking.store.Resource");ImpostaUrl([this.store_srs])},removeDragTarget:function(){Ext.destroy(this.drag_target)},readLS:function(){var b=localStorage.getItem(this.key_local_storage);b&&Ext.apply(this.paramsSinottico,{listReparti:b});return b?b:null},loadData:function(){},
load:function(b){var c=this;this.readLS();var d={};Ext.apply(d,this.paramsSinottico);Ext.apply(d,{dataDal:b&&b.dataDal?b.dataDal:moment().startOf("day").toDate(),idOrg:getIdOrg(),limit:0,fillDesc:"T"});this.removeDragTarget();this.target.controller.removeElements();b=StdUtenti.promiseLoadStore(this.store_srs,d);d=StdUtenti.promiseLoadStore(this.target.controller.store,d);this.source.controller.load();Promise.all([b,d]).then(function(b){c.target.controller.addStanzeLetti(b[0]||[],b[1]||[])})["catch"](function(b){return msgShowError("",
b)})["finally"](function(){})},getSourceElement:function(b){return b.closest(".source")},setNumeroLettiLiberi:function(){var b=this.toolBar.down("#CntLettiLiberiOccupati"),c=this.target.controller.numLettiOccupati;b.update({letti_liberi:this.target.controller.totLetti-c,letti_occupati:c})},save:function(b,c,d,f,g){f=void 0===f?Ext.emptyFn:f;g=void 0===g?!1:g;var h=Ext.clone(b),k=this;Ext.apply(h,d);c&&Ext.apply(h,{id:null,taskStart:moment().startOf("day").toDate()});delete h.Cls;delete h.Draggable;
delete h.Resizable;delete h.dataDimissionePrev;Ext.Ajax.request({method:"POST",jsonData:Ext.JSON.encode(h),url:getUrlGen()+"/ws/genOsp/sinottico/save",params:{forceStore:g},success:function(g){g=Ext.JSON.decode(g.responseText);var h=g.message,l=g.data;g.success?f(l):h&&("?"==h[0]||h[0].testo&&"?"==h[0].testo[0])?Messaggio("ATTENZIONE",h[0].testo.slice(1),"YESNO","QUESTION",!1,function(){k.save(b,c,d,f,!0)}):(h&&"$"==h[0]&&(h=h.substring(1)),msgShowError("",h))},failure:function(b){msgShowError("",
b.result.message)}})},find_record:function(b,c){return c?this.target.controller.store.findRecord("id",b):this.source.controller.store.findRecord("id",b)},createDragTarget:function(b){var c=this;b.on("afterrender",function(d){d=new Ext.drag.Target({element:b.id,listeners:{beforedrop:function(b,c){var d=Ext.getCmp(b.getElement().id);return d.blocked?(d.setStyle({opacity:1}),msgShowWarning("ATTENZIONE","MSG_LETTO_NON_ATTIVO"),!1):d.unavailable?(d.setStyle({opacity:1}),msgShowWarning("ATTENZIONE","MSG_LETTO_NON_DISPONIBILE"),
!1):d.down("container[cls=ricovero]")?(d.setStyle({opacity:1}),!1):!0},drop:function(b,d){var f=Ext.getCmp(b.getElement().id);Messaggio("ATTENZIONE","MSG_CONFERMA_OCCUPAZIONE_LETTO","YESNOCANCEL","QUESTION","",function(){var b=c.getSourceElement(d.eventTarget),g=Ext.getCmp(Ext.get(b).up(".ricovero").id),h=g.getData(),p=!h.resourceIdField;c.save(h,p,{idSede:f.idSede,idReparto:f.idReparto,idStanza:f.idStanza,idLetto:f.idLetto,usoSingolo:null},function(b){var d,k;p?d=g.up("container[cls=container-source]"):
k=g.up("panel[cls=panel-letto]");f.add(g);var l=f.down("container[cls=ricovero]");b=Ext.create("GeneraliOSP.booking.model.Event",b).getData();l.update(b);p?(k=c.find_record(h.id,h.resourceIdField),c.source.controller.store.remove(k),c.target.controller.store.add(b),d.destroy()):k.updateLetto();f.updateLetto();f.setStyle({opacity:1})})},function(){f.setStyle({opacity:1})})},dragenter:function(b,c){Ext.getCmp(b.getElement().id).setStyle({opacity:.7})},dragleave:function(b,c){Ext.getCmp(b.getElement().id).setStyle({opacity:1})}}});
c.drag_target.push(d)})},afterrender:function(b){var c=this;this.drag_source=new Ext.drag.Source({element:b.el.down(".data-source"),handle:".source",listeners:{dragstart:function(b,f){var d=c.getSourceElement(f.eventTarget);b.getProxy().setHtml(d.innerHTML)}},proxy:{type:"placeholder"}})},destroy:function(){Ext.destroy(this.drag_source);this.removeDragTarget();eliminaStore(this.store_srs);this.callParent()}});
Ext.define("GeneraliOSP.sinotticoLetti.controller.Source",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.RICOVERI_INGRESSO=traduci("RICOVERI_INGRESSO");this.callParent(arguments)},load:function(){var b=this,c=this.controller_main.paramsSinottico,d=c.listReparti,c=c.dataDal;StdUtenti.promiseLoadStore(this.store,{idOrg:getIdOrg(),dataDal:c?c:moment().startOf("day").toDate(),listReparti:d}).then(function(c){b.removeElements();b.addElements(c||
[])})["catch"](function(b){return msgShowError("",b)})["finally"](function(){})},addElements:function(b){var c=this.controller_main.groupBy(b,"tipoMov");b=[];for(var d={},c=$jscomp.makeIterator(Object.entries(c)),f=c.next();!f.done;d={items:d.items,tipoMovRes:d.tipoMovRes},f=c.next()){var g=$jscomp.makeIterator(f.value),f=g.next().value,g=g.next().value;d.items=[];d.tipoMovRes=this.controller_main._TipoMovRes[f];g.forEach(function(b){return function(c){var d=Ext.create("GeneraliOSP.sinotticoLetti.view.Ricovero");
d.update(c);b.items.push({xtype:"container",cls:"container-source",style:"border: 1px solid #e7e7e7; border-radius: 5px",cls:b.tipoMovRes[1],items:d,margin:"2 2 7 2"})}}(d));b.push({xtype:"fieldset",collapsible:!0,margin:2,scrollable:!0,title:d.tipoMovRes[0],items:d.items})}this.view.add(b)},removeElements:function(){this.view.removeAll()},onLaunch:function(){this.store=Ext.create("GeneraliOSP.sinotticoLetti.store.Source");ImpostaUrl([this.store])},destroy:function(){eliminaStore(this.store);this.callParent()}});
Ext.define("GeneraliOSP.sinotticoLetti.controller.Target",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.CAMBIO_POSTO_LETTO=traduci("CAMBIO_POSTO_LETTO");this.RICOVERO_IN_DIMISSIONE=traduci("RICOVERO_IN_DIMISSIONE");this.RICOVERO_IN_APPOGGIO=traduci("RICOVERO_IN_APPOGGIO");this.DIMISIONNE_PREVISTA=traduci("DIMISIONNE_PREVISTA");this._COLOR_FEMALE="#FFC0CB";this._COLOR_MALE="#ADD8E6";this._COLOR_CU2="#DBCFE8";this.callParent(arguments)},isBlocked:function(b){return null!=
b&&"T"==b},setColorStanza:function(b,c,d){var f=0,g=0;this.store.each(function(b){b.get("idStanza")==d&&("M"==b.get("sesso")?f++:g++)});b=c?b.up("panel[cls=panel-stanza]"):b;c="cbaPanelViolaNeutro";0<f&&0==g?c="cbaPanelAzzurroMale":0<g&&0==f&&(c="cbaPanelRosaFemale");c&&b.setUI(c)},addStanzeLetti:function(b,c){var d=this,f=this.controller_main.groupBy(b,"idStanza"),g=[],h=this;h.totLetti=b.length;h.numLettiOccupati=c.length;for(var k={},f=$jscomp.makeIterator(Object.entries(f)),l=f.next();!l.done;k=
{key:k.key},l=f.next()){l=$jscomp.makeIterator(l.value);k.key=l.next().value;var l=l.next().value.map(function(b){var f=Ext.create("Ext.panel.Panel",{cls:"panel-letto",idSede:b.get("idSede"),idReparto:b.get("idReparto"),idStanza:b.get("idStanza"),idLetto:b.get("idLetto"),title:'<span style="color: black">'+b.get("desLetto")+"</span>",tipoRecord:b.get("tipoRecord"),width:200,ui:"cbaPanelTransparent",height:120,padding:"2 5 2 5",updateLetto:function(d){d=void 0===d?!1:d;var f=this,g=this.down("container[cls=ricovero]"),
k=null;g&&(k=g.getData(),k=h.controller_main.find_record(k.id,k.resourceIdField));d&&g.destroy();(this.blocked=h.isBlocked(b.get("stato")))?(this.addBodyCls("icon-stop"),this.setBodyStyle("background-size: 30%"),--h.totLettiOccupati):k?this.removeBodyCls("icon-letto"):this.addBodyCls("icon-letto");d=this.down("toolbar");d.setVisible(k);if(k){g=k.get("tipoMov");d.down("#IcoInDimissione").setVisible(["O","D"].includes(g));d.down("#IcoInAppoggio").setVisible("A"==g);var l=d.down("#IcoCambioLetto"),n=
["E","U"].includes(g);l.setVisible(n);d.down("#IcoLbl").setVisible(n);n&&d.down("#IcoLbl").setText("E"==g?"IN":"OUT")}else c.forEach(function(c){"T"==c.get("usoSingolo")&&c.get("idStanza")==b.get("idStanza")&&(f.rendered?(--h.numLettiOccupati,c.data.usoSingolo="F",f.up("panel[cls=panel-stanza]").items.items.forEach(function(b){b.removeBodyCls("icon-stop");b.setBodyStyle("background-size: 50%");b.unavailable=!1})):(h.numLettiOccupati+=1,f.addBodyCls("icon-stop"),f.setBodyStyle("background-size: 30%"),
f.unavailable=!0))});this.rendered&&(this.tools[0].setVisible(k),h.setColorStanza(this,!0,this.idStanza));h.controller_main.setNumeroLettiLiberi()},header:{padding:2},tools:[{iconCls:"icon-hamburger",listeners:{afterrender:function(b){b=this.toolOwner.down("container[cls=ricovero]");this.setVisible(b)}},callback:function(b,c){this.menu||(this.menu=Ext.create("Ext.menu.Menu",{showSeparator:!1,items:[{text:traduci("MOVIMENTAZIONE_RICOVERO"),handler:function(){h.movimentazione_ricovero(f)}},{text:traduci("ELIMINA_POSTO_LETTO"),
handler:function(){h.elimina_posto_letto(f)}}]}));this.menu.showBy(c)}}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"component",flex:1},{xtype:"label",itemId:"IcoLbl",hidden:!0,text:""},{xtype:"component",itemId:"IcoCambioLetto",cls:"icon-transfer",height:16,width:16,hidden:!0,autoEl:{"data-qtip":h.CAMBIO_POSTO_LETTO}},{xtype:"component",itemId:"IcoInAppoggio",cls:"icon-letter-a",height:16,width:16,hidden:!0,autoEl:{"data-qtip":h.RICOVERO_IN_APPOGGIO}},{xtype:"component",itemId:"IcoInDimissione",
cls:"icon-man-exit",height:16,width:16,hidden:!0}]}]});d.controller_main.createDragTarget.bind(d.controller_main)(f);var g=c.find(function(c){return c.get("idLetto")==b.get("idLetto")});if(g){var k=Ext.create("GeneraliOSP.sinotticoLetti.view.Ricovero");k.update(g);f.add(k)}f.updateLetto();return f}),n=b.find(function(b){return function(c){return c.get("idStanza")==b.key}}(k));g.push(Ext.create("Ext.panel.Panel",{layout:"hbox",cls:"panel-stanza",items:l,margin:5,collapsible:!0,idStanza:n.get("idStanza"),
sortKey:n.get("sortKey"),header:{padding:2,title:'\n              <div>\n              <span style="color: black">\n                <div style="line-height: 10px;">'+n.get("desStanza")+'</div>\n                <div style="font-size: 11px; line-height: 12px; font-weight: normal;">'+n.get("desReparto")+"</div>\n              </span>  \n              </div>\n            ",autoEl:{"data-qtip":n.get("desStanza")}},listeners:{afterrender:function(b){h.setColorStanza(b,!1,b.idStanza)}}}))}g.sort(function(b,
c){var d=b.sortKey,f=c.sortKey;return d<f?-1:d>f?1:0});this.view.add(g)},movimentazione_ricovero:function(b){function c(b,c){Ext.create("winCBA",{name:"GeneraliOSP.movimentazione.view.Main",titolo:"MOVIMENTAZIONE_RICOVERO",dimensione:1,configItem:{record:b,abilitaGestioneOraria:c}}).show()}var d=b.down("container[cls=ricovero]").getData();b=d.idServizio;Ext.isEmpty(b)?c(d,!1):CBA.StdUtenti.getImpostazioniServizio(CBA.moduli.moduloAttivo,b).then(function(b){c(d,b.abilitaOraResidenziale)})["catch"](function(b){return msgShowError("",
b)})},elimina_posto_letto:function(b){var c=b.down("container[cls=ricovero]").getData(),d=this;Messaggio("ATTENZIONE","MSG_ELIMINA","YESNO","QUESTION","",function(){Ext.Ajax.request({method:"GET",params:{id:c.id},url:"/cba/osp/co/ws/genOsp/sinottico/delete",success:function(f){f=Ext.JSON.decode(f.responseText);var g=f.message;f.success?(d.controller_main.source.controller.load(),f=d.controller_main.find_record(c.id,c.resourceIdField),d.controller_main.target.controller.store.remove(f),b.updateLetto(!0)):
msgShowError("",g)},failure:function(b){msgShowError("",b.result.message)}})})},addElements:function(b){var c=[];b.forEach(function(b){var d=Ext.create("GeneraliOSP.sinotticoLetti.view.Ricovero");d.update(b);c.push(d)});this.view.add(c)},removeElements:function(){this.view.removeAll()},onLaunch:function(){var b=this;this.store=Ext.create("GeneraliOSP.booking.store.Event");ImpostaUrl([this.store]);this.view.on("afterrender",function(c){this.tip=Ext.create("Ext.tip.ToolTip",{target:c.getEl(),delegate:".icon-man-exit",
renderTo:Ext.getBody(),listeners:{beforeshow:function(c){var d=Ext.getCmp(c.currentTarget.up(".panel-letto").id).down("container[cls=ricovero]").getData(),d=FormattaData(d.taskEnd);c.update(b.DIMISIONNE_PREVISTA+": "+d)}}})})},destroy:function(){eliminaStore(this.store);Ext.destroy(this.tip);this.callParent()}});
Ext.define("GeneraliOSP.sinotticoLetti.controller.Toolbar",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.addRef([{ref:"CBServizio",selector:this.selContainer+"#CBServizio"},{ref:"CntSedeRepStanza",selector:this.selContainer+"#CntSedeRepStanza"},{ref:"DataDal",selector:this.selContainer+"#DataDal"},{ref:"BtnAvantiDay",selector:this.selContainer+"#BtnAvantiDay"},{ref:"BtnIndietroDay",selector:this.selContainer+"#BtnIndietroDay"},{ref:"BtnCerca",
selector:this.selContainer+"#BtnCerca"},{ref:"TxtFilterEvent",selector:this.selContainer+"#TxtFilterEvent"}]);this.control(this.selContainer+"#BtnCerca",{click:this.clickBtnCerca});this.control(this.selContainer+"#BtnAvantiDay",{click:this.changePeriodo});this.control(this.selContainer+"#BtnIndietroDay",{click:this.changePeriodo});this.callParent(arguments)},changePeriodo:function(b){var c=this.getDataDal(),d=c.getValue(),d=Ext.Date.add(d,Ext.Date.DAY,b.tDay);c.setValue(d);this.clickBtnCerca()},leggiParametri:function(){var b=
this.getDataDal().getValue();Ext.apply(this.controller_main.paramsSinottico,{dataDal:b});return{dataDal:b}},clickBtnCerca:function(){var b=this.leggiParametri();this.controller_main.load(b)},onLaunch:function(){this.getTxtFilterEvent().controller_main=this.controller_main;var b=this.getDataDal(),c=this.getCBServizio().getStore(),d=this.getCntSedeRepStanza();b.setValue(moment().startOf("day").toDate());ImpostaUrl([c]);c.load();d.add(Ext.create("GeneraliOSP.sedeRepStanza.view.SedeRepStanza",{cbaConfig:{nameStore:"GeneraliOSP.store.SedeReparto",
key_local_storage:this.controller_main.key_local_storage,ctrlUp:this,persMaxWidth:450,persWidth:450}}))},onChangeTag:function(){var b=this.leggiParametri();this.controller_main.load(b)},destroy:function(){this.callParent()}});
Ext.define("GeneraliOSP.sinotticoLetti.store.Source",{extend:"Ext.data.Store",fields:[{name:"IconCls"},{name:"id"},{name:"resourceIdField"},{name:"taskTitle"},{name:"sesso"},{name:"taskStart",type:"date",convert:function(b,c){return new Date(b)}},{name:"taskEnd",type:"date",convert:function(b,c){return b?new Date(b):new Date("2999-12-31")}},{name:"ricDal",type:"date"},{name:"ricAl",type:"date"},{name:"stato"},{name:"noteStanza"},{name:"idSede"},{name:"idReparto"},{name:"idStanza"},{name:"idLetto"},
{name:"idRiferimento"},{name:"idRicovero"},{name:"idServizio"},{name:"descServizio"},{name:"desStanza"},{name:"desLetto"},{name:"tipoRecord"},{name:"codFisc"},{name:"dataNascita",type:"date"},{name:"dataAccessoPrev",type:"date"},{name:"dataDimissionePrev",type:"date"},{name:"giorniPrognosi"},{name:"regimeRicovero"},{name:"medico"},{name:"eta"},{name:"idNos"},{name:"desNos"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/sinottico/listRicDaMovimentare",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},
autoDestroy:!0});
Ext.define("GeneraliOSP.sinotticoLetti.view.FilterText",{extend:"Ext.form.TextField",enableKeyEvents:!0,triggers:{clear:{cls:"x-form-clear-trigger",handler:function(){this.filter("")},scope:"this"}},onKeyUp:function(b){var c=this.getValue().toLowerCase();this.filter(b.getKey()===b.ESC?"":c)},initComponent:function(){this.callParent(arguments);this._original_field_label=traduci(this.getFieldLabel())},filter:function(b){var c=this;b||this.setValue("");b=b.toLowerCase();var d=0;this.controller_main.view.getEl().query(".search-field").forEach(function(f){var g=c.controller_main.getSourceElement(f);
b&&f.innerText&&f.innerText.toLowerCase().includes(b)?(d++,g.style.backgroundColor="yellow"):g.style.backgroundColor="transparent"});this.setFieldLabel(0==d?this._original_field_label:this._original_field_label+" ("+d+")")},listeners:{keyup:"onKeyUp",buffer:200}});
Ext.define("GeneraliOSP.sinotticoLetti.view.Main",{extend:"CbaUtils.componenti.all.PanelAttivaFunzioniCBA",messaggioAttivazione:"MSG_ATTIVAZIONE_MAPPALETTI",nomeFunzioneDaAttivare:"MAPPA_LETTI",codiceFunzione:"CU_SINOTTICO",uses:["Generali.standard.stampe.Button"],initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",itemId:"CntTop",reference:"CntTop"},{xtype:"container",cls:"data-source",flex:1,layout:{type:"hbox",align:"stretch"},
items:[{xtype:"panel",itemId:"CntSource",reference:"CntSource",width:260,height:795,collapsible:!0,collapseDirection:"left",layout:{type:"vbox",align:"stretch"},autoScroll:!0},{xtype:"panel",height:795,itemId:"CntTarget",reference:"CntTarget",flex:1,autoScroll:!0}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.sinotticoLetti.view.Ricovero",{extend:"Ext.container.Container",cls:"ricovero",initComponent:function(){this.callParent(arguments)},tpl:new Ext.XTemplate('\n    <div class="source" id_record="{id}" resource_id_field="{resourceIdField}" style=\'display: flex; flex-direction: column; padding: 2px; cursor: pointer;\'>     \n      <div style="display: flex; align-items: center; margin-bottom: 3px;">\n        {[this.getImage(values)]}\n        <span class="search-field" style="line-height: 1.2;font-size: 11px; font-weight: bold; margin-left: 2px;">{taskTitle} ({eta})</span>\n      </div>\n      \n      \x3c!--<div style="line-height: 10px;">\n        <span style="font-size: 11px; color: #909090">'+traduci("NOS")+
': </span>\n        <span style="font-size: 11px;">{[this.formatDate(values, \'desNos\')]}</span>\n      </div>--\x3e\n\n      <div style="line-height: 10px;">\n        <span style="font-size: 11px; color: #909090">'+traduci("SERVIZIO")+': </span>\n        <span style="font-size: 11px; color: grey; font-weight: bold">{descServizio}</span>\n      </div>\n\n      <div style="line-height: 10px;">\n        <span style="font-size: 11px; color: #909090">'+traduci("DATA_INIZIO")+': </span>\n        <span style="font-size: 11px;">{[this.formatDate(values, \'taskStart\')]}</span>\n      </div>\n\n      <div style="line-height: 10px;">\n        <span style="font-size: 11px; color: #909090">'+
traduci("DATA_FINE")+': </span>\n        <span style="font-size: 11px;">{[this.formatDate(values, \'taskEnd\')]}</span>\n      </div>\n\n      <div style="line-height: 10px;">\n        <span style="font-size: 11px; color: grey; font-weight: bold">{onereDegenza}</span>\n      </div>\n    </div>\n  ',{formatDate:function(b,c){return b&&moment(b[c]).isAfter("2999-01-01")?null:FormattaData(b[c],"d/m/Y H:i")},getImage:function(b){var c="F"==b.sesso?"icon-female":"icon-male";"R"==b.tipoRecord&&(c="icon-accompany");
return'<img style="height: 20px; pointer-events: none" class="'+c+'" src="'+Ext.BLANK_IMAGE_URL+'"></img>'}})});Ext.define("GeneraliOSP.sinotticoLetti.view.Source",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){this.callParent(arguments)}});Ext.define("GeneraliOSP.sinotticoLetti.view.Target",{extend:"Generali.standard.ControlledContainer",layout:"column",initComponent:function(){Ext.applyIf(this,{items:[]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.sinotticoLetti.view.Toolbar",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"toolbar",items:[{xtype:"combobox",margin:"0 5 0 0",labelAlign:"top",labelClsExtra:"cbaLabel",fieldLabel:"SERVIZIO",itemId:"CBServizio",reference:"CBServizio",emptyText:"SERVIZIO",displayField:"valore",queryMode:"local",queryParam:"valore",store:Ext.create("GeneraliOSP.store.TipoServizio"),typeAhead:!0,valueField:"codice",allowBlank:!1,width:200},
{xtype:"container",itemId:"CntSedeRepStanza",reference:"CntSedeRepStanza",maxWidth:450},{xtype:"container",layout:"hbox",margin:"0 0 0 5",items:[{xtype:"button",margin:"22 3 0 5",itemId:"BtnIndietroDay",reference:"BtnIndietroDay",cls:"btnLarge",iconCls:"icon-indietro",scale:"medium",tooltip:"INDIETRO",tDay:-1},{xtype:"datefield",width:110,itemId:"DataDal",reference:"DataDal",name:"dataDal",labelClsExtra:"cbaLabel",labelAlign:"top",fieldLabel:"DATA",format:"d/m/Y",emptyText:"gg/mm/aaaa",value:new Date},
{xtype:"button",margin:"22 0 0 5",cls:"btnLarge",itemId:"BtnAvantiDay",reference:"BtnAvantiDay",iconCls:"icon-avanti",scale:"medium",tooltip:"AVANTI",tDay:1},{margin:"15 5 0 5",xtype:"button",cls:"btnLarge",itemId:"BtnCerca",reference:"BtnCerca",iconCls:"icon-ricerca",scale:"large"}]},{xtype:"component",flex:1},Ext.create("GeneraliOSP.sinotticoLetti.view.FilterText",{itemId:"TxtFilterEvent",reference:"TxtFilterEvent",emptyText:traduci("UTENTE")+"...",property:"taskTitle",labelAlign:"top",labelClsExtra:"cbaLabel",
fieldLabel:"UTENTE"}),{xtype:"container",itemId:"CntLettiLiberiOccupati",reference:"CntLettiLiberiOccupati",tpl:new Ext.XTemplate('\n                <div style="display: flex; align-items: center;">\n                 <img style="height: 16px; margin-right: 5px" class="icon-circle-green" src="'+Ext.BLANK_IMAGE_URL+'"></img>\n                 <span>{letti_liberi} '+traduci("LETTI_LIBERI")+'</span>\n                </div>\n                <div style="display: flex; align-items: center;">\n                 <img style="height: 16px; margin-right: 5px" class="icon-circle-red" src="'+
Ext.BLANK_IMAGE_URL+'"></img>\n                 <span>{letti_occupati} '+traduci("LETTI_OCCUPATI")+"</span>\n                </div>")},{xtype:"component",width:10},{xtype:"component",width:160,html:'\n                <div style="display: flex; align-items: center;">\n                  <img style="height: 16px; margin-right: 5px" class="icon-transfer" src="'+Ext.BLANK_IMAGE_URL+'"></img>\n                  <span>'+traduci("CAMBIO_POSTO_LETTO")+'</span>\n                </div>\n                <div style="display: flex; align-items: center;">\n                  <img style="height: 16px; margin-right: 5px" class="icon-letter-a" src="'+
Ext.BLANK_IMAGE_URL+'"></img>\n                  <span>'+traduci("RICOVERO_IN_APPOGGIO")+'</span>\n                </div>\n                <div style="display: flex; align-items: center;">\n                  <img style="height: 16px; margin-right: 5px" class="icon-man-exit" src="'+Ext.BLANK_IMAGE_URL+'"></img>\n                  <span>'+traduci("RICOVERO_IN_DIMISSIONE")+"</span>\n                </div>\n              "}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.stampe.controller.CUStampa",{extend:"Generali.standard.stampe.Controller",init:function(){var b="#"+this.containerId+" ";this.cbaConfig.configBtnStampa&&(Ext.applyIf(this.parametriStampa,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(this.parametriStampa.params,this.cbaConfig.configBtnStampa.params));this.cbaConfig.certificazioni||this.cbaConfig.docPers||20==this.cbaConfig.id?Ext.apply(this.parametriStampa,{hideExcel:!0,hideCsv:!0,hideXml:!0,
hideText:!0}):127==this.cbaConfig.id&&Ext.apply(this.parametriStampa,{hidePdf:!0,hideExcel:!1,hideCsv:!0,hideXml:!0,hideText:!0});this.callParent(arguments);this.addRef([{ref:"TabPrincipale",selector:b+"#TabPrincipale"},{ref:"CntProgressBar",selector:b+"#CntProgressBar"},{ref:"BtnAvanti",selector:b+"#BtnAvanti"},{ref:"BtnIndietro",selector:b+"#BtnIndietro"},{ref:"TbTabPrincipale",selector:b+"#TbTabPrincipale"},{ref:"TabPeriodo",selector:b+"#TabPeriodo"},{ref:"TipoClass",selector:b+"#TipoClass"},{ref:"MotivoAssenza",
selector:b+"#MotivoAssenza"},{ref:"ConsideraUtenti",selector:b+"#ConsideraUtenti"},{ref:"FsTipoPensioni",selector:b+"#FsTipoPensioni"},{ref:"UtentiDaInizioAnno",selector:b+"#UtentiDaInizioAnno"},{ref:"Attivi",selector:b+"#Attivi"},{ref:"NonAttivi",selector:b+"#NonAttivi"},{ref:"DataDal",selector:b+"#DataDal"},{ref:"DataAl",selector:b+"#DataAl"},{ref:"dataGiornoAl",selector:b+"#dataGiornoAl"},{ref:"Mese",selector:b+"#Mese"},{ref:"Trimestre",selector:b+"#Trimestre"},{ref:"Anno",selector:b+"#Anno"},
{ref:"TreeServiziClass",selector:b+"#TreeServiziClass"},{ref:"TreeMotiviUscitaTemp",selector:b+"#TreeMotiviUscitaTemp"},{ref:"CntServSupp",selector:b+"#CntServSupp"},{ref:"TreeSedeReparto",selector:b+"#TreeSedeReparto"},{ref:"MotiviDim",selector:b+"#MotiviDim"},{ref:"PageParametri",selector:b+"#PageParametri"},{ref:"PageSedeReparto",selector:b+"#PageSedeReparto"},{ref:"PageUtenti",selector:b+"#PageUtenti"},{ref:"PageSchedeFascicolo",selector:b+"#PageSchedeFascicolo"},{ref:"PagePaganti",selector:b+
"#PagePaganti"},{ref:"PageEtichette",selector:b+"#PageEtichette"},{ref:"PageAnteprima",selector:b+"#PageAnteprima"},{ref:"FiltraSoloAttivi",selector:b+"#FiltraSoloAttivi"},{ref:"FiltraSoloAttiviScontiSupp",selector:b+"#FiltraSoloAttiviScontiSupp"},{ref:"FiltraPerSede",selector:b+"#FiltraPerSede"},{ref:"GridUtenti",selector:b+"#GridUtenti"},{ref:"GridSchedeFas",selector:b+"#GridSchedeFas"},{ref:"GridPaganti",selector:b+"#GridPaganti"},{ref:"CambiaPag",selector:b+"#CambiaPag"},{ref:"GridMotiviUscitaTemp",
selector:b+"#GridMotiviUscitaTemp"},{ref:"TipoDocFattura",selector:b+"#TipoDocFattura"},{ref:"TipoDocRettaFatt",selector:b+"#TipoDocRettaFatt"},{ref:"FattDefArc",selector:b+"#FattDefArc"},{ref:"TipoPagante",selector:b+"#TipoPagante"},{ref:"FormatoCarta",selector:b+"#FormatoCarta"},{ref:"tipoMedico",selector:b+"#tipoMedico"},{ref:"RiepRaggruppamento",selector:b+"#RiepRaggruppamento"},{ref:"TipoFattura",selector:b+"#TipoFattura"},{ref:"TipoDocContabile",selector:b+"#TipoDocContabile"},{ref:"TipoCorrispettivo",
selector:b+"#TipoCorrispettivo"},{ref:"TipoDocRetta",selector:b+"#TipoDocRetta"},{ref:"TipoDocFatturaLibera",selector:b+"#TipoDocFatturaLibera"},{ref:"FattureDefinitive",selector:b+"#FattureDefinitive"},{ref:"FattureArchiviate",selector:b+"#FattureArchiviate"},{ref:"boxSoglia",selector:b+"#boxSoglia"},{ref:"ggSoglia1",selector:b+"#ggSoglia1"},{ref:"ggSoglia2",selector:b+"#ggSoglia2"},{ref:"fsScontiSupplementi",selector:b+"#fsScontiSupplementi"},{ref:"CntParam",selector:b+"#CntParam"},{ref:"chkSconto",
selector:b+"#chkSconto"},{ref:"chkSupplemento",selector:b+"#chkSupplemento"},{ref:"chkRitenuta",selector:b+"#chkRitenuta"},{ref:"FsFiltroMovimenti",selector:b+"#FsFiltroMovimenti"},{ref:"FsMovimenti",selector:b+"#FsMovimenti"},{ref:"ChkEntrati",selector:b+"#ChkEntrati"},{ref:"ChkInUscita",selector:b+"#ChkInUscita"},{ref:"ChkIngressiPrevisti",selector:b+"#ChkIngressiPrevisti"},{ref:"ChkUsciti",selector:b+"#ChkUsciti"},{ref:"ChkUscitiTmp",selector:b+"#ChkUscitiTmp"},{ref:"ChkRientratiTmp",selector:b+
"#ChkRientratiTmp"},{ref:"ChkCambioResid",selector:b+"#ChkCambioResid"},{ref:"ChkCambioClass",selector:b+"#ChkCambioClass"},{ref:"CbTipoStampa",selector:b+"#CbTipoStampa"},{ref:"CBAssenzeRighe",selector:b+"#CBAssenzeRighe"},{ref:"ConsideraGGDim",selector:b+"#ConsideraGGDim"},{ref:"MotiviGGDim",selector:b+"#MotiviGGDim"},{ref:"CBRaggPerAsl",selector:b+"#CBRaggPerAsl"},{ref:"TipoComune",selector:b+"#TipoComune"},{ref:"GridFasceEta",selector:b+"#GridFasceEta"},{ref:"RaggrPerSede",selector:b+"#RaggrPerSede"},
{ref:"CbEstrattoConto",selector:b+"#CbEstrattoConto"},{ref:"ChkSaldiZero",selector:b+"#ChkSaldiZero"},{ref:"ChkSaldiNegativi",selector:b+"#ChkSaldiNegativi"},{ref:"ChkNonMovimentati",selector:b+"#ChkNonMovimentati"},{ref:"BoxFiltroPaganti",selector:b+"#BoxFiltroPaganti"},{ref:"ChkPagante",selector:b+"#ChkPagante"},{ref:"CboxPagante",selector:b+"#CboxPagante"},{ref:"fsScadDoc",selector:b+"#fsScadDoc"},{ref:"tipoDocumenti",selector:b+"#tipoDocumenti"},{ref:"chGrpUtScad",selector:b+"#chGrpUtScad"},{ref:"chkGrpServizio",
selector:b+"#chkGrpServizio"},{ref:"CondPagamento",selector:b+"#CondPagamento"},{ref:"chkGrpClass",selector:b+"#chkGrpClass"},{ref:"chkOccupanti",selector:b+"#chkOccupanti"},{ref:"chkSoloLibere",selector:b+"#chkSoloLibere"},{ref:"CbOrdine",selector:b+"#CbOrdine"},{ref:"ChkConsideraAssenze",selector:b+"#ChkConsideraAssenze"},{ref:"ChkVisualizzaSoloPagantiAttivi",selector:b+"#ChkVisualizzaSoloPagantiAttivi"},{ref:"FranchigiaAssenza",selector:b+"#FranchigiaAssenza"},{ref:"ChkImportiPersonalizzazioni",
selector:b+"#ChkImportiPersonalizzazioni"},{ref:"ServiziClassExtImporto",selector:b+"#ServiziClassExtImporto"},{ref:"ImportiDefault",selector:b+"#ImportiDefault"},{ref:"TreeClassifImporti",selector:b+"#TreeClassifImporti"},{ref:"TreeSupplementi",selector:b+"#TreeSupplementi"},{ref:"TreeSconti",selector:b+"#TreeSconti"},{ref:"CntScontiSupplementi",selector:b+"#CntScontiSupplementi"},{ref:"ImportoPresDefault",selector:b+"#ImportoPresDefault"},{ref:"ImportoAssDefault",selector:b+"#ImportoAssDefault"},
{ref:"CbDocPers",selector:b+"#CbDocPers"},{ref:"BoxDaPubblicare",selector:b+"#BoxDaPubblicare"},{ref:"FieldBoxDaPubblicare",selector:b+"#FieldBoxDaPubblicare"},{ref:"PercDeducibile",selector:b+"#PercDeducibile"},{ref:"ImportoIncassatoCertLomb",selector:b+"#ImportoIncassatoCertLomb"},{ref:"ImportoIncassatoRdg",selector:b+"#ImportoIncassatoRdg"},{ref:"IncassoPeriodo",selector:b+"#IncassoPeriodo"},{ref:"IncassoDataDal",selector:b+"#IncassoDataDal"},{ref:"IncassoDataAl",selector:b+"#IncassoDataAl"},{ref:"CntTreeServizi",
selector:b+"#CntTreeServizi"},{ref:"FsDataAl",selector:b+"#FsDataAl"},{ref:"MotiviUscita",selector:b+"#MotiviUscita"},{ref:"BoxNumerazione",selector:b+"#BoxNumerazione"},{ref:"Registro",selector:b+"#Registro"},{ref:"DalNumero",selector:b+"#DalNumero"},{ref:"AlNumero",selector:b+"#AlNumero"},{ref:"BtnArchiviaDocumentale",selector:b+"#BtnArchiviaDocumentale"},{ref:"CbEnteIva",selector:b+"#CbEnteIva"},{ref:"cboxConteggiaServizi",selector:b+"#cboxConteggiaServizi"},{ref:"chkConteggiaServizi",selector:b+
"#chkConteggiaServizi"},{ref:"cboxFiltraStoricoQuote",selector:b+"#cboxFiltraStoricoQuote"},{ref:"chkFiltraStoricoQuote",selector:b+"#chkFiltraStoricoQuote"},{ref:"treeSupp",selector:b+"#treeSupp"},{ref:"treeSconto",selector:b+"#treeSconto"},{ref:"pageScontiSupp",selector:b+"#pageScontiSupp"},{ref:"BtnScontiSupplementiInfo",selector:b+"#BtnScontiSupplementiInfo"},{ref:"BtnSalva",selector:b+"#BtnSalva"},{ref:"TipoPagantePagePaganti",selector:b+"#TipoPagantePagePaganti"},{ref:"GridCategoria",selector:b+
"#GridCategoria"},{ref:"containerFiltriPag",selector:b+"#containerFiltriPag"},{ref:"CButentiNonAssenti",selector:b+"#CButentiNonAssenti"},{ref:"CBCalcoloConFranchigia",selector:b+"#CBCalcoloConFranchigia"},{ref:"chkDividiPerAsl",selector:b+"#chkDividiPerAsl"},{ref:"CBGarante",selector:b+"#CBGarante"},{ref:"GridGradoParentela",selector:b+"#GridGradoParentela"},{ref:"GridRating",selector:b+"#GridRating"},{ref:"CBStampaDettaglio",selector:b+"#CBStampaDettaglio"},{ref:"BtnPubblicaPortale",selector:b+
"#BtnPubblicaPortale"}]);this.control(b+"#TreeSupplementi",{checkchange:this.checkchangeTreeSupplementi,beforeedit:this.beforeeditTreeSupplementi,validateedit:this.validatePercCertificazioni});this.control(b+"#TreeSconti",{checkchange:this.checkchangeTreeSconti,beforeedit:this.beforeeditTreeSconti,validateedit:this.validatePercCertificazioni});this.control(b+"#TreeServiziClass",{checkchange:this.checkchangeTreeServiziClass,beforeedit:this.beforeeditTreeServiziClass,select:this.selectTreeServiziClass,
validateedit:this.validatePercCertificazioni});this.control(b+"#TreeMotiviUscitaTemp",{checkchange:this.checkchangeTreeMotiviUscitaTemp,beforeedit:this.beforeeditTreeMotiviUscitaTemp,validateedit:this.validatePercCertificazioni});this.control(b+"#UtentiDaInizioAnno",{change:this.changeUtentiDaInizioAnno});this.control(b+"#Attivi",{change:this.changeAttivi});this.control(b+"#NonAttivi",{change:this.changeNonAttivi});this.control(b+"#ChkUsciti",{change:this.changeChkUsciti});this.control(b+"#FiltraSoloAttivi",
{change:this.filtraSoloAttivi});this.control(b+"#FiltraSoloAttiviScontiSupp",{change:this.filtraSoloAttiviScontiSupp});this.control(b+"#FiltraPerSede",{change:this.filtraPerSede});this.control(b+"treepanel",{checkchange:this.treeCheckchange,beforeitemcontextmenu:this.beforeitemcontextmenu});this.control(b+"#DataDal",{change:this.changeDataDal});this.control(b+"#DataAl",{change:this.changeDataAl});this.control(b+"#Trimestre",{change:this.changeDataDal});this.control(b+"#Anno",{change:this.changeAnno});
this.control(b+"#MotiviDim",{checkchange:this.checkchangeMotiviDim});this.control(b+"#MotiviUscita",{checkchange:this.checkchangeMotiviUscita});this.control(b+"#PageSchedeFascicolo",{render:this.renderPageSchedeFascicolo});this.control(b+"#TipoFattura",{change:this.svuotaStorePaganti});this.control(b+"#TipoCorrispettivo",{change:this.svuotaStorePaganti});this.control(b+"#TipoDocContabile",{change:this.svuotaStorePaganti});this.control(b+"#TipoDocRetta",{change:this.svuotaStorePaganti});this.control(b+
"#TipoDocFatturaLibera",{change:this.svuotaStorePaganti});this.control(b+"#FattureArchiviate",{change:this.changeFattureArchiviate});this.control(b+"#chkSconto",{change:this.changeSconto});this.control(b+"#chkSupplemento",{change:this.changeSconto});this.control(b+"#chkRitenuta",{change:this.changeRitenuta});this.control(b+"#CbTipoStampa",{change:this.changeTipoStampa});this.control(b+"#RiepRaggruppamento",{change:this.changeRiepRaggruppamento});this.control(b+"#GridFasceEta",{edit:this.editGridFasceEta,
canceledit:this.canceleditGridFasceEta});this.control(b+"#BtnElimina",{click:this.eliminaFasce});this.control(b+"#BtnNuovo",{click:this.nuovoFasce});this.control(b+"#BtnSalva",{click:this.salvaQuote});this.control(b+"#ChkSaldiZero",{change:this.changeChkSaldiZero});this.control(b+"#GridUtenti",{selectionchange:this.selectionchangeGridUtenti});this.control(b+"#GridPaganti",{selectionchange:this.selectionchangeGridPaganti});this.control(b+"#TreeSedeReparto",{load:this.loadTreeSedeReparto});this.control(b+
"#CondPagamento",{selectionchange:this.selectionchangeCondPagamento});this.control(b+"#ChkImportiPersonalizzazioni",{change:this.changeChkImportiPersonalizzazioni});this.control(b+"#GridCategoria",{selectionchange:this.selectionchangeGridCategoria});this.control(b+"#TipoPagantePagePaganti",{selectionchange:this.selectionchangeTipoPagantePagePaganti});this.control(b+"#TipoPagante",{selectionchange:this.selectionchangeTipoPagante});this.control(b+"#BtnPubblicaPortale",{click:this.pubblicaDocPerson});
this.control(b+"#BoxDaPubblicare",{change:this.changeBoxDaPubblicare});this.control(b+"#ImportoIncassatoRdg",{change:this.changeImportoIncassatoRdg})},changeImportoIncassatoRdg:function(b,c,d,f){this.getIncassoPeriodo().setVisible("F"==this.getImportoIncassatoRdg().getValue().tipoImportoIncassato);this.getIncassoDataDal().setValue(this.getIncassoPeriodo().isVisible()?this.getDataDal().getValue():null);this.getIncassoDataAl().setValue(this.getIncassoPeriodo().isVisible()?this.getDataAl().getValue():
null)},changeBoxDaPubblicare:function(b,c,d,f){this.getBtnPubblicaPortale().setDisabled(1!=this.getBoxDaPubblicare().getValue().BoxDaPubblicare)},pubblicaDocPerson:function(){var b=this;if("V"!=b.cbaConfig.permesso)msgShowWarning("MSG_PERMESSI_INSUFFICENTI","");else{var c=b.getCbDocPers();if(c.selection&&c.selection.data&&"T"===c.selection.data.extra)b.cbaConfig.docPers&&Ext.apply(this.parametriStampa,{creaZip:!0}),b.codiceFunzione="CU_PORTALE",Ext.Ajax.request({method:"GET",url:getUrlGen()+"/auth/extraFn/isEnabled",
params:{codiceFunzione:b.codiceFunzione},success:function(d){d=Ext.JSON.decode(d.responseText);d.success?(d="/ws/genOsp/reports/docpers/print",b.cbaConfig.certificazioni&&(d="CU_StampaCertificazioniLomb"==b.cbaConfig.progetto?"/ws/reports/certif/lomb/print":"/ws/reports/certif/std/print"),b.cbaConfig.portale=getUrlGen()+d,Ext.create("winCBA",{name:"GeneraliOSP.stampe.view.UploadDocPerson",titolo:traduci("PORTALE_UTENTI"),dimensione:4,altezzaWin:460,larghezzaWin:700,codiceFunzione:b.codiceFunzione,
configItem:{id:"UploadDocPerson",codiceFunzione:b.codiceFunzione,titolo:"PORTALE_UTENTI",permesso:b.cbaConfig.permesso,permessoDB:b.cbaConfig.permesso,projectName:"GeneraliOSP.stampe",nomeModello:c.getDisplayValue(),callbackRitorno:function(c,d,f,l){b.cambiaUrlPortale=!0;b.cbaConfig.doUploadPortale="T";b.cbaConfig.uploadDataPubblicazione=l;b.cbaConfig.uploadOggettoMail=d;b.cbaConfig.uploadCorpoMail=c;b.cbaConfig.uploadDescAgg=f;b.doPrint(b.getTabPrincipale().down("#BtnPubblicaPortale"),"PDF",!1);
b.cambiaUrlPortale=!1}},closable:!0}).show()):msgShowError("",d.message)}});else{var d=traduci("PORTALE_DOCPERS_PUBLISHING_DISABLED");msgShowWarning("PORTALE_DOCPERS_PUBLISHING_DISABLED",d+"<br><br>"+traduci("PORTALE_DOCPERS_HOWTO_ENABLE"))}}},changeChkImportiPersonalizzazioni:function(b,c,d,f){this.getImportiDefault().setDisabled(1==c);this.getBtnSalva().setDisabled(1==c);this.getTreeClassifImporti().columns[1].setVisible(0==c);this.getTreeClassifImporti().columns[2].setVisible(0==c)},loadTreeSedeReparto:function(b,
c,d,f,g,h){Ext.each(c,function(b){b.parentNode.isRoot()&&b.isLeaf()&&(delete b.data.checked,b.set("cls","cba-disabled-element"))})},selectionchangeGridCategoria:function(b,c,d){this.filtraPaganti(!0)},selectionchangeTipoPagantePagePaganti:function(){this.filtraPaganti(!0)},selectionchangeTipoPagante:function(){this.svuotaStorePaganti()},selectionchangeGridUtenti:function(){this.svuotaStoreCertificazioni()},selectionchangeGridPaganti:function(){this.cbaConfig.tipoDocFattura&&this.svuotaStoreUtenti()},
selectionchangeCondPagamento:function(){this.cbaConfig.tipoDocFattura&&(this.svuotaStorePaganti(),this.svuotaStoreUtenti())},changeDataDal:function(b,c){this.svuotaStoreUtenti();this.cbaConfig.tipoDocFattura&&this.svuotaStorePaganti();isValidDate(b)&&this.getBoxNumerazione().isVisible()&&(2==this.personContabili.tipoContabilitaAbilitata||this.tabelleAmm2)&&this.reloadRegistro(c.getFullYear())},changeDataAl:function(){this.svuotaStoreUtenti();this.cbaConfig.tipoDocFattura&&this.svuotaStorePaganti()},
changeAnno:function(){63==this.cbaConfig.id&&this.loadTreeServClass(null,!0)},selectTreeServiziClass:function(b,c){if(this.certifLomb){var d=this.getCntTreeServizi().down("#GridImportiClass"),f=d.controller;c.isLeaf()?(f.abilitaGrid(!0,c.get("text"),c.get("idServizio"),c.get("idRisposta")),f.aggiornaStore()):(f.abilitaGrid(!1,"",null,null),svuotaStore(d.getStore()))}},salvaQuote:function(){var b=this,c=[];records=b.getTreeClassifImporti().getStore().data.items;Ext.each(records,function(d){1!=d.get("depth")&&
d.get("importoIsDirty")&&(d={id:d.get("idImporto"),tipoStampa:b.cbaConfig.id,idExt:d.get("idRisposta"),data:null,importo1:d.get("importo1"),importo2:d.get("importo2")},c.push(d))});if(b.getImportoAssDefault().isDirty()||b.getImportoPresDefault().isDirty()){var d={},d={id:null!=b.cbaConfig.idImportiDefault?b.cbaConfig.idImportiDefault:null,tipoStampa:b.cbaConfig.id,idExt:-9999,data:null,importo1:b.getImportoPresDefault().getValue(),importo2:b.getImportoAssDefault().getValue()};c.push(d)}Ext.Ajax.request({method:"POST",
url:"/cba/osp/co/ws/prszn/alberoImporti/update",jsonData:Ext.JSON.encode(c),writer:{type:"json"},success:function(c){Ext.JSON.decode(c.responseText).success&&Ext.each(b.getTreeClassifImporti().getStore().data.items,function(b){2==b.get("depth")&&(b.data.importoIsDirty=!1)})}})},validatePercCertificazioni:function(b,c){c.value!=c.originalValue&&(this.cbaConfig.updatePercCertificazioni=!0,c.record.data.modified=!0)},checkchangeTreeSupplementi:function(b,c){if(b&&!b.isLeaf())for(var d=0;d<b.childNodes.length;d++)this.checkchangeTreeSupplementi(b.childNodes[d],
c);else b&&b.isLeaf()&&c&&Ext.isEmpty(b.get("importo1"))&&b.set("importo1",100)},checkchangeTreeSconti:function(b,c){if(b&&!b.isLeaf())for(var d=0;d<b.childNodes.length;d++)this.checkchangeTreeSconti(b.childNodes[d],c);else b&&b.isLeaf()&&c&&Ext.isEmpty(b.get("importo1"))&&b.set("importo1",100)},checkchangeTreeServiziClass:function(b,c){var d=this,f=d.getServizi();d.scontiSuppFiltrati=!1;d.cbaConfig.scontiSupp&&(d.getTreeSconto().getStore().clearFilter(),d.getTreeSconto().getStore().filter({filterFn:function(b){if(Ext.Array.contains(f,
b.get("idServizio")))return!0;b.isLeaf()&&(d.scontiSuppFiltrati=!0);return!1}}),d.getTreeSupp().getStore().clearFilter(),d.getTreeSupp().getStore().filter({filterFn:function(b){if(Ext.Array.contains(f,b.get("idServizio")))return!0;b.isLeaf()&&(d.scontiSuppFiltrati=!0);return!1}}),d.getFiltraSoloAttiviScontiSupp().setValue(!0),d.filtraTreeSoloAttiviScontiSupp(d.getTreeSupp(),!0),d.filtraTreeSoloAttiviScontiSupp(d.getTreeSconto(),!0))},checkchangeTreeMotiviUscitaTemp:function(b,c){if(b&&!b.isLeaf())for(var d=
0;d<b.childNodes.length;d++)this.checkchangeTreeMotiviUscitaTemp(b.childNodes[d],c);else b&&b.isLeaf()&&c&&Ext.isEmpty(b.get("importo1"))&&b.set("importo1",100)},beforeeditTreeSupplementi:function(b,c){if(!c.record.isLeaf())return!1},beforeeditTreeSconti:function(b,c){if(!c.record.isLeaf())return!1},beforeeditTreeServiziClass:function(b,c){if(!c.record.isLeaf()||"S"==this.getCntParam().down("#Certif_QuotaAlbSan").getValue().certif_QuotaAlbSan)return!1},beforeeditTreeMotiviUscitaTemp:function(b,c){if(!c.record.isLeaf())return!1},
getTipoClassRadioGroup:function(){return this.getTipoClass().down("radiogroup")},getTipoComuneGroup:function(){return this.getTipoComune().down("radiogroup")},reloadRegistro:function(b){var c=this.getRegistro().getStore(),d=new Date,f={};this.tabelleAmm2?(c.getProxy().url="/cba/osp/co/ws/genAmmPers/registriIva/detail/cboxByDate",Ext.apply(f,{dataControllo:d,tipoDocumento:2,idOrganizzazione:getIdOrg()})):(ImpostaUrl([c]),Ext.apply(f,{anno:b||d.getFullYear()}));setTimeout(function(){c.load({params:f,
callback:function(b,c,d){d||msgShowError("",c.getError())}})},100)},changeRiepRaggruppamento:function(b,c,d,f){var g=this;null==c?b.setValue(d):(4==g.cbaConfig.id||118==g.cbaConfig.id||6004==g.cbaConfig.id?(g.getTipoClass().setVisible(3!=c),g.getTipoComune().setVisible(3==c),g.getTipoMedico().setVisible(6==c),g.loadTreeServClass(g.getTipoClass().hidden?g.getTipoComune().hidden?1:g.getTipoComune().getValue():g.getTipoClass().getValue()),g.getTabPeriodo().setVisible(!0),g.getConsideraUtenti().setVisible(!0),
g.getDataGiornoAl().setVisible(!1),g.getFsDataAl().setVisible(!1),g.getChkGrpClass().setVisible(!1)):(g.getChkGrpServizio().setVisible("7"==c||"9"==c),"7"!=c&&"9"!=c&&g.getChkGrpServizio().setValue(!1),g.getCondPagamento().setVisible(!1),b={},"3"==c&&61!=g.cbaConfig.id&&(g.getCondPagamento().setVisible(!0),b={tabellaNuova:"F",filtroFattOsp:"T"}),27!=g.cbaConfig.id&&6027!=g.cbaConfig.id||g.getCondPagamento().setVisible(!0),g.getCondPagamento().hidden||0==g.getCondPagamento().getStore().getCount()&&
g.getCondPagamento().getStore().load({params:b,callback:function(b,c,d){d?g.getCondPagamento().getSelectionModel().selectAll():msgShowError("",c.getError())}}),61==g.cbaConfig.id||"1"!=c&&"2"!=c||g.getCambiaPag().setVisible("2"==c&&g.cbaConfig.cambiaPagina)),g.getTipoComune().hidden?g.cbaConfig.soloServizi?g.getTreeServiziClass().getColumns()[0].setText(traduci("SERVIZI")):g.getTreeServiziClass().getColumns()[0].setText(traduci("SERVIZI_CLASSIFICAZIONI")):g.getTreeServiziClass().getColumns()[0].setText(traduci("COMUNI")))},
nuovoFasce:function(){var b=this.getGridFasceEta(),c=0;b.getStore().each(function(b){b.data.etaMax>c&&(c=b.data.etaMax)});var c=c+1,d={id:-1,idOrganizzazione:getIdOrg(),etaMin:c,etaMax:c+9};b.getStore().insert(0,d);b.plugins[0].startEdit(0,0)},eliminaFasce:function(){var b=this;if(0==b.getGridFasceEta().getSelectionModel().getCount())return Messaggio("Attenzione","Nessuna fascia selezionata!","OK","WARNING"),!1;b.getGridFasceEta().getSelectionModel().getCount()==b.getGridFasceEta().getStore().getTotalCount()?
Messaggio("Attenzione","Eliminando tutte le fasce, verranno ri-create le fasce di default: proseguire?","YESNO","QUESTION",null,function(){b.funEliminaFasce()}):Messaggio("Elimina","Eliminare TUTTE le fasce selezionate?","YESNO","QUESTION",null,function(){b.funEliminaFasce()})},funEliminaFasce:function(){var b=this,c="";Ext.each(b.getGridFasceEta().getSelectionModel().getSelection(),function(b){c=""==c?b.get("id"):c+","+b.get("id")});Ext.Ajax.request({method:"GET",url:"/cba/osp/co/ws/reports/organization/fasceeta/deleteList",
params:{elenco:c},success:function(c){c=Ext.JSON.decode(c.responseText);c.success||msgShowError("",c.message);b.aggiornaStoreFasce(0)}})},aggiornaStoreFasce:function(b){var c=null,c="gridpanel"!==this.xtype?this.getGridFasceEta():this;c.getStore().load({callback:function(b,f,g){c.getSelectionModel().selectAll()}})},canceleditGridFasceEta:function(b,c,d){b=c.record;this.aggiornaStoreFasce(b.data.id,b)},editGridFasceEta:function(b,c,d){d=this.getGridFasceEta();var f=c.record.data;f.idOrganizzazione=
1;d.aggiornaStore||(d.aggiornaStore=this.aggiornaStoreFasce);salvaRecord(d,f,d.getStore(),!1,"id")||b.startEdit(c.record,0);this.aggiornaStoreFasce()},changeTipoStampa:function(b,c,d,f){if(null==c)b.setValue(d);else{if(27==this.cbaConfig.id||6027==this.cbaConfig.id){var g=this.getRiepRaggruppamento();g.getStore().load({params:{reportId:this.cbaConfig.id,tipoReport:c},callback:function(b,c,d){d&&0<b.length?g.setValue(b[0].data.codice):msgShowError("",c.getError())}});this.loadTreeServClass(this.getTipoClass().hidden?
this.getTipoComune().hidden?1:this.getTipoComune().getValue():this.getTipoClass().getValue())}this.getTipoClass().setDisabled(403==c);403==c&&this.getTipoClass().setValue(1);3811==c||3812==c?(this.getRaggrPerSede().setVisible(3812==c),this.getGridFasceEta().setVisible(3811==c),this.getTreeServiziClass().getRootNode().getChildAt(0)||this.loadTreeServClass()):4501<=c&&4503>=c&&(this.getChkOccupanti().setVisible(4502==c),this.getChkSoloLibere().setVisible(4502==c),this.getCntTreeServizi().setVisible(!1));
if(14==this.cbaConfig.id||6014==this.cbaConfig.id)this.setPagePersRiferimento(1402==c),this.setPagePaganti(1403==c),this.getPageEtichette().items.items[0].controller.ricaricaTitle(this.cbaConfig.tipoReport?trovaRecord(this.getCbTipoStampa().getStore(),this.getCbTipoStampa().valueField,this.getCbTipoStampa().getValue()).get("extra"):0);this.getCboxFiltraStoricoQuote().setVisible(4==this.cbaConfig.id&&403==c)}},setPagePaganti:function(b){var c=this.getTabPrincipale();this.cbaConfig.visualizzaSoloPagantiAttivi=
b;this.getChkVisualizzaSoloPagantiAttivi().setVisible(this.cbaConfig.visualizzaSoloPagantiAttivi);this.getContainerFiltriPag()&&this.getContainerFiltriPag().setVisible(b);c.items.get("PagePaganti")&&((this.cbaConfig.tipoPagante=b)?c.items.get("PagePaganti").tab.show():c.items.get("PagePaganti").tab.hide())},setPagePersRiferimento:function(b){var c=this,d=c.getTabPrincipale();if(b){d.items.get("PagePersRiferimento").tab.show();var f=c.getGridGradoParentela();f.getStore().load({callback:function(b,
d,k){if(k){f.getSelectionModel().selectAll();var g=c.getGridRating();g.getStore().load({callback:function(b,d,f){f?(g.getSelectionModel().selectAll(),c.getCntParam().scrollTo("top",0)):(b=[],msgAddError(b,d.getError()),msgShow("",b))}})}else b=[],msgAddError(b,d.getError()),msgShow("",b)}})}else d.items.get("PagePersRiferimento").tab.hide()},changeRitenuta:function(b){this.inModificaCheck||(this.inModificaCheck=!0,b.value?(this.getChkSconto().value&&this.getChkSconto().setValue(!1),this.getChkSupplemento().value&&
this.getChkSupplemento().setValue(!1),2<this.getRiepRaggruppamento().getValue()&&this.getRiepRaggruppamento().setValue(1),this.getRiepRaggruppamento().store.filter({filterFn:function(b){return 2>=b.get("codice")}})):(this.getChkSconto().value||this.getChkSupplemento().value||(this.getChkSconto().setValue(!0),this.getChkSupplemento().setValue(!0)),this.getRiepRaggruppamento().store.clearFilter()),this.inModificaCheck=!1)},changeSconto:function(b){this.inModificaCheck||73==this.cbaConfig.id||(this.inModificaCheck=
!0,b.value?(this.getChkRitenuta().value&&this.getChkRitenuta().setValue(!1),this.getRiepRaggruppamento().store.clearFilter()):this.getChkSconto().value||this.getChkSupplemento().value||(this.getChkRitenuta().setValue(!0),2<this.getRiepRaggruppamento().getValue()&&this.getRiepRaggruppamento().setValue(1),this.getRiepRaggruppamento().store.filter({filterFn:function(b){return 2>=b.get("codice")}})),this.inModificaCheck=!1)},changeChkSaldiZero:function(b){this.getChkSaldiZero().getValue()?(this.getChkNonMovimentati().setValue(!1),
this.getChkNonMovimentati().setDisabled(!0)):this.getChkNonMovimentati().setDisabled(!1)},changeFattureArchiviate:function(b,c){this.getBoxNumerazione().setVisible(c);this.svuotaStorePaganti()},checkchangeMotiviDim:function(){this.svuotaStoreUtenti()},checkchangeMotiviUscita:function(){this.svuotaStoreUtenti()},renderPageSchedeFascicolo:function(){this.loadSchedeFascicolo()},filtraSoloAttivi:function(b,c,d,f){this.filtraTreeSoloAttivi(this.getTreeServiziClass(),c);this.filtraTreeSoloAttivi(this.getTreeMotiviUscitaTemp(),
c);this.filtraTreeSoloAttivi(this.getTreeSupplementi(),c);this.filtraTreeSoloAttivi(this.getTreeSconti(),c)},filtraTreeSoloAttivi:function(b,c){b.getStore().clearFilter();c&&b.getStore().filter({filterFn:function(b){return!["testoAnnullato non_attivi"].includes(b.data.cls)}});127==this.cbaConfig.id&&b.getStore().filter({filterFn:function(b){return 7==b.get("tipoFlusso")}});this.svuotaStoreUtenti()},filtraSoloAttiviScontiSupp:function(b,c,d,f){this.filtraTreeSoloAttiviScontiSupp(this.getTreeSupp(),
c);this.filtraTreeSoloAttiviScontiSupp(this.getTreeSconto(),c)},filtraTreeSoloAttiviScontiSupp:function(b,c){if(c)b.getStore().filter({filterFn:function(b){return!["testoAnnullato non_attivi"].includes(b.data.cls)}});else{var d=getListCheckedTree(this.getTreeServiziClass(),!0,"idServizio");b.getStore().clearFilter();b.getStore().filter({filterFn:function(b){return!Ext.isEmpty(b.data.idServizio)&&d.includes(b.data.idServizio)}})}this.svuotaStoreUtenti()},filtraPerSede:function(b,c,d,f){this.getTreeSedeReparto().setDisabled(!c);
this.svuotaStoreUtenti()},showUtentiInDimissione:function(){var b=!1;this.getTreeServiziClass().getStore().getRootNode().cascadeBy(function(c){b||!c.data.checked||c.isRoot()||Ext.isEmpty(c.get("impostazioniServizio"))||(b="T"==c.data.impostazioniServizio.split(",")[0])});this.getChkInUscita().isVisible()||this.getChkInUscita().setValue(!0);this.getChkInUscita().setVisible(b);this.getChkIngressiPrevisti().isVisible()||this.getChkIngressiPrevisti().setValue(!0);this.getChkIngressiPrevisti().setVisible(b)},
treeCheckchange:function(b,c,d){treeCheckchange(b,c,d);this.svuotaStoreUtenti();this.svuotaStorePaganti();if(this.cbaConfig.consideraUtenti||this.cbaConfig.filtroMovimenti)null==b?"TreeServiziClass"==d.tree.getItemId()&&this.filtraMotiviDimissione(0,c):"TreeServiziClass"==b.getOwnerTree().getItemId()&&this.filtraMotiviDimissione(b.get("idServizio"),c),this.cbaConfig.filtroMovimenti&&this.showUtentiInDimissione()},beforeitemcontextmenu:function(b,c,d,f,g,h){return getPopupMenuTree(g,b)},changeUtentiDaInizioAnno:function(b,
c,d,f){this.svuotaStoreUtenti();this.getAttivi().setDisabled(c);this.getAttivi().setValue("T");this.getNonAttivi().setDisabled(c);this.getNonAttivi().setValue(c?"T":"F");this.getMotiviDim().setVisible(!1)},changeAttivi:function(b,c,d,f){this.svuotaStoreUtenti()},changeNonAttivi:function(b,c,d,f){this.getMotiviDim().setVisible(c);this.svuotaStoreUtenti()},changeChkUsciti:function(b,c,d,f){this.getMotiviUscita().setVisible(c);this.svuotaStoreUtenti()},filtraMotiviDimissione:function(b,c){var d;d=this.cbaConfig.consideraUtenti?
this.getMotiviDim():this.getMotiviUscita();d.suspendLayouts();var f=d.getStore(),g=getListCheckedTree(this.getTreeServiziClass(),this.cbaConfig.soloServizi?!0:!1,"idServizio").split(",");f.clearFilter();if(0==b)c?d.getSelectionModel().selectAll():f.filter({filterFn:function(b){return!1}});else{var h=!1;if(c){var k;Ext.each(d.getSelectionModel().getSelection(),function(c){k=c.get("idServizio");if(b==k)return h=!0,!1})}f.clearFilter();f.filter({filterFn:function(c){var f=c.get("idServizio").toString(),
k=!1;0<=Ext.Array.indexOf(g,f)&&(k=!0,c.get("idServizio")!=b||h||d.getSelectionModel().select([c],!0));return k}})}d.resumeLayouts(!0)},controllaMotiviDimissione:function(){return this.getTabPrincipale().getActiveTab()==this.getPageParametri()&&this.getNonAttivi().getValue()&&0==this.getMotiviDim().getSelectionModel().getCount()||this.getChkUsciti().up().isVisible()&&this.getChkUsciti().getValue()&&0==this.getMotiviUscita().getSelectionModel().getCount()?(msgShowWarning("","MSG_MOTIVI_DIM_OBB"),!1):
!0},loadSchedeFascicolo:function(){var b=this,c=b.getGridSchedeFas();inizioAttesa();c.getStore().load({callback:function(d,f,g){g?Ext.isEmpty(d)||(Ext.suspendLayouts(),b.selectAllRows(c),Ext.resumeLayouts()):msgShowError("",f.getError());fineAttesa()}})},getCondPagamentoSelezionate:function(){var b=[],c=this.getCondPagamento();c.hidden||c.getStore().getTotalCount()!=c.getSelectionModel().getCount()&&Ext.each(c.getSelectionModel().getSelection(),function(c){b.push(c.get("codice"))});return b.toString()},
loadPagantiFascicolo:function(){if(this.cbaConfig.tipoDocFattura&&(this.getTabPrincipale().getActiveTab()!=this.getPagePaganti()||0!=this.getGridPaganti().getStore().getCount()))return!1;inizioAttesa();var b=this,c=b.getGridPaganti(),d=b.getTreeServiziClass(),f=[],g=[],h="";b.getGridCategoria().getStore().load();b.getTipoPagantePagePaganti().getStore().load();Ext.each(b.getGridUtenti().getSelectionModel().getSelection(),function(b){b=b.get("elencoRicoveri");if(!Ext.isEmpty(b)&&0<b.length)for(var c=
0;c<b.length;c++){var d=b[c];d&&!Ext.Array.contains(f,d)&&f.push(d)}});if(b.cbaConfig.tipoDocFattura){if(b.getTipoDocFatturaLibera().getValue()||b.getTipoDocRetta().getValue())b.getTipoFattura().getValue()&&(g.push("1"),g.push("4")),b.getTipoDocContabile().getValue()&&(g.push("2"),g.push("5")),b.getTipoCorrispettivo().getValue()&&(g.push("3"),g.push("6"));Ext.each(g,function(b){h+=","+b});h=h.substr(1)}g="";b.cbaConfig.pageParametri&&(b.getFattureArchiviate().getValue()&&b.getFattureDefinitive().getValue()||
(g=getBoolValue(b.getFattureArchiviate().getValue())));var k=b.getCondPagamentoSelezionate();svuotaStore(c.getStore());b.abilitaPulsanti(!1);d={dataDal:b.getDataDal().getValue(),dataAl:b.getDataAl().getValue(),elencoCondPag:k,ricoveri:f.toString(),servizi:getListCheckedTree(d,!0,"idServizio"),classificazioni:getListCheckedTree(d,!0,"idRisposta",null,null,b.getFiltraSoloAttivi().value?!1:!0),tipoDocRette:b.cbaConfig.tipoDocFattura?"T":"F",statoContabilizzato:g,tipoDocList:h,tipoClassificazione:b.cbaConfig.pageParametri&&
!b.getTipoClass().hidden?b.getTipoClass().getValue():"1"};Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/rette/paganti/list",params:d,success:function(d){d=Ext.JSON.decode(d.responseText);d.success?Ext.isEmpty(d.data)?msgShowWarning("","MSG_STAMPA_NESSUN_PAGANTE"):(Ext.suspendLayouts(),c.getStore().loadData(d.data),c.getStore().totalCount=d.data.length,b.selectAllRows(c),Ext.resumeLayouts()):msgShowError("",d.message);b.abilitaPulsanti(!0);fineAttesa();d.success&&b.filtraPaganti()}})},filtraPaganti:function(){var b=
[],c=[],d=this.getGridCategoria(),f=40==this.cbaConfig.id||43==this.cbaConfig.id||27==this.cbaConfig.id?this.getTipoPagante():this.getTipoPagantePagePaganti(),g=0<d.getSelectionModel().getCount()&&d.getSelectionModel().getCount()!=d.getStore().getTotalCount();g&&Ext.each(d.getSelectionModel().getSelection(),function(c){b.push(c.get("codice"))});var h=0<f.getSelectionModel().getCount()&&f.getSelectionModel().getCount()!=f.getStore().getTotalCount();h&&Ext.each(f.getSelectionModel().getSelection(),
function(b){c.push(b.get("codice"))});this.personContabili||(this.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null));var k=4==this.personContabili.tipoContabilitaAbilitata||5==this.personContabili.tipoContabilitaAbilitata;this.getGridPaganti().getSelectionModel().deselectAll();this.getGridPaganti().getStore().clearFilter();this.getGridPaganti().getStore().filter([{filterFn:function(d){var f=!0,l=!0;g&&(k?(f=!1,Ext.each(b,function(b){if(0<=d.get("codiciCategorie").indexOf(b))return f=
!0,!1})):f=0==b.length||0<=Ext.Array.indexOf(b,d.get("codCategoria")));h&&(l=0==c.length||0<=Ext.Array.indexOf(c,d.get("tipoPagante")));return f&&l}}]);0==this.getGridPaganti().getStore().getCount()?msgShowWarning("","MSG_STAMPA_NESSUN_PAGANTE"):this.getGridPaganti().getSelectionModel().selectAll()},loadUtenti:function(){inizioAttesa();var b=this,c=b.getGridUtenti(),d=b.getUtentiDaInizioAnno(),f=b.getAttivi(),g=b.getNonAttivi(),h=61==b.cbaConfig.id||6061==b.cbaConfig.id?b.getTreeClassifImporti():
b.getTreeServiziClass(),k=b.getTreeSedeReparto(),l=b.getMotiviDim(),n=l?l.getSelectionModel().getSelection():"",p=[],l=b.getFiltraPerSede(),q=b.getDataDal(),r=b.getDataAl();g&&g.getValue()&&Ext.each(n,function(b){p.push(b.get("risposta"))});var t="";b.cbaConfig.tipoDocFattura&&b.cbaConfig.pagePaganti&&b.getGridPaganti().getSelectionModel().getCount()!=b.getGridPaganti().getStore().getTotalCount()&&(n=b.getGridPaganti(),Ext.each(n.getSelectionModel().getSelection(),function(b){t+=","+b.get("codFocl")}),
""!=t&&(t=t.substr(1)));var n=[],u="";if(b.cbaConfig.tipoDocFattura){if(b.getTipoDocFatturaLibera().getValue()||b.getTipoDocRetta().getValue())b.getTipoFattura().getValue()&&(n.push("1"),n.push("4")),b.getTipoDocContabile().getValue()&&(n.push("2"),n.push("5")),b.getTipoCorrispettivo().getValue()&&(n.push("3"),n.push("6"));Ext.each(n,function(b){u+=","+b});u=u.substr(1)}n="";b.cbaConfig.pageParametri&&(b.getFattureArchiviate().getValue()&&b.getFattureDefinitive().getValue()||(n=getBoolValue(b.getFattureArchiviate().getValue())));
var x=b.getCondPagamentoSelezionate(),v=[],v=b.cbaConfig.soloStrutture?getListCheckedTree(h,!0,"idServizio").split(",").map(function(b){return-Math.abs(b)}).toString():getListCheckedTree(h,!0,"idRisposta",null,null,b.getFiltraSoloAttivi().value?!1:!0);svuotaStore(c.getStore());b.abilitaPulsanti(!1);var w=q.getValue();b.cbaConfig.certificazioni?(d=new Date(q.getValue()),d.setYear(d.getFullYear()-1),d.setMonth(6),w=d):d.isVisible()&&d.getValue()&&(w=CbaDateUtils.startOfYear(q.getValue()));d="1";d=75==
b.cbaConfig.id?"5":b.cbaConfig.pageParametri?!b.getTipoClass().hidden&&b.getTipoClass().getValue()&&void 0!=b.getTipoClass().getValue()?b.getTipoClass().getValue():b.getTipoComune().hidden?"1":b.getTipoComune().getValue():"1";c.getStore().load({params:{dataDal:w,dataAl:r.getValue(),presenti:getBoolValue(f.getValue()),dimessi:getBoolValue(g.getValue()),servizi:"("+getListCheckedTree(h,b.cbaConfig.soloServizi?!0:!1,"idServizio","'")+")",elencoCondPag:x,classificazioni:v,sedi:l?l.getValue()?"("+getListCheckedTree(k,
!1,"idSede")+")":"":"",reparti:l?l.getValue()?"("+getListCheckedTree(k,!0,"idReparto")+")":"":"",motiviDimissione:"("+p+")",filtraPerSede:getBoolValue(l?l.getValue():!1),soloPensioni:b.cbaConfig.soloPensioni?"T":"F",tipoDocRette:b.cbaConfig.tipoDocFattura?"T":"F",statoContabilizzato:n,tipoDocList:"("+u+")",listaPaganti:"("+t+")",tipoClassificazione:d,tipoStampa:b.cbaConfig.certificazioni?b.cbaConfig.id:-1,listaAttesa:48==CBA.moduli.moduloAttivo?"T":"F"},callback:function(d,f,g){g?Ext.isEmpty(d)?msgShowWarning("",
"MSG_STAMPA_NESSUN_UTENTE"):(Ext.suspendLayouts(),b.selectAllRows(c),Ext.resumeLayouts()):msgShowError("",f.getError());b.abilitaPulsanti(!0);fineAttesa()}})},addCounterUtenti:function(b,c){var d=b.down("#countRecUte");d||(d=b.down("toolbar"),d.add({xtype:"tbfill"}),d.add({xtype:"label",hidden:!0,itemId:"countRecUte",reference:"countRecUte"}),d=b.down("#countRecUte"));d.setHidden(!1);d.setText(c)},controllaCampiRiepilogoDocRetta:function(){if("/cba/osp/co/ws/reports/documentiRette/riepilogo"==this.cbaConfig.url){var b=
[];this.getTipoFattura().getValue()||this.getTipoDocContabile().getValue()||this.getTipoCorrispettivo().getValue()||msgAddWarning(b,"MSG_TIPO_DOCFATTURA_OBB");this.getTipoDocRetta().getValue()||this.getTipoDocFatturaLibera().getValue()||msgAddWarning(b,"MSG_TIPO_DOC_RETTAFATT_OBB");this.getFattureDefinitive().getValue()||this.getFattureArchiviate().getValue()||msgAddWarning(b,"MSG_TIPO_FATT_DEFARC_OBB");this.getRiepRaggruppamento().getValue()||msgAddWarning(b,"MSG_RIEP_RAGGRUPPAMENTO");if(0<b.length)return msgShowWarning("",
b),!1}return!0},controllaCertificazioni:function(){if(!this.cbaConfig.certificazioni)return!0;var b=this.getTabPrincipale().down("#GridCertif"),c=[],d=!1;this.certifLomb?c=b.getSelectionModel().getSelection():Ext.each(b.getStore().data.items,function(b){b.get("selected")&&c.push(b)});if(0==c.length)return msgShowWarning("","CERTIF_EMPTY_LIST"),!1;Ext.each(c,function(f){var g=f.get("errors");if(!Ext.isEmpty(g))if("ERR_CERT_STD_NO_FATT"===g){if(this.certifLomb?b.getSelectionModel().deselect(f):f.set("selected",
!1),1==c.length)return msgShowWarning("","CERTIF_EMPTY_LIST"),d=!0,!1}else{if(-1!=g.indexOf("ERR_CERT_STD_NO_PGNT")||-1!=g.indexOf("ERR_CERT_STD_NO_USER")||-1!=g.indexOf("ERR_CERT_STD_IMPSAN_ZERO")||-1!=g.indexOf("ERR_CERT_STD_PGN"))return msgShowWarning("","CERTIF_ERROR_LIST"),d=!0,!1;-1!=g.indexOf("ERR_CERT_STD_PAG!=FATT")||-1!=g.indexOf("ERR_CERT_STD_NO_IND_PGNT")||g.indexOf("ERR_CERT_STD_DETT_IMPSAN_ZERO")}});return 0==d},getErroriStampa:function(b,c){var d=this.cbaConfig,f=this.getTabPrincipale(),
g=f.getActiveTab(),h=f.getLayout().getNext();f.cambiaTab=!0;if(g==this.getPageAnteprima()&&!this.controllaMotiviDimissione())return this.taskElaborazione&&(this.taskElaborazione.stop(),this.taskElaborazione.destroy(),this.stampaInCorso=!1),f.cambiaTab=!1,!0;if((c&&(g==this.getPageAnteprima()||h==this.getPageAnteprima())||!c&&b&&"next"==b&&"PageCertificazioni"==g.getItemId()&&h==this.getPageAnteprima())&&!this.controllaCertificazioni())return this.getPageAnteprima().down("#CntAnteprima").removeAll(),
this.getPageAnteprima().down("#CntDownload").removeAll(),this.taskElaborazione&&(this.taskElaborazione.stop(),this.taskElaborazione.destroy(),this.stampaInCorso=!1),f.cambiaTab=!1,!0;if(!d.eseguiStampa&&!this.controllaCampiRiepilogoDocRetta())return this.taskElaborazione&&(this.taskElaborazione.stop(),this.taskElaborazione.destroy(),this.stampaInCorso=!1),f.cambiaTab=!1,!0;d=this.getCbDocPers();return c&&(g==this.getPageAnteprima()||h==this.getPageAnteprima())&&d.isVisible()&&Ext.isEmpty(d.getValue())?
(this.taskElaborazione&&(this.taskElaborazione.stop(),this.taskElaborazione.destroy(),this.stampaInCorso=!1,iframe),f.cambiaTab=!1,msgShowWarning("","CERTIF_ERROR_DOC_PERSON"),!0):!1},checkAbilitaPrognosi:function(){var b=!1;this.getTreeServiziClass().getStore().getRootNode().cascadeBy(function(c){if(c.data.checked&&!c.isRoot()&&!c.isLeaf()&&!Ext.isEmpty(c.get("impostazioniServizio"))&&"T"==c.data.impostazioniServizio.split(",")[0])return b=!0});return b},abilitaMotiviGGDim:function(){var b=[];this.getTreeServiziClass().getStore().getRootNode().cascadeBy(function(c){!c.data.checked||
c.isRoot()||c.isLeaf()||Ext.isEmpty(c.get("impostazioniServizio"))||"T"!=c.data.impostazioniServizio.split(",")[1]||b.push(c.get("idServizio"))});var c=this.getMotiviGGDim();c.getSelectionModel().deselectAll();c.getStore().each(function(d){if(d){var f=d.get("idServizio");0<=Ext.Array.indexOf(b,f)&&c.getSelectionModel().select([d],!0)}});c.getView().scrollTo("top",0)},updateParametriStampa:function(){var b=this,c=b.cbaConfig,d=b.getTabPrincipale();if(this.getErroriStampa(!1,!0))return!1;var f=b.getChkPagante()?
b.getChkPagante().getValue()?b.getCboxPagante()?b.getCboxPagante().getValue():null:null:null,g={};if(c.eseguiStampa){var h=b.getDataGiornoAl().isVisible()?b.getDataGiornoAl():b.getDataDal(),k=b.getDataGiornoAl().isVisible()?b.getDataGiornoAl():b.getDataAl();c.servizi||Ext.isEmpty(CBA.parametriGenerali.filtriAttivi.filtroServizi);Ext.apply(g,{url:b.cambiaUrlPortale?b.cbaConfig.portale:b.cbaConfig.url,uploadPortale:"F",dataDal:c.dataDal?c.dataDal:"",dataAl:c.dataAl?c.dataAl:"",presenti:c.presenti?getBoolValue(c.presenti):
"",dimessi:c.dimessi?getBoolValue(c.dimessi):"",servizi:c.servizi?c.servizi:"",classificazioni:c.classificazioni?c.classificazioni:"",sedi:c.sedi?c.sedi:"",reparti:c.reparti?c.reparti:"",motiviDimissione:c.motiviDimissione?c.motiviDimissione:"",filtraPerSede:c.filtraPerSede?c.filtraPerSede:"",grpMotivoAssenze:c.grpMotivoAssenze?c.grpMotivoAssenze:"",tipoClassificazione:c.tipoClassificazione?c.tipoClassificazione:"",nuovaPaginaPerUtente:c.nuovaPaginaPerUtente?c.nuovaPaginaPerUtente:"",elencoUtenti:c.elencoUtenti?
c.elencoUtenti:"",esponiAssenze:getBoolValue(b.getCBAssenzeRighe().getValue()),raggruppaPerAsl:b.getCBRaggPerAsl().getValue(),elencoSezioniFascicolo:c.elencoSezioniFascicolo?c.elencoSezioniFascicolo:"",tipiAssenze:c.motiviAssenza?null==c.motiviAssenza?b.getGridMotiviUscitaTemp().getStore().data:c.motiviAssenza:"",tipoFattura:c.tipoFattura?getBoolValue(c.tipoFattura):"",tipoDocContabile:c.tipoDocContabile?getBoolValue(c.tipoDocContabile):"",tipoCorrispettivo:c.tipoCorrispettivo?getBoolValue(c.tipoCorrispettivo):
"",tipoDocRetta:c.tipoDocRetta?getBoolValue(c.tipoDocRetta):"",tipoDocFatturaLibera:c.tipoDocFatturaLibera?getBoolValue(c.tipoDocFatturaLibera):"",statoDaContabilizzare:c.fattureDefinitive?getBoolValue(c.fattureDefinitive):"",statoContabilizzato:c.fattureArchiviate?getBoolValue(c.fattureArchiviate):"",registro:b.getBoxNumerazione().isVisible()?b.getRegistro().getValue():"",numeroDocDal:b.getBoxNumerazione().isVisible()&&b.getDalNumero().getValue()?b.getDalNumero().getValue():0,numeroDocAl:b.getBoxNumerazione().isVisible()&&
b.getAlNumero().getValue()?b.getAlNumero().getValue():999999999,dividiPerAsl:getBoolValue(b.getChkDividiPerAsl().getValue()),elencoTipoPagante:c.elencoTipoPagante?c.elencoTipoPagante:"",raggruppamento:c.raggruppamento?c.raggruppamento:"",formatoCarta:c.formatoCarta?c.formatoCarta:"",tipoMedico:c.tipoMedico?c.tipoMedico:"",idPagante:c.idPagante?c.idPagante:"",elencoPaganti:c.elencoPaganti?c.elencoPaganti:"",elencoRicoveri:c.elencoRicoveri?c.elencoRicoveri:"",tipoStampaEstrattoConto:c.tipoStampaEstrattoConto?
c.tipoStampaEstrattoConto:"",includiSaldiZero:b.getChkSaldiZero().getSubmitValue(),soloSaldiNegativi:b.getChkSaldiNegativi().getSubmitValue(),includiNonMovimentati:b.getChkNonMovimentati().getSubmitValue(),idFoClPagante:f?f:"",idModello:c.idModello?c.idModello:"",demo:c.demo?c.demo:!1});b.getBoxNumerazione().isVisible()&&b.getCbEnteIva().getValue()&&Ext.apply(g,{enteIvaFinanziaria:b.getCbEnteIva().getValue()})}else{var l=b.getUtentiDaInizioAnno(),n=b.getAttivi(),p=b.getNonAttivi(),q=b.getChkUsciti(),
r=b.getTreeServiziClass(),t=b.getTreeSedeReparto(),u,x=(u=b.cbaConfig.consideraUtenti?b.getMotiviDim():b.getMotiviUscita())?u.getSelectionModel().getSelection():"",v=b.cbaConfig.fasceEta?b.getGridFasceEta().getSelectionModel().getSelection():"",w=[],y=[],C=[],E=[],F=[],A=[],H=[];u=b.getFiltraPerSede();var h=b.getDataGiornoAl().isVisible()?b.getDataGiornoAl():b.getDataDal(),k=b.getDataGiornoAl().isVisible()?b.getDataGiornoAl():b.getDataAl(),D="",N="F",G="",B="",I="",z="";if(b.cbaConfig.scontiSupp){z=
b.getChkRitenuta().value||b.getChkSconto().value&&b.getChkSupplemento().value;if(b.getChkSconto().value||b.getChkRitenuta().value)if(G=getListCheckedTree(b.getTreeSconto(),!0,"idRisposta"),""==G&&b.scontiSuppFiltrati){var O=[];b.getTreeSconto().getRootNode().cascade(function(b){b&&b.get("visible")&&b.isLeaf()&&O.push(b.get("idRisposta"))});G=O.toString()}if(b.getChkSupplemento().value||b.getChkRitenuta().value)if(B=getListCheckedTree(b.getTreeSupp(),!0,"idRisposta"),""==B&&b.scontiSuppFiltrati){var P=
[];b.getTreeSupp().getRootNode().cascade(function(b){b&&b.get("visible")&&b.isLeaf()&&P.push(b.get("idRisposta"))});B=P.toString()}I=""!=G?G+(""!=B?","+B:""):B;b.scontiSuppFiltrati||(z&&""==getListCheckedTree(b.getTreeSconto(),!0,"idRisposta",null,null,!0)&&""==getListCheckedTree(b.getTreeSupp(),!0,"idRisposta",null,null,!0)?I="":(z||""!=getListCheckedTree(b.getTreeSconto(),!0,"idRisposta",null,null,!0)||(G=""),z||""!=getListCheckedTree(b.getTreeSupp(),!0,"idRisposta",null,null,!0)||(B=""),I=""!=
G?G+(""!=B?","+B:""):B));b.getChkRitenuta().value?z=b.getChkRitenuta().inputValue:(z=b.getChkSconto().value?b.getChkSconto().inputValue:"",z=b.getChkSupplemento().value?""!=z?z+","+b.getChkSupplemento().inputValue:b.getChkSupplemento().inputValue:z)}(p&&p.getValue()||q&&q.getValue())&&Ext.each(x,function(b){w.push(b.get("risposta"))});""!==v&&(q=b.getGridFasceEta().getStore(),0<v.length&&v.length!=q.data.length?(Ext.each(v,function(b){D=D+b.get("etaMin")+"-"+b.get("etaMax")+","}),N="T"):Ext.each(q.data.items,
function(b){D=D+b.get("etaMin")+"-"+b.get("etaMax")+","}),""!==D&&(D=D.substring(0,D.length-1)));w=w.toString();!n||n.getValue()||p.getValue()||n.setValue("T");q=b.getGridUtenti();b.cbaConfig.pageUtenti&&0!=q.getSelectionModel().getCount()&&(Ext.each(q.getSelectionModel().getSelection(),function(b){C.push(b.get("codOspite"))}),"6061"==b.cbaConfig.id&&q.getSelectionModel().getCount()==q.getStore().getRange().length&&(C=[]));C=C.toString();q=b.getGridPaganti();b.cbaConfig.pagePaganti&&Ext.each(q.getSelectionModel().getSelection(),
function(b){E.push(b.get("codFocl"))});E=E.toString();q=b.getGridSchedeFas();b.cbaConfig.pageSchedeFascicolo&&q.getStore().getTotalCount()!=q.getSelectionModel().getCount()&&Ext.each(q.getSelectionModel().getSelection(),function(b){F.push('"'+b.get("codice")+'"')});F=F.toString();q=b.getGridMotiviUscitaTemp();b.cbaConfig.motiviAssenza&&(Ext.each(q.getSelectionModel().getSelection(),function(b){A.push(b.get("risposta"))}),0==A.length&&Ext.each(q.getStore().data.items,function(b){A.push(b.get("risposta"))}));
A=A.toString();q=b.getTipoPagante();b.cbaConfig.tipoPagante&&Ext.each(q.getSelectionModel().getSelection(),function(b){H.push(b.get("codice"))});var H=H.toString(),L=[];b.getCondPagamento().hidden||(q=b.getCondPagamento(),Ext.each(q.getSelectionModel().getSelection(),function(b){L.push(b.get("codice"))}));var L=L.toString(),J=[];if(b.getFsScadDoc().isVisible()&&(q=b.getTipoDocumenti(),Ext.each(q.getSelectionModel().getSelection(),function(b){J.push(b.get("risposta"))}),0==J.length))return msgShowWarning("",
"MSG_TIPI_DOC_OBB"),!1;var J=J.toString(),K=[],M=[];if(b.cbaConfig.pageEtichette&&(q=b.cbaConfig.tipoReport?trovaRecord(b.getCbTipoStampa().getStore(),b.getCbTipoStampa().valueField,b.getCbTipoStampa().getValue()).get("extra"):0,2==q&&(Ext.each(b.getGridGradoParentela().getSelectionModel().getSelection(),function(b){K.push(b.get("risposta"))}),K=K.toString(),Ext.each(b.getGridRating().getSelectionModel().getSelection(),function(b){M.push(b.get("valore"))}),M=M.toString(),Ext.apply(g,{filtroGradoParentela:0<
K.length?"T":"F",elencoGradiParentela:K,soloGarante:b.getCBGarante().getValue()?"T":"F",rating:M})),3!=q&&(E=""),v=b.getPageEtichette(),q=b.getPageEtichette().down("#abilitaFormModifica").getValue(),x=v.down("#formEtichette"),q||v.down("#abilitaFormModifica").setValue(!0),v=x.getValues(),Ext.isEmpty(v.tipoEtichetta)&&(v.tipoEtichetta=0),Ext.isEmpty(v.dimensioneCarattere)&&(v.dimensioneCarattere=10),q||b.getPageEtichette().down("#abilitaFormModifica").setValue(!1),Ext.apply(g,v),!this.getPageEtichette().down().controller.verificaImpostazioniEtichette(traduci("IMPOSTAZIONI_ETICHETTE"))))return d.cambiaTab=
!1;if(d=61==b.cbaConfig.id||6061==b.cbaConfig.id)Ext.apply(g,{elencoClassImporti:Ext.JSON.encode(b.leggiTreeServClassImporti())}),r=b.getTreeClassifImporti();b.cbaConfig.certificazioni&&Ext.apply(g,{elencoCertificazioni:Ext.JSON.encode(b.getCertificazioni())});q="";b.cbaConfig.pageParametri&&l.isVisible()&&l.getValue()?q="Na":b.cbaConfig.pageParametri&&(q=getBoolValue(n.getValue()));n="";b.cbaConfig.pageParametri&&l.isVisible()&&l.getValue()?n="Na":b.cbaConfig.pageParametri&&(n=getBoolValue(p.getValue()));
l=getListCheckedTree(r,b.cbaConfig.soloServizi?!0:!1,"idServizio");Ext.isEmpty(l)&&!Ext.isEmpty(CBA.parametriGenerali.filtriAttivi.filtroServizi)&&(l=CBA.parametriGenerali.filtriAttivi.filtroServizi.valore);p=getListCheckedTree(r,!1,"tipoFlusso");[75,127].includes(c.id)&&p&&(p=p.split(",")[0]);72==c.id&&Ext.each(b.getMotiviGGDim().getSelectionModel().getSelection(),function(b){y.push(b.get("risposta"))});v=this.getChkIngressiPrevisti().isVisible()?b.getChkIngressiPrevisti().getSubmitValue():b.getChkIngressiPrevisti().uncheckedValue;
stampaDimissioniPreviste=this.getChkInUscita().isVisible()?b.getChkInUscita().getSubmitValue():b.getChkInUscita().uncheckedValue;Ext.apply(g,{url:b.cambiaUrlPortale?b.cbaConfig.portale:b.cbaConfig.url,dataDal:b.cbaConfig.pageParametri?h.getValue():"",dataAl:b.cbaConfig.pageParametri?k.getValue():"",presenti:q,dimessi:n,servizi:b.cbaConfig.pageParametri?"("+l+")":"",strutture:getListCheckedTree(r,!1,"codStruttura"),tipoFlusso:p,classificazioni:d?null:b.cbaConfig.pageParametri?"("+getListCheckedTree(r,
!0,"idRisposta",null,null,b.getFiltraSoloAttivi().value?!1:!0)+")":"",scontiSupp:b.cbaConfig.scontiSupp&&""!=I?"("+I+")":"",elencoTipiRecordDe:z,sedi:b.cbaConfig.pageSedeReparto&&u.getValue()?"("+getListCheckedTree(t,!1,"idSede")+")":"",reparti:b.cbaConfig.pageSedeReparto&&u.getValue()?"("+getListCheckedTree(t,!0,"idReparto")+")":"",motiviDimissione:b.cbaConfig.pageParametri?"("+w+")":"",motiviGGDimissione:Ext.isEmpty(y)?"":"("+y+")",filtraPerSede:b.cbaConfig.pageSedeReparto?getBoolValue(u.getValue()):
"",grpMotivoAssenze:b.cbaConfig.pageParametri?getBoolValue(b.getMotivoAssenza().getValue()):"",tipoClassificazione:b.cbaConfig.pageParametri?b.getTipoClass().hidden?b.getTipoComune().hidden?"1":b.getTipoComune().getValue()-10:b.getTipoClass().getValue():"1",ggSoglia1:b.cbaConfig.pageParametri?b.getGgSoglia1().getValue():"",ggSoglia2:b.cbaConfig.pageParametri?b.getGgSoglia2().getValue():"",cambiaPagina:b.cbaConfig.cambiaPagina||b.getCambiaPag().isVisible()?getBoolValue(b.getCambiaPag().getValue()):
"F",elencoUtenti:"("+C+")",esponiAssenze:getBoolValue(b.getCBAssenzeRighe().getValue()),raggruppaPerAsl:b.getCBRaggPerAsl().getValue(),elencoSezioniFascicolo:"("+F+")",tipiAssenze:"("+A+")",tipoFattura:b.cbaConfig.pageParametri?getBoolValue(b.getTipoFattura().getValue()):"",tipoDocContabile:b.cbaConfig.pageParametri?getBoolValue(b.getTipoDocContabile().getValue()):"",tipoCorrispettivo:b.cbaConfig.pageParametri?getBoolValue(b.getTipoCorrispettivo().getValue()):"",tipoDocRetta:b.cbaConfig.pageParametri?
getBoolValue(b.getTipoDocRetta().getValue()):"",tipoDocFatturaLibera:b.cbaConfig.pageParametri?getBoolValue(b.getTipoDocFatturaLibera().getValue()):"",statoDaContabilizzare:b.cbaConfig.pageParametri?getBoolValue(b.getFattureDefinitive().getValue()):"",statoContabilizzato:b.cbaConfig.pageParametri?getBoolValue(b.getFattureArchiviate().getValue()):"",registro:b.getBoxNumerazione().isVisible()?b.getRegistro().getValue():"",numeroDocDal:b.getBoxNumerazione().isVisible()&&b.getDalNumero().getValue()?b.getDalNumero().getValue():
0,numeroDocAl:b.getBoxNumerazione().isVisible()&&b.getAlNumero().getValue()?b.getAlNumero().getValue():999999999,elencoTipoPagante:"("+H+")",raggruppamento:b.cbaConfig.filtroMovimenti?b.getChkEntrati().getSubmitValue()+b.getChkUsciti().getSubmitValue()+b.getChkUscitiTmp().getSubmitValue()+b.getChkRientratiTmp().getSubmitValue()+b.getChkCambioResid().getSubmitValue()+b.getChkCambioClass().getSubmitValue()+stampaDimissioniPreviste+v:b.cbaConfig.pageParametri?StdSipcar.coalesce(b.getRiepRaggruppamento().getValue(),
"1"):"1",formatoCarta:b.cbaConfig.pageParametri?b.getFormatoCarta().down("radiogroup").getValue().formatoCarta:"",tipoMedico:b.cbaConfig.pageParametri?b.getTipoMedico().down("radiogroup").getValue().tipoMedico:"",tipoStampa:b.cbaConfig.tipoReport?trovaRecord(b.getCbTipoStampa().getStore(),b.getCbTipoStampa().valueField,b.getCbTipoStampa().getValue()).get("extra"):0,dividiPerAsl:getBoolValue(b.getChkDividiPerAsl().getValue()),ordineStampa:b.cbaConfig.ordineStampa?trovaRecord(b.getCbOrdine().getStore(),
b.getCbOrdine().valueField,b.getCbOrdine().getValue()).get("extra"):0,stampaGGPrognosi:getBoolValue(b.checkAbilitaPrognosi()),fasceEta:D,escludiAltro:N,raggruppaSede:getBoolValue(b.getRaggrPerSede().getValue()),tipoStampaEstrattoConto:b.cbaConfig.pageParametri?b.getCbEstrattoConto().getValue():"",includiSaldiZero:b.getChkSaldiZero().getSubmitValue(),soloSaldiNegativi:b.getChkSaldiNegativi().getSubmitValue(),includiNonMovimentati:b.getChkNonMovimentati().getSubmitValue(),idFoClPagante:f?f:"",elencoPaganti:E,
elencoTipiDoc:J,grpUtente:b.getChGrpUtScad().getValue(),grpXServizio:getBoolValue(b.getChkGrpServizio().getValue()),elencoCondPag:L,grpClass:b.getChkGrpClass().getValue(),occupanti:b.getChkOccupanti().getValue(),soloLibere:b.getChkSoloLibere().getValue(),idOrganizzazione:getIdOrg(),franchigiaGG:b.getFranchigiaAssenza().getValue(),importoPresenzaDefault:b.getImportoPresDefault().getValue()?b.getImportoPresDefault().getValue():0,importoAssenzaDefault:b.getImportoAssDefault().getValue()?b.getImportoAssDefault().getValue():
0,importiPersonalizzati:getBoolValue(b.getChkImportiPersonalizzazioni().getValue()),idModello:b.cbaConfig.pageParametri?b.getCbDocPers().getValue():"",conteggiaServizi:b.cbaConfig.pageParametri?getBoolValue(b.getChkConteggiaServizi().getValue()):"",filtraStoricoQuote:b.cbaConfig.pageParametri?getBoolValue(b.getChkFiltraStoricoQuote().getValue()):"",demo:!1,stampaUtentiNonAssenti:b.getCButentiNonAssenti().getValue(),calcoloConFranchigia:b.getCBCalcoloConFranchigia().getValue(),uploadPortale:"T"==b.cbaConfig.doUploadPortale?
"T":"F",uploadDataPubblicazione:b.cbaConfig.uploadDataPubblicazione?b.cbaConfig.uploadDataPubblicazione:"",uploadOggettoMail:b.cbaConfig.uploadOggettoMail?b.cbaConfig.uploadOggettoMail:"",uploadCorpoMail:b.cbaConfig.uploadCorpoMail?b.cbaConfig.uploadCorpoMail:"",uploadDescAgg:b.cbaConfig.uploadDescAgg?b.cbaConfig.uploadDescAgg:"",pubblica:b.getBoxDaPubblicare().getValue().BoxDaPubblicare,tipoContabilita:b.personContabili.tipoContabilitaAbilitata});b.cbaConfig.doUploadPortale="F";"CU_RiepilogoIncassoPensione"==
b.cbaConfig.progetto&&Ext.apply(g,{tipoPensioni:b.getFsTipoPensioni().down("radiogroup").getValue().tipoPensioni});g.tipoClassificazione||(g.tipoClassificazione=b.getTipoClass()?b.getTipoClass().items.items[0].lastValue.classificazione:"1");b.cbaConfig.consideraAssenze&&Ext.apply(g,{consideraAssenze:getBoolValue(b.getChkConsideraAssenze().getValue())});b.cbaConfig.visualizzaSoloPagantiAttivi&&Ext.apply(g,{soloPagantiAttivi:getBoolValue(b.getChkVisualizzaSoloPagantiAttivi().getValue())});b.getBoxNumerazione().isVisible()&&
b.getCbEnteIva().getValue()&&Ext.apply(g,{enteIvaFinanziaria:b.getCbEnteIva().getValue()});b.cbaConfig.stampaDettaglio&&Ext.apply(g,{stampaDettaglio:getBoolValue(b.getCBStampaDettaglio().getValue())});"43"!=b.cbaConfig.id&&"6043"!=b.cbaConfig.id||3!=b.getCbEstrattoConto().getValue()||(r=b.getFsMovimenti().down("#TipoMovVersamento").getValue(),h=b.getFsMovimenti().down("#TipoMovRestituzione").getValue(),r||h||(h=r=!0),Ext.apply(g,{tipoMovRestituzione:h?"T":"F",tipoMovVersamento:r?"T":"F"}));88==b.cbaConfig.id&&
Ext.apply(g,{elencoSedi:b.cbaConfig.pageSedeReparto&&u.getValue()?"("+getListCheckedTree(t,!1,"idSede")+")":"",reparti:b.cbaConfig.pageSedeReparto&&u.getValue()?"("+getListCheckedTree(t,!0,"idReparto")+")":"",tipoStampa:b.getCbTipoStampa().getValue()})}null!=f&&""!=f||delete g.idFoClPagante;b.cbaConfig.demo&&(b.cbaConfig.winElaborazione=!1);c=Ext.apply(this.parametriStampa,{url:b.cambiaUrlPortale?b.cbaConfig.portale:b.cbaConfig.url,jsonData:c.jsonData,titolo:c.titolo,renderTo:b.getPageAnteprima(),
winElaborazione:b.cbaConfig.winElaborazione,params:{reportId:c.id},callbackStampaErrori:function(){b.cbaConfig.erroreStampa=!0}});Ext.apply(c.params,g);b.cbaConfig.configBtnStampa&&(Ext.applyIf(c,b.cbaConfig.configBtnStampa),b.cbaConfig.configBtnStampa.params&&Ext.applyIf(c.params,b.cbaConfig.configBtnStampa.params));return!0},abilitaPulsanti:function(b){var c=this.getTabPrincipale().getLayout();b?(this.getBtnIndietro().setDisabled(!c.getPrev()),this.getBtnAvanti().setDisabled(!c.getNext()),this.taskElaborazione&&
this.taskElaborazione.start()):(this.getBtnIndietro().setDisabled(!0),this.getBtnAvanti().setDisabled(!0),this.taskElaborazione&&this.taskElaborazione.stop())},naviga:function(b){var c=this.getTabPrincipale(),d=c.down("#GridCertif");if(b){if(75==this.cbaConfig.id){var f=getListCheckedTree(this.getTreeServiziClass(),!1,"codStruttura"),f=0<f.length?f.split(","):[];if(!StdUtenti.checkNumStrutture(f.length,c,this.getBtnIndietro(),this.getBtnAvanti()))return!1}this.getGridUtenti()&&this.getGridUtenti().rendered&&
c.getActiveTab()==this.getPageUtenti()&&0==this.getGridUtenti().getStore().getCount()?this.loadUtenti():this.getGridPaganti()&&this.getGridPaganti().rendered&&c.getActiveTab()==this.getPagePaganti()?this.loadPagantiFascicolo():c.getActiveTab()==c.down("#PageCertificazioni")&&d&&d.rendered&&"next"==b?d.controller.aggiornaStore():c.getActiveTab()==c.down("#pageScontiSupp")&&this.loadScontiSupp()}else c.getActiveTab()==this.getPageUtenti()&&0==this.getGridUtenti().getStore().getCount()?this.loadUtenti():
c.getActiveTab()==this.getPagePaganti()?this.loadPagantiFascicolo():c.getActiveTab()==c.down("#PageCertificazioni")&&0<this.getGridUtenti().getSelectionModel().getSelection().length?d.controller.aggiornaStore():c.getActiveTab()==c.down("#pageScontiSupp")&&this.loadScontiSupp()},loadTreesCertificazioni:function(){var b=this.getCntScontiSupplementi(),c=this.getTreeSupplementi(),d=this.getTreeSconti();c.controller=this;c.on("beforeload",function(b){b.clearFilter()},c,{single:!0});var f=StdUtenti.promiseLoadStore(c.getStore(),
{tipo:15,soloServizi:"F",conImportiClass:this.cbaConfig.classifExtImporto?"T":"F",tipoStampa:this.cbaConfig.id,dataRif:63==this.cbaConfig.id?new Date(this.getTabPeriodo().down("#Anno").getValue(),0,1):null});d.controller=this;d.on("beforeload",function(b){b.clearFilter()},d,{single:!0});var g=StdUtenti.promiseLoadStore(d.getStore(),{tipo:14,soloServizi:"F",conImportiClass:this.cbaConfig.classifExtImporto?"T":"F",tipoStampa:this.cbaConfig.id,dataRif:63==this.cbaConfig.id?new Date(this.getTabPeriodo().down("#Anno").getValue(),
0,1):null});b.show();var h=this.getTreeMotiviUscitaTemp();h.controller=this;h.on("beforeload",function(b){b.clearFilter()},h,{single:!0});b=StdUtenti.promiseLoadStore(h.getStore(),{tipo:9,conImportiClass:this.cbaConfig.classifExtImporto?"T":"F",tipoStampa:this.cbaConfig.id,dataRif:63==this.cbaConfig.id?new Date(this.getTabPeriodo().down("#Anno").getValue(),0,1):null});h.show();var k=this.getFiltraSoloAttivi();Promise.all([f,g,b]).then(function(b){k.fireEvent("change",k,k.getValue());c.expandAll();
d.expandAll();h.expandAll()})["catch"](function(b){return msgShowError("",b)})},loadTreeServClass:function(b,c){c=void 0===c?!1:c;var d=this;d.cbaConfig.idImportiDefault=null;d.cbaConfig.soloStrutture=55==CBA.moduli.moduloAttivo||[75,127].includes(d.cbaConfig.id)?!0:!1;var f=61==d.cbaConfig.id||6061==d.cbaConfig.id?d.getTreeClassifImporti():d.getTreeServiziClass(),g={tipo:b?b:1,soloServizi:d.cbaConfig.soloServizi&&!0===d.cbaConfig.soloServizi?"T":"F",tipoServizi:48==CBA.moduli.moduloAttivo?"L":d.objParametriStampa&&
d.objParametriStampa.tipoServ?d.objParametriStampa.tipoServ:null,soloStrutture:d.cbaConfig.soloStrutture?"T":"F",regione:d.cbaConfig.regione,conImportiClass:d.cbaConfig.classifExtImporto?"T":"F",tipoStampa:d.cbaConfig.id,dataRif:63==d.cbaConfig.id?new Date(d.getTabPeriodo().down("#Anno").getValue(),0,1):null,conClassNull:36==d.cbaConfig.id||66==d.cbaConfig.id||6066==d.cbaConfig.id||5040==d.cbaConfig.id||5041==d.cbaConfig.id?"T":"F"};f.on("beforeload",function(b){b.clearFilter()},f,{single:!0});d.getFiltraSoloAttivi();
f.getStore().load({params:g,callback:function(b,g,l){if(l){c&&d.loadTreesCertificazioni();f.expandAll();if(61==d.cbaConfig.id||6061==d.cbaConfig.id)Ext.each(b,function(b){if(-9999==b.get("idRisposta")||-9999==b.get("idServizio"))d.getImportoPresDefault().setValue(b.get("importo1")),d.getImportoAssDefault().setValue(b.get("importo2"))}),f.getRootNode().cascade(function(){this.childNodes[0].get("idRisposta")&&(d.cbaConfig.idImportiDefault=this.childNodes[0].get("idImporto"),this.childNodes[0].remove());
return!1}),d.certifLomb&&(b=d.getCntTreeServizi().down("#GridImportiClass"),b.setDisabled(!0),svuotaStore(b.getStore()),b.setTitle(""));127==d.cbaConfig.id&&f.getStore().filter({filterFn:function(b){return 7==b.get("tipoFlusso")}});d.cbaConfig.soloStrutture&&d.cbaConfig.consideraUtenti&&d.filtraMotiviDimissione(-1,!0);d.cbaConfig.filtroMovimenti&&d.showUtentiInDimissione();d.cbaConfig.soloServizi&&d.getTreeServiziClass().getColumns()[0].setText(traduci("SERVIZI"));72==d.cbaConfig.id&&d.abilitaMotiviGGDim()}else msgShowError("",
g.getError())}});this.svuotaStoreUtenti()},loadScontiSupp:function(){var b=this,c=!b.getChkSconto().value&&!b.getChkSupplemento().value;b.getTreeSconto().setHidden(!(c||b.getChkSconto().value));b.getTreeSupp().setHidden(!(c||b.getChkSupplemento().value));b.getTreeSconto().isVisible()&&0==b.getTreeSconto().getStore().getCount()&&b.getTreeSconto().getStore().load({params:{tipo:14,soloServizi:"F",conImportiClass:b.cbaConfig.classifExtImporto?"T":"F",checked:1},callback:function(c,f,g){g?(Ext.suspendLayouts(),
b.getTreeSconto().setHidden(!1),b.getTreeSconto().expandAll(),Ext.resumeLayouts()):msgShowError("",f.getError())}});b.getTreeSupp().isVisible()&&0==b.getTreeSupp().getStore().getCount()&&b.getTreeSupp().getStore().load({params:{tipo:15,soloServizi:"F",conImportiClass:b.cbaConfig.classifExtImporto?"T":"F",tipoStampa:b.cbaConfig.id,checked:1},callback:function(c,f,g){g?(Ext.suspendLayouts(),b.getTreeSupp().setHidden(!1),b.getTreeSupp().expandAll(),Ext.resumeLayouts()):msgShowError("",f.getError())}})},
leggiTreeServClassImporti:function(){var b=[];this.getTreeClassifImporti().getStore().getRootNode().cascadeBy(function(c){c.data.checked&&c.isLeaf()&&b.push({codice:c.get("idRisposta"),importo1:c.get("importo1"),importo2:c.get("importo2")})});return b},selectAllRows:function(b){b.rendered&&(b.getSelectionModel().selectAll(),b.getView().focusRow(0))},svuotaStoreUtenti:function(){this.cbaConfig.pageUtenti&&svuotaStore(this.getGridUtenti().getStore());this.svuotaStoreCertificazioni()},svuotaStorePaganti:function(){this.cbaConfig.pagePaganti&&
svuotaStore(this.getGridPaganti().getStore())},svuotaStoreCertificazioni:function(){if(this.cbaConfig.certificazioni){var b=this.getTabPrincipale().down("#GridCertif");b&&svuotaStore(b.getStore())}},doPrint:function(b,c,d){var f=this,g=f.getTabPrincipale().getLayout();if("BtnEsportaCertif"==b.getItemId()||"BtnEsportaCertif_Excel"==b.getItemId())showWinStampa(43,CBA.parametriGenerali.codEnte,f.certifLomb?"CU_EsportaCertifLomb":"CU_EsportaCertif",{configBtnStampa:{reportDaEsportare:!0,hideCsv:!0,hideXml:!0,
hidePdf:!0,hideText:!0,params:{format:c,anno:f.getAnno().getValue()}},dataDal:f.getDataDal().getValue(),dataAl:f.getDataAl().getValue(),eseguiStampa:!0,jsonData:f.getCertificazioni()});else if(f.updateParametriStampa())if(f.cbaConfig.certificazioni&&!f.stampaInCorso&&g.getActiveItem()!=f.getPageAnteprima()){var h=f.getBtnAvanti();b=new Ext.util.TaskRunner;f.taskElaborazione=b.newTask({run:function(){g.getNext()&&!h.isDisabled()&&(f.getTabPrincipale().getActiveTab()==f.getTabPrincipale().down("#PageCertificazioni")&&
(f.stampaInCorso=!0,f.taskElaborazione.stop(),f.taskElaborazione.destroy(),delete f.taskElaborazione),h.handler())},interval:100});f.taskElaborazione.start()}else f.stampaInCorso=!1,f.callParent([b,c,d]);else f.stampaInCorso=!1,delete f.taskElaborazione},getServizi:function(){var b=[];this.getTreeServiziClass().getStore().getRootNode().cascadeBy(function(c){!c.data.checked||c.isRoot()||Ext.isEmpty(c.get("idServizio"))||b.push(c.get("idServizio"))});return Ext.Array.unique(b)},getServiziText:function(){var b=
"";this.getTreeServiziClass().getStore().getRootNode().cascadeBy(function(c){c.data.checked&&!c.isLeaf()&&"Root"!=c.get("text")&&(b+="<li>"+c.get("text")+"</li>")});return b},getClassificazioni:function(){var b=[];this.getTreeServiziClass().getStore().getRootNode().cascadeBy(function(c){c.data.checked&&c.isLeaf()&&b.push(c.get("idRisposta"))});return Ext.Array.unique(b)},getUtenti:function(){var b=[],c=this.getGridUtenti();Ext.each(c.getSelectionModel().getSelection(),function(c){b.push(c.get("codOspite"))});
return b},getPaganti:function(){var b=[],c=this.getGridPaganti();Ext.each(c.getSelectionModel().getSelection(),function(c){b.push(c.get("codOspite"))});return b},getSedi:function(){var b=[];this.getFiltraPerSede().getValue()&&this.getTreeSedeReparto().getStore().getRootNode().cascadeBy(function(c){c.data.checked&&c.isLeaf()&&b.push(c.get("idSede"))});return b},getReparti:function(){var b=[];this.getFiltraPerSede().getValue()&&this.getTreeSedeReparto().getStore().getRootNode().cascadeBy(function(c){c.data.checked&&
c.isLeaf()&&b.push(c.get("idReparto"))});return b},getMotiviDimissione:function(){var b=[];this.getNonAttivi().getValue()&&Ext.each(this.getMotiviDim().getSelectionModel().getSelection(),function(c){b.push(c.get("risposta"))});return b},getServiziImporti:function(b){var c="",d=this.getCntParam(),f=0,g=d.down("#Certif_QuotaAlbSan").getValue().certif_QuotaAlbSan,h=d.down("#Certif_QuotaAlb").getValue(),k=d.down("#Certif_QuotaSan").getValue();b.getStore().getRootNode().cascadeBy(function(b){b.data.checked&&
b.isLeaf()&&(f="S"==g?k:b.get("importo1")?b.get("importo1"):h,c=c+b.get("idRisposta")+"="+f+",")});return c.slice(0,-1)},getSupplementiMotUscTempImporti:function(b){var c="";b.getStore().getRootNode().cascadeBy(function(b){b.data.checked&&b.isLeaf()&&(c=c+b.get("idRisposta")+"="+b.get("importo1")+",")});return c.slice(0,-1)},getCertificazioni:function(b){b=this.getTabPrincipale().down("#GridCertif");var c=[],d=[];this.certifLomb?d=b.getSelectionModel().getSelection():Ext.each(b.getStore().data.items,
function(b){b.getData().selected&&d.push(b)});Ext.each(d,function(b){b=b.getData();delete b.idAuto;delete b.selected;b.dataNascitaUtente=new Date(b.dataNascitaUtente);if(null!=b.fatture)for(var d=b.fatture.length,f=0;f<d;++f)b.fatture[f].dataDoc&&(b.fatture[f].dataDoc=new Date(b.fatture[f].dataDoc)),b.fatture[f].dataIncasso&&(b.fatture[f].dataIncasso=new Date(b.fatture[f].dataIncasso));c.push(b)});c.sort(function(b,c){return b.nomeUtente==c.nomeUtente?b.dataDal<c.dataDal?-1:1:b.nomeUtente<c.nomeUtente?
-1:1});return c},creaRecordImporto:function(b){var c=null,d=this.getTabPeriodo().down("#Anno").getValue();b.get("date")?c=(new Date(b.get("date"))).getFullYear():b.set("date",new Date(d,0,1));return{id:c==d?b.get("id"):null,tipoStampa:this.cbaConfig.id,idExt:b.get("idRisposta"),data:new Date(d,0,1),importo1:b.get("importo1")?b.get("importo1"):b.get("percentuale")}},updatePercentualiCertificazioni:function(){var b=this;if(b.cbaConfig.certificazioni&&!b.certifLomb&&b.cbaConfig.updatePercCertificazioni){var c=
[];this.getTreeServiziClass().getStore().getRootNode().cascadeBy(function(d){if(d&&d.isLeaf()&&d.data.modified){var f=b.creaRecordImporto(d);c.push(f);d.data.modified=!1}});this.getTreeSupplementi().getStore().getRootNode().cascadeBy(function(d){if(d&&d.isLeaf()&&d.data.modified){var f=b.creaRecordImporto(d);c.push(f);d.data.modified=!1}});this.getTreeSconti().getStore().getRootNode().cascadeBy(function(d){if(d&&d.isLeaf()&&d.data.modified){var f=b.creaRecordImporto(d);c.push(f);d.data.modified=!1}});
this.getTreeMotiviUscitaTemp().getStore().getRootNode().cascadeBy(function(d){if(d&&d.isLeaf()&&d.data.modified){var f=b.creaRecordImporto(d);c.push(f);d.data.modified=!1}});Ext.Ajax.request({method:"POST",url:"/cba/osp/co/ws/prszn/alberoImporti/update",jsonData:Ext.JSON.encode(c),writer:{type:"json"},async:!0,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?msgShow("MSG_SALVATAGGIO_DATI",b.message):msgShowError("",b.message)}})}b.cbaConfig.updatePercCertificazioni=!1},erroriStampa:function(b){return this.getErroriStampa(b,
!1)},onLaunch:function(){var b=this;b.cbaConfig.parametri&&(b.objParametriStampa=getObjectFromString(b.cbaConfig.parametri,",","="));CBA.parametriGenerali.filtriAttivi&&!Ext.isEmpty(CBA.parametriGenerali.filtriAttivi.filtroReparti)&&(b.getFiltraPerSede().setValue(!0),b.filtraPerSede(b.getFiltraPerSede(),!0),b.getFiltraPerSede().setDisabled(!0));b.cbaConfig&&b.cbaConfig.regione&&"M"==b.cbaConfig.regione&&b.getBtnStampa().setText(traduci("ESPORTA"));ImpostaUrl([b.getGridUtenti().getStore(),b.getMotiviDim().getStore(),
b.getMotiviUscita().getStore(),b.getGridMotiviUscitaTemp().getStore(),b.getRiepRaggruppamento().getStore(),b.getTreeServiziClass().getStore(),b.getTipoDocumenti().getStore(),b.getGridGradoParentela().getStore()]);b.personContabili=getPersonContabili(getIdOrg(),new Date,!0,null);b.tabelleAmm2=4==b.personContabili.tipoContabilitaAbilitata||5==b.personContabili.tipoContabilitaAbilitata;b.getCbEnteIva().setVisible(1==b.personContabili.tipoContabilitaAbilitata);b.getRegistro().setVisible(2==b.personContabili.tipoContabilitaAbilitata||
b.tabelleAmm2);if(43===CBA.moduli.moduloAttivo||50===CBA.moduli.moduloAttivo)b.getCbTipoStampa().bindStore(Ext.create("CU.stampe.store.TipoReport")),b.getCbOrdine().bindStore(Ext.create("CU.stampe.store.OrdineReport")),b.getTipoPagante().bindStore(Ext.create("GeneraliOSP.store.TipiPaganti")),b.getGridFasceEta().bindStore(Ext.create("CU.stampe.store.FasceEta")),b.getGridSchedeFas().bindStore(Ext.create("CU.store.DossierSections")),1==b.personContabili.tipoContabilitaAbilitata?(b.storeEnteIva=Ext.create("GestioneFatture.store.FattEnteIva",
{autoDestroy:!1}),b.getCbEnteIva().bindStore(b.storeEnteIva),b.getCbEnteIva().getStore().load()):b.cbaConfig.numeroDalAl&&b.reloadRegistro();var c=b.getTabPrincipale();if(35==b.cbaConfig.id||73==b.cbaConfig.id||6035==b.cbaConfig.id||6073==b.cbaConfig.id)c.items.get("pageScontiSupp").tab.show(),ImpostaUrl([b.getTreeSconto().getStore(),b.getTreeSupp().getStore()]);b.cbaConfig.visualizzaSoloPagantiAttivi=!1;58==b.cbaConfig.id&&(b.cbaConfig.visualizzaSoloPagantiAttivi=!0,b.getContainerFiltriPag().setVisible(!0));
b.getBtnArchiviaDocumentale().setVisible(b.cbaConfig.idStampaDocumentale&&0<b.cbaConfig.idStampaDocumentale);b.getFsScadDoc().setVisible(60==b.cbaConfig.id||6060==b.cbaConfig.id);if(72==b.cbaConfig.id||61==b.cbaConfig.id)b.getTabPeriodo().setVisible(!0),b.getConsideraUtenti().setVisible(!0),b.getTipoClass().setVisible(!0),b.cbaConfig.tipoClass=!0,b.getCBAssenzeRighe().setVisible(!0),b.getTipoMedico().setVisible(!0),b.getMotiviDim().getStore().load({params:{scheda:"A",domanda:1},callback:function(c,
d,f){f?(b.selectAllRows(b.getMotiviDim()),72==b.cbaConfig.id&&b.getMotiviGGDim().getStore().loadData(c)):(c=[],msgAddError(c,d.getError()),msgShow("",c))}});19==b.cbaConfig.id&&(b.getCButentiNonAssenti().setVisible(!0),b.getCBCalcoloConFranchigia().setVisible(!0));if(60==b.cbaConfig.id||6060==b.cbaConfig.id)b.getTabPeriodo().setVisible(!0),b.getConsideraUtenti().setVisible(!0),0==b.getTipoDocumenti().getStore().data.length&&b.getTipoDocumenti().getStore().load({params:{scheda:"V",domanda:100},callback:function(c,
d,f){f?b.getTipoDocumenti().getSelectionModel().selectAll():msgShowError("",d.getError())}});b.cbaConfig.includiSaldiZero&&b.getChkSaldiZero().setValue(!0);b.cbaConfig.updatePercCertificazioni=!1;c.cbaConfig.naviga=function(c){b.updatePercentualiCertificazioni();b.naviga(c)};c.erroriStampa=function(c){return b.erroriStampa(c,!1)};b.getFsTipoPensioni().setVisible("CU_RiepilogoIncassoPensione"==b.cbaConfig.progetto);if(b.cbaConfig.pageParametri){c.items.get("PageParametri").tab.show();b.getTabPeriodo().setVisible(!b.cbaConfig.nascondiPeriodo);
20==b.cbaConfig.id&&b.getTabPeriodo().setActiveItem(1);b.getChkConsideraAssenze().setVisible(b.cbaConfig.consideraAssenze);b.getChkVisualizzaSoloPagantiAttivi().setVisible(b.cbaConfig.visualizzaSoloPagantiAttivi);b.getCBStampaDettaglio().setVisible(b.cbaConfig.stampaDettaglio);b.getFsScontiSupplementi().setVisible(b.cbaConfig.scontiSupp);b.getFsFiltroMovimenti().setVisible(b.cbaConfig.filtroMovimenti);b.getDataGiornoAl().setVisible(b.cbaConfig.dataGiornoAl);b.getFsDataAl().setVisible(b.cbaConfig.dataGiornoAl);
b.getBoxSoglia().setVisible(b.cbaConfig.soglia);b.getMotivoAssenza().setVisible(b.cbaConfig.grpMotiviAssenza);b.getTipoClass().setVisible(b.cbaConfig.tipoClass);b.getCambiaPag().setVisible(b.cbaConfig.cambiaPagina);b.getCbTipoStampa().setVisible(b.cbaConfig.tipoReport);if(b.cbaConfig.certificazioni){b.cbaConfig.abilitaAvantiIndietroAuto=!1;b.certifLomb="CU_StampaCertificazioniLomb"==this.cbaConfig.progetto;var d=b.certifLomb?"CU.stampe.view.CertificazioniLombardia":"CU.stampe.view.Certificazioni";
c.disabilitaClickPageAnteprima=!0;b.certifLomb&&(b.getCntProgressBar().setHtml('<font color="#9260DA"><H2>'+traduci("CERTIF_LOMB_OBSOLETA")+"</H2></font>"),b.getCntProgressBar().setVisible(!0));c.insert(4,Ext.create(d,{itemId:"PageCertificazioni",title:traduci("CERTIFICAZIONI"),controllerStampa:b}));Ext.apply(b.parametriStampa,{hideExcel:!1,hidePdf:b.certifLomb?!0:!1,hideMenu:b.certifLomb?!0:!1});b.certifLomb?b.configurePrintButton(c.down("#BtnEsportaCertif_Excel"),"print"):b.configurePrintButton(c.down("#BtnEsportaCertif"),
"print");d=b.getTabPeriodo();b.certifLomb?(d.down("#Anno").setValue((new Date).getFullYear()-1),d.down("#Mese").setValue(1),d.down("#MeseAl").setValue(12),d.setActiveTab(1)):(d.onlyYear=!0,d.showOnlyYear(),d.down("#Anno").setValue((new Date).getFullYear()-1));d=Ext.create("CU.stampe.view.CertificazioniParametri");d.down("#Certif_EscludiTS730").setVisible(4==b.personContabili.tipoContabilitaAbilitata);b.getCntParam().add(d);var f=b.getTreeServiziClass().getColumns();b.certifLomb?(b.getTipoClass().show(),
b.getCntTreeServizi().add({xtype:"container",margin:"0 0 0 10",items:[Ext.create("CU.stampe.view.GridImportiClass",{controllerStampa:b,width:370,height:200})]}),b.getPercDeducibile().setVisible(!0),b.getImportoIncassatoCertLomb().setVisible(!0)):(f[1].show(),f[2].show(),d.down("#Certif_ConsideraQuote").show(),d.down("#Certif_Parametri").show(),b.loadTreesCertificazioni());d=b.getTipoPagante().getStore();for(f=d.data.length;f--;)"E"!==d.data.items[f].data.codice&&"C"!==d.data.items[f].data.codice||
d.removeAt(f)}b.getCbTipoStampa().hidden||b.getCbTipoStampa().getStore().load({params:{reportId:b.cbaConfig.id},callback:function(c,d){d&&c&&b.getCbTipoStampa().setValue(c[0].data.codice)}});(b.getCbTipoStampa().hidden||124==b.cbaConfig.id)&&b.loadTreeServClass();b.getCbOrdine().setVisible(b.cbaConfig.ordineStampa);b.getCbOrdine().hidden||b.getCbOrdine().getStore().load({params:{reportId:b.cbaConfig.id},callback:function(c,d){d&&c&&b.getCbOrdine().setValue(c[0].data.codice)}});var g=b.getCbDocPers();
g.setVisible(b.cbaConfig.docPers||b.cbaConfig.certificazioni);b.getFieldBoxDaPubblicare().setVisible(b.cbaConfig.docPers||b.cbaConfig.certificazioni);if(b.cbaConfig.docPers||b.cbaConfig.certificazioni)d=g.getStore(),f={idOrg:getIdOrg(),idModulo:b.cbaConfig.idModuloPrg},f.tipo=b.cbaConfig.certificazioni?50==CBA.moduli.moduloAttivo?7:1:0,d.load({params:f,callback:function(b,c,d){d?Ext.isEmpty(b)||g.setValue(b[0].get("codice")):msgShowError("",c.getError())}}),b.getBoxDaPubblicare().setValue(3);b.getTipoClassRadioGroup().on("change",
function(c,d){b.loadTreeServClass(d.classificazione);b.certifLomb&&(b.getCntTreeServizi().down("#GridImportiClass").columns[3].setVisible(5!=d.classificazione),b.getCntTreeServizi().down("#ElaboraPercUnica").setVisible(1==d.classificazione));if(61==b.cbaConfig.id||6061==b.cbaConfig.id)b.getChkImportiPersonalizzazioni().setHidden(1!=d.classificazione),b.getChkImportiPersonalizzazioni().setValue(!1)});b.getTipoComuneGroup().on("change",function(c,d){b.loadTreeServClass(d.tipoComune)});if(b.cbaConfig.motiviAssenza){var h=
b.getGridMotiviUscitaTemp();h.show();h.getStore().load({params:{scheda:"H",domanda:2},callback:function(c,d,f){f?b.selectAllRows(h):(c=[],msgAddError(c,d.getError()),msgShow("",c))}})}if(b.cbaConfig.consideraUtenti){b.getConsideraUtenti().show();10==b.cbaConfig.id||11==b.cbaConfig.id||12==b.cbaConfig.id?(b.getUtentiDaInizioAnno().setVisible(!0),b.getAttivi().setValue("T"),b.getAttivi().setDisabled(!0),b.getNonAttivi().setValue("T"),b.getNonAttivi().setDisabled(!0)):124==b.cbaConfig.id&&(b.getAttivi().setValue("F"),
b.getNonAttivi().setValue("T"),b.getMotiviDim().setVisible(!0));var k=b.getMotiviDim(),d=k.getStore();d.load({params:{scheda:"A",domanda:1},callback:function(c,d,f){f?b.selectAllRows(k):(c=[],msgAddError(c,d.getError()),msgShow("",c))}})}if(b.cbaConfig.filtroMovimenti){var l=b.getMotiviUscita(),d=l.getStore();l.setVisible(!0);d.load({params:{scheda:"A",domanda:1},callback:function(c,d,f){f?b.selectAllRows(l):(c=[],msgAddError(c,d.getError()),msgShow("",c))}})}b.getTipoDocFattura().setVisible(b.cbaConfig.tipoDocFattura);
b.getFattDefArc().setVisible(b.cbaConfig.fattDefArc);b.getTipoDocRettaFatt().setVisible(b.cbaConfig.tipoDocRettaFatt);b.getFormatoCarta().setVisible(b.cbaConfig.formatoCarta);b.getBoxNumerazione().setVisible(b.cbaConfig.numeroDalAl);b.getRiepRaggruppamento().setVisible(b.cbaConfig.riepRaggruppamento);if(b.cbaConfig.riepRaggruppamento&&27!=b.cbaConfig.id&&6027!=b.cbaConfig.id){var n=b.getRiepRaggruppamento();n.getStore().load({params:{reportId:b.cbaConfig.id},callback:function(b,c,d){d?n.setValue(1):
msgShowError("",c.getError())}})}b.getCboxConteggiaServizi().setVisible(b.cbaConfig.conteggiaServizi);var p=b.getTipoPagante();p.setVisible(b.cbaConfig.tipoPagante);p.on("afterrender",function(){p.getSelectionModel().selectAll()});var q=b.getGridFasceEta();q.setVisible(b.cbaConfig.fasceEta);b.cbaConfig.fasceEta&&q.getStore().load({callback:function(c,d,f){f?b.selectAllRows(q):(c=[],msgAddError(c,d.getError()),msgShow("",c))}});d=1==b.cbaConfig.abilitaEstrattoConto||2==b.cbaConfig.abilitaEstrattoConto;
f=b.getCbEstrattoConto();f.setVisible(d);2==b.cbaConfig.abilitaEstrattoConto&&f.getStore().removeAt(2);b.getChkSaldiZero().setVisible(d);b.getChkSaldiNegativi().setVisible(d);b.getChkNonMovimentati().setVisible(d&&1==b.cbaConfig.abilitaEstrattoConto);b.getBoxFiltroPaganti().setVisible(b.cbaConfig.filtroPagante);b.getCboxPagante().getStore().getProxy().setExtraParam("tipoContabilita",b.personContabili.tipoContabilitaAbilitata);b.getCboxPagante().getStore().getProxy().setExtraParam("limit",0);43==CBA.moduli.moduloAttivo&&
(CBA.moduli.modulo43.serverDate.getMonth(),CBA.moduli.modulo43.serverDate.getFullYear());50==CBA.moduli.moduloAttivo&&(CBA.moduli.modulo50.serverDate.getMonth(),CBA.moduli.modulo50.serverDate.getFullYear())}else c.remove(b.getPageParametri());b.cbaConfig.pageUtenti?c.items.get("PageUtenti").tab.show():c.remove(b.getPageUtenti());var r;b.cbaConfig.pageSedeReparto?(c.items.get("PageSedeReparto").tab.show(),r=b.getTreeSedeReparto(),r.getStore().load({callback:function(b,c,d){d?r.expandAll():msgShowError("",
c.getError())}})):c.remove(b.getPageSedeReparto());b.cbaConfig.pageSchedeFascicolo?c.items.get("PageSchedeFascicolo").tab.show():c.remove(b.getPageSchedeFascicolo());b.cbaConfig.pagePaganti?(b.cbaConfig.tipoDocFattura&&(d=this.getPageUtenti(),f=this.getPagePaganti(),c.remove(d,!1),c.remove(f,!1),c.insert(2,f),c.insert(3,d),c.items.get("PageUtenti").tab.show()),c.items.get("PagePaganti").tab.show()):14!=b.cbaConfig.id&&6014!=b.cbaConfig.id&&c.remove(b.getPagePaganti());b.cbaConfig.pageEtichette?c.items.get("PageEtichette").tab.show():
c.remove(b.getPageEtichette());b.cbaConfig.franchigiaAss&&b.getFranchigiaAssenza().setHidden(!1);if(61==b.cbaConfig.id||6061==b.cbaConfig.id)b.getServiziClassExtImporto().setHidden(!1),b.getCntServSupp().setHidden(!0),b.getChkImportiPersonalizzazioni().setHidden(!1);73==b.cbaConfig.id&&(b.getChkRitenuta().setHidden(!0),b.getBtnScontiSupplementiInfo().setHidden(!1));b.naviga();d=b.getTabPrincipale().items.getCount();b.getBtnAvanti().setVisible(2<d);b.getBtnIndietro().setVisible(2<d);d=1==d;72!=b.cbaConfig.id&&
14!=b.cbaConfig.id&&6014!=b.cbaConfig.id||b.loadTreeServClass(b.getTipoClass().hidden?b.getTipoComune().hidden?1:b.getTipoComune().getValue():b.getTipoClass().getValue());72==b.cbaConfig.id&&(b.getChkDividiPerAsl().setHidden(!1),b.getConsideraGGDim().setVisible(!0));if(d||b.cbaConfig.eseguiStampa)c=c.down("#BtnStampa"),b.doPrint(c);if(7038==b.cbaConfig.id||7042==b.cbaConfig.id)b.getTrimestre().on("afterrender",function(){var c=Math.floor(((new Date).getMonth()+3)/3);b.getTrimestre().setValue(c)});
88==b.cbaConfig.id&&(b.getConsideraUtenti().setVisible(!1),b.getTipoClass().setVisible(!0),b.getCbTipoStampa().setVisible(!0),b.getCbTipoStampa().getStore().load({params:{reportId:b.cbaConfig.id},callback:function(c,d){d&&c&&b.getCbTipoStampa().setValue(c[0].data.codice)}}),b.getCBStampaDettaglio().setVisible(!0));118==b.cbaConfig.id&&(b.getTipoClass().setVisible(!1),b.getCbTipoStampa().setVisible(!1),b.getRiepRaggruppamento().setVisible(!1),b.getCboxConteggiaServizi().setVisible(!1));(b.cbaConfig.docPers||
b.cbaConfig.certificazioni)&&Ext.Ajax.request({method:"GET",url:getUrlGen()+"/auth/extraFn/isEnabled",params:{codiceFunzione:"CU_PORTALE"},success:function(c){c=Ext.JSON.decode(c.responseText);b.getBtnPubblicaPortale().setVisible(!1);b.getBtnPubblicaPortale().setDisabled(!0);c.success?(c=c.data,b.getBtnPubblicaPortale().setVisible(c)):msgShowError("",c.message)}})},destroy:function(){eliminaStore(this.storeEnteIva);this.callParent()}});
Ext.define("GeneraliOSP.stampe.controller.CUStampaPersRif",{extend:"Generali.standard.stampe.Controller",init:function(){var b="#"+this.containerId+" ";this.cbaConfig.configBtnStampa&&(Ext.applyIf(this.parametriStampa,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(this.parametriStampa.params,this.cbaConfig.configBtnStampa.params));this.callParent(arguments);this.addRef([{ref:"TabPrincipale",selector:b+"#TabPrincipale"},{ref:"PageParametri",selector:b+"#PageParametri"},
{ref:"PageSedeReparto",selector:b+"#PageSedeReparto"},{ref:"PageUtenti",selector:b+"#PageUtenti"},{ref:"PageAnteprima",selector:b+"#PageAnteprima"},{ref:"BtnIndietro",selector:b+"#BtnIndietro"},{ref:"BtnAvanti",selector:b+"#BtnAvanti"},{ref:"TreeSedeReparto",selector:b+"#TreeSedeReparto"},{ref:"GridUtenti",selector:b+"#GridUtenti"},{ref:"ConsideraUtenti",selector:b+"#ConsideraUtenti"},{ref:"Attivi",selector:b+"#Attivi"},{ref:"NonAttivi",selector:b+"#NonAttivi"},{ref:"DataDal",selector:b+"#DataDal"},
{ref:"DataAl",selector:b+"#DataAl"},{ref:"Mese",selector:b+"#Mese"},{ref:"Anno",selector:b+"#Anno"},{ref:"TreeServiziClass",selector:b+"#TreeServiziClass"},{ref:"MotiviDim",selector:b+"#MotiviDim"},{ref:"FiltraSoloAttivi",selector:b+"#FiltraSoloAttivi"},{ref:"FiltraPerSede",selector:b+"#FiltraPerSede"},{ref:"GridGradoParentela",selector:b+"#GridGradoParentela"},{ref:"CbTipoStampa",selector:b+"#CbTipoStampa"},{ref:"CBGarante",selector:b+"#CBGarante"},{ref:"GridRating",selector:b+"#GridRating"},{ref:"btnSalvaImpostazioni",
selector:b+"#btnSalvaImpostazioni"},{ref:"TipoClass",selector:b+"#TipoClass"},{ref:"CntParam",selector:b+"#CntParam"}]);this.control(b+"#MotiviDim",{checkchange:this.checkchangeMotiviDim});this.control(b+"#DataDal",{change:this.svuotaStoreUtenti});this.control(b+"#DataAl",{change:this.svuotaStoreUtenti});this.control(b+"#FiltraSoloAttivi",{change:this.filtraSoloAttivi});this.control(b+"#FiltraPerSede",{change:this.filtraPerSede});this.control(b+"treepanel",{checkchange:this.treeCheckchange,beforeitemcontextmenu:this.beforeitemcontextmenu});
this.control(b+"#Attivi",{change:this.svuotaStoreUtenti});this.control(b+"#NonAttivi",{change:this.changeNonAttivi});this.control(b+"#TabPrincipale",{afterrender:this.afterRenderTabPrincipale});this.control(b+"#TreeSedeReparto",{load:this.loadTreeSedeReparto})},loadTreeSedeReparto:function(b,c,d,f,g,h){Ext.each(c,function(b){b.parentNode.isRoot()&&b.isLeaf()&&(delete b.data.checked,b.set("cls","cba-disabled-element"))})},getTipoClassRadioGroup:function(){return this.getTipoClass().down("radiogroup")},
afterRenderTabPrincipale:function(){43!=CBA.moduli.moduloAttivo&&50!=CBA.moduli.moduloAttivo&&(this.getPageSedeReparto().tab.hide(),this.getConsideraUtenti().hide())},dcForm:function(b,c,d){this.getBtnSalvaImpostazioni().setDisabled(!c)},checkImpostazione:function(b,c){b.isValid()||msgAddError(c,b.fieldLabel+" "+b.getActiveError())},esci:function(){this.getTabPrincipale().up("window").close()},controllaMotiviDimissione:function(){return this.getTabPrincipale().getActiveTab()==this.getPageParametri()&&
this.getNonAttivi().getValue()&&0==this.getMotiviDim().getSelectionModel().getCount()?(msgShowWarning("","MSG_MOTIVI_DIM_OBB"),!1):!0},verificaParametri:function(){return this.controllaMotiviDimissione()?this.getCbTipoStampa().isValid()?!0:(msgShowError("",traduci("SELEZIONARE")+" "+traduci("TIPO_STAMPA")),!1):!1},stampa:function(b){b={};var c=this.getAttivi(),d=this.getNonAttivi(),f=this.getTreeServiziClass(),g=this.getTreeSedeReparto(),h=this.getMotiviDim(),k=h?h.getSelectionModel().getSelection():
"",l=[],n=[],p=[],h=this.getFiltraPerSede(),q=this.getDataDal(),r=this.cbaConfig.dataGiornoAl?this.getDataGiornoAl():this.getDataAl(),t=[];d&&d.getValue()&&Ext.each(k,function(b){l.push(b.get("risposta"))});l=l.toString();Ext.each(this.getGridGradoParentela().getSelectionModel().getSelection(),function(b){n.push(b.get("risposta"))});n=n.toString();Ext.each(this.getGridRating().getSelectionModel().getSelection(),function(b){t.push(b.get("valore"))});t=t.toString();!c||c.getValue()||d.getValue()||c.setValue("T");
k=this.getGridUtenti();k.getStore().getTotalCount()!=k.getSelectionModel().getCount()&&Ext.each(k.getSelectionModel().getSelection(),function(b){p.push(b.get("codOspite"))});p=p.toString();Ext.apply(b,{reportId:this.cbaConfig.id,dataDal:q.getValue(),dataAl:r.getValue(),presenti:getBoolValue(c.getValue()),dimessi:getBoolValue(d.getValue()),motiviDimissione:"("+l+")",servizi:"("+getListCheckedTree(f,!0,"idServizio")+")",tipoClassificazione:this.getTipoClass().getValue(),classificazioni:"("+getListCheckedTree(f,
!0,"idRisposta",null,null,this.getFiltraSoloAttivi().value?!1:!0)+")",filtraPerSede:getBoolValue(h.getValue()),reparti:h.getValue()?"("+getListCheckedTree(g,!0,"idReparto")+")":"",elencoUtenti:"("+p+")",tipoStampa:this.getCbTipoStampa().getValue(),filtroGradoParentela:"T",elencoGradiParentela:n,soloGarante:getBoolValue(this.getCBGarante().getValue()),rating:t});c=this.parametriStampa={url:getUrlGen()+"/ws/genOsp/users/personeRif",titolo:"Stampa persone di riferimento",renderTo:this.getPageAnteprima(),
params:{idAvanzamentoElaborazione:0,reportId:this.cbaConfig.id}};Ext.apply(c.params,b);this.cbaConfig.configBtnStampa&&(Ext.applyIf(c,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(c.params,this.cbaConfig.configBtnStampa.params))},naviga:function(b){var c=this.getTabPrincipale();b?this.getGridUtenti()&&this.getGridUtenti().rendered&&0==this.getGridUtenti().getStore().getCount()&&this.loadUtenti():c.getActiveTab()==this.getPageUtenti()&&0==this.getGridUtenti().getStore().getCount()&&
this.loadUtenti()},changeNonAttivi:function(b,c,d,f){this.getMotiviDim().setDisabled(!c);this.svuotaStoreUtenti()},checkchangeMotiviDim:function(){this.svuotaStoreUtenti()},filtraSoloAttivi:function(b,c,d,f){this.getTreeServiziClass().getStore().clearFilter();c&&this.getTreeServiziClass().getStore().filter({filterFn:function(b){return!["testoAnnullato non_attivi"].includes(b.data.cls)}})},filtraPerSede:function(b,c,d,f){this.getTreeSedeReparto().setDisabled(!c);this.svuotaStoreUtenti()},svuotaStoreUtenti:function(){svuotaStore(this.getGridUtenti().getStore())},
loadUtenti:function(){var b=this,c=b.getGridUtenti(),d=b.getAttivi(),f=b.getNonAttivi(),g=b.getTreeServiziClass(),h=b.getTreeSedeReparto(),k=b.getMotiviDim(),k=k?k.getSelectionModel().getSelection():"",l=[],n=b.getFiltraPerSede(),p=b.getDataDal(),q=b.getDataAl();f&&f.getValue()&&Ext.each(k,function(b){l.push(b.get("risposta"))});svuotaStore(c.getStore());inizioAttesa();c.getStore().load({params:{dataDal:p.getValue(),dataAl:q.getValue(),presenti:getBoolValue(d.getValue()),dimessi:getBoolValue(f.getValue()),
servizi:"("+getListCheckedTree(g,!0,"idServizio")+")",tipoClassificazione:b.getTipoClass().getValue(),classificazioni:"("+getListCheckedTree(g,!0,"idRisposta",null,null,b.getFiltraSoloAttivi().value?!1:!0)+")",sedi:n?n.getValue()?"("+getListCheckedTree(h,!1,"idSede")+")":"":"",reparti:n?n.getValue()?"("+getListCheckedTree(h,!0,"idReparto")+")":"":"",motiviDimissione:"("+l+")",filtraPerSede:getBoolValue(n?n.getValue():!1),listaAttesa:48==CBA.moduli.moduloAttivo?"T":"F"},callback:function(d,f,g){g?
Ext.isEmpty(d)||(Ext.suspendLayouts(),b.selectAllRows(c),Ext.resumeLayouts()):msgShowError("",f.getError());fineAttesa()}})},selectAllRows:function(b){b.getSelectionModel().selectAll();b.getView().focusRow(0)},loadTreeServClass:function(b){var c=this.getTreeServiziClass();c.on("beforeload",function(b){b.clearFilter()},c,{single:!0});var d=this.getFiltraSoloAttivi();c.getStore().load({params:{tipo:b?b:1,soloServizi:"F",conClassNull:"T"},callback:function(b,g,h){h?(d.fireEvent("change",d,d.getValue()),
c.expandAll()):msgShowError("",g.getError())}});this.svuotaStoreUtenti()},beforeitemcontextmenu:function(b,c,d,f,g,h){return getPopupMenuTree(g,b)},treeCheckchange:function(b,c,d){treeCheckchange(b,c,d);this.svuotaStoreUtenti();null==b?"TreeServiziClass"==d.tree.getItemId()&&this.filtraMotiviDimissione(0,c):"TreeServiziClass"==b.getOwnerTree().getItemId()&&this.filtraMotiviDimissione(b.get("idServizio"),c)},filtraMotiviDimissione:function(b,c){var d=this.getMotiviDim();d.suspendLayouts();var f=d.getStore(),
g=this.getTreeServiziClass(),h=getListCheckedTree(g,!0,"idServizio").split(",");f.clearFilter();if(0==b)c?d.getSelectionModel().selectAll():f.filter({filterFn:function(b){return!1}});else{var k=!1;if(c){var l;Ext.each(d.getSelectionModel().getSelection(),function(c){l=c.get("idServizio");if(b==l)return k=!0,!1})}f.clearFilter();f.filter({filterFn:function(c){var f=c.get("idServizio").toString(),g=!1;0<=Ext.Array.indexOf(h,f)&&(g=!0,c.get("idServizio")!=b||k||d.getSelectionModel().select(c,!0));return g}})}d.resumeLayouts(!0)},
doPrint:function(b,c){this.verificaParametri()&&(this.stampa(),this.callParent([b,c]))},onLaunch:function(){var b=this;b.getTabPrincipale().cbaConfig.naviga=function(c){b.naviga(c)};if(!b.cbaConfig.eseguiStampa){ImpostaUrl([b.getGridGradoParentela().getStore(),b.getTreeServiziClass().getStore(),b.getGridUtenti().getStore(),b.getMotiviDim().getStore()]);if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo){var c=b.getTreeSedeReparto();c.getStore().load({callback:function(b,d,f){f?c.expandAll():
msgShowError("",d.getError())}})}48==CBA.moduli.moduloAttivo&&(b.getTreeServiziClass().getStore().getProxy().extraParams={tipoServizi:"L"});b.getTipoClassRadioGroup().on("change",function(c,d){b.loadTreeServClass(d.classificazione)});if(43==CBA.moduli.moduloAttivo||50==CBA.moduli.moduloAttivo){var d=b.getMotiviDim();d.getStore().load({params:{scheda:"A",domanda:1},callback:function(c,f,k){k?b.selectAllRows(d):(c=[],msgAddError(c,f.getError()),msgShow("",c))}})}b.loadTreeServClass();var f=b.getGridGradoParentela();
f.getStore().load({callback:function(c,d,k){if(k){b.selectAllRows(f);var g=b.getGridRating();g.getStore().load({callback:function(c,d,f){f?(b.selectAllRows(g),b.getCntParam().scrollTo("top",0)):(c=[],msgAddError(c,d.getError()),msgShow("",c))}})}else c=[],msgAddError(c,d.getError()),msgShow("",c)}});b.getCbTipoStampa().setValue(1);b.naviga();b.getBtnAvanti().setVisible(!0);b.getBtnIndietro().setVisible(!0)}}});
Ext.define("GeneraliOSP.stampe.controller.UploadDocPerson",{extend:"Generali.standard.stampe.Controller",parametriStampa:{hideMenu:!0},init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:this.selContainer+"#Form"},{ref:"corpoMail",selector:this.selContainer+"#corpoMail"},{ref:"oggettoDocPers",selector:this.selContainer+"#oggettoDocPers"},{ref:"modificaMail",selector:this.selContainer+"#modificaMail"},{ref:"btnConferma",selector:this.selContainer+
"#btnConferma"},{ref:"btnAnnulla",selector:this.selContainer+"#btnAnnulla"},{ref:"nomeDocPers",selector:this.selContainer+"#nomeDocPers"},{ref:"descAggDocPers",selector:this.selContainer+"#descAggDocPers"},{ref:"dataGiornoDal",selector:this.selContainer+"#dataGiornoDal"}]);this.control(this.selContainer+"#modificaMail",{change:this.clickModificaMail});this.control(this.selContainer+"#btnConferma",{click:this.clickBtnConferma});this.control(this.selContainer+"#btnAnnulla",{click:this.clickBtnAnnulla})},
clickBtnConferma:function(){this.cbaConfig.callbackRitorno(this.getCorpoMail().getValue(),this.getOggettoDocPers().getValue(),this.getDescAggDocPers().getValue(),this.getDataGiornoDal().getValue());this.getForm().up("window").close()},clickBtnAnnulla:function(){this.getForm().up("window").close()},clickModificaMail:function(b,c,d){c?(this.getCorpoMail().setDisabled(!1),this.getOggettoDocPers().setDisabled(!1)):(this.getCorpoMail().setDisabled(!0),this.getOggettoDocPers().setDisabled(!0))},onLaunch:function(){this.getCorpoMail().setValue("Gentile _nomeAccount_,\ne' stato pubblicato un nuovo documento '_tipoDocumento_' sul Portale utenti. \n\nDistinti saluti _ragSocEnte_");
this.getOggettoDocPers().setValue("Pubblicazione nuovo documento");this.getNomeDocPers().setValue(this.cbaConfig.nomeModello);this.codiceFunzione=this.cbaConfig.codiceFunzione}});Ext.define("GeneraliOSP.stampe.store.GrpReport",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/reports/grpReport",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.stampe.store.Paganti",{extend:"Ext.data.Store",fields:[{name:"codFocl"},{name:"ragioneSociale",type:"string"},{name:"codiceFiscale",type:"string"}],proxy:{type:"ajax",url:"/cba/osp/co/ws/rette/paganti/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},sorters:{property:"ragioneSociale",direction:"ASC"},autoDestroy:!0});
Ext.define("GeneraliOSP.stampe.store.Rating",{extend:"Ext.data.Store",fields:[{name:"valore"}],data:[{valore:5},{valore:4},{valore:3},{valore:2},{valore:1},{valore:0}],autoDestroy:!0});Ext.define("GeneraliOSP.stampe.store.TipoReportPersRif",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"}],data:[{valore:"Per "+traduci("UTENTE"),codice:1},{valore:"Elenco",codice:2}],autoDestroy:!0});
Ext.define("GeneraliOSP.stampe.store.UtentiStampa",{extend:"Ext.data.Store",fields:[{name:"nominativo"},{name:"codiceFiscale"},{name:"dataNascita",type:"date"},{name:"codOspite"},{name:"errCode"},{name:"idRicovero"},{name:"elencoRicoveri"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/reports/listaOspiti",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},sorters:[{property:"nominativo",direction:"ASC"}],autoDestroy:!0});
Ext.define("GeneraliOSP.stampe.view.CUStampa",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var b=this;Ext.applyIf(b,{items:[{xtype:"stampaCBA",useNewButtonStampa:!0,border:0,itemId:"TabPrincipale",reference:"TabPrincipale",items:[{xtype:"panel",tabConfig:{title:"PARAMETRI_GENERALI",height:44},itemId:"PageParametri",reference:"PageParametri",hidden:!0,layout:{align:"stretch",type:"hbox"},bodyPadding:5,title:"",items:[{xtype:"container",itemId:"CntParam",reference:"CntParam",
padding:5,width:300,layout:{align:"stretch",type:"vbox"},autoScroll:!0,items:[{xtype:"fieldset",hidden:!0,itemId:"FsDataAl",reference:"FsDataAl",items:[{xtype:"datefield",itemId:"dataGiornoAl",reference:"dataGiornoAl",width:170,maxWidth:170,fieldLabel:"ALLA_DATA",labelClsExtra:"cbaLabel",labelWidth:60,name:"dataAl",allowBlank:!1,value:new Date,hidden:!0,margin:"5 0 5 0"}]},{xtype:"fieldset",hidden:!0,itemId:"boxSoglia",reference:"boxSoglia",layout:{type:"hbox"},margin:"10 5 0 0",items:[{xtype:"numberfield",
name:"ggSoglia1",itemId:"ggSoglia1",reference:"ggSoglia1",labelClsExtra:"cbaLabel",fieldLabel:"GGSOGLIA1",width:120,labelWidth:50,margin:"0 5 0 0",value:7},{xtype:"numberfield",name:"ggSoglia2",itemId:"ggSoglia2",reference:"ggSoglia2",labelClsExtra:"cbaLabel",fieldLabel:"GGSOGLIA2",width:120,labelWidth:50,margin:"0 5 0 0",value:14}]},{xtype:"tabPeriodo",itemId:"TabPeriodo",reference:"TabPeriodo",margin:"0 0 10 0",hideTabPeriodo:10==b.cbaConfig.id,showTrimestri:7038==b.cbaConfig.id||7042==b.cbaConfig.id,
titleTabMese:7038==b.cbaConfig.id||7042==b.cbaConfig.id?traduci("TRIMESTRE"):traduci("MESE")},{xtype:"fieldset",hidden:!0,itemId:"ConsideraUtenti",reference:"ConsideraUtenti",layout:{type:"vbox"},title:"CONSIDERA_UTENTI",items:[{xtype:"checkboxfield",checked:!0,itemId:"UtentiDaInizioAnno",reference:"UtentiDaInizioAnno",cls:"cbaLabel",fieldLabel:"",boxLabel:"PRESENTI_DIMESSI_ANNUALI",inputValue:"T",uncheckedValue:"F",hidden:!0},{xtype:"checkboxfield",checked:!0,itemId:"Attivi",reference:"Attivi",cls:"cbaLabel",
fieldLabel:"",boxLabel:"PRESENTI_PERIODO",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"NonAttivi",reference:"NonAttivi",cls:"cbaLabel",fieldLabel:"",boxLabel:"DIMESSI_PERIODO",inputValue:"T",uncheckedValue:"F"},{xtype:"gridpanel",itemId:"MotiviDim",reference:"MotiviDim",width:220,height:150,title:"",hidden:!0,store:Ext.create("GeneraliOSP.store.RisposteSmall"),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:traduci("MOTIVI_DIM"),flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",
{checkOnly:!0}),features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}]}]},{xtype:"fieldset",itemId:"FsTipoPensioni",reference:"FsTipoPensioni",title:"TIPO_STAMPA",hidden:!0,items:[{xtype:"radiogroup",columns:1,vertical:!0,items:[{boxLabel:"SOLO_PENSIONI_INCASSATE",name:"tipoPensioni",cls:"cbaLabel",inputValue:"I",checked:!0},{boxLabel:"SOLO_PENSIONI_NON_INCASSATE",name:"tipoPensioni",cls:"cbaLabel",inputValue:"N"},{boxLabel:"TUTTE_LE_PENSIONI",name:"tipoPensioni",cls:"cbaLabel",inputValue:"T"}]}]},
{xtype:"classificazione",hidden:!0,itemId:"TipoClass",reference:"TipoClass",formId:b.getItemId()+"-form"},{xtype:"fieldset",itemId:"tipoMedico",reference:"tipoMedico",title:"TIPO_MEDICO",hidden:!0,items:[{xtype:"radiogroup",items:[{boxLabel:"INTERNO",name:"tipoMedico",cls:"cbaLabel",inputValue:"T",checked:!0},{boxLabel:"ESTERNO_MED",name:"tipoMedico",cls:"cbaLabel",inputValue:"F"}]}]},{xtype:"combobox",labelClsExtra:"cbaLabel",itemId:"CbTipoStampa",reference:"CbTipoStampa",hidden:!0,editable:!1,fieldLabel:"TIPO_STAMPA",
labelWidth:90,displayField:"valore",labelAlign:"top",valueField:"codice",queryMode:"local",emptyText:"TIPO_STAMPA"},{xtype:"combobox",labelClsExtra:"cbaLabel",itemId:"RiepRaggruppamento",reference:"RiepRaggruppamento",labelClsExtra:"cbaLabel",hidden:!0,editable:!1,fieldLabel:"RAGGRUPPA_PER",labelWidth:90,displayField:"valore",labelAlign:"top",valueField:"codice",queryMode:"local",emptyText:"RAGGRUPPA_PER",store:Ext.create("GeneraliOSP.stampe.store.GrpReport")},{xtype:"checkboxfield",checked:!1,hidden:!0,
itemId:"CBStampaDettaglio",reference:"CBStampaDettaglio",fieldLabel:"",cls:"cbaLabel",boxLabel:"STAMPA_DETTAGLIO",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",checked:!1,hidden:!0,itemId:"CBAssenzeRighe",reference:"CBAssenzeRighe",fieldLabel:"",cls:"cbaLabel",boxLabel:"ASSENZA_RIGHE_DIVERSE",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",checked:!0,hidden:!0,itemId:"CBRaggPerAsl",reference:"CBRaggPerAsl",fieldLabel:"",cls:"cbaLabel",boxLabel:"RAGG_PER_ASL",inputValue:"T",uncheckedValue:"F"},
{xtype:"checkboxfield",checked:!1,hidden:!0,itemId:"CButentiNonAssenti",reference:"CButentiNonAssenti",fieldLabel:"",cls:"cbaLabel",boxLabel:"STAMPA_UTENTI_NON_ASSENTI",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",checked:!1,hidden:!0,itemId:"CBCalcoloConFranchigia",reference:"CBCalcoloConFranchigia",fieldLabel:"",cls:"cbaLabel",boxLabel:"CALCOLO_CON_FRANCHIGIA",inputValue:"T",uncheckedValue:"F"},{xtype:"combobox",labelClsExtra:"cbaLabel",itemId:"CbOrdine",reference:"CbOrdine",hidden:!0,
editable:!1,fieldLabel:"ORDINE_STAMPA",labelWidth:90,displayField:"valore",labelAlign:"top",valueField:"codice",queryMode:"local"},{xtype:"fieldset",hidden:!0,itemId:"fsScontiSupplementi",reference:"fsScontiSupplementi",layout:{type:"hbox"},title:"FILTRI_STAMPA",items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},width:150,items:[{xtype:"checkboxfield",itemId:"chkSconto",reference:"chkSconto",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"SCONTI",inputValue:"4",uncheckedValue:"F"},{xtype:"checkboxfield",
itemId:"chkSupplemento",reference:"chkSupplemento",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"SUPPLEMENTI",inputValue:"3",uncheckedValue:"F"}]},{xtype:"checkboxfield",itemId:"chkRitenuta",reference:"chkRitenuta",checked:!1,cls:"cbaLabel",fieldLabel:"",boxLabel:"RITENUTA",inputValue:"8",uncheckedValue:"F"},{xtype:"button",cls:"btnLarge",itemId:"BtnScontiSupplementiInfo",reference:"BtnScontiSupplementiInfo",hidden:!0,margin:"0 0 0 100",iconCls:"icon-info",scale:"medium",text:"",tooltip:"TOOLTIP_STAMPA_SCONTISUPPLEMENTI"}]},
{xtype:"fieldset",hidden:!0,itemId:"FsFiltroMovimenti",reference:"FsFiltroMovimenti",layout:{type:"vbox"},title:"FILTRI_STAMPA",margin:"0 0 3 0",items:[{xtype:"checkboxfield",itemId:"ChkIngressiPrevisti",reference:"ChkIngressiPrevisti",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"INGRESSI_PREVISTI",inputValue:"8",uncheckedValue:"",hidden:!0},{xtype:"checkboxfield",itemId:"ChkEntrati",reference:"ChkEntrati",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"UTENTI_ENTRATI",inputValue:"1",uncheckedValue:""},
{xtype:"checkboxfield",itemId:"ChkUscitiTmp",reference:"ChkUscitiTmp",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"UTENTI_USCITI_TMP",inputValue:"3",uncheckedValue:""},{xtype:"checkboxfield",itemId:"ChkRientratiTmp",reference:"ChkRientratiTmp",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"UTENTI_ENTRATI_TMP",inputValue:"4",uncheckedValue:""},{xtype:"checkboxfield",itemId:"ChkCambioResid",reference:"ChkCambioResid",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"UTENTI_CAMBIO_RESID",inputValue:"5",
uncheckedValue:""},{xtype:"checkboxfield",itemId:"ChkCambioClass",reference:"ChkCambioClass",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"UTENTI_CAMBIO_CLASS",inputValue:"6",uncheckedValue:""},{xtype:"checkboxfield",itemId:"ChkInUscita",reference:"ChkInUscita",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"UTENTI_IN_DIMISSIONE",inputValue:"7",uncheckedValue:"",hidden:!0},{xtype:"checkboxfield",itemId:"ChkUsciti",reference:"ChkUsciti",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"UTENTI_DIMESSI",
inputValue:"2",uncheckedValue:""},{xtype:"gridpanel",itemId:"MotiviUscita",reference:"MotiviUscita",width:220,height:150,title:"",hidden:!0,store:Ext.create("GeneraliOSP.store.RisposteSmall"),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"MOTIVI_DIM",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0}),features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}]}]},{xtype:"fieldset",hidden:!0,itemId:"TipoDocFattura",reference:"TipoDocFattura",
layout:{type:"vbox"},title:"TIPO_DOC_FATTURA",items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"checkboxfield",itemId:"TipoFattura",reference:"TipoFattura",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"FATTURA",inputValue:"T",uncheckedValue:"F",width:150},{xtype:"checkboxfield",itemId:"TipoCorrispettivo",reference:"TipoCorrispettivo",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"CORRISPETTIVO",inputValue:"T",uncheckedValue:"F"}]},{xtype:"checkboxfield",itemId:"TipoDocContabile",
reference:"TipoDocContabile",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"DOCUMENTO_CONTABILE",inputValue:"T",uncheckedValue:"F"}]},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"fieldset",flex:1,hidden:!0,itemId:"TipoDocRettaFatt",reference:"TipoDocRettaFatt",layout:{type:"vbox"},margin:"0 5 0 0",items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"TipoDocRetta",reference:"TipoDocRetta",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"RETTE",inputValue:"T",
uncheckedValue:"F"},{xtype:"button",margin:"5 0 0 47",cls:"btnLarge",itemId:"BtnPriorita",reference:"BtnPriorita",iconCls:"icon-info",scale:"medium",tooltip:"<TABLE><TR><TD><B>"+traduci("RETTE")+"</B></TD><TD>"+traduci("MSG_INFO_RETTE")+"</TD></TR><TR><TD><B>"+traduci("FATTURE_LIBERE")+"</B></TD><TD>"+traduci("MSG_INFO_FATTURE_LIBERE")+" </TD></TR></TABLE>"}]},{xtype:"checkboxfield",itemId:"TipoDocFatturaLibera",reference:"TipoDocFatturaLibera",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"FATTURE_LIBERE",
inputValue:"T",uncheckedValue:"F"}]},{xtype:"fieldset",flex:1,hidden:!0,itemId:"FattDefArc",reference:"FattDefArc",layout:{type:"vbox"},items:[{xtype:"checkboxfield",itemId:"FattureArchiviate",reference:"FattureArchiviate",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"CONTABILIZZATO",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"FattureDefinitive",reference:"FattureDefinitive",cls:"cbaLabel",fieldLabel:"",boxLabel:"DA_CONTABILIZZARE",inputValue:"T",uncheckedValue:"F"}]}]},
{xtype:"fieldset",itemId:"BoxNumerazione",reference:"BoxNumerazione",layout:{type:"hbox"},title:"NUMERAZIONE",margin:"3 0 0 0",hidden:!0,items:[{xtype:"combobox",itemId:"Registro",reference:"Registro",labelClsExtra:"cbaLabel",editable:!1,fieldLabel:"REGISTRO",labelAlign:"top",width:150,margin:"0 5 5 5",displayField:"valore",valueField:"valore",queryMode:"local",emptyText:"TUTTI_REGISTRI",store:Ext.create("Generali.store.Registro")},{xtype:"combobox",itemId:"CbEnteIva",reference:"CbEnteIva",fieldLabel:"ENTE_IVA",
labelAlign:"top",width:150,margin:"0 5 5 5",labelClsExtra:"cbaLabel",name:"enteIvaFinanziaria",displayField:"valore",queryMode:"local",valueField:"codice",matchFieldWidth:!1,editable:!1,displayTpl:['<tpl for=".">',"{extra} | {valore}","</tpl>"],tpl:['<tpl for=".">','<div class="x-boundlist-item">{extra} | {valore}</div>',"</tpl>"]},{xtype:"numberfield",allowDecimals:!1,fieldLabel:"DAL",itemId:"DalNumero",reference:"DalNumero",labelClsExtra:"cbaLabel",labelWidth:30,flex:1,margin:"0 5 5 5",labelAlign:"top"},
{xtype:"numberfield",allowDecimals:!1,fieldLabel:"AL",itemId:"AlNumero",reference:"AlNumero",labelClsExtra:"cbaLabel",labelWidth:30,flex:1,margin:"0 5 5 5",labelAlign:"top"}]},{xtype:"gridpanel",itemId:"TipoPagante",reference:"TipoPagante",hidden:!0,width:200,margin:"0 0 10 0",columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"TIPI_PAGANTE",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})},{xtype:"numberfield",itemId:"FranchigiaAssenza",reference:"FranchigiaAssenza",
fieldLabel:"CU_FRANCHIGIA_ASSENZA",margin:"10 0 0 0",hideTrigger:!1,allowDecimals:!1,labelClsExtra:"cbaLabel",hidden:!0,labelWidth:130,maxWidth:195,minValue:0,value:0},{xtype:"checkboxfield",itemId:"ChkImportiPersonalizzazioni",reference:"ChkImportiPersonalizzazioni",margin:"10 0 0 0",checked:!1,hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"IMPORTI_PERSONALIZZAZIONI",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"chkGrpServizio",reference:"chkGrpServizio",checked:!1,hidden:!0,
cls:"cbaLabel",fieldLabel:"",boxLabel:"RAGGR_PER_SERVIZIO",inputValue:"T",uncheckedValue:"F"},{xtype:"fieldset",itemId:"FormatoCarta",reference:"FormatoCarta",hidden:!0,items:[{xtype:"radiogroup",items:[{boxLabel:"ORIZZONTALE",formId:b.getItemId()+"-form",name:"formatoCarta",cls:"cbaLabel",inputValue:"L",checked:!0},{boxLabel:"VERTICALE",formId:b.getItemId()+"-form",name:"formatoCarta",cls:"cbaLabel",inputValue:"P"}]}]},{xtype:"checkboxfield",itemId:"chkOccupanti",reference:"chkOccupanti",checked:!1,
hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"STP_OCCUPANTI",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"chkSoloLibere",reference:"chkSoloLibere",checked:!0,hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"STP_SOLO_LIBERE",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"chkGrpClass",reference:"chkGrpClass",checked:!0,hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"RAGGR_CLASS",inputValue:"T",uncheckedValue:"F"},{xtype:"fieldset",itemId:"fsScadDoc",reference:"fsScadDoc",
title:"SCADUTI_IN_SCADENZA_PERIODO",items:[{xtype:"checkboxfield",itemId:"chGrpUtScad",reference:"chGrpUtScad",checked:!1,cls:"cbaLabel",fieldLabel:"",boxLabel:"GRP_UTENTE",inputValue:"3",uncheckedValue:"F"},{xtype:"gridpanel",itemId:"tipoDocumenti",reference:"tipoDocumenti",flex:1,margin:"5 0 2 0",store:Ext.create("GeneraliOSP.store.RisposteSmall",{proxy:{urlGen:"/ws/genOsp/risp/src",extraParams:{scheda:"B",domanda:10}}}),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"TIPO_DOCUMENTO",
flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})}],hidden:!0},{xtype:"fieldset",hidden:!0,itemId:"BoxFiltroPaganti",reference:"BoxFiltroPaganti",layout:{type:"vbox"},title:"RICERCA_PAGANTE",items:[{xtype:"checkboxfield",itemId:"ChkPagante",reference:"ChkPagante",cls:"cbaLabel",fieldLabel:"",boxLabel:"SOLO_UTENTI_PAG",inputValue:"T",uncheckedValue:"F",listeners:{change:function(b,d){b.up().down("#CboxPagante").setVisible(b.checked)}}},{xtype:"combobox",
labelClsExtra:"cbaLabel",itemId:"CboxPagante",reference:"CboxPagante",hidden:!0,editable:!1,fieldLabel:"MSG_SELZIONARE_PAGANTE",width:270,labelWidth:90,displayField:"valore",labelAlign:"top",valueField:"codice",queryMode:"remote",queryParam:"valore",triggerAction:"all",editable:!0,typeAhead:!0,minChars:3,matchFieldWidth:!1,allowBlank:!1,pageSize:10,forceSelection:!0,listeners:{beforequery:function(b){if(!b.query)return!1}},store:Ext.create("GeneraliOSP.portlet.store.ListaPaganti"),tpl:Ext.create("Ext.XTemplate",
'<tpl for=".">',"<tpl if=\"extra=='' || extra.indexOf('null')!=-1 || extra.indexOf(',')==0\">",'<div class="x-boundlist-item">{valore}</div>',"<tpl else>","<tpl if=\"extra.indexOf(',')!=-1\">","<tpl if=\"extra.split(',')[1]=='F'\">",'<div style="font-style: italic !important; color: #707070 !important;" class="x-boundlist-item">{valore} [CF: {[values.extra.split(\',\')[0]]}]</div>',"<tpl else>","<div class=\"x-boundlist-item\">{valore} [CF: {[values.extra.split(',')[0]]}]</div>","</tpl>","<tpl else>",
'<div class="x-boundlist-item">{valore} [CF: {extra}]</div>',"</tpl>","</tpl>","</tpl>")}]},{xtype:"tipocomune",hidden:!0,itemId:"TipoComune",reference:"TipoComune",formId:b.getItemId()+"-form"},{margin:"15 0 0 0",xtype:"container",layout:{type:"vbox"},items:[{xtype:"gridpanel",itemId:"GridFasceEta",reference:"GridFasceEta",hidden:!0,width:180,margin:"0 0 10 0",columns:[{xtype:"numbercolumn",align:"center",dataIndex:"etaMin",text:"ETA_MIN",flex:1,format:"0.",editor:{xtype:"numberfield",decimalPrecision:0,
allowBlank:!1}},{xtype:"numbercolumn",align:"center",dataIndex:"etaMax",text:"ETA_MAX",flex:1,format:"0.",editor:{xtype:"numberfield",decimalPrecision:0,allowBlank:!1}}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0}),plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",
itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"Elimina"}]}]}]},{xtype:"checkboxfield",hidden:!0,itemId:"RaggrPerSede",reference:"RaggrPerSede",fieldLabel:"",cls:"cbaLabel",boxLabel:"RAGGR_PER_SEDE",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",hidden:!0,itemId:"MotivoAssenza",reference:"MotivoAssenza",fieldLabel:"",cls:"cbaLabel",boxLabel:"RAGGR_MOTIVO_ASSENZA",inputValue:"T",uncheckedValue:"F"},{xtype:"gridpanel",itemId:"GridMotiviUscitaTemp",reference:"GridMotiviUscitaTemp",
width:220,height:300,title:"",hidden:!0,store:Ext.create("GeneraliOSP.store.RisposteSmall"),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"MOTIVI_USCITA_TEMP",flex:1,renderer:function(b,d,f,g,h,k,l){"T"==f.get("stato")&&(d.tdStyle="font-style: italic !important; color: #707070 !important; text-decoration: line-through;");return b}}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0}),features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}]},{xtype:"checkboxfield",
itemId:"ChkVisualizzaSoloPagantiAttivi",reference:"ChkVisualizzaSoloPagantiAttivi",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"VISUALIZZA_SOLO_PAGANTI_ATTIVI",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"ChkConsideraAssenze",reference:"ChkConsideraAssenze",checked:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"CONSIDERA_ASSENZE",inputValue:"T",uncheckedValue:"F"},{xtype:"combobox",labelClsExtra:"cbaLabel",itemId:"CbEstrattoConto",reference:"CbEstrattoConto",hidden:!0,editable:!1,
fieldLabel:"TIPO_STAMPA",labelWidth:90,displayField:"valore",labelAlign:"top",valueField:"codice",queryMode:"local",emptyText:"TIPO_STAMPA",value:1,store:Ext.create("Ext.data.Store",{fields:[{name:"codice"},{name:"valore"}],data:[{codice:1,valore:traduci("CU_ESTRATTO_CONTO")},{codice:2,valore:traduci("SALDI")},{codice:3,valore:traduci("CU_MOVIMENTI")}]}),listeners:{change:function(b,d){b.up().down("#FsMovimenti").setVisible(3==d)}}},{xtype:"fieldset",hidden:!0,itemId:"FsMovimenti",reference:"FsMovimenti",
layout:{type:"vbox"},items:[{xtype:"checkboxfield",itemId:"TipoMovVersamento",checked:!0,cls:"cbaLabel",boxLabel:"CU_VERSAMENTO",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"TipoMovRestituzione",checked:!0,cls:"cbaLabel",boxLabel:"CU_RESTITUZIONE",inputValue:"T",uncheckedValue:"F"}]},{xtype:"checkboxfield",itemId:"ChkSaldiZero",reference:"ChkSaldiZero",hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"INCLUDE_SALDI_ZERO",checked:!1,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",
itemId:"ChkSaldiNegativi",reference:"ChkSaldiNegativi",hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"SOLO_SALDI_NEGATIVI",checked:!1,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"ChkNonMovimentati",reference:"ChkNonMovimentati",hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"INCLUDE_NON_MOVIMENTATI",checked:!1,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"CambiaPag",reference:"CambiaPag",hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"CAMBIA_PAGINA",checked:!1,
inputValue:"T",uncheckedValue:"F"},{xtype:"combobox",labelClsExtra:"cbaLabel",itemId:"CbDocPers",reference:"CbDocPers",labelClsExtra:"cbaLabel",hidden:!0,editable:!1,fieldLabel:"DOCUMENTI_PERSONALIZZATI",labelWidth:90,displayField:"valore",labelAlign:"top",valueField:"codice",queryMode:"local",store:Ext.create("Generali.docPerson.store.CbDocPerson")},{xtype:"container",items:[{xtype:"fieldset",itemId:"FieldBoxDaPubblicare",reference:"FieldBoxDaPubblicare",hidden:!0,margin:"3 0 3 0",title:"",items:[{xtype:"radiogroup",
itemId:"BoxDaPubblicare",reference:"BoxDaPubblicare",layout:{type:"vbox"},margin:"3 0 0 0",items:[{formId:b.getItemId()+"-form",boxLabel:"TUTTI",name:"BoxDaPubblicare",cls:"cbaLabel",inputValue:3,checked:!0},{formId:b.getItemId()+"-form",boxLabel:"DA_PUBBLICARE",name:"BoxDaPubblicare",cls:"cbaLabel",inputValue:1},{formId:b.getItemId()+"-form",boxLabel:"DA_NON_PUBBLICARE",name:"BoxDaPubblicare",cls:"cbaLabel",inputValue:2}]}]}]},{xtype:"numberfield",itemId:"PercDeducibile",reference:"PercDeducibile",
fieldLabel:traduci("CERTIF_PERCENTUALE_DEDUCIBILE")+" (%)",labelWidth:200,margin:"10 0 0 0",labelClsExtra:"cbaLabel",hidden:!0,maxLength:5,enforceMaxLength:!0,allowDecimals:!0,decimalPosition:2,minValue:0,maxValue:100},{xtype:"fieldset",itemId:"ImportoIncassatoCertLomb",reference:"ImportoIncassatoCertLomb",title:"IMPORTO_INCASSATO",hidden:!0,margin:"10 0 0 0",layout:{type:"vbox"},items:[{xtype:"radiogroup",itemId:"ImportoIncassatoRdg",reference:"ImportoIncassatoRdg",items:[{boxLabel:"SCADENZE",name:"tipoImportoIncassato",
cls:"cbaLabel",inputValue:"T",checked:!0},{boxLabel:"CU_ESTRATTO_CONTO",name:"tipoImportoIncassato",cls:"cbaLabel",inputValue:"F",margin:"0 0 0 10"}]},{xtype:"container",itemId:"IncassoPeriodo",reference:"IncassoPeriodo",hidden:!0,padding:7,layout:{type:"vbox"},items:[{xtype:"datefield",fieldLabel:"DAL",itemId:"IncassoDataDal",reference:"IncassoDataDal",labelClsExtra:"cbaLabel",format:"d/m/Y",labelWidth:30,width:140},{xtype:"datefield",fieldLabel:"AL",itemId:"IncassoDataAl",reference:"IncassoDataAl",
labelClsExtra:"cbaLabel",format:"d/m/Y",labelWidth:30,width:140}]}]},{xtype:"container",hidden:!0,itemId:"cboxConteggiaServizi",reference:"cboxConteggiaServizi",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"chkConteggiaServizi",reference:"chkConteggiaServizi",checked:!1,cls:"cbaLabel",fieldLabel:"",boxLabel:"CONTEGGIA_SERVIZI",inputValue:"1",uncheckedValue:"F"},{xtype:"button",cls:"btnLarge",itemId:"btnConteggiaServizi",reference:"btnConteggiaServizi",margin:"0 0 0 5",
iconCls:"icon-info",scale:"medium",text:"",tooltip:"TOOLTIP_STAMPAUTENTI_FLAGSERVIZIO"}]},{xtype:"checkboxfield",itemId:"chkDividiPerAsl",reference:"chkDividiPerAsl",checked:!0,hidden:!0,cls:"cbaLabel",fieldLabel:"",boxLabel:"DIVIDI_ASL",inputValue:"T",uncheckedValue:"F"},{xtype:"fieldset",hidden:!0,itemId:"ConsideraGGDim",reference:"ConsideraGGDim",margin:"10 0 0 0",layout:{type:"hbox"},title:"CONSIDERA_GG_DIMISSIONE",items:[{xtype:"gridpanel",itemId:"MotiviGGDim",reference:"MotiviGGDim",margin:"5 0 5 0",
width:220,height:150,store:Ext.create("GeneraliOSP.store.RisposteSmall"),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:traduci("MOTIVI_DIM"),flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0}),features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}]},{xtype:"button",cls:"btnLarge",itemId:"BtnConsideraGGDim",reference:"BtnConsideraGGDim",margin:"5 0 0 20",iconCls:"icon-info",scale:"medium",text:"",tooltip:"CONSIDERA_GG_DIMISSIONE_TOOLTIP"}]},
{xtype:"container",hidden:!0,itemId:"cboxFiltraStoricoQuote",reference:"cboxFiltraStoricoQuote",margin:"0 0 5 0",layout:{type:"hbox"},items:[{xtype:"checkboxfield",itemId:"chkFiltraStoricoQuote",reference:"chkFiltraStoricoQuote",checked:!1,cls:"cbaLabel",fieldLabel:"",boxLabel:"FILTRA_STORICO_QUOTE",inputValue:"1",uncheckedValue:"F"},{xtype:"button",cls:"btnLarge",itemId:"btnFiltraStoricoQuote",reference:"btnFiltraStoricoQuote",margin:"0 0 0 5",iconCls:"icon-info",scale:"medium",text:"",tooltip:"TOOLTIP_FILTRA_STORICO_QUOTE"}]}]},
{xtype:"container",itemId:"CntServSupp",reference:"CntServSupp",flex:1,layout:{type:"L"==b.cbaConfig.regione?"hbox":"vbox",align:"stretch"},items:[{xtype:"gridpanel",flex:1,margin:"0 0 10 0",itemId:"CondPagamento",reference:"CondPagamento",hidden:!0,width:200,store:Ext.create("Generali.store.CondizioniPagamento"),columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"CONDIZIONI_DI_PAGAMENTO",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})},{xtype:"container",
flex:1,layout:{type:"vbox",align:"stretch"},margin:"3 0 0 5",items:[{xtype:"checkboxfield",itemId:"FiltraSoloAttivi",reference:"FiltraSoloAttivi",fieldLabel:"",boxLabel:"FILTRA_SOLO_ATTIVI",cls:"cbaLabel",inputValue:"T",uncheckedValue:"F",listeners:{render:{fn:function(b,d){b.setValue(!0)},scope:b}}},{xtype:"container",itemId:"CntTreeServizi",reference:"CntTreeServizi",fieldDefaults:{margin:"2 4 4 2"},layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"treepanel",flex:1,border:0,margin:"0 10 0 0",
itemId:"TreeServiziClass",reference:"TreeServiziClass",maxWidth:"L"==b.cbaConfig.regione?500:null,rootVisible:!1,useArrows:!0,store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),columns:[{xtype:"treecolumn",dataIndex:"text",text:"SERVIZI_CLASSIFICAZIONI",flex:1},{xtype:"gridcolumn",dataIndex:"importo1",sortable:!1,text:"percentuale",hidden:!0,width:80,renderer:function(c,d,f){!c&&f.get("percentuale")&&(c=f.get("percentuale"),b.cbaConfig.updatePercCertificazioni=!0,f.data.modified=!0);return cell_renderer_importo(c,
d,f)},editor:{xtype:"numberfield",minValue:0,maxValue:100}},{xtype:"gridcolumn",dataIndex:"space",hidden:!0,flex:1}],viewConfig:{loadMask:!1},plugins:{ptype:"cellediting",clicksToEdit:1}},{xtype:"treepanel",flex:1,border:0,itemId:"TreeMotiviUscitaTemp",reference:"TreeMotiviUscitaTemp",hidden:!0,rootVisible:!1,useArrows:!0,store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),columns:[{xtype:"treecolumn",dataIndex:"text",text:"MOTIVI_USCITA_TEMPORANEA",flex:1},{xtype:"gridcolumn",dataIndex:"importo1",
sortable:!1,text:"percentuale",width:80,renderer:function(c,d,f){!c&&f.get("percentuale")&&(c=f.get("percentuale"),b.cbaConfig.updatePercCertificazioni=!0,f.data.modified=!0);return cell_renderer_importo(c,d,f)},editor:{xtype:"numberfield",minValue:0,maxValue:100}},{xtype:"gridcolumn",dataIndex:"space",flex:1}],viewConfig:{loadMask:!1},plugins:{ptype:"cellediting",clicksToEdit:1}}]},{xtype:"container",itemId:"CntScontiSupplementi",reference:"CntScontiSupplementi",fieldDefaults:{margin:"2 4 4 2"},
layout:{type:"hbox",align:"stretch"},flex:1,hidden:!0,margin:"20 0 0 0",items:[{xtype:"treepanel",flex:1,border:0,margin:"0 10 0 0",itemId:"TreeSupplementi",reference:"TreeSupplementi",rootVisible:!1,useArrows:!0,store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),columns:[{xtype:"treecolumn",dataIndex:"text",text:"SUPPLEMENTI",flex:1},{xtype:"gridcolumn",dataIndex:"importo1",sortable:!1,text:"percentuale",width:80,renderer:function(c,d,f){!c&&f.get("percentuale")&&(c=f.get("percentuale"),b.cbaConfig.updatePercCertificazioni=
!0,f.data.modified=!0);return cell_renderer_importo(c,d,f)},editor:{xtype:"numberfield",minValue:0,maxValue:100,listeners:{blur:function(b){b.up("editor").context.record.get("checked")&&!b.getValue()&&b.setValue(100)}}}},{xtype:"gridcolumn",dataIndex:"space",flex:1}],viewConfig:{loadMask:!1},plugins:{ptype:"cellediting",clicksToEdit:1}},{xtype:"treepanel",flex:1,border:0,itemId:"TreeSconti",reference:"TreeSconti",rootVisible:!1,useArrows:!0,store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),
columns:[{xtype:"treecolumn",dataIndex:"text",text:"SCONTI",flex:1},{xtype:"gridcolumn",dataIndex:"importo1",sortable:!1,text:"percentuale",width:80,renderer:function(c,d,f){!c&&f.get("percentuale")&&(c=f.get("percentuale"),b.cbaConfig.updatePercCertificazioni=!0,f.data.modified=!0);return cell_renderer_importo(c,d,f)},editor:{xtype:"numberfield",minValue:0,maxValue:100,listeners:{blur:function(b){b.up("editor").context.record.get("checked")&&!b.getValue()&&b.setValue(100)}}}},{xtype:"gridcolumn",
dataIndex:"space",flex:1}],viewConfig:{loadMask:!1},plugins:{ptype:"cellediting",clicksToEdit:1}}]}]}]},{xtype:"container",itemId:"ServiziClassExtImporto",reference:"ServiziClassExtImporto",layout:{type:"vbox",align:"stretch"},margin:"0 0 0 15",hidden:!0,flex:1,items:[{xtype:"container",layout:{type:"hbox",align:"stretch",flex:1},items:[{xtype:"fieldset",itemId:"ImportiDefault",reference:"ImportiDefault",layout:{type:"hbox",align:"stretch"},title:"IMPORTI_DI_DEFAULT",maxWidth:350,items:[{xtype:"numberfield",
itemId:"ImportoPresDefault",reference:"ImportoPresDefault",fieldLabel:"PRESENZA",labelWidth:80,margin:5,labelClsExtra:"cbaLabel",hidden:!1,flex:1},{xtype:"numberfield",itemId:"ImportoAssDefault",reference:"ImportoAssDefault",fieldLabel:"ASSENZA",labelWidth:80,margin:"5 5 5 20",labelClsExtra:"cbaLabel",hidden:!1,flex:1}]},{xtype:"container",margin:"30 10 10 10",items:[{xtype:"button",itemId:"BtnSalva",reference:"BtnSalva",scale:"small",iconCls:"icon-ok",text:"CONFERMA"}]}]},{xtype:"treepanel",flex:1,
maxWidth:700,itemId:"TreeClassifImporti",reference:"TreeClassifImporti",store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},columns:[{xtype:"treecolumn",dataIndex:"text",text:"CU_CLASSIFICAZIONI",flex:1,renderer:function(b,d,f,g,h,k,l){return b}},{xtype:"gridcolumn",width:120,align:"center",dataIndex:"importo1",text:"CU_IMPORTO_PRESENZA",format:"0.00",renderer:cell_renderer_importo,editor:{xtype:"numberfield",decimalPrecision:2,listeners:{focus:function(b){var c=
b.up("treepanel");c.getSelection()[0].data.importoIsDirty=!0;c.getSelection()[0].get("leaf")||(b.blur(),c.editingPlugin.cancelEdit())}}}},{xtype:"gridcolumn",width:120,align:"center",dataIndex:"importo2",text:"CU_IMPORTO_ASSENZA",format:"0.00",renderer:cell_renderer_importo,editor:{xtype:"numberfield",decimalPrecision:2,listeners:{focus:function(b){var c=b.up("treepanel");c.getSelection()[0].data.importoIsDirty=!0;c.getSelection()[0].get("leaf")||(b.blur(),c.editingPlugin.cancelEdit())}}}}],plugins:{ptype:"cellediting",
clicksToEdit:1}}]}]},{xtype:"panel",itemId:"pageScontiSupp",reference:"pageScontiSupp",hidden:!0,tabConfig:{title:"SCONTI/SUPPLEMENTI",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"checkboxfield",itemId:"FiltraSoloAttiviScontiSupp",reference:"FiltraSoloAttiviScontiSupp",fieldLabel:"",boxLabel:"FILTRA_SOLO_ATTIVI",cls:"cbaLabel",inputValue:"T",uncheckedValue:"F",listeners:{render:{fn:function(b,d){b.setValue(!0)},scope:b}}},{xtype:"container",flex:1,layout:{type:"hbox",
align:"stretch"},bodyPadding:5,items:[{xtype:"treepanel",flex:1,border:0,itemId:"treeSconto",reference:"treeSconto",title:"",rootVisible:!1,useArrows:!0,disabled:!1,store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),viewConfig:{loadMask:!1},columns:[{xtype:"treecolumn",dataIndex:"text",text:"SCONTI",flex:1}]},{xtype:"treepanel",flex:1,border:0,itemId:"treeSupp",reference:"treeSupp",title:"",rootVisible:!1,useArrows:!0,disabled:!1,store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),viewConfig:{loadMask:!1},
columns:[{xtype:"treecolumn",dataIndex:"text",text:"SUPPLEMENTI",flex:1}]}]}]},{xtype:"panel",itemId:"PageSedeReparto",reference:"PageSedeReparto",hidden:!0,tabConfig:{title:"SELEZIONE_SEDE_REPARTO",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"checkboxfield",itemId:"FiltraPerSede",reference:"FiltraPerSede",cls:"cbaLabel",fieldLabel:"",boxLabel:"FILTRA_PER_SEDE",inputValue:"T",uncheckedValue:"F"},{xtype:"treepanel",flex:1,border:0,itemId:"TreeSedeReparto",reference:"TreeSedeReparto",
title:"",rootVisible:!1,useArrows:!0,disabled:!0,store:Ext.create("GeneraliOSP.store.SedeReparto"),viewConfig:{loadMask:!1}}]},{xtype:"panel",itemId:"PageUtenti",reference:"PageUtenti",hidden:!0,tabConfig:{title:"ELENCO_UTENTI",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"gridpanel",itemId:"GridUtenti",reference:"GridUtenti",flex:1,store:Ext.create("GeneraliOSP.stampe.store.UtentiStampa"),columns:[{xtype:"gridcolumn",dataIndex:"nominativo",text:"COGNOME_NOME",flex:1},
{xtype:"datecolumn",align:"center",style:"text-align:center",dataIndex:"dataNascita",text:"DATA_NASCITA",format:"d/m/Y",width:90}],viewConfig:{loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",cbaConfig:{searchField:"nominativo",ricercaIniziaPer:!0}}]}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"simple"})}]},{xtype:"panel",itemId:"PageSchedeFascicolo",reference:"PageSchedeFascicolo",hidden:!0,tabConfig:{title:"SCHEDE_FASCICOLO",height:44},layout:{align:"stretch",
type:"hbox"},bodyPadding:5,items:[{xtype:"gridpanel",itemId:"GridSchedeFas",reference:"GridSchedeFas",flex:1,columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"DESCRIZIONE",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"simple"})}]},{xtype:"panel",itemId:"PagePaganti",reference:"PagePaganti",hidden:!0,tabConfig:{title:"PAGANTI",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"container",itemId:"containerFiltriPag",
reference:"containerFiltriPag",hidden:!0,layout:{type:"hbox",align:"stretch"},height:120,margin:"0 0 20 0",items:[{xtype:"gridpanel",itemId:"TipoPagantePagePaganti",reference:"TipoPagantePagePaganti",width:200,margin:"0 20 0 0",store:Ext.create("GeneraliOSP.store.TipiPaganti",{autoLoad:!0}),columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"TIPI_PAGANTE",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})},{xtype:"gridpanel",itemId:"GridCategoria",
reference:"GridCategoria",store:Ext.create("Generali.store.Categoria"),flex:1,columns:[{xtype:"gridcolumn",dataIndex:"valore",text:"CATEGORIA",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})}]},{xtype:"gridpanel",itemId:"GridPaganti",reference:"GridPaganti",flex:1,store:Ext.create("GeneraliOSP.stampe.store.Paganti"),columns:[{xtype:"gridcolumn",dataIndex:"ragioneSociale",text:"RAGIONE_SOCIALE",width:300},{xtype:"gridcolumn",dataIndex:"codiceFiscale",
text:traduci("CODICE_FISCALE")+"/"+traduci("PARTITA_IVA"),flex:1}],viewConfig:{loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",cbaConfig:{searchField:"ragioneSociale",ricercaIniziaPer:!0}}]}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"simple"})}]},{xtype:"panel",itemId:"PagePersRiferimento",reference:"PagePersRiferimento",hidden:!0,tabConfig:{title:"PERSONA_RIFERIMENTO",height:44},layout:{type:"hbox"},bodyPadding:5,items:[{xtype:"fieldset",
hidden:!1,margin:"0 0 0 10",width:250,itemId:"GradiParentela",reference:"GradiParentela",layout:{type:"vbox"},title:"GRADO_PARENTELA",items:[{xtype:"checkboxfield",checked:!1,margin:"0 0 5 5",itemId:"CBGarante",reference:"CBGarante",fieldLabel:"",boxLabel:"Solo Garanti",inputValue:"T",uncheckedValue:"F"},{xtype:"gridpanel",itemId:"GridGradoParentela",reference:"GridGradoParentela",margin:"0 0 10 0",disabled:!1,width:220,flex:1,title:"",hidden:!1,store:Ext.create("GeneraliOSP.store.RisposteSmall",
{proxy:{urlGen:"/ws/genOsp/risp/src",extraParams:{scheda:"B",domanda:10}}},{autoLoad:!1}),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"GRADO_PARENTELA",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})}]},{xtype:"fieldset",hidden:!1,margin:"0 0 0 30",itemId:"Rating",reference:"Rating",layout:{type:"vbox"},width:140,title:"REF_RATING",items:[{xtype:"gridpanel",itemId:"GridRating",reference:"GridRating",margin:"0 0 10 0",width:120,title:"",
hidden:!1,disabled:!1,store:Ext.create("GeneraliOSP.stampe.store.Rating"),columns:[{xtype:"gridcolumn",align:"center",dataIndex:"valore",text:"REF_RATING",flex:1,renderer:function(b,d,f,g,h,k,l){return 0<b?(d.tdCls="icon-star",b):"Non assegnata"}}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})}]}]},{xtype:"panel",itemId:"PageEtichette",reference:"PageEtichette",hidden:!0,tabConfig:{title:"IMPOSTAZIONI_ETICHETTE",height:44},layout:{align:"stretch",type:"vbox"},
items:Ext.create("GeneraliOSP.personalizzazioni.view.PersonEtichette",{flex:1,cbaConfig:{personalizzazioni:!1}})}]}]});b.callParent(arguments)}});
Ext.define("GeneraliOSP.stampe.view.CUStampaPersRif",{extend:"Generali.standard.ControlledContainer",requires:["GeneraliOSP.stampe.controller.CUStampaPersRif"],uses:["Generali.standard.stampe.Button"],initComponent:function(){Ext.applyIf(this,{items:[{xtype:"stampaCBA",useNewButtonStampa:!0,border:0,itemId:"TabPrincipale",reference:"TabPrincipale",items:[{xtype:"panel",tabConfig:{title:"PARAMETRI_GENERALI",height:44},itemId:"PageParametri",reference:"PageParametri",hidden:!1,layout:{align:"stretch",
type:"hbox"},bodyPadding:5,title:"",items:[{xtype:"container",itemId:"CntParam",reference:"CntParam",padding:5,width:300,layout:{align:"stretch",type:"vbox"},autoScroll:!0,items:[{xtype:"tabPeriodo",itemId:"TabPeriodo",reference:"TabPeriodo"},{xtype:"fieldset",hidden:!1,itemId:"ConsideraUtenti",reference:"ConsideraUtenti",layout:{type:"vbox"},title:"CONSIDERA_UTENTI",items:[{xtype:"checkboxfield",checked:!0,itemId:"Attivi",reference:"Attivi",cls:"cbaLabel",fieldLabel:"",boxLabel:"PRESENTI_PERIODO",
inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",itemId:"NonAttivi",reference:"NonAttivi",cls:"cbaLabel",fieldLabel:"",boxLabel:"DIMESSI_PERIODO",inputValue:"T",uncheckedValue:"F"},{xtype:"gridpanel",itemId:"MotiviDim",reference:"MotiviDim",width:220,height:150,title:"",hidden:!1,disabled:!0,store:Ext.create("GeneraliOSP.store.RisposteSmall",{autoLoad:!1}),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"MOTIVI_DIM",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",
{checkOnly:!0}),features:[{ftype:"grouping",groupHeaderTpl:["{name}"]}]}]},{xtype:"classificazione",itemId:"TipoClass",reference:"TipoClass"},{xtype:"combobox",labelClsExtra:"cbaLabel",itemId:"CbTipoStampa",reference:"CbTipoStampa",hidden:!1,editable:!1,allowBlank:!1,fieldLabel:"TIPO_STAMPA",labelWidth:90,displayField:"valore",labelAlign:"top",valueField:"codice",queryMode:"local",emptyText:"TIPO_STAMPA",store:Ext.create("GeneraliOSP.stampe.store.TipoReportPersRif",{autoLoad:!0})},{xtype:"checkboxfield",
checked:!1,itemId:"CBGarante",reference:"CBGarante",fieldLabel:"",boxLabel:"Solo Garanti",inputValue:"T",uncheckedValue:"F"},{xtype:"fieldset",hidden:!1,itemId:"GradiParentela",reference:"GradiParentela",layout:{type:"vbox"},title:"GRADO_PARENTELA",items:[{xtype:"gridpanel",itemId:"GridGradoParentela",reference:"GridGradoParentela",disabled:!1,width:220,height:180,flex:1,title:"",hidden:!1,store:Ext.create("GeneraliOSP.store.RisposteSmall",{proxy:{urlGen:"/ws/genOsp/risp/src",extraParams:{scheda:"B",
domanda:10}}},{autoLoad:!1}),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"GRADO_PARENTELA",flex:1}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})}]},{xtype:"fieldset",hidden:!1,itemId:"Rating",reference:"Rating",layout:{type:"vbox"},title:"REF_RATING",items:[{xtype:"gridpanel",itemId:"GridRating",reference:"GridRating",width:120,title:"",hidden:!1,disabled:!1,store:Ext.create("GeneraliOSP.stampe.store.Rating"),columns:[{xtype:"gridcolumn",
align:"center",dataIndex:"valore",text:"REF_RATING",flex:1,renderer:function(b,c,d,f,g,h,k){return 0<b?(c.tdCls="icon-star",b):"Non assegnata"}}],viewConfig:{loadMask:!1},selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0})}]}]},{xtype:"container",itemId:"CntParamBis",reference:"CntParamBis",fieldDefaults:{margin:"2 4 4 2"},layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},margin:"3 0 0 5",items:[{xtype:"checkboxfield",itemId:"FiltraSoloAttivi",
reference:"FiltraSoloAttivi",fieldLabel:"",boxLabel:"FILTRA_SOLO_ATTIVI",cls:"cbaLabel",inputValue:"T",uncheckedValue:"F",listeners:{render:{fn:function(b,c){b.setValue(!0)},scope:this}}},{xtype:"treepanel",flex:1,border:0,margin:"0 10 0 0",itemId:"TreeServiziClass",reference:"TreeServiziClass",rootVisible:!1,useArrows:!0,store:Ext.create("GeneraliOSP.store.Albero",{sorters:[]}),columns:[{xtype:"treecolumn",dataIndex:"text",text:"SERVIZI_CLASSIFICAZIONI",flex:1},{xtype:"gridcolumn",dataIndex:"percentuale",
sortable:!1,text:"percentuale",hidden:!0,width:80,renderer:cell_renderer_importo,editor:{xtype:"numberfield",minValue:0,maxValue:100}},{xtype:"gridcolumn",dataIndex:"space",hidden:!0,flex:1}],viewConfig:{loadMask:!1}}]}]}]},{xtype:"panel",itemId:"PageSedeReparto",reference:"PageSedeReparto",hidden:!1,tabConfig:{title:"SELEZIONE_SEDE_REPARTO",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"checkboxfield",itemId:"FiltraPerSede",reference:"FiltraPerSede",cls:"cbaLabel",fieldLabel:"",
boxLabel:"FILTRA_PER_SEDE",inputValue:"T",uncheckedValue:"F"},{xtype:"treepanel",flex:1,border:0,itemId:"TreeSedeReparto",reference:"TreeSedeReparto",title:"",rootVisible:!1,useArrows:!0,disabled:!0,store:Ext.create("GeneraliOSP.store.SedeReparto")}]},{xtype:"panel",itemId:"PageUtenti",reference:"PageUtenti",hidden:!1,tabConfig:{title:"ELENCO_UTENTI",height:44},layout:{align:"stretch",type:"vbox"},bodyPadding:5,items:[{xtype:"gridpanel",itemId:"GridUtenti",reference:"GridUtenti",flex:1,store:Ext.create("GeneraliOSP.stampe.store.UtentiStampa"),
columns:[{xtype:"gridcolumn",dataIndex:"nominativo",text:"COGNOME_NOME",flex:1},{xtype:"datecolumn",align:"center",style:"text-align:center",dataIndex:"dataNascita",text:"DATA_NASCITA",format:"d/m/Y",width:90}],viewConfig:{loadMask:!1},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",cbaConfig:{searchField:"nominativo",ricercaIniziaPer:!0}}]}],selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0,mode:"simple"})}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliOSP.stampe.view.UploadDocPerson",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",itemId:"Form",reference:"Form",defaults:{margin:0},layout:{align:"stretch",type:"vbox",padding:0},items:[{xtype:"label",text:"PORTALE_DOCPERS_RICHIESTA_CONFERMA",labelClsExtra:"cbaLabel",cls:"cbaLabel",margin:"10 0 0 10"},{xtype:"label",text:"PORTALE_DOCPERS_NOTAINVIO",labelClsExtra:"cbaLabel",margin:"5 0 0 20"},
{xtype:"container",margin:"15 10 0 10",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"dataGiornoDal",reference:"dataGiornoDal",fieldLabel:"PORTALE_DOCPERS_DATA_PUBBLICAZIONE",labelClsExtra:"cbaLabel",name:"dataDal",allowBlank:!1,value:new Date,margin:"0 10 0 0",flex:1},{xtype:"textfield",fieldLabel:"TIPO_DOCUMENTO",labelClsExtra:"cbaLabel",itemId:"nomeDocPers",reference:"nomeDocPers",margin:"3 0 0 0",readOnly:!0,flex:2}]},{xtype:"textfield",fieldLabel:"DESCRIZIONE_AGG",labelClsExtra:"cbaLabel",
itemId:"descAggDocPers",reference:"descAggDocPers",margin:"0 10 0 10"},{xtype:"checkboxfield",boxLabel:"PORTALE_DOCPERS_MODIFICA_MAIL",itemId:"modificaMail",reference:"modificaMail",inputValue:"T",uncheckedValue:"F",margin:"5 0 0 10"},{xtype:"fieldset",margin:"0 10 0 10",padding:5,layout:{align:"stretch",type:"hbox"},items:[{xtype:"container",itemId:"fieldSetCorpo",reference:"fieldSetCorpo",layout:{align:"stretch",type:"vbox"},margin:"0 10 0 0",items:[{xtype:"textfield",fieldLabel:"PORTALE_DOCPERS_OGGETTO_MAIL",
labelClsExtra:"cbaLabel",itemId:"oggettoDocPers",reference:"oggettoDocPers",disabled:!0},{xtype:"textarea",height:150,itemId:"corpoMail",reference:"corpoMail",fieldLabel:"",name:"note",disabled:!0,width:500}]},{xtype:"label",html:"Legenda tag riconosciuti:<br><br>_dataPubblicazione_<br>_ragSocEnte_<br>_nomeAccount_<br>_tipoDocumento_",width:190}]},{xtype:"container",margin:"5 0 5 0",layout:{align:"center",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",itemId:"btnConferma",reference:"btnConferma",
width:80,scale:"large",text:"CONFERMA",listeners:{click:{fn:this.onButtonSiClick,scope:this}}},{xtype:"button",itemId:"btnAnnulla",reference:"btnAnnulla",width:80,margin:"0 0 0 20",scale:"large",text:"ANNULLA",listeners:{click:{fn:this.onButtonNoClick,scope:this}}},{xtype:"tbfill"}]}]}]});this.callParent(arguments)}});function getTipiServizioListaAttesa(){return"R,G,A,S,M,D"}function isTipoServAmb(b){return"M"==b}
function DO_calcolaSaldo(b,c,d,f,g,h){b.setFieldLabel("Saldo al "+FormattaData(f,"d/m/Y"));b.setValue(Ext.util.Format.number(0,"0.00,")+" "+Ext.util.Format.currencySign);if(0==c)return!1;Ext.Ajax.request({method:"GET",url:g?"/cba/osp/den/ws/gen/gestione/saldo":"/cba/osp/co/ws/general/gestione/saldo",params:{idRicovero:c,dataLimite:f,idCassa:d},success:function(c){c=Ext.JSON.decode(c.responseText);c.success?(b.setValue(Ext.util.Format.number(c.data,"0.00,")+" "+Ext.util.Format.currencySign),h&&h(c.data)):
msgShowError("",c.message)}})}function apriDenaro(b){Ext.apply(b,{paramsCerca:CBA.moduli.modulo46.paramsCerca});CBA.parametriGenerali.produzione?loadScript("modulo46-min.js",function(){eseguiModulo(46,"btnDOGestione",b)}):eseguiModulo(46,"btnDOGestione",b)}function insertNewPagante(b){Ext.create("winCBA",{name:"GeneraliOSP.fascicoloNoApp.view.CreaAnagrafica",titolo:"CREA_ANAGRAFICA_PAGANTE",dimensione:1,configItem:b}).show()}
function checkInsertNewPagante(b,c,d){var f=b.indResidenza.dataDecorrenza?new Date(b.indResidenza.dataDecorrenza):new Date,g=currRicovero.dataDal,h={ragSoc:Ext.isDefined(b.cognome)?b.cognome+" "+b.nome:b.nominativo,tipoContabilita:d.tipoContabilitaAbilitata,codOspite:b.codOspite},k={ragioneSociale:b.nominativo,indirizzo:c,citta:b.indResidenza.desComune,provincia:b.indResidenza.provincia,cap:b.indResidenza.cap,nazione:b.indResidenza.nazione,dataIndirizzo:f>g?g:f,personContabili:d};Ext.isDefined(b.codiceFiscale)&&
!Ext.isEmpty(b.codiceFiscale)?(Ext.apply(h,{codFisc:b.codiceFiscale}),Ext.apply(k,{codiceFiscale:b.codiceFiscale}),Ext.apply(k,{cognome:b.cognome}),Ext.apply(k,{nome:b.nome}),Ext.apply(k,{sesso:b.sesso}),Ext.apply(k,{dataNascita:b.dataNascita}),Ext.apply(k,{comuneNascita:b.comuneNascita}),Ext.apply(k,{nazioneNascita:b.nazioneNascita})):Ext.apply(h,{desCitta:Ext.isDefined(b.indResidenza.desComune)?b.indResidenza.desComune:"",nazioneCodFisc:Ext.isDefined(b.indResidenza.nazione)?b.indResidenza.nazione:
""});Ext.isDefined(b.fromPersRif)&&b.fromPersRif&&(delete b.fromPersRif,Ext.apply(k,{comune:b.indResidenza.comune}));var l="0";Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/general/anfocl/checkForInsert",params:h,success:function(c){var d="",g=Ext.JSON.decode(c.responseText);g.success?null==g.data?Ext.Msg.confirm(traduci("CREA_ANAGRAFICA_PAGANTE"),traduci("MSG_CREARE_ANAGRAFICA_PAGANTE_PER_UTENTE"),function(b){"yes"==b&&insertNewPagante(k)}):(2==g.data.tipoAnagrafica?d=null==g.data.codiceFiscale?
traduci("MSG_PAGANTE_PRESENTE_RAGSOC",[g.data.ragsoc]):traduci("MSG_PAGANTE_PRESENTE_CODFISC",[g.data.ragsoc,g.data.codiceFiscale]):3==g.data.tipoAnagrafica&&(d=traduci("MSG_PAGANTE_PRESENTE_CODFISC",[g.data.ragsoc,g.data.codiceFiscale])),c=Ext.Msg.confirm(traduci("CREA_ANAGRAFICA_PAGANTE"),d,function(c){if("yes"==c)if("1"==l){Ext.apply(k,{dataIndirizzo:f});c={tipoContabilita:k.personContabili.tipoContabilitaAbilitata};var d;d=4==k.personContabili.tipoContabilitaAbilitata||5==k.personContabili.tipoContabilitaAbilitata?
k.comune?k.comune:b.indResidenza.comune:k.citta;var h=Ext.isEmpty(k.codiceFiscale)?null:ControllaCF(k.codiceFiscale,k);Ext.Ajax.request({method:"POST",url:"/cba/gen/ws/general/anfocl/update",jsonData:{id:g.data.codfocl,ragioneSociale:k.ragioneSociale,codiceFiscale:k.codiceFiscale,indirizzo:k.indirizzo,citta:d,provincia:k.provincia,cap:k.cap,dataIndirizzo:k.dataIndirizzo,nazione:k.nazione,personaFisica:h?"T":null,pfCognome:h?k.cognome:null,pfNome:h?k.nome:null,pfSesso:h?k.sesso:null,pfDataNascita:h?
k.dataNascita:null,pfComuneNascita:h?k.comuneNascita:null,pfNazioneNascita:h?k.nazioneNascita:null},params:c,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?msgShow(traduci("MSG_SALVATAGGIO_DATI"),"Anagrafica pagante aggiornata correttamente"):b.message&&msgShowError("",b.message[0].testo)}})}else"2"==l&&insertNewPagante(k)}),c.down("radiogroup")||c.add({xtype:"radiogroup",itemid:"RdgAggNuovo",defaults:{margin:"-15 0 5 115"},items:[{boxLabel:"Aggiorna",name:"tipoAnagrafica",inputValue:"1",
checked:!0},{boxLabel:"Nuovo",name:"tipoAnagrafica",inputValue:"2"}]}),c.on("hide",function(b){var c=b.down("radiogroup");l=c.getValue().tipoAnagrafica;b.remove(c)},this,{single:!0})):msgShowError("",g.message)}})}
function getEnumRispBySchedaDomanda(b,c){var d;switch(b.trim()+","+c){case "A,1":d="MOTIVO_DIMISSIONE";break;case "A,2":d="RISPOSTE_SWESTERNI";break;case "A,3":d="UNITA_ORGANIZZATIVA";break;case "A,8":d="RELIGIONE";break;case "B,10":d="GRADO_PARENTELA";break;case "E,1":d="CLASSIFICAZIONE_RETTA";break;case "E,2":d="CLASSIFICAZIONE_RETTA_DESCR";break;case "E,3":d="CLASSIFICAZIONE_INT";break;case "E,5":d="CLASSIFICAZIONE_REG";break;case "H,2":d="MOTIVO_ASSENZA";break;case "H,3":d="MOTIVO_ASSENZA_CSS";
break;case "H,4":d="CRITERIO_QUOTE";break;case "I,1":d="TIPO_PENSIONE";break;case "L,1":d="SUPPLEMENTO";break;case "L,2":d="SCONTO";break;case "L,3":d="SUPPLEMENTO_DESCR";break;case "L,4":d="SCONTO_DESCR";break;case "L,5":d="VOCI_FREQUENTI";break;case "L,6":d="ADDEBITI_ACCREDITI";break;case "L,7":d="CICLO_SCOLASTICO";break;case "M,1":d="SPECIALIZZAZIONE_MEDICO";break;case "S,1":d="TIPO_FLUSSO_REGIONALE";break;case "V,3":d="STATO_CIVILE";break;case "V,4":d="GRADO_ISTRUZIONE";break;case "V,5":d="PROFESSIONE";
break;case "V,12":d="TIPO_ESENZIONE";break;case "V,21":d="TIPO_PROVENIENZA";break;case "V,100":d="TIPO_DOCUMENTO";break;case "V,101":d="MODALITA_CONTATTO";break;case "V,102":d="MOTIVO_INGRESSO";break;case "V,103":d="INIZIATIVA_RICHIESTA";break;case "V,104":d="TIPO_RICOVERO";break;case "V,105":d="TIPO_IMPEGNATIVA";break;case "V,106":d="TIPO_RICETTA";break;case "V,107":d="TIPO_STATOAMBULATORIALE";break;case "V,108":d="POSIZIONE_TICKET";break;case "V,109":d="ONERE_DEGENZA";break;case "V,110":d="REGIME_RICOVERO";
break;case "V,111":d="CLASSE_PRIORITARIA";break;case "V,112":d="CONVENZIONE_COMMERCIALE";break;default:d=""}return d}
function LA_preparaDatiPassaggio(b,c){var d=c.cmpToEnable,f=[],g,h=-1,k=!1;Ext.each(b,function(b){-1==f.indexOf(b.data.codOspite)&&(b.data.regoleRaccordi&&("N"==b.data.regoleRaccordi[0].operazioneNuovo?b.data.idTipCartella=9999:b.data.idTipCartella||(k=!0)),f.push(b.data.codOspite));h=b.data.idRegole_Serv});if(0==f.length)return Messaggio("ATTENZIONE",traduci("NESSUN_UTENTE_SELEZIONATO")+"!","OK","WARNING"),!1;if(k)return Messaggio("ATTENZIONE",traduci("COMPILARE_REGOLARACCORDO")+"!","OK","WARNING"),
!1;d&&d.setDisabled(!0);var l=[];Ext.each(f,function(c){g={codOspite:c,chiudiRegoleAttive:null,chiudiServiziAttivi:null,datiPassaggio:[]};Ext.each(b,function(b){if(b.data.codOspite==g.codOspite){g.nominativo=b.data.nominativo;var c={idRegola:b.data.idRegola,codOspite:b.data.codOspite,idRicovero:b.data.idRicovero,idProvenienza:b.data.idProvenienza,idServizioReg:b.data.idServizioReg,idRegole_Serv:b.data.idRegole_Serv,dataIngresso:b.data.dataIngresso,desServizio:b.data.desServizioReg,nominativo:b.data.nominativo,
idRegolaRaccordo:b.data.idRegolaRaccordo?b.data.idRegolaRaccordo:null,idProfilo:b.data.idTipCartella?b.data.idTipCartella:null,dataRichiesta:b.data.dataDom,dataRicezioneRichiesta:b.data.dataRicezioneRichiesta,idRespRicovero:b.data.idRespRicovero,tipoProvenienzaCU:b.data.tipoProvenienzaCU,motivoIngressoCU:b.data.motivoIngressoCU,iniziativaRichiestaCU:b.data.iniziativaRichiestaCU,tipoRicoveroCU:b.data.tipoRicoveroCU,regimeRicoveroCU:b.data.regimeRicoveroCU,classePrioritaCU:b.data.classePrioritaCU,onereDegenzaCU:b.data.onereDegenzaCU,
diagnosiIngresso:b.data.diagnosiIngresso,diagnosiICD9:b.data.diagnosiICD9,ggPrognosi:b.data.ggPrognosi,medicoInviante:b.data.medicoInviante};b.data.listaSedi&&Ext.apply(c,{listaSedi:b.data.listaSedi});if(b.data.cntSediRep&&0<b.data.cntSediRep.length){var d=[];d.push({idStanzeBooking:b.data.cntSediRep[0].idStanzeBooking});Ext.apply(c,{listaSedi:d})}g.datiPassaggio.push(c)}h==b.data.idRegole_Serv&&l.push(g)})});return l}
function LA_elaboraPassaggio(b,c,d){var f=d.me,g=d.cmpToEnable;c||(c=0);var h=c==b.length-1;Ext.Ajax.request({method:"POST",async:!1,url:"/cba/osp/la/ws/listaAttesa/passaggio/passa",jsonData:b[c],success:function(k){var l=Ext.JSON.decode(k.responseText);if(l.success)if(1==l.data.chiudiRegoleAttive)Messaggio("CONFERMA","Risultano esservi una o pi domande attive per l'utente "+l.data.nominativo+" non incluse nei dati selezionati per il passaggio; si desidera impostarle in automatico come ritirate?",
"YESNO","QUESTION",null,function(){b[c].chiudiRegoleAttive=!0;LA_elaboraPassaggio(b,c,d)},function(){b[c].chiudiRegoleAttive=!1;LA_elaboraPassaggio(b,c,d)});else if(1==l.data.chiudiServiziAttivi)Messaggio("CONFERMA","Risultano esservi uno o pi servizi (residenziali e/o semiresidenziali) attivi per l'utente "+l.data.nominativo+"; si desidera impostarli come chiusi in automatico?","YESNO","QUESTION",null,function(){b[c].chiudiServiziAttivi=!0;LA_elaboraPassaggio(b,c,d)},function(){b[c].chiudiServiziAttivi=
!1;LA_elaboraPassaggio(b,c,d)});else if(1==l.data.chiudiSediReparti){var n=[];Ext.each(l.data.datiPassaggio,function(b){var c;Ext.each(b.listaSedi,function(d){c={codOspite:b.codOspite,nominativo:l.data.nominativo,desServizio:b.desServizio,desSede:d.desSede,idSede:d.sede,desReparto:d.desReparto,idReparto:d.reparto,desStanza:d.desStanza,idStanza:d.stanza,progressivo:d.progressivo,listaSedi:b.listaSedi};n.push(c)})});k={codOspite:l.data.codOspite,nominativo:l.data.nominativo,listaServizi:n};Ext.create("winCBA",
{permesso:"S",name:"LA.passaggio.view.PasSedeRep",titolo:traduci("TITOLO_SEDEREP")+l.data.nominativo,dimensione:3,configItem:{permesso:"S",personContabili:f.cbaConfig.personContabili,items:k,callbackEsci:function(f,g){if(f&&0<f.length)for(var h=0;h<b[c].datiPassaggio.length;h++)b[c].datiPassaggio[h].listaSedi=[{sede:f[h].data.idSede,reparto:f[h].data.idReparto,stanza:f[h].data.idStanza,progressivo:f[h].data.progressivo}];b[c].chiudiSediReparti=!0;LA_elaboraPassaggio(b,c,d)}}}).show()}else h?(g&&g.setDisabled(!1),
f.fineElaborazione=!0,d.callback&&d.callback()):LA_elaboraPassaggio(b,c+1,d);else g&&g.setDisabled(!1),msgShowError("",l.message)}})}
Ext.define("GeneraliOSP.store.Albero",{extend:"Ext.data.TreeStore",fields:[{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"children"},{name:"idServizio"},{name:"idRisposta"},{name:"checked"},{name:"percentuale"},{name:"codStruttura"},{name:"idImporto"},{name:"importo1"},{name:"importo2"},{name:"importoIsDirty",defaultValue:!1}],autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:"/cba/osp/co/ws/genOsp/general/tree",urlGen:"/ws/genOsp/general/tree",reader:{type:"json",messageProperty:"message",
rootProperty:"children"}},sorters:[{property:"text",direction:"ASC"}],autoDestroy:!0});Ext.define("GeneraliOSP.store.CboxRicoveri",{extend:"Generali.data.StoreCodiceValore",constructor:function(b){b=b||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/genOsp/ricoveri/cbox"}},b)])},autoDestroy:!0});
Ext.define("GeneraliOSP.store.EnteIvaFina",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:"/cba/gen/ws/general/entivafin/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.store.FattListaPaganti",{extend:"Ext.data.Store",constructor:function(b){b=b||{};this.callParent([Ext.apply({storeId:"FattListaPaganti",proxy:{type:"ajax",url:"/cba/gen/ws/general/anfocl/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},fields:[{name:"codice"},{name:"valore"},{name:"extra"}]},b)])}});
Ext.define("GeneraliOSP.store.ForzaParamContabili",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore",convert:function(b,c){return traduci(b)}}],data:[["0","APPLY_PAR_CONTAB_0"],["1","APPLY_PAR_CONTAB_1"],["2","APPLY_PAR_CONTAB_2"],["3","APPLY_PAR_CONTAB_3"]],autoLoad:!0,autoDestroy:!0});
Ext.define("GeneraliOSP.store.ListaRicoveri",{extend:"Generali.data.StoreJson",fields:[{mapping:"idRicovero",name:"idRicovero"},{mapping:"codOspite",name:"codOspite"},{mapping:"motivoDimissione",name:"motivoDimissione"},{mapping:"descrDimissione",name:"descrDimissione"},{mapping:"desMotivoDimissione",name:"desMotivoDimissione"},{mapping:"dataDal",name:"dataDal",type:"date"},{mapping:"dataAl",name:"dataAl",type:"date"},{mapping:"fascicoloRif",name:"fascicoloRif"},{mapping:"fascicoloRifFormatted",name:"fascicoloRifFormatted"},
{mapping:"idServizio",name:"idServizio"},{mapping:"servizio",name:"servizio"},{name:"codiceRid"},{name:"codBiancheria"},{name:"idProvenienza"},{mapping:"servizio.descrizione",name:"desServizio"}],proxy:{urlGen:"/ws/genOsp/ricoveri/search",api:{read:".",create:".",update:"."},extraParams:{codospite:"",dataDal:null,dataAl:null}},autoDestroy:!0});
Ext.define("GeneraliOSP.store.ListaStanze",{extend:"Generali.data.StoreJson",fields:[{name:"idSede"},{name:"idReparto"},{name:"idStanza"},{name:"desSede"},{name:"desReparto"},{name:"desStanza"},{name:"numeroStanza"},{name:"stanzaAdibita"},{name:"desStanzaExtended",convert:function(b,c){return c.get("desSede")+"/"+c.get("desReparto")+"/"+c.get("desStanza")}}],proxy:{url:"/cba/gen/ws/general/anagStanze/getListaStanze"}});
Ext.define("GeneraliOSP.store.MotivoAssenzaRegole",{extend:"Ext.data.Store",fields:[],proxy:{type:"ajax",method:"GET",url:getUrlGen()+"/ws/genOsp/risposte/assenze/cbox",api:{read:getUrlGen()+"/ws/genOsp/risposte/assenze/cbox"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliOSP.store.RisposteSmall",{extend:"Generali.data.StoreJson",fields:[{name:"risposta"},{name:"descrizione"},{name:"stato"},{name:"idServizio"},{name:"desServizio"},{name:"tipoServizio"},{name:"codStruttura"},{name:"classReg"}],proxy:{urlGen:"/ws/genOsp/risp/srcForServices",urlUpdate:"updSmall",api:{create:".",update:".",destroy:"."}},groupField:"desServizio",autoDestroy:!0});
Ext.define("GeneraliOSP.store.Ritenuta",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore"}],data:[["F","Nessuna"],["T",traduci("RITENUTA05_DESC")],["4",traduci("RITENUTA4_DESC")]],autoLoad:!0,autoDestroy:!0});
Ext.define("GeneraliOSP.store.SedeReparto",{extend:"Ext.data.TreeStore",fields:[{name:"text",convert:function(b,c){return 0===c.get("nodeID")?traduci("SEDI_REPARTI"):b}},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"children"},{name:"idSede"},{name:"idReparto"},{name:"nodeID"},{name:"checked"}],autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:"/cba/gen/ws/general/tree/sederep",reader:{type:"json",messageProperty:"message",rootProperty:"children"}},autoDestroy:!0});
Ext.define("GeneraliOSP.store.TipiPaganti",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore"}],data:[["P","PRIVATI"],["E","ENTI"],["C","COMUNI"],["A","ALTRO"]],autoDestroy:!0});Ext.define("GeneraliOSP.store.TipoFlusso",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/fr/tipflusso/cbox"},autoDestroy:!0});Ext.define("GeneraliOSP.store.TipoServizio",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/servizi/search"},autoDestroy:!0});
Ext.define("GeneraliOSP.store.TipoServizioByOrg",{extend:"GeneraliOSP.store.TipoServizio",groupField:"extra",autoDestroy:!0});
Ext.define("GeneraliOSP.store.TipoServizioRegole",{extend:"Generali.data.StoreCodiceValore",fields:[{name:"regione",convert:function(b,c){var d=c.get("extra").split(",")[0];return d?d:null}},{name:"tipoServizio",convert:function(b,c){var d=c.get("extra").split(",")[1];return d?d:null}},{name:"tipoFlusso",convert:function(b,c){var d=c.get("extra").split(",")[2];return d?d:null}},{name:"sigla",convert:function(b,c){var d=c.get("extra").split(",")[3];return d?d:null}}],proxy:{urlGen:"/ws/genOsp/servizi/regole/search"},
autoDestroy:!0});Ext.define("GeneraliOSP.store.TipoSoggetto",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore",convert:function(b,c){return traduci(b)}}],data:[["T","TIPO_SOGGETTO1"],["U","TIPO_SOGGETTO2"],["C","TIPO_SOGGETTO3"],["S","TIPO_SOGGETTO4"]],autoDestroy:!0});
Ext.define("GeneraliOSP.store.UscitaDim",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",urlGen:"/ws/genOsp/prszn/mtvexit/dimiss",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("GeneraliOSP.store.UscitaTemp",{extend:"Generali.data.StoreCodiceValore",proxy:{urlGen:"/ws/genOsp/prszn/mtvexit/usctemp"},autoDestroy:!0});
Ext.define("GeneraliOSP.store.gruppiClass",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore"}],data:[["R","RSA"],["I","IDR"],["D","RSD"],["K","RSH"],["C","CDI"],["E","CDD"],["S","HOS"],["V","SV"],["X","CSS"]],autoDestroy:!0});
Ext.define("GeneraliOSP.store.ricoveriCollegabili",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"},{name:"valoreDesc",convert:function(b,c){return FormattaData(c.data.extra)+" - "+c.data.valore}}],proxy:{type:"ajax",url:getUrlGen()+"/ws/genOsp/ricoveriCollegabili/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});