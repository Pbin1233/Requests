var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]};var _destructuring=[].push.apply([],[].concat($jscomp.arrayFromIterable([])));var StdEconomato=function(){return StdSipcar.call(this)||this};$jscomp.inherits(StdEconomato,StdSipcar);StdEconomato.importJscompArrayIterate=function(){return[].concat($jscomp.arrayFromIterable([1,2,3]),[4])};StdEconomato.isGreaterThanZero=function(a){a=this.parseFloat(a,2);return 0<a};
StdEconomato.getEsercizioContabileById=function(a){this.isValidID(a)||(a=0);return new Promise(function(b,c){Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/general/esercizioCont/get",params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b(a.data):c(a.message)}})})};
StdEconomato.getEcoPassword=function(a){var b=Ext.create("Generali.gestPwdNew.store.UtentiPersEconomato");return new Promise(function(c,d){b.load({params:{codUtente:a},callback:function(a,b,h){if(h){var e;Ext.isEmpty(a)||(e=a[0]);c(e)}else d(b.getError())}})})};
StdEconomato.initComponentiEco=function(a){inizioAttesa();Ext.require(["GeneraliEC.componenti.CdcGrid","GeneraliEC.componenti.PannelloBottoniRichieste","GeneraliEC.componenti.SMArticoli"],function(){StdEconomato.getEcoPassword(CBA.parametriGenerali.codUtente).then(function(a){a&&a.getData()&&Ext.apply(CBA.parametriGenerali,{pwdEconomato:a.getData()});StdEconomato.startModuloEconomato()})["catch"](function(a){msgShowError("",a)});fineAttesa()})};
StdEconomato.startModuloEconomato=function(){59===CBA.moduli.moduloAttivo?StdEconomato.apriCalendario():60===CBA.moduli.moduloAttivo&&StdEconomato.selMacroArea()};StdEconomato.sortNumProtocollo=function(a,b){var c=this.getId().split("-sorter")[0],d=/[^a-zA-Z]/g,e=/[^0-9]/g;if(a.get(c)&&b.get(c))return a=a.get(c).toString(),b=b.get(c).toString(),c=a.replace(d,""),d=b.replace(d,""),c===d?(d=parseInt(a.replace(e,""),10),e=parseInt(b.replace(e,""),10),d===e?0:d>e?1:-1):c>d?1:-1};
StdEconomato.sortFormattaData=function(a,b){var c=this.getId().split("-sorter")[0],d=/[^a-zA-Z]/g;if(a.get(c)&&b.get(c)){a=a.get(c).toString();b=b.get(c).toString();var c=a.replace(d,""),d=b.replace(d,""),e=Ext.Date.parse(a,"d/m/Y"),g=Ext.Date.parse(b,"d/m/Y");return e&&g?e>g?1:-1:c>d?1:-1}};StdEconomato.sortDesArticolo=function(a,b){if(a.get("desArticolo")&&b.get("desArticolo")&&(a=a.get("desArticolo").toUpperCase(),b=b.get("desArticolo").toUpperCase(),a&&b))return a>b?1:-1};
StdEconomato.sortDescrizioneCodice=function(a,b){if(a.get("descrizioneCodice")&&b.get("descrizioneCodice")&&(a=a.get("descrizioneCodice").toUpperCase(),b=b.get("descrizioneCodice").toUpperCase(),a&&b))return a>b?1:-1};StdEconomato.getTipoRichiestaFromModulo=function(a){var b;switch(a){case 58:b=1;break;case 62:b=2;break;case 59:b=3}return b};StdEconomato.getDescrTipoRichiesta=function(a){var b;switch(a){case 1:b=traduci("MAGAZZINO");break;case 2:b=traduci("FARMACIA");break;case 3:b=traduci("MANUTENZIONE")}return b};
StdEconomato.getDecrStatoRichiesta=function(a){var b;switch(a){case "T":b=traduci("TEMPORANEA");break;case "D":b=traduci("DA_CONVALIDARE");break;case "C":b=traduci("CONVALIDATA");break;case "E":b=traduci("EVASA");break;case "P":b=traduci("PARZ_EVASA");break;case "I":b=traduci("INEVASA");break;case "A":b=traduci("RIC_ANNULLATA");break;case "R":b=traduci("PROPOSTA")}return b};
StdEconomato.getDecrStatoDettaglio=function(a){switch(a){case 1:case "P":a=traduci("PARZ_EVASO");break;case 2:case "E":a=traduci("EVASO");break;default:a=traduci("INEVASO")}return a};StdEconomato.gestioneAbilitata=function(a){var b=CBA.moduli["modulo"+a].installato;if(b){var c=CBA.parametriGenerali.pwdEconomato;c||(c={});switch(a){case 58:b="T"==c.rcMagazzino;break;case 59:b="T"==c.rcServizioManutenzione;break;case 62:b="T"==c.rcFarmacia}}return b};
StdEconomato.selMacroArea=function(){var a=[];[58,59,62].forEach(function(b){StdEconomato.gestioneAbilitata(b)&&a.push(b)});if(0<a.length)if(1===a.length){var b=StdEconomato.getTipoRichiestaFromModulo(a[0]);Ext.apply(CBA.moduli.modulo60,{tipoRichiesta:b})}else Ext.create("winCBA",{titolo:'<span style="color:white">'+traduci("TIPO_RICHIESTA").toUpperCase()+"</span>",maximizable:!1,closable:!0,larghezzaWin:500,name:Ext.create("CbaUtils.componenti.all.CbaMultipleChoice",{style:{border:"0px!important",
"border-radius":"25px",padding:"5px 5px 0px 0px"},layout:"column",cbaConfig:{esclusivo:!0,itemsCfg:[{html:traduci("MAGAZZINO"),style:"text-align: center",inputValue:1,isFormField:!0,width:150},{html:traduci("FARMACIA"),style:"text-align: center",inputValue:2,isFormField:!0,width:150},{html:traduci("MANUTENZIONE"),style:"text-align: center",itemId:"cmcManutenzione",inputValue:3,isFormField:!0,width:150}]},listeners:{afterrender:function(a,b){a.query("checkbox").forEach(function(a){1==a.inputValue&&
a.up().setVisible(StdEconomato.gestioneAbilitata(58));2==a.inputValue&&a.up().setVisible(StdEconomato.gestioneAbilitata(62));3==a.inputValue&&a.up().setVisible(StdEconomato.gestioneAbilitata(59))})},choicechange:function(b,d,e){d=+d;if(e=trovaButtonMenu("btnRCNuovaRichiesta")){e=e.up("toolbar");var c=[];e.setScrollable(!0);a.forEach(function(a){a=StdEconomato.getTipoRichiestaFromModulo(a);c.push([a,StdEconomato.getDescrTipoRichiesta(a)])});e.insert(e.items.length-1,Ext.create("Ext.form.field.ComboBox",
{displayField:"valore",valueField:"codice",editable:!1,minChars:0,margin:"0 20 0 0",store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"codice"},{name:"valore"}],data:c,autoLoad:!0,autoDestroy:!0}),listeners:{afterrender:function(a,b){a.getStore().sort("codice");a.setValue(d)},change:function(a,b){if(!b)return!1;var c=Sipcar.app.getController("Menu").getCardApplicativo().queryById("tbdettab60"),d=c?c.getTabBar():null;if(d&&d.items&&0<d.items.getCount()){var e=function(a,b){a&&a.items&&!Ext.isEmpty(a.items)&&
(a.items.forEach(function(a){a.card&&(a.card.events.beforeclose.clearListeners(),a.card.close())}),0!=a.getCount()?e(a,b):b&&b())};Messaggio("ATTENZIONE","MSG_CAMBIO_TIPO_RICHIESTA","YESNO","WARNING",!1,function(){e(d.items,function(){StdEconomato.changeTipoRichiesta(b)})})}else StdEconomato.changeTipoRichiesta(b)}}}))}var h=b.up("window");h.selezione=!0;setTimeout(function(){return h.close()},100)}}}),closable:!1,listeners:{beforeclose:function(a,b){if(a.selezione)delete a.selezione;else a.onAfter("close",
function(a,b){var c=Sipcar.app.getMenuController().getTabApplicativi().queryById("tab60");c&&c.closable&&c.close()},a,{single:!0})}}}).show()};StdEconomato.changeTipoRichiesta=function(a){Ext.apply(CBA.moduli.modulo60,{tipoRichiesta:a});a=3!==a;var b=this.isUtenteConvalidatore(),c=trovaButtonMenu("btnRCGestioneCatalogo"),d=trovaButtonMenu("btnRCRichiesteStandard"),e=trovaButtonMenu("btnRCConvalidaRichieste");c&&c.setVisible(a&&b);d&&d.setVisible(a);e&&e.setVisible(b)};
StdEconomato.isUtenteConvalidatore=function(){var a="T"===CBA.parametriGenerali.amministratore,b=!1;CBA.parametriGenerali.pwdEconomato&&(b="T"===CBA.parametriGenerali.pwdEconomato.rcConvalidatore);return a||b};StdEconomato.inserisciBottoni=function(a,b,c,d){a.defaults=Ext.apply({},{margin:"1 1 1 1"},a.defaults);c?(void 0==d&&(d="end"),a.layout={type:"column",pack:d,align:"middle"}):a.layout={type:"vbox",align:"center"};a.border=0;a.add(b)};
StdEconomato.getTipoMagFar=function(a){var b;switch(a){case 1:b="M";break;case 2:b="F"}return b};
StdEconomato.controller_abilitaBottoni=function(a){var b=!0,c=!0;a.permesso||(a.permesso="S");"S"==a.permesso&&(b=a.getForm().isDirty(),c=!b);var d=a.boxBottoni.queryById("btnNuovo"),e=a.boxBottoni.queryById("btnElimina"),g=a.boxBottoni.queryById("btnAnnulla"),h=a.boxBottoni.queryById("btnConferma"),k=a.boxBottoni.queryById("btnInviaRichiesta"),l=a.boxBottoni.queryById("btnInviaProposta"),m=a.boxBottoni.queryById("btnTemporanea"),n=a.boxBottoni.queryById("btnProposta"),q=a.boxBottoni.queryById("btnStampa")||
a.boxBottoni.queryById("BtnStampa");a=a.boxBottoni.queryById("btnEsci");d&&d.setDisabled(b);e&&!e.nonDisabilitare&&e.setDisabled(b);g&&g.setDisabled(c);h&&h.setDisabled(c);k&&k.setDisabled(c);l&&l.setDisabled(c);m&&m.setDisabled(c);n&&n.setDisabled(c);q&&q.setDisabled(b);a&&a.setDisabled(b)};
StdEconomato.getStatoRichiestaExtend=function(a){var b=traduci("RICHIESTA")+" "+StdEconomato.getDecrStatoRichiesta(a.get("stato"));"A"==a.get("stato")&&(a.get("dataAnnullamento")&&(b+=(""==b?"":"<BR>")+traduci("DATA")+": "+FormattaData(a.get("dataAnnullamento"),"d/m/Y")),a.get("nomeUtenteAnnullatore")&&(b+=(""==b?"":"<BR>")+traduci("UTENTE")+": "+a.get("nomeUtenteAnnullatore")),a.get("noteAnnullatore")&&(b+=(""==b?"":"<BR>")+traduci("NOTE")+": "+a.get("noteAnnullatore")));return b};
StdEconomato.apriCalendario=function(){setTimeout(function(){var a=trovaButtonMenu("btnMNCalendario");a&&a.handler(a)},100)};StdEconomato.getIdStatoDefault=function(a){var b=this;return new Promise(function(c,d){var e={};b.isValidID(a)&&Ext.apply(e,{idOrganizzione:a});Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/tabelle/base/statoIntervento/default",params:e,success:function(a){a=Ext.JSON.decode(a.responseText);a.success?c(a.data):d(a.message)}})})};
StdEconomato.getLastUbicazioneArticolo=function(a){return this.isValidID(a)?new Promise(function(b,c){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/cespiti/articoli/ubicazione/lastUbicazione",params:{idArticoloCespite:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b(a.data):c(a.message)}})}):Promise.resolve(!1)};StdEconomato.isServizioManutenzione=function(){return 59===CBA.moduli.moduloAttivo};StdEconomato.isRichiesteReparto=function(){return 60===CBA.moduli.moduloAttivo};
StdEconomato.getTipoArticoloSM=function(a){var b=a.getSelection();a=0;b&&(b=b.get("extra"))&&(a=b.split(",")[0]);return a?a:0};
StdEconomato.permesso=function(a,b,c){if(!c)return"S";var d="",e=getUrlGen()+"/ws/depositi/permesso";Ext.Ajax.request({method:"GET",async:!1,params:{idOrganizzazione:a.cbaConfig.idOrganizzazione,codEnte:CBA.parametriGenerali.codEntePwd,codUtente:CBA.parametriGenerali.codUtente,tipoId:b,id:c},url:e,success:function(a){a=Ext.JSON.decode(a.responseText);a.success?d=a.data:msgShowError("","Success.failure")}});return d};
StdEconomato.gestionePermessiDeposito=function(a,b,c){var d=!1;"L"==c||"N"==c?d=!0:"S"==c&&(d=!1);a&&(Ext.each(a.query("textfield"),function(a){a.setDisabled(d)}),Ext.each(a.query("checkboxfield"),function(a){a.setDisabled(d)}),Ext.each(a.query("button"),function(a){a.setDisabled(d)}));if(b){a=b.queryById("btnNuovo");c=b.queryById("btnElimina");var e=b.queryById("btnAnnulla"),g=b.queryById("btnConferma");b=b.queryById("btnStampa")||b.queryById("BtnStampa");a.setDisabled(!1);c.setDisabled(d);e.setDisabled(!0);
g.setDisabled(!0);b&&b.setDisabled(!1)}return d};StdEconomato.solaLettura=function(a,b){Ext.each(a.getRefItems(),function(a){Ext.isDefined(a.setReadOnly)?a.setReadOnly("S"!=b):Ext.isDefined(a.setDisabled)&&a.setDisabled("S"!=b)});Ext.isDefined(a.setReadOnly)&&a.setReadOnly(!1);Ext.isDefined(a.setDisabled)&&a.setDisabled(!1)};
StdEconomato.doAutoSelect=function(a){var b=a.store,c=a.picker,d=0,e;c&&a.autoSelect&&0<b.getCount()&&(a.autoSelectLast&&(a=c.getSelectionModel(),(e=a.lastSelected?trovaRecord(b,"codice",a.lastSelected.get("codice")):void 0)&&a.selected.length&&-1<b.indexOf(e)&&(d=e)),c.getNavigationModel().setPosition(d))};
StdEconomato.apriVideata=function(a,b,c,d,e){c=void 0===c?{}:c;d=void 0===d?1300:d;e=void 0===e?800:e;c&&Ext.apply(c,{caricamentoEsterno:!0});Ext.create("winCBA",{name:a,titolo:traduci(b),dimensione:3,larghezzaWin:d,altezzaWin:e,configItem:c,closable:!0}).show()};StdEconomato.getTipoBudget=function(a){var b=null;switch(a){case "R":b=0;break;case "C":b=1;break;case "P":b=2}return b};
StdEconomato.quadroBudget=function(a,b,c,d,e,g,h){var k={};Ext.apply(k,{hideInizioAttesa:!0,tipoQuadro:this.getTipoBudget(a),idEsercizio:e});this.isValidID(d)&&Ext.apply(k,{idConto:d});this.isValidID(c)&&Ext.apply(k,{cda:c});this.isValidID(b)&&Ext.apply(k,{idResponsabile:b});Ext.Ajax.request({method:"GET",url:"/cba/eco/of/ws/ordini/quadroBudget",params:k,async:h,success:g})};
StdEconomato.promiseQuadroBudget=function(a,b,c,d,e){a=void 0===a?"C":a;var g=this;return new Promise(function(h,k){g.quadroBudget(a,b,c,d,e,function(a){a=Ext.JSON.decode(a.responseText);a.success?h(a.data):k(a.message)},!0)})};StdEconomato.apssInviato=function(a){var b=!1;a&&(b=0==StdEconomato.parseFloat(a));return b};StdEconomato.formatStringCigCup=function(a,b){var c;Ext.isEmpty(a)||(c=traduci("CIG")+": "+a);if(!Ext.isEmpty(b)){var d=traduci("CUP")+": "+b;c=Ext.isEmpty(c)?d:c+(" / "+d)}return c};
StdEconomato.filtraStore=function(a,b,c){a.clearFilter();c&&0<c.trim().length&&a.filter(function(a){return(a=a.get(b))&&0<=a.toUpperCase().indexOf(c.toUpperCase())})};StdEconomato.idAtcX=function(a,b){var c;Ext.isEmpty(a)||a.trim().length>=b&&(c=a.substring(0,b));return c};CBA.StdEconomato=new StdEconomato;
Ext.define("GeneraliEC.associaCdaAnalitica.controller.AlberoAbbinaCda",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TreeRep",selector:a+"#TreeRep"},{ref:"BtnNuovo",selector:a+"#BtnNuovo"},{ref:"BtnElimina",selector:a+"#BtnElimina"},{ref:"BtnConferma",selector:a+"#BtnConferma"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"CntEconomica",selector:a+"#CntEconomica"},{ref:"CBAnno",selector:a+"#CBAnno"},{ref:"Anno",
selector:a+"#Anno"},{ref:"TxtCerca",selector:a+"#TxtCerca"},{ref:"LblSelettore",selector:a+"#LblSelettore"}]);this.control(a+"#TreeRep",{beforeitemcontextmenu:this.beforeitemcontextmenuTreeRep,beforeedit:this.beforeeditTreeRep,edit:this.editTreeRep,canceledit:this.canceleditTreeRep,validateedit:this.validateeditTreeRep,select:this.selectTreeRep,itemdblclick:this.itemdblclickTreeRep});this.control(a+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(a+"#BtnElimina",{click:this.clickBtnElimina});
this.control(a+"#BtnConferma",{click:this.clickBtnConferma});this.control(a+"#BtnEsci",{click:this.clickBtnEsci});this.control(a+"#CBAnno",{change:this.changeCBAnno});this.control(a+"#Anno",{change:this.changeAnnoEconomicaOld});this.control(a+"#TxtCerca",{change:Ext.Function.createBuffered(this.cercaTree,500,this)})},cercaTree:function(a){var b=this.getTreeRep(),c=b.getStore(),d=[];this.getLblSelettore().setVisible(!1);c.clearFilter();Ext.isEmpty(a.getValue())?(c.each(function(a){a.set("cls","")}),
b.getSelectionModel().hasSelection()?b.ensureVisible(b.getSelectionModel().getSelection()[0]):b.getSelectionModel().select(0)):(c.each(function(b){if(b.isLeaf()){var c=!1,e=b.get("text");e&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase())&&(c=!0);c?(b.set("cls","cba-dirty-record"),d.push(b)):b.set("cls","")}}),this.filtraPadri(c,d),this.getLblSelettore().setVisible(1<d.length),Ext.isEmpty(d)?b.getSelectionModel().select(0):(b.ensureVisible(d[0]),this.getLblSelettore().setText(traduci("NUM_ELEMENTI_TROVATI",
[d.length]))));a.focus()},filtraPadri:function(a,b){a.filter(function(a){for(var c=!1,e=0,g=b.length;e<g;e++)if(a.contains(b[e])){c=!0;break}else if(a.isLeaf()&&(c=a===b[e]))break;return c})},changeAnnoEconomicaOld:function(a,b){this.aggiornaStore()},changeCBAnno:function(a,b){b?(this.aggiornaStore(),this.lastIdEserc=b):this.getCBAnno().setValue(this.lastIdEserc)},itemdblclickTreeRep:function(a,b,c,d,e,g){b.get("leaf")&&(1==this.cbaConfig.soloIntermedi?"I"==b.get("tipoCda")?this.selezionaEsci():msgShowError("",
"MSG_INTERMEDI"):this.selezionaEsci())},selezionaEsci:function(){var a=this.getBtnConferma();if(a.isVisible()){if(this.cbaConfig.afterConferma){var b=[];Ext.each(this.getTreeRep().getSelectionModel().getSelection(),function(a){a.get("leaf")&&b.push(a)});Ext.isEmpty(b)||(b.annoCda=this.getCBAnno().getValue(),this.cbaConfig.afterConferma(b))}a.up("window").close()}},clickBtnConferma:function(a){this.selezionaEsci()},clickBtnEsci:function(a){a.up("window").close()},beforeselectTreeRep:function(a,b){if(0!=
b.get("cdaCode")){var c=0,d=this.getTreeRep().up("#CntPrincipale").down("#GridCdaAnalitica").controller.getGridCdaAnniSucc().getStore();d.each(function(a){c+=a.get("percentualeRipartizione")});if(0<d.getCount())if(c&&100==c)this.getTreeRep().setDisabled(!1);else return Messaggio("ATTENZIONE","SOMMA_PERCENTUALE_INFERIORE_100","OK","WARNING"),this.getTreeRep().setDisabled(!0),!1;return 0<b.get("cdaCode")}},selectTreeRep:function(a,b){var c=this.getTreeRep().up("#CntPrincipale").down("#GridCdaAnalitica").controller;
c.idCdc=b.get("cdaCode");c.recordAlbero=b;c.idEsercizio=this.getCBAnno().getValue();c.getGridCdaAnalitica().setDisabled(!b.get("leaf"));0!=b.get("cdaCode")?c.aggiornaStore():svuotaStore(c.getGridCdaAnalitica().getStore())},beforeeditTreeRep:function(a,b,c){if(!0===a.editing||0===b.record.get("cdaCode"))return!1;this.abilitaBottoniGrid(!1)},editTreeRep:function(a,b,c){var d=b.record.getData();c=a.getEditor().getForm();c.controller=this;c.store=this.getTreeRep().getStore();d={id:d.cdaCode?d.cdaCode:
null,idOrganizzazione:getIdOrg(),idEsercizio:this.idEsercizioDefault,idPadre:d.idPadre,descrizione:d.text};controller_salvaRecord(c,d,!1,!1)?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditTreeRep:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("cdaCode"))},validateeditTreeRep:function(a,b,c){return msgShow("",[])},beforeitemcontextmenuTreeRep:function(a,b,c,d,e,g){return getPopupMenuTree(e,a)},aggiornaStore:function(a){var b=this.getTreeRep(),c=b.getStore(),
d={idOrganizzazione:this.cbaConfig.idOrganizzazione,idEsercizio:this.getCBAnno().getValue()};c.load({params:d,callback:function(c,d,h){h?(c=b.getRootNode().findChild("cdaCode",a,!0),b.expandAll(),c?(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0),b.getSelectionModel().select([c])):(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0))):msgShowError("",d.getError())}})},clickBtnNuovo:function(){var a=this.getTreeRep();a.getStore();var b=a.getSelectionModel().getLastSelected();
b.set("leaf",!1);b.appendChild({leaf:!0,idPadre:b.get("cdaCode")});a.getView().refresh();b.expand();a.getPlugin().startEdit(b.lastChild,0);a.up("#CntPrincipale").down("#FormCda").controller.getFsTipoCda().setDisabled(!1);this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},clickBtnElimina:function(){var a=this,b=a.getTreeRep(),c=b.getSelectionModel().getSelection()[0],d=c.hasChildNodes()?"MSG_ELIMINA_NODO":"";controller_eliminaRecord(b.getStore(),
{id:c?c.get("cdaCode"):""},function(){a.aggiornaStore()},!1,d)},onLaunch:function(){var a=this,b=a.getTreeRep();a.cbaConfig.idOrganizzazione||(a.cbaConfig.idOrganizzazione=getIdOrg());b.controller=a;var c=a.getCBAnno(),d=Ext.create("Generali.esercizioCont.store.cboxEsercizioCont");c.bindStore(d);c.setVisible(!0);c.setDisabled(a.cbaConfig.onlyTree);d.load({params:{idOrganizzazione:a.cbaConfig.idOrganizzazione},callback:function(b,d,h){getIdEsercizioDefaultByIdOrg(a.cbaConfig.idOrganizzazione,function(b){a.idEsercizioDefault=
b;a.cbaConfig.idAnnoVideata?c.setValue(a.cbaConfig.idAnnoVideata):c.setValue(a.idEsercizioDefault)})}});a.cbaConfig.multiSelezione&&(b.selModel.selectionMode="MULTI")},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.associaCdaAnalitica.controller.CdaAnalitica",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"GridCdaAnalitica",selector:a.selContainer+"#GridCdaAnalitica"},{ref:"BtnNuovo",selector:a.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:a.selContainer+"#BtnElimina"},{ref:"TxtCerca",selector:a.selContainer+"#TxtCerca"},{ref:"IdCda",selector:a.selContainer+"#IdCda"},{ref:"TxtDesCda",
selector:a.selContainer+"#TxtDesCda"}]);a.control(a.selContainer+"#GridCdaAnalitica",{beforeedit:a.beforeeditGridCdaAnalitica,edit:a.editGridCdaAnalitica,canceledit:a.canceleditGridCdaAnalitica,validateedit:a.validateeditGridCdaAnalitica});a.control(a.selContainer+"#BtnNuovo",{click:a.clickBtnNuovo});a.control(a.selContainer+"#BtnElimina",{click:a.clickBtnElimina});a.control(a.selContainer+"#TxtDesCda",{afterrender:a.afterrenderTxt});a.control(a.selContainer+"#TxtCerca",{change:Ext.Function.createBuffered(function(b){var c=
a.getGridCdaAnalitica(),d=c.getStore();d.clearFilter();d.filter(function(a){var c=!1;(a=a.get("desCda"))&&0<=a.toUpperCase().indexOf(b.getValue().toUpperCase())&&(c=!0);return c});b.focus();0<d.getCount()&&c.getSelectionModel().select(0);b.focus()},100,a)})},afterrenderTxt:function(a,b){var c=this;creaToolTip(a.getId(),"MODIFICA_CDA_DBLCLICK","");a.getEl().on("dblclick",function(){c.gestioneCda(a)})},clickBtnNuovo:function(a){a=this.getGridCdaAnalitica();var b=a.getStore(),c=100;this.getGridCdaAnalitica().up("#CntPrincipale").down("#TreeRep");
IsolaCmp(this.getGridCdaAnalitica(),!0);0<b.getCount()&&b.each(function(a){c-=a.data.percentuale});var d={id:null,idCdc:this.idCdc,percentuale:c};b.clearFilter();b.insert(0,d);a.getSelectionModel().select(0);a.getPlugin().startEdit(0,0);this.abilitaBottoniGrid(!1)},clickBtnElimina:function(a){var b=this;a=b.getGridCdaAnalitica();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore();b.getGridCdaAnalitica().up("#CntPrincipale").down("#TreeRep").getStore().load({params:{idOrganizzazione:b.cbaConfig.idOrganizzazione,
idEsercizio:b.cbaConfig.idAnnoVideata}})})},beforeeditGridCdaAnalitica:function(a,b,c){var d=this;c=b.record.get("id");if(!0===a.editing)return!1;(!c||0>=c)&&setTimeout(function(){d.gestioneCda(b.column.field)},100);d.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},editGridCdaAnalitica:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();Ext.apply(c,{cda:this.idCda?
this.idCda:c.cda});controller_salvaRecord(d,c,!1,{forzaRegistrazione:"F"})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridCdaAnalitica:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridCdaAnalitica:function(a,b,c){this.getGridCdaAnalitica().up("#CntPrincipale").down("#TreeRep").getStore().load({params:{idOrganizzazione:this.cbaConfig.idOrganizzazione,idEsercizio:this.cbaConfig.idAnnoVideata}});return msgShow("",[])},aggiornaStore:function(a){var b=
this,c=b.getGridCdaAnalitica(),d=c.getStore();b.getGridCdaAnalitica().up("#CntPrincipale").down("#TreeRep");d.load({params:{idCdc:b.idCdc},callback:function(e,g,h){if(h){if(0<e.length){for(h=g=0;h<e.length;h++)g+=e[h].get("percentuale");b.getBtnNuovo().setDisabled(g&&100==g);IsolaCmp(b.getGridCdaAnalitica(),g&&100>g)}else b.getBtnNuovo().setDisabled(!1),IsolaCmp(b.getGridCdaAnalitica(),!1);e=null;a&&(e=trovaRecord(d,"id",a));c.getSelectionModel().deselectAll();c.getSelectionModel().select(e?[e]:0)}else msgShowError("",
g.getError())}})},svuotaStore:function(){},gestioneCda:function(a){var b=this;a=b.getIdCda();var c=b.getTxtDesCda();Ext.create("winCBA",{name:"Generali.cda.view.PnlGestCda",titolo:"CENTRI_DI_ATTIVITA",dimensione:2,configItem:{onlyTree:!0,tipoContabilita:4,currentCda:a.getValue(),idAnnoVideata:b.idEsercizio,afterConferma:function(a){b.idCda=a[0].get("cdaCode");c.setValue(a[0].get("descrizioneCodice"))}},listeners:{}}).show()},validateeditPlgGriglia:function(a,b,c){var d=0;this.getCmp().getStore().each(function(a){d=
a.data.id!=b.record.data.id?d+a.data.percentuale:d+b.newValues.percentuale});if(100<d)return Messaggio("ATTENZIONE","La somma percentuale supera il 100%","OK","WARNING"),!1},onLaunch:function(){this.getGridCdaAnalitica().controller=this;this.getGridCdaAnalitica().plugins[0].on("validateedit",this.validateeditPlgGriglia)},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.associaCdaAnalitica.controller.PnlAbbinaCda",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"}])},onLaunch:function(){var a={};a.idOrganizzazione=getIdOrg();a.onlyTree=this.cbaConfig.onlyTree;a.idAnnoVideata=this.cbaConfig.idAnnoVideata;var b=Ext.create("GeneraliEC.associaCdaAnalitica.view.AlberoAbbinaCda",{cbaConfig:a});
this.getCntPrincipale().add({xtype:"panel",layout:"fit",flex:1.5,items:b});this.getCntPrincipale().add({xtype:"panel",layout:"fit",flex:1,items:Ext.create("GeneraliEC.associaCdaAnalitica.view.CdaAnalitica",{cbaConfig:{controllerAlbero:b.down("#TreeRep").controller,controlleCntPrincipale:this,idAnnoVideata:a.idAnnoVideata,idOrganizzazione:a.idOrganizzazione}})});this.controllerAlbero=b.down("#TreeRep").controller}});
Ext.define("GeneraliEC.associaCdaAnalitica.store.CdaAnalitica",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCdc"},{name:"cda"},{name:"percentuale"},{name:"desCdc"},{name:"desCda"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/collCda/list",api:{read:getUrlGen()+"/ws/collCda/list",create:getUrlGen()+"/ws/collCda/insert",update:getUrlGen()+"/ws/collCda/update",destroy:getUrlGen()+"/ws/collCda/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.associaCdaAnalitica.view.AlberoAbbinaCda",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"treepanel",flex:1,width:300,border:0,viewConfig:{loadMask:!1,getRowClass:function(a,b,c,d){if(a.get("leaf"))switch(a.get("cdaAbbinati")){case "F":return"cba-dirty-record";case "T":return"cba-new-record"}}},itemId:"TreeRep",reference:"TreeRep",store:Ext.create("GeneraliEC.cda.store.AlberoCda"),
useArrows:!0,rootVisible:!1,columns:[{xtype:"treecolumn",dataIndex:"text",text:"CENTRI_DI_CONSUMO",autoScroll:!0,flex:1,editor:{xtype:"textfield",allowBlank:!1}}],dockedItems:[{xtype:"toolbar",dock:"top",padding:"5 10 5 10",items:[{xtype:"container",itemId:"CntEconomica",reference:"CntEconomica",layout:{type:"hbox",align:"middle"},items:[{xtype:"combobox",width:300,labelWidth:50,fieldLabel:"ESERCIZIO",editable:!1,itemId:"CBAnno",reference:"CBAnno",displayField:"valore",queryMode:"local",valueField:"codice",
hidden:!0},{xtype:"anno",itemId:"Anno",reference:"Anno",hidden:!0}]},{xtype:"tbfill"},{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo",hidden:!0},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina",hidden:!0},{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:"SELEZIONA_ESCI",hidden:!0},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esciGriglia",
text:"ESCI",hidden:!0},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",emptyText:"CERCA",width:200,maxLength:50,enforceMaxLength:!0}]},{xtype:"label",border:0,dock:"top",hidden:!0,itemId:"LblSelettore",reference:"LblSelettore"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.associaCdaAnalitica.view.CdaAnalitica",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},title:"CDA_ANALITICA",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",height:200,itemId:"GridCdaAnalitica",reference:"GridCdaAnalitica",title:"CDA_ANALITICA",store:Ext.create("GeneraliEC.associaCdaAnalitica.store.CdaAnalitica"),flex:1,columns:[{xtype:"numbercolumn",name:"id",hidden:!0},{xtype:"gridcolumn",text:"Prova",dataIndex:"cda",
editor:{xtype:"numberfield",itemId:"IdCda",reference:"IdCda"},hidden:!0},{xtype:"gridcolumn",text:"CDA_COLLEGATO",flex:1,dataIndex:"desCda",editor:{xtype:"textfield",editable:!1,allowBlank:!1,itemId:"TxtDesCda",reference:"TxtDesCda"}},{xtype:"gridcolumn",text:"PERCENTUALE",width:75,dataIndex:"percentuale",renderer:cell_renderer_importo,editor:{xtype:"numberfield",allowBlank:!1,minValue:1,maxValue:100}}],viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,
errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"ELIMINA"},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",maxWidth:300,flex:1,fieldLabel:"",emptyText:"CERCA",maxLength:50,enforceMaxLength:!0}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.associaCdaAnalitica.view.PnlAbbinaCda",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntPrincipale",reference:"CntPrincipale",layout:{align:"stretch",type:"hbox"}}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.associaCdcDepositi.controller.AlberoCdcDepositi",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TreeRep",selector:a+"#TreeRep"},{ref:"BtnConferma",selector:a+"#BtnConferma"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"CBAnno",selector:a+"#CBAnno"},{ref:"Anno",selector:a+"#Anno"},{ref:"TxtCerca",selector:a+"#TxtCerca"},{ref:"LblSelettore",selector:a+"#LblSelettore"}]);this.control(a+"#TreeRep",
{beforeitemcontextmenu:this.beforeitemcontextmenuTreeRep,beforeedit:this.beforeeditTreeRep,edit:this.editTreeRep,canceledit:this.canceleditTreeRep,validateedit:this.validateeditTreeRep,select:this.selectTreeRep,checkchange:this.checkchangeTreeRep,beforeitemcontextmenu:this.beforeitemcontextmenuTreeRep});this.control(a+"#BtnConferma",{click:this.clickBtnConferma});this.control(a+"#BtnEsci",{click:this.clickBtnEsci});this.control(a+"#CBAnno",{change:this.changeCBAnno});this.control(a+"#Anno",{change:this.changeAnnoEconomicaOld});
this.control(a+"#TxtCerca",{change:Ext.Function.createBuffered(this.cercaTree,500,this)})},checkchangeTreeRep:function(a,b,c){treeCheckchange(a,b,c)},beforeitemcontextmenuTreeRep:function(a,b,c,d,e,g){return getPopupMenuTree(e,a)},cercaTree:function(a){var b=this.getTreeRep(),c=b.getStore(),d=[];this.getLblSelettore().setVisible(!1);c.clearFilter();Ext.isEmpty(a.getValue())?(c.each(function(a){a.set("cls","")}),b.getSelectionModel().hasSelection()?b.ensureVisible(b.getSelectionModel().getSelection()[0]):
b.getSelectionModel().select(0)):(c.each(function(b){if(b.isLeaf()){var c=!1,e=b.get("text");e&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase())&&(c=!0);c?(b.set("cls","cba-dirty-record"),d.push(b)):b.set("cls","")}}),this.filtraPadri(c,d),this.getLblSelettore().setVisible(1<d.length),Ext.isEmpty(d)?b.getSelectionModel().select(0):(b.ensureVisible(d[0]),this.getLblSelettore().setText(traduci("NUM_ELEMENTI_TROVATI",[d.length]))));a.focus()},filtraPadri:function(a,b){a.filter(function(a){for(var c=
!1,e=0,g=b.length;e<g;e++)if(a.contains(b[e])){c=!0;break}else if(a.isLeaf()&&(c=a===b[e]))break;return c})},changeAnnoEconomicaOld:function(a,b){this.aggiornaStore()},changeCBAnno:function(a,b){b?(this.aggiornaStore(),this.lastIdEserc=b):this.getCBAnno().setValue(this.lastIdEserc)},clickBtnConferma:function(a){var b=this;a=b.getTreeRep();var c=[],d={};Ext.each(a.getChecked(),function(a){a.isLeaf()&&c.push(a.get("id"))});(c=c.toString())&&Ext.apply(d,{elencoCdc:c});Ext.Ajax.request({method:"GET",
url:getUrlGen()+"/ws/collCentriConsumo/associaCdcDeposito",params:{idOrganizzazione:b.cbaConfig.idOrganizzazione,idEsercizio:b.getCBAnno().getValue(),idDeposito:b.cbaConfig.idDeposito,elencoCdc:c},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(msgShow("",a.message),b.aggiornaStore()):msgShowError("",a.message)}})},clickBtnEsci:function(a){a.up("window").close()},selectTreeRep:function(a,b){if(!this.cbaConfig.onlyTree){var c=this.getTreeRep().up("#CntPrincipale").down("#FormCda").controller;
c.idTestata=b.get("cdaCode");c.getFormCda().setDisabled(0==b.get("cdaCode"));c.hasChild=b.hasChildNodes();0!=b.get("cdaCode")?c.aggiornaStore():clearForm(c.getFormCda())}},beforeeditTreeRep:function(a,b,c){if(!0===a.editing||0===b.record.get("cdaCode"))return!1;this.abilitaBottoniGrid(!1)},editTreeRep:function(a,b,c){var d=b.record.getData();c=a.getEditor().getForm();c.controller=this;c.store=this.getTreeRep().getStore();d={id:d.cdaCode?d.cdaCode:null,idOrganizzazione:getIdOrg(),idEsercizio:this.idEsercizioDefault,
idPadre:d.idPadre,descrizione:d.text};controller_salvaRecord(c,d,!1,!1)?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditTreeRep:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("cdaCode"))},validateeditTreeRep:function(a,b,c){return msgShow("",[])},beforeitemcontextmenuTreeRep:function(a,b,c,d,e,g){return getPopupMenuTree(e,a)},aggiornaStore:function(a){var b=this.getTreeRep(),c=b.getStore(),d={idOrganizzazione:this.cbaConfig.idOrganizzazione,idEsercizio:this.getCBAnno().getValue(),
idDeposito:this.cbaConfig.idDeposito};c.load({params:d,callback:function(c,d,h){h?(c=b.getRootNode().findChild("cdaCode",a,!0),b.expandAll(),c?(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0),b.getSelectionModel().select([c])):(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0))):msgShowError("",d.getError())}})},abilitaBottoniGrid:function(a){},onLaunch:function(){var a=this,b=a.getTreeRep();a.cbaConfig.idOrganizzazione||(a.cbaConfig.idOrganizzazione=getIdOrg());
b.controller=a;var c=a.getCBAnno(),d=Ext.create("Generali.esercizioCont.store.cboxEsercizioCont");c.bindStore(d);c.setVisible(!0);c.setDisabled(a.cbaConfig.onlyTree);d.load({params:{idOrganizzazione:a.cbaConfig.idOrganizzazione},callback:function(b,d,h){getIdEsercizioDefaultByIdOrg(a.cbaConfig.idOrganizzazione,function(b){a.idEsercizioDefault=b;a.cbaConfig.idAnnoVideata?c.setValue(a.cbaConfig.idAnnoVideata):c.setValue(a.idEsercizioDefault)})}});a.cbaConfig.onlyTree&&(a.getBtnConferma().setVisible(!0),
a.getBtnEsci().setVisible(!0));a.cbaConfig.multiSelezione&&(b.selModel.selectionMode="MULTI")},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.associaCdcDepositi.model.AlberoCdcDepositi",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"cdaCode"},{name:"idOrganizzazione"},{name:"idPadre"},{name:"idVisibile"},{name:"idEsercizio"},{name:"descrizione"},{name:"children"},{name:"text",convert:function(a,b){return b.get("idVisibile")?b.get("idVisibile")+" . "+b.get("descrizione"):b.get("descrizione")}},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"descrizioneCodice"},{name:"checked"}]});
Ext.define("GeneraliEC.associaCdcDepositi.store.AlberoCdcDepositi",{extend:"Ext.data.TreeStore",model:"GeneraliEC.associaCdcDepositi.model.AlberoCdcDepositi",autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:getUrlGen()+"/ws/collCentriConsumo/tree",reader:{type:"json",messageProperty:"message",rootProperty:"children"},api:{}},autoDestroy:!0});
Ext.define("GeneraliEC.associaCdcDepositi.view.AlberoCdcDepositi",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"treepanel",flex:1,border:0,itemId:"TreeRep",reference:"TreeRep",store:Ext.create("GeneraliEC.associaCdcDepositi.store.AlberoCdcDepositi"),useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},columns:[{xtype:"treecolumn",dataIndex:"text",text:"CENTRI_DI_CONSUMO",flex:1}],dockedItems:[{xtype:"toolbar",
dock:"top",padding:"5 10 5 10",items:[{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"combobox",width:300,labelWidth:50,fieldLabel:"ESERCIZIO",editable:!1,itemId:"CBAnno",reference:"CBAnno",displayField:"valore",queryMode:"local",valueField:"codice",hidden:!0},{xtype:"anno",itemId:"Anno",reference:"Anno",hidden:!0}]},{xtype:"tbfill"},{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo",hidden:!0},{xtype:"button",itemId:"BtnElimina",
reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina",hidden:!0},{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:"CONFERMA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esciGriglia",text:"ESCI"},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",emptyText:"CERCA",width:300}]},{xtype:"label",border:0,dock:"top",hidden:!0,itemId:"LblSelettore",reference:"LblSelettore"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.base.controller.Descrizione",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"TxtTesto",selector:this.selContainer+"#TxtTesto"}]);this.control(this.selContainer+"#BtnElabora",{click:this.elaboraClick});this.control(this.selContainer+"#BtnEsci",{click:this.esciClick})},
elaboraClick:function(){var a=this.getBtnEsci(),b=this.getTxtTesto().getValue();this.cbaConfig.callbackScrivi&&this.cbaConfig.callbackScrivi(b);a.up("window").close()},esciClick:function(){var a=this.getBtnEsci();this.cbaConfig.callbackRiapriStore&&this.cbaConfig.callbackRiapriStore();a.up("window").close()},onLaunch:function(){this.getTxtTesto().setValue(this.cbaConfig.testo)},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.base.controller.GestCatalogoArticoli",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntDati",selector:this.selContainer+"#CntDati"}])},onLaunch:function(){var a=this.getCntDati();StdEconomato.isValidID(this.idOrganizzazione)||(this.idOrganizzazione=getIdOrg());var b=StdEconomato.isValidID(this.cbaConfig.codArticolo)?this.cbaConfig.codArticolo:0,b=Ext.create("GeneraliEC.catalogoArticoli.view.CatalogoArticoliTes",
{cbaConfig:{permesso:this.cbaConfig.permesso,idTestata:b,idOrganizzazione:this.idOrganizzazione,caricamentoEsterno:this.cbaConfig.caricamentoEsterno,mostraEsciGenerale:!0,richiesta:!0,callbackRiapriStore:this.cbaConfig.callbackRiapriStore}});this.controllerCatalogo=b.controller;a.add(b)},destroy:function(){delete this.controllerCatalogo;this.callParent()}});
Ext.define("GeneraliEC.base.controller.NuovaRichiesta",{extend:"Generali.standard.stampe.Controller",init:function(){this.selContainer="#"+this.containerId+" ";this.cbaConfig.configBtnStampa&&(Ext.applyIf(this.parametriStampa,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(this.parametriStampa.params,this.cbaConfig.configBtnStampa.params));this.addRef([{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"DataRichiesta",
selector:this.selContainer+"#DataRichiesta"},{ref:"CBReparto",selector:this.selContainer+"#CBReparto"},{ref:"TxOperatore",selector:this.selContainer+"#TxOperatore"},{ref:"CBPriorita",selector:this.selContainer+"#CBPriorita"}]);this.callParent(arguments)},stampa:function(){var a=this.controllerPrincipale.cbaConfig,b={};Ext.apply(b,{reportId:a.id,idAvanzamentoElaborazione:newIdElab(),idRichiesta:this.idTestata,tipoRichiesta:CBA.moduli.modulo60.tipoRichiesta});Ext.apply(this.parametriStampa,{url:getUrlGen()+
"/ws/reports/richieste",jsonData:a.jsonData,titolo:a.titolo,winElaborazione:a.winElaborazione});a=this.parametriStampa;Ext.apply(a.params,b);this.cbaConfig.configBtnStampa&&(Ext.applyIf(a,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(a.params,this.cbaConfig.configBtnStampa.params))},doPrint:function(a,b){StdEconomato.isValidID(this.idTestata)&&(this.stampa(),this.callParent([a,b]))},caricaStoreTestata:function(a,b){var c=this.getCBPriorita().getStore();c.getProxy().extraParams=
{idOrganizzazione:b,tipo:"R"};c.load()},svuotaDettagli:function(){this.articoli.svuotaStore()},aggiornaStore:function(a){var b=this;cntForm=b.getForm();form=cntForm.getForm();b.idTestata=StdEconomato.isValidID(a)?a:b.idTestata;b.nuovoInserimento=!StdEconomato.isValidID(b.idTestata);clearForm(cntForm);b.svuotaDettagli();StdEconomato.isValidID(b.idTestata)?b.storeTestata.load({params:{id:b.idTestata},callback:function(a,d,e){e?Ext.isEmpty(a)?b.setCampiSolaLettura(!0):(a=a[0],form.loadRecord(a),b.fireEvent("testataCaricata",
a)):msgShowError("",d.getError())}}):b.fireEvent("testataCaricata",null)},gestioneForm:function(a){a=void 0===a?{}:a;var b=this,c=b.getForm();c.permesso=b.cbaConfig.permesso;c.boxBottoni=b.getBoxBottoni();c.store=b.storeTestata;c.controller=b;a=Ext.create("GeneraliEC.componenti.PannelloBottoniRichieste",a);StdEconomato.inserisciBottoni(c.boxBottoni,a,!0,"start");c.addPlugin(new MasterDetailFormPlugin).on("TabOnLastField",function(a){return b.onLastFieldTab(a)},b)},setCampiSolaLettura:function(a){var b=
this.cbaConfig,c=this.getForm();this.readOnly=a||"L"===b.permesso;"L"!==b.permesso&&(a=(a=this.controllerPrincipale)?a.getPnlDettaglio():!1,containerSolaLettura(c,this.readOnly),a&&containerSolaLettura(a,this.readOnly),c.boxBottoni.queryById("btnElimina")&&c.boxBottoni.queryById("btnElimina").setDisabled(this.readOnly))},caricaRecord:function(a,b){var c=this;c.controllerPrincipale=b;c.idTestata=a?a.get("id"):0;c.statoRichiesta=a?a.get("stato"):"";if(a)c.storeTestata.on("load",function(a,b,g,h,k){c.statoRichiesta=
Ext.isEmpty(b)?"":b[0].get("stato");a="T"==c.statoRichiesta;"D"==c.statoRichiesta&&(a=StdEconomato.isUtenteConvalidatore());c.setCampiSolaLettura(!StdEconomato.isValidID(c.idTestata)||!a)});else c.setCampiSolaLettura(!0);c.aggiornaStore(c.idTestata)},destroy:function(){delete this.storeTestata;delete this.controllerPrincipale;this.callParent(arguments)}});
Ext.define("GeneraliEC.base.view.Descrizione",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,autoScroll:!0,flex:1,bodyPadding:5,layout:{align:"stretch",type:"hbox"},dockedItems:[{xtype:"toolbar",dock:"top",height:48,items:[{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-ok32",scale:"large",text:"CONFERMA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-annulla32",scale:"large",text:"ANNULLA"}]}],
items:[{xtype:"textarea",itemId:"TxtTesto",reference:"TxtTesto",flex:1,grow:!0,anchor:"100%"}]}]});this.callParent(arguments)}});Ext.define("GeneraliEC.base.view.GestCatalogoArticoli",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"CntDati",reference:"CntDati",layout:"fit"}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.controller.AllegatiArticoli",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridAllegati",selector:this.selContainer+"#GridAllegati"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"Data",selector:this.selContainer+"#Data"},{ref:"TxtDescrizione",selector:this.selContainer+"#TxtDescrizione"},{ref:"TxtFileName",
selector:this.selContainer+"#TxtFileName"},{ref:"CntAllegato",selector:this.selContainer+"#CntAllegato"},{ref:"CntAnteprima",selector:this.selContainer+"#CntAnteprima"},{ref:"FormAllegato",selector:this.selContainer+"#FormAllegato"},{ref:"AllegatoUpload",selector:this.selContainer+"#AllegatoUpload"},{ref:"BtnEliminaAllegato",selector:this.selContainer+"#BtnEliminaAllegato"},{ref:"BtnAllega",selector:this.selContainer+"#BtnAllega"}]);this.control(this.selContainer+"#BtnEliminaAllegato",{click:this.eliminaAllegato});
this.control(this.selContainer+"#AllegatoUpload",{change:this.onFilefieldChangeAllegatoUpload});this.control(this.selContainer+"#GridAllegati",{select:this.selectGridAllegati})},selectGridAllegati:function(a,b,c,d){a=this.getForm();clearForm(this.getForm());b&&(a.loadRecord(b),this.getAllegatoUpload().setVisible(b.get("id")),this.getBtnEliminaAllegato().setVisible(!Ext.isEmpty(b.get("fileName"))),this.creaAnteprima(b.get("idAllegato"),this.getCntAnteprima()))},verificaCampiForm:function(){var a=[];
this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{idCatalogo:this.cbaConfig.recordTestata.get("id")});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.getGridAllegati().getStore();b.controller=
a;StdEconomato.solaLettura(b,b.permesso);var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.aggiornaStore()},nuovo_callback:function(){a.getCntAnteprima().removeAll();a.getAllegatoUpload().setVisible(!1);a.getBtnEliminaAllegato().setVisible(!1);controller_nuovoRecord(b);a.getData().setValue(dataAttuale())},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||
controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});inserisciBottoni(b.boxBottoni,c);b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){var d=c.findField("id").getValue();(!d||0>=d)&&e&&validaForm(a.getForm());controller_abilitaBottoni(b);IsolaCmp(a.cbaConfig.controllerCatArtTes.getPnlAllegati(),e)})},aggiornaStore:function(a){var b=this,c=b.getGridAllegati(),
d=c.getStore();c.getSelectionModel().deselectAll();b.getCntAnteprima().removeAll();b.getAllegatoUpload().setVisible(!1);b.getBtnEliminaAllegato().setVisible(!1);(b.cbaConfig.recordTestata.get("id")||a)&&d.load({params:{idCatalogo:b.cbaConfig.recordTestata.get("id")},callback:function(e,g,h){if(h){if(Ext.isEmpty(e))clearForm(b.getForm());else if(a)var k=trovaRecord(d,"id",a);c.getSelectionModel().select(k?[k]:0)}else msgShowError("",g.getError())}})},formattaUrlBlob:function(a,b,c){var d=this.getCntAnteprima(),
e="pdf"==b?"application":"image";Ext.Ajax.request({method:"GET",binary:!0,url:a,success:function(g){var h=g.responseBytes;Ext.isEmpty(h)?(d.removeAll(),msgShowError("",h.message)):(g=new Blob([g.responseBytes],{type:e+"/"+b}),g=(window.URL||window.webkitURL).createObjectURL(g),h={},Ext.apply(h,{itemId:"iframePdf",reference:"iframePdf",html:'<a href="'+a+'" download="'+c+'" onclick="clickHref(this);">'+traduci("DOWNLOAD")+" "+c+'</a>\n\t\t\t\t\t\t\t<iframe id="pdf" width="100%" height="100%" src="'+
g+'"></iframe>'}),d.removeAll(),d.add(h))}})},creaAnteprima:function(a,b){if(!a)return!1;var c=this.getTxtFileName().getValue(),d=getUrlGen()+"/ws/catalogoAllegati/file/download?idAllegato="+a,e=getPathServer()+d,g={};if(Ext.isEmpty(c))b.removeAll();else{var h=c.split(".").pop(),k="icon-"+h;if("pdf"==h||-1!=Ext.Array.indexOf(getEstensioniImg(),h))if("pdf"==h){if(!(Ext.browser.is.IE||-1<Ext.browser.userAgent.indexOf("Edge"))&&1024<Ext.getBody().getViewSize().width)return this.formattaUrlBlob(d,h,c),
!1;g=creaItemDownload(k,e,c,c)}else Ext.apply(g,{xtype:"container",scrollable:!0,flex:1,items:[{html:'<a href="'+e+'" download="'+c+'" onclick="clickHref(this);">'+traduci("DOWNLOAD")+" "+c+"</a>"},{xtype:"image",listeners:{beforerender:function(a){setSrcImage(a,d)}}}]});else g=creaItemDownload(k,e,c,c);b.removeAll();b.add(g)}},eliminaAllegato:function(a){var b=this;a=b.getForm();var c=a.getForm().findField("id").getValue(),d=a.getForm().findField("idAllegato").getValue();Messaggio("ATTENZIONE","MSG_ELIMINA_ALLEGATO",
"YESNO","QUESTION",!1,function(){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/catalogoAllegati/file/delete?idAllegato="+d,success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b.aggiornaStore(c):msgShowError("",a.message)}})})},allegatoUpload:function(a,b){var c=this,d=c.getForm(),e=d.getForm().findField("id").getValue();c.getFormAllegato();var g=b.lastIndexOf("\\")||b.lastIndexOf("/"),d=d.getForm().findField("idAllegato").getValue();b=b.substring(g+1);if(""!==b){var g=a.fileInputEl.dom.files[0],
h=new FormData;h.append("file",g);Ext.Ajax.request({url:getUrlGen()+"/ws/catalogoAllegati/file/upload?idAllegato="+d,method:"POST",rawData:h,headers:{"Content-Type":null},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(msgShow("TRASFERIMENTO_FILE",a.message),c.aggiornaStore(e)):msgShowError("",a.message)}})}},onFilefieldChangeAllegatoUpload:function(a,b,c){this.allegatoUpload(a,b)},onLaunch:function(){var a=this.getGridAllegati();ImpostaUrl(this.getGridAllegati().getStore());a.controller=
this;this.gestioneForm();this.aggiornaStore()},destroy:function(){delete this.storeForm;this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.CatalogoArticoliTes",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CmcMagazzino",selector:this.selContainer+"#CmcMagazzino"},{ref:"CmcFarmacia",selector:this.selContainer+"#CmcFarmacia"},
{ref:"CBUniMisPrincipale",selector:this.selContainer+"#CBUniMisPrincipale"},{ref:"CBUniMisSomministra",selector:this.selContainer+"#CBUniMisSomministra"},{ref:"TabPaginatore",selector:this.selContainer+"#TabPaginatore"},{ref:"PnlInfoGen",selector:this.selContainer+"#PnlInfoGen"},{ref:"PnlDetArticolo",selector:this.selContainer+"#PnlDetArticolo"},{ref:"PnlFormule",selector:this.selContainer+"#PnlFormule"},{ref:"PnlListino",selector:this.selContainer+"#PnlListino"},{ref:"PnlFarmaco",selector:this.selContainer+
"#PnlFarmaco"},{ref:"PnlContabilita",selector:this.selContainer+"#PnlContabilita"},{ref:"PnlUbicazione",selector:this.selContainer+"#PnlUbicazione"},{ref:"PnlAllegati",selector:this.selContainer+"#PnlAllegati"},{ref:"TxDescrizione",selector:this.selContainer+"#TxDescrizione"},{ref:"LblGalenico",selector:this.selContainer+"#LblGalenico"},{ref:"PnlBugiardino",selector:this.selContainer+"#PnlBugiardino"},{ref:"CbxGalenico",selector:this.selContainer+"#CbxGalenico"},{ref:"CBUniMisPrincipale",selector:this.selContainer+
"#CBUniMisPrincipale"},{ref:"CBUniMisSomministra",selector:this.selContainer+"#CBUniMisSomministra"}]);this.control(this.selContainer+"#CmcMagazzino",{change:this.changeCmcMagazzino});this.control(this.selContainer+"#CmcFarmacia",{change:this.changeCmcFarmacia});this.control(this.selContainer+"#TabPaginatore",{tabchange:this.tabchangeTabPaginatore})},changeCmcMagazzino:function(){1==this.getCmcMagazzino().getValue()&&(this.getCmcFarmacia().setValue(!1),this.getCBUniMisSomministra().allowBlank=!0);
this.getCBUniMisSomministra().setVisible(0==this.getCmcMagazzino().getValue())},changeCmcFarmacia:function(){1==this.getCmcFarmacia().getValue()&&(this.getCmcMagazzino().setValue(!1),this.getCBUniMisSomministra().allowBlank=!1,this.getCBUniMisSomministra().validate());this.getCBUniMisSomministra().setVisible(1==this.getCmcFarmacia().getValue())},tabchangeTabPaginatore:function(a,b,c,d){a={};Ext.apply(a,{controllerCatArtTes:this,idOrganizzazione:this.cbaConfig.idOrganizzazione,recordTestata:this.getForm().getForm().getRecord(),
permesso:this.cbaConfig.permessoCatalogo});"PnlInfoGen"==b.itemId&&(this.getPnlInfoGen().removeAll(),this.getPnlInfoGen().add(Ext.create("GeneraliEC.catalogoArticoli.view.InfoGenerali",{cbaConfig:a})));"PnlDetArticolo"==b.itemId&&(this.getPnlDetArticolo().removeAll(),this.getPnlDetArticolo().add(Ext.create("GeneraliEC.catalogoArticoli.view.DettagliArticolo",{cbaConfig:a})));"PnlFormule"==b.itemId&&(this.getPnlFormule().removeAll(),this.getPnlFormule().add(Ext.create("GeneraliEC.catalogoArticoli.view.Formule",
{cbaConfig:a})));"PnlListino"==b.itemId&&(this.getPnlListino().removeAll(),this.getPnlListino().add(Ext.create("GeneraliEC.catalogoArticoli.view.Listino",{cbaConfig:a})));"PnlFarmaco"==b.itemId&&(this.getPnlFarmaco().removeAll(),this.getPnlFarmaco().add(Ext.create("GeneraliEC.catalogoArticoli.view.Farmaco",{cbaConfig:a})));"PnlContabilita"==b.itemId&&(this.getPnlContabilita().removeAll(),this.getPnlContabilita().add(Ext.create("GeneraliEC.catalogoArticoli.view.Contabilita",{cbaConfig:a})));"PnlUbicazione"==
b.itemId&&(this.getPnlUbicazione().removeAll(),this.getPnlUbicazione().add(Ext.create("GeneraliEC.catalogoArticoli.view.Ubicazione",{cbaConfig:a})));"PnlAllegati"==b.itemId&&(this.getPnlAllegati().removeAll(),this.getPnlAllegati().add(Ext.create("GeneraliEC.catalogoArticoli.view.AllegatiArticoli",{cbaConfig:a})))},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");0==this.getCmcMagazzino().getValue()&&0==this.getCmcFarmacia().getValue()&&msgAddError(a,
"SELEZIONARE_MAG_FAR");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues(),d="-9999"==c.id?!0:!1,e;1==c.magazzino&&(e="M");1==c.farmacia&&(e="F");Ext.isEmpty(c.magazzino)&&this.getCmcMagazzino().getValue()&&(e="M");Ext.isEmpty(c.farmacia)&&this.getCmcFarmacia().getValue()&&(e="F");delete c.farmacia;delete c.magazzino;Ext.apply(c,{idOrganizzazione:this.cbaConfig.idOrganizzazione,tipoArticolo:e});0==d?(e=this.getPnlInfoGen().down("form").getForm().getFieldValues(),
Ext.apply(c,{idAliquotaIva:e.idAliquotaIva,idGruppo:e.idGruppo,idCategoria:e.idCategoria,codBarre:e.codBarre,gestScadenza:getBoolValue(e.gestScadenza),gestLotto:getBoolValue(e.gestLotto),deteriorabile:getBoolValue(e.deteriorabile),note:e.note,galenico:getBoolValue(c.galenico)})):"F"==e?Ext.apply(c,{galenico:"T"}):Ext.apply(c,{galenico:"F"});if(b=controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"}))this.cbaConfig.controllerPnlCatalogoArticoli&&(c=this.cbaConfig.controllerPnlCatalogoArticoli.getCntRicerca().down("#GridRicerca"),
1==d?(c.getStore().insert(0,b),c.getStore().load(),c.getSelectionModel().select(0),IsolaCmp(this.getPnlInfoGen(),!0)):(this.cbaConfig.idTestata=b.id,d=trovaRecord(c.getStore(),"id",b.id),d.set(b),c.getSelectionModel().select(d))),a&&this.callbackEsci&&this.callbackEsci()},importaFarmacoDaPn:function(a){if(a){var b=this,c={},d="",d=49===CBA.moduli.moduloAttivo?"/cba/css/cs/ws/genCss/farmadati/prontuario/importaDaPn":getUrlGen()+"/ws/farmadati/prontuario/importaDaPn";Ext.apply(c,{aic:a.codProdotto,
idOrganizzazione:b.cbaConfig.idOrganizzazione});Ext.Ajax.request({method:"GET",url:d,params:c,success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.data;a.success?(inizioAttesa(),b.storeForm.load({params:{id:c},callback:function(a,d,e){e?Ext.isEmpty(a)||(d=b.cbaConfig.controllerPnlCatalogoArticoli.getCntRicerca().down("#GridRicerca"),e=d.getStore(),e.insert(0,{id:a[0].get("id"),descrizione:a[0].get("descrizione")}),a=trovaRecord(e,"id",c),d.getSelectionModel().select(a?[a]:0)):msgShowError("",
d.getError());fineAttesa()}})):msgShowError("",a.message)}})}},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;a.cbaConfig.permessoCatalogo=a.cbaConfig.permesso;StdEconomato.solaLettura(b,a.cbaConfig.permessoCatalogo);b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=Ext.create("GeneraliEC.catalogoArticoli.store.CatalogoArticoliTes");b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b);
a.getTabPaginatore().setDisabled(!1)},annulla_callback:function(){b.getForm().findField("id").getValue();a.aggiornaStore();a.getTabPaginatore().setDisabled(!1)},nuovo_callback:function(){controller_nuovoRecord(b);"M"===a.magFarOrd&&a.getCmcMagazzino().setValue(!0);"F"===a.magFarOrd&&a.getCmcFarmacia().setValue(!0);"O"===a.magFarOrd&&(a.getCmcMagazzino().setValue(!1),a.getCmcFarmacia().setValue(!1));a.getTxDescrizione().readOnly&&a.getTxDescrizione().setReadOnly(!1);a.getCBUniMisSomministra().readOnly&&
a.getCBUniMisSomministra().setReadOnly(!1);a.getTabPaginatore().setDisabled(!0);a.getLblGalenico().setVisible(!1);if(49===CBA.moduli.moduloAttivo){a.getCmcFarmacia().setValue(!0);var c=a.getTabPaginatore();Ext.each(c.items.items,function(b){(b=a["get"+b.config.itemId]())&&(b=b.down("form"))&&clearForm(b)})}},elimina_callback:function(){a.inserimentoDaTestata=!1;var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore();a.fireEvent("ClickRicerca")})},
verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){a.cbaConfig.callbackRiapriStore&&a.cbaConfig.callbackRiapriStore();a.getForm().up("window").close()},importa_callback:function(){Ext.create("winCBA",{name:"GeneraliEC.catalogoArticoli.view.Prontuario",titolo:traduci("CARICA_FARMACI"),altezzaWin:600,larghezzaWin:900,configItem:{idOrganizzazione:a.cbaConfig.idOrganizzazione,callbackImporta:Ext.bind(a.importaFarmacoDaPn,a)},maximizable:!1,closable:!0}).show()}}});
inserisciBottoni(b.boxBottoni,c);b.boxBottoni.queryById("btnNuovo").up().add({xtype:"button",itemId:"btnImporta",text:"Carica farmaci",margin:"0 0 1 0",cls:"cba-button-25",hidden:"M"===a.magFarOrd,handler:function(){c.cbaConfig.importa_callback&&c.cbaConfig.importa_callback()}});if(!a.cbaConfig.mostraEsciGenerale)b.boxBottoni.queryById("btnEsci").setVisible(a.cbaConfig.caricamentoEsterno);else if(60===CBA.moduli.moduloAttivo||a.cbaConfig.richiesta)b.boxBottoni.queryById("btnNuovo").setVisible(!1),
b.boxBottoni.queryById("btnElimina").setVisible(!1),b.boxBottoni.queryById("btnImporta").setVisible(!1);if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){49===CBA.moduli.moduloAttivo&&IsolaCmp(b,e);controller_abilitaBottoni(b);var d=b.boxBottoni.queryById("btnImporta");d&&d.isVisible()&&d.setDisabled(e);a.cbaConfig.controllerPnlCatalogoArticoli&&a.cbaConfig.controllerPnlCatalogoArticoli.getCntRicerca().setDisabled(e)});else b.boxBottoni.queryById("btnNuovo").setDisabled(!0),b.boxBottoni.queryById("btnElimina").setDisabled(!0),
b.boxBottoni.queryById("btnImporta").setDisabled(!0)},aggiornaStore:function(a){var b=this,c=b.getForm(),d=c.getForm(),e=c.store,g=a?a:b.cbaConfig.idTestata;if(!g)return clearForm(b.getForm()),b.getLblGalenico().setVisible(!1),!1;b.cbaConfig.permesso=StdEconomato.permesso(this,"A",g);StdEconomato.gestionePermessiDeposito(b.getForm(),b.getBoxBottoni(),b.cbaConfig.permesso);e.load({params:{idOrganizzazione:b.cbaConfig.idOrganizzazione,id:a?a:b.cbaConfig.idTestata},callback:function(a,e,g){if(g)if(Ext.isEmpty(a))clearForm(c);
else{"M"==a[0].get("tipoArticolo")?a[0].set("magazzino",!0):a[0].set("magazzino",!1);"F"==a[0].get("tipoArticolo")?a[0].set("farmacia",!0):a[0].set("farmacia",!1);var h=b.getPnlBugiardino();e=a[0].get("aic")?!0:!1;h.tab.setVisible(e);e&&(e="O"===b.magFarOrd?"/cba/eco/of/ws/farmaci/farmadati/bugy":"/cba/eco/far/ws/farmaci/farmadati/bugy",49===CBA.moduli.moduloAttivo&&(e="css/cs/ws/farmaci/farmadati/bugy"),Ext.Ajax.request({method:"GET",url:e,params:{aic:a[0].get("aic")},success:function(a){a=Ext.JSON.decode(a.responseText);
a.success&&!Ext.isEmpty(a.data.filePath)?h.setHtml('<iframe width="100%" height="100%" src="'+a.data.filePath+'"></iframe>'):h.setHtml('<div style="width: 100%; height: 100%; display: table; text-align: center;"><span style="vertical-align: middle; display: table-cell";">'+traduci("TERAPIE_NESSUN_FOGLIO")+"</span></div>")}}));d.loadRecord(a[0]);"M"==a[0].get("tipoArticolo")?(b.getPnlFarmaco().tab.hide(),b.getTxDescrizione().setReadOnly(!1)):(b.getPnlFarmaco().tab.show(),b.getTxDescrizione().setReadOnly("T"!=
a[0].get("galenico")),b.getCBUniMisSomministra().setReadOnly("T"!=a[0].get("galenico")),b.getCBUniMisSomministra().allowBlank="T"!=a[0].get("galenico"));b.getCBUniMisSomministra().setVisible(1==a[0].get("farmacia"));b.getLblGalenico().setVisible("T"==a[0].get("galenico"));c.isValid();a=b.getTabPaginatore();a.setActiveTab("PnlInfoGen");a.fireEvent("tabchange",a,a.getActiveTab())}else msgShowError("",e.getError())}})},onLaunch:function(){if(60!==CBA.moduli.moduloAttivo)this.on("ClickRicerca",function(){this.cbaConfig.controllerPnlCatalogoArticoli.getCntRicerca().down("#BtnCerca").fireEvent("click")});
this.magFarOrd="O";switch(CBA.moduli.moduloAttivo){case 58:this.magFarOrd="M";break;case 62:this.magFarOrd="F"}if(60===CBA.moduli.moduloAttivo)switch(CBA.moduli.modulo60.tipoRichiesta){case 1:this.magFarOrd="M";break;case 2:this.magFarOrd="F"}"M"===this.magFarOrd&&this.getCmcMagazzino().setValue(!0);"F"===this.magFarOrd&&this.getCmcFarmacia().setValue(!0);this.getCmcMagazzino().up("container").setVisible("O"===this.magFarOrd);this.getCmcFarmacia().up("container").setVisible("O"===this.magFarOrd);
49===CBA.moduli.moduloAttivo&&(this.getCmcMagazzino().up("container").setVisible(!1),this.getCmcFarmacia().setValue(!0));ImpostaUrl(this.getCBUniMisPrincipale().getStore());ImpostaUrl(this.getCBUniMisSomministra().getStore());this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.Contabilita",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"GridContabilita",selector:this.selContainer+"#GridContabilita"},{ref:"CBConto",selector:this.selContainer+"#CBConto"},{ref:"EdtDtInizio",
selector:this.selContainer+"#EdtDtInizio"}]);this.control(this.selContainer+"#EdtDtInizio",{change:this.changeEdtDtInizio});this.control(this.selContainer+"#GridContabilita",{select:this.selectGridContabilita})},changeEdtDtInizio:function(a,b,c,d){if(!b||!Ext.isDate(b))return!1;a=this.getCBConto().getStore();b=getIdEsercizioByDate(this.cbaConfig.idOrganizzazione,b);a.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione,idEsercizio:b};a.load()},selectGridContabilita:function(a,
b){var c=this;clearForm(c.getForm());c.getForm().loadRecord(b);var d=c.getCBConto().getStore(),e=getIdEsercizioByDate(c.cbaConfig.idOrganizzazione,b.data.dataInizioUtilizzo);d.getProxy().extraParams={idOrganizzazione:c.cbaConfig.idOrganizzazione,idEsercizio:e};d.load({callback:function(a,d,e){b.get("idConto")&&setCombo(c.getCBConto(),b.get("idConto"),b.get("desConto"),{descrizione:b.get("desConto")})}})},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");
return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{idCatalogo:this.cbaConfig.recordTestata.get("id")});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.getGridContabilita().getStore();b.controller=a;StdEconomato.solaLettura(b,b.permesso);var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){b.getForm().findField("id").getValue();a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);a.getEdtDtInizio().setValue(new Date);a.getGridContabilita().setDisabled(!0)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},
esci_callback:function(){a.getForm().up("window").close()}}});inserisciBottoni(b.boxBottoni,c);a.cbaConfig.mostraEsciGenerale||b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);a.getGridContabilita().setDisabled(e);IsolaCmp(a.cbaConfig.controllerCatArtTes.getPnlContabilita(),e)});a.cbaConfig.isWindow&&(b.boxBottoni.queryById("btnNuovo").hide(),b.boxBottoni.queryById("btnElimina").hide(),b.boxBottoni.queryById("btnEsci").setVisible(!0))},
aggiornaStore:function(a){var b=this,c=b.getForm(),d=c.getForm(),e=c.store;e.load({params:{idCatalogo:b.cbaConfig.recordTestata.get("id")},callback:function(g,h,k){k?Ext.isEmpty(g)?clearForm(c):(a||(a=d.findField("id").getValue()),g=trovaRecord(e,"id",a),h=b.getGridContabilita(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(g?[g]:0)):msgShowError("",h.getError())}})},onLaunch:function(){var a=this,b=a.getCBConto().getStore();ImpostaUrl(a.getGridContabilita().getStore());ImpostaUrl(a.getCBConto().getStore());
getIdEsercizioDefaultByIdOrg(a.cbaConfig.idOrganizzazione,function(c){b.getProxy().extraParams={idOrganizzazione:a.cbaConfig.idOrganizzazione,idEsercizio:c}});a.gestioneForm();a.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.CopiaArticolo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"BtnConferma",selector:this.selContainer+"#BtnConferma"},{ref:"CbxInfoGen",selector:this.selContainer+"#CbxInfoGen"},{ref:"CbxDetArt",selector:this.selContainer+"#CbxDetArt"},{ref:"CbxFormule",selector:this.selContainer+"#CbxFormule"},
{ref:"CbxListino",selector:this.selContainer+"#CbxListino"},{ref:"CbxFarmaco",selector:this.selContainer+"#CbxFarmaco"},{ref:"CbxContabilita",selector:this.selContainer+"#CbxContabilita"},{ref:"CbxUbicazione",selector:this.selContainer+"#CbxUbicazione"},{ref:"TxDescrizione",selector:this.selContainer+"#TxDescrizione"}]);this.control(this.selContainer+"#BtnEsci",{click:this.esciClick});this.control(this.selContainer+"#BtnConferma",{click:this.conferma})},conferma:function(){var a=[],b=this;Messaggio("ATTENZIONE",
"MSG_COPIA_ARTICOLO","YESNO","QUESTION",!1,function(){if(!b.getTxDescrizione().isValid())return msgAddError(a,"MSG_CAMPI_OBBLIGATORI"),msgShow("",a);Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/catalogo/copiaArticolo",params:{id:b.cbaConfig.idArticolo,descrizione:b.getTxDescrizione().getValue(),copiaInfoGenerali:b.getCbxInfoGen().getValue()?"T":"F",copiaDettaglio:b.getCbxDetArt().getValue()?"T":"F",copiaFormule:b.getCbxFormule().getValue()?"T":"F",copiaListino:b.getCbxListino().getValue()?
"T":"F",copiaCarattFarmaco:b.getCbxFarmaco().getValue()?"T":"F",copiaContabilita:b.getCbxContabilita().getValue()?"T":"F",copiaUbicazioni:b.getCbxUbicazione().getValue()?"T":"F"},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(b.cbaConfig.afterConferma&&b.cbaConfig.afterConferma(a.data),b.getBtnEsci().up("window").close()):msgShowError("",a.message)}})},function(){return!1})},esciClick:function(){this.getBtnEsci().up("window").close()},onLaunch:function(){this.getTxDescrizione().validate();
this.getCbxFarmaco().setVisible("F"==this.cbaConfig.tipoArticolo);"M"==this.cbaConfig.tipoArticolo&&this.getCbxFarmaco().setValue(!1)},destroy:function(){eliminaStore(this.storeDeposito);this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.DettagliArticolo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridDetArt",selector:this.selContainer+"#GridDetArt"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"ChbRicMot",selector:this.selContainer+"#ChbRicMot"},{ref:"ChbPianoTer",selector:this.selContainer+"#ChbPianoTer"}]);
this.control(this.selContainer+"#GridDetArt",{beforeedit:this.beforeeditGridDetArt,edit:this.editGridDetArt,canceledit:this.canceleditGridDetArt,validateedit:this.validateeditGridDetArt});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnNuovo:function(a){controller_nuovoRecordGrid({attivo:"T"},this.getGridDetArt())},clickBtnElimina:function(a){var b=this;a=b.getGridDetArt();var c=a.getSelectionModel().getSelection()[0];
controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},beforeeditGridDetArt:function(a,b,c){if(!0===a.editing)return!1;f=a.getEditor().getForm();f.findField("idDeposito").bindStore(this.storeDepositi);f.findField("desDeposito")?this.storeDepositi.load({params:{descrizione:f.findField("desDeposito")}}):(a=b.record,a.get("desDeposito")&&this.storeDepositi.load({params:{descrizione:a.get("desDeposito")}}));this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);
this.getBtnElimina().setDisabled(!a);IsolaCmp(this.cbaConfig.controllerCatArtTes.getPnlDetArticolo(),!a)},editGridDetArt:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();delete c.desDeposito;Ext.apply(c,{idCatalogo:this.cbaConfig.recordTestata.get("id"),attivo:getBoolValue(c.attivo),richiestaMotivata:getBoolValue(c.richiestaMotivata),pianoTerapeutico:getBoolValue(c.pianoTerapeutico)});controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?
this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridDetArt:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridDetArt:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this,c=b.getGridDetArt(),d=c.getStore();d.load({params:{idCatalogo:b.cbaConfig.recordTestata.get("id")},callback:function(e,g,h){h?(e=null,a&&(e=trovaRecord(d,"id",a)),c.getSelectionModel().deselectAll(),c.getSelectionModel().select(e?[e]:0),b.getChbRicMot().setVisible("F"==
b.cbaConfig.recordTestata.get("tipoArticolo")),b.getChbPianoTer().setVisible("F"==b.cbaConfig.recordTestata.get("tipoArticolo"))):msgShowError("",g.getError())}})},svuotaStore:function(){svuotaStore(this.getGridDetArt().getStore())},onLaunch:function(){this.getGridDetArt().controller=this;this.storeDepositi=Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi");ImpostaUrl(this.getGridDetArt().getStore());ImpostaUrl(this.storeDepositi);this.storeDepositi.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione,
tipoDeposito:this.cbaConfig.recordTestata.get("tipoArticolo")};StdEconomato.solaLettura(this.getGridDetArt(),this.cbaConfig.permesso);this.aggiornaStore()},destroy:function(){eliminaStore(this.storeDepositi);this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.Farmaco",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CBPrincAtt",selector:this.selContainer+"#CBPrincAtt"},{ref:"CBGrpAtc1",selector:this.selContainer+"#CBGrpAtc1"},{ref:"CBGrpAtc2",selector:this.selContainer+"#CBGrpAtc2"},{ref:"CBGrpAtc3",
selector:this.selContainer+"#CBGrpAtc3"},{ref:"CBGrpAtc4",selector:this.selContainer+"#CBGrpAtc4"},{ref:"CBGrpAtc5",selector:this.selContainer+"#CBGrpAtc5"},{ref:"FSGruppiATC",selector:this.selContainer+"#FSGruppiATC"},{ref:"TxAic",selector:this.selContainer+"#TxAic"},{ref:"CboxFormaFarm",selector:this.selContainer+"#CboxFormaFarm"},{ref:"TxFormaFarm",selector:this.selContainer+"#TxFormaFarm"},{ref:"BtnCollega",selector:this.selContainer+"#BtnCollega"},{ref:"TxFormulaPn",selector:this.selContainer+
"#TxFormulaPn"},{ref:"CntFormulaPn",selector:this.selContainer+"#CntFormulaPn"},{ref:"TxMinSan",selector:this.selContainer+"#TxMinSan"},{ref:"CBClasse",selector:this.selContainer+"#CBClasse"},{ref:"TxTipoProdotto",selector:this.selContainer+"#TxTipoProdotto"},{ref:"TxDittaAic",selector:this.selContainer+"#TxDittaAic"},{ref:"txIdCatalogo",selector:this.selContainer+"#txIdCatalogo"}]);this.control(this.selContainer+"#BtnCollega",{click:this.clickBtnCollega});this.control(this.selContainer+"#CBGrpAtc1",
{change:this.changeCBGrpAtc1});this.control(this.selContainer+"#CBGrpAtc2",{change:this.changeCBGrpAtc2});this.control(this.selContainer+"#CBGrpAtc3",{change:this.changeCBGrpAtc3});this.control(this.selContainer+"#CBGrpAtc4",{change:this.changeCBGrpAtc4})},clickBtnCollega:function(a){Ext.create("winCBA",{name:"GeneraliEC.catalogoArticoli.view.Prontuario",titolo:traduci("CARICA_FARMACI"),altezzaWin:600,larghezzaWin:900,configItem:{idOrganizzazione:this.cbaConfig.idOrganizzazione,callbackImporta:Ext.bind(this.CollegaFarmacoDaPn,
this)},maximizable:!1,closable:!0}).show()},CollegaFarmacoDaPn:function(a){if(a){var b=this,c={},d="",e=b.cbaConfig.controllerCatArtTes,d=getUrlGen()+"/ws/catalogoFarmaci/getByAic";Ext.apply(c,{codAic:a.codProdotto,idOrganizzazione:b.cbaConfig.idOrganizzazione});Ext.Ajax.request({method:"GET",url:d,params:c,success:function(c){c=Ext.JSON.decode(c.responseText);var d=c.data;if(c.success)if(null==d||d==parseInt(b.getTxIdCatalogo().getValue())){StdEconomato.isValidID(a.codPrincipioAttivo)&&setCombo(b.getCBPrincAtt(),
a.codPrincipioAttivo);if(!Ext.isEmpty(a.codAtcGmp5)){c=StdEconomato.idAtcX(a.codAtcGmp5,1);var d=StdEconomato.idAtcX(a.codAtcGmp5,3),g=StdEconomato.idAtcX(a.codAtcGmp5,4),l=StdEconomato.idAtcX(a.codAtcGmp5,5),m=StdEconomato.idAtcX(a.codAtcGmp5,7);setCombo(b.getCBGrpAtc1(),c,null,{idPadre:0});d&&setCombo(b.getCBGrpAtc2(),d,null,{idPadre:c});g&&setCombo(b.getCBGrpAtc3(),g,null,{idPadre:d});l&&setCombo(b.getCBGrpAtc4(),l,null,{idPadre:g});m&&setCombo(b.getCBGrpAtc5(),m,null,{idPadre:l})}b.getTxAic().setValue(a.codProdotto);
b.getTxMinSan().setValue(a.codProdotto);b.getCBClasse().setValue(a.codClasse);b.getTxDittaAic().setValue(a.descDitta);b.getTxTipoProdotto().setValue(a.codTipoProdotto);e.getTxDescrizione().setValue(a.descProdotto);e.getCbxGalenico().setValue(!1);Ext.isEmpty(a.idUdm)||e.getCBUniMisSomministra().setValue(a.idUdm)}else c=[],msgAddError(c,"MSG_FARMACO_GIA_PRESENTE_A_CATALOGO"),msgShow("",c)}})}},changeCBGrpAtc1:function(a,b){b?this.storeGrpAtc2.load({params:{idPadre:b}}):(svuotaStore(this.storeGrpAtc2),
svuotaStore(this.storeGrpAtc3),svuotaStore(this.storeGrpAtc4),svuotaStore(this.storeGrpAtc5),this.getCBGrpAtc2().setValue(null),this.getCBGrpAtc3().setValue(null),this.getCBGrpAtc4().setValue(null),this.getCBGrpAtc5().setValue(null))},changeCBGrpAtc2:function(a,b){b?this.storeGrpAtc3.load({params:{idPadre:b}}):(svuotaStore(this.storeGrpAtc3),svuotaStore(this.storeGrpAtc4),svuotaStore(this.storeGrpAtc5),this.getCBGrpAtc3().setValue(null),this.getCBGrpAtc4().setValue(null),this.getCBGrpAtc5().setValue(null))},
changeCBGrpAtc3:function(a,b){b?this.storeGrpAtc4.load({params:{idPadre:b}}):(svuotaStore(this.storeGrpAtc4),svuotaStore(this.storeGrpAtc5),this.getCBGrpAtc4().setValue(null),this.getCBGrpAtc5().setValue(null))},changeCBGrpAtc4:function(a,b){b?this.storeGrpAtc5.load({params:{idPadre:b}}):(svuotaStore(this.storeGrpAtc5),this.getCBGrpAtc5().setValue(null))},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=
this.getForm(),c=b.getForm().getFieldValues(),d="";null!=c.idAtc1&&(d=c.idAtc1);null!=c.idAtc2&&(d=c.idAtc2);null!=c.idAtc3&&(d=c.idAtc3);null!=c.idAtc4&&(d=c.idAtc4);null!=c.idAtc5&&(d=c.idAtc5);""!=d&&Ext.apply(c,{idGruppoAtc:d});Ext.apply(c,{idCatalogo:this.cbaConfig.recordTestata.get("id"),prontuario:getBoolValue(c.prontuario)});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;
b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=Ext.create("GeneraliEC.catalogoArticoli.store.Farmaco");b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.aggiornaStore()},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});inserisciBottoni(b.boxBottoni,c);b.boxBottoni.queryById("btnEsci").hide();b.boxBottoni.queryById("btnNuovo").hide();b.boxBottoni.queryById("btnElimina").hide();
if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);IsolaCmp(a.cbaConfig.controllerCatArtTes.getPnlFarmaco(),e)})},aggiornaStore:function(a){var b=this;a=b.getForm();var c=a.getForm();a=a.store;var d=""!=b.cbaConfig.recordTestata.get("presenzaFormulaPn");b.getCntFormulaPn().setVisible(d);b.getTxFormulaPn().setValue(b.cbaConfig.recordTestata.get("presenzaFormulaPn"));a.load({params:{idCatalogo:b.cbaConfig.recordTestata.get("id")},callback:function(a,d,h){h?Ext.isEmpty(a)?
clearForm(b.getForm()):(c.loadRecord(a[0]),b.getBtnCollega().setVisible(!a[0].get("aic")),a[0].get("idPrincipioAttivo")&&setCombo(b.getCBPrincAtt(),a[0].get("idPrincipioAttivo"),a[0].get("desPrincipioAttivo"),{descrizione:a[0].get("desPrincipioAttivo")}),a[0].get("idAtc1")&&setCombo(b.getCBGrpAtc1(),a[0].get("idAtc1"),a[0].get("desAtc1"),{descrizione:a[0].get("desAtc1")})):msgShowError("",d.getError())}})},onLaunch:function(){this.getCBPrincAtt().getStore().getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione};
this.magFarOrd="O";switch(CBA.moduli.moduloAttivo){case 58:this.magFarOrd="M";break;case 62:this.magFarOrd="F"}this.storeGrpAtc1=this.getCBGrpAtc1().getStore();this.storeGrpAtc2=this.getCBGrpAtc2().getStore();this.storeGrpAtc3=this.getCBGrpAtc3().getStore();this.storeGrpAtc4=this.getCBGrpAtc4().getStore();this.storeGrpAtc5=this.getCBGrpAtc5().getStore();this.storeGrpAtc1.getProxy().extraParams={idPadre:0};ImpostaUrl(this.storeGrpAtc1);ImpostaUrl(this.storeGrpAtc2);ImpostaUrl(this.storeGrpAtc3);ImpostaUrl(this.storeGrpAtc4);
ImpostaUrl(this.storeGrpAtc5);if("T"!=this.cbaConfig.recordTestata.get("galenico"))this.getForm().getForm().getFields().each(function(a){"prontuario"!=a.name||49!=CBA.moduli.moduloAttivo&&62!=CBA.moduli.moduloAttivo?Ext.isDefined(a.setReadOnly)?a.setReadOnly(!0):a.setDisabled(!0):a.setReadOnly(!1)}),this.getCboxFormaFarm().setHidden(!0),this.getTxFormaFarm().setHidden(!1);else{var a=49==CBA.moduli.moduloAttivo?"/cba/css/cs/ws/farmaci/formaFarma/cbox":"O"===this.magFarOrd?"/cba/eco/of/ws/farmaci/formaFarma/cbox":
"/cba/eco/far/ws/farmaci/formaFarma/cbox";this.getCboxFormaFarm().getStore().getProxy().api.read=a;this.getCboxFormaFarm().getStore().load()}this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);eliminaStore(this.storeGrpAtc1);eliminaStore(this.storeGrpAtc2);eliminaStore(this.storeGrpAtc3);eliminaStore(this.storeGrpAtc4);eliminaStore(this.storeGrpAtc5);this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.Formule",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"FsFormulaSomm",selector:this.selContainer+"#FsFormulaSomm"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"GridFormule",selector:this.selContainer+"#GridFormule"},{ref:"CBUniMisCarico",
selector:this.selContainer+"#CBUniMisCarico"},{ref:"CBUniMisScarico",selector:this.selContainer+"#CBUniMisScarico"},{ref:"LblEsempioCar",selector:this.selContainer+"#LblEsempioCar"},{ref:"TxNumCarico",selector:this.selContainer+"#TxNumCarico"},{ref:"RgbConvCar",selector:this.selContainer+"#RgbConvCar"},{ref:"LblEsempioSca",selector:this.selContainer+"#LblEsempioCar"},{ref:"TxNumScarico",selector:this.selContainer+"#TxNumScarico"},{ref:"RgbConvSca",selector:this.selContainer+"#RgbConvSca"},{ref:"EdtDtInizio",
selector:this.selContainer+"#EdtDtInizio"},{ref:"CBUniMisSomm",selector:this.selContainer+"#CBUniMisSomm"},{ref:"RgbConvSomm",selector:this.selContainer+"#RgbConvSomm"},{ref:"LblEsempioSomm",selector:this.selContainer+"#LblEsempioSomm"},{ref:"TxNumSomm",selector:this.selContainer+"#TxNumSomm"}]);this.control(this.selContainer+"#GridFormule",{select:this.selectGridFormule});this.control(this.selContainer+"#CBUniMisCarico",{change:this.calcolaEsempioCar});this.control(this.selContainer+"#CBUniMisScarico",
{change:this.calcolaEsempioSca});this.control(this.selContainer+"#CBUniMisSomm",{change:this.calcolaEsempioSomm});this.control(this.selContainer+"#TxNumCarico",{change:this.calcolaEsempioCar});this.control(this.selContainer+"#TxNumScarico",{change:this.calcolaEsempioSca});this.control(this.selContainer+"#TxNumSomm",{change:this.calcolaEsempioSomm});this.control(this.selContainer+"#RgbConvCar",{change:this.calcolaEsempioCar});this.control(this.selContainer+"#RgbConvSca",{change:this.calcolaEsempioSca});
this.control(this.selContainer+"#RgbConvSomm",{change:this.calcolaEsempioSomm})},calcolaEsempioCar:function(){this.getCBUniMisCarico().getValue()&&this.getRgbConvCar().getValue()&&this.getTxNumCarico().getValue()?"M"==this.getRgbConvCar().getValue().tipoConvCarico?this.getLblEsempioCar().setText("Esempio:  1 "+this.getCBUniMisCarico().rawValue+" = "+this.getTxNumCarico().getValue()+" "+this.cbaConfig.controllerCatArtTes.getCBUniMisPrincipale().rawValue):this.getLblEsempioCar().setText("Esempio: 1 "+
this.cbaConfig.controllerCatArtTes.getCBUniMisPrincipale().rawValue+" = "+this.getTxNumCarico().getValue()+" "+this.getCBUniMisCarico().rawValue):this.getLblEsempioCar().setText("Esempio:")},calcolaEsempioSca:function(){this.getCBUniMisScarico().getValue()&&this.getRgbConvSca().getValue()&&this.getTxNumScarico().getValue()?"M"==this.getRgbConvSca().getValue().tipoConvScarico?this.getLblEsempioSca().setText("Esempio:  1 "+this.getCBUniMisScarico().rawValue+" = "+this.getTxNumScarico().getValue()+" "+
this.cbaConfig.controllerCatArtTes.getCBUniMisPrincipale().rawValue):this.getLblEsempioSca().setText("Esempio: 1 "+this.cbaConfig.controllerCatArtTes.getCBUniMisPrincipale().rawValue+" = "+this.getTxNumScarico().getValue()+" "+this.getCBUniMisScarico().rawValue):this.getLblEsempioSca().setText("Esempio:")},calcolaEsempioSomm:function(){this.getCBUniMisSomm().getValue()&&this.getRgbConvSomm().getValue()&&this.getTxNumSomm().getValue()?"M"==this.getRgbConvSomm().getValue().tipoConvSomm?this.getLblEsempioSomm().setText("Esempio:  1 "+
this.getCBUniMisSomm().rawValue+" = "+this.getTxNumSomm().getValue()+" "+this.cbaConfig.controllerCatArtTes.getCBUniMisPrincipale().rawValue):this.getLblEsempioSomm().setText("Esempio: 1 "+this.cbaConfig.controllerCatArtTes.getCBUniMisPrincipale().rawValue+" = "+this.getTxNumSomm().getValue()+" "+this.getCBUniMisSomm().rawValue):this.getLblEsempioSomm().setText("Esempio:")},selectGridFormule:function(a,b){clearForm(this.getForm());this.getForm().loadRecord(b);b.get("udmCarico")&&setCombo(this.getCBUniMisCarico(),
b.get("udmCarico"),b.get("desUdmCarico"),{descrizione:b.get("desUdmCarico")});b.get("udmScarico")&&setCombo(this.getCBUniMisScarico(),b.get("udmScarico"),b.get("desUdmScarico"),{descrizione:b.get("desUdmScarico")});b.get("udmSomm")&&setCombo(this.getCBUniMisSomm(),b.get("udmSomm"),b.get("desUdmSomm"),{descrizione:b.get("desUdmSomm")})},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");(1==this.getTxNumCarico().getValue()||1==this.getTxNumScarico().getValue()||
this.isFarmacia&&1==this.getTxNumSomm().getValue())&&msgAddError(a,"VALORE_NON_AMMESSO");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();delete c.desUdmCarico;delete c.desUdmScarico;Ext.apply(c,{idCatalogo:this.cbaConfig.recordTestata.get("id")});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;b.boxBottoni=a.getBoxBottoni();
a.storeForm=b.store=a.getGridFormule().getStore();b.controller=a;StdEconomato.solaLettura(b,b.permesso);var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.getCBUniMisCarico().getValue()&&a.getRgbConvCar().getValue()&&a.getTxNumCarico().getValue()||a.getCBUniMisScarico().getValue()&&a.getRgbConvSca().getValue()&&a.getTxNumScarico().getValue()||a.isFarmacia&&a.getCBUniMisSomm().getValue()&&a.getRgbConvSomm().getValue()&&a.getTxNumSomm().getValue()?
a.salvaForm(b):(Messaggio("MSG_ERRORI_TROVATI","FORMULA_INCOMPLETA","OK","ERROR"),controller_abilitaBottoni(d))},annulla_callback:function(){b.getForm().findField("id").getValue();a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);a.getEdtDtInizio().setValue(new Date);a.getGridFormule().setDisabled(!0)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},
esci_callback:function(){a.getForm().up("window").close()}}});inserisciBottoni(b.boxBottoni,c);a.cbaConfig.mostraEsciGenerale||b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso){var d=b;b.getForm().on("dirtychange",function(b,c){controller_abilitaBottoni(d);a.getGridFormule().setDisabled(c);IsolaCmp(a.cbaConfig.controllerCatArtTes.getPnlFormule(),c)})}a.cbaConfig.isWindow&&(b.boxBottoni.queryById("btnNuovo").hide(),b.boxBottoni.queryById("btnElimina").hide(),b.boxBottoni.queryById("btnEsci").setVisible(!0))},
aggiornaStore:function(a){var b=this,c=b.getForm(),d=c.getForm(),e=c.store;b.isFarmacia=b.cbaConfig.controllerCatArtTes.getCmcFarmacia().getValue();b.isFarmacia&&b.cbaConfig.recordTestata.get("presenzaFormulaPn");b.getFsFormulaSomm().setVisible(!0);49!=CBA.moduli.moduloAttivo&&ImpostaUrl(e);e.load({params:{idCatalogo:b.cbaConfig.recordTestata.get("id")},callback:function(g,h,k){k?Ext.isEmpty(g)?clearForm(c):(a||(a=d.findField("id").getValue()),g=trovaRecord(e,"id",a),h=b.getGridFormule(),h.getSelectionModel().deselectAll(),
h.getSelectionModel().select(g?[g]:0)):msgShowError("",h.getError())}})},onLaunch:function(){49!=CBA.moduli.moduloAttivo&&ImpostaUrl(this.getGridFormule().getStore());ImpostaUrl(this.getCBUniMisCarico().getStore());ImpostaUrl(this.getCBUniMisScarico().getStore());ImpostaUrl(this.getCBUniMisSomm().getStore());this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.InfoGenerali",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CBAliIva",selector:this.selContainer+"#CBAliIva"},{ref:"CBGruppo",selector:this.selContainer+"#CBGruppo"},{ref:"CBCategoria",selector:this.selContainer+"#CBCategoria"},{ref:"ChbDeteriorabile",
selector:this.selContainer+"#ChbDeteriorabile"},{ref:"TxId",selector:this.selContainer+"#TxId"},{ref:"TxCodBarre",selector:this.selContainer+"#TxCodBarre"},{ref:"TxNote",selector:this.selContainer+"#TxNote"}]);this.control(this.selContainer+"#CBGruppo",{change:this.changeCBGruppo});this.control(this.selContainer+"#CBCategoria",{select:this.selectCBCategoria})},selectCBCategoria:function(a,b,c){0<a.getStore().getCount()&&b&&("T"==b.data.extra?this.getChbDeteriorabile().setValue(!0):this.getChbDeteriorabile().setValue(!1))},
changeCBGruppo:function(a,b){var c=this.getCBCategoria().getStore();b?c.load({params:{idGruppo:b}}):svuotaStore(c)},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{idOrganizzazione:this.cbaConfig.idOrganizzazione,id:this.cbaConfig.recordTestata.get("id"),descrizione:this.cbaConfig.recordTestata.get("descrizione"),tipoArticolo:this.cbaConfig.recordTestata.get("tipoArticolo"),
idUdm:this.cbaConfig.recordTestata.get("idUdm"),idUdmSomministra:this.cbaConfig.recordTestata.get("idUdmSomministra"),gestScadenza:getBoolValue(c.gestScadenza),gestLotto:getBoolValue(c.gestLotto),deteriorabile:getBoolValue(c.deteriorabile),galenico:this.cbaConfig.recordTestata.get("galenico"),propostaAutomatica:getBoolValue(c.propostaAutomatica)});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&(a&&this.callbackEsci&&this.callbackEsci(),IsolaCmp(this.cbaConfig.controllerCatArtTes.getPnlInfoGen(),
!1))},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;b.boxBottoni=a.getBoxBottoni();b.store=a.storeForm=Ext.create("GeneraliEC.catalogoArticoli.store.CatalogoArticoliTes");b.controller=a;StdEconomato.solaLettura(b,b.permesso);ImpostaUrl(b.store);var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.aggiornaStore()},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});
inserisciBottoni(b.boxBottoni,c);b.boxBottoni.queryById("btnEsci").hide();b.boxBottoni.queryById("btnNuovo").hide();b.boxBottoni.queryById("btnElimina").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){IsolaCmp(a.cbaConfig.controllerCatArtTes.getPnlInfoGen(),e);a.getCBAliIva().getValue()||a.getCBGruppo().getValue()||a.getCBCategoria().getValue()||49==CBA.moduli.moduloAttivo?controller_abilitaBottoni(b):(a.getBoxBottoni().queryById("btnAnnulla").setDisabled(!0),a.getBoxBottoni().queryById("btnConferma").setDisabled(!1))})},
aggiornaStore:function(a){var b=this;a=b.cbaConfig;var c=b.getForm();StdEconomato.promiseLoadStore(b.storeForm,{idOrganizzazione:a.idOrganizzazione,id:a.recordTestata.get("id")}).then(function(a){if(Ext.isEmpty(a))clearForm(b.getForm());else{var d=c.getForm();d.loadRecord(a[0]);StdEconomato.isValidID(a[0].get("idAliquotaIva"))||49==CBA.moduli.moduloAttivo||(StdEconomato.sporcaForm(d),b.getCBAliIva().focus())}})["catch"](function(a){return msgShowError("",a)})},validateFields:function(){49!=CBA.moduli.moduloAttivo&&
[this.getCBAliIva(),this.getCBGruppo(),this.getCBCategoria()].forEach(function(a){a.validate()})},onLaunch:function(){var a=this,b=a.cbaConfig.recordTestata,c=a.getCBGruppo().getStore(),d=a.getCBCategoria().getStore(),e=a.getCBAliIva().getStore();ImpostaUrl(c);ImpostaUrl(d);ImpostaUrl(e);var g="";62==CBA.moduli.moduloAttivo&&(g="F");58==CBA.moduli.moduloAttivo&&(g="M");57==CBA.moduli.moduloAttivo&&(g=a.cbaConfig.recordTestata.get("tipoArticolo"));""==g?c.load({params:{idOrganizzazione:a.cbaConfig.idOrganizzazione}}):
c.load({params:{idOrganizzazione:a.cbaConfig.idOrganizzazione,tipo:g}});Promise.all([StdEconomato.promiseLoadStore(e,{idOrganizzazione:a.cbaConfig.idOrganizzazione,tipo:b.get("tipoArticolo")}),StdEconomato.promiseLoadStore(d,{attivo:"T"})]).then(function(c){a.validateFields();a.getChbDeteriorabile().setVisible("M"==b.get("tipoArticolo"));a.getTxCodBarre().setReadOnly("T"!=b.get("galenico")&&"F"==a.cbaConfig.recordTestata.get("tipoArticolo"));a.getTxNote().setReadOnly("T"!=b.get("galenico")&&"F"==
a.cbaConfig.recordTestata.get("tipoArticolo"));a.aggiornaStore()})["catch"](function(a){return msgShowError("",a)});a.gestioneForm()},destroy:function(){delete this.storeForm;this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.Listino",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridListino",selector:this.selContainer+"#GridListino"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"CheckPrezzoAttivo",selector:this.selContainer+"#CheckPrezzoAttivo"}]);this.control(this.selContainer+"#GridListino",
{beforeedit:this.beforeeditGridListino,edit:this.editGridListino,canceledit:this.canceleditGridListino,validateedit:this.validateeditGridListino});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#CheckPrezzoAttivo",{change:this.CheckPrezzoAttivo})},CheckPrezzoAttivo:function(a,b,c,d){this.aggiornaStore(0)},clickBtnNuovo:function(a){controller_nuovoRecordGrid({attivo:"T",
dataInizioUtilizzo:new Date},this.getGridListino())},clickBtnElimina:function(a){var b=this;a=b.getGridListino();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},beforeeditGridListino:function(a,b,c){if(!0===a.editing)return!1;f=a.getEditor().getForm();f.findField("idCliFor").bindStore(this.storeFornitori);f.findField("desCliFor")?this.storeFornitori.load({params:{descrizione:f.findField("desCliFor")}}):(a=b.record,
a.get("desCliFor")&&this.storeFornitori.load({params:{descrizione:a.get("desCliFor")}}));this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a);IsolaCmp(this.cbaConfig.controllerCatArtTes.getPnlListino(),!a)},editGridListino:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();delete c.desDeposito;Ext.apply(c,{idCatalogo:this.cbaConfig.recordTestata.get("id"),attivo:getBoolValue(c.attivo)});
controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridListino:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridListino:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridListino(),c=b.getStore(),d=this.getCheckPrezzoAttivo().rawValue?"T":"F";c.load({params:{idCatalogo:this.cbaConfig.recordTestata.get("id"),attivo:d},callback:function(d,g,h){h?(d=null,
a&&(d=trovaRecord(c,"id",a)),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d?[d]:0)):msgShowError("",g.getError())}})},svuotaStore:function(){svuotaStore(this.getGridListino().getStore())},onLaunch:function(){this.getGridListino().controller=this;this.storeFornitori=Ext.create("Generali.anaCliFor.store.cboxAnaCliFor",{autoLoad:!1,autoDestroy:!1});ImpostaUrl(this.storeFornitori);ImpostaUrl(this.getGridListino().getStore());this.storeFornitori.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione,
attivo:"T",tipo:"F"};StdEconomato.solaLettura(this.getGridListino(),this.cbaConfig.permesso);this.aggiornaStore()},destroy:function(){this.storeFornitori&&eliminaStore(this.storeFornitori);this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.controller.PnlCatalogoArticoli",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"},{ref:"CntRicerca",selector:this.selContainer+"#CntRicerca"},{ref:"CntDati",selector:this.selContainer+"#CntDati"}])},selectGridRicerca:function(a,b){var c=this.getCntDati(),d=a?a.get("id"):0;Ext.isDefined(this.CatalogoArticoliTestata)?
(this.CatalogoArticoliTestata.cbaConfig.idTestata=a?a.get("id"):null,a?this.CatalogoArticoliTestata.controller.aggiornaStore(a.get("id")):this.CatalogoArticoliTestata.controller.aggiornaStore()):(this.CatalogoArticoliTestata=Ext.create("GeneraliEC.catalogoArticoli.view.CatalogoArticoliTes",{cbaConfig:{permesso:this.cbaConfig.permesso,controllerPnlCatalogoArticoli:this,ownerGridRicerca:b,idTestata:d,idOrganizzazione:this.idOrganizzazione,caricamentoEsterno:this.cbaConfig.caricamentoEsterno}}),c.add(this.CatalogoArticoliTestata))},
onLaunch:function(){var a=this;a.idOrganizzazione=a.cbaConfig.idOrganizzazione;a.idOrganizzazione||(a.idOrganizzazione=CBA.parametriGenerali.idOrganizzazione);a.getCntRicerca().add(Ext.create("GeneraliEC.catalogoArticoli.view.RicercaCatalogoArticoli",{cbaConfig:{permesso:a.cbaConfig.permesso,controllerPnlCatalogoArticoli:a,idOrganizzazione:a.idOrganizzazione,caricamentoEsterno:a.cbaConfig.caricamentoEsterno,idArticolo:a.cbaConfig.idArticolo,desArticolo:a.cbaConfig.desArticolo,selectGridRicerca:function(b,
c){a.selectGridRicerca(b,c)}}}))}});
Ext.define("GeneraliEC.catalogoArticoli.controller.Prontuario",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TxtNomeFarmaco",selector:this.selContainer+"#TxtNomeFarmaco"},{ref:"FormImporta",selector:this.selContainer+"#FormImporta"},{ref:"ImportaUpload",selector:this.selContainer+"#ImportaUpload"},{ref:"BtnImporta",selector:this.selContainer+"#BtnImporta"},{ref:"BtnEsci",selector:this.selContainer+
"#BtnEsci"},{ref:"GridProntuario",selector:this.selContainer+"#GridProntuario"},{ref:"TxtAicFarmaco",selector:this.selContainer+"#TxtAicFarmaco"}]);this.control(this.selContainer+"#ImportaUpload",{change:this.onFilefieldChangeImporta});this.control(this.selContainer+"#TxtNomeFarmaco",{change:Ext.Function.createBuffered(this.cercaFarmaco,500,this)});this.control(this.selContainer+"#TxtAicFarmaco",{change:Ext.Function.createBuffered(this.cercaFarmaco,500,this)});this.control(this.selContainer+"#BtnEsci",
{click:this.esci});this.control(this.selContainer+"#GridProntuario",{itemdblclick:this.itemdblclickGridProntuario})},itemdblclickGridProntuario:function(a,b,c,d,e,g){this.cbaConfig.callbackImporta(b.getData());a.up("window").close()},esci:function(a){a.up("window").close()},onFilefieldChangeImporta:function(a,b,c){var d=this;d.getFormImporta();c=b.lastIndexOf("\\")||b.lastIndexOf("/");b=b.substring(c+1);""!==b&&(c=Ext.Object.toQueryString({idOrganizzazione:d.cbaConfig.idOrganizzazione}),b=Ext.String.urlAppend(getUrlGen()+
"/ws/farmadati/prontuario/importaElencoDaPn",c),49==CBA.moduli.moduloAttivo&&(b=Ext.String.urlAppend("/cba/css/cs/ws/genCss/farmadati/prontuario/importaElencoDaPn",c)),a=a.fileInputEl.dom.files[0],c=new FormData,c.append("file",a),Ext.Ajax.request({url:b,method:"POST",rawData:c,headers:{"Content-Type":null},success:function(a){a=Ext.JSON.decode(a.responseText);if(a.success){a="";for(var b=$jscomp.makeIterator(action.result.data),c=b.next();!c.done;c=b.next())c=c.value,0==c.codice&&(a+=c.extra+": "+
c.valore+" <BR>");Ext.isEmpty(a)||(a=traduci("ALCUNI_FARMACI_NON_INSERITI")+"<BR>"+a,Messaggio("ATTENZIONE",a,"OK"));d.aggiornaStore()}else msgShowError("",a.message)}}))},cercaFarmaco:function(a,b){var c=this.getGridProntuario().getStore();svuotaStore(c);Ext.isEmpty(b)||3>b.length||(c.cbaConfig.parametri&&(c.cbaConfig.parametri.firstResult=0),this.aggiornaStore())},aggiornaStore:function(){var a=this.getGridProntuario(),b=a.getStore(),c=Ext.create("GeneraliEC.catalogoArticoli.store.Prontuario",{autoLoad:!1}),
d={};b.cbaConfig.parametri||(b.cbaConfig.parametri={});a.cbaConfig.paged.fromScroll||(svuotaStore(b),Ext.apply(a.cbaConfig.paged,{fromScroll:!1}),Ext.apply(b.cbaConfig.parametri,{firstResult:0}));Ext.apply(d,{maxResults:a.cbaConfig.paged.maxResults,PTO:!1});this.getTxtNomeFarmaco().getValue()&&Ext.apply(d,{descrizione:this.getTxtNomeFarmaco().getValue()});this.getTxtAicFarmaco().getValue()&&Ext.apply(d,{aic:this.getTxtAicFarmaco().getValue()});49==CBA.moduli.moduloAttivo&&Ext.apply(d,{idProfilo:CBA.parametriGenerali.idProfiloCss});
delete b.cbaConfig.parametri.descrizione;delete b.cbaConfig.parametri.aic;delete b.cbaConfig.parametri.idProfilo;Ext.apply(b.cbaConfig.parametri,d);c.load({params:b.cbaConfig.parametri,callback:function(c,d,h){if(h){if(!Ext.isEmpty(c)){a.getSelectionModel().deselectAll();c=$jscomp.makeIterator(c);for(d=c.next();!d.done;d=c.next())b.add(d.value);Ext.apply(a.cbaConfig.paged,{fromScroll:!1})}}else msgShowError("",d.getError())}})},onLaunch:function(){this.getTxtNomeFarmaco().focus();ImpostaUrl(this.getGridProntuario().getStore())},
destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.controller.RicercaCatalogoArticoli",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"CntRicerca",selector:a.selContainer+"#CntRicerca"},{ref:"GridRicerca",selector:a.selContainer+"#GridRicerca"},{ref:"BtnCerca",selector:a.selContainer+"#BtnCerca"},{ref:"PTRicerca",selector:a.selContainer+"#PTRicerca"},{ref:"CbxAttivo",selector:a.selContainer+"#CbxAttivo"},{ref:"CbxNonAttivo",
selector:a.selContainer+"#CbxNonAttivo"},{ref:"CbGruppo",selector:a.selContainer+"#CbGruppo"},{ref:"CbCategoria",selector:a.selContainer+"#CbCategoria"},{ref:"CbPrincAtt",selector:a.selContainer+"#CbPrincAtt"},{ref:"CBFornitore",selector:a.selContainer+"#CBFornitore"},{ref:"CbxMag",selector:a.selContainer+"#CbxMag"},{ref:"CbxFar",selector:a.selContainer+"#CbxFar"},{ref:"TxtCercaArticolo",selector:a.selContainer+"#TxtCercaArticolo"},{ref:"TxtAic",selector:a.selContainer+"#TxtAic"},{ref:"BtnCopia",
selector:a.selContainer+"#BtnCopia"}]);a.control(a.selContainer+"#BtnCerca",{click:a.cerca});a.control(a.selContainer+"#GridRicerca",{select:a.selectGridRicerca,itemdblclick:a.itemdblclickGridRicerca});a.control(a.selContainer+"#TxtCercaArticolo",{keypress:a.keypressTxtCercaArticolo,change:Ext.Function.createBuffered(function(b){a.cerca()},500)});a.control(a.selContainer+"#TxtAic",{keypress:a.keypressTxtCercaArticolo,change:Ext.Function.createBuffered(function(b){a.cerca()},500)});a.control(a.selContainer+
"#BtnCopia",{click:a.clickBtnCopia});a.control(a.selContainer+"#CbGruppo",{change:a.changeCbGruppo})},changeCbGruppo:function(a,b){b?this.storeCategorie.load({params:{idGruppo:b}}):(svuotaStore(this.storeCategorie),this.getCbCategoria().setValue(null))},clickBtnCopia:function(){var a=this,b=a.getGridRicerca().getSelectionModel().getSelection()[0],c=[],d=a.cbaConfig.permesso;if("S"==d)if(b)Ext.create("winCBA",{name:"GeneraliEC.catalogoArticoli.view.CopiaArticolo",titolo:"COPIA_ARTICOLO",dimensione:2,
configItem:{isWindow:!0,permesso:d,idArticolo:b.get("id"),tipoArticolo:b.get("tipoArticolo"),afterConferma:function(b){b&&a.cerca(b)}},closable:!0}).show();else return msgAddError(c,"SELEZIONARE_UN_ARTICOLO"),msgShow("",c)},itemdblclickGridRicerca:function(a,b){this.cbaConfig.dblclickGridRicerca&&this.cbaConfig.dblclickGridRicerca(a,b)},selectGridRicerca:function(a,b){1024>=Ext.getBody().getViewSize().width&&this.cbaConfig.controllerPnlCatalogoArticoli.getCntRicerca().collapse();this.cbaConfig.selectGridRicerca&&
this.cbaConfig.selectGridRicerca(b,this.getGridRicerca());"L"==this.cbaConfig.permesso&&this.getBtnCopia().setDisabled(!0)},keypressTxtCercaArticolo:function(a,b,c){13==b.getCharCode()&&(a=this.getBtnCerca(),a.fireEvent("click",a))},effettuaRicerca:function(a,b){var c=this,d="",e="";c.getCbxAttivo().checked&&c.getCbxNonAttivo().checked&&(d="");c.getCbxAttivo().checked&&!c.getCbxNonAttivo().checked&&(d="T");!c.getCbxAttivo().checked&&c.getCbxNonAttivo().checked&&(d="F");c.getCbxMag().checked&&c.getCbxFar().checked&&
(e="");c.getCbxMag().checked&&!c.getCbxFar().checked&&(e="M");!c.getCbxMag().checked&&c.getCbxFar().checked&&(e="F");var g={idOrganizzazione:c.cbaConfig.idOrganizzazione};""!=d&&Ext.apply(g,{attivo:d});""!=e&&Ext.apply(g,{tipoArticolo:e});c.getCbGruppo().getValue()&&Ext.apply(g,{idGruppo:c.getCbGruppo().getValue()});c.getCbCategoria().getValue()&&Ext.apply(g,{idCategoria:c.getCbCategoria().getValue()});c.getCbPrincAtt().getValue()&&Ext.apply(g,{idPrincAtt:c.getCbPrincAtt().getValue()});c.getCBFornitore().getValue()&&
Ext.apply(g,{idCliFor:c.getCBFornitore().getValue(),hasListino:"T"});c.getTxtAic().getValue()&&Ext.apply(g,{aic:c.getTxtAic().getValue()});c.cbaConfig.caricamentoEsterno&&a&&Ext.apply(g,{idArticolo:a});Ext.isEmpty(b)||setValue(c.getTxtCercaArticolo(),b);c.getTxtCercaArticolo().getValue()&&Ext.apply(g,{descrizione:c.getTxtCercaArticolo().getValue()});d=c.getGridRicerca().getStore();d.getProxy().extraParams=g;d.loadPage(d.currentPage,{callback:function(b,d,e){e?c.cbaConfig.selectGridRicerca&&(a?(b=
trovaRecord(c.getGridRicerca().getStore(),"id",a))?c.getGridRicerca().getSelectionModel().select(b):c.getGridRicerca().getSelectionModel().select(0):Ext.isEmpty(b)?c.cbaConfig.selectGridRicerca(null,c.getGridRicerca()):c.getGridRicerca().getSelectionModel().select(0)):msgShowError("",d.getError())}})},cerca:function(a){this.effettuaRicerca(a)},onLaunch:function(){this.store=Ext.create("GeneraliEC.catalogoArticoli.store.RicercaCatalogoArticoli",{pageSize:25});this.getGridRicerca().bindStore(this.store);
this.getPTRicerca().bindStore(this.store);ImpostaUrl(this.getGridRicerca().getStore());ImpostaUrl(this.getCbGruppo().getStore());ImpostaUrl(this.getCbCategoria().getStore());ImpostaUrl(this.getCbPrincAtt().getStore());ImpostaUrl(this.store);var a=this.getCbGruppo().getStore(),b=this.getCBFornitore().getStore();a.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione};b.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione,attivo:"T",tipo:"F",limit:0};this.storeCategorie=
this.getCbCategoria().getStore();this.storeCategorie.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione};a=57==CBA.moduli.moduloAttivo||62==CBA.moduli.moduloAttivo;this.getCbPrincAtt().setVisible(a);this.getTxtAic().setVisible(!0);a&&(this.storePrincAtt=this.getCbPrincAtt().getStore(),this.storePrincAtt.load());58==CBA.moduli.moduloAttivo&&this.getCbxFar().setValue(!1);62==CBA.moduli.moduloAttivo&&this.getCbxMag().setValue(!1);49==CBA.moduli.moduloAttivo&&this.getCbxMag().setValue(!1);
this.getCbxFar().setVisible(57==CBA.moduli.moduloAttivo);this.getCbxMag().setVisible(57==CBA.moduli.moduloAttivo);this.cbaConfig.caricamentoEsterno?this.effettuaRicerca(this.cbaConfig.idArticolo,this.cbaConfig.desArticolo):this.cerca()},destroy:function(){this.callParent();eliminaStore(this.storeCategorie)}});
Ext.define("GeneraliEC.catalogoArticoli.controller.Ubicazione",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"GridUbicazione",selector:this.selContainer+"#GridUbicazione"},{ref:"CBDeposito",selector:this.selContainer+"#CBDeposito"},{ref:"EdtDtInizio",
selector:this.selContainer+"#EdtDtInizio"},{ref:"BtnUbica",selector:this.selContainer+"#BtnUbica"},{ref:"TxUbicazione",selector:this.selContainer+"#TxUbicazione"},{ref:"EdUbicazione",selector:this.selContainer+"#EdUbicazione"}]);this.control(this.selContainer+"#GridUbicazione",{select:this.selectGridUbicazione});this.control(this.selContainer+"#BtnUbica",{click:this.clickBtnUbica})},clickBtnUbica:function(a){var b=this;Ext.create("winCBA",{name:"GeneraliEC.ubicazioni.view.PnlGestUbicazioni",titolo:"UBICAZIONI",
dimensione:2,configItem:{isWindow:!0,onlyTree:!0,permesso:b.cbaConfig.permesso,afterConferma:function(a){a&&(b.getEdUbicazione().setValue(a[0].get("id")),b.getTxUbicazione().setValue(a[0].get("descrizione")))}},closable:!0}).show()},selectGridUbicazione:function(a,b){clearForm(this.getForm());this.getForm().loadRecord(b);b.get("idDeposito")&&setCombo(this.getCBDeposito(),b.get("idDeposito"),b.get("desDeposito"),{descrizione:b.get("desDeposito")})},verificaCampiForm:function(){var a=[];this.getForm().isValid()||
msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{idCatalogo:this.cbaConfig.recordTestata.get("id")});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.getGridUbicazione().getStore();b.controller=a;StdEconomato.solaLettura(b,
b.permesso);var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){b.getForm().findField("id").getValue();a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);a.getEdtDtInizio().setValue(new Date);a.getGridUbicazione().setDisabled(!0)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore()})},
verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){a.getForm().up("window").close()}}});inserisciBottoni(b.boxBottoni,c);a.cbaConfig.mostraEsciGenerale||b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);a.getGridUbicazione().setDisabled(e);IsolaCmp(a.cbaConfig.controllerCatArtTes.getPnlUbicazione(),e)});a.cbaConfig.isWindow&&(b.boxBottoni.queryById("btnNuovo").hide(),b.boxBottoni.queryById("btnElimina").hide(),
b.boxBottoni.queryById("btnEsci").setVisible(!0))},aggiornaStore:function(a){var b=this,c=b.getForm(),d=c.getForm(),e=c.store;e.load({params:{idCatalogo:b.cbaConfig.recordTestata.get("id")},callback:function(g,h,k){k?Ext.isEmpty(g)?clearForm(c):(a||(a=d.findField("id").getValue()),g=trovaRecord(e,"id",a),h=b.getGridUbicazione(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(g?[g]:0)):msgShowError("",h.getError())}})},onLaunch:function(){ImpostaUrl(this.getGridUbicazione().getStore());
ImpostaUrl(this.getCBDeposito().getStore());this.getCBDeposito().getStore().getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione,tipoDeposito:this.cbaConfig.recordTestata.get("tipoArticolo")};this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.catalogoArticoli.store.AllegatiArticoli",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCatalogo"},{name:"idAllegato"},{name:"dataAllegato",type:"date"},{name:"desAllegato"},{name:"fileName"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/catalogoAllegati/get",api:{read:getUrlGen()+"/ws/catalogoAllegati/list",create:getUrlGen()+"/ws/catalogoAllegati/insert",update:getUrlGen()+"/ws/catalogoAllegati/update",destroy:getUrlGen()+
"/ws/catalogoAllegati/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CatalogoArticoliTes",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"descrizione"},{name:"tipoArticolo"},{name:"idGruppo"},{name:"idCategoria"},{name:"idUdm"},{name:"idUdmSomministra"},{name:"idAliquotaIva"},{name:"codBarre"},{name:"gestScadenza"},{name:"gestLotto"},{name:"deteriorabile"},{name:"note"},{name:"galenico"},{name:"presenzaFormulaPn"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogo/get",urlGen:"/ws/catalogo/get",reader:{type:"json",messageProperty:"message",
rootProperty:"data"},api:{read:getUrlGen()+"/ws/catalogo/get",create:getUrlGen()+"/ws/catalogo/insert",update:getUrlGen()+"/ws/catalogo/update",destroy:getUrlGen()+"/ws/catalogo/delete"}},autoDestroy:!0});Ext.define("GeneraliEC.catalogoArticoli.store.CboxArticoli",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/catalogo/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CboxArticoliRC",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/racArticoloUtente/cbox"}},a)])},autoDestroy:!0});Ext.define("GeneraliEC.catalogoArticoli.store.CboxCategorie",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/categorie/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CboxClassi",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore",convert:function(a,b){return traduci(a)}}],data:[["A","A"],["C","C"],["H","H"],["N","N"]],autoLoad:!0,autoDestroy:!0});Ext.define("GeneraliEC.catalogoArticoli.store.CboxDepositi",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/depositi/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CboxDepositiTs",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/depositi/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CboxGrpAtc",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/gruppiATC/cbox",urlGen:"/ws/gruppiATC/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CboxGruppi",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/gruppi/cbox"}},a)])},autoDestroy:!0});Ext.define("GeneraliEC.catalogoArticoli.store.CboxListino",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/catalogoListino/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CboxPrincipiAttivi",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/principiAttivi/cbox",urlGen:"/ws/principiAttivi/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CboxUbicazioni",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/ubicazioni/cbox",urlGen:"/ws/ubicazioni/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.CboxUniMis",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:"/cba/gen/ws/general/unimis/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.Contabilita",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCatalogo"},{name:"dataInizioUtilizzo",type:"date"},{name:"idConto"},{name:"desConto"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogoConto/list",urlGen:"/ws/catalogoConto/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/catalogoConto/list",create:getUrlGen()+"/ws/catalogoConto/insert",update:getUrlGen()+"/ws/catalogoConto/update",
destroy:getUrlGen()+"/ws/catalogoConto/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.DettagliArticolo",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCatalogo"},{name:"attivo"},{name:"scortaMinima"},{name:"scortaMassima"},{name:"livelloRiordino"},{name:"quantitaRiordino"},{name:"richiestaMotivata"},{name:"pianoTerapeutico"},{name:"idDeposito"},{name:"desDeposito"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogoDet/list",urlGen:"/ws/catalogoDet/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+
"/ws/catalogoDet/list",create:getUrlGen()+"/ws/catalogoDet/insert",update:getUrlGen()+"/ws/catalogoDet/update",destroy:getUrlGen()+"/ws/catalogoDet/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.Farmaco",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idCatalogo"},{name:"aic"},{name:"idPrincipioAttivo"},{name:"minSan"},{name:"classe"},{name:"dosaggio"},{name:"infoGlutine"},{name:"idGruppoAtc"},{name:"titolareAic"},{name:"tipoProdotto"},{name:"contenitore"},{name:"formaFarmaceutica"},{name:"desPrincipioAttivo"},{name:"idAtc1"},{name:"idAtc2"},{name:"idAtc3"},{name:"idAtc4"},{name:"idAtc5"},{name:"desAtc1"},{name:"desAtc2"},{name:"desAtc3"},
{name:"desAtc4"},{name:"desAtc5"},{name:"prontuario"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogoFarmaci/getByIdCatalogo",urlGen:"/ws/catalogoFarmaci/getByIdCatalogo",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/catalogoFarmaci/getByIdCatalogo",create:getUrlGen()+"/ws/catalogoFarmaci/insert",update:getUrlGen()+"/ws/catalogoFarmaci/update",destroy:getUrlGen()+"/ws/catalogoFarmaci/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.Formule",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCatalogo"},{name:"dataInizioUtilizzo",type:"date"},{name:"udmCarico"},{name:"tipoConvCarico"},{name:"numeroCarico"},{name:"udmScarico"},{name:"tipoConvScarico"},{name:"numeroScarico"},{name:"udmSomm"},{name:"tipoConvSomm"},{name:"numeroSomm"},{name:"desUdmCarico"},{name:"desUdmScarico"},{name:"desUdmSomm"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogoFormule/list",urlGen:"/ws/catalogoFormule/list",
reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/catalogoFormule/list",create:getUrlGen()+"/ws/catalogoFormule/insert",update:getUrlGen()+"/ws/catalogoFormule/update",destroy:getUrlGen()+"/ws/catalogoFormule/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.Listino",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCatalogo"},{name:"dataInizioUtilizzo",type:"date"},{name:"attivo"},{name:"idCliFor"},{name:"codArtFornitore"},{name:"codBarre"},{name:"prezzo"},{name:"sconto1"},{name:"sconto2"},{name:"ggApprovvigionamento"},{name:"desCliFor"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogoListino/list",urlGen:"/ws/catalogoListino/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},
api:{read:getUrlGen()+"/ws/catalogoListino/list",create:getUrlGen()+"/ws/catalogoListino/insert",update:getUrlGen()+"/ws/catalogoListino/update",destroy:getUrlGen()+"/ws/catalogoListino/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.Prontuario",{extend:"Generali.data.StoreJson",fields:[{name:"codProdotto"},{name:"descProdotto"}],constructor:function(a){var b=49==CBA.moduli.moduloAttivo?"/ws/genCss/farmadati/prontuario/list":"/ws/farmadati/prontuario/list";a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+b,extraParams:{hideInizioAttesa:!0}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.RicercaCatalogoArticoli",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"attivo"},{name:"descrizione"},{name:"tipoArticolo"},{name:"idGruppo"},{name:"idCategoria"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogo/list",urlGen:"/ws/catalogo/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/catalogo/list"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.RicercaCatalogoArticoliMovimentati",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"attivo"},{name:"descrizione"},{name:"tipoArticolo"},{name:"idGruppo"},{name:"idCategoria"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogo/listaMovimentati",urlGen:"/ws/catalogo/listaMovimentati",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/catalogo/listaMovimentati"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.store.Ubicazione",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCatalogo"},{name:"dataInizioUtilizzo",type:"date"},{name:"idDeposito"},{name:"idUbicazione"},{name:"desDeposito"},{name:"desUbicazione"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/catalogoUbicazioni/list",urlGen:"/ws/catalogoUbicazioni/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/catalogoUbicazioni/list",create:getUrlGen()+"/ws/catalogoUbicazioni/insert",
update:getUrlGen()+"/ws/catalogoUbicazioni/update",destroy:getUrlGen()+"/ws/catalogoUbicazioni/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.catalogoArticoli.view.AllegatiArticoli",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridAllegati",reference:"GridAllegati",overflowX:"hidden",overflowY:"auto",layout:{align:"stretch"},width:170,store:Ext.create("GeneraliEC.catalogoArticoli.store.AllegatiArticoli"),viewConfig:{loadMask:!1},title:"ALLEGATI",collapsible:!0,collapseDirection:"left",hideHeaders:!0,
columns:[{xtype:"actioncolumn",width:20,text:"",items:[{iconCls:"icon-allegato",isDisabled:function(a,b,c,d,e){return Ext.isEmpty(e.get("fileName"))}}]},{xtype:"gridcolumn",flex:1,dataIndex:"desAllegato"}]},{xtype:"splitter"},{xtype:"container",nonDisabilitare:!0,scrollable:!0,border:0,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",itemId:"Form",reference:"Form",nonDisabilitare:!0,scrollable:!0,padding:"15 0 0 10",border:0,layout:{type:"vbox",align:"stretch"},trackResetOnLoad:!0,
items:[{xtype:"numberfield",hidden:!0,name:"id"},{xtype:"numberfield",hidden:!0,name:"idAllegato"},{xtype:"numberfield",hidden:!0,name:"idCatalogo"},{xtype:"datefield",itemId:"Data",reference:"Data",maxWidth:180,fieldLabel:"DATA",labelWidth:70,labelClsExtra:"cbaLabel",allowBlank:!1,selectOnFocus:!0,name:"dataAllegato"},{xtype:"textfield",itemId:"TxtDescrizione",reference:"TxtDescrizione",name:"desAllegato",fieldLabel:"DESCRIZIONE",maxLength:100,enforceMaxLength:!0,labelClsExtra:"cbaLabel",allowBlank:!1,
maxWidth:370,labelWidth:70},{xtype:"displayfield",itemId:"TxtFileName",reference:"TxtFileName",name:"fileName",labelClsExtra:"cbaLabel",maxLength:100,enforceMaxLength:!0,maxWidth:370,editable:!1}]},{xtype:"container",itemId:"CntAllegato",reference:"CntAllegato",flex:1,layout:{type:"fit"},items:[{xtype:"form",itemId:"FormAllegato",reference:"FormAllegato",border:!1,padding:5,bodyPadding:"5 0 0 0",layout:"hbox",items:[{xtype:"filefield",itemId:"AllegatoUpload",reference:"AllegatoUpload",baseCls:"cba-button-25",
buttonOnly:!0,name:"fileData",buttonConfig:{xtype:"filebutton",margin:"0 0 1 0",cls:"cba-button-25",alwaysOnTop:!0,itemId:"BtnAllega",reference:"BtnAllega",text:traduci("ALLEGA_FILE"),iconCls:"icon-allegato"},listeners:{afterrender:function(a){a.fileInputEl.set({accept:StdSipcar.getValidExtensions()})}}},{xtype:"button",itemId:"BtnEliminaAllegato",reference:"BtnEliminaAllegato",cls:"cba-button-25",iconCls:"icon-elimina",margin:"0 0 1 0",text:"ELIMINA",hidden:!0}]}]}]},{xtype:"container",itemId:"CntAnteprima",
reference:"CntAnteprima",border:0,flex:2,layout:{type:"fit"}},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.CatalogoArticoliTes",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",title:"CATALOGO_ARTICOLI",border:0,itemId:"CntCatalogoArticoliTes",reference:"CntCatalogoArticoliTes",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"form",border:0,flex:1,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"hbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"container",
layout:{type:"vbox"},flex:1,items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0},{xtype:"cbaMultipleChoice",itemId:"CntMagazzinoFarmacia",reference:"CntMagazzinoFarmacia",style:{border:"0px!important"},cbaConfig:{itemsCfg:[{html:traduci("MAGAZZINO"),name:"magazzino",itemId:"CmcMagazzino",reference:"CmcMagazzino",isFormField:49==CBA.moduli.moduloAttivo?!1:!0,inputValue:"M",width:120},{html:traduci("FARMACIA"),name:"farmacia",itemId:"CmcFarmacia",reference:"CmcFarmacia",isFormField:!0,inputValue:"F",
width:120}],esclusivo:49==CBA.moduli.moduloAttivo}},{xtype:"textfield",width:800,labelWidth:140,fieldLabel:"ARTICOLO",itemId:"TxDescrizione",reference:"TxDescrizione",name:"descrizione",labelClsExtra:"cbaLabel",allowBlank:!1,maxLength:100,enforceMaxLength:!0,enableKeyEvents:!0},{xtype:"combobox",width:460,fieldLabel:"UNIMIS_PRINCIPALE",labelClsExtra:"cbaLabel",labelWidth:140,itemId:"CBUniMisPrincipale",reference:"CBUniMisPrincipale",name:"idUdm",displayField:"valore",minChars:0,queryMode:"local",
valueField:"codice",allowBlank:49==CBA.moduli.moduloAttivo?!0:!1,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxUniMis",{autoLoad:!0})},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"combobox",width:460,fieldLabel:"UNIMIS_SOMMINISTRA",labelClsExtra:"cbaLabel",labelWidth:140,itemId:"CBUniMisSomministra",reference:"CBUniMisSomministra",name:"idUdmSomministra",displayField:"valore",minChars:0,queryMode:"local",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxUniMis",
{autoLoad:!0})},{xtype:"checkboxfield",itemId:"CbxGalenico",reference:"CbxGalenico",cls:"cbaLabel",fieldLabel:"galenico",boxLabel:"",inputValue:"T",uncheckedValue:"F",name:"galenico",hidden:!0},{xtype:"label",itemId:"LblGalenico",reference:"LblGalenico",text:"FARMACO_GALENICO",margin:"0 0 0 30",style:{color:"blue","font-weight":"bold"}}]}]},{xtype:"label",margin:"112 0 0 0",width:22,height:22,cls:"icon-info",hidden:58==CBA.moduli.moduloAttivo?!0:!1,listeners:{afterrender:function(){this.getEl().dom.setAttribute("data-qtip",
traduci("MSG_IMPORTA_FARMACI"))}}},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]},{xtype:"container",flex:3,layout:{type:"vbox",align:"stretch"},items:[{xtype:"tabpanel",itemId:"TabPaginatore",reference:"TabPaginatore",flex:1,items:[{xtype:"panel",itemId:"PnlInfoGen",reference:"PnlInfoGen",title:"INFORMAZIONI_GENERALI",layout:{type:"fit"}},{xtype:"panel",itemId:"PnlDetArticolo",reference:"PnlDetArticolo",title:"DETTAGLIO_ARTICOLO",hidden:49==CBA.moduli.moduloAttivo?!0:
!1,layout:{type:"fit"}},{xtype:"panel",itemId:"PnlFormule",reference:"PnlFormule",title:"FORMULE",layout:{type:"fit"}},{xtype:"panel",itemId:"PnlListino",reference:"PnlListino",title:"LISTINO",hidden:49==CBA.moduli.moduloAttivo?!0:!1,layout:{type:"fit"}},{xtype:"panel",itemId:"PnlFarmaco",reference:"PnlFarmaco",title:"CARATTERISTICHE_FARMACO",layout:{type:"fit"}},{xtype:"panel",itemId:"PnlBugiardino",reference:"PnlBugiardino",title:"TERAPIE_FOGLIETTO_ILLUSTRATIVO",hidden:!0,layout:{type:"fit"}},{xtype:"panel",
itemId:"PnlContabilita",reference:"PnlContabilita",title:"CONTABILITA",hidden:49==CBA.moduli.moduloAttivo?!0:!1,layout:{type:"fit"}},{xtype:"panel",itemId:"PnlUbicazione",reference:"PnlUbicazione",title:"UBICAZIONE",hidden:49==CBA.moduli.moduloAttivo?!0:!1,layout:{type:"fit"}},{xtype:"panel",itemId:"PnlAllegati",reference:"PnlAllegati",title:"ALLEGATI",hidden:49==CBA.moduli.moduloAttivo?!0:!1,layout:{type:"fit"}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.Contabilita",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridContabilita",reference:"GridContabilita",width:120,store:Ext.create("GeneraliEC.catalogoArticoli.store.Contabilita"),columns:[{xtype:"datecolumn",dataIndex:"dataInizioUtilizzo",text:"INIZIO_UTILIZZO",flex:1,format:"d/m/Y",align:"center"}],dockedItems:[],viewConfig:{loadMask:!1}},
{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",itemId:"Form",reference:"Form",border:0,autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"datefield",itemId:"EdtDtInizio",reference:"EdtDtInizio",fieldLabel:"INIZIO_UTILIZZO",name:"dataInizioUtilizzo",labelClsExtra:"cbaLabel",allowBlank:!1,labelWidth:85,width:200},{xtype:"fieldset",title:"ECONOMICA",
flex:1,bodyPadding:10,items:[{xtype:"combobox",width:400,fieldLabel:"CONTO",labelClsExtra:"cbaLabel",labelWidth:85,itemId:"CBConto",reference:"CBConto",name:"idConto",displayField:"valore",queryParam:"descrizione",valueField:"codice",minChars:3,store:Ext.create("Generali.pianodeiconti.store.DesSottoconto")}]}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.CopiaArticolo",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,flex:1,bodyPadding:10,layout:{align:"stretch",type:"vbox"},dockedItems:[{xtype:"toolbar",dock:"top",height:48,items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok32",scale:"large",text:"COPIA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-annulla32",scale:"large",text:"ANNULLA"}]}],
items:[{xtype:"textfield",width:500,labelWidth:70,fieldLabel:"ARTICOLO",itemId:"TxDescrizione",reference:"TxDescrizione",labelClsExtra:"cbaLabel",allowBlank:!1,maxLength:100,enforceMaxLength:!0,enableKeyEvents:!0},{xtype:"fieldset",title:"PARAMETRI_DA_COPIARE",layout:{type:"vbox"},items:[{xtype:"checkboxfield",itemId:"CbxInfoGen",reference:"CbxInfoGen",boxLabel:"INFORMAZIONI_GENERALI",checked:!0,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxDetArt",reference:"CbxDetArt",boxLabel:"DETTAGLIO_ARTICOLO",
checked:49==CBA.moduli.moduloAttivo?!1:!0,hidden:49==CBA.moduli.moduloAttivo?!0:!1,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxFormule",reference:"CbxFormule",boxLabel:"FORMULE",checked:49==CBA.moduli.moduloAttivo?!1:!0,hidden:49==CBA.moduli.moduloAttivo?!0:!1,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxListino",reference:"CbxListino",boxLabel:"LISTINO",checked:49==CBA.moduli.moduloAttivo?!1:!0,hidden:49==CBA.moduli.moduloAttivo?!0:!1,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxFarmaco",
reference:"CbxFarmaco",boxLabel:"CARATTERISTICHE_FARMACO",checked:!0,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxContabilita",reference:"CbxContabilita",boxLabel:"CONTABILITA",checked:49==CBA.moduli.moduloAttivo?!1:!0,hidden:49==CBA.moduli.moduloAttivo?!0:!1,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxUbicazione",reference:"CbxUbicazione",boxLabel:"UBICAZIONE",checked:49==CBA.moduli.moduloAttivo?!1:!0,hidden:49==CBA.moduli.moduloAttivo?!0:!1,cls:"cbaLabel"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.DettagliArticolo",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",height:200,itemId:"GridDetArt",reference:"GridDetArt",store:Ext.create("GeneraliEC.catalogoArticoli.store.DettagliArticolo"),flex:1,columns:[{xtype:"gridcolumn",width:60,align:"center",sortable:!1,dataIndex:"attivo",text:"ATTIVO",renderer:function(a,b){renderCheckColumn(b,a)},editor:{xtype:"checkboxfield",
inputValue:"T",uncheckedValue:"F",itemId:"ChbAttivo",reference:"ChbAttivo"}},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"SCORTA_MINIMA",dataIndex:"scortaMinima",renderer:cell_renderer_prezzo,editor:{xtype:"numberfield",selectOnFocus:!0,minValue:0,decimalPrecision:5}},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"SCORTA_MASSIMA",dataIndex:"scortaMassima",renderer:cell_renderer_prezzo,editor:{xtype:"numberfield",selectOnFocus:!0,minValue:0,decimalPrecision:5}},{xtype:"gridcolumn",
width:90,align:"center",sortable:!1,text:"LIVELLO_RIORDINO",dataIndex:"livelloRiordino",renderer:cell_renderer_prezzo,editor:{xtype:"numberfield",selectOnFocus:!0,minValue:0,decimalPrecision:5}},{xtype:"gridcolumn",width:95,align:"center",sortable:!1,text:"QTA_DA_ORDINARE",dataIndex:"quantitaRiordino",renderer:cell_renderer_prezzo,editor:{xtype:"numberfield",selectOnFocus:!0,minValue:0,decimalPrecision:5}},{xtype:"gridcolumn",width:85,align:"center",sortable:!1,dataIndex:"richiestaMotivata",text:"RICHIESTA_MOTIVATA",
itemId:"ChbRicMot",reference:"ChbRicMot",renderer:function(a,b){renderCheckColumn(b,a)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",width:105,align:"center",sortable:!1,dataIndex:"pianoTerapeutico",text:"PIANO_TERAPEUTICO",itemId:"ChbPianoTer",reference:"ChbPianoTer",renderer:function(a,b){renderCheckColumn(b,a)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F"}},{xtype:"gridcolumn",text:"DEPOSITO",sortable:!1,minWidth:200,flex:1,dataIndex:"idDeposito",
editor:{xtype:"combobox",displayField:"valore",valueField:"codice",queryParam:"descrizione",minChars:0,emptyText:"Tutti i Depositi"},renderer:function(a,b,c,d,e,g,h){return c.get("desDeposito")?c.get("desDeposito"):"Tutti i Depositi"}}],viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},
{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.Farmaco",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"textfield",
fieldLabel:"ID",name:"idCatalogo",reference:"txIdCatalogo",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"combobox",width:320,fieldLabel:"PRINCIPIO_ATTIVO",labelClsExtra:"cbaLabel",labelWidth:100,itemId:"CBPrincAtt",reference:"CBPrincAtt",name:"idPrincipioAttivo",displayField:"valore",queryParam:"descrizione",valueField:"codice",minChars:3,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxPrincipiAttivi")},{xtype:"container",margin:"5 0 0 0",layout:{type:"hbox"},
items:[{xtype:"textfield",width:300,labelWidth:70,fieldLabel:"AIC",itemId:"TxAic",reference:"TxAic",name:"aic",labelClsExtra:"cbaLabel",maxLength:9,readOnly:!0,enforceMaxLength:!0,margin:"0 0 0 20"},{xtype:"button",itemId:"BtnCollega",reference:"BtnCollega",text:"COLLEGA_FARMACO"}]}]},{xtype:"container",margin:"5 0 0 0",layout:{type:"hbox"},items:[{xtype:"textfield",width:320,labelWidth:100,fieldLabel:"MIN_SAN",itemId:"TxMinSan",reference:"TxMinSan",name:"minSan",labelClsExtra:"cbaLabel",maxLength:10,
enforceMaxLength:!0,enableKeyEvents:!0},{xtype:"combobox",width:150,fieldLabel:"CLASSE",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBClasse",reference:"CBClasse",name:"classe",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxClassi",{autoload:!0}),margin:"0 0 0 20"}]},{xtype:"container",margin:"5 0 0 0",layout:{type:"hbox"},items:[{xtype:"numberfield",width:320,labelWidth:100,fieldLabel:"DOSAGGIO",itemId:"TxDosaggio",reference:"TxDosaggio",
name:"dosaggio",labelClsExtra:"cbaLabel",maxLength:30,enforceMaxLength:!0,enableKeyEvents:!0},{xtype:"textfield",width:300,labelWidth:70,fieldLabel:"INFO_GLUTINE",itemId:"TxInfoGlutine",reference:"TxInfoGlutine",name:"infoGlutine",labelClsExtra:"cbaLabel",maxLength:30,enforceMaxLength:!0,enableKeyEvents:!0,margin:"0 0 0 20",readOnly:!0}]},{xtype:"container",margin:"10 0 0 0",layout:{type:"hbox"},items:[{xtype:"fieldset",title:"GRUPPI_ATC",layout:{type:"vbox"},items:[{xtype:"combobox",width:310,fieldLabel:"1_LIVELLO",
labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBGrpAtc1",reference:"CBGrpAtc1",name:"idAtc1",displayField:"valore",queryParam:"descrizione",valueField:"codice",minChars:3,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGrpAtc")},{xtype:"combobox",width:310,fieldLabel:"2_LIVELLO",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBGrpAtc2",reference:"CBGrpAtc2",name:"idAtc2",displayField:"valore",queryMode:"local",valueField:"codice",minChars:3,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGrpAtc")},
{xtype:"combobox",width:310,fieldLabel:"3_LIVELLO",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBGrpAtc3",reference:"CBGrpAtc3",name:"idAtc3",displayField:"valore",queryMode:"local",valueField:"codice",minChars:3,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGrpAtc")},{xtype:"combobox",width:310,fieldLabel:"4_LIVELLO",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBGrpAtc4",reference:"CBGrpAtc4",name:"idAtc4",displayField:"valore",queryMode:"local",valueField:"codice",minChars:3,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGrpAtc")},
{xtype:"combobox",width:310,fieldLabel:"5_LIVELLO",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBGrpAtc5",reference:"CBGrpAtc5",name:"idAtc5",displayField:"valore",queryMode:"local",valueField:"codice",minChars:3,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGrpAtc")}]},{xtype:"fieldset",title:"ULTERIORI_INFO",margin:"0 0 0 20",layout:{type:"vbox"},items:[{xtype:"textfield",width:330,labelWidth:130,fieldLabel:"DITTA_TITOLARE_AIC",itemId:"TxDittaAic",reference:"TxDittaAic",name:"titolareAic",
labelClsExtra:"cbaLabel",readOnly:!0},{xtype:"textfield",width:330,labelWidth:130,fieldLabel:"TIPO_PRODOTTO",itemId:"TxTipoProdotto",reference:"TxTipoProdotto",name:"tipoProdotto",labelClsExtra:"cbaLabel",readOnly:!0},{xtype:"textfield",width:330,labelWidth:130,fieldLabel:"CONTENITORE",itemId:"TxContenitore",reference:"TxContenitore",name:"contenitore",labelClsExtra:"cbaLabel",readOnly:!0},{xtype:"textfield",width:330,labelWidth:130,fieldLabel:"FORMA_FARMACEUTICA",itemId:"TxFormaFarm",reference:"TxFormaFarm",
name:"formaFarmaceutica",labelClsExtra:"cbaLabel",isFormField:"T"==this.cbaConfig.recordTestata.get("galenico")?!1:!0,readOnly:!0,hidden:!0},{xtype:"combobox",padding:"5 0 5 0",emptyText:"MINIMO_3_PER_RICERCARE",minChars:3,labelWidth:130,displayField:"valore",queryMode:"local",queryParam:"descrizione",valueField:"valore",store:Ext.create("Generali.store.FormaFarmaceutica"),name:"formaFarmaceutica",itemId:"CboxFormaFarm",reference:"CboxFormaFarm",isFormField:"T"==this.cbaConfig.recordTestata.get("galenico")?
!0:!1,labelClsExtra:"cbaLabel",fieldLabel:"FORMA_FARMACEUTICA",listConfig:{minWidth:350},tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<tpl if="codice==-1">','<div style="color:#878787;" class="x-boundlist-item"><i>{valore}</i></div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>"),cbaConfig:{descrCampo:"TUTTI_GLI_UTENTI",valueField:"codice",displayField:"valore"}}]}]},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"IN_TERAPIA",inputValue:"T",uncheckedValue:"F",
name:"prontuario"},{xtype:"container",itemId:"CntFormulaPn",reference:"CntFormulaPn",layout:{type:"hbox"},items:[{xtype:"textfield",width:430,labelWidth:160,fieldLabel:"FORMULA_SOMMINISTRAZIONE",itemId:"TxFormulaPn",reference:"TxFormulaPn",labelClsExtra:"cbaLabel",maxLength:30,enforceMaxLength:!0,enableKeyEvents:!0,margin:"0 0 0 00",readOnly:!0,isFormField:!1},{xtype:"label",margin:"0 0 0 5",width:22,height:22,cls:"icon-info",listeners:{afterrender:function(){this.getEl().dom.setAttribute("data-qtip",
traduci("MSG_FORMULA_SOMMINISTRAZIONE"))}}}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.Formule",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridFormule",reference:"GridFormule",width:120,store:Ext.create("GeneraliEC.catalogoArticoli.store.Formule"),columns:[{xtype:"datecolumn",dataIndex:"dataInizioUtilizzo",text:"INIZIO_UTILIZZO",flex:1,format:"d/m/Y",align:"center"}],dockedItems:[],viewConfig:{loadMask:!1}},{xtype:"container",
flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",itemId:"Form",reference:"Form",border:0,autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"datefield",itemId:"EdtDtInizio",reference:"EdtDtInizio",fieldLabel:"INIZIO_UTILIZZO",name:"dataInizioUtilizzo",labelClsExtra:"cbaLabel",allowBlank:!1,labelWidth:85,width:200},{xtype:"fieldset",title:"CARICHI",flex:1,bodyPadding:10,
items:[{xtype:"combobox",width:400,fieldLabel:"UNIMIS",labelClsExtra:"cbaLabel",labelWidth:100,itemId:"CBUniMisCarico",reference:"CBUniMisCarico",name:"udmCarico",displayField:"valore",minChars:0,queryParam:"descrizione",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxUniMis")},{xtype:"fieldset",title:"TIPO_CONVERSIONE",layout:{align:"stretch",type:"hbox"},items:[{xtype:"radiogroup",columns:2,width:170,itemId:"RgbConvCar",reference:"RgbConvCar",items:[{boxLabel:"DIVIDI",
name:"tipoConvCarico",inputValue:"D",cls:"cbaLabel"},{boxLabel:"MOLTIPLICA",name:"tipoConvCarico",inputValue:"M",cls:"cbaLabel"}]},{xtype:"numberfield",itemId:"TxNumCarico",reference:"TxNumCarico",fieldLabel:"NUMERO",name:"numeroCarico",labelClsExtra:"cbaLabel",labelWidth:60,width:180,minValue:0,decimalPrecision:5,validator:function(a){return 1==a?traduci("VALORE_NON_AMMESSO"):!0}}]},{xtype:"label",itemId:"LblEsempioCar",reference:"LblEsempioCar",name:"esempioCar",text:"Esempio:",style:{"font-weight":"bold"}}]},
{xtype:"fieldset",title:"SCARICHI",flex:1,bodyPadding:10,items:[{xtype:"combobox",width:400,fieldLabel:"UNIMIS",labelClsExtra:"cbaLabel",labelWidth:100,itemId:"CBUniMisScarico",reference:"CBUniMisScarico",name:"udmScarico",displayField:"valore",minChars:0,queryParam:"descrizione",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxUniMis")},{xtype:"fieldset",title:"TIPO_CONVERSIONE",layout:{align:"stretch",type:"hbox"},items:[{xtype:"radiogroup",columns:2,width:170,itemId:"RgbConvSca",
reference:"RgbConvSca",items:[{boxLabel:"DIVIDI",name:"tipoConvScarico",inputValue:"D",cls:"cbaLabel"},{boxLabel:"MOLTIPLICA",name:"tipoConvScarico",inputValue:"M",cls:"cbaLabel"}]},{xtype:"numberfield",itemId:"TxNumScarico",reference:"TxNumScarico",fieldLabel:"NUMERO",name:"numeroScarico",labelClsExtra:"cbaLabel",labelWidth:60,width:180,minValue:0,decimalPrecision:5,validator:function(a){return 1==a?traduci("VALORE_NON_AMMESSO"):!0}}]},{xtype:"label",itemId:"LblEsempioSca",reference:"LblEsempioSca",
text:"Esempio:",style:{"font-weight":"bold"}}]},{xtype:"fieldset",title:"SOMMINISTRAZIONE",itemId:"FsFormulaSomm",reference:"FsFormulaSomm",flex:1,bodyPadding:10,items:[{xtype:"combobox",width:400,fieldLabel:"UNIMIS",labelClsExtra:"cbaLabel",labelWidth:100,itemId:"CBUniMisSomm",reference:"CBUniMisSomm",name:"udmSomm",displayField:"valore",minChars:0,queryParam:"descrizione",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxUniMis")},{xtype:"fieldset",title:"TIPO_CONVERSIONE",
layout:{align:"stretch",type:"hbox"},items:[{xtype:"radiogroup",columns:2,width:170,itemId:"RgbConvSomm",reference:"RgbConvSomm",items:[{boxLabel:"DIVIDI",name:"tipoConvSomm",inputValue:"D",cls:"cbaLabel"},{boxLabel:"MOLTIPLICA",name:"tipoConvSomm",inputValue:"M",cls:"cbaLabel"}]},{xtype:"numberfield",itemId:"TxNumSomm",reference:"TxNumSomm",fieldLabel:"NUMERO",name:"numeroSomm",labelClsExtra:"cbaLabel",labelWidth:60,width:180,minValue:0,decimalPrecision:5,validator:function(a){return 1==a?traduci("VALORE_NON_AMMESSO"):
!0}}]},{xtype:"label",itemId:"LblEsempioSomm",reference:"LblEsempioSomm",text:"Esempio:",style:{"font-weight":"bold"}}]}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.InfoGenerali",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"form",flex:1,border:0,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",itemId:"TxId",reference:"TxId",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},
{xtype:"combobox",width:380,fieldLabel:"ALIQUOTA_IVA",labelWidth:90,labelClsExtra:"cbaLabel",itemId:"CBAliIva",reference:"CBAliIva",name:"idAliquotaIva",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("Generali.aliquotaiva.store.cboxAliquotaIva"),allowBlank:49==CBA.moduli.moduloAttivo?!0:!1},{xtype:"combobox",width:380,fieldLabel:"GRUPPO",labelClsExtra:"cbaLabel",labelWidth:90,itemId:"CBGruppo",reference:"CBGruppo",name:"idGruppo",displayField:"valore",minChars:0,queryMode:"local",
valueField:"codice",allowBlank:49==CBA.moduli.moduloAttivo?!0:!1,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGruppi")},{xtype:"combobox",width:380,fieldLabel:"CATEGORIA",labelClsExtra:"cbaLabel",labelWidth:90,itemId:"CBCategoria",reference:"CBCategoria",name:"idCategoria",minChars:0,queryMode:"local",valueField:"codice",displayField:"valore",allowBlank:49==CBA.moduli.moduloAttivo?!0:!1,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxCategorie")},{xtype:"textfield",width:380,labelWidth:90,
fieldLabel:"COD_BARRE",itemId:"TxCodBarre",reference:"TxCodBarre",name:"codBarre",labelClsExtra:"cbaLabel",maxLength:50,enforceMaxLength:!0,enableKeyEvents:!0},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"OBBLIGA_DATA_SCADENZA",inputValue:"T",uncheckedValue:"F",name:"gestScadenza"},{xtype:"checkboxfield",cls:"cbaLabel",fieldLabel:"",boxLabel:"OBBLIGA_GESTIONE_LOTTO",inputValue:"T",uncheckedValue:"F",name:"gestLotto"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChbDeteriorabile",
reference:"ChbDeteriorabile",fieldLabel:"",boxLabel:"DETERIORABILE",inputValue:"T",uncheckedValue:"F",name:"deteriorabile"},{xtype:"container",hidden:!CBA.moduli.modulo60.installato,layout:{type:"hbox"},items:[{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChbPropostaAuto",reference:"ChbPropostaAuto",fieldLabel:"",boxLabel:"PROPOSTA_ORDINE_AUTOMATICA",inputValue:"T",uncheckedValue:"F",name:"propostaAutomatica"},{xtype:"label",margin:"0 0 0 5",width:22,height:22,cls:"icon-info",listeners:{afterrender:function(){this.getEl().dom.setAttribute("data-qtip",
traduci("MSG_PROPOSTA_ORDINE_AUTOMATICA"))}}}]},{xtype:"textareafield",itemId:"TxNote",reference:"TxNote",height:60,width:380,labelWidth:40,fieldLabel:"NOTE",enforceMaxLength:!0,maxLength:255,name:"note",labelClsExtra:"cbaLabel"}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.Listino",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",height:200,itemId:"GridListino",reference:"GridListino",store:Ext.create("GeneraliEC.catalogoArticoli.store.Listino"),flex:1,columns:[{xtype:"datecolumn",dataIndex:"dataInizioUtilizzo",text:"INIZIO_UTILIZZO",width:90,format:"d/m/Y",align:"center",editor:{xtype:"datefield",allowBlank:!1}},{xtype:"gridcolumn",
width:50,align:"center",sortable:!1,dataIndex:"attivo",text:"ATTIVO",renderer:function(a,b){renderCheckColumn(b,a)},editor:{xtype:"checkboxfield",inputValue:"T",uncheckedValue:"F",itemId:"ChbAttivo",reference:"ChbAttivo"}},{xtype:"gridcolumn",text:"FORNITORE",sortable:!1,minWidth:200,flex:1,dataIndex:"idCliFor",editor:{xtype:"combobox",displayField:"valore",valueField:"codice",queryParam:"descrizione",minChars:3,allowBlank:!1},renderer:function(a,b,c,d,e,g,h){if(c.get("desCliFor"))return c.get("desCliFor")}},
{xtype:"gridcolumn",width:100,align:"center",sortable:!1,text:"CODICE_ARTICOLO_FOR",dataIndex:"codArtFornitore",editor:{xtype:"textfield",selectOnFocus:!0,maxLength:20,enforceMaxLength:!0}},{xtype:"gridcolumn",width:110,align:"center",sortable:!1,text:"CODICE_BARRE",dataIndex:"codBarre",editor:{xtype:"textfield",selectOnFocus:!0,maxLength:32,enforceMaxLength:!0}},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"PREZZO",dataIndex:"prezzo",renderer:cell_renderer_prezzo,editor:{xtype:"numberfield",
selectOnFocus:!0,decimalPrecision:5}},{text:"SCONTO_PERC",columns:[{xtype:"gridcolumn",width:50,align:"center",sortable:!1,dataIndex:"sconto1",renderer:cell_renderer_importo,editor:{xtype:"numberfield",selectOnFocus:!0}},{xtype:"gridcolumn",width:50,align:"center",sortable:!1,dataIndex:"sconto2",renderer:cell_renderer_importo,editor:{xtype:"numberfield",selectOnFocus:!0}}]},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"GIORNI_APPROVIGIONAMENTO",dataIndex:"ggApprovvigionamento",renderer:cell_renderer_numero,
editor:{xtype:"textfield",fieldStyle:"text-align: right;",selectOnFocus:!0}}],viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"CheckPrezzoAttivo",
reference:"CheckPrezzoAttivo",width:60,boxLabel:"CHECK_PREZZO_ATTIVO",inputValue:"T",uncheckedValue:"F",checked:!0}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.PnlCatalogoArticoli",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"CntPrincipale",reference:"CntPrincipale",layout:{align:"stretch",type:"hbox"},items:[{xtype:"panel",itemId:"CntRicerca",reference:"CntRicerca",split:!0,collapsible:!0,collapseDirection:"left",title:"RICERCA",border:0,layout:"fit",width:340},{xtype:"splitter"},{xtype:"container",itemId:"CntDati",reference:"CntDati",
layout:"fit",flex:1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.Prontuario",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"PnlProntuario",reference:"PnlProntuario",border:0,flex:1,layout:{align:"stretch",type:"vbox"},listeners:{afterrender:function(a){a.down("#TxtNomeFarmaco").focus()}},items:[{xtype:"container",layout:"hbox",margin:5,items:[{xtype:"container",layout:"hbox",flex:1,items:[{xtype:"textfield",itemId:"TxtNomeFarmaco",reference:"TxtNomeFarmaco",
emptyText:"Inserire 3 caratteri",fieldLabel:"DESCRIZIONE",labelClsExtra:"cbaLabel",margin:"0 5 0 0",flex:1},{xtype:"textfield",itemId:"TxtAicFarmaco",reference:"TxtAicFarmaco",emptyText:"Inserire 3 caratteri",fieldLabel:"ORD_TER_AIC",labelClsExtra:"cbaLabel",margin:"0 5 0 0",flex:1}]},{xtype:"form",itemId:"FormImporta",reference:"FormImporta",border:!1,layout:"hbox",items:[{xtype:"filefield",itemId:"ImportaUpload",reference:"ImportaUpload",margin:"auto 15 auto auto",baseCls:"cba-button-25",buttonOnly:!0,
name:"fileData",focusable:!1,buttonConfig:{xtype:"filebutton",cls:"cba-button-25",itemId:"BtnImporta",reference:"BtnImporta",text:traduci("IMPORTA_DA_FILE")},listeners:{afterrender:function(a){a.fileInputEl.set({accept:".txt"})}}},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esciGriglia",cls:"cba-button-25",text:"ESCI"}]}]},{xtype:"gridpanel",itemId:"GridProntuario",reference:"GridProntuario",store:Ext.create("GeneraliEC.catalogoArticoli.store.Prontuario",{autoLoad:!1}),autoScroll:"vertical",
scrollable:!0,cbaPaged:!0,leadingBufferZone:50,trailingBufferZone:30,flex:1,columns:{defaults:{variableRowHeight:!0},items:[{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"descProdotto",flex:1,renderer:function(a,b,c,d,e,g,h){var k="";Ext.isEmpty(c.get("descDitta"))||(k='<span style="font-style: italic; color: #808080">('+c.get("descDitta")+")</span>");return cell_renderer_stringa("<span>"+a+"</span> "+k,b,c,d,e,g,h)}},{xtype:"gridcolumn",text:"TIPO_PRODOTTO",dataIndex:"tipoProdotto",flex:1,renderer:cell_renderer_stringa},
{xtype:"gridcolumn",text:"ORD_TER_AIC",dataIndex:"codProdotto",renderer:cell_renderer_stringa}]},viewConfig:{trackOver:!1,loadMask:!1,preserveScrollOnRefresh:!1}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.RicercaCatalogoArticoli",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",flex:1,itemId:"Form",reference:"Form",noModificaDati:!0,border:0,frame:!1,layout:{align:"stretch",type:"vbox"},trackResetOnLoad:!0,items:[{xtype:"panel",itemId:"CntRicerca",reference:"CntRicerca",nonDisabilitare:!0,padding:"5 5 0 5",padding:5,fieldDefaults:{margin:"0 5 5 0"},border:0,layout:{type:"vbox",align:"stretch"},
items:[{xtype:"checkboxgroup",flex:1,margin:"0 0 5 0",labelClsExtra:"cbaLabel",items:[{xtype:"checkboxfield",itemId:"CbxAttivo",reference:"CbxAttivo",boxLabel:"ATTIVO",checked:!0,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxNonAttivo",reference:"CbxNonAttivo",boxLabel:"NON_ATTIVO",checked:!0,cls:"cbaLabel"}]},{xtype:"textfield",itemId:"TxtCercaArticolo",reference:"TxtCercaArticolo",flex:1,fieldLabel:"",emptyText:"CERCA",enableKeyEvents:!0,labelClsExtra:"cbaLabel"},{xtype:"combobox",width:305,
fieldLabel:"GRUPPO",labelClsExtra:"cbaLabel",labelWidth:65,itemId:"CbGruppo",reference:"CbGruppo",displayField:"valore",minChars:0,queryParam:"descrizione",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGruppi")},{xtype:"combobox",width:305,fieldLabel:"CATEGORIA",labelClsExtra:"cbaLabel",labelWidth:65,itemId:"CbCategoria",reference:"CbCategoria",displayField:"valore",queryMode:"local",valueField:"codice",minChars:0,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxCategorie")},
{xtype:"combobox",width:305,fieldLabel:"PRINCIPIO_ATTIVO",labelClsExtra:"cbaLabel",labelWidth:65,itemId:"CbPrincAtt",reference:"CbPrincAtt",displayField:"valore",queryMode:"local",valueField:"codice",minChars:3,emptyText:"PRINC_ATT_MIN_3_CHARS",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxPrincipiAttivi")},{xtype:"combobox",labelWidth:65,width:305,fieldLabel:"FORNITORE",labelClsExtra:"cbaLabel",itemId:"CBFornitore",reference:"CBFornitore",displayField:"valore",queryParam:"descrizione",
valueField:"codice",store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor"),minChars:3},{xtype:"textfield",itemId:"TxtAic",reference:"TxtAic",flex:1,fieldLabel:"",minChars:3,emptyText:"CODICE_AIC",enableKeyEvents:!0,labelClsExtra:"cbaLabel"},{xtype:"checkboxgroup",flex:1,margin:"0 0 5 0",labelClsExtra:"cbaLabel",items:[{xtype:"checkboxfield",itemId:"CbxMag",reference:"CbxMag",boxLabel:"MAGAZZINO",checked:!0,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxFar",reference:"CbxFar",boxLabel:"FARMACIA",
checked:!0,cls:"cbaLabel"}]},{xtype:"panel",border:0,height:45,layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",cls:"btnLarge",itemId:"BtnCerca",reference:"BtnCerca",margin:"0 5 0 0",width:80,iconCls:"icon-ricerca",scale:"large",text:"CERCA",tooltip:"EFFETTUA_RICERCA"},{xtype:"button",cls:"btnLarge",itemId:"BtnCopia",reference:"BtnCopia",formBind:!0,margin:"0 5 0 0",width:80,iconCls:"icon-copia",scale:"large",text:"COPIA",tooltip:"Copia"},{xtype:"container",flex:1}]}]},{xtype:"panel",flex:1,
border:0,layout:{type:"vbox",align:"stretch"},title:"RISULTATI",items:[{xtype:"gridpanel",border:0,autoScroll:!0,flex:1,itemId:"GridRicerca",reference:"GridRicerca",title:"",columns:[{xtype:"gridcolumn",dataIndex:"descrizione",align:"left",text:"ARTICOLO",flex:1}],viewConfig:{border:0,loadMask:!1,getRowClass:function(a,b){if("F"==a.get("attivo"))return"non_attivi"}},dockedItems:[{xtype:"pagingtoolbar",dock:"bottom",itemId:"PTRicerca",reference:"PTRicerca"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.catalogoArticoli.view.Ubicazione",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridUbicazione",reference:"GridUbicazione",width:120,store:Ext.create("GeneraliEC.catalogoArticoli.store.Ubicazione"),columns:[{xtype:"datecolumn",dataIndex:"dataInizioUtilizzo",text:"INIZIO_UTILIZZO",flex:1,format:"d/m/Y",align:"center"}],dockedItems:[],viewConfig:{loadMask:!1}},{xtype:"container",
flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",itemId:"Form",reference:"Form",border:0,autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"datefield",itemId:"EdtDtInizio",reference:"EdtDtInizio",fieldLabel:"INIZIO_UTILIZZO",name:"dataInizioUtilizzo",labelClsExtra:"cbaLabel",allowBlank:!1,labelWidth:85,width:200},{xtype:"combobox",width:450,fieldLabel:"DEPOSITO",labelClsExtra:"cbaLabel",
labelWidth:85,itemId:"CBDeposito",reference:"CBDeposito",name:"idDeposito",displayField:"valore",queryParam:"descrizione",valueField:"codice",minChars:0,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi")},{xtype:"container",flex:1,layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnUbica",reference:"BtnUbica",text:"UBICAZIONE"},{xtype:"textfield",width:360,itemId:"TxUbicazione",reference:"TxUbicazione",name:"desUbicazione",allowBlank:!1,editable:!1,margin:"0 0 0 20"},{xtype:"numberfield",
fieldLabel:"IDUBICA",itemId:"EdUbicazione",reference:"EdUbicazione",name:"idUbicazione",hidden:!0,labelClsExtra:"cbaLabel"}]}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.causali.controller.Causali",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"GridCausali",selector:this.selContainer+"#GridCausali"},{ref:"TxtDescrizione",selector:this.selContainer+"#TxtDescrizione"},{ref:"FsTipoMovimento",
selector:this.selContainer+"#FsTipoMovimento"},{ref:"RgbCausale",selector:this.selContainer+"#RgbCausale"},{ref:"ChBApertura",selector:this.selContainer+"#ChBApertura"},{ref:"ChBInventario",selector:this.selContainer+"#ChBInventario"},{ref:"ChBOmaggio",selector:this.selContainer+"#ChBOmaggio"}]);this.control(this.selContainer+"#GridCausali",{select:this.selectGridCausali});this.control(this.selContainer+"#RgbCausale",{change:this.changeRgbCausale})},changeRgbCausale:function(a,b,c,d){this.getChBApertura().setDisabled("C"!=
b.tipoMovimento);this.getChBOmaggio().setDisabled("S"==b.tipoMovimento)},selectGridCausali:function(a,b){clearForm(this.getForm());this.getForm().loadRecord(b)},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{apertoChiuso:getBoolValue(c.apertoChiuso),reso:getBoolValue(c.reso),inventario:getBoolValue(c.inventario),omaggio:getBoolValue(c.omaggio)});
controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.getGridCausali().getStore();b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);
a.getGridCausali().setDisabled(!0)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){a.getForm().up("window").close();a.cbaConfig.callbackRiapriStore&&a.cbaConfig.callbackRiapriStore()}}});inserisciBottoni(b.boxBottoni,c);a.cbaConfig.mostraEsci||b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",
function(c,e){controller_abilitaBottoni(b);a.getGridCausali().setDisabled(e)})},aggiornaStore:function(a){var b=this,c=b.getForm(),d=c.getForm(),e=c.store;e.load({params:{},callback:function(g,h,k){k?Ext.isEmpty(g)?clearForm(c):(a||(a=d.findField("id").getValue()),g=trovaRecord(e,"id",a),h=b.getGridCausali(),h.getSelectionModel().deselectAll(),h.getSelectionModel().select(g?[g]:0)):msgShowError("",h.getError())}})},onLaunch:function(){this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);
this.callParent()}});
Ext.define("GeneraliEC.causali.store.Causali",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"tipo"},{name:"descrizione"},{name:"abbreviazione"},{name:"tipoMovimento"},{name:"reso"},{name:"inventario"},{name:"apertoChiuso"},{name:"omaggio"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/causali/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/causali/list",create:getUrlGen()+"/ws/causali/insert",update:getUrlGen()+"/ws/causali/update",destroy:getUrlGen()+
"/ws/causali/delete"}},autoDestroy:!0});Ext.define("GeneraliEC.causali.store.CboxCausali",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/causali/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.causali.view.Causali",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"gridpanel",itemId:"GridCausali",reference:"GridCausali",width:200,store:Ext.create("GeneraliEC.causali.store.Causali"),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"DESCRIZIONE",flex:1}],viewConfig:{loadMask:!1}},{xtype:"form",flex:1,
itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"numberfield",fieldLabel:"ID",name:"id",hidden:!0},{xtype:"textfield",width:420,labelWidth:85,fieldLabel:"DESCRIZIONE",itemId:"TxtDescrizione",reference:"TxtDescrizione",name:"descrizione",allowBlank:!1,maxLength:50,enforceMaxLength:!0,labelClsExtra:"cbaLabel"},{xtype:"fieldset",title:"TIPO_MOVIMENTO",itemId:"FsTipoMovimento",reference:"FsTipoMovimento",items:[{xtype:"radiogroup",columns:3,
width:410,itemId:"RgbCausale",reference:"RgbCausale",allowBlank:!1,items:[{boxLabel:"CARICO",name:"tipoMovimento",inputValue:"C",cls:"cbaLabel",checked:!0},{boxLabel:"SCARICO",name:"tipoMovimento",inputValue:"S",cls:"cbaLabel"},{boxLabel:"CARICO_SCARICO",name:"tipoMovimento",inputValue:"E",cls:"cbaLabel"}]}]},{xtype:"fieldset",title:"PARAMETRI",items:[{xtype:"checkboxfield",itemId:"ChBApertura",reference:"ChBApertura",fieldLabel:"",boxLabel:"APERTURA",inputValue:"T",uncheckedValue:"F",name:"apertoChiuso",
cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"ChBInventario",reference:"ChBInventario",fieldLabel:"",boxLabel:"INVENTARIO",inputValue:"T",uncheckedValue:"F",name:"inventario",cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"ChBOmaggio",reference:"ChBOmaggio",fieldLabel:"",boxLabel:"OMAGGIO",inputValue:"T",uncheckedValue:"F",name:"omaggio",cls:"cbaLabel"}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.cda.controller.AlberoCda",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TreeRep",selector:a+"#TreeRep"},{ref:"BtnNuovo",selector:a+"#BtnNuovo"},{ref:"BtnElimina",selector:a+"#BtnElimina"},{ref:"BtnConferma",selector:a+"#BtnConferma"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"CntEconomica",selector:a+"#CntEconomica"},{ref:"CBAnno",selector:a+"#CBAnno"},{ref:"Anno",selector:a+"#Anno"},
{ref:"TxtCerca",selector:a+"#TxtCerca"},{ref:"LblSelettore",selector:a+"#LblSelettore"}]);this.control(a+"#TreeRep",{beforeitemcontextmenu:this.beforeitemcontextmenuTreeRep,beforeedit:this.beforeeditTreeRep,edit:this.editTreeRep,canceledit:this.canceleditTreeRep,validateedit:this.validateeditTreeRep,select:this.selectTreeRep,itemdblclick:this.itemdblclickTreeRep});this.control(a+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(a+"#BtnElimina",{click:this.clickBtnElimina});this.control(a+"#BtnConferma",
{click:this.clickBtnConferma});this.control(a+"#BtnEsci",{click:this.clickBtnEsci});this.control(a+"#CBAnno",{change:this.changeCBAnno});this.control(a+"#Anno",{change:this.changeAnnoEconomicaOld});this.control(a+"#TxtCerca",{change:Ext.Function.createBuffered(this.cercaTree,500,this)})},cercaTree:function(a){var b=this.getTreeRep(),c=b.getStore(),d=[];this.getLblSelettore().setVisible(!1);c.clearFilter();Ext.isEmpty(a.getValue())?(c.each(function(a){a.set("cls","")}),b.getSelectionModel().hasSelection()?
b.ensureVisible(b.getSelectionModel().getSelection()[0]):b.getSelectionModel().select(0)):(c.each(function(b){if(b.isLeaf()){var c=!1,e=b.get("text");e&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase())&&(c=!0);c?(b.set("cls","cba-dirty-record"),d.push(b)):b.set("cls","")}}),this.filtraPadri(c,d),this.getLblSelettore().setVisible(1<d.length),Ext.isEmpty(d)?b.getSelectionModel().select(0):(b.ensureVisible(d[0]),this.getLblSelettore().setText(traduci("NUM_ELEMENTI_TROVATI",[d.length]))));a.focus()},
filtraPadri:function(a,b){a.filter(function(a){for(var c=!1,e=0,g=b.length;e<g;e++)if(a.contains(b[e])){c=!0;break}else if(a.isLeaf()&&(c=a===b[e]))break;return c})},changeAnnoEconomicaOld:function(a,b){this.aggiornaStore()},changeCBAnno:function(a,b){b?(this.aggiornaStore(),this.lastIdEserc=b):this.getCBAnno().setValue(this.lastIdEserc)},itemdblclickTreeRep:function(a,b,c,d,e,g){b.get("leaf")&&(1==this.cbaConfig.soloIntermedi?"I"==b.get("tipoCda")?this.selezionaEsci():msgShowError("","MSG_INTERMEDI"):
this.selezionaEsci())},selezionaEsci:function(){var a=this.getBtnConferma();if(a.isVisible()){if(this.cbaConfig.afterConferma){var b=[];Ext.each(this.getTreeRep().getSelectionModel().getSelection(),function(a){a.get("leaf")&&b.push(a)});Ext.isEmpty(b)||(b.annoCda=this.getCBAnno().getValue(),this.cbaConfig.afterConferma(b))}a.up("window").close()}},clickBtnConferma:function(a){this.selezionaEsci()},clickBtnEsci:function(a){a.up("window").close()},selectTreeRep:function(a,b){this.getBtnElimina().setDisabled(0===
b.get("cdaCode")||"L"==this.cbaConfig.permesso);this.cbaConfig.multiSelezione||this.getBtnConferma().setDisabled(0===b.get("cdaCode")||!b.get("leaf"));if(!this.cbaConfig.onlyTree){var c=this.getTreeRep().up("#CntPrincipale").down("#FormCda").controller;c.idTestata=b.get("cdaCode");c.getFormCda().setDisabled(0==b.get("cdaCode"));c.getBoxBottoni().queryById("btnElimina").setDisabled(0===b.get("cdaCode"));c.hasChild=b.hasChildNodes();0!=b.get("cdaCode")?c.aggiornaStore():clearForm(c.getFormCda())}},
beforeeditTreeRep:function(a,b,c){if(!0===a.editing||0===b.record.get("cdaCode"))return!1;this.abilitaBottoniGrid(!1)},editTreeRep:function(a,b,c){var d=b.record.getData();c=a.getEditor().getForm();c.controller=this;c.store=this.getTreeRep().getStore();d={id:d.cdaCode?d.cdaCode:null,idOrganizzazione:getIdOrg(),idEsercizio:this.idEsercizioDefault,idPadre:d.idPadre,descrizione:d.text};controller_salvaRecord(c,d,!1,!1)?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditTreeRep:function(a,
b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("cdaCode"))},validateeditTreeRep:function(a,b,c){return msgShow("",[])},beforeitemcontextmenuTreeRep:function(a,b,c,d,e,g){return getPopupMenuTree(e,a)},aggiornaStore:function(a){var b=this.getTreeRep(),c=b.getStore(),d={idOrganizzazione:this.cbaConfig.idOrganizzazione,idEsercizio:this.getCBAnno().getValue()};this.cbaConfig.idMovimento&&Ext.apply(d,{idMovimento:this.cbaConfig.idMovimento});this.cbaConfig.idOrdine&&Ext.apply(d,{idOrdine:this.cbaConfig.idOrdine});
c.load({params:d,callback:function(c,d,h){h?(c=b.getRootNode().findChild("cdaCode",a,!0),b.expandAll(),c?(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0),b.getSelectionModel().select([c])):(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0))):msgShowError("",d.getError())}})},clickBtnNuovo:function(){var a=this.getTreeRep();a.getStore();var b=a.getSelectionModel().getLastSelected();b.set("leaf",!1);b.appendChild({leaf:!0,idPadre:b.get("cdaCode")});a.getView().refresh();
b.expand();a.getPlugin().startEdit(b.lastChild,0);a.up("#CntPrincipale").down("#FormCda").controller.getFsTipoCda().setDisabled(!1);this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},clickBtnElimina:function(){var a=this,b=a.getTreeRep(),c=b.getSelectionModel().getSelection()[0],d=c.hasChildNodes()?"MSG_ELIMINA_NODO":"";controller_eliminaRecord(b.getStore(),{id:c?c.get("cdaCode"):""},function(){a.aggiornaStore()},!1,
d)},onLaunch:function(){var a=this,b=a.getTreeRep();a.cbaConfig.idOrganizzazione||(a.cbaConfig.idOrganizzazione=getIdOrg());b.controller=a;var c=a.getCBAnno(),d=Ext.create("Generali.esercizioCont.store.cboxEsercizioCont");c.bindStore(d);c.setVisible(!0);c.setDisabled(a.cbaConfig.onlyTree);d.load({params:{idOrganizzazione:this.cbaConfig.idOrganizzazione},callback:function(b,d,h){getIdEsercizioDefaultByIdOrg(a.cbaConfig.idOrganizzazione,function(b){a.idEsercizioDefault=b;a.cbaConfig.idAnnoVideata?c.setValue(a.cbaConfig.idAnnoVideata):
c.setValue(a.idEsercizioDefault)})}});a.cbaConfig.onlyTree&&(a.getBtnConferma().setVisible(!0),a.getBtnEsci().setVisible(!0));a.cbaConfig.multiSelezione&&(b.selModel.selectionMode="MULTI")},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.cda.controller.GestCda",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"FormCda",selector:this.selContainer+"#FormCda"},{ref:"IdForm",selector:this.selContainer+"#IdForm"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"BtnCda",selector:this.selContainer+"#BtnCda"}]);this.control(this.selContainer+"#BtnCda",{click:this.clickBtnCda})},clickBtnCda:function(a){Ext.create("winCBA",
{name:"GeneraliEC.associaCdaAnalitica.view.PnlAbbinaCda",titolo:"ASSOCIA_CDA_ANALITICA",dimensione:1,configItem:{idAnnoVideata:this.cbaConfig.controllerAlbero.getCBAnno().getValue(),onlyTree:!0},closable:!0}).show()},verificaCampiForm:function(){var a=[];this.getFormCda().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getFormCda(),c=b.getForm().getFieldValues();-9999==this.getIdForm().getValue()&&(c.idPadre=this.idTestata);Ext.apply(c,{idOrganizzazione:getIdOrg(),
idEsercizio:this.cbaConfig.controllerAlbero.getCBAnno().getValue()});this.recordModificato=!0;controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getFormCda();b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.storeCda;b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.recordModificato=
!0;a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);Ext.Ajax.request({method:"GET",params:{idOrganizzazione:a.cbaConfig.idOrganizzazione},url:getUrlGen()+"/ws/centriConsumo/nextCodRaccordo",success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b.getForm().findField("codiceRaccordo").setValue(a.data):msgShowError("",a.message)}});b.setDisabled(!1)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,
{id:c},function(){a.recordModificato=!0;a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});inserisciBottoni(b.boxBottoni,c);b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(a,c){controller_abilitaBottoni(b)});"L"==b.permesso&&containerSolaLettura(a.getContainer())},aggiornaStore:function(a){var b=this,c=b.storeCda,d=b.getFormCda();d.getForm();b.recordModificato?(b.recordModificato=!1,b.cbaConfig.controllerAlbero.aggiornaStore(a)):
c.load({params:{id:b.idTestata},callback:function(a,c,h){h?(clearForm(d),a&&b.getFormCda().loadRecord(a[0])):msgShowError("",c.getError())}})},onLaunch:function(){this.cbaConfig.idOrganizzazione||(this.cbaConfig.idOrganizzazione=getIdOrg());this.storeCda=Ext.create("GeneraliEC.cda.store.GestCda");this.gestioneForm()},destroy:function(){eliminaStore(this.storeCda);eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.cda.controller.PnlGestCda",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"}])},onLaunch:function(){this.cbaConfig.idOrganizzazione||(this.cbaConfig.idOrganizzazione=getIdOrg());var a=Ext.create("GeneraliEC.cda.view.AlberoCda",{cbaConfig:{idOrganizzazione:this.cbaConfig.idOrganizzazione,permesso:this.cbaConfig.permesso,
idAnno:this.cbaConfig.idAnno,onlyTree:this.cbaConfig.onlyTree,multiSelezione:this.cbaConfig.multiSelezione,currentCda:this.cbaConfig.currentCda,controllerPadre:this,afterConferma:this.cbaConfig.afterConferma?this.cbaConfig.afterConferma:!1,idAnnoVideata:this.cbaConfig.idAnnoVideata,idMovimento:this.cbaConfig.idMovimento,idOrdine:this.cbaConfig.idOrdine}});this.getCntPrincipale().add({xtype:"panel",layout:"fit",flex:1,items:a});a.cbaConfig.onlyTree||this.getCntPrincipale().add({xtype:"panel",layout:"fit",
flex:1,items:Ext.create("GeneraliEC.cda.view.GestCda",{cbaConfig:{permesso:this.cbaConfig.permesso,controllerAlbero:a.down("#TreeRep").controller}})})}});
Ext.define("GeneraliEC.cda.model.AlberoCda",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"cdaCode"},{name:"idOrganizzazione"},{name:"idPadre"},{name:"idVisibile"},{name:"idEsercizio"},{name:"descrizione"},{name:"children"},{name:"text",convert:function(a,b){return b.get("idVisibile")?b.get("idVisibile")+" . "+b.get("descrizione"):b.get("descrizione")}},{name:"expanded"},{name:"leaf"},{name:"iconCls"}]});
Ext.define("GeneraliEC.cda.store.AlberoCda",{extend:"Ext.data.TreeStore",model:"GeneraliEC.cda.model.AlberoCda",autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:getUrlGen()+"/ws/centriConsumo/tree",reader:{type:"json",messageProperty:"message",rootProperty:"children"},api:{create:getUrlGen()+"/ws/centriConsumo/insert",update:getUrlGen()+"/ws/centriConsumo/update",destroy:getUrlGen()+"/ws/centriConsumo/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.cda.store.GestCda",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"idPadre"},{name:"idVisibile"},{name:"idEsercizio"},{name:"descrizione"},{name:"codiceRaccordo"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/centriConsumo/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/centriConsumo/get",create:getUrlGen()+"/ws/centriConsumo/insert",update:getUrlGen()+"/ws/centriConsumo/update",destroy:getUrlGen()+
"/ws/centriConsumo/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.cda.view.AlberoCda",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"treepanel",flex:1,width:300,border:0,viewConfig:{loadMask:!1,getRowClass:function(a,b,c,d){return a.get("cls")}},itemId:"TreeRep",reference:"TreeRep",store:Ext.create("GeneraliEC.cda.store.AlberoCda"),useArrows:!0,rootVisible:!1,columns:[{xtype:"treecolumn",dataIndex:"text",text:"CENTRI_DI_CONSUMO",autoScroll:!0,flex:1,
editor:{xtype:"textfield",allowBlank:!1}}],dockedItems:[{xtype:"toolbar",dock:"top",padding:"5 10 5 10",items:[{xtype:"container",itemId:"CntEconomica",reference:"CntEconomica",layout:{type:"hbox",align:"middle"},items:[{xtype:"combobox",width:300,labelWidth:50,fieldLabel:"ESERCIZIO",editable:!1,itemId:"CBAnno",reference:"CBAnno",displayField:"valore",queryMode:"local",valueField:"codice",hidden:!0},{xtype:"anno",itemId:"Anno",reference:"Anno",hidden:!0}]},{xtype:"tbfill"},{xtype:"button",itemId:"BtnNuovo",
reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo",hidden:!0},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina",hidden:!0},{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:"SELEZIONA_ESCI",hidden:!0},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esciGriglia",text:"ESCI",hidden:!0},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",emptyText:"CERCA",maxLength:50,enforceMaxLength:!0,
width:300}]},{xtype:"label",border:0,dock:"top",hidden:!0,itemId:"LblSelettore",reference:"LblSelettore"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.cda.view.GestCda",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"form",flex:1,itemId:"FormCda",reference:"FormCda",autoScroll:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",name:"id",itemId:"IdForm",reference:"IdForm",hidden:!0},{xtype:"textfield",name:"idOrganizzazione",hidden:!0},{xtype:"textfield",
name:"idEsercizio",hidden:!0},{xtype:"textfield",name:"idPadre",hidden:!0},{xtype:"container",items:[{xtype:"numberfield",fieldLabel:"CODICE",name:"idVisibile",width:150,allowBlank:!1,maxLength:3,enforceMaxLength:!0,allowDecimals:!1,useThousandSeparator:!1,minValue:1,baseChars:"123456789",listeners:{afterrender:function(){this.maskRe=/^[0-9]/}}}]},{xtype:"textfield",fieldLabel:"DESCRIZIONE",name:"descrizione",allowBlank:!1,maxLength:100,enforceMaxLength:!0},{xtype:"textfield",fieldLabel:"CODICE_IMPORT",
name:"codiceRaccordo",maxLength:100,enforceMaxLength:!0}]},{xtype:"container",layout:"vbox",items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120},{xtype:"button",itemId:"BtnCda",reference:"BtnCda",iconCls:"icon-elabora",cls:"cba-button-25",margin:"0 0 0 10",text:"CDA"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.cda.view.PnlGestCda",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntPrincipale",reference:"CntPrincipale",layout:{align:"stretch",type:"hbox"}}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.componenti.CdcGrid",{extend:"Ext.form.field.Text",alias:"widget.cdcGrid",alternateClassName:"cdcGrid",name:"cdc",enableKeyEvents:!0,initComponent:function(){this.listeners={render:this.renderCdcGrid};this.callParent(arguments)},renderCdcGrid:function(a){var b=this;creaToolTip(a.getId(),"MODIFICA_CDA_DBLCLICK","");a.getEl().on("dblclick",function(){b.cdcDoubleClick(a,b.idEsercizio)});b.setContextMenuCda(a);a.on("keydown",function(a,b,e){9!=b.getKey()&&b.stopEvent()})},setContextMenuCda:function(a){var b=
this;a.getEl().on("contextmenu",function(c){c.stopEvent();a.menu||(a.menu=Ext.create("Ext.menu.Menu",{items:[{text:traduci("ELIMINA"),handler:function(){b.cdaCancella(a)}}]}));a.up().solaLettura||a.menu.showAt(c.getXY())})},cdaCancella:function(a){var b="",c=a.up("form").getForm();a.extraFieldName&&(b=a.extraFieldName);c.findField(b+"cdc")&&c.findField(b+"cdc").setValue("");c.findField(b+"desCdc")&&c.findField(b+"desCdc").setValue("")},cdcDoubleClick:function(a,b){var c=a.up("form").getForm(),d,e=
a.up("cdc"),g,h="";e&&e.extraFieldName&&(h=e.extraFieldName);d=c.findField(h+"cdc");g=c.findField(h+"descrizioneCodice");var k=c.getRecord(),l=0,m=0;k&&(l=k.get("idMovimento"),m=k.get("idOrdine"));Ext.create("winCBA",{name:"GeneraliEC.cda.view.PnlGestCda",titolo:"CENTRI_DI_CONSUMO",dimensione:2,configItem:{onlyTree:!0,idAnnoVideata:b,idMovimento:l,idOrdine:m,afterConferma:function(a){d.setValue(a[0].get("cdaCode"));e&&e.showDesCda&&g.setValue(a[0].get("descrizione"));c.findField(h+"desCdc")&&c.findField(h+
"desCdc").setValue(a[0].get("descrizione"))}},listeners:{close:function(){setTimeout(function(){a.selectText();a.focus()},200)}}}).show()}});
Ext.define("GeneraliEC.componenti.PanelRichiesteDaReparto",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var a=this;a.initCmpSblocco();a.callParent(arguments);a.on("afterrender",function(){a.sbloccaVideata(a,CBA.moduli.modulo60.installato)})},sbloccaVideata:function(a,b){a.down("#PnlCommerciale").setVisible(!1);a.down("#CntDati").setVisible(!0);a.controller.loadData()},initCmpSblocco:function(){var a=this.items;this.items=[];this.items=[{xtype:"container",border:0,layout:{align:"stretch",
type:"vbox"},title:"",items:[{xtype:"panel",cls:"pannelloBiancoBordato",itemId:"PnlCommerciale",reference:"PnlCommerciale",margin:3,layout:{align:"stretch",type:"vbox"},hidden:!0,flex:1,border:0,items:[{xtype:"label",margin:"30 15 0 15",cls:"cbaLabelDatiUtente",text:traduci("MODULO_RC_NON_ACQUISTATO"),style:"text-align:center"},{xtype:"label",margin:"30 15 0 15",cls:"cbaLabelDatiUtente",text:traduci("MSG_INFOCOMMERCIALE"),style:"text-align:center"}]},{xtype:"container",itemId:"CntDati",reference:"CntDati",
flex:1,layout:"fit",hidden:!0,items:a}]}]}});
Ext.define("GeneraliEC.componenti.PannelloBottoniRichieste",{extend:"Ext.panel.Panel",uses:["Generali.standard.stampe.Button"],border:0,layout:"column",title:"",flex:1,columnWidth:1,defaults:{width:120},itemId:"cntBottoni",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"button",disabled:!1,itemId:"btnNuovo",cls:"cba-button-25",iconCls:"icon-inserisci",text:traduci("NUOVO"),margin:"0 1 1 0",hidden:!1,handler:function(){var b=a.cbaConfig.nuovo_callback;a.setBtnEditMode(!0);b&&("function"==
typeof b?b():Ext.log.warn("*********** btnNuovo : utilizzo di eval ***********"))}},{xtype:"button",disabled:!1,itemId:"btnElimina",cls:"cba-button-25",iconCls:"icon-elimina",text:traduci("ELIMINA"),margin:"0 1 1 0",hidden:!1,handler:function(){var b=a.cbaConfig.elimina_callback;b&&("function"==typeof b?b():Ext.log.warn("*********** btnElimina : utilizzo di eval ***********"))}},{xtype:"button",disabled:!0,itemId:"btnConferma",cls:"cba-button-25",iconCls:"icon-conferma",text:"Conferma",margin:"0 1 1 0",
hidden:!0,handler:function(){var b=!1,c=!1,d=a.cbaConfig.verificaCampiForm_callback,e=a.cbaConfig.conferma_callback;d&&("function"==typeof e?b=d():Ext.log.warn("*********** btnConferma: utilizzo di eval ***********"));b&&(a.setBtnEditMode(!1),"function"==typeof e?c=e():Ext.log.warn("*********** btnConferma: utilizzo di eval ***********"),Ext.isDefined(c)&&1==c&&a.setBtnEditMode(!0))}},{xtype:"button",disabled:!0,itemId:"btnInviaRichiesta",cls:"cba-button-25",iconCls:"icon-conferma",text:traduci("INVIA_RICHIESTA"),
margin:"0 1 1 0",hidden:!0,handler:function(){var b=!1,c=a.cbaConfig.verificaCampiForm_callback,d=a.cbaConfig.richiesta_callback;c&&("function"==typeof c?b=c():Ext.log.warn("*********** btnInviaRichiesta: utilizzo di eval ***********"));b&&(a.setBtnEditMode(!1),d&&("function"==typeof d?d():Ext.log.warn("*********** btnInviaRichiesta : utilizzo di eval ***********"),Ext.isDefined(!1)))}},{xtype:"button",disabled:!0,itemId:"btnInviaProposta",cls:"cba-button-25",iconCls:"icon-conferma",text:traduci("INVIA_PROPOSTA"),
margin:"0 1 1 0",hidden:!0,handler:function(){var b=!1,c=a.cbaConfig.verificaCampiForm_callback,d=a.cbaConfig.proposta_callback;c&&("function"==typeof c?b=c():Ext.log.warn("*********** btnInviaProposta: utilizzo di eval ***********"));b&&(a.setBtnEditMode(!1),d&&("function"==typeof d?d():Ext.log.warn("*********** btnInviaProposta : utilizzo di eval ***********"),Ext.isDefined(!1)))}},{xtype:"button",disabled:!0,itemId:"btnTemporanea",cls:"cba-button-25",iconCls:"icon-conferma",text:traduci("TEMPORANEA"),
margin:"0 1 1 0",hidden:!0,handler:function(){var b=!1,c=a.cbaConfig.verificaCampiForm_callback,d=a.cbaConfig.temporanea_callback;c&&("function"==typeof c?b=c():Ext.log.warn("*********** btnTemporanea: utilizzo di eval ***********"));b&&(a.setBtnEditMode(!1),d&&("function"==typeof d?d():Ext.log.warn("*********** btnTemporanea : utilizzo di eval ***********"),Ext.isDefined(!1)))}},{xtype:"button",disabled:!0,itemId:"btnProposta",cls:"cba-button-25",iconCls:"icon-conferma",text:traduci("PROPOSTA"),
margin:"0 1 1 0",hidden:!0,handler:function(){var b=!1,c=a.cbaConfig.verificaCampiForm_callback,d=a.cbaConfig.proposta_callback;c&&("function"==typeof c?b=c():Ext.log.warn("*********** btnProposta: utilizzo di eval ***********"));b&&(a.setBtnEditMode(!1),d&&("function"==typeof d?d():Ext.log.warn("*********** btnProposta : utilizzo di eval ***********"),Ext.isDefined(!1)))}},{xtype:"button",disabled:!0,itemId:"btnAnnulla",cls:"cba-button-25",iconCls:"icon-annulla",text:traduci("RIPRISTINA"),margin:"0 1 1 0",
handler:function(){var b=!0;a.cbaConfig.beforeAnnulla&&(b=a.cbaConfig.beforeAnnulla());b?(a.setBtnEditMode(!1),(b=a.cbaConfig.annulla_callback)&&("function"==typeof b?b():Ext.log.warn("*********** btnAnnulla: utilizzo di eval ***********"))):a.setBtnEditMode(!0)}},{xtype:"button",nonDisabilitare:!0,disabled:!1,itemId:"BtnCopia",cls:"cba-button-25",iconCls:"icon-copia",text:traduci("COPIA"),margin:"0 1 1 0",hidden:!0,scale:"small",handler:function(){var b=a.cbaConfig.copia_callback;b&&("function"==
typeof b?b():Ext.log.warn("*********** btnEsci: utilizzo di eval ***********"))}},{xtype:"newButtonStampa",nonDisabilitare:!0,disabled:!1,itemId:"BtnStampa",cls:"cba-button-25",iconCls:"icon-stampa",text:traduci("STAMPA"),margin:"0 1 1 0",hidden:!0,scale:"small"},{xtype:"button",nonDisabilitare:!0,disabled:!1,itemId:"btnEsci",cls:"cba-button-25",iconCls:"icon-esci",text:"Esci",margin:"0 1 1 0",hidden:!0,scale:"small",handler:function(){var b=a.cbaConfig.esci_callback;b&&("function"==typeof b?b():
Ext.log.warn("*********** btnEsci: utilizzo di eval ***********"))}}]});a.callParent(arguments)},setBtnEditMode:function(a){this.queryById("btnNuovo").setDisabled(a);this.queryById("btnElimina").setDisabled(a);this.queryById("btnConferma").setDisabled(!a);this.queryById("btnInviaRichiesta").setDisabled(!a);this.queryById("btnInviaProposta").setDisabled(!a);this.queryById("btnTemporanea").setDisabled(!a);this.queryById("btnProposta").setDisabled(!a);this.queryById("btnAnnulla").setDisabled(!a);this.queryById("BtnStampa").setDisabled(a)}});
Ext.define("GeneraliEC.componenti.SMArticoli",{extend:"Ext.form.field.ComboBox",alias:"widget.smArticoli",alternateClassName:"smArticoli",itemId:"CBArticolo",reference:"CBArticolo",fieldLabel:"ARTICOLO",displayField:"valore",queryMode:"local",valueField:"clcCodice",labelClsExtra:"cbaLabel",showAvatar:!0,initComponent:function(){var a=this;a.store=Ext.create("GeneraliEC.tabelleBase.store.ArticoloCbox",{autoLoad:!0});a.tpl=Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra.split(',')[4] == 'F'\"><div class=\"x-boundlist-item non_attivi\"><span>{[this.renderRec(values)]}</span></div></tpl>",
"<tpl if=\"extra.split(',')[4] != 'F'\"><div class=\"x-boundlist-item\"><span>{[this.renderRec(values)]}</span></div></tpl>","</tpl>",{renderRec:function(b){var c=b.valore;b=void 0===b.idGruppo?0:b.idGruppo;if(a.showAvatar&&!StdEconomato.isValidID(b)){var d=Ext.id();Ext.defer(function(){var a=Ext.get(d);a&&Ext.create("CbaUtils.componenti.all.Avatar",{id:"cntAvatar-"+d,color:"#99C299",height:24,"float":"right",label:"SM"}).render(a,d)},50);c+="<span id='"+d+"' style='float: right; width:24px'></span>"}return c}});
a.callParent(arguments)},getTipoArticolo:function(){var a=this.getSelection();if(a)return a.get("idGruppo")},getCodArticolo:function(){var a=this.getSelection();if(a)return a.get("codice")}});
Ext.define("GeneraliEC.contratti.controller.AllegatiContratti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridAllegati",selector:this.selContainer+"#GridAllegati"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"Data",selector:this.selContainer+"#Data"},{ref:"TxtDescrizione",selector:this.selContainer+"#TxtDescrizione"},{ref:"TxtFileName",
selector:this.selContainer+"#TxtFileName"},{ref:"CntAllegato",selector:this.selContainer+"#CntAllegato"},{ref:"CntAnteprima",selector:this.selContainer+"#CntAnteprima"},{ref:"FormAllegato",selector:this.selContainer+"#FormAllegato"},{ref:"AllegatoUpload",selector:this.selContainer+"#AllegatoUpload"},{ref:"BtnEliminaAllegato",selector:this.selContainer+"#BtnEliminaAllegato"},{ref:"BtnAllega",selector:this.selContainer+"#BtnAllega"}]);this.control(this.selContainer+"#BtnEliminaAllegato",{click:this.eliminaAllegato});
this.control(this.selContainer+"#AllegatoUpload",{change:this.onFilefieldChangeAllegatoUpload});this.control(this.selContainer+"#GridAllegati",{select:this.selectGridAllegati})},selectGridAllegati:function(a,b,c,d){a=this.getForm();clearForm(this.getForm());b&&(a.loadRecord(b),this.getAllegatoUpload().setVisible(b.get("id")),this.getBtnEliminaAllegato().setVisible(!Ext.isEmpty(b.get("fileName"))),this.creaAnteprima(b.get("idAllegato"),this.getCntAnteprima()))},verificaCampiForm:function(){var a=[];
this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{idCliFor:this.cbaConfig.recordTestata.get("idCliFor"),idContratto:this.cbaConfig.recordTestata.get("id")});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=
a.getGridAllegati().getStore();b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.aggiornaStore()},nuovo_callback:function(){a.getCntAnteprima().removeAll();a.getAllegatoUpload().setVisible(!1);a.getBtnEliminaAllegato().setVisible(!1);controller_nuovoRecord(b);a.getData().setValue(dataAttuale())},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||
controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});inserisciBottoni(b.boxBottoni,c);b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){var d=c.findField("id").getValue();(!d||0>=d)&&e&&validaForm(a.getForm());controller_abilitaBottoni(b)})},aggiornaStore:function(a){var b=this,c=b.getGridAllegati(),d=c.getStore();c.getSelectionModel().deselectAll();b.getCntAnteprima().removeAll();
b.getAllegatoUpload().setVisible(!1);b.getBtnEliminaAllegato().setVisible(!1);(b.cbaConfig.recordTestata.get("id")||a)&&d.load({params:{idContratto:b.cbaConfig.recordTestata.get("id")},callback:function(e,g,h){if(h){if(Ext.isEmpty(e))clearForm(b.getForm());else if(a)var k=trovaRecord(d,"id",a);c.getSelectionModel().select(k?[k]:0)}else msgShowError("",g.getError())}})},formattaUrlBlob:function(a,b,c){var d=this.getCntAnteprima(),e="pdf"==b?"application":"image";Ext.Ajax.request({method:"GET",binary:!0,
url:a,success:function(g){var h=g.responseBytes;Ext.isEmpty(h)?(d.removeAll(),msgShowError("",h.message)):(g=new Blob([g.responseBytes],{type:e+"/"+b}),g=(window.URL||window.webkitURL).createObjectURL(g),h={},Ext.apply(h,{itemId:"iframePdf",reference:"iframePdf",html:'<a href="'+a+'" download="'+c+'" onclick="clickHref(this);">'+traduci("DOWNLOAD")+" "+c+'</a>\n\t\t\t\t\t\t\t<iframe id="pdf" width="100%" height="100%" src="'+g+'"></iframe>'}),d.removeAll(),d.add(h))}})},creaAnteprima:function(a,b){if(!a)return!1;
var c=this.getTxtFileName().getValue(),d=getUrlGen()+"/ws/contrattiAllegati/file/download?idAllegato="+a,e=getPathServer()+d,g={};if(Ext.isEmpty(c))b.removeAll();else{var h=c.split(".").pop(),k="icon-"+h;if("pdf"==h||-1!=Ext.Array.indexOf(getEstensioniImg(),h))if("pdf"==h){if(!(Ext.browser.is.IE||-1<Ext.browser.userAgent.indexOf("Edge"))&&1024<Ext.getBody().getViewSize().width)return this.formattaUrlBlob(d,h,c),!1;g=creaItemDownload(k,e,c,c)}else Ext.apply(g,{xtype:"container",scrollable:!0,flex:1,
items:[{html:'<a href="'+e+'" download="'+c+'" onclick="clickHref(this);">'+traduci("DOWNLOAD")+" "+c+"</a>"},{xtype:"image",listeners:{beforerender:function(a){setSrcImage(a,d)}}}]});else g=creaItemDownload(k,e,c,c);b.removeAll();b.add(g)}},eliminaAllegato:function(a){var b=this;a=b.getForm();var c=a.getForm().findField("id").getValue(),d=a.getForm().findField("idAllegato").getValue();Messaggio("ATTENZIONE","MSG_ELIMINA_ALLEGATO","YESNO","QUESTION",!1,function(){Ext.Ajax.request({method:"GET",url:getUrlGen()+
"/ws/contrattiAllegati/file/delete?idAllegato="+d,success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b.aggiornaStore(c):msgShowError("",a.message)}})})},allegatoUpload:function(a,b){var c=this,d=c.getForm(),e=d.getForm().findField("id").getValue();c.getFormAllegato();var g=b.lastIndexOf("\\")||b.lastIndexOf("/"),d=d.getForm().findField("idAllegato").getValue();b=b.substring(g+1);if(""!==b){var g=a.fileInputEl.dom.files[0],h=new FormData;h.append("file",g);Ext.Ajax.request({url:getUrlGen()+
"/ws/contrattiAllegati/file/upload?idAllegato="+d,method:"POST",rawData:h,headers:{"Content-Type":null},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(msgShow("TRASFERIMENTO_FILE",a.message),c.aggiornaStore(e)):msgShowError("",a.message)}})}},onFilefieldChangeAllegatoUpload:function(a,b,c){this.allegatoUpload(a,b)},onLaunch:function(){this.getGridAllegati().controller=this;this.gestioneForm();this.aggiornaStore()},destroy:function(){delete this.storeForm;this.callParent()}});
Ext.define("GeneraliEC.contratti.controller.ArticoliContratti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridArticoli",selector:this.selContainer+"#GridArticoli"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"ColQuant",selector:this.selContainer+"#ColQuant"},{ref:"ColImporto",selector:this.selContainer+"#ColImporto"},
{ref:"CBArticolo",selector:this.selContainer+"#CBArticolo"},{ref:"TxDesUM",selector:this.selContainer+"#TxDesUM"}]);this.control(this.selContainer+"#GridArticoli",{beforeedit:this.beforeeditGridArticoli,edit:this.editGridArticoli,canceledit:this.canceleditGridArticoli,validateedit:this.validateeditGridArticoli});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#CBArticolo",
{change:this.changeCBArticolo})},changeCBArticolo:function(a,b,c){var d=this;b&&b!=a.originalValue&&Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/catalogo/get",params:{id:b},success:function(a){a=Ext.JSON.decode(a.responseText);a.success&&d.getTxDesUM().getEditor().setValue(a.data.desUdm)}})},clickBtnNuovo:function(a){controller_nuovoRecordGrid({},this.getGridArticoli());this.getColImporto().getEditor().allowBlank=!1;this.getColQuant().getEditor().allowBlank=!1},clickBtnElimina:function(a){var b=
this;a=b.getGridArticoli();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},changeCBDeposito:function(a,b,c){a={};Ext.apply(a,{idOrganizzazione:this.cbaConfig.idOrganizzazione,hasListino:"T",idCliFor:this.cbaConfig.recordTestata.get("idCliFor")});b&&Ext.apply(a,{idDeposito:b});c&&Ext.apply(a,{descrizione:c});this.storeArticoli.getProxy().setExtraParams({});this.storeArticoli.getProxy().setExtraParams(a);this.storeArticoli.load()},
beforeeditGridArticoli:function(a,b,c){if(!0===a.editing)return!1;f=a.getEditor().getForm();f.findField("idDeposito").bindStore(this.storeDepositi);f.findField("idArticolo").bindStore(this.storeArticoli);a=f.findField("idDeposito");this.changeCBDeposito(a,b.record.get("idDeposito"),b.record.get("desArticolo"));Ext.isDefined(a.giaConfigurato)||(a.on("change",this.changeCBDeposito,this),a.giaConfigurato=!0);this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);
this.getBtnElimina().setDisabled(!a)},editGridArticoli:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();delete c.desDeposito;Ext.apply(c,{idContratto:this.cbaConfig.recordTestata.get("id")});controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridArticoli:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridArticoli:function(a,
b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridArticoli(),c=b.getStore();c.load({params:{idContratto:this.cbaConfig.recordTestata.get("id")},callback:function(d,e,g){g?(d=null,a&&(d=trovaRecord(c,"id",a)),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d?[d]:0)):msgShowError("",e.getError())}})},svuotaStore:function(){svuotaStore(this.getGridArticoli().getStore())},onLaunch:function(){this.getGridArticoli().controller=this;this.storeDepositi=Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi");
this.storeDepositi.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione};this.storeArticoli=Ext.create("GeneraliEC.catalogoArticoli.store.CboxArticoli");this.storeArticoli.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione,hasListino:"T",idCliFor:this.cbaConfig.recordTestata.get("idCliFor")};this.aggiornaStore()},destroy:function(){eliminaStore(this.storeDepositi);eliminaStore(this.storeArticoli);this.callParent()}});
Ext.define("GeneraliEC.contratti.controller.ContiContratti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridConti",selector:this.selContainer+"#GridConti"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"CBConto",selector:this.selContainer+"#CBConto"},{ref:"CBEsercizio",selector:this.selContainer+"#CBEsercizio"}]);this.control(this.selContainer+
"#GridConti",{beforeedit:this.beforeeditGridConti,edit:this.editGridConti,canceledit:this.canceleditGridConti,validateedit:this.validateeditGridConti});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnNuovo:function(a){controller_nuovoRecordGrid({},this.getGridConti())},clickBtnElimina:function(a){var b=this;a=b.getGridConti();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),
{id:c?c.get("id"):""},function(){b.aggiornaStore()})},changeCBEsercizio:function(a,b,c){a={};Ext.apply(a,{idOrganizzazione:this.cbaConfig.idOrganizzazione});b&&Ext.apply(a,{idEsercizio:b});c&&Ext.apply(a,{descrizione:c});this.storeConti.getProxy().setExtraParams({});this.storeConti.getProxy().setExtraParams(a);this.storeConti.load()},beforeeditGridConti:function(a,b,c){if(!0===a.editing)return!1;a=a.getEditor().getForm();a.findField("idEsercizio").bindStore(this.storeEsercizio);a.findField("idConto").bindStore(this.storeConti);
a=a.findField("idEsercizio");this.changeCBEsercizio(a,b.record.get("idEsercizio"),b.record.get("desConto"));Ext.isDefined(a.giaConfigurato)||(a.on("change",this.changeCBEsercizio,this),a.giaConfigurato=!0);this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},editGridConti:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();Ext.apply(c,{idContratto:this.cbaConfig.recordTestata.get("id")});
controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridConti:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridConti:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridConti(),c=b.getStore();c.load({params:{idContratto:this.cbaConfig.recordTestata.get("id")},callback:function(d,e,g){g?(d=null,a&&(d=trovaRecord(c,"id",a)),b.getSelectionModel().deselectAll(),
b.getSelectionModel().select(d?[d]:0)):msgShowError("",e.getError())}})},svuotaStore:function(){svuotaStore(this.getGridConti().getStore())},onLaunch:function(){this.getGridConti().controller=this;this.storeConti=Ext.create("Generali.pianodeiconti.store.DesSottoconto",{autoLoad:!1,autoDestroy:!1});this.storeEsercizio=Ext.create("Generali.esercizioCont.store.cboxEsercizioCont",{autoLoad:!1});this.storeEsercizio.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione};this.storeEsercizio.load();
this.aggiornaStore()},destroy:function(){eliminaStore(this.storeConti);eliminaStore(this.storeEsercizio);this.callParent()}});
Ext.define("GeneraliEC.contratti.controller.ContrattiTes",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"TabPaginatore",selector:this.selContainer+"#TabPaginatore"},{ref:"PnlConti",selector:this.selContainer+"#PnlConti"},{ref:"PnlArticoli",
selector:this.selContainer+"#PnlArticoli"},{ref:"PnlDelibere",selector:this.selContainer+"#PnlDelibere"},{ref:"PnlAllegati",selector:this.selContainer+"#PnlAllegati"},{ref:"PnlDepositi",selector:this.selContainer+"#PnlDepositi"},{ref:"CBFornitore",selector:this.selContainer+"#CBFornitore"},{ref:"EdtDurataDal",selector:this.selContainer+"#EdtDurataDal"},{ref:"EdtDurataAl",selector:this.selContainer+"#EdtDurataAl"},{ref:"EdtProroga",selector:this.selContainer+"#EdtProroga"},{ref:"EdtScadAntic",selector:this.selContainer+
"#EdtScadAntic"},{ref:"BtnRifCigCup",selector:this.selContainer+"#BtnRifCigCup"},{ref:"TxCig",selector:this.selContainer+"#TxCig"},{ref:"TxCup",selector:this.selContainer+"#TxCup"},{ref:"TxIdCigCup",selector:this.selContainer+"#TxIdCigCup"},{ref:"TxImponibile",selector:this.selContainer+"#TxImponibile"},{ref:"CBAliIva",selector:this.selContainer+"#CBAliIva"},{ref:"CBUtentiAbilitati",selector:this.selContainer+"#CBUtentiAbilitati"},{ref:"TxTotale",selector:this.selContainer+"#TxTotale"},{ref:"ChBConsideraImpo",
selector:this.selContainer+"#ChBConsideraImpo"},{ref:"ChBAttivo",selector:this.selContainer+"#ChBAttivo"},{ref:"CBTipoContr",selector:this.selContainer+"#CBTipoContr"},{ref:"CBCategoriaContr",selector:this.selContainer+"#CBCategoriaContr"}]);this.control(this.selContainer+"#TabPaginatore",{tabchange:this.tabchangeTabPaginatore});this.control(this.selContainer+"#BtnRifCigCup",{click:this.clickBtnRifCigCup});this.control(this.selContainer+"#TxTotale",{change:this.changeTxTotale});this.control(this.selContainer+
"#TxImponibile",{change:this.changeTxImponibile});this.control(this.selContainer+"#CBAliIva",{change:this.changeCBAliIva});this.control(this.selContainer+"#CBTipoContr",{change:this.changeCBTipoContr})},changeCBAliIva:function(a,b){var c=0;b&&(c=(c=trovaRecord(a.getStore(),"codice",b).data.extra)?c.split(",")[0]:0);var d=this.getTxImponibile().getValue();this.getTxTotale().setValue(d+d*c/100)},changeCBTipoContr:function(a,b){var c=this.getCBCategoriaContr().getStore();b&&c.load({params:{idTipo:b}})},
changeTxImponibile:function(a,b){var c=0;this.getCBAliIva().getValue()&&(c=(c=trovaRecord(this.getCBAliIva().getStore(),"codice",this.getCBAliIva().getValue()).data.extra)?c.split(",")[0]:0);var d=this.getTxImponibile().getValue();this.getTxTotale().setValue(d+d*c/100)},changeTxTotale:function(a,b,c,d){},clickBtnRifCigCup:function(){var a=this,b=a.cbaConfig.permesso;if("S"==b){var c=a.getCBFornitore().getValue();Ext.create("winCBA",{name:"Generali.clientiFornitori.view.SelezionaCigCup",titolo:"CIGCUP_SELECT",
larghezzaWin:1200,altezzaWin:400,configItem:{isWindow:!0,permesso:b,idCliFor:c,editDettagli:!1,leggiTabellaNuova:"T",soloAttivi:"T",insModifica:!0,dataDal:a.getEdtDurataDal().getValue(),dataAl:a.getEdtDurataAl().getValue(),afterConferma:function(b,c,g,h){a.getTxCig().setValue(c);a.getTxCup().setValue(g);a.getTxIdCigCup().setValue(b)}},closable:!0}).show()}},tabchangeTabPaginatore:function(a,b,c,d){a={};this.getChBConsideraImpo().setVisible("PnlConti"==b.itemId);Ext.apply(a,{controllerContrattiTes:this,
idOrganizzazione:this.cbaConfig.idOrganizzazione,recordTestata:this.getForm().getForm().getRecord()});"PnlConti"==b.itemId&&(this.getPnlConti().removeAll(),this.getPnlConti().add(Ext.create("GeneraliEC.contratti.view.ContiContratti",{cbaConfig:a})));"PnlArticoli"==b.itemId&&(this.getPnlArticoli().removeAll(),this.getPnlArticoli().add(Ext.create("GeneraliEC.contratti.view.ArticoliContratti",{cbaConfig:a})));"PnlDelibere"==b.itemId&&(this.getPnlDelibere().removeAll(),this.getPnlDelibere().add(Ext.create("GeneraliEC.contratti.view.DelibereContratti",
{cbaConfig:a})));"PnlAllegati"==b.itemId&&(this.getPnlAllegati().removeAll(),this.getPnlAllegati().add(Ext.create("GeneraliEC.contratti.view.AllegatiContratti",{cbaConfig:a})));"PnlDepositi"==b.itemId&&(this.getPnlDepositi().removeAll(),this.getPnlDepositi().add(Ext.create("GeneraliEC.contratti.view.DepositiContratti",{cbaConfig:a})))},verificaCampiForm:function(){var a=[];if(this.getForm().isValid()){var b=this.getEdtProroga().getValue(),c=this.getEdtDurataAl().getValue(),d=this.getEdtDurataDal().getValue(),
e=this.getEdtScadAntic().getValue();b&&e&&msgAddError(a,"MSG_NON_COMPILARE_PROROGA_ANTICIPATA");b&&b<c&&msgAddError(a,"MSG_DATA_PROROGA_MINORE_DATA_SCAD");e&&(e>c||e<d)&&msgAddError(a,"MSG_DATA_CHIUSURA_ANTICIPATA_NON_VALIDA")}else msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues(),d="-9999"==c.id?!0:!1;Ext.apply(c,{idOrganizzazione:this.cbaConfig.idOrganizzazione,bloccaOrdine:getBoolValue(c.bloccaOrdine),consideraImponibile:getBoolValue(c.consideraImponibile),
proponiInAutomatico:getBoolValue(c.proponiInAutomatico),fieldAttivo:getBoolValue(c.fieldAttivo),desCliFor:this.getCBFornitore().rawValue});if(b=controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"}))c=this.cbaConfig.controllerPnlContratti.getCntRicerca().down("#GridRicerca"),1==d?(c.getStore().insert(0,b),c.getStore().load(),c.getSelectionModel().select(0)):(this.cbaConfig.idTestata=b.id,d=trovaRecord(c.getStore(),"id",b.id),d.set(b),c.getSelectionModel().select(d)),a&&this.callbackEsci&&this.callbackEsci()},
gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=Ext.create("GeneraliEC.contratti.store.ContrattiTes");b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b);a.getTabPaginatore().setDisabled(!1)},annulla_callback:function(){b.getForm().findField("id").getValue();a.aggiornaStore();a.getTabPaginatore().setDisabled(!1)},nuovo_callback:function(){controller_nuovoRecord(b);
a.getTabPaginatore().setDisabled(!0)},elimina_callback:function(){a.inserimentoDaTestata=!1;var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore();a.fireEvent("ClickRicerca")})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){a.getForm().up("window").close()}}});inserisciBottoni(b.boxBottoni,c);a.cbaConfig.mostraEsciGenerale||b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",
function(c,e){controller_abilitaBottoni(b);a.cbaConfig.controllerPnlContratti.getCntRicerca().setDisabled(e)})},aggiornaStore:function(a){var b=this,c=b.getForm(),d=c.getForm(),e=c.store;if(a?!a:!b.cbaConfig.idTestata)return clearForm(b.getForm()),!1;e.load({params:{id:a?a:b.cbaConfig.idTestata},callback:function(a,e,k){k?Ext.isEmpty(a)?clearForm(c):(d.loadRecord(a[0]),a[0].get("idCliFor")&&setCombo(b.getCBFornitore(),a[0].get("idCliFor"),a[0].get("desCliFor"),{descrizione:a[0].get("desCliFor")}),
a=b.getEdtDurataAl().getValue(),e=new Date,b.getEdtScadAntic().getValue()&&(a=b.getEdtScadAntic().getValue()),b.getEdtProroga().getValue()&&(a=b.getEdtProroga().getValue()),b.getChBAttivo().setDisabled(e<=a),a=b.getTabPaginatore(),a.setActiveTab("PnlConti"),a.fireEvent("tabchange",a,a.getActiveTab())):msgShowError("",e.getError())}})},onLaunch:function(){this.on("ClickRicerca",function(){this.cbaConfig.controllerPnlContratti.getCntRicerca().down("#BtnCerca").fireEvent("click")});this.idOrganizzazione=
this.cbaConfig.idOrganizzazione;this.storeFornitore=this.getCBFornitore().getStore();this.storeFornitore.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,tipo:"F",attivo:"T",limit:0};this.getEdtDurataDal().validate();this.getEdtDurataAl().validate();this.getCBFornitore().validate();this.getCBAliIva().getStore().getProxy().extraParams={attivo:"T"};this.getCBTipoContr().getStore().load({params:{idOrganizzazione:this.idOrganizzazione}});this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeFornitore);
eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.contratti.controller.DelibereContratti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridDelibere",selector:this.selContainer+"#GridDelibere"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#GridDelibere",{beforeedit:this.beforeeditGridDelibere,edit:this.editGridDelibere,
canceledit:this.canceleditGridDelibere,validateedit:this.validateeditGridDelibere});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnNuovo:function(a){controller_nuovoRecordGrid({},this.getGridDelibere())},clickBtnElimina:function(a){var b=this;a=b.getGridDelibere();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},
beforeeditGridDelibere:function(a,b,c){if(!0===a.editing)return!1;this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},editGridDelibere:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();Ext.apply(c,{idContratto:this.cbaConfig.recordTestata.get("id")});controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},
canceleditGridDelibere:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridDelibere:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridDelibere(),c=b.getStore();c.load({params:{idContratto:this.cbaConfig.recordTestata.get("id")},callback:function(d,e,g){g?(d=null,a&&(d=trovaRecord(c,"id",a)),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d?[d]:0)):msgShowError("",e.getError())}})},svuotaStore:function(){svuotaStore(this.getGridDelibere().getStore())},
onLaunch:function(){this.getGridDelibere().controller=this;this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.contratti.controller.DepositiContratti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridDepositi",selector:this.selContainer+"#GridDepositi"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#GridDepositi",{beforeedit:this.beforeeditGridDepositi,edit:this.editGridDepositi,
canceledit:this.canceleditGridDepositi,validateedit:this.validateeditGridDepositi});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnNuovo:function(a){controller_nuovoRecordGrid({},this.getGridDepositi())},clickBtnElimina:function(a){var b=this;a=b.getGridDepositi();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},
beforeeditGridDepositi:function(a,b,c){if(!0===a.editing)return!1;f=a.getEditor().getForm();f.findField("idDeposito").bindStore(this.storeDepositi);this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},editGridDepositi:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();delete c.desDeposito;Ext.apply(c,{idContratto:this.cbaConfig.recordTestata.get("id")});controller_salvaRecord(d,
c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridDepositi:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridDepositi:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridDepositi(),c=b.getStore();c.load({params:{idContratto:this.cbaConfig.recordTestata.get("id")},callback:function(d,e,g){g?(d=null,a&&(d=trovaRecord(c,"id",a)),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d?
[d]:0)):msgShowError("",e.getError())}})},svuotaStore:function(){svuotaStore(this.getGridArticoli().getStore())},onLaunch:function(){this.getGridDepositi().controller=this;this.storeDepositi=Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi");this.storeDepositi.getProxy().extraParams={idOrganizzazione:this.cbaConfig.idOrganizzazione};this.aggiornaStore()},destroy:function(){eliminaStore(this.storeDepositi);this.callParent()}});
Ext.define("GeneraliEC.contratti.controller.PnlContratti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"},{ref:"CntRicerca",selector:this.selContainer+"#CntRicerca"},{ref:"CntDati",selector:this.selContainer+"#CntDati"}])},selectGridRicerca:function(a,b){var c=this.getCntDati(),d=a?a.get("id"):0;Ext.isDefined(this.ContrattiTestata)?(this.ContrattiTestata.cbaConfig.idTestata=
a?a.get("id"):null,a?this.ContrattiTestata.controller.aggiornaStore(a.get("id")):this.ContrattiTestata.controller.aggiornaStore()):(this.ContrattiTestata=Ext.create("GeneraliEC.contratti.view.ContrattiTes",{cbaConfig:{permesso:this.cbaConfig.permesso,controllerPnlContratti:this,ownerGridRicerca:b,idTestata:d,idOrganizzazione:this.idOrganizzazione}}),c.add(this.ContrattiTestata))},onLaunch:function(){var a=this;a.idOrganizzazione=a.cbaConfig.idOrganizzazione;a.getCntRicerca().add(Ext.create("GeneraliEC.contratti.view.RicercaContratti",
{cbaConfig:{permesso:a.cbaConfig.permesso,controllerPnlContratti:a,idOrganizzazione:a.idOrganizzazione,selectGridRicerca:function(b,c){a.selectGridRicerca(b,c)}}}))}});
Ext.define("GeneraliEC.contratti.controller.RicercaContratti",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"CntRicerca",selector:a.selContainer+"#CntRicerca"},{ref:"GridRicerca",selector:a.selContainer+"#GridRicerca"},{ref:"BtnCerca",selector:a.selContainer+"#BtnCerca"},{ref:"PTRicerca",selector:a.selContainer+"#PTRicerca"},{ref:"CbxAttivo",selector:a.selContainer+"#CbxAttivo"},{ref:"CbxNonAttivo",
selector:a.selContainer+"#CbxNonAttivo"},{ref:"TxtCercaFornitore",selector:a.selContainer+"#TxtCercaFornitore"}]);a.control(a.selContainer+"#BtnCerca",{click:a.cerca});a.control(a.selContainer+"#GridRicerca",{select:a.selectGridRicerca,itemdblclick:a.itemdblclickGridRicerca});a.control(a.selContainer+"#TxtCercaFornitore",{keypress:a.keypressTxtCercaFornitore,change:Ext.Function.createBuffered(function(b){a.cerca()},500)})},itemdblclickGridRicerca:function(a,b){this.cbaConfig.dblclickGridRicerca&&
this.cbaConfig.dblclickGridRicerca(a,b)},selectGridRicerca:function(a,b){1024>=Ext.getBody().getViewSize().width&&this.cbaConfig.controllerPnlCatalogoArticoli.getCntRicerca().collapse();this.cbaConfig.selectGridRicerca&&this.cbaConfig.selectGridRicerca(b,this.getGridRicerca())},keypressTxtCercaFornitore:function(a,b,c){13==b.getCharCode()&&(a=this.getBtnCerca(),a.fireEvent("click",a))},cerca:function(a){var b=this,c="";b.getCbxAttivo().checked&&b.getCbxNonAttivo().checked&&(c="");b.getCbxAttivo().checked&&
!b.getCbxNonAttivo().checked&&(c="T");!b.getCbxAttivo().checked&&b.getCbxNonAttivo().checked&&(c="F");a={idOrganizzazione:b.cbaConfig.idOrganizzazione};""!=c&&Ext.apply(a,{attivo:c});b.getTxtCercaFornitore().getValue()&&Ext.apply(a,{desCliFor:b.getTxtCercaFornitore().getValue()});c=b.getGridRicerca().getStore();c.getProxy().extraParams=a;c.loadPage(c.currentPage,{callback:function(a,c,g){g?b.cbaConfig.selectGridRicerca&&b.cbaConfig.selectGridRicerca(a[0],b.getGridRicerca()):msgShowError("",c.getError())}})},
onLaunch:function(){this.store=Ext.create("GeneraliEC.contratti.store.RicercaContratti",{pageSize:25});this.getGridRicerca().bindStore(this.store);this.getPTRicerca().bindStore(this.store);this.cerca()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.contratti.store.AllegatiContratti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idContratto"},{name:"idAllegato"},{name:"idCliFor"},{name:"dataAllegato",type:"date"},{name:"desAllegato"},{name:"fileName"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contrattiAllegati/get",api:{read:getUrlGen()+"/ws/contrattiAllegati/list",create:getUrlGen()+"/ws/contrattiAllegati/insert",update:getUrlGen()+"/ws/contrattiAllegati/update",
destroy:getUrlGen()+"/ws/contrattiAllegati/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.contratti.store.ArticoliContratti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idContratto"},{name:"idEsercizio"},{name:"idDeposito"},{name:"idArticolo"},{name:"qtaMinima"},{name:"importoMinimo"},{name:"desDeposito"},{name:"desArticolo"},{name:"idUdm"},{name:"desUdm"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contrattiArticoli/get",api:{read:getUrlGen()+"/ws/contrattiArticoli/list",create:getUrlGen()+"/ws/contrattiArticoli/insert",
update:getUrlGen()+"/ws/contrattiArticoli/update",destroy:getUrlGen()+"/ws/contrattiArticoli/delete"}}},a)])},autoDestroy:!0});Ext.define("GeneraliEC.contratti.store.CboxContratti",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contratti/cbox"}},a)])},autoDestroy:!0});
Ext.define("OF.contratti.store.CboxEsercizioContratti",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contrattiAnno/cboxEsercizi"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.contratti.store.ContiContratti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idContratto"},{name:"idEsercizio"},{name:"idConto"},{name:"importoCig"},{name:"desEsercizio"},{name:"desConto"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contrattiAnno/get",api:{read:getUrlGen()+"/ws/contrattiAnno/list",create:getUrlGen()+"/ws/contrattiAnno/insert",update:getUrlGen()+"/ws/contrattiAnno/update",destroy:getUrlGen()+"/ws/contrattiAnno/delete"}}},
a)])},autoDestroy:!0});
Ext.define("GeneraliEC.contratti.store.ContrattiTes",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCliFor"},{name:"descrizione"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"},{name:"dataScadAnticipata",type:"date"},{name:"dataProroga",type:"date"},{name:"idCliForCigCup"},{name:"budget"},{name:"minimoOrdine"},{name:"imponibile"},{name:"totale"},{name:"idAliquotaIva"},{name:"bloccaOrdine"},{name:"desAliquotaIva"},{name:"idRespUnicoProgetto"},{name:"desRespUnicoProgetto"},{name:"desCliFor"},
{name:"attivo"},{name:"numero"},{name:"dataContratto",type:"date"},{name:"desCig"},{name:"desCup"},{name:"consideraImponibile"},{name:"proponiInAutomatico"},{name:"fieldAttivo"},{name:"numeroAnnuale"},{name:"dataDisdetta",type:"date"},{name:"dataIstruttoria",type:"date"},{name:"tipo"},{name:"categoria"},{name:"scadenzaGaranzia",type:"date"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contratti/get",api:{read:getUrlGen()+"/ws/contratti/get",create:getUrlGen()+
"/ws/contratti/insert",update:getUrlGen()+"/ws/contratti/update",destroy:getUrlGen()+"/ws/contratti/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.contratti.store.DelibereContratti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idContratto"},{name:"data",type:"date"},{name:"organo"},{name:"numero"},{name:"oggetto"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contrattiDelibere/get",api:{read:getUrlGen()+"/ws/contrattiDelibere/list",create:getUrlGen()+"/ws/contrattiDelibere/insert",update:getUrlGen()+"/ws/contrattiDelibere/update",destroy:getUrlGen()+"/ws/contrattiDelibere/delete"}}},
a)])},autoDestroy:!0});
Ext.define("GeneraliEC.contratti.store.DepositiContratti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idContratto"},{name:"idDeposito"},{name:"desDeposito"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contrattiDepositi/get",api:{read:getUrlGen()+"/ws/contrattiDepositi/list",create:getUrlGen()+"/ws/contrattiDepositi/insert",update:getUrlGen()+"/ws/contrattiDepositi/update",destroy:getUrlGen()+"/ws/contrattiDepositi/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.contratti.store.RicercaContratti",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idCliFor"},{name:"desCliFor"},{name:"dataDal",type:"date"},{name:"dataAl",type:"date"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contratti/list"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.contratti.store.cboxUtentiAbilitati",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/contratti/cbox/utentiAbilitati"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.contratti.view.AllegatiContratti",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridAllegati",reference:"GridAllegati",overflowX:"hidden",overflowY:"auto",layout:{align:"stretch"},width:170,store:Ext.create("GeneraliEC.contratti.store.AllegatiContratti"),viewConfig:{loadMask:!1},title:"ALLEGATI",collapsible:!0,collapseDirection:"left",hideHeaders:!0,columns:[{xtype:"actioncolumn",
width:20,text:"",items:[{iconCls:"icon-allegato",isDisabled:function(a,b,c,d,e){return Ext.isEmpty(e.get("fileName"))}}]},{xtype:"gridcolumn",flex:1,dataIndex:"desAllegato"}]},{xtype:"splitter"},{xtype:"container",nonDisabilitare:!0,scrollable:!0,border:0,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",itemId:"Form",reference:"Form",nonDisabilitare:!0,scrollable:!0,padding:"15 0 0 10",border:0,layout:{type:"vbox",align:"stretch"},trackResetOnLoad:!0,items:[{xtype:"numberfield",hidden:!0,
name:"id"},{xtype:"numberfield",hidden:!0,name:"idAllegato"},{xtype:"numberfield",hidden:!0,name:"idContratto"},{xtype:"datefield",itemId:"Data",reference:"Data",maxWidth:180,fieldLabel:"DATA",labelWidth:70,labelClsExtra:"cbaLabel",allowBlank:!1,selectOnFocus:!0,name:"dataAllegato"},{xtype:"textfield",itemId:"TxtDescrizione",reference:"TxtDescrizione",name:"desAllegato",fieldLabel:"DESCRIZIONE",maxLength:100,enforceMaxLength:!0,labelClsExtra:"cbaLabel",allowBlank:!1,maxWidth:370,labelWidth:70},{xtype:"displayfield",
itemId:"TxtFileName",reference:"TxtFileName",name:"fileName",labelClsExtra:"cbaLabel",maxLength:100,enforceMaxLength:!0,maxWidth:370,editable:!1}]},{xtype:"container",itemId:"CntAllegato",reference:"CntAllegato",flex:1,layout:{type:"fit"},items:[{xtype:"form",itemId:"FormAllegato",reference:"FormAllegato",border:!1,padding:5,bodyPadding:"5 0 0 0",layout:"hbox",items:[{xtype:"filefield",itemId:"AllegatoUpload",reference:"AllegatoUpload",baseCls:"cba-button-25",buttonOnly:!0,name:"fileData",buttonConfig:{xtype:"filebutton",
margin:"0 0 1 0",cls:"cba-button-25",alwaysOnTop:!0,itemId:"BtnAllega",reference:"BtnAllega",text:traduci("ALLEGA_FILE"),iconCls:"icon-allegato"},listeners:{afterrender:function(a){a.fileInputEl.set({accept:StdSipcar.getValidExtensions()})}}},{xtype:"button",itemId:"BtnEliminaAllegato",reference:"BtnEliminaAllegato",cls:"cba-button-25",iconCls:"icon-elimina",margin:"0 0 1 0",text:"ELIMINA",hidden:!0}]}]}]},{xtype:"container",itemId:"CntAnteprima",reference:"CntAnteprima",border:0,flex:2,layout:{type:"fit"}},
{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.contratti.view.ArticoliContratti",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",height:200,itemId:"GridArticoli",reference:"GridArticoli",store:Ext.create("GeneraliEC.contratti.store.ArticoliContratti"),flex:1,columns:[{xtype:"gridcolumn",text:"DEPOSITO",sortable:!1,minWidth:200,flex:1,dataIndex:"idDeposito",itemId:"CBDeposito",reference:"CBDeposito",editor:{xtype:"combobox",
displayField:"valore",valueField:"codice",queryParam:"descrizione",minChars:0,emptyText:"Tutti i Depositi"},renderer:function(a,b,c,d,e,g,h){return c.get("desDeposito")?c.get("desDeposito"):"Tutti i Depositi"}},{xtype:"gridcolumn",text:"ARTICOLO",sortable:!1,flex:1,dataIndex:"idArticolo",editor:{xtype:"combobox",itemId:"CBArticolo",reference:"CBArticolo",displayField:"valore",valueField:"codice",queryParam:"descrizione",allowBlank:!1,minChars:3,enableKeyEvents:!0},renderer:function(a,b,c,d,e,g,h){return c.get("desArticolo")}},
{xtype:"gridcolumn",dataIndex:"desUdm",text:"UNITA_MISURA",align:"center",width:60,itemId:"TxDesUM",reference:"TxDesUM"},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"QUANTITA_MINIMA",dataIndex:"qtaMinima",renderer:cell_renderer_numero,itemId:"ColQuant",reference:"ColQuant",editor:{xtype:"numberfield",selectOnFocus:!0,allowBlank:!1,listeners:{change:function(a,b){var c=a.up("form").getForm().findField("importoMinimo");c.allowBlank=0<b?!0:!1;c.validate()}}}},{xtype:"gridcolumn",width:95,
align:"center",sortable:!1,text:"IMPORTO_MINIMO",dataIndex:"importoMinimo",renderer:cell_renderer_importo,itemId:"ColImporto",reference:"ColImporto",editor:{xtype:"numberfield",selectOnFocus:!0,allowBlank:!1,listeners:{change:function(a,b){var c=a.up("form").getForm().findField("qtaMinima");c.allowBlank=0<b?!0:!1;c.validate()}}}}],viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",
itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.contratti.view.ContiContratti",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",height:200,itemId:"GridConti",reference:"GridConti",store:Ext.create("GeneraliEC.contratti.store.ContiContratti"),flex:1,columns:[{xtype:"gridcolumn",text:"ESERCIZIO",sortable:!1,width:100,dataIndex:"idEsercizio",itemId:"CBEsercizio",reference:"CBEsercizio",editor:{xtype:"combobox",displayField:"valore",
valueField:"codice",queryMode:"local",allowBlank:!1,enableKeyEvents:!0,store:Ext.create("Generali.esercizioCont.store.cboxEsercizioCont")},renderer:function(a,b,c,d,e,g,h){return c.get("desEsercizio")}},{xtype:"gridcolumn",text:"CONTO",sortable:!1,flex:1,dataIndex:"idConto",itemId:"CBConto",reference:"CBConto",editor:{xtype:"combobox",displayField:"valore",valueField:"codice",queryParam:"descrizione",allowBlank:!1,minChars:3,enableKeyEvents:!0},renderer:function(a,b,c,d,e,g,h){return c.get("desConto")}},
{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"IMPORTO",dataIndex:"importoCig",renderer:cell_renderer_importo,editor:{xtype:"numberfield",selectOnFocus:!0}}],viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",
text:"Elimina"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.contratti.view.ContrattiTes",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",title:"GESTIONE_CONTRATTI",border:0,itemId:"CntContrattiTes",reference:"CntContrattiTes",layout:{align:"stretch",type:"hbox"},items:[{xtype:"form",border:0,flex:1,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",fieldLabel:"ID",
name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"numberfield",fieldLabel:"IDCIGCUP",name:"idCliForCigCup",itemId:"TxIdCigCup",reference:"TxIdCigCup",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"EdtDtContratto",reference:"EdtDtContratto",fieldLabel:"DATA",name:"dataContratto",labelClsExtra:"cbaLabel",allowBlank:!1,labelWidth:70,width:180},{xtype:"textfield",itemId:"TxNumContratto",reference:"TxNumContratto",fieldLabel:"NUMERO",name:"numero",
labelClsExtra:"cbaLabel",labelWidth:70,width:180,renderer:cell_renderer_numero,margin:"0 0 0 20",allowBlank:!1},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChBProponiAuto",reference:"ChBProponiAuto",fieldLabel:"",boxLabel:"PROPONI_IN_AUTOMATICO",inputValue:"T",uncheckedValue:"F",name:"proponiInAutomatico",margin:"0 0 0 20"},{xtype:"textfield",name:"numeroAnnuale",labelClsExtra:"cbaLabel",fieldLabel:"",labelWidth:20,width:100,margin:"0 0 0 30",readOnly:!0}]},{xtype:"container",margin:"10 0 0 0",
layout:{type:"hbox"},items:[{xtype:"combobox",labelWidth:70,width:380,fieldLabel:"FORNITORE",labelClsExtra:"cbaLabel",itemId:"CBFornitore",reference:"CBFornitore",name:"idCliFor",displayField:"valore",queryParam:"descrizione",valueField:"codice",store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor"),allowBlank:!1,minChars:3},{xtype:"combobox",width:280,fieldLabel:"RUP",labelWidth:50,labelClsExtra:"cbaLabel",itemId:"CBUtentiAbilitati",reference:"CBUtentiAbilitati",name:"idRespUnicoProgetto",displayField:"valore",
queryMode:"local",valueField:"codice",margin:"0 0 0 20",allowBlank:!1,store:Ext.create("GeneraliEC.contratti.store.cboxUtentiAbilitati",{autoLoad:!0})}]},{xtype:"container",margin:"10 0 0 0",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"EdtDurataDal",reference:"EdtDurataDal",fieldLabel:"DURATA",name:"dataDal",labelClsExtra:"cbaLabel",allowBlank:!1,labelWidth:70,width:180},{xtype:"datefield",itemId:"EdtDurataAl",reference:"EdtDurataAl",fieldLabel:"AL",name:"dataAl",labelClsExtra:"cbaLabel",
allowBlank:!1,labelWidth:70,width:180,margin:"0 0 0 20"},{xtype:"datefield",itemId:"EdtScadAntic",reference:"EdtScadAntic",fieldLabel:"CHIUS_ANTICIPATA",name:"dataScadAnticipata",labelClsExtra:"cbaLabel",labelWidth:130,width:240,margin:"0 0 0 20"},{xtype:"datefield",itemId:"EdtProroga",reference:"EdtProroga",fieldLabel:"PROROGA",name:"dataProroga",labelClsExtra:"cbaLabel",labelWidth:50,width:160,margin:"0 0 0 20"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChBAttivo",reference:"ChBAttivo",fieldLabel:"",
boxLabel:"ATTIVO",inputValue:"T",uncheckedValue:"F",name:"fieldAttivo",margin:"0 0 0 20"}]},{xtype:"container",margin:"10 0 0 0",layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"EdtDataDisdetta",reference:"EdtDataDisdetta",fieldLabel:"DATA_DISDETTA",name:"dataDisdetta",labelClsExtra:"cbaLabel",labelWidth:70,width:180},{xtype:"datefield",itemId:"EdtDataIstruttoria",reference:"EdtDataIstruttoria",fieldLabel:"DATA_ISTRUTTORIA",name:"dataIstruttoria",labelClsExtra:"cbaLabel",labelWidth:70,width:180,
margin:"0 0 0 20"},{xtype:"datefield",itemId:"EdtDtScadGar",reference:"EdtDtScadGar",fieldLabel:"SCAD_GARANZIA",name:"scadenzaGaranzia",margin:"0 0 0 20",labelWidth:70,width:180,labelClsExtra:"cbaLabel"}]},{xtype:"container",margin:"10 0 0 0",layout:{type:"hbox"},items:[{xtype:"fieldset",title:"TERMINI_ECONOMICI",margin:"5 0 0 0",width:420,layout:{type:"vbox"},items:[{xtype:"container",margin:"5 0 0 0",layout:{type:"hbox"},items:[{xtype:"numberfield",itemId:"TxMinimo",reference:"TxMinimo",fieldLabel:"MINIMO",
name:"minimoOrdine",labelClsExtra:"cbaLabel",labelWidth:70,width:180,margin:"0 5 0 0",renderer:cell_renderer_importo},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChBBloccaOrd",reference:"ChBBloccaOrd",fieldLabel:"",boxLabel:"BLOCCA_ORDINE",inputValue:"T",uncheckedValue:"F",name:"bloccaOrdine",width:110,margin:"0 5 0 0"}]},{xtype:"container",margin:"10 0 0 0",layout:{type:"hbox"},items:[{xtype:"numberfield",itemId:"TxImponibile",reference:"TxImponibile",fieldLabel:"IMPONIBILE",name:"imponibile",
labelClsExtra:"cbaLabel",labelWidth:70,width:180,margin:"0 5 0 0",renderer:cell_renderer_importo},{xtype:"combobox",width:220,fieldLabel:"IVA",labelWidth:50,labelClsExtra:"cbaLabel",itemId:"CBAliIva",reference:"CBAliIva",name:"idAliquotaIva",displayField:"valore",queryMode:"local",valueField:"codice",margin:"0 5 0 0",store:Ext.create("Generali.aliquotaiva.store.cboxAliquotaIvaAbbr",{autoLoad:!0})}]},{xtype:"container",margin:"10 0 5 0",layout:{type:"hbox"},items:[{xtype:"numberfield",itemId:"TxTotale",
reference:"TxTotale",fieldLabel:"TOTALE",name:"totale",labelClsExtra:"cbaLabel",labelWidth:70,width:180,renderer:cell_renderer_importo,margin:"0 5 0 0",editable:!1}]}]},{xtype:"fieldset",title:"CLASSIFICAZIONE",margin:"5 0 0 10",width:260,layout:{type:"vbox"},items:[{xtype:"combobox",width:240,fieldLabel:"TIPO",labelWidth:70,labelClsExtra:"cbaLabel",itemId:"CBTipoContr",reference:"CBTipoContr",name:"tipo",displayField:"valore",queryMode:"local",valueField:"codice",margin:"10 0 0 0",store:Ext.create("GeneraliEC.tipCatContratti.store.CboxTipiContratti",
{autoLoad:!1})},{xtype:"combobox",width:240,fieldLabel:"CATEGORIA",labelWidth:70,labelClsExtra:"cbaLabel",itemId:"CBCategoriaContr",reference:"CBCategoriaContr",name:"categoria",displayField:"valore",queryMode:"local",valueField:"codice",margin:"10 0 5 0",store:Ext.create("GeneraliEC.tipCatContratti.store.CboxCategorieContratti",{autoLoad:!1})}]}]},{xtype:"textareafield",height:50,width:420,labelWidth:70,fieldLabel:"NOTE",enforceMaxLength:!0,maxLength:255,name:"descrizione",labelClsExtra:"cbaLabel",
margin:"10 0 0 0"},{xtype:"fieldset",title:"CIG_CUP",height:60,margin:"10 0 0 0",layout:{type:"hbox"},items:[{xtype:"button",itemId:"BtnRifCigCup",reference:"BtnRifCigCup",scale:"large",iconCls:"icon-assegna",text:"INSERISCI_CIG_CUP",tooltip:"INSERISCI_CIG_CUP"},{xtype:"textfield",itemId:"TxCig",reference:"TxCig",fieldLabel:"CIG",name:"desCig",labelClsExtra:"cbaLabel",labelWidth:35,width:160,renderer:cell_renderer_numero,margin:"5 0 0 20",maxLength:10,enforceMaxLength:!0,editable:!1},{xtype:"textfield",
itemId:"TxCup",reference:"TxCup",fieldLabel:"CUP",name:"desCup",labelClsExtra:"cbaLabel",labelWidth:35,width:160,renderer:cell_renderer_numero,margin:"5 0 0 20",maxLength:15,enforceMaxLength:!0,editable:!1}]},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChBConsideraImpo",reference:"ChBConsideraImpo",fieldLabel:"",boxLabel:"CONSIDERA_IMPONIBILE_ESERCIZIO",inputValue:"T",uncheckedValue:"F",name:"consideraImponibile",margin:"5 0 0 0"}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",
width:120}]},{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"tabpanel",itemId:"TabPaginatore",reference:"TabPaginatore",flex:1,items:[{xtype:"panel",itemId:"PnlConti",reference:"PnlConti",title:"CONTI",layout:{type:"fit"}},{xtype:"panel",itemId:"PnlArticoli",reference:"PnlArticoli",title:"ARTICOLI",layout:{type:"fit"}},{xtype:"panel",itemId:"PnlDelibere",reference:"PnlDelibere",title:"DELIBERE",layout:{type:"fit"}},{xtype:"panel",itemId:"PnlAllegati",reference:"PnlAllegati",
title:"ALLEGATI",layout:{type:"fit"}},{xtype:"panel",itemId:"PnlDepositi",reference:"PnlDepositi",title:"DEPOSITI",layout:{type:"fit"}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.contratti.view.DelibereContratti",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",height:200,itemId:"GridDelibere",reference:"GridDelibere",store:Ext.create("GeneraliEC.contratti.store.DelibereContratti"),flex:1,columns:[{xtype:"datecolumn",dataIndex:"data",text:"DATA",width:90,format:"d/m/Y",align:"center",editor:{xtype:"datefield",allowBlank:!1}},{xtype:"gridcolumn",flex:1,
align:"left",sortable:!1,text:"ORGANO",dataIndex:"organo",editor:{xtype:"textfield",selectOnFocus:!0,maxLength:100,enforceMaxLength:!0}},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"NUMERO",dataIndex:"numero",renderer:cell_renderer_numero,editor:{xtype:"numberfield",selectOnFocus:!0}},{xtype:"gridcolumn",flex:1,align:"left",sortable:!1,text:"OGGETTO",dataIndex:"oggetto",editor:{xtype:"textfield",selectOnFocus:!0,maxLength:100,enforceMaxLength:!0}}],viewConfig:{width:300,loadMask:!1},
plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.contratti.view.DepositiContratti",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",height:200,itemId:"GridDepositi",reference:"GridDepositi",store:Ext.create("GeneraliEC.contratti.store.DepositiContratti"),flex:1,columns:[{xtype:"gridcolumn",text:"DEPOSITO",sortable:!1,minWidth:200,flex:1,dataIndex:"idDeposito",itemId:"CBDeposito",reference:"CBDeposito",editor:{xtype:"combobox",
displayField:"valore",valueField:"codice",queryParam:"descrizione",minChars:0,emptyText:"Tutti i Depositi"},renderer:function(a,b,c,d,e,g,h){return c.get("desDeposito")?c.get("desDeposito"):"Tutti i Depositi"}}],viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},{xtype:"button",itemId:"BtnElimina",
reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.contratti.view.PnlContratti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,itemId:"CntPrincipale",reference:"CntPrincipale",layout:{align:"stretch",type:"hbox"},items:[{xtype:"panel",itemId:"CntRicerca",reference:"CntRicerca",split:!0,collapsible:!0,collapseDirection:"left",title:"RICERCA",border:0,layout:"fit",width:340,hidden:this.cbaConfig.caricamentoEsterno},{xtype:"splitter",hidden:this.cbaConfig.caricamentoEsterno},
{xtype:"container",itemId:"CntDati",reference:"CntDati",layout:"fit",flex:1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.contratti.view.RicercaContratti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",flex:1,itemId:"Form",reference:"Form",noModificaDati:!0,border:0,frame:!1,layout:{align:"stretch",type:"vbox"},trackResetOnLoad:!0,items:[{xtype:"panel",itemId:"CntRicerca",reference:"CntRicerca",padding:"5 5 0 5",padding:5,fieldDefaults:{margin:"0 5 5 0"},border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"checkboxgroup",
flex:1,margin:"0 0 5 0",labelClsExtra:"cbaLabel",items:[{xtype:"checkboxfield",itemId:"CbxAttivo",reference:"CbxAttivo",boxLabel:"ATTIVO",checked:!0,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxNonAttivo",reference:"CbxNonAttivo",boxLabel:"NON_ATTIVO",checked:!0,cls:"cbaLabel"}]},{xtype:"textfield",itemId:"TxtCercaFornitore",reference:"TxtCercaFornitore",flex:1,fieldLabel:"",emptyText:"CERCA",enableKeyEvents:!0,labelClsExtra:"cbaLabel"},{xtype:"panel",border:0,height:45,layout:{type:"hbox",align:"stretch"},
items:[{xtype:"button",cls:"btnLarge",itemId:"BtnCerca",reference:"BtnCerca",margin:"0 5 0 0",width:80,iconCls:"icon-ricerca",scale:"large",text:"CERCA",tooltip:"EFFETTUA_RICERCA"},{xtype:"container",flex:1}]}]},{xtype:"panel",flex:1,border:0,layout:{type:"vbox",align:"stretch"},title:"RISULTATI",items:[{xtype:"gridpanel",border:0,autoScroll:!0,flex:1,itemId:"GridRicerca",reference:"GridRicerca",title:"",columns:[{xtype:"gridcolumn",dataIndex:"desCliFor",align:"left",text:"FORNITORE",flex:1},{xtype:"gridcolumn",
dataIndex:"numero",align:"center",text:"NUMERO",renderer:cell_renderer_numero,width:50}],viewConfig:{border:0,loadMask:!1},dockedItems:[{xtype:"pagingtoolbar",dock:"bottom",itemId:"PTRicerca",reference:"PTRicerca"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.depositi.controller.Depositi",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"GridDepositi",selector:this.selContainer+"#GridDepositi"},{ref:"PnlLuoCons",selector:this.selContainer+"#PnlLuoCons"},{ref:"CBComune",
selector:this.selContainer+"#CBComune"},{ref:"CBNazione",selector:this.selContainer+"#CBNazione"},{ref:"ChBAttivo",selector:this.selContainer+"#ChBAttivo"},{ref:"ChBoxFarmaci",selector:this.selContainer+"#ChBoxFarmaci"},{ref:"CmcMagazzino",selector:this.selContainer+"#CmcMagazzino"},{ref:"CmcFarmacia",selector:this.selContainer+"#CmcFarmacia"},{ref:"TxCap",selector:this.selContainer+"#TxCap"},{ref:"cntCda",selector:this.selContainer+"#cntCda"},{ref:"ApssIdArmadio",selector:this.selContainer+"#ApssIdArmadio"},
{ref:"ApssCdc",selector:this.selContainer+"#ApssCdc"},{ref:"CntBox",selector:this.selContainer+"#CntBox"}]);this.control(this.selContainer+"#GridDepositi",{select:this.selectGridDepositi});this.control(this.selContainer+"#CBComune",{change:this.changeCBComune});this.control(this.selContainer+"#CmcFarmacia",{change:this.changeCmcFarmacia});this.control(this.selContainer+"#ChBoxFarmaci",{change:this.changeChBoxFarmaci})},changeChBoxFarmaci:function(a,b,c){this.getCntBox().setVisible(b)},changeCBComune:function(a,
b,c,d){a=this.getCBComune();(a=trovaRecord(a.getStore(),"codice",a.getValue()))&&this.getTxCap().setValue(a.data.extra.split(",")[1])},selectGridDepositi:function(a,b){var c=this.getPnlLuoCons().down("#GridLuoCons"),d=b.get("id");this.gestionePermessiDeposito(d);c.controller.idTestata=d;"M"==b.get("tipoDeposito")?b.set("magazzino",!0):b.set("magazzino",!1);"F"==b.get("tipoDeposito")?b.set("farmacia",!0):b.set("farmacia",!1);"E"==b.get("tipoDeposito")&&(b.set("farmacia",!0),b.set("magazzino",!0));
clearForm(this.getForm());this.getForm().loadRecord(b);b.get("comune")&&setCombo(this.getCBComune(),b.get("comune"),b.get("desComune"),{valore:b.get("desComune")});this.depositoApss=b.get("depositoApss");this.manageApssField();d&&c.controller.aggiornaStore()},changeCmcFarmacia:function(a,b,c){this.manageApssField()},manageApssField:function(){var a=this.getApssIdArmadio(),b=this.getApssCdc();this.getCmcMagazzino().getValue();var c=this.getCmcFarmacia().getValue(),c="T"==this.depositoApss&&c;a.setVisible(c);
a.allowBlank=!c;a.validate();b.setVisible(c);b.allowBlank=!c;b.validate()},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");0==this.getCmcMagazzino().getValue()&&0==this.getCmcFarmacia().getValue()&&msgAddError(a,"SELEZIONARE_MAG_FAR");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues(),d;1==c.magazzino&&(d="M");1==c.farmacia&&(d="F");1==c.magazzino&&1==c.farmacia&&(d="E");delete c.farmacia;delete c.magazzino;
delete c.descrizioneCodice;delete c.annoCda;delete c.desAnnoCda;delete c.cda1;delete c.cda2;delete c.cda3;delete c.cda4;delete c.tipoContabilita;Ext.apply(c,{idOrganizzazione:this.cbaConfig.idOrganizzazione,attivo:getBoolValue(c.attivo),boxFarmaci:getBoolValue(c.boxFarmaci),tipoDeposito:d});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestionePermessiDeposito:function(a){a=StdEconomato.permesso(this,"D",a);a=StdEconomato.gestionePermessiDeposito(this.getForm(),
this.getBoxBottoni(),a);this.getPnlLuoCons().setDisabled(a)},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.getGridDepositi().getStore();b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){b.getForm().findField("id").getValue();a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);
58==CBA.moduli.moduloAttivo&&a.getCmcMagazzino().setValue(!0);62==CBA.moduli.moduloAttivo&&a.getCmcFarmacia().setValue(!0);57==CBA.moduli.moduloAttivo&&(a.getCmcMagazzino().setValue(!1),a.getCmcFarmacia().setValue(!1));a.getChBAttivo().setValue(!0);a.getGridDepositi().setDisabled(!0);a.getPnlLuoCons().down("#GridLuoCons").setDisabled(!0);svuotaStore(a.getPnlLuoCons().down("#GridLuoCons").getStore())},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,
{id:c},function(){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){a.getForm().up("window").close()}}});inserisciBottoni(b.boxBottoni,c);a.cbaConfig.mostraEsciGenerale||b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);a.getGridDepositi().setDisabled(e);a.getPnlLuoCons().down("#GridLuoCons").setDisabled(e)});a.cbaConfig.isWindow&&(b.boxBottoni.queryById("btnNuovo").hide(),
b.boxBottoni.queryById("btnElimina").hide(),a.getContainerTes().setDisabled(!0),b.boxBottoni.queryById("btnEsci").setVisible(!0))},aggiornaStore:function(a){var b=this,c=b.getForm(),d=c.getForm(),e=c.store;e.load({params:{idOrganizzazione:b.cbaConfig.idOrganizzazione},callback:function(g,h,k){k?(Ext.isEmpty(g)?(clearForm(c),svuotaStore(b.getPnlLuoCons().down("#GridLuoCons").getStore())):(a||(a=d.findField("id").getValue()),h=trovaRecord(e,"id",a),k=b.getGridDepositi(),k.getSelectionModel().deselectAll(),
k.getSelectionModel().select(h?[h]:0)),b.getPnlLuoCons().down("#GridLuoCons").setDisabled(Ext.isEmpty(g))):msgShowError("",h.getError())}})},onLaunch:function(){var a={};a.idOrganizzazione=this.cbaConfig.idOrganizzazione;a.permesso=this.cbaConfig.permesso;a.controllerDepositi=this;this.getCmcMagazzino().up("container").setVisible(57==CBA.moduli.moduloAttivo);this.getCmcFarmacia().up("container").setVisible(57==CBA.moduli.moduloAttivo);this.getCntBox().setVisible(!1);this.gestioneForm();this.getCBNazione().getStore().load();
this.getCBComune().getStore().load();this.aggiornaStore();this.getPnlLuoCons().add(Ext.create("GeneraliEC.depositi.view.LuoghiCons",{cbaConfig:a}))},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.depositi.controller.LuoghiCons",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridLuoCons",selector:this.selContainer+"#GridLuoCons"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"BtnCdaCons",selector:this.selContainer+"#BtnCdaCons"}]);this.control(this.selContainer+"#GridLuoCons",{beforeedit:this.beforeeditGridLuoCons,
edit:this.editGridLuoCons,canceledit:this.canceleditGridLuoCons,validateedit:this.validateeditGridLuoCons});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#BtnCdaCons",{click:this.clickBtnCdaCons})},clickBtnCdaCons:function(a){Ext.create("winCBA",{name:"GeneraliEC.associaCdcDepositi.view.AlberoCdcDepositi",titolo:"ASSOCIA_CDC",dimensione:1,configItem:{idDeposito:this.idTestata,
idOrganizzazione:this.cbaConfig.idOrganizzazione,onlyTree:!0},closable:!0}).show()},clickBtnNuovo:function(a){controller_nuovoRecordGrid({},this.getGridLuoCons())},clickBtnElimina:function(a){var b=this;a=b.getGridLuoCons();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},beforeeditGridLuoCons:function(a,b,c){if(!0===a.editing)return!1;f=a.getEditor().getForm();f.findField("comune").bindStore(this.storeComuni);
f.findField("nazione").bindStore(this.storeNazioni);f.findField("desComune")?this.storeComuni.load({params:{valore:f.findField("desComune")}}):(a=b.record,this.storeComuni.load({params:{valore:a.get("desComune")}}));f.findField("desNazione")?this.storeNazioni.load({params:{valore:f.findField("desNazione")}}):(a=b.record,this.storeNazioni.load({params:{valore:a.get("desNazione")}}));this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},
editGridLuoCons:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();delete c.desComune;Ext.apply(c,{idDeposito:this.idTestata});controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridLuoCons:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridLuoCons:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridLuoCons(),
c=b.getStore();c.load({params:{idOrganizzazione:this.cbaConfig.idOrganizzazione,idDeposito:this.idTestata},callback:function(d,e,g){g?(d=null,a&&(d=trovaRecord(c,"id",a)),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d?[d]:0)):msgShowError("",e.getError())}})},svuotaStore:function(){svuotaStore(this.getGridLuoCons().getStore())},onLaunch:function(){this.getGridLuoCons().controller=this;this.storeComuni=Ext.create("Generali.comuni.store.cboxComuniGen",{autoLoad:!1,autoDestroy:!1});
this.storeNazioni=Ext.create("Generali.nazioni.store.cboxNazioniGen",{autoLoad:!1,autoDestroy:!1})},destroy:function(){eliminaStore(this.storeConti);this.callParent()}});
Ext.define("GeneraliEC.depositi.store.CboxLuoghiCons",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],autoDestroy:!0,constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/luoghiConsegna/cbox",type:"ajax",reader:{type:"json",messageProperty:"message",rootProperty:"data"}}},a)])}});
Ext.define("GeneraliEC.depositi.store.Depositi",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"descrizione"},{name:"indirizzo"},{name:"civico"},{name:"nazione"},{name:"comune"},{name:"cap"},{name:"attivo"},{name:"tipoDeposito"},{name:"cda"},{name:"desCda"},{name:"boxFarmaci"},{name:"boxPath"},{name:"boxUser"},{name:"boxPwd"},{name:"boxToken"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/depositi/list",api:{read:getUrlGen()+
"/ws/depositi/list",create:getUrlGen()+"/ws/depositi/insert",update:getUrlGen()+"/ws/depositi/update",destroy:getUrlGen()+"/ws/depositi/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.depositi.store.LuoghiCons",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idDeposito"},{name:"descrizione"},{name:"indirizzo"},{name:"civico"},{name:"comune"},{name:"nazione"},{name:"cap"},{name:"desComune"},{name:"desNazione"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/luoghiConsegna/list",api:{read:getUrlGen()+"/ws/luoghiConsegna/list",create:getUrlGen()+"/ws/luoghiConsegna/insert",update:getUrlGen()+"/ws/luoghiConsegna/update",
destroy:getUrlGen()+"/ws/luoghiConsegna/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.depositi.view.Depositi",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridDepositi",reference:"GridDepositi",width:220,store:Ext.create("GeneraliEC.depositi.store.Depositi"),columns:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"DESCRIZIONE",flex:1}],dockedItems:[],viewConfig:{loadMask:!1,getRowClass:function(a,b){if("F"==a.get("attivo"))return"non_attivi"}}},
{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",itemId:"ContainerTes",reference:"ContainerTes",layout:{type:"hbox"},items:[{xtype:"form",itemId:"Form",reference:"Form",border:0,autoScroll:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"cbaMultipleChoice",itemId:"CntMagazzinoFarmacia",reference:"CntMagazzinoFarmacia",style:{border:"0px!important"},
cbaConfig:{itemsCfg:[{html:traduci("MAGAZZINO"),name:"magazzino",itemId:"CmcMagazzino",reference:"CmcMagazzino",isFormField:!0,inputValue:"M",width:120},{html:traduci("FARMACIA"),name:"farmacia",itemId:"CmcFarmacia",reference:"CmcFarmacia",isFormField:!0,inputValue:"F",width:120}]}},{xtype:"textfield",width:450,fieldLabel:"DESCRIZIONE",itemId:"TxDescrizione",reference:"TxDescrizione",name:"descrizione",labelClsExtra:"cbaLabel",allowBlank:!1,maxLength:100,enforceMaxLength:!0},{xtype:"container",flex:1,
layout:{type:"hbox",align:"stretch"},items:[{xtype:"textfield",width:450,fieldLabel:"INDIRIZZO",itemId:"TxIndirizzo",reference:"TxIndirizzo",name:"indirizzo",labelClsExtra:"cbaLabel",maxLength:200,enforceMaxLength:!0},{xtype:"textfield",labelWidth:60,width:150,fieldLabel:"NUMERO",itemId:"TxNumero",reference:"TxNumero",name:"civico",labelClsExtra:"cbaLabel",maxLength:10,enforceMaxLength:!0,margin:"0 0 0 10"}]},{xtype:"container",flex:1,margin:"5 0 0 0",layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",
itemId:"CBComune",reference:"CBComune",width:450,fieldLabel:"COMUNE",name:"comune",displayField:"valore",queryParam:"valore",valueField:"codice",labelClsExtra:"cbaLabel",minChars:3,store:Ext.create("Generali.comuni.store.cboxComuniGen")},{xtype:"textfield",labelWidth:60,width:150,fieldLabel:"CAP",itemId:"TxCap",reference:"TxCap",name:"cap",labelClsExtra:"cbaLabel",margin:"0 0 0 10"}]},{xtype:"container",flex:1,margin:"5 0 0 0",layout:{type:"hbox",align:"stretch"},items:[{xtype:"combobox",itemId:"CBNazione",
reference:"CBNazione",width:450,fieldLabel:"NAZIONE",name:"nazione",displayField:"valore",queryParam:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",store:Ext.create("Generali.nazioni.store.cboxNazioniGen")},{xtype:"checkbox",itemId:"ChBAttivo",reference:"ChBAttivo",boxLabel:"ATTIVO",name:"attivo",inputValue:"T",uncheckedValue:"F",margin:"0 0 0 10"}]},{xtype:"cda",annoData:"annoCda",labelWidth:100,width:500,margin:"5 0 0 0",hideCodice:!0,showDesCda:!0,hideAnno:!0,itemId:"cntCda",
reference:"cntCda",cbaConfig:{tipoContabilita:4,idOrganizzazione:this.cbaConfig.idOrganizzazione}},{xtype:"textfield",width:450,fieldLabel:"APSS_ID_ARMADIO",itemId:"ApssIdArmadio",reference:"ApssIdArmadio",name:"apssIdArmadio",labelClsExtra:"cbaLabel",maxLength:40,hidden:!0,enforceMaxLength:!0},{xtype:"textfield",width:450,fieldLabel:"APSS_CDC",itemId:"ApssCdc",reference:"ApssCdc",name:"apssCdc",labelClsExtra:"cbaLabel",maxLength:40,hidden:!0,enforceMaxLength:!0},{xtype:"checkbox",itemId:"ChBoxFarmaci",
reference:"ChBoxFarmaci",boxLabel:"BOX_FARMACI_PREVISTO",name:"boxFarmaci",inputValue:"T",uncheckedValue:"F",margin:"0 0 0 0"},{xtype:"container",margin:"5 0 0 0",itemId:"CntBox",reference:"CntBox",layout:{type:"vbox"},items:[{xtype:"textfield",width:450,fieldLabel:"BOX_PATH",name:"boxPath",labelClsExtra:"cbaLabel",maxLength:250,enforceMaxLength:!0},{xtype:"textfield",width:250,fieldLabel:"USERNAME",name:"boxUser",labelClsExtra:"cbaLabel",maxLength:50,enforceMaxLength:!0},{xtype:"textfield",width:250,
fieldLabel:"PASSWORD",name:"boxPwd",labelClsExtra:"cbaLabel",maxLength:50,enforceMaxLength:!0},{xtype:"textfield",width:250,fieldLabel:"TOKEN",name:"boxToken",labelClsExtra:"cbaLabel",maxLength:50,enforceMaxLength:!0}]}]}]},{xtype:"fieldset",flex:1,layout:"fit",itemId:"PnlLuoCons",reference:"PnlLuoCons"}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.depositi.view.LuoghiCons",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",height:200,itemId:"GridLuoCons",reference:"GridLuoCons",title:"LUOGHI_CONSEGNA",store:Ext.create("GeneraliEC.depositi.store.LuoghiCons"),flex:1,columns:[{xtype:"gridcolumn",width:200,align:"left",sortable:!1,text:"DESCRIZIONE",dataIndex:"descrizione",editor:{xtype:"textfield",selectOnFocus:!0,allowBlank:!1,
maxLength:100,enforceMaxLength:!0}},{xtype:"gridcolumn",width:200,align:"left",sortable:!1,text:"INDIRIZZO",dataIndex:"indirizzo",editor:{xtype:"textfield",selectOnFocus:!0,maxLength:200,enforceMaxLength:!0}},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"NUMERO",dataIndex:"civico",renderer:cell_renderer_numero,editor:{xtype:"textfield",selectOnFocus:!0,maxLength:10,enforceMaxLength:!0}},{xtype:"gridcolumn",text:"COMUNE",sortable:!1,flex:1,dataIndex:"comune",editor:{xtype:"combobox",
displayField:"valore",valueField:"codice",queryParam:"valore",minChars:3,selectOnFocus:!0,listeners:{change:function(a,b,c,d){c=a.up("form").getForm().findField("cap");(a=trovaRecord(a.getStore(),"codice",b))&&c.setValue(a.data.extra.split(",")[1])}}},renderer:function(a,b,c,d,e,g,h){return c.get("desComune")}},{xtype:"gridcolumn",width:50,align:"center",sortable:!1,text:"CAP",dataIndex:"cap",renderer:cell_renderer_numero,editor:{xtype:"textfield",selectOnFocus:!0,maxLength:10,enforceMaxLength:!0}},
{xtype:"gridcolumn",text:"NAZIONE",sortable:!1,flex:1,dataIndex:"nazione",editor:{xtype:"combobox",displayField:"valore",valueField:"codice",queryParam:"valore",minChars:3},renderer:function(a,b,c,d,e,g,h){return c.get("desNazione")}}],viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo"},
{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina"},{xtype:"button",itemId:"BtnCdaCons",reference:"BtnCdaCons",iconCls:"icon-elabora",text:"CENTRI_DI_CONSUMO"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.gestCatArt.controller.GestCatArt",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CBEsercizio",selector:this.selContainer+"#CBEsercizio"},{ref:"MCMagFar",selector:this.selContainer+"#MCMagFar"},{ref:"GridDettaglio",selector:this.selContainer+"#GridDettaglio"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"BtnCerca",selector:this.selContainer+"#BtnCerca"},{ref:"TipoOperazione",
selector:this.selContainer+"#TipoOperazione"},{ref:"CmcMagazzino",selector:this.selContainer+"#CmcMagazzino"},{ref:"CmcFarmacia",selector:this.selContainer+"#CmcFarmacia"}]);this.control(this.selContainer+"#CBEsercizio",{change:this.cambioCBEsercizio});this.control(this.selContainer+"#MCMagFar",{change:this.cambioMCMagFar});this.control(this.selContainer+"#GridDettaglio",{selectionchange:this.cambioSelezione});this.control(this.selContainer+"#BtnElabora",{click:this.elabora});this.control(this.selContainer+
"#BtnCerca",{click:this.effettuaRicerca});this.control(this.selContainer+"#TipoOperazione",{change:this.changeOperazione})},changeOperazione:function(a,b,c){this.getCBEsercizio().setVisible("D"==b.tipoOperazione);svuotaStore(this.getGridDettaglio().getStore())},effettuaRicerca:function(a,b,c){a=this.getTipoOperazione().getValue().tipoOperazione;sceltaAttivo="D"==a?"T":"";tipoArticolo=this.getMCMagFar().getValue().tipoMagFar;grid=this.getGridDettaglio();store=grid.getStore();b={idOrganizzazione:this.idOrganizzazione,
limit:0};""!=sceltaAttivo&&Ext.apply(b,{attivo:sceltaAttivo});""!=tipoArticolo&&Ext.apply(b,{tipoArticolo:tipoArticolo});Ext.apply(b,{tipoOperazione:a.tipoOperazione,idEsercizio:this.getCBEsercizio().getValue()});store.getProxy().extraParams=b;this.loadGrid()},elabora:function(a,b,c){var d=this;a=d.getTipoOperazione().getValue();var e="D"==a.tipoOperazione?"/ws/catalogoDet/disattivaArticoli":"/ws/catalogo/eliminaArticoli";Messaggio("ATTENZIONE",traduci("D"==a.tipoOperazione?"MSG_GESTCATART":"MSG_GESTCATART_ELIMINA"),
"YESNOCANCEL","QUESTION",!1,function(){var a=d.getGridDettaglio().getSelectionModel(),b="";if(!Ext.isEmpty(a.getSelection())){for(var b=[],a=$jscomp.makeIterator(a.getSelection()),c=a.next();!c.done;c=a.next())b.push(c.value.get("id"));b=b.toString()}Ext.Ajax.request({method:"POST",url:getUrlGen()+e,params:{elencoId:b},timeout:36E5,success:function(a){a=Ext.JSON.decode(a.responseText);a.success=!0;msgShow("",a.message);d.effettuaRicerca()}})})},cambioSelezione:function(a,b,c){this.getBtnElabora().setDisabled(Ext.isEmpty(b))},
cambioCBEsercizio:function(a,b,c,d){},cambioMCMagFar:function(a,b,c,d){},loadGrid:function(a,b,c){var d=this.getGridDettaglio().getStore();newIdElab();var e=d.getProxy().extraParams;if(!Ext.isEmpty(a)){var g={};Ext.apply(e,(g[a]=b,g))}svuotaStore(d);d.load({callback:function(a,b,d){d?c&&c():msgShowError("",b.getError())}})},cambioCBEsercizio:function(a,b,c,d){},onLaunch:function(){var a=this,b=a.getCBEsercizio().getStore();a.idOrganizzazione=getIdOrg();a.magFarOrd="O";switch(CBA.moduli.moduloAttivo){case 58:a.magFarOrd=
"M";break;case 62:a.magFarOrd="F"}"M"===a.magFarOrd&&a.getCmcMagazzino().setValue(!0);"F"===a.magFarOrd&&a.getCmcFarmacia().setValue(!0);"O"===a.magFarOrd&&(a.getCmcMagazzino().setValue(!1),a.getCmcFarmacia().setValue(!1));a.getMCMagFar().setVisible("O"==a.magFarOrd);b.load({params:{idOrganizzazione:a.idOrganizzazione},callback:function(c,d,e){e?(b.remove(b.getAt(0)),setValue(a.getCBEsercizio(),b.getAt(0))):msgShowError("",d.getError())}})},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.gestCatArt.view.GestCatArt",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"PnlPrincipale",reference:"PnlPrincipale",bodyPadding:5,layout:{type:"vbox",align:"stretch"},border:0,flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},nonDisabilitare:!0,items:[{xtype:"radiogroup",itemId:"TipoOperazione",reference:"TipoOperazione",maxWidth:495,columns:2,items:[{boxLabel:"DISATTIVA",name:"tipoOperazione",
inputValue:"D",cls:"cbaLabel",checked:!0},{boxLabel:"ELIMINA",name:"tipoOperazione",inputValue:"E",cls:"cbaLabel"}]},{xtype:"combobox",itemId:"CBEsercizio",reference:"CBEsercizio",store:Ext.create("Generali.esercizioCont.store.cboxEsercizioCont",{autoLoad:!1}),labelClsExtra:"cbaLabel",labelAlign:"top",fieldLabel:"Movimentati fino all'esercizio",displayField:"valore",valueField:"codice",queryMode:"local",maxWidth:495,labelWidth:200,padding:"0 5 0 5",minChars:0},{xtype:"container",layout:"column",items:[{xtype:"cbaMultipleChoice",
layout:"column",itemId:"MCMagFar",reference:"MCMagFar",style:{border:"0px!important","border-radius":"25px",padding:"0px 5px 0px 0px"},cbaConfig:{esclusivo:!0,itemsCfg:[{html:traduci("MAGAZZINO"),style:"text-align: center",name:"tipoMagFar",itemId:"CmcMagazzino",reference:"CmcMagazzino",inputValue:"M",width:125},{html:traduci("FARMACIA"),style:"text-align: center",name:"tipoMagFar",itemId:"CmcFarmacia",reference:"CmcFarmacia",inputValue:"F",width:125}]},listeners:{afterrender:function(a,b){var c=
a.query("checkbox");a.values={};for(var d=function(a){return Ext.isEmpty(a.inputValue,!1)||"boolean"===typeof a.inputValue?a.getValue():a.inputValue},e=$jscomp.makeIterator(c),g=e.next();!g.done;g=e.next()){g=g.value;if(a.cbaConfig.esclusivo?g.getValue():1){var h={};Ext.apply(a.values,(h[g.name]=d(g),h))}g.onAfter("change",function(b,e,g,h){e={};b=a.values;g=$jscomp.makeIterator(c);for(h=g.next();!h.done;h=g.next())if(h=h.value,a.cbaConfig.esclusivo?h.getValue():1){var k={};Ext.apply(e,(k[h.name]=
d(h),k))}a.values=e;a.fireEvent("change",a,e,b)})}Ext.apply(a,{getValue:function(){return this.values}})}}},{xtype:"container",margin:5,items:[{xtype:"button",itemId:"BtnCerca",reference:"BtnCerca",iconCls:"icon-ricerca",scale:"medium",text:"CERCA",style:"background-color: #fff; border: 5px",width:85}]}]}]},{xtype:"container",itemId:"CntDettaglio",reference:"CntDettaglio",flex:1,layout:"fit",items:[{xtype:"CBAShortcutGrid",itemId:"GridDettaglio",reference:"GridDettaglio",title:traduci("SELEZIONE"),
leadingBufferZone:50,trailingBufferZone:50,store:Ext.create("GeneraliEC.catalogoArticoli.store.RicercaCatalogoArticoliMovimentati",{proxy:{url:getUrlGen()+"/ws/catalogo/listaMovimentati",timeout:36E5},autoLoad:!1}),selModel:Ext.create("Ext.selection.CheckboxModel",{checkOnly:!0}),layout:{align:"stretch"},border:5,viewConfig:{loadMask:!1,trackOver:!1},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",width:void 0,flex:1,minWidth:150,maxWidth:350,minChars:3,cbaConfig:{campi:["descrizione",
"desUdm","desUdmSomministra","desGruppo","desCategoria"],noIcon:!0,filtroPersonalizzato:function(a,b,c){var d=b.getSelectionModel().getSelection();Ext.suspendLayouts();c.clearFilter();Ext.isEmpty(a.getValue(),!1)||Ext.isEmpty(a.getValue().trim(),!1)||c.filter(function(b){for(var e=!1,h=$jscomp.makeIterator(a.cbaConfig.campi),k=h.next();!k.done&&!(e=(e=b.get(k.value))&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase()));k=h.next());if(!e)if(d.length!==c.getTotalCount())for(h=$jscomp.makeIterator(d),
k=h.next();!k.done&&!(e=k.value,e=b.getId()===e.getId());k=h.next());else e=!0;return e});Ext.resumeLayouts(!0)}},listeners:{afterrender:function(a,b){for(var c=[],d={},e=$jscomp.makeIterator(this.cbaConfig.campi),g=e.next();!g.done;d={c:d.c},g=e.next())d.c=g.value,c.push(this.grid.columns.find(function(a){return function(b){return b.dataIndex===a.c}}(d)));if(!Ext.isEmpty(c))for(d={},c=$jscomp.makeIterator(c),e=c.next();!e.done;d={rendererFn:d.rendererFn},e=c.next())if(e=e.value)d.rendererFn=e.renderer,
e.renderer=function(b){return function(c,d,e,g,h,r,t){Ext.suspendLayouts();b.rendererFn&&b.rendererFn(c,d,e,g,h,r,t);if(r.isFiltered()&&Ext.isDefined(c)&&null!=c){d="";e=new RegExp(a.getValue(),"gi");if(g=c.match(e))for(g=$jscomp.makeIterator(g),h=g.next();!h.done;h=g.next())Ext.isEmpty(h.value,!1)||(d=c.replace(e,function(a){var b=a;Ext.isEmpty(a,!1)||(b='<span \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t \t\tstyle="padding: 2px 1px; text-align: center; font-weight: bold; background-color: #f8db5f;"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   >'+
a+"</span>");return b}));Ext.isEmpty(d,!1)||(c=d)}Ext.resumeLayouts(!0);return c}}(d)}}},{xtype:"tbfill"},{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-elabora",scale:"medium",disabled:!0,text:"ELABORA"}]}],columns:{defaults:{variableRowHeight:!0},items:[{xtype:"gridcolumn",text:"ARTICOLO",flex:4,dataIndex:"descrizione"},{xtype:"gridcolumn",text:"UNIMIS_PRINCIPALE",flex:1,dataIndex:"desUdm"},{xtype:"gridcolumn",text:"UNIMIS_SOMMINISTRA",flex:1,dataIndex:"desUdmSomministra"},
{xtype:"gridcolumn",text:"GRUPPO",flex:2,dataIndex:"desGruppo"},{xtype:"gridcolumn",text:"CATEGORIA",flex:2,dataIndex:"desCategoria"}]}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.gruppiAtc.controller.AlberoGrpAtc",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TreeRep",selector:a+"#TreeRep"},{ref:"BtnNuovo",selector:a+"#BtnNuovo"},{ref:"BtnElimina",selector:a+"#BtnElimina"},{ref:"BtnConferma",selector:a+"#BtnConferma"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"TxtCerca",selector:a+"#TxtCerca"},{ref:"LblSelettore",selector:a+"#LblSelettore"}]);this.control(a+"#TreeRep",
{beforeitemcontextmenu:this.beforeitemcontextmenuTreeRep,beforeedit:this.beforeeditTreeRep,edit:this.editTreeRep,canceledit:this.canceleditTreeRep,validateedit:this.validateeditTreeRep,select:this.selectTreeRep,itemdblclick:this.itemdblclickTreeRep});this.control(a+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(a+"#BtnElimina",{click:this.clickBtnElimina});this.control(a+"#BtnConferma",{click:this.clickBtnConferma});this.control(a+"#BtnEsci",{click:this.clickBtnEsci});this.control(a+"#TxtCerca",
{change:Ext.Function.createBuffered(this.cercaTree,500,this)})},cercaTree:function(a){var b=this.getTreeRep(),c=b.getStore(),d=[];this.getLblSelettore().setVisible(!1);c.clearFilter();Ext.isEmpty(a.getValue())?(c.each(function(a){a.set("cls","")}),b.getSelectionModel().hasSelection()?b.ensureVisible(b.getSelectionModel().getSelection()[0]):b.getSelectionModel().select(0)):(c.each(function(b){if(b.isLeaf()){var c=!1,e=b.get("text");e&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase())&&(c=!0);
c?(b.set("cls","cba-dirty-record"),d.push(b)):b.set("cls","")}}),this.filtraPadri(c,d),this.getLblSelettore().setVisible(1<d.length),Ext.isEmpty(d)?b.getSelectionModel().select(0):(b.ensureVisible(d[0]),this.getLblSelettore().setText(traduci("NUM_ELEMENTI_TROVATI",[d.length]))));a.focus()},filtraPadri:function(a,b){a.filter(function(a){for(var c=!1,e=0,g=b.length;e<g;e++)if(a.contains(b[e])){c=!0;break}else if(a.isLeaf()&&(c=a===b[e]))break;return c})},itemdblclickTreeRep:function(a,b,c,d,e,g){b.get("leaf")&&
(1==this.cbaConfig.soloIntermedi?"I"==b.get("tipoCda")?this.selezionaEsci():msgShowError("","MSG_INTERMEDI"):this.selezionaEsci())},selezionaEsci:function(){var a=this.getBtnConferma();if(a.isVisible()){if(this.cbaConfig.afterConferma){var b=[];Ext.each(this.getTreeRep().getSelectionModel().getSelection(),function(a){a.get("leaf")&&b.push(a)});Ext.isEmpty(b)||this.cbaConfig.afterConferma(b)}a.up("window").close()}},clickBtnConferma:function(a){this.selezionaEsci()},clickBtnEsci:function(a){a.up("window").close()},
selectTreeRep:function(a,b){this.getBtnElimina().setDisabled(0===b.get("id")||"L"==this.cbaConfig.permesso);this.cbaConfig.multiSelezione||this.getBtnConferma().setDisabled(0===b.get("id")||!b.get("leaf"));if(!this.cbaConfig.onlyTree){var c=this.getTreeRep().up("#CntPrincipale").down("#FormGrpAtc").controller;c.idTestata=b.get("id");c.getFormGrpAtc().setDisabled(0==b.get("id"));c.hasChild=b.hasChildNodes();0!=b.get("id")?c.aggiornaStore():clearForm(c.getFormGrpAtc())}},beforeeditTreeRep:function(a,
b,c){if(!0===a.editing||0===b.record.get("id"))return!1;this.abilitaBottoniGrid(!1)},editTreeRep:function(a,b,c){var d=b.record.getData();c=a.getEditor().getForm();c.controller=this;c.store=this.getTreeRep().getStore();d={id:d.id?d.id:null,idOrganizzazione:getIdOrg(),idPadre:d.idPadre,descrizione:d.text};controller_salvaRecord(c,d,!1,!1)?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditTreeRep:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditTreeRep:function(a,
b,c){return msgShow("",[])},beforeitemcontextmenuTreeRep:function(a,b,c,d,e,g){return getPopupMenuTree(e,a)},aggiornaStore:function(a){var b=this.getTreeRep();b.getStore().load({params:{idOrganizzazione:this.cbaConfig.idOrganizzazione},callback:function(c,d,e){e?(c=b.getRootNode().findChild("id",a,!0),b.expandAll(),c?(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0),b.getSelectionModel().select([c])):(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0))):msgShowError("",
d.getError())}})},clickBtnNuovo:function(){var a=this.getTreeRep();a.getStore();var b=a.getSelectionModel().getLastSelected();b.set("leaf",!1);b.appendChild({leaf:!0,idPadre:b.get("id")});a.getView().refresh();b.expand();a.getPlugin().startEdit(b.lastChild,0);a.up("#CntPrincipale").down("#FormGrpAtc").controller.getFsTipoCda().setDisabled(!1);this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},clickBtnElimina:function(){var a=
this,b=a.getTreeRep(),c=b.getSelectionModel().getSelection()[0],d=c.hasChildNodes()?"MSG_ELIMINA_NODO":"";controller_eliminaRecord(b.getStore(),{id:c?c.get("id"):""},function(){a.aggiornaStore()},!1,d)},onLaunch:function(){var a=this.getTreeRep();this.cbaConfig.idOrganizzazione||(this.cbaConfig.idOrganizzazione=getIdOrg());a.controller=this;this.cbaConfig.onlyTree&&(this.getBtnConferma().setVisible(!0),this.getBtnEsci().setVisible(!0));this.cbaConfig.multiSelezione&&(a.selModel.selectionMode="MULTI");
this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.gruppiAtc.controller.GestGrpAtc",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"FormGrpAtc",selector:this.selContainer+"#FormGrpAtc"},{ref:"IdForm",selector:this.selContainer+"#IdForm"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"}])},verificaCampiForm:function(){var a=[];this.getFormGrpAtc().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},
salvaForm:function(a){var b=this.getFormGrpAtc(),c=b.getForm().getFieldValues();-9999==this.getIdForm().getValue()&&(c.idPadre=this.idTestata);Ext.apply(c,{idOrganizzazione:getIdOrg()});this.recordModificato=!0;controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getFormGrpAtc();b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.storeGrpTer;b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.recordModificato=!0;a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);b.setDisabled(!1)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.recordModificato=!0;a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});inserisciBottoni(b.boxBottoni,c);b.boxBottoni.queryById("btnEsci").hide();
if("L"!=b.permesso)b.getForm().on("dirtychange",function(a,c){controller_abilitaBottoni(b)});"L"==b.permesso&&containerSolaLettura(a.getContainer())},aggiornaStore:function(a){var b=this,c=b.storeGrpTer,d=b.getFormGrpAtc();d.getForm();b.recordModificato?(b.recordModificato=!1,b.cbaConfig.controllerAlbero.aggiornaStore(a)):c.load({params:{id:b.idTestata},callback:function(a,c,h){h?(clearForm(d),a&&b.getFormGrpAtc().loadRecord(a[0])):msgShowError("",c.getError())}})},onLaunch:function(){this.cbaConfig.idOrganizzazione||
(this.cbaConfig.idOrganizzazione=getIdOrg());this.storeGrpTer=Ext.create("GeneraliEC.gruppiAtc.store.GestGrpAtc");this.gestioneForm()},destroy:function(){eliminaStore(this.storeGrpTer);eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.gruppiAtc.controller.PnlGestGrpAtc",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"}])},onLaunch:function(){this.cbaConfig.idOrganizzazione||(this.cbaConfig.idOrganizzazione=getIdOrg());var a=Ext.create("GeneraliEC.gruppiAtc.view.AlberoGrpAtc",{cbaConfig:{idOrganizzazione:this.cbaConfig.idOrganizzazione,permesso:this.cbaConfig.permesso,
idAnno:this.cbaConfig.idAnno,onlyTree:!1,multiSelezione:this.cbaConfig.multiSelezione,currentCda:this.cbaConfig.currentCda,controllerPadre:this,afterConferma:this.cbaConfig.afterConferma?this.cbaConfig.afterConferma:!1,idAnnoVideata:this.cbaConfig.idAnnoVideata}});this.getCntPrincipale().add({xtype:"panel",layout:"fit",flex:1,items:a});a.cbaConfig.onlyTree||this.getCntPrincipale().add({xtype:"panel",layout:"fit",flex:1,items:Ext.create("GeneraliEC.gruppiAtc.view.GestGrpAtc",{cbaConfig:{permesso:this.cbaConfig.permesso,
controllerAlbero:a.down("#TreeRep").controller}})})}});Ext.define("GeneraliEC.gruppiAtc.model.AlberoGrpAtc",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"idPadre"},{name:"idVisibile"},{name:"descrizione"},{name:"children"},{name:"text",convert:function(a,b){return b.get("idVisibile")?b.get("idVisibile")+" . "+b.get("descrizione"):b.get("descrizione")}},{name:"expanded"},{name:"leaf"},{name:"iconCls"}]});
Ext.define("GeneraliEC.gruppiAtc.store.AlberoGrpAtc",{extend:"Ext.data.TreeStore",model:"GeneraliEC.gruppiAtc.model.AlberoGrpAtc",autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:getUrlGen()+"/ws/gruppiATC/tree",reader:{type:"json",messageProperty:"message",rootProperty:"children"},api:{create:getUrlGen()+"/ws/gruppiATC/insert",update:getUrlGen()+"/ws/gruppiATC/update",destroy:getUrlGen()+"/ws/gruppiATC/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.gruppiAtc.store.GestGrpAtc",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"descrizione"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/gruppiATC/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/gruppiATC/get",create:getUrlGen()+"/ws/gruppiATC/insert",update:getUrlGen()+"/ws/gruppiATC/update",destroy:getUrlGen()+"/ws/gruppiATC/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.gruppiAtc.view.AlberoGrpAtc",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"treepanel",flex:1,width:300,border:0,viewConfig:{loadMask:!1,getRowClass:function(a,b,c,d){return a.get("cls")}},itemId:"TreeRep",reference:"TreeRep",store:Ext.create("GeneraliEC.gruppiAtc.store.AlberoGrpAtc"),useArrows:!0,rootVisible:!1,columns:[{xtype:"treecolumn",dataIndex:"text",text:"GRUPPI_ATC",autoScroll:!0,
flex:1,editor:{xtype:"textfield",allowBlank:!1}}],dockedItems:[{xtype:"toolbar",dock:"top",padding:"5 10 5 10",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo",hidden:!0},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina",hidden:!0},{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:"SELEZIONA_ESCI",hidden:!0},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",
iconCls:"icon-esciGriglia",text:"ESCI",hidden:!0},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",emptyText:"CERCA",width:300}]},{xtype:"label",border:0,dock:"top",hidden:!0,itemId:"LblSelettore",reference:"LblSelettore"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.gruppiAtc.view.GestGrpAtc",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"form",flex:1,itemId:"FormGrpAtc",reference:"FormGrpAtc",autoScroll:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",name:"idOrganizzazione",hidden:!0},{xtype:"textfield",name:"idPadre",hidden:!0},{xtype:"container",items:[{xtype:"textfield",
fieldLabel:"NUM_ATC",name:"id",width:200,allowBlank:!1,readOnly:!0}]},{xtype:"textfield",fieldLabel:"DESCRIZIONE",name:"descrizione",allowBlank:!1,maxLength:50,enforceMaxLength:!0,readOnly:!0}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120,hidden:!0}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.gruppiAtc.view.PnlGestGrpAtc",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntPrincipale",reference:"CntPrincipale",layout:{align:"stretch",type:"hbox"}}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.gruppiCategorie.controller.AggiornaArticoli",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"BtnConferma",selector:this.selContainer+"#BtnConferma"},{ref:"ChbSoloNonAssociati",selector:this.selContainer+"#ChbSoloNonAssociati"},{ref:"EdtData",selector:this.selContainer+"#EdtData"}]);this.control(this.selContainer+"#BtnEsci",
{click:this.esciClick});this.control(this.selContainer+"#BtnConferma",{click:this.conferma})},conferma:function(){if(this.getEdtData().getValue()<this.dataInizioEsercizio||this.getEdtData().getValue()>this.dataFineEsercizio)return Messaggio("Aggiorna Articoli","La data proposta non è all'interno del periodo dell'esercizio","OK","INFORMATION"),!1;this.cbaConfig.afterConferma&&this.cbaConfig.afterConferma(this.getChbSoloNonAssociati().getValue(),this.getEdtData().getValue());this.getBtnEsci().up("window").close()},
esciClick:function(){this.cbaConfig.afterConferma&&this.cbaConfig.afterConferma(null,null);this.getBtnEsci().up("window").close()},onLaunch:function(){var a=this;a.getEdtData().setValue(new Date);getIdEsercizioDefaultByIdOrg(getIdOrg(),function(b){Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/general/esercizioCont/get",params:{id:b},success:function(b){b=Ext.JSON.decode(b.responseText);b.success&&(a.dtInizio=b.data.dataInizioPeriodo,a.dtFine=b.data.dataFinePeriodo,a.dataInizioEsercizio=Ext.Date.parse(b.data.dataInizioPeriodo,
"Y-m-d H:i:s"),a.dataFineEsercizio=Ext.Date.parse(b.data.dataFinePeriodo,"Y-m-d H:i:s"))}})})},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.gruppiCategorie.controller.Categoria",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"FormCategoria",selector:this.selContainer+"#FormCategoria"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CBContoCategoria",selector:this.selContainer+"#CBContoCategoria"},{ref:"CodiceGruppo",selector:this.selContainer+"#CodiceGruppo"},{ref:"DescrizioneCategoria",selector:this.selContainer+
"#DescrizioneCategoria"},{ref:"ChbDeteriorabile",selector:this.selContainer+"#ChbDeteriorabile"}])},verificaCampiForm:function(){var a=[];this.getFormCategoria().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},aggiornaArticoli:function(a,b){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/categorie/aggiornaArticoli",params:{idCat:this.datiLocale.id,idGruppo:this.datiLocale.idGruppo,idConto:this.datiLocale.idConto,data:b,soloNonAssociati:getBoolValue(a)},success:function(a){a=
Ext.JSON.decode(a.responseText);var b=[];a.success?msgAdd(b,a.message):msgAddError(b,a.message);msgShow("",b)}})},salvaForm:function(a){var b=this,c=b.getFormCategoria(),d=c.getForm().getFieldValues();b.datiLocale=d;d.idConto&&b.lastIdConto!=d.idConto&&Messaggio("Aggiorna Articoli","Aggiornare gli articolo collegati?","YESNOCANCEL","QUESTION","",function(){Ext.create("winCBA",{name:"GeneraliEC.gruppiCategorie.view.AggiornaArticoli",titolo:"AGGIORNA_ARTICOLI",dimensione:3,altezzaWin:200,larghezzaWin:500,
configItem:{afterConferma:function(a,c){b.aggiornaArticoli(a,c)}},closable:!0}).show()},function(){});b.recordModificato=!0;Ext.apply(d,{deteriorabile:getBoolValue(d.deteriorabile)});controller_salvaRecord(c,d,a,{forzaRegistrazione:"F"})&&a&&b.callbackEsci&&b.callbackEsci()},gestioneForm:function(){var a=this,b=a.getFormCategoria();b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();b.store=a.storeCategoria;b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(c){store=
a.cbaConfig.controllerTree.getTreeRep().getStore();if(a.cbaConfig.nuovoInserimento)var d=trovaRecord(store,"text",a.getDescrizioneCategoria().getValue());d&&d.get("idGruppo")!=a.cbaConfig.codiceGruppo?Messaggio("ATTENZIONE","DATI_STESSA_DESCR","YESNO","QUESTION",!1,function(){a.salvaForm(c)},function(){var c=b.getForm().findField("id").getValue();a.recordModificato=!0;a.aggiornaStore(c)}):a.salvaForm(c)},annulla_callback:function(){var c=b.getForm().findField("id").getValue(),e=b.getForm().findField("idGruppo").getValue();
0<c?a.aggiornaStore():a.cbaConfig.controllerTree.aggiornaStore(null,null,e)},nuovo_callback:function(){controller_nuovoRecord(b);"T"==a.cbaConfig.deteriorabile&&a.getChbDeteriorabile().setValue(!0);"F"==a.cbaConfig.tipo&&a.getChbDeteriorabile().setVisible(!1)},elimina_callback:function(){var c=b.getForm().findField("id").getValue(),e=b.getForm().findField("idGruppo").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.recordModificato=!0;a.cbaConfig.controllerTree.aggiornaStore(null,
null,e)})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});a.cbaConfig.codiceArticolo||(inserisciBottoni(b.boxBottoni,c),b.boxBottoni.queryById("btnEsci").hide(),b.boxBottoni.queryById("btnNuovo").hide());if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);a.cbaConfig.controllerTree.getTreeRep().setDisabled(e)})},aggiornaStore:function(a){var b=this,c=b.storeCategoria,d=b.getFormCategoria().getForm();ImpostaUrl(b.storeCategoria);ImpostaUrl(b.getCBContoCategoria().getStore());
b.cbaConfig.controllerTree.getTreeRep().setDisabled(!1);b.cbaConfig.codiceCategoria||a?c.load({params:{id:b.cbaConfig.codiceCategoria?b.cbaConfig.codiceCategoria:a},callback:function(c,g,h){h?(g=b.cbaConfig.controllerTree,b.cbaConfig.CntPrincipale.down("#CmcMagazzino")&&b.getChbDeteriorabile().setVisible(b.cbaConfig.CntPrincipale.down("#CmcMagazzino").getValue()),Ext.isEmpty(c)||(d.loadRecord(c[0]),b.lastIdConto=c[0].data.idConto),b.recordModificato&&(b.recordModificato=!1,g.aggiornaStore(null,a,
null),delete g.cbaConfig.nuovaCategoria)):msgShowError("",g.getError())}}):(b.cbaConfig.CntPrincipale.removeAll(),b.cbaConfig.controllerTree.aggiornaStore())},onLaunch:function(){var a=this.getCBContoCategoria().getStore();this.idOrganizzazione=this.cbaConfig.idOrganizzazione;this.idEsercizio=this.cbaConfig.anno;this.storeCategoria=Ext.create("GeneraliEC.gruppiCategorie.store.Categoria");this.gestioneForm();a.load({params:{idOrganizzazione:this.idOrganizzazione,idEsercizio:this.idEsercizio}});this.cbaConfig.nuovoInserimento?
(this.getBoxBottoni().queryById("btnNuovo").handler(),this.getCodiceGruppo().setValue(this.cbaConfig.codiceGruppo)):this.aggiornaStore()},destroy:function(){eliminaStore(this.storeCategoria)}});
Ext.define("GeneraliEC.gruppiCategorie.controller.Gruppo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"FormGruppo",selector:this.selContainer+"#FormGruppo"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CBContoGruppo",selector:this.selContainer+"#CBContoGruppo"},{ref:"DescrizioneGruppo",selector:this.selContainer+"#DescrizioneGruppo"},{ref:"CmcMagazzino",selector:this.selContainer+
"#CmcMagazzino"},{ref:"CmcFarmacia",selector:this.selContainer+"#CmcFarmacia"},{ref:"ChbDeteriorabile",selector:this.selContainer+"#ChbDeteriorabile"},{ref:"CntMagazzinoFarmacia",selector:this.selContainer+"#CntMagazzinoFarmacia"}]);this.control(this.selContainer+"#CmcMagazzino",{change:this.changeCmcMagazzino});this.control(this.selContainer+"#CmcFarmacia",{change:this.changeCmcFarmacia})},changeCmcMagazzino:function(){1==this.getCmcMagazzino().getValue()&&this.getCmcFarmacia().setValue(!1)},changeCmcFarmacia:function(){1==
this.getCmcFarmacia().getValue()&&this.getCmcMagazzino().setValue(!1)},verificaCampiForm:function(){var a=[];this.getFormGruppo().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");0==this.getCmcMagazzino().getValue()&&0==this.getCmcFarmacia().getValue()&&msgAddError(a,"SELEZIONARE_MAG_FAR");return msgShow("",a)},aggiornaArticoli:function(a,b){Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/gruppi/aggiornaArticoli",params:{idGruppo:this.datiLocale.id,idConto:this.datiLocale.idConto,data:b,soloNonAssociati:getBoolValue(a)},
success:function(a){a=Ext.JSON.decode(a.responseText);var b=[];a.success?msgAdd(b,a.message):msgAddError(b,a.message);msgShow("",b)}})},salvaForm:function(a){var b=this,c=b.getFormGruppo(),d=c.getForm().getFieldValues(),e;b.datiLocale=d;d.idConto&&b.lastIdConto!=d.idConto&&Messaggio("Aggiorna Articoli","Aggiornare gli articoli collegati?","YESNOCANCEL","QUESTION","",function(){Ext.create("winCBA",{name:"GeneraliEC.gruppiCategorie.view.AggiornaArticoli",titolo:"AGGIORNA_ARTICOLI",dimensione:3,altezzaWin:200,
larghezzaWin:500,configItem:{afterConferma:function(a,c){b.aggiornaArticoli(a,c)}},closable:!0}).show()},function(){});b.recordModificato=!0;1==d.magazzino&&(e="M");1==d.farmacia&&(e="F",Ext.apply(d,{deteriorabile:!1}));delete d.farmacia;delete d.magazzino;Ext.apply(d,{deteriorabile:getBoolValue(d.deteriorabile),idOrganizzazione:b.cbaConfig.idOrganizzazione,tipo:e});controller_salvaRecord(c,d,a,{forzaRegistrazione:"F"})&&a&&b.callbackEsci&&b.callbackEsci()},gestioneForm:function(){var a=this,b=a.getFormGruppo();
b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();b.store=a.storeGruppo;b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);58==CBA.moduli.moduloAttivo&&a.getCmcMagazzino().setValue(!0);62==CBA.moduli.moduloAttivo&&a.getCmcFarmacia().setValue(!0);57==CBA.moduli.moduloAttivo&&(a.getCmcMagazzino().setValue(!1),
a.getCmcFarmacia().setValue(!1))},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.recordModificato=!0;a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});a.cbaConfig.codiceCategoria||(inserisciBottoni(b.boxBottoni,c),b.boxBottoni.queryById("btnEsci").hide(),b.boxBottoni.queryById("btnNuovo").hide());if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);
a.cbaConfig.controllerTree.getTreeRep().setDisabled(e)})},aggiornaStore:function(a){var b=this,c=b.storeGruppo,d=b.getFormGruppo(),e=d.getForm();ImpostaUrl(b.storeGruppo);ImpostaUrl(b.getCBContoGruppo().getStore());b.cbaConfig.codiceCategoria&&containerSolaLettura(d);b.cbaConfig.controllerTree.getTreeRep().setDisabled(!1);b.cbaConfig.codiceGruppo||a?c.load({params:{id:b.cbaConfig.codiceGruppo?b.cbaConfig.codiceGruppo:a},callback:function(c,d,k){k?(Ext.isEmpty(c)||("M"==c[0].get("tipo")?(c[0].set("magazzino",
!0),b.getChbDeteriorabile().setVisible(!0),b.getCntMagazzinoFarmacia().setMargin("0 0 0 50")):(c[0].set("magazzino",!1),b.getChbDeteriorabile().setVisible(!1),b.getChbDeteriorabile().setValue(!1),b.getCntMagazzinoFarmacia().setMargin("0 0 0 140")),"F"==c[0].get("tipo")?c[0].set("farmacia",!0):c[0].set("farmacia",!1),e.loadRecord(c[0]),b.lastIdConto=c[0].data.idConto),b.recordModificato&&(b.recordModificato=!1,b.cbaConfig.controllerTree.aggiornaStore(null,null,a))):msgShowError("",d.getError())}}):
(b.cbaConfig.CntPrincipale.removeAll(),b.cbaConfig.controllerTree.aggiornaStore())},onLaunch:function(){var a=this.getCBContoGruppo().getStore();this.idOrganizzazione=this.cbaConfig.idOrganizzazione;this.idEsercizio=this.cbaConfig.anno;this.storeGruppo=Ext.create("GeneraliEC.gruppiCategorie.store.Gruppo");this.getCmcMagazzino().up("container").setVisible(57==CBA.moduli.moduloAttivo);this.getCmcFarmacia().up("container").setVisible(57==CBA.moduli.moduloAttivo);this.gestioneForm();a.load({params:{idOrganizzazione:this.idOrganizzazione,
idEsercizio:this.idEsercizio}});this.cbaConfig.nuovoInserimento?this.getBoxBottoni().queryById("btnNuovo").handler():this.aggiornaStore()},destroy:function(){eliminaStore(this.storeGruppo)}});
Ext.define("GeneraliEC.gruppiCategorie.controller.PnlGruppoCategoria",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TreeRep",selector:this.selContainer+"#TreeRep"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"},{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"CntFinestra",selector:this.selContainer+"#CntFinestra"},
{ref:"BtnSeleziona",selector:this.selContainer+"#BtnSeleziona"},{ref:"TxtCerca",selector:this.selContainer+"#TxtCerca"},{ref:"LblSelettore",selector:this.selContainer+"#LblSelettore"}]);this.control(this.selContainer+"#TreeRep",{select:this.selectTree,itemdblclick:this.itemdblclickTree,beforeitemcontextmenu:this.beforeitemcontextmenuTree});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnEsci",{click:this.clickBtnEsci});this.control(this.selContainer+
"#BtnSeleziona",{click:this.clickBtnSeleziona});this.control(this.selContainer+"#TxtCerca",{change:Ext.Function.createBuffered(this.filtraTree,500,this)})},filtraTree:function(a){var b=this.getTreeRep(),c=b.getStore(),d=[];this.getLblSelettore().setVisible(!1);c.clearFilter();Ext.isEmpty(a.getValue())?(c.each(function(a){a.set("cls","")}),b.getSelectionModel().select(0)):(c.each(function(b){if(b.isLeaf()){var c=!1,e=b.get("text");e&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase())&&(c=!0);c?
(b.set("cls","cba-dirty-record"),d.push(b)):b.set("cls","")}}),this.filtraPadri(c,d),this.getLblSelettore().setVisible(1<d.length),Ext.isEmpty(d)?b.getSelectionModel().select(0):(b.ensureVisible(d[0]),this.getLblSelettore().setText(traduci("NUM_ELEMENTI_TROVATI",[d.length]))));a.focus()},filtraPadri:function(a,b){a.filter(function(a){for(var c=!1,e=0,g=b.length;e<g;e++)if(a.contains(b[e])){c=!0;break}else if(a.isLeaf()&&(c=a===b[e]))break;return c})},clickBtnSeleziona:function(a){a.up("window").close()},
clickBtnEsci:function(a){a.up("window").close()},clickBtnNuovo:function(){var a=this.getTreeRep().getSelectionModel().getSelection()[0],b=this.getCntPrincipale(),c={};if(this.cbaConfig.nuovoInserimento){if(this.getCntPrincipale().down("#CBContoCategoria"))var d=this.getCntPrincipale().down("#CBContoCategoria").getValue();this.cbaConfig.idCategoria&&delete this.cbaConfig.idCategoria;if(a.get("idCategoria")&&!Ext.isEmpty(d))return msgShowWarning("","CONTI_NON_COLLEGATI"),!1}b.removeAll();Ext.apply(c,
{nuovoInserimento:!0,controllerTree:this,CntPrincipale:b,idOrganizzazione:this.idOrganizzazione,nodeID:a.get("nodeID"),codiceGruppo:a.get("idGruppo"),codiceCategoria:a.get("idCategoria"),anno:this.idEsercizioDefault,deteriorabile:a.get("deteriorabile"),tipo:a.get("tipo")});a&&(Ext.isEmpty(a.get("idGruppo"))?b.add(Ext.create("GeneraliEC.gruppiCategorie.view.Gruppo",{cbaConfig:c})):Ext.isEmpty(a.get("idCategoria"))&&(this.cbaConfig.nuovaCategoria&&this.cbaConfig.caricamentoEsterno&&Ext.apply(c,{nuovaCategoria:this.cbaConfig.nuovaCategoria}),
b.add(Ext.create("GeneraliEC.gruppiCategorie.view.Categoria",{cbaConfig:c}))))},selectTree:function(a,b,c,d){a={};b=b.data;c=this.getCntPrincipale();b.params&&(a=b.params[0]);Ext.apply(a,{nuovoInserimento:this.nuovoRecord,controllerTree:this,CntPrincipale:c,idOrganizzazione:this.idOrganizzazione,permesso:"S",text:b.text,nodeID:b.nodeID,codiceGruppo:b.idGruppo,codiceCategoria:b.idCategoria,anno:this.idEsercizioDefault,permesso:this.cbaConfig.permesso});c.removeAll();Ext.isEmpty(b.idGruppo)&&!Ext.isEmpty(b.idCategoria)?
(this.getBtnNuovo().setText(traduci("NUOVO")),this.getBtnNuovo().setDisabled(!0)):(this.getBtnNuovo().setText(traduci("NUOVO_GRUPPO")),this.getBtnNuovo().setDisabled(!1),Ext.isEmpty(b.idGruppo)||(this.getBtnNuovo().setText(traduci("NUOVA_CATEGORIA")),c.add(Ext.create("GeneraliEC.gruppiCategorie.view.Gruppo",{cbaConfig:a}))),Ext.isEmpty(b.idCategoria)||(this.getBtnNuovo().setDisabled(!0),c.add(Ext.create("GeneraliEC.gruppiCategorie.view.Categoria",{cbaConfig:a}))),"L"==this.cbaConfig.permesso&&this.getBtnNuovo().setDisabled(!0))},
beforeitemcontextmenuTreeView:function(a,b,c,d,e,g){return getPopupMenuTree(e,a)},aggiornaStore:function(a,b,c){var d=this,e={},g=d.getTreeRep(),h=g.getStore();ImpostaUrl(d.getTreeRep().getStore());Ext.apply(e,{idOrganizzazione:d.idOrganizzazione});h.load({params:e,callback:function(e,h,m){if(m){var k;b&&(k=g.getRootNode().findChild("idCategoria",b,!0));c&&(k=g.getRootNode().findChild("idGruppo",c,!0));a&&(k=g.getRootNode().findChild("nodeID",a,!0));g.expandAll();d.cbaConfig.caricamentoEsterno&&d.cbaConfig.idCategoria&&
(k=g.getRootNode().findChild("idCategoria",d.cbaConfig.idCategoria,!0));k?(g.getSelectionModel().select(0),g.getSelectionModel().select([k]),d.cbaConfig.idCategoria&&d.clickBtnNuovo()):g.getSelectionModel().select(0)}else msgShowError("",h.getError())}})},onLaunch:function(){var a=this;a.idOrganizzazione=a.cbaConfig.idOrganizzazione;a.getTreeRep().controller=a;getIdEsercizioDefaultByIdOrg(a.idOrganizzazione,function(b){a.idEsercizioDefault=b});a.getCntFinestra().setVisible(a.cbaConfig.caricamentoEsterno);
a.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.gruppiCategorie.store.Categoria",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idGruppo"},{name:"descrizione"},{name:"idConto"},{name:"descrGruppo"},{name:"desConto"},{name:"deteriorabile"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/categorie/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/categorie/get",create:getUrlGen()+"/ws/categorie/insert",update:getUrlGen()+"/ws/categorie/update",destroy:getUrlGen()+"/ws/categorie/delete"}},
autoDestroy:!0});
Ext.define("GeneraliEC.gruppiCategorie.store.Gruppo",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idConto"},{name:"descrizione"},{name:"conto"},{name:"desConto"},{name:"idOrganizzazione"},{name:"deteriorabile"},{name:"tipo"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/gruppi/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/gruppi/get",create:getUrlGen()+"/ws/gruppi/insert",update:getUrlGen()+"/ws/gruppi/update",destroy:getUrlGen()+"/ws/gruppi/delete"}},
autoDestroy:!0});Ext.define("GeneraliEC.gruppiCategorie.store.PnlGruppoCategoria",{extend:"Ext.data.TreeStore",fields:[{name:"children"},{name:"expanded"},{name:"iconCls"},{name:"idCategoria"},{name:"idGruppo"},{name:"leaf"},{name:"nodeID"},{name:"text"}],autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:getUrlGen()+"/ws/gruppi/tree",reader:{type:"json",messageProperty:"message",rootProperty:"children"}},autoDestroy:!0});
Ext.define("GeneraliEC.gruppiCategorie.view.AggiornaArticoli",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,flex:1,bodyPadding:10,layout:{type:"vbox"},dockedItems:[{xtype:"toolbar",dock:"top",height:48,items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok32",scale:"large",text:"CONTINUA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-annulla32",scale:"large",text:"ANNULLA"}]}],
items:[{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChbSoloNonAssociati",reference:"ChbSoloNonAssociati",fieldLabel:"",boxLabel:"MODIFICA_SOLO_NON_ASSOCIATI",inputValue:"T",uncheckedValue:"F"},{xtype:"datefield",itemId:"EdtData",reference:"EdtData",width:190,fieldLabel:"DATA",labelWidth:60,labelClsExtra:"cbaLabel",allowBlank:!1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.gruppiCategorie.view.Categoria",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"fieldset",title:"GESTIONE_CATEGORIA",flex:1,bodyPadding:10,items:[{xtype:"form",itemId:"FormCategoria",reference:"FormCategoria",trackResetOnLoad:!0,border:0,bodyPadding:10,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},
{xtype:"textfield",itemId:"CodiceGruppo",reference:"CodiceGruppo",fieldLabel:"ID_GRUPPO",name:"idGruppo",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"textfield",labelWidth:150,maxLength:50,flex:1,name:"descrizione",itemId:"DescrizioneCategoria",reference:"DescrizioneCategoria",fieldLabel:"DESCRIZIONE_CATEGORIA",allowBlank:!1,enforceMaxLength:!0,labelClsExtra:"cbaLabel"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChbDeteriorabile",reference:"ChbDeteriorabile",fieldLabel:"",boxLabel:"DETERIORABILE",
inputValue:"T",uncheckedValue:"F",name:"deteriorabile"},{xtype:"combobox",itemId:"CBContoCategoria",reference:"CBContoCategoria",store:Ext.create("Generali.pianodeiconti.store.DesSottoconto"),labelWidth:150,minChars:3,name:"idConto",displayField:"valore",queryMode:"local",valueField:"codice",fieldLabel:"CONTO",labelClsExtra:"cbaLabel"}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.gruppiCategorie.view.Gruppo",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"fieldset",title:"GESTIONE_GRUPPO",flex:1,bodyPadding:10,items:[{xtype:"form",itemId:"FormGruppo",reference:"FormGruppo",trackResetOnLoad:!0,border:0,bodyPadding:10,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"textfield",
labelWidth:150,maxLength:50,flex:1,name:"descrizione",itemId:"DescrizioneGruppo",reference:"DescrizioneGruppo",fieldLabel:"DESCRIZIONE_GRUPPO",allowBlank:!1,enforceMaxLength:!0,labelClsExtra:"cbaLabel"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"checkboxfield",cls:"cbaLabel",itemId:"ChbDeteriorabile",reference:"ChbDeteriorabile",fieldLabel:"",boxLabel:"DETERIORABILE",inputValue:"T",uncheckedValue:"F",name:"deteriorabile",margin:"10 0 0 0"},{xtype:"cbaMultipleChoice",
itemId:"CntMagazzinoFarmacia",reference:"CntMagazzinoFarmacia",style:{border:"0px!important"},margin:"0 0 0 50",cbaConfig:{itemsCfg:[{html:traduci("MAGAZZINO"),name:"magazzino",itemId:"CmcMagazzino",reference:"CmcMagazzino",isFormField:!0,inputValue:"M",width:120},{html:traduci("FARMACIA"),name:"farmacia",itemId:"CmcFarmacia",reference:"CmcFarmacia",isFormField:!0,inputValue:"F",width:120}]}}]},{xtype:"combobox",itemId:"CBContoGruppo",reference:"CBContoGruppo",store:Ext.create("Generali.pianodeiconti.store.DesSottoconto"),
labelWidth:150,minChars:3,name:"idConto",displayField:"valore",queryMode:"local",valueField:"codice",fieldLabel:"CONTO",labelClsExtra:"cbaLabel",margin:"5 0 0 0"}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.gruppiCategorie.view.PnlGruppoCategoria",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"treepanel",itemId:"TreeRep",reference:"TreeRep",width:380,border:0,store:Ext.create("GeneraliEC.gruppiCategorie.store.PnlGruppoCategoria"),rootVisible:!1,useArrows:!0,viewConfig:{loadMask:!1,getRowClass:function(a,b,c,d){return a.get("cls")}},dockedItems:[{xtype:"toolbar",dock:"top",itemId:"CntFinestra",
reference:"CntFinestra",items:[{xtype:"button",itemId:"BtnSeleziona",reference:"BtnSeleziona",iconCls:"icon-ok32",scale:"large",text:"CONFERMA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-annulla32",scale:"large",text:"ANNULLA"}]},{xtype:"toolbar",dock:"top",layout:{type:"hbox",align:"left"},border:0,items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",align:"left",text:"NUOVO"},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",
emptyText:"CERCA",flex:1}]},{xtype:"label",border:0,dock:"top",hidden:!0,itemId:"LblSelettore",reference:"LblSelettore"}]},{xtype:"panel",itemId:"CntPrincipale",reference:"CntPrincipale",flex:1,bodyPadding:10,autoScroll:!0,layout:{align:"stretch",type:"vbox"}}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.importaListini.controller.RicercaImpListini",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Paginatore",selector:this.selContainer+"#Paginatore"},{ref:"BtnAvanti",selector:this.selContainer+"#BtnAvanti"},{ref:"BtnIndietro",selector:this.selContainer+"#BtnIndietro"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"Risultati",selector:this.selContainer+"#Risultati"},
{ref:"EdtData",selector:this.selContainer+"#EdtData"},{ref:"CBDeposito",selector:this.selContainer+"#CBDeposito"},{ref:"CBFornitore",selector:this.selContainer+"#CBFornitore"},{ref:"AllegatoUpload",selector:this.selContainer+"#AllegatoUpload"},{ref:"FormAllegato",selector:this.selContainer+"#FormAllegato"},{ref:"TxtFileName",selector:this.selContainer+"#TxtFileName"}]);this.control(this.selContainer+"#BtnElabora",{click:this.conferma});this.control(this.selContainer+"#Paginatore",{beforetabchange:this.beforetabchangePaginatore,
render:this.rendertabPaginatore});this.control(this.selContainer+"#BtnAvanti",{click:this.avanti});this.control(this.selContainer+"#BtnIndietro",{click:this.indietro});this.control(this.selContainer+"#Paginatore",{tabchange:this.tabchangePaginatore});this.control(this.selContainer+"#AllegatoUpload",{change:this.onFilefieldChangeAllegatoUpload});this.control(this.selContainer+"#CBFornitore",{change:this.changeFornitoreData});this.control(this.selContainer+"#EdtData",{change:this.changeFornitoreData})},
changeFornitoreData:function(){this.getAllegatoUpload().setDisabled(!this.getCBFornitore().getValue()||!this.getEdtData().getValue())},allegatoUpload:function(a,b){var c=this;c.getFormAllegato();var d=b.lastIndexOf("\\")||b.lastIndexOf("/"),e=Ext.Object.toQueryString({dataInizioUtilizzo:c.getEdtData().getValue()});b=b.substring(d+1);if(""!==b){var d=a.fileInputEl.dom.files[0],g=new FormData;g.append("file",d);Ext.Ajax.request({url:"/cba/eco/of/ws/importListini/upload?idCliFor="+c.getCBFornitore().getValue()+
"&"+e+"&idDeposito="+c.getCBDeposito().getValue(),method:"POST",rawData:g,headers:{"Content-Type":null},success:function(a){a=Ext.JSON.decode(a.responseText);if(a.success){var b=c.getRisultati().down("gridpanel").getStore();svuotaStore(b);b.loadData(a.data);msgShow("TRASFERIMENTO_FILE",a.message)}else msgShowError("",a.message)}})}},onFilefieldChangeAllegatoUpload:function(a,b,c){this.allegatoUpload(a,b)},disabilitaClickTab:function(){var a=this.getPaginatore();a.items.each(function(b){if(!Ext.isDefined(b.tab.giaCreato))b.tab.on("click",
function(){b.tab.giaCreato=!0;a.cambiaTab=!1})})},rendertabPaginatore:function(){this.disabilitaClickTab()},beforetabchangePaginatore:function(a,b,c,d){return a.cambiaTab},avanti:function(){this.naviga("next")},indietro:function(){this.naviga("prev")},naviga:function(a){var b=this.getPaginatore(),c=b.getLayout(),d=b.getActiveTab();b.cambiaTab=!0;a?(c[a](),"next"==a&&"ParametriRicerca"==d.itemId?this.getRisultati().down("gridpanel").getSelectionModel().selectAll():this.abilitaPulsanti(!0)):this.abilitaPulsanti(!0);
return!0},abilitaPulsanti:function(a){var b=this.getPaginatore().getActiveTab(),c=this.getBtnIndietro(),d=this.getBtnAvanti(),e=this.getBtnElabora();!1===a?(c.setDisabled(!0),d.setDisabled(!0),e.setDisabled(!0)):(c.setDisabled("ParametriRicerca"==b.itemId),d.setDisabled("Risultati"==b.itemId),e.setDisabled("Risultati"!=b.itemId||!b.down("gridpanel").getSelectionModel().selected.length))},aggiornaSuSelezione:function(a,b){this.abilitaPulsanti(!0)},tabchangePaginatore:function(a,b,c,d){this.abilitaPulsanti(!0)},
effettuaRicerca:function(){},conferma:function(){var a=[],b=this.getRisultati().down("gridpanel").getSelectionModel().getSelection(),c=!1,d={};if(!this.getCBFornitore().isValid()||!this.getEdtData().isValid()||!this.getCBDeposito().isValid())return Messaggio("ATTENZIONE","MSG_CAMPI_OBBLIGATORI","OK","INFORMATION"),this.naviga("prev"),!1;Ext.each(b,function(b){0==b.data.bloccante?null!=b.data.idAliquota?a.push(b.data):c=!0:c=!0});if(1==c)return Messaggio("MSG_ERRORI_TROVATI","PRESENTI_ERRORI_NEL_FILE",
"OK","ERROR"),!1;Ext.apply(d,{idCliFor:this.getCBFornitore().getValue(),dataInizioUtilizzo:this.getEdtData().getValue()});this.getCBDeposito().getValue()&&Ext.apply(d,{idDeposito:this.getCBDeposito().getValue()});Ext.Ajax.request({method:"POST",url:"/cba/eco/of/ws/importListini/storeGrid",jsonData:Ext.JSON.encode(a),writer:{type:"json"},params:d,success:function(a){a=Ext.JSON.decode(a.responseText);var b=[];a.success?msgAdd(b,a.message):msgAddError(b,a.message);msgShow("",b)}})},onLaunch:function(){var a=
this.getCBFornitore().getStore();this.idOrganizzazione=getIdOrg();a.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,attivo:"T",tipo:"F",limit:0};this.getEdtData().validate();this.getCBFornitore().validate();this.getCBDeposito().validate();this.getEdtData().focus(!1,500);a=this.getRisultati();a.add(Ext.create(a.cbaConfig.url,{codVideataPwd:this.cbaConfig.codVideataPwd,controllerRicerca:this})).down("gridpanel").getSelectionModel().on("selectionchange",this.aggiornaSuSelezione,this);
this.getAllegatoUpload().setDisabled(!0);"L"==this.cbaConfig.permesso&&(this.getBtnAvanti().setDisabled(!0),this.getBtnIndietro().setDisabled(!0));a=this.getCBDeposito().getStore();a.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,isInsert:"T"};a.load()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.importaListini.controller.RisultatoImpListini",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"GridRisultato",selector:a.selContainer+"#GridRisultato"},{ref:"LblScelto",selector:a.selContainer+"#LblScelto"},{ref:"TxtCerca",selector:a.selContainer+"#TxtCerca"},{ref:"CBIva",selector:a.selContainer+"#CBIva"}]);a.control(a.selContainer+"#GridRisultato",{selectionchange:a.CambioSelezioneGriglia,
beforeedit:a.beforeeditGridRisultato,edit:a.editGridRisultato,canceledit:a.canceleditGridRisultato});a.control(a.selContainer+"#TxtCerca",{change:Ext.Function.createBuffered(function(b){var c=a.getGridRisultato().getStore();c.clearFilter();c.filter(function(a){var c=!1;(a=a.get("desArticolo"))&&0<=a.toUpperCase().indexOf(b.getValue().toUpperCase())&&(c=!0);return c});b.focus();b.focus()},100,a)})},CambioSelezioneGriglia:function(a,b,c){var d=0;Ext.each(this.getGridRisultato().getSelectionModel().getSelection(),
function(a){d+=1});this.getLblScelto().setText(traduci("SCELTO")+" ("+d+")")},disabilitaBottoneElabora:function(a){this.getGridRisultato().up("#Paginatore").down("#BtnElabora").setDisabled(a)},beforeeditGridRisultato:function(a,b,c){this.disabilitaBottoneElabora(!0);if(!0===a.editing)return!1;f=a.getEditor().getForm();a=function(a){a.getStore().load({callback:function(b,c,d){a.storeCaricato=d}})};b=f.findField("idAliquota");b.storeCaricato||(c={},Ext.apply(c,{attivo:"T"}),b.getStore().getProxy().extraParams=
c,a(b))},editGridRisultato:function(a,b,c){b.record.getData();a=a.getEditor().getForm();a.controller=this;a.store=b.view.getStore();b.record.set("desAliquota",this.getCBIva().rawValue);b.record.set("idAliquota",this.getCBIva().getValue());a.store.commitChanges();delete this.nuovaRiga;this.disabilitaBottoneElabora(!1)},validateeditGridRisultato:function(a,b,c){this.disabilitaBottoneElabora(!1);return msgShow("",[])},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.importaListini.store.RisultatoImpListini",{extend:"Ext.data.Store",fields:[{name:"desGruppo"},{name:"desCategoria"},{name:"desArticolo"},{name:"desAliquota"},{name:"desUdm"},{name:"codArtFornitore"},{name:"errorMessage"},{name:"prezzoNetto"},{name:"idGruppo"},{name:"idCategoria"},{name:"idAliquota"},{name:"idUdm"},{name:"minSan"},{name:"bloccante"}],autoDestroy:!0});
Ext.define("GeneraliEC.importaListini.view.RicercaImpListini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"tabpanel",itemId:"Paginatore",reference:"Paginatore",flex:1,tabBar:{height:48,items:[{xtype:"tbfill"},{xtype:"toolbar",border:0,items:[{xtype:"button",itemId:"BtnIndietro",reference:"BtnIndietro",iconCls:"icon-indietro",scale:"large",tooltip:"INDIETRO",disabled:!0},{xtype:"tbspacer",width:10},{xtype:"button",itemId:"BtnAvanti",reference:"BtnAvanti",
iconCls:"icon-avanti",tooltip:"AVANTI",scale:"large"},{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-elabora32",scale:"large",text:"ELABORA",disabled:!0}]}]},items:[{xtype:"form",itemId:"ParametriRicerca",reference:"ParametriRicerca",bodyPadding:10,border:0,tabConfig:{title:"RICERCA",height:44},fieldDefaults:{margin:"5 5 5 5"},layout:{type:"vbox"},noModificaDati:!0,trackResetOnLoad:!0,items:[{xtype:"fieldset",title:"PARAMETRI",width:this.larghezza,layout:{type:"vbox"},items:[{xtype:"datefield",
itemId:"EdtData",reference:"EdtData",fieldLabel:"INIZIO_UTILIZZO",labelClsExtra:"cbaLabel",allowBlank:!1,labelWidth:80,width:190},{xtype:"combobox",labelWidth:80,width:410,fieldLabel:"FORNITORE",labelClsExtra:"cbaLabel",itemId:"CBFornitore",reference:"CBFornitore",displayField:"valore",queryParam:"descrizione",valueField:"codice",store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor"),allowBlank:!1,minChars:3},{xtype:"combobox",width:410,fieldLabel:"DEPOSITO",labelClsExtra:"cbaLabel",labelWidth:80,
itemId:"CBDeposito",reference:"CBDeposito",displayField:"valore",queryParam:"descrizione",valueField:"codice",minChars:3,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi")},{xtype:"displayfield",itemId:"TxtFileName",reference:"TxtFileName",name:"fileName",labelClsExtra:"cbaLabel",maxLength:100,enforceMaxLength:!0,maxWidth:370,editable:!1},{xtype:"container",itemId:"CntAllegato",reference:"CntAllegato",flex:1,layout:{type:"fit"},items:[{xtype:"form",itemId:"FormAllegato",reference:"FormAllegato",
border:!1,padding:5,bodyPadding:"5 0 0 0",layout:"hbox",items:[{xtype:"filefield",itemId:"AllegatoUpload",reference:"AllegatoUpload",baseCls:"cba-button-25",buttonOnly:!0,name:"fileData",buttonConfig:{xtype:"filebutton",margin:"0 0 1 0",cls:"cba-button-25",alwaysOnTop:!0,itemId:"BtnAllega",reference:"BtnAllega",text:traduci("ALLEGA_FILE"),iconCls:"icon-allegato"},listeners:{afterrender:function(a){a.fileInputEl.set({accept:StdSipcar.getValidExtensions()})}}}]}]}]}]},{xtype:"panel",itemId:"Risultati",
reference:"Risultati",tabConfig:{title:"SELEZIONE",height:44},border:0,layout:{type:"fit"},cbaConfig:{url:"GeneraliEC.importaListini.view.RisultatoImpListini"}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.importaListini.view.RisultatoImpListini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.apply(this,{items:[{xtype:"gridpanel",border:0,itemId:"GridRisultato",reference:"GridRisultato",flex:1,selType:"checkboxmodel",viewConfig:{stripeRows:!0,loadMask:!1},store:Ext.create("GeneraliEC.trasferisciListini.store.RisultatoTrasfListini"),columns:[{xtype:"gridcolumn",dataIndex:"desArticolo",text:"ARTICOLO",width:300},{xtype:"gridcolumn",dataIndex:"desGruppo",
text:"GRUPPO",width:200},{xtype:"gridcolumn",dataIndex:"desCategoria",text:"CATEGORIA",width:200},{xtype:"gridcolumn",dataIndex:"desUdm",text:"UNITA_MISURA",align:"center",width:60},{xtype:"gridcolumn",dataIndex:"codArtFornitore",text:"CODICE_ARTICOLO_FOR",align:"center",renderer:cell_renderer_stringa},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"PREZZO",dataIndex:"prezzoNetto",renderer:cell_renderer_importo,renderer:function(a,b,c,d,e,g,h){b.style="text-align:right !important";return Ext.util.Format.number(a,
"0.00000,")}},{xtype:"gridcolumn",text:"IVA",align:"center",width:90,dataIndex:"idAliquota",editor:{xtype:"combobox",displayField:"valore",allowBlank:!1,queryMode:"local",valueField:"codice",store:Ext.create("Generali.aliquotaiva.store.cboxAliquotaIvaAbbr",{autoLoad:!1}),itemId:"CBIva",reference:"CBIva"},renderer:function(a,b,c){return c.get("desAliquota")}},{xtype:"gridcolumn",dataIndex:"minSan",text:"MINSAN",width:90},{xtype:"gridcolumn",dataIndex:"errorMessage",text:"ERRORE",flex:1}],plugins:[Ext.create("Ext.grid.plugin.RowEditing",
{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",width:200,fieldLabel:"",emptyText:"CERCA"}]},{xtype:"toolbar",dock:"bottom",items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"panel",height:20,width:300,layout:{type:"hbox",pack:"middle"},items:[{xtype:"label",text:"SCELTO",itemId:"LblScelto",reference:"LblScelto",flex:1},{xtype:"label",itemId:"LblSceltoImp",reference:"LblSceltoImp",width:120,style:{"text-align":"right"}}]}]}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliEC.livelloRiordino.controller.ElaboraLivRiordino",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"GridElabora",selector:a.selContainer+"#GridElabora"},{ref:"LblScelto",selector:a.selContainer+"#LblScelto"},{ref:"TxtCerca",selector:a.selContainer+"#TxtCerca"}]);a.control(a.selContainer+"#GridElabora",{selectionchange:a.CambioSelezioneGriglia});a.control(a.selContainer+"#TxtCerca",
{change:Ext.Function.createBuffered(function(b){var c=a.getGridElabora().getStore();c.clearFilter();c.filter(function(a){var c=!1;(a=a.get("desArticolo"))&&0<=a.toUpperCase().indexOf(b.getValue().toUpperCase())&&(c=!0);return c});b.focus();b.focus()},100,a)})},CambioSelezioneGriglia:function(a,b,c){var d=0;Ext.each(this.getGridElabora().getSelectionModel().getSelection(),function(a){d+=1});this.getLblScelto().setText(traduci("SCELTO")+" ("+d+")")},onLaunch:function(){var a=this;a.getGridElabora().menuShortcut=
Ext.create("Ext.menu.Menu",{items:[{text:traduci("ASSOCIA_TUTTE_GIORNI"),handler:function(){var b=a.getGridElabora().getStore(),c=a.getGridElabora().getSelectionModel().getSelection()[0].getData();b.each(function(a){a&&a.set("ggApprovvigionamento",c.ggApprovvigionamento)})}}]})},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.livelloRiordino.controller.RicercaLivRiordino",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Paginatore",selector:this.selContainer+"#Paginatore"},{ref:"BtnAvanti",selector:this.selContainer+"#BtnAvanti"},{ref:"BtnIndietro",selector:this.selContainer+"#BtnIndietro"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"Risultati",selector:this.selContainer+"#Risultati"},
{ref:"EdtDataDal",selector:this.selContainer+"#EdtDataDal"},{ref:"EdtDataAl",selector:this.selContainer+"#EdtDataAl"},{ref:"Elaborazione",selector:this.selContainer+"#Elaborazione"},{ref:"ParametriRicerca",selector:this.selContainer+"#ParametriRicerca"},{ref:"CBFornitore",selector:this.selContainer+"#CBFornitore"},{ref:"CBEsercizio",selector:this.selContainer+"#CBEsercizio"}]);this.control(this.selContainer+"#BtnElabora",{click:this.conferma});this.control(this.selContainer+"#Paginatore",{beforetabchange:this.beforetabchangePaginatore,
render:this.rendertabPaginatore});this.control(this.selContainer+"#BtnAvanti",{click:this.avanti});this.control(this.selContainer+"#BtnIndietro",{click:this.indietro});this.control(this.selContainer+"#Paginatore",{tabchange:this.tabchangePaginatore});this.control(this.selContainer+"#CBEsercizio",{change:this.changeCBEsercizio})},disabilitaClickTab:function(){var a=this.getPaginatore();a.items.each(function(b){if(!Ext.isDefined(b.tab.giaCreato))b.tab.on("click",function(){b.tab.giaCreato=!0;a.cambiaTab=
!1})})},rendertabPaginatore:function(){this.disabilitaClickTab()},beforetabchangePaginatore:function(a,b,c,d){return a.cambiaTab},avanti:function(){this.naviga("next")},indietro:function(){this.naviga("prev")},naviga:function(a){var b=this.getPaginatore(),c=b.getLayout(),d=b.getActiveTab();b.cambiaTab=!0;a?(c[a](),"next"==a&&"ParametriRicerca"==d.itemId?this.effettuaRicerca():"next"==a&&"Risultati"==d.itemId?this.effettuaRicercaElabora():this.abilitaPulsanti(!0)):this.abilitaPulsanti(!0);return!0},
abilitaPulsanti:function(a){var b=this.getPaginatore().getActiveTab(),c=this.getBtnIndietro(),d=this.getBtnAvanti(),e=this.getBtnElabora();!1===a?(c.setDisabled(!0),d.setDisabled(!0),e.setDisabled(!0)):(c.setDisabled("ParametriRicerca"==b.itemId),d.setDisabled("Elaborazione"==b.itemId),e.setDisabled("Elaborazione"!=b.itemId||!b.down("gridpanel").getSelectionModel().selected.length))},aggiornaSuSelezione:function(a,b){this.abilitaPulsanti(!0)},tabchangePaginatore:function(a,b,c,d){this.abilitaPulsanti(!0)},
verificaCampiForm:function(){var a=[];this.getParametriRicerca().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},effettuaRicerca:function(){if(!this.verificaCampiForm())return this.naviga("prev"),!1;var a=this.getPaginatore(),b=this.getRisultati().down("gridpanel").getStore(),c={idFornitore:this.getCBFornitore().getValue(),isAttivo:"T"};b.load({params:c,callback:function(b,c,g){g?Ext.isEmpty(b)&&(Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"),a.setActiveTab(0)):
msgShowError("",c.getError())}})},effettuaRicercaElabora:function(){var a=this.getPaginatore(),b=this.getRisultati().down("gridpanel");b.getStore();b={elencoDepositi:b.getSelectionModel().getSelection().map(function(a){return a.get("id")}).join(","),idFornitore:this.getCBFornitore().getValue()};this.getElaborazione().down("gridpanel").getStore().load({params:b,callback:function(b,d,e){e?Ext.isEmpty(b)&&(Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"),a.setActiveTab(0)):msgShowError("",d.getError())}})},
salvaModificaGiorni:function(a){a=this.getElaborazione().down("gridpanel");var b=a.getStore(),c=[];a=a.getSelectionModel().getSelection();Ext.each(a,function(a){a.dirty&&c.push(a.data)});if(!c)return!1;Ext.Ajax.request({method:"POST",url:"/cba/eco/of/ws/calcoloLivelloRiordino/conferma",jsonData:Ext.JSON.encode(c),writer:{type:"json"},success:function(a){Ext.JSON.decode(a.responseText).success&&b.commitChanges()}})},conferma:function(){var a=this,b=a.getElaborazione().down("gridpanel").getSelectionModel().getSelection().map(function(a){return a.get("idCatalogo")}).join(","),
c=a.getRisultati().down("gridpanel"),d=c.getStore(),e=c.getSelectionModel().getSelection().map(function(a){return a.get("id")}).join(",");if(Ext.isEmpty(e)){var g=[];Ext.each(d.getRange(),function(a){g.push(a.data.id)});e=g.toString()}a.salvaModificaGiorni();Messaggio("ATTENZIONE","CALCOLARE_SELEZIONATI","YESNO","QUESTION","",function(){Ext.Ajax.request({method:"GET",url:"/cba/eco/of/ws/calcoloLivelloRiordino/elabora",writer:{type:"json"},params:{idFornitore:a.getCBFornitore().getValue(),idOrganizzazione:a.cbaConfig.idOrganizzazione,
elencoIdDeposito:e,elencoIdCatalogo:b,idEsercizio:a.getCBEsercizio().getValue(),dataDal:a.getEdtDataDal().getValue(),dataAl:a.getEdtDataAl().getValue()},success:function(a){a=Ext.JSON.decode(a.responseText);var b=[];a.success?msgAdd(b,a.message):msgAddError(b,a.message);msgShow("",b)}})})},changeCBEsercizio:function(a,b,c,d){var e=this;if(!b)return!1;Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/general/esercizioCont/get",params:{id:b},success:function(a){var b=Ext.JSON.decode(a.responseText);b.success&&
(a=Ext.Date.parse(b.data.dataInizioPeriodo,"Y-m-d H:i:s"),b=Ext.Date.parse(b.data.dataFinePeriodo,"Y-m-d H:i:s"),e.getEdtDataDal().setValue(FormattaData(a)),e.getEdtDataAl().setValue(FormattaData(b)))}})},onLaunch:function(){var a=this;a.idOrganizzazione=a.cbaConfig.idOrganizzazione;a.getCBFornitore().validate();var b=a.getRisultati();b.add(Ext.create(b.cbaConfig.url,{codVideataPwd:a.cbaConfig.codVideataPwd,controllerRicerca:a})).down("gridpanel");b=a.getElaborazione();b.add(Ext.create(b.cbaConfig.url,
{codVideataPwd:a.cbaConfig.codVideataPwd,controllerRicerca:a})).down("gridpanel").getSelectionModel().on("selectionchange",a.aggiornaSuSelezione,a);getIdEsercizioDefaultByIdOrg(a.idOrganizzazione,function(b){setCombo(a.getCBEsercizio(),b,null,{idOrganizzazione:a.cbaConfig.idOrganizzazione})});a.getCBFornitore().getStore().getProxy().extraParams={idOrganizzazione:a.cbaConfig.idOrganizzazione,attivo:"T",tipo:"F",limit:0};a.getCBEsercizio().getStore().load({params:{idOrganizzazione:a.idOrganizzazione}})},
destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.livelloRiordino.controller.RisultatoLivRiordino",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"GridRisultato",selector:a.selContainer+"#GridRisultato"},{ref:"LblScelto",selector:a.selContainer+"#LblScelto"},{ref:"TxtCerca",selector:a.selContainer+"#TxtCerca"}]);a.control(a.selContainer+"#GridRisultato",{selectionchange:a.CambioSelezioneGriglia});a.control(a.selContainer+"#TxtCerca",
{change:Ext.Function.createBuffered(function(b){var c=a.getGridRisultato().getStore();c.clearFilter();c.filter(function(a){var c=!1;(a=a.get("descrizione"))&&0<=a.toUpperCase().indexOf(b.getValue().toUpperCase())&&(c=!0);return c});b.focus();b.focus()},100,a)})},CambioSelezioneGriglia:function(a,b,c){Ext.each(this.getGridRisultato().getSelectionModel().getSelection(),function(a){})},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.livelloRiordino.store.ElaboraLivRiordino",{extend:"Generali.data.Store",fields:[{name:"id"},{name:"idCatalogo"},{name:"desArticolo"},{name:"ggApprovvigionamento"},{name:"desCliFor"}],proxy:{type:"ajax",url:"/cba/eco/of/ws/calcoloLivelloRiordino/listArticoli",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/eco/of/ws/calcoloLivelloRiordino/listArticoli"}},autoDestroy:!0});
Ext.define("GeneraliEC.livelloRiordino.store.RisultatoLivRiordino",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"descrizione"}],proxy:{type:"ajax",url:"/cba/eco/of/ws/calcoloLivelloRiordino/listFornitori",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/eco/of/ws/calcoloLivelloRiordino/listFornitori"}},autoDestroy:!0});
Ext.define("GeneraliEC.livelloRiordino.view.ElaboraLivRiordino",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.apply(this,{items:[{xtype:"CBAShortcutGrid",border:0,itemId:"GridElabora",reference:"GridElabora",flex:1,selType:"checkboxmodel",viewConfig:{stripeRows:!0,loadMask:!1},store:Ext.create("GeneraliEC.livelloRiordino.store.ElaboraLivRiordino"),columns:[{xtype:"gridcolumn",dataIndex:"desArticolo",text:"ARTICOLO",flex:1,renderer:function(a,b,c,d,e,g,h){if(c.get("desArticolo"))return c.get("desArticolo")+
this.rendererShortcutColumn()}},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"GIORNI_APPROVIGIONAMENTO",dataIndex:"ggApprovvigionamento",renderer:cell_renderer_numero,editor:{xtype:"numberfield",selectOnFocus:!0}}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,onSpecialKey:function(a,b,c){if(c.getKey()===c.TAB){c.stopEvent();c.position=this.context;if(a)a.onEditorTab(c);b=a.getRefOwner().getSelectionModel();this.completeEdit();return b.onEditorTab(a.editingPlugin,
c)}}})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",width:200,fieldLabel:"",emptyText:"CERCA"}]},{xtype:"toolbar",dock:"bottom",items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"panel",height:20,width:300,layout:{type:"hbox",pack:"middle"},items:[{xtype:"label",text:"SCELTO",itemId:"LblScelto",reference:"LblScelto",flex:1}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.livelloRiordino.view.RicercaLivRiordino",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"tabpanel",itemId:"Paginatore",reference:"Paginatore",flex:1,tabBar:{height:48,items:[{xtype:"tbfill"},{xtype:"toolbar",border:0,items:[{xtype:"button",itemId:"BtnIndietro",reference:"BtnIndietro",iconCls:"icon-indietro",scale:"large",tooltip:"INDIETRO",disabled:!0},{xtype:"tbspacer",width:10},{xtype:"button",itemId:"BtnAvanti",reference:"BtnAvanti",
iconCls:"icon-avanti",tooltip:"AVANTI",scale:"large"},{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-elabora32",scale:"large",text:"ELABORA",disabled:!0}]}]},items:[{xtype:"form",itemId:"ParametriRicerca",reference:"ParametriRicerca",bodyPadding:10,border:0,tabConfig:{title:"RICERCA",height:44},fieldDefaults:{margin:"5 5 5 5"},layout:{type:"vbox"},noModificaDati:!0,trackResetOnLoad:!0,items:[{xtype:"fieldset",title:"PARAMETRI",width:this.larghezza,layout:{type:"vbox"},items:[{xtype:"combobox",
labelWidth:65,width:400,fieldLabel:"FORNITORE",labelClsExtra:"cbaLabel",itemId:"CBFornitore",reference:"CBFornitore",displayField:"valore",queryParam:"descrizione",valueField:"codice",allowBlank:!1,store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor"),minChars:3},{xtype:"fieldset",title:"PERIODO_MEDIO_CONSUMO",layout:{type:"hbox"},items:[{xtype:"combobox",itemId:"CBEsercizio",reference:"CBEsercizio",store:Ext.create("Generali.esercizioCont.store.cboxEsercizioCont",{autoLoad:!1}),labelClsExtra:"cbaLabel",
fieldLabel:"ESERCIZIO",displayField:"valore",valueField:"codice",queryMode:"local",labelWidth:95,minChars:0,allowBlank:!1},{xtype:"datefield",itemId:"EdtDataDal",reference:"EdtDataDal",labelClsExtra:"cbaLabel",fieldLabel:"DATA_DAL",labelWidth:60,maxWidth:170},{xtype:"datefield",itemId:"EdtDataAl",reference:"EdtDataAl",labelClsExtra:"cbaLabel",fieldLabel:"DATA_AL",labelWidth:50,maxWidth:160}]}]}]},{xtype:"panel",itemId:"Risultati",reference:"Risultati",tabConfig:{title:"DEPOSITI",height:44},border:0,
layout:{type:"fit"},cbaConfig:{url:"GeneraliEC.livelloRiordino.view.RisultatoLivRiordino"}},{xtype:"panel",itemId:"Elaborazione",reference:"Elaborazione",tabConfig:{title:"ARTICOLI",height:44},border:0,layout:{type:"fit"},cbaConfig:{url:"GeneraliEC.livelloRiordino.view.ElaboraLivRiordino"}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.livelloRiordino.view.RisultatoLivRiordino",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.apply(this,{items:[{xtype:"gridpanel",border:0,itemId:"GridRisultato",reference:"GridRisultato",flex:1,selModel:Ext.create("Ext.selection.CheckboxModel"),store:Ext.create("GeneraliEC.depositi.store.Depositi",{autoLoad:!1}),columns:[{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"descrizione",flex:1,align:"left"},{xtype:"gridcolumn",text:"TIPO",dataIndex:"tipoDeposito",
flex:1,align:"left",renderer:function(a,b,c){return"M"===a?traduci("MAGAZZINO"):"F"===a?traduci("FARMACIA"):traduci("MAGAZZINO_FARMACIA")}},{xtype:"gridcolumn",text:"INDIRIZZO",dataIndex:"indirizzo",flex:1,align:"left"}],dockedItems:[{xtype:"cercaGrid",maxWidth:300,cbaConfig:{searchField:"descrizione",noIcon:!0}}],viewConfig:{border:0,loadMask:!1,stripeRows:!0,preserveScrollOnRefresh:!0,forceFit:!1,getRowClass:function(a,b){if("F"==a.get("attivo"))return"non_attivi"}}}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.model.StrutturaBaseRichieste",{extend:"Ext.data.Model",fields:[]});
Ext.define("GeneraliEC.nuovaRichiesta.controller.Allegati",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridAllegati",selector:this.selContainer+"#GridAllegati"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CntAnteprima",selector:this.selContainer+"#CntAnteprima"},{ref:"AllegatoUpload",selector:this.selContainer+"#AllegatoUpload"},
{ref:"TxtFileName",selector:this.selContainer+"#TxtFileName"},{ref:"BtnAllega",selector:this.selContainer+"#BtnAllega"},{ref:"Data",selector:this.selContainer+"#Data"}]);this.control(this.selContainer+"#AllegatoUpload",{change:this.onFilefieldChangeAllegatoUpload});this.control(this.selContainer+"#GridAllegati",{select:this.selectGridAllegati})},onFilefieldChangeAllegatoUpload:function(a,b,c){b=this.getCntAnteprima();a=a.button.fileInputEl.dom.files[0];var d;if(a){d=(window.URL||window.webkitURL).createObjectURL(a);
c=a.name;var e=a.name.split(".").pop().toLowerCase(),g="icon-"+e;d="pdf"==e?!(Ext.browser.is.IE||-1<Ext.browser.userAgent.indexOf("Edge"))&&1024<Ext.getBody().getViewSize().width?{itemId:"iframePdf",reference:"iframePdf",html:'<iframe id="pdf" width="100%" height="100%" src="'+d+'"></iframe>'}:creaItemDownload(g,d,c,c):-1!=Ext.Array.indexOf(getEstensioniImg(),e)?{xtype:"container",scrollable:!0,flex:1,items:[{html:'<a href="'+d+'" download="'+c+'" onclick="clickHref(this);">'+traduci("DOWNLOAD")+
" "+c+"</a>"}]}:creaItemDownload(g,d,c,c)}b.removeAll();d&&(this.getTxtFileName().getValue()!=a.name&&(this.getTxtFileName().setValue(a.name),this.getBoxBottoni().queryById("cntBottoni").setBtnEditMode(!0)),b.add(d))},formattaUrlBlob:function(a){return new Promise(function(b,c){Ext.Ajax.request({method:"GET",binary:!0,url:a,success:function(a){var d=a.responseBytes;Ext.isEmpty(d)?c(d.message):(a=new Blob([a.responseBytes],{type:"application/pdf"}),a=(window.URL||window.webkitURL).createObjectURL(a),
b(a))}})})},creaAnteprima:function(a,b){if(!StdEconomato.isValidID(a))return!1;var c=this.getTxtFileName().getValue(),d=getUrlGen()+"/ws/richiesta/allegati/file/download?idAllegato="+a,e=""+getPathServer()+d;b||(b=this.getCntAnteprima());if(!Ext.isEmpty(c)){var g=c.split(".").pop().toLowerCase(),h="icon-"+g,k=function(a){b.removeAll();a&&b.add(a)},l;if("pdf"==g){if(!(Ext.browser.is.IE||-1<Ext.browser.userAgent.indexOf("Edge"))&&1024<Ext.getBody().getViewSize().width){this.formattaUrlBlob(d,g).then(function(a){a&&
(l={itemId:"iframePdf",reference:"iframePdf",html:'<a href="'+d+'" download="'+c+'" onclick="clickHref(this);">'+traduci("DOWNLOAD")+" "+c+'</a>\n\t\t\t\t\t\t\t\t\t<iframe id="pdf" width="100%" height="100%" src="'+a+'"></iframe>'},k(l))})["catch"](function(a){msgShowError("",a.message?a.message:a)});return}l=creaItemDownload(h,e,c,c)}else l=-1!=Ext.Array.indexOf(getEstensioniImg(),g)?{xtype:"container",scrollable:!0,flex:1,items:[{html:'<a href="'+e+'" download="'+c+'" onclick="clickHref(this);">'+
traduci("DOWNLOAD")+" "+c+"</a>"},{xtype:"image",listeners:{beforerender:function(a){setSrcImage(a,d)}}}]}:creaItemDownload(h,e,c,c);k(l)}},selectGridAllegati:function(a,b,c,d){a=this.getForm();clearForm(a);b&&(a.loadRecord(b),this.creaAnteprima(b.get("id"),this.getCntAnteprima()))},aggiornaStore:function(a){var b=this;b.getForm();var c=b.getGridAllegati();b.svuotaStore();b.getCntAnteprima().removeAll();b.pnlContenitore&&b.pnlContenitore.tab.setText(traduci("ALLEGATI"));StdEconomato.isValidID(b.idTestata)&&
b.storeAllegati.load({params:{idRichiesta:b.idTestata},callback:function(d,e,g){if(g)if(Ext.isEmpty(d))b.selectGridAllegati(c,null);else{b.pnlContenitore&&b.pnlContenitore.tab.setText(traduci("ALLEGATI")+" ("+b.storeAllegati.count()+")");var h;a&&(h=trovaRecord(b.storeAllegati,"id",a));c.getSelectionModel().select(h?[h]:0)}else msgShowError("",e.getError())}})},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=
this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{idRichiesta:this.idTestata});delete c.fileData;var d=new FormData,e=JSON.stringify(c),g=this.getAllegatoUpload().button.fileInputEl,e=new Blob([e],{type:"application/json"});d.append("allegato",e);d.append("fileData",g.dom.files[0]);this.controller_salvaRecordAllegato(b,{id:c.id,formData:d},a,{forzaRegistrazione:"F"})&&(a&&this.callbackEsci&&this.callbackEsci(),this.getAllegatoUpload().button.fileInputEl.dom.value=null)},controller_salvaRecordAllegato:function(a,
b,c,d,e,g,h,k){Ext.isEmpty(h)&&(h="id");var l=!1,m=b[h],n="",q=a.store,r=a.boxBottoni,t={};Ext.isEmpty(e)&&(e=!0);var p=trovaRecord(q,h,m,null,!0),u=!p||p&&p.phantom,q=u?q.getProxy().api.create:q.getProxy().api.update;if(null==q)return msgShowError("ATTENZIONE","Errore salvataggio dati: URL non presente"),!1;d&&(n=d);k&&(""==n?n={forceStore:!0}:n.forzaRegistrazione?n.forzaRegistrazione="T":Ext.apply(n,{forceStore:!0}));Ext.Ajax.request({url:q,method:"POST",rawData:b.formData,params:n,async:!1,headers:{"Content-Type":null},
success:function(k){k=Ext.JSON.decode(k.responseText);var q=[],n="";if(k.success)t=k.data,c?(g&&g(k),a.up("window").close()):(u&&k.data&&(m=k.data[h]),a.controller?a.controller.aggiornaStore(m,k):a.aggiornaStore(m)),e&&(k.message&&"$"==k.message[0]?(k.message=k.message.substring(1),msgAddWarning(q,k.message)):(n="MSG_SALVATAGGIO_DATI",msgAdd(q,k.message)));else{if(k.message&&("?"==k.message[0]||k.message[0].testo&&"?"==k.message[0].testo[0])){Messaggio("ATTENZIONE",k.message[0].testo.slice(1),"YESNO",
"QUESTION",!1,function(){controller_salvaRecord(a,b,c,d,e,g,h,!0)});return}k.message&&"$"==k.message[0]?k.message=k.message.substring(1):msgAddError(q,k.message);g&&g(k)}msgShow(n,q);l=k.success},failure:function(a){}});!l&&r&&controller_abilitaBottoni(a);return l?t:!1},gestioneForm:function(){var a=this,b=a.getForm(),c=b.getForm();b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();b.store=a.storeAllegati;b.controller=a;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",{itemId:"cntBottoni",
cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.aggiornaStore()},nuovo_callback:function(){a.getCntAnteprima().removeAll();controller_nuovoRecord(b);a.getData().setValue(dataAttuale())},elimina_callback:function(){var d=c.findField("id").getValue();Ext.isEmpty(d)||controller_eliminaRecord(b.store,{id:d},function(){a.aggiornaStore()})},esci_callback:function(){a.cbaConfig.callbackRitorno&&a.cbaConfig.callbackRitorno();a.getForm().up("window").close()},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});
inserisciBottoni(b.boxBottoni,d);b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(a,c){controller_abilitaBottoni(b)})},svuotaStore:function(){var a=this.getGridAllegati().getStore();a.isLoaded()&&svuotaStore(a)},caricaAllegati:function(a,b){this.contatoreDettagli=0;b&&b.controllerPrincipale&&b.controllerPrincipale.getPnlAllegati()&&(this.pnlContenitore=b.controllerPrincipale.getPnlAllegati());a&&("E"==a.data.stato||"P"==a.data.stato?(containerSolaLettura(this.view,
!0),controller_bottoniSolaLettura(this.getForm().boxBottoni)):(containerSolaLettura(this.view,!1),controller_abilitaBottoni(this.getForm())),this.idTestata=a.id,this.aggiornaStore())},onLaunch:function(){var a=this.getGridAllegati();this.storeAllegati=Ext.create("GeneraliEC.nuovaRichiesta.store.Allegati",{autoLoad:!1});a.bindStore(this.storeAllegati);this.gestioneForm();this.caricaAllegati()},destroy:function(){delete this.storeAllegati;this.callParent()}});
Ext.define("GeneraliEC.nuovaRichiesta.controller.AnnullaRichiesta",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"BtnConferma",selector:this.selContainer+"#BtnConferma"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"DataAnnullamento",selector:this.selContainer+"#DataAnnullamento"},{ref:"CBUtente",selector:this.selContainer+"#CBUtente"}]);
this.control(this.selContainer+"#BtnConferma",{click:this.confermaClick});this.control(this.selContainer+"#BtnEsci",{click:this.esciClick})},verificaCampiForm:function(a){var b=[];a.isValid()||msgAddError(b,"MSG_CAMPI_OBBLIGATORI");return msgShow("",b)},confermaClick:function(a){var b=this.getForm(),c=b.getForm();this.verificaCampiForm(b)&&(this.cbaConfig.callbackConferma&&(b=c.getFieldValues(),Ext.apply(b,{idRichiesta:this.cbaConfig.idRichiesta,codUtente:this.getCBUtente().getValue()}),this.cbaConfig.callbackConferma(b)),
a.up("window").close())},esciClick:function(a){a.up("window").close()},caricaStore:function(){var a=this.getCBUtente(),b=a.getStore(),c={};a.setReadOnly(!0);Ext.apply(c,{codEnte:CBA.parametriGenerali.codEntePwd,codiceModulo:CBA.moduli.moduloAttivo,idOrganizzazione:this.cbaConfig.idOrganizzazione,soloUtentiIdOrg:"T"});b.load({params:c,callback:function(b,c,g){g?Ext.isEmpty(b)?msgShowError("",c.getError()):a.setValue(CBA.parametriGenerali.codUtente):msgShowError("",c.getError())}})},onLaunch:function(){this.getDataAnnullamento().setValue(new Date);
this.caricaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.nuovaRichiesta.controller.DettaglioArticoli",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridArticoli",selector:this.selContainer+"#GridArticoli"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"BtnRipristina",selector:this.selContainer+"#BtnRipristina"},{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},
{ref:"Ordinamento",selector:this.selContainer+"#Ordinamento"}]);this.control(this.selContainer+"#GridArticoli",{beforeedit:this.beforeeditGrid,canceledit:this.canceleditGrid,edit:this.editGrid,validateedit:this.validateeditGrid});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#BtnRipristina",{click:this.clickBtnRipristina});this.control(this.selContainer+"#Ordinamento",
{change:this.changeOrdinamento})},changeOrdinamento:function(){var a=this.getGridArticoli(),b=a.getStore(),a=a.getSelectionModel();a.hasSelection()&&a.deselectAll();b.getSorters().each(function(a){b.getSorters().remove(a)},this);this.aggiornaStore()},noteDettaglioArt:function(a){Ext.create("winCBA",{titolo:traduci("NOTE"),name:"GeneraliEC.base.view.Descrizione",altezzaWin:300,larghezzaWin:500,configItem:{testo:a.get("note"),callbackScrivi:function(b){a.set("note",b)}}}).show()},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);
this.getBtnElimina().setDisabled(!a)},clickBtnRipristina:function(){var a=this.getGridArticoli().getSelectionModel();Ext.each(a.getSelection(),function(a){a.reject()})},clickBtnNuovo:function(a,b){var c={},d=this.getGridArticoli(),e=d.getStore().getCount();Ext.apply(c,{idTestata:this.idTestata,note:null});controller_nuovoRecordGrid(c,d,e)},clickBtnElimina:function(a){var b=this;a=b.getGridArticoli();var c=a.getSelectionModel().getSelection();b.convalida?(c=c[0],controller_eliminaRecord(a.getStore(),
{id:c?c.get("id"):""},function(a){b.aggiornaStore()})):c.forEach(function(a){a.store.deleteRecord(a)})},aggiungiRecordAttuale:function(a,b){0<b.get("codArticolo")&&0>a.getStore().find("codice",b.get("codArticolo"))&&(a.getStore().add({codice:b.get("codArticolo"),valore:b.get("descrizioneCodice"),extra:"at:T,udm:"+b.get("udm")}),a.setValue(b.get("codArticolo")))},beforeeditGrid:function(a,b,c){if(a.editing||this.magfar)return!1;var d=this,e=b.record;a=a.getEditor().getForm();var g=a.findField("codArticolo");
a=a.findField("udm");d.controllerTestata&&!d.convalida&&StdEconomato.isRichiesteReparto()&&StdEconomato.sporcaForm(d.controllerTestata.getForm());d.aggiungiRecordAttuale(g,e);if(d.cambioTestata){delete d.cambioTestata;c=g.getStore();var h={};StdEconomato.isValidID(d.idOrganizzazione)||(d.idOrganizzazione=getIdOrg());d.magazzinoFarmacia||(d.magazzinoFarmacia="F");Ext.apply(h,{idOrganizzazione:d.idOrganizzazione,tipoArticolo:d.magazzinoFarmacia,attivo:"T"});60===CBA.moduli.moduloAttivo&&Ext.apply(h,
{codUtente:CBA.parametriGenerali.codUtente});StdEconomato.isValidID(d.idDeposito)&&Ext.apply(h,{idDeposito:d.idDeposito});var k=StdEconomato.isValidID(d.idEsercizio)?d.idEsercizio:d.controllerTestata?d.controllerTestata.idEsercizioDefault:null;StdEconomato.isValidID(k)&&Ext.apply(h,{idEsercizio:k});c.getProxy().extraParams=h;c.load({callback:function(a,b,c){d.aggiungiRecordAttuale(g,e)}});a.getStore().load()}(a=b.column)&&"note"===a.dataIndex&&(b=b.column.field)&&"container"===b.getXType()&&b.queryById("btnNote").handler()},
canceleditGrid:function(a,b,c){b.record.phantom&&!b.record.get("fromStd")&&b.record.reject();this.controllerTestata&&!this.convalida&&StdEconomato.isRichiesteReparto()&&StdEconomato.sporcaForm(this.controllerTestata.getForm(),!1);this.abilitaBottoniGrid(!0)},editGrid:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm(),e=d.findField("codArticolo"),g=d.findField("udm"),h=d.findField("giacenza");this.convalida?(d.controller=this,d.store=b.view.getStore(),controller_salvaRecord(d,c,!1,
{forzaRegistrazione:"F"},!1)?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)):(b.record.set("descrizioneCodice",e.getRawValue()),b.record.set("um",g.getRawValue()),a=StdEconomato.coalesce(""+h.getValue(),""),a=a.replace(/\./g,"").replace(",","."),b.record.set("giacenza",+a),this.abilitaBottoniGrid(!0))},validateeditGrid:function(a,b,c){return msgShow("",[])},compilaUnitaMisura:function(a){var b=this.getGridArticoli().editingPlugin.getEditor().getForm(),c=b.findField("udm"),b=b.findField("giacenza");
a&&(a=getObjectFromString(a.get("extra"),",",":"),StdEconomato.isValidID(a.udm)&&c.setValue(a.udm),a.giac=a.giac?arrotonda(+a.giac,5):0,b.setValue(Ext.util.Format.number(a.giac,"0.00,")))},caricaDettagli:function(a,b){var c=this.getGridArticoli();this.controllerTestata=b;this.readOnly=b.readOnly;this.idOrganizzazione=b.idOrganizzazione;this.idTestata=a?a.get("id"):0;this.idEsercizio=a?a.get("idEsercizio"):0;this.idDeposito=a?a.get("idDeposito"):0;this.cambioTestata=!0;c.setTitle(a&&"A"==a.get("stato")?
StdEconomato.getStatoRichiestaExtend(a):traduci("ARTICOLI"));this.svuotaStore();this.aggiornaStore()},aggiornaStore:function(a){var b=this.getGridArticoli(),c=b.getStore();if(StdEconomato.isValidID(this.idTestata)){var d=this.getOrdinamento().getValue();svuotaStore(c);c.load({params:{idTestata:this.idTestata,tipoOrdinamento:d.tipo,classificazione:this.magazzinoFarmacia},callback:function(d,g,h){h?!Ext.isEmpty(d)&&StdEconomato.isValidID(a)&&(d=trovaRecord(c,"id",a),b.getSelectionModel().select(d?[d]:
0)):msgShowError("",g.getError())}})}},svuotaStore:function(){var a=this.getGridArticoli().getStore();(a.isLoaded()||0<a.getRange().length)&&svuotaStore(this.getGridArticoli().getStore())},onLaunch:function(){var a=this,b=a.getGridArticoli(),c=b.getSelectionModel();a.magazzinoFarmacia=StdEconomato.getTipoMagFar(CBA.moduli.modulo60.tipoRichiesta);b.controller=a;var d=function(b){var c=a.getBtnElimina(),d=a.getBtnRipristina();Ext.isEmpty(b)||a.magfar?(c.setVisible(!1),d.setVisible(!1)):(b=b[0],b=b.store&&
b.store.isRecordDeleted(b),c.setVisible(!b),c.setDisabled(!c.isVisible()||a.readOnly),d.setVisible(b))};a.magfar&&a.getBtnNuovo().setVisible(!1);b.getStore().on({datachanged:function(){d(c.getSelection())},update:function(a,b){d([b])}});c.on("selectionchange",function(a,b){d(b)});a.cbaConfig&&a.cbaConfig.fromCss&&a.impostazioniRichiesteRepartoCss();a.controllerTestata&&!Ext.isEmpty(a.controllerTestata.consumiMagazzino)&&a.caricaConsumiMagazzino(a.controllerTestata.consumiMagazzino)},impostazioniRichiesteRepartoCss:function(){var a=
this.getGridArticoli();Ext.suspendLayouts();Ext.each(a.getColumns(),function(a){a.dataIndex&&("qtaDaCons"===a.dataIndex||"stato"===a.dataIndex||"qtaEvasa"===a.dataIndex?a.hide():"qtaOrdine"===a.dataIndex?(Ext.apply(a,{renderer:function(a,b,e){return e.get("confez")?e.get("qtaOrdine")+" "+e.get("confez"):e.get("qtaOrdine")}}),Ext.apply(a.editor,{allowDecimals:!1})):"udm"===a.dataIndex?Ext.apply(a.editor,{allowBlank:!0}):"giacenza"===a.dataIndex&&(a.setText("Consumo"),Ext.apply(a.editor,{allowBlank:!0})))});
a.reconfigure();this.getOrdinamento().hide();Ext.resumeLayouts()},caricaConsumiMagazzino:function(a){var b=this.getGridArticoli().getStore();this.magazzinoFarmacia="F";this.idOrganizzazione=getIdOrg();Ext.defer(function(){return a.forEach(function(a,d){var c=a.idUniMis,g=a.desunimisSom,h=a.codArticolo,k=a.desFarmaco,l=a.dose,m=a.qtaRichiesta,n="",q=0;m&&(m=m.split(" "),q=m[0],n=m[1]);b.insert(d,{udm:c,um:g,codArticolo:h,descrizioneCodice:k,qtaOrdine:q,giacenza:l,confez:n})[0].phantom=!1})},1E3)},
gestCatalogoArticoli:function(a){var b=a.getValue(),c=Ext.getBody().getViewSize(),d=c.width-25,c=c.height-100,e=!0;1300<d&&(d=1300);800<c&&(c=800);StdEconomato.isValidID(b)&&(this.magazzinoFarmacia=StdEconomato.getTipoMagFar(CBA.moduli.modulo60.tipoRichiesta),Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/richiesta/verificaCatalogo",async:!1,params:{videata:"F"==this.magazzinoFarmacia?"FARCatalogoArticoli":"MAGCatalogoArticoli"},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?
"N"==a.message[0].testo&&(msgShowWarning("",traduci("MSG_PERMESSI_INSUFFICENTI")),e=!1):msgShowError("",a.message)}}),e&&Ext.create("winCBA",{titolo:traduci("CATALOGO_ARTICOLI"),name:"GeneraliEC.base.view.GestCatalogoArticoli",dimensione:3,larghezzaWin:d,altezzaWin:c,idOrganizzazione:this.idOrganizzazione,closable:!0,configItem:{codArticolo:b,callbackRiapriStore:function(){a.getStore().reload()}}}).show())},callBackRenderWin:function(){var a=this,b=a.cbaConfig.recTes,c=a.cbaConfig.controller,d=a.getGridArticoli();
d.getHeader().hide();a.getBtnEsci().setVisible(!0);d.getPlugin().on("edit",function(b,c,d){d=c.record.getData();var e=b.getEditor().getForm();e.controller=a;e.store=c.view.getStore();controller_salvaRecord(e,d,!1,{forzaRegistrazione:"F"},!1)?a.abilitaBottoniGrid(!0):b.startEdit(c.record,0)});a.caricaDettagli(b,c)},destroy:function(){delete this.controllerTestata;this.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.controller.InterventiEffettuati",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridArticoli",selector:this.selContainer+"#GridArticoli"}])},svuotaStore:function(){this.getGridArticoli().getStore().isLoaded()&&svuotaStore(this.getGridArticoli().getStore())},aggiornaStore:function(a){a=this.getGridArticoli().getStore();StdEconomato.isValidID(this.idTestata)&&a.load({params:{idRichiesta:this.idTestata},
callback:function(a,c,d){d||msgShowError("",c.getError())}})},caricaDettagli:function(a,b){var c=this.getGridArticoli();this.controllerTestata=b;this.readOnly=b.readOnly;this.idOrganizzazione=b.idOrganizzazione;this.idTestata=a?a.get("id"):0;c.setTitle(a&&"A"==a.get("stato")?StdEconomato.getStatoRichiestaExtend(a):"");this.svuotaStore();this.aggiornaStore()},onLaunch:function(){this.getGridArticoli().controller=this},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.controller.NuovaRichiesta",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"PnlRicerca",selector:a.selContainer+"#PnlRicerca"},{ref:"StatoRicerca",selector:a.selContainer+"#StatoRicerca"},{ref:"TabPaginatore",selector:a.selContainer+"#TabPaginatore"},{ref:"PnlPrincipale",selector:a.selContainer+"#PnlPrincipale"},{ref:"PnlDettaglio",selector:a.selContainer+"#PnlDettaglio"},
{ref:"PnlAllegati",selector:a.selContainer+"#PnlAllegati"},{ref:"FormRicerca",selector:a.selContainer+"#FormRicerca"},{ref:"GridRisultato",selector:a.selContainer+"#GridRisultato"},{ref:"CBArticolo",selector:a.selContainer+"#CBArticolo"},{ref:"DataDalRicerca",selector:a.selContainer+"#DataDalRicerca"},{ref:"DataAlRicerca",selector:a.selContainer+"#DataAlRicerca"},{ref:"NumRifDal",selector:a.selContainer+"#NumRifDal"},{ref:"NumRifAl",selector:a.selContainer+"#NumRifAl"},{ref:"BtnCercaRicerca",selector:a.selContainer+
"#BtnCercaRicerca"},{ref:"CBUtenteRicerca",selector:a.selContainer+"#CBUtenteRicerca"},{ref:"CBRepartoRicerca",selector:a.selContainer+"#CBRepartoRicerca"}]);3===CBA.moduli.modulo60.tipoRichiesta?(a.addRef([{ref:"CBSedeRicerca",selector:a.selContainer+"#CBSedeRicerca"}]),a.control(a.selContainer+"#CBSedeRicerca",{change:a.cambioSede})):(a.addRef([{ref:"CBDepositoRicerca",selector:a.selContainer+"#CBDepositoRicerca"},{ref:"BtnCopiaRicerca",selector:a.selContainer+"#BtnCopiaRicerca"}]),a.control(a.selContainer+
"#BtnCopiaRicerca",{click:function(){var b=a.clone.bind(a);Messaggio("RICHIESTE","MSG_COPIA_RICHIESTA","YESNO","WARNING",null,b)}}),a.control(a.selContainer+"#CBDepositoRicerca",{change:a.cambioDeposito}),a.control(a.selContainer+"#CBArticolo",{change:a.cambioArticolo}));a.control(a.selContainer+"#CBRepartoRicerca",{change:a.cambioReparto});a.control(a.selContainer+"#CBUtenteRicerca",{change:a.cambioUtente});a.control(a.selContainer+"#GridRisultato",{select:a.selectRicerca});a.control(a.selContainer+
"#BtnCercaRicerca",{click:a.cerca})},cambioSede:function(a,b,c,d){a=this.getCBRepartoRicerca().getStore();c={};b&&Ext.apply(c,{sede:b});a.load({params:c})},cambioReparto:function(a,b,c){},cambioDeposito:function(a,b,c){},cambioUtente:function(a,b,c){},cambioArticolo:function(a,b,c){},caricaStoreRicerca:function(){var a=[],b=this.getCBRepartoRicerca(),c=b.getStore(),d=this.getCBUtenteRicerca(),e=d.getStore(),g=this.getCBArticolo(),h=g.getStore();if(3==CBA.moduli.modulo60.tipoRichiesta){var k=this.getCBSedeRicerca();
this.getCBSedeRicerca().getStore().getProxy().extraParams={idEsercizio:this.idEsercizioDefault,idOrganizzazione:this.idOrganizzazione};a.push(k)}c.getProxy().extraParams={idEsercizio:this.idEsercizioDefault,idOrganizzazione:this.idOrganizzazione};a.push(b);3!==CBA.moduli.modulo60.tipoRichiesta&&(b=this.getCBDepositoRicerca(),b.getStore().getProxy().extraParams={tipoDeposito:this.magazzinoFarmacia,abilitatiRc:"T"},a.push(b));e.getProxy().extraParams={codEnte:CBA.parametriGenerali.codEntePwd,codiceModulo:CBA.moduli.moduloAttivo,
idOrganizzazione:this.idOrganizzazione,soloUtentiIdOrg:"T"};a.push(d);this.magazzinoFarmacia&&(h.getProxy().extraParams={tipoArticolo:this.magazzinoFarmacia});a.push(g);var l=function(a,b){a.load({callback:b})},m=a.length;a.forEach(function(b){m--;b=b.getStore();l(b,function(){0===m&&a.forEach(function(a){var b=a.getStore();1===b.count()&&a.setValue(b.getAt(0))})})});this.cerca()},cerca:function(){var a=this,b=a.getGridRisultato(),c=b.getStore(),d=a.getParametriRicerca();c.currentPage=1;c.getProxy().extraParams=
d;c.loadPage(c.currentPage,{pageSize:25,callback:function(c,d,h){h?Ext.isEmpty(c)?a.recordSelezionato(null):b.getSelectionModel().select(0):msgShowError("",d.getError())}})},clone:function(){var a=this,b=a.getGridRisultato(),c=b.getSelectionModel();1==b.getSelection().length&&(b=c.getSelection()[0],c={},Ext.apply(c,{id:b.get("id")}),Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/richiesta/clone",async:!1,params:c,success:function(b){b=Ext.JSON.decode(b.responseText);var c=[];b.success?(msgAdd(c,
b.message),a.cerca()):msgAddError(c,b.message);msgShow("",c)}}))},getParametriRicerca:function(){var a=[];this.getFormRicerca().getValues();var b={};Ext.apply(b,{tipoRichiesta:CBA.moduli.modulo60.tipoRichiesta,idOrganizzazione:this.idOrganizzazione});this.getStatoRicerca().getChecked().forEach(function(b){a.push(b.inputValue)});Ext.isEmpty(a)||Ext.apply(b,{eleStato:a.toString()});this.getCBRepartoRicerca().getValue()&&Ext.apply(b,{reparto:this.getCBRepartoRicerca().getValue()});3===CBA.moduli.modulo60.tipoRichiesta?
(this.getCBArticolo().getValue()&&Ext.apply(b,{codArticolo:this.getCBArticolo().getCodArticolo(),tipoArticolo:this.getCBArticolo().getTipoArticolo()}),this.getCBSedeRicerca().getValue()&&Ext.apply(b,{sede:this.getCBSedeRicerca().getValue()})):(Ext.apply(b,{classificazione:this.magazzinoFarmacia}),this.getCBDepositoRicerca().getValue()&&Ext.apply(b,{idDeposito:this.getCBDepositoRicerca().getValue()}),this.getCBArticolo().getValue()&&Ext.apply(b,{codArticolo:this.getCBArticolo().getValue()}));this.getCBUtenteRicerca().getValue()&&
Ext.apply(b,{codUtente:this.getCBUtenteRicerca().getValue()});this.getDataDalRicerca().getValue()&&Ext.apply(b,{dataDal:this.getDataDalRicerca().getValue()});this.getDataAlRicerca().getValue()&&Ext.apply(b,{dataAl:this.getDataAlRicerca().getValue()});this.getNumRifDal().getValue()&&Ext.apply(b,{numRifDal:this.getNumRifDal().getValue()});this.getNumRifAl().getValue()&&Ext.apply(b,{numRifAl:this.getNumRifAl().getValue()});return b},recordSelezionato:function(a){var b=this;b.testata&&(b.testata.caricaRecord(a,
b),setTimeout(function(){1024>=Ext.getBody().getViewSize().width&&b.getPnlRicerca().collapse()},1E3))},selectRicerca:function(a,b){this.recordSelezionato(b)},onLaunch:function(){var a=this,b={},c=a.getPnlPrincipale(),d=a.getCBArticolo();a.idOrganizzazione=getIdOrg();Ext.apply(b,{controllerPrincipale:a,cbaConfig:{permesso:a.cbaConfig.permesso}});3!==CBA.moduli.modulo60.tipoRichiesta?(a.magazzinoFarmacia=StdEconomato.getTipoMagFar(CBA.moduli.modulo60.tipoRichiesta),a.getPnlDettaglio().tab.setVisible(!1),
a.getPnlAllegati().tab.setVisible(!1),a.getPnlDettaglio().setTitle("ARTICOLI"),d.bindStore(Ext.create("GeneraliEC.catalogoArticoli.store.CboxArticoli",{asynchronousLoad:!1})),b=Ext.create("GeneraliEC.nuovaRichiesta.view.Testata",b)):(a.getPnlAllegati().tab.setVisible(!0),a.getPnlDettaglio().tab.setVisible(!0),a.getPnlDettaglio().setTitle("INTERVENTI_EFFETTUATI"),d.bindStore(Ext.create("GeneraliEC.tabelleBase.store.ArticoloCbox",{asynchronousLoad:!1})),b=Ext.create("GeneraliEC.nuovaRichiesta.view.TestataMan",
b));getIdEsercizioDefaultByIdOrg(a.idOrganizzazione,function(b){a.idEsercizioDefault=b;StdEconomato.getEsercizioContabileById(b).then(function(b){a.getDataDalRicerca().setValue(Ext.Date.parse(b.dataInizioPeriodo,"Y-m-d H:i:s"));a.getDataAlRicerca().setValue(Ext.Date.parse(b.dataFinePeriodo,"Y-m-d H:i:s"))})["catch"](function(a){msgShowError("",a)});a.caricaStoreRicerca()});c.add(b);a.testata=b.controller}});
Ext.define("GeneraliEC.nuovaRichiesta.controller.Testata",{extend:"GeneraliEC.base.controller.NuovaRichiesta",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CBDeposito",selector:this.selContainer+"#CBDeposito"},{ref:"CBCarica",selector:this.selContainer+"#CBCarica"},{ref:"TrasferimentoScorte",selector:this.selContainer+"#TrasferimentoScorte"},{ref:"CBDepositoTs",selector:this.selContainer+"#CBDepositoTs"},{ref:"CBCausaleTs",selector:this.selContainer+
"#CBCausaleTs"},{ref:"ChTrasferimScorte",selector:this.selContainer+"#ChTrasferimScorte"}]);this.control(this.selContainer+"#ChTrasferimScorte",{change:this.cambioChTrasferimScorte});this.control(this.selContainer+"#CBDeposito",{change:this.cambioDeposito})},cambioChTrasferimScorte:function(a,b){this.gestioneCampi(b)},cambioCarica:function(a){var b=this,c=b.getIdEsercizio(),d={};StdEconomato.isValidID(a)&&(Ext.apply(d,{idModello:a,classificazione:b.magazzinoFarmacia}),b.oridinamentoRichiesteStandard&&
Ext.apply(d,{persOrdinamento:b.oridinamentoRichiesteStandard}),StdEconomato.isValidID(c)&&Ext.apply(d,{idEsercizio:c}),Ext.Ajax.request({method:"GET",url:"/cba/eco/rc/ws/modRic/getRicFromModel",async:!1,params:d,success:function(a){a=Ext.JSON.decode(a.responseText);var c=[];if(a.success){var d=b.articoli.getGridArticoli(),e=d.getStore();e.each(function(a){a.store.deleteRecord(a)});a.data.forEach(function(a){a.fromStd=!0});e.add(a.data);d.ensureVisible(e.count())}else msgAddError(c,a.message);msgShow("",
c)}}))},cambioDeposito:function(a,b,c,d){a=this.getCBCarica().getStore();c=a.getProxy().extraParams;this.articoli.idDeposito=b;this.articoli.cambioTestata=!0;delete c.idDeposito;delete c.idEsercizio;b&&Ext.apply(c,{idDeposito:b});a.load();if(!b)return!1;if(this.checkTrasferimentoScorte()){var e=this.getCBDepositoTs();a=e.getStore();a.clearFilter();a.filter(function(a){if(a.get("codice")!==b)return!0;e.getValue()===b&&setValue(e,null);return!1})}},salvaForm:function(a,b){var c=this.getForm(),d=c.getForm().getFieldValues(),
e=!StdEconomato.isValidID(d.id);Ext.apply(d,{id:parseInt(d.id),stato:b,dataCreazione:new Date});e&&Ext.apply(d,{idOrganizzazione:this.idOrganizzazione,idEsercizio:this.idEsercizioDefault,tipoRichiesta:CBA.moduli.modulo60.tipoRichiesta,classificazione:this.magazzinoFarmacia,codUtente:CBA.parametriGenerali.codUtente});delete d.provvisorio;delete d.desStato;delete d.trasferimentoScorte;var g=this.articoli.getGridArticoli().getStore().getChanges();null!==g&&(e||g.forEach(function(a){StdEconomato.isValidID(a.idTestata)||
(a.idTestata=+d.id)}),g.forEach(function(a){delete a.fromStd}),Ext.apply(d,{richiestaDettagli:g}));controller_salvaRecord(c,d,a,{forzaRegistrazione:"F"})?("T"!==b&&whenLoaded(this.storeTestata,function(){Messaggio("RICHIESTE","DOMANDA_STAMPA_RICHIESTA","YESNO","WARNING",null,function(){var a=c.boxBottoni.queryById("BtnStampa");a.fireEvent("click",a)})}),this.controllerPrincipale&&this.controllerPrincipale.cerca()):c.boxBottoni.queryById("cntBottoni").setBtnEditMode(!0)},verifica:function(){var a=
!0,b=this.articoli.getGridArticoli().editingPlugin;b.editing&&(b.completeEdit(),a=!b.editing);a&&(a=this.verificaCampiForm());return a},gestioneForm:function(){var a=this,b=a.getForm(),c=b.getForm(),d={};Ext.apply(d,{cbaConfig:{richiesta_callback:function(b){a.salvaForm(b,"D")},temporanea_callback:function(b){a.salvaForm(b,"T")},proposta_callback:function(b){a.salvaForm(b,"R")},annulla_callback:function(){a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b,c.findField("priorita"));
a.setCampiSolaLettura(!1);a.svuotaDettagli();a.caricaStoreTestata(a.idEsercizioDefault,a.idOrganizzazione);var d=a.getCBPriorita().getStore(),e;1===d.count()?e=d.getAt(0).get("codice"):d.each(function(a){var b=a.get("extra");if(b&&"T"===b.split(",")[0])return e=a.get("codice"),!1});var d=a.getCBReparto().getStore(),g;1===d.count()&&(g=d.getAt(0).get("codice"));var d=a.getCBDeposito().getStore(),m;1===d.count()&&(m=d.getAt(0).get("codice"));g=new a.storeTestata.model({priorita:e,idCda:g,idDeposito:m});
b.loadRecord(g);a.personalizzazioni(a.idEsercizioDefault,a.idOrganizzazione).then(function(b){a.consentiTrasfScorte=Ext.isEmpty(b)?!1:"T"==b[0].trasferimentoScorte;a.getTrasferimentoScorte().setVisible(a.checkTrasferimentoScorte());a.oridinamentoRichiesteStandard=Ext.isEmpty(b)?void 0:b[0].ordinamentoRicStandard})},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.controllerPrincipale.cerca()})},verificaCampiForm_callback:function(){return a.verifica()}}});
a.callParent([d]);var e=b.boxBottoni,g=a.articoli.getGridArticoli().getStore();e.queryById("btnInviaRichiesta").setVisible(!0);e.queryById("btnTemporanea").setVisible(!0);e.queryById("btnProposta").setVisible(!0);d=e.queryById("BtnStampa");d.setVisible(!0);a.configurePrintButton(d,"preview");d=function(){var c=b.isDirty()||g.isModified()||b.getRecord()&&b.getRecord().phantom;!c||b.isDirty()||g.isModified()||(c=!1);a.articoli.getOrdinamento().setDisabled(c);e.queryById("cntBottoni").setBtnEditMode(c);
a.readOnly&&!c&&e.queryById("btnElimina").setDisabled(a.readOnly);c=!c;!a.readOnly&&StdEconomato.isValidID(a.idTestata)&&"T"===a.statoRichiesta&&(c=!1);e.queryById("btnInviaRichiesta")&&e.queryById("btnInviaRichiesta").setDisabled(c);e.queryById("btnProposta")&&e.queryById("btnProposta").setDisabled(c)};"L"!=b.permesso&&(b.getForm().on("dirtychange",d),g.on({datachanged:d,update:d}))},onLastFieldTab:function(a){!this.readOnly&&a.isDirty()&&this.articoli.getBtnNuovo().fireEvent("click")},verificaCampiForm:function(){var a=
this.getForm(),b=this.articoli.getGridArticoli().getStore(),c=[];a.isValid()||msgAddError(c,"MSG_CAMPI_OBBLIGATORI");Ext.isEmpty(c)&&(StdEconomato.isValidID(b.count())||msgAddError(c,"OBBLIGO_INSERIMENTO_RIGA_DETT"));return msgShow("",c)},caricaStoreTestata:function(a,b){this.callParent(arguments);var c=this.getCBReparto().getStore();cbDeposito=this.getCBDeposito();cbDepositoTs=this.getCBDepositoTs();cbCarica=this.getCBCarica();storeDepositi=cbDeposito.getStore();storeCarica=cbCarica.getStore();c.getProxy().extraParams=
{idEsercizio:a,idOrganizzazione:b};storeDepositi.getProxy().extraParams={tipoDeposito:this.magazzinoFarmacia,abilitatiRc:"T"};storeCarica.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,classificazione:this.magazzinoFarmacia};c.load();storeDepositi.load({callback:function(a,b,c){c?cbDepositoTs.bindStore(clonaStore(storeDepositi)):msgShowError("",b.getError())}})},getIdEsercizio:function(){var a=this.getForm(),b=a?a.getForm():null,a=b?b.findField("id"):null,b=b?b.findField("idEsercizio"):
null;return a&&!StdEconomato.isValidID(a.getValue())?this.idEsercizioDefault:b?b.getValue():null},personalizzazioni:function(a,b){return StdEconomato.promiseGetRequest(getUrlGen()+"/ws/prszn/general/list",{idEsercizio:a,idOrganizzazione:b})},checkTrasferimentoScorte:function(){var a=!0,b=this.getCBDeposito().getStore();StdEconomato.isValidID(this.getCBDepositoTs().getValue())||(a=this.consentiTrasfScorte)&&(a=1<b.getTotalCount());return a},onLaunch:function(){var a=this,b={},c=a.controllerPrincipale.getPnlDettaglio();
Ext.apply(b,{controllerTestata:a,cbaConfig:{permesso:a.cbaConfig.permesso}});a.idOrganizzazione=getIdOrg();a.magazzinoFarmacia=StdEconomato.getTipoMagFar(CBA.moduli.modulo60.tipoRichiesta);a.storeTestata=Ext.create("GeneraliEC.nuovaRichiesta.store.RichiestaTes",{autoLoad:!1});b=Ext.create("GeneraliEC.nuovaRichiesta.view.DettaglioArticoli",b);c.add(b);a.articoli=b.controller;a.on("testataCaricata",function(b){a.getTxOperatore().setVisible(StdEconomato.isValidID(a.idTestata));var c=a.idEsercizioDefault;
b&&(c=b.get("idEsercizio"),a.caricaStoreTestata(b.get("idEsercizio"),a.idOrganizzazione));a.articoli.caricaDettagli(b,a);a.personalizzazioni(c,a.idOrganizzazione).then(function(b){a.consentiTrasfScorte=Ext.isEmpty(b)?!1:"T"==b[0].trasferimentoScorte;a.getTrasferimentoScorte().setVisible(a.checkTrasferimentoScorte());a.oridinamentoRichiesteStandard=Ext.isEmpty(b)?void 0:b[0].ordinamentoRicStandard})});a.getCBCausaleTs().getStore().load({params:{tipoMovimento:"C",reso:"F",apertoChiuso:"F",omaggio:"F"}});
getIdEsercizioDefaultByIdOrg(a.idOrganizzazione,function(b){a.idEsercizioDefault=b;a.caricaStoreTestata(a.idEsercizioDefault,a.idOrganizzazione)});a.gestioneForm()},gestioneCampi:function(a){a=void 0===a?!1:a;this.getCBReparto().allowBlank=a;this.getCBDepositoTs().allowBlank=!a;this.getCBCausaleTs().allowBlank=!a;this.getCBReparto().validate();this.getCBDepositoTs().validate();this.getCBDepositoTs().setDisabled(!a);this.getCBCausaleTs().setDisabled(!a);this.getCBReparto().setDisabled(a);this.getCBReparto().isDisabled()?
setValue(this.getCBReparto(),null):(setValue(this.getCBDepositoTs(),null),setValue(this.getCBCausaleTs(),null))},destroy:function(){delete this.storeTestata;delete this.articoli;this.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.controller.TestataMan",{extend:"GeneraliEC.base.controller.NuovaRichiesta",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CBSede",selector:this.selContainer+"#CBSede"},{ref:"CBReparto",selector:this.selContainer+"#CBReparto"},{ref:"CBStanza",selector:this.selContainer+"#CBStanza"},{ref:"CBUfficio",selector:this.selContainer+"#CBUfficio"},{ref:"SMArticoli",selector:this.selContainer+"#SMArticoli"},{ref:"CBCdc",
selector:this.selContainer+"#CBCdc"},{ref:"CBArticolo",selector:this.selContainer+"#CBArticolo"},{ref:"CBTipo",selector:this.selContainer+"#CBTipo"},{ref:"CBClassificazione",selector:this.selContainer+"#CBClassificazione"}]);this.control(this.selContainer+"#CBClassificazione",{change:this.changeCBClassificazione});this.control(this.selContainer+"#CBSede",{change:this.changeCBSede});this.control(this.selContainer+"#CBReparto",{change:this.changeCBReparto});this.control(this.selContainer+"#CBArticolo",
{change:this.changeCBArticolo})},isFiltroUfficioAttivo:function(){var a=this;Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/pwd/filtrimanutentore/isAbilitato",params:{idOrganizzazione:a.idOrganizzazione},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.data;b.success&&(a.getCBUfficio().allowBlank=0<c?!1:!0)}})},loadUffici:function(a){a=void 0===a?"T":a;var b=this.getCBUfficio();return StdEconomato.promiseLoadStore(b.getStore(),{attivi:a})},loadSediRepartiStanza:function(a,b){var c=this,
d=c.getCBSede();param={};c.nuovoInserimento&&Ext.apply(param,{soloAttivi:"T"});StdEconomato.isValidID(a)&&Ext.apply(param,{sede:a});return StdEconomato.promiseLoadStore(d.getStore(),param).then(function(a){a=c.getCBReparto();StdEconomato.isValidID(b)||(b=a.getValue());StdEconomato.isValidID(b)&&Ext.apply(param,{reparto:b});return StdEconomato.promiseLoadStore(a.getStore(),param)}).then(function(a){a=c.getCBStanza();StdEconomato.isValidID(a.getValue())&&Ext.apply(param,{idStanza:a.getValue()});return StdEconomato.promiseLoadStore(a.getStore(),
param)})["catch"](function(a){return msgShowError("",a)})},loadStoreArticolo:function(a){var b={};Ext.apply(b,{idOrganizzazione:this.idOrganizzazione,soloAttivi:void 0===a?"F":a});return this.loadComboStore(this.getCBArticolo(),b)},loadComboStore:function(a,b){b=void 0===b?{}:b;var c=a.getStore();c.getProxy().extraParams=b;return new Promise(function(a,b){c.load({callback:function(c,d,e){e?a(c,d,e):b(d.getError())}})})},changeCBClassificazione:function(a,b,c){StdEconomato.isValidID(b)&&(a=a.getStore().findRecord("codice",
b),""==Ext.getCmp("RPTXDesc").getValue()&&Ext.getCmp("RPTXDesc").setValue(a.get("extra")))},sedeRepartoStanzaSolaLettura:function(a){if(!this.readOnly){var b=this.getCBSede(),c=this.getCBReparto(),d=this.getCBStanza();if(a){var e=trovaRecord(b.getStore(),"codice",a.idSede);b.setValue(e?e:a.idSede);e=trovaRecord(c.getStore(),"codice",a.idReparto);c.setValue(e?e:a.idReparto);e=trovaRecord(d.getStore(),"codice",a.idStanza);d.setValue(e?e:a.idStanza);b.setReadOnly(StdEconomato.isValidID(a.idSede));c.setReadOnly(StdEconomato.isValidID(a.idReparto));
d.setReadOnly(StdEconomato.isValidID(a.idStanza))}else b.setReadOnly(!1),c.setReadOnly(!1),d.setReadOnly(!1)}},changeCBArticolo:function(a,b,c,d){var e=this;a.getSelection();c={};b&&Ext.apply(c,{tipoArticolo:a.getTipoArticolo(),idArticolo:a.getCodArticolo()});StdEconomato.isValidID(c.tipoArticolo)?StdEconomato.getLastUbicazioneArticolo(c.idArticolo).then(function(a){e.sedeRepartoStanzaSolaLettura(a)})["catch"](function(a){e.sedeRepartoStanzaSolaLettura(!1)}):e.sedeRepartoStanzaSolaLettura(!1)},changeCBSede:function(a,
b){this.loadSediRepartiStanza(a.getValue())},changeCBReparto:function(a,b){var c=this.getCBSede();this.loadSediRepartiStanza(c.getValue(),a.getValue())},gestioneForm:function(){var a=this,b=a.getForm(),c=b.getForm(),d={};Ext.apply(d,{cbaConfig:{richiesta_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.aggiornaStore()},nuovo_callback:function(){a.nuovoInserimento=!0;controller_nuovoRecord(b,c.findField("priorita"));a.setCampiSolaLettura(!1);a.svuotaDettagli();var d=a.getCBPriorita().getStore(),
g;1===d.count()?g=d.getAt(0).get("codice"):d.each(function(a){var b=a.get("extra");if(b&&"T"===b.split(",")[0])return g=a.get("codice"),!1});var h=function(a){a=a.getStore();var b;1===a.count()&&(b=a.getAt(0).get("codice"));return b};a.getCBSede().getStore();a.getCBReparto().getStore();a.loadSediRepartiStanza(null,null).then(function(b){return a.loadStoreArticolo("T")}).then(function(b){return a.loadUffici()}).then(function(c){c=new a.storeTestata.model({idOrganizzazione:a.idOrganizzazione,idEsercizio:a.idEsercizioDefault,
tipoRichiesta:CBA.moduli.modulo60.tipoRichiesta,codUtente:CBA.parametriGenerali.codUtente,priorita:g,codSede:h(a.getCBSede()),codReparto:h(a.getCBReparto()),codStanza:h(a.getCBStanza()),codUfficio:h(a.getCBUfficio()),codArticolo:h(a.getCBArticolo()),tipoIntervento:a.tipoDef?a.tipoDef:h(a.getCBTipo())});b.loadRecord(c)})},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.controllerPrincipale.cerca()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});
a.callParent([d]);d=b.boxBottoni;d.queryById("btnInviaRichiesta").setVisible(!0);d=d.queryById("BtnStampa");d.setVisible(!0);a.configurePrintButton(d,"preview");if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,d){StdEconomato.controller_abilitaBottoni(b);a.controllerPrincipale.getPnlAllegati().tab.setVisible(!d);a.controllerPrincipale.getTabPaginatore().setActiveTab(0)})},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",
a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();StdEconomato.isValidID(c.id)||Ext.apply(c,{idOrganizzazione:this.idOrganizzazione,idEsercizio:this.idEsercizioDefault,tipoRichiesta:CBA.moduli.modulo60.tipoRichiesta,codUtente:CBA.parametriGenerali.codUtente,dataCreazione:new Date,stato:"D"});Ext.apply(c,{tipoArticolo:this.getCBArticolo().getTipoArticolo(),codArticolo:this.getCBArticolo().getCodArticolo()});delete c.provvisorio;delete c.clcCodArticolo;controller_salvaRecord(b,
c,a,{forzaRegistrazione:"F"})?this.controllerPrincipale&&this.controllerPrincipale.cerca():StdEconomato.controller_abilitaBottoni(b)},onLastFieldTab:Ext.emptyFn,caricaStoreTestata:function(a,b){this.callParent(arguments);Promise.all([this.loadComboStore(this.getCBUfficio(),{idOrganizzazione:this.idOrganizzazione,tipo:"U"}),this.loadStoreArticolo(),this.loadComboStore(this.getCBCdc(),{idEsercizio:a,idOrganizzazione:b})])},aggiornaStore:function(a){this.loadStoreArticolo();this.loadUffici("F");this.callParent(arguments)},
onLaunch:function(){var a=this,b={},c=a.controllerPrincipale.getPnlDettaglio(),d=a.controllerPrincipale.getPnlAllegati();a.idOrganizzazione=getIdOrg();a.storeTestata=Ext.create("GeneraliEC.nuovaRichiesta.store.RichiestaTes",{autoLoad:!1});a.storePerson=Ext.create("RC.personalizzazioni.store.PannelloPerson");Ext.apply(b,{controllerTestata:a,idOrganizzazione:a.idOrganizzazione,cbaConfig:{permesso:"L"}});var e=Ext.create("GeneraliEC.nuovaRichiesta.view.InterventiEffettuati",b),b=Ext.create("GeneraliEC.nuovaRichiesta.view.Allegati",
b);c.add(e);d.add(b);a.articoli=e.controller;a.allegati=b.controller;a.on("testataCaricata",function(b){var c=b?b.get("idSede"):null,d=b?b.get("idReparto"):null;a.loadSediRepartiStanza(c,d).then(function(c){a.getTxOperatore().setVisible(StdEconomato.isValidID(a.idTestata));a.articoli.caricaDettagli(b,a);a.allegati.caricaAllegati(b,a)})});a.isFiltroUfficioAttivo();getIdEsercizioDefaultByIdOrg(a.idOrganizzazione,function(b){a.idEsercizioDefault=b;a.caricaStoreTestata(a.idEsercizioDefault,a.idOrganizzazione);
a.storePerson.load({params:{idOrganizzazione:a.idOrganizzazione,idEsercizio:a.idEsercizioDefault},callback:function(b,c,d){d&&!Ext.isEmpty(b)&&(a.tipoDef=b[0].get("tipoInterventoDef"),"T"===b[0].get("obbligaInserimentoPosizione")&&(a.getCBSede().allowBlank=!1,a.getCBReparto().allowBlank=!1,a.getCBStanza().allowBlank=!1))}})});a.gestioneForm()},destroy:function(){delete this.storeTestata;delete this.articoli;delete this.allegati;this.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.store.Allegati",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idRichiesta"},{name:"data",type:"date"},{name:"descrizione"},{name:"fileName"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/richiesta/allegati/get",api:{read:getUrlGen()+"/ws/richiesta/allegati/list",create:getUrlGen()+"/ws/richiesta/allegati/insert",update:getUrlGen()+"/ws/richiesta/allegati/update",destroy:getUrlGen()+"/ws/richiesta/allegati/delete"}}},
a)])},autoDestroy:!0});Ext.define("GeneraliEC.nuovaRichiesta.store.CboxModelloRichiesta",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/modRic/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.nuovaRichiesta.store.InterventiEffettuati",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"idIntervento"},{name:"idManutentore"},{name:"idEsercizioScarico"},{name:"idScarico"},{name:"idCausaProblemi"},{name:"idStato"},{name:"numFattura"},{name:"dataFattura",type:"date"},{name:"costo"},{name:"tipNumReg"},{name:"dataIntervento",type:"date"},{name:"dataEffIntervento",type:"date"},{name:"note"},{name:"effettuato"},{name:"oraInizio",type:"date"},
{name:"oraFine",type:"date"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/richiesta/calendario/list"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.nuovaRichiesta.store.Richiesta",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"tipoRichiesta"},{name:"dataCreazione",type:"date"},{name:"numRif"},{name:"codUtente"},{name:"idCda"},{name:"idDeposito"},{name:"dataConvalida",type:"date"},{name:"codUtenteConvalida"},{name:"stato"},{name:"classificazione"},{name:"idEsercizio"},{name:"priorita"},{name:"descrizione"},{name:"targa"},{name:"tipoIntervento"},{name:"prog"},{name:"codArticolo"},{name:"codSede"},
{name:"codReparto"},{name:"codStanza"},{name:"codGuasto"},{name:"attivo"},{name:"note"},{name:"nomeUtente"},{name:"dataAnnullamento",type:"date"},{name:"codUtenteAnnullatore"},{name:"nomeUtenteAnnullatore"},{name:"noteAnnullatore"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/richiesta/get",api:{read:getUrlGen()+"/ws/richiesta/list",create:getUrlGen()+"/ws/richiesta/insert",update:getUrlGen()+"/ws/richiesta/update",destroy:getUrlGen()+"/ws/richiesta/delete"}}},
a)])},autoDestroy:!0});
Ext.define("GeneraliEC.nuovaRichiesta.store.RichiestaDet",{extend:"Generali.data.Store",fields:[{name:"id"},{name:"idTestata"},{name:"codArticolo"},{name:"udm"},{name:"qtaOrdine"},{name:"qtaEvasa"},{name:"qtaDaCons"},{name:"stato"},{name:"numProp"},{name:"numRiga"},{name:"priorita"},{name:"note"},{name:"sospeso"},{name:"newRiga"},{name:"idScarico"},{name:"giacenza"},{name:"eliminare"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/richiesta/details/get",api:{read:getUrlGen()+
"/ws/richiesta/details/list",create:getUrlGen()+"/ws/richiesta/details/insert",update:getUrlGen()+"/ws/richiesta/details/update",destroy:getUrlGen()+"/ws/richiesta/details/delete"},type:"ajax",reader:{type:"json",messageProperty:"message",rootProperty:"data"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.nuovaRichiesta.store.RichiestaTes",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"tipoRichiesta"},{name:"dataCreazione",type:"date"},{name:"numRif"},{name:"codUtente"},{name:"idCda"},{name:"idDeposito"},{name:"dataConvalida",type:"date"},{name:"codUtenteConvalida"},{name:"stato"},{name:"classificazione"},{name:"idEsercizio"},{name:"priorita"},{name:"descrizione"},{name:"targa"},{name:"tipoIntervento"},{name:"prog"},{name:"codArticolo"},
{name:"tipoArticolo"},{name:"codSede"},{name:"codReparto"},{name:"codStanza"},{name:"codGuasto"},{name:"attivo"},{name:"note"},{name:"nomeUtente"},{name:"idDepositoTs"},{name:"idCausaleTs"},{name:"desStato",convert:function(a,b){return StdEconomato.getDecrStatoRichiesta(b.get("stato"))},depends:["stato"],persist:!1},{name:"clcCodArticolo",convert:function(a,b){StdEconomato.isValidID(b.get("codArticolo"))&&(a=b.get("codArticolo")+"."+StdEconomato.coalesce(b.get("tipoArticolo"),0));return a},depends:["codArticolo",
"tipoArticolo"]},{name:"trasferimentoScorte",convert:function(a,b){return getBoolValue(StdEconomato.isValidID(b.get("idDepositoTs")))},depends:["idDepositoTs"]}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/richiesta/get",api:{read:getUrlGen()+"/ws/richiesta/get",create:getUrlGen()+"/ws/richiesta/insert",update:getUrlGen()+"/ws/richiesta/update",destroy:getUrlGen()+"/ws/richiesta/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.nuovaRichiesta.view.Allegati",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridAllegati",reference:"GridAllegati",overflowX:"hidden",overflowY:"auto",layout:{align:"stretch"},width:170,viewConfig:{loadMask:!1},title:"ALLEGATI",collapsible:!0,collapseDirection:"left",hideHeaders:!0,columns:[{xtype:"actioncolumn",width:20,text:"",items:[{iconCls:"icon-allegato",
isDisabled:function(a,b,c,d,e){return Ext.isEmpty(e.get("fileName"))}}]},{xtype:"gridcolumn",flex:1,dataIndex:"descrizione"}]},{xtype:"splitter",nonDisabilitare:!0},{xtype:"container",border:0,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",itemId:"Form",reference:"Form",autoScroll:!0,trackResetOnLoad:!0,margin:"15 5 5 5",border:0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",hidden:!0,name:"id"},{xtype:"numberfield",hidden:!0,name:"idRichiesta"},{xtype:"datefield",
itemId:"Data",reference:"Data",maxWidth:180,fieldLabel:"DATA",labelWidth:70,labelClsExtra:"cbaLabel",allowBlank:!1,selectOnFocus:!0,name:"data"},{xtype:"textfield",itemId:"TxtDescrizione",reference:"TxtDescrizione",name:"descrizione",fieldLabel:"DESCRIZIONE",maxLength:100,enforceMaxLength:!0,labelClsExtra:"cbaLabel",allowBlank:!1,maxWidth:370,labelWidth:70},{xtype:"displayfield",itemId:"TxtFileName",reference:"TxtFileName",name:"fileName",labelClsExtra:"cbaLabel",maxWidth:370}]},{xtype:"container",
items:[{xtype:"filefield",cls:"cba-stdbutton-25",itemId:"AllegatoUpload",reference:"AllegatoUpload",fieldLabel:"",buttonOnly:!0,name:"f_logoSx",buttonConfig:{xtype:"filebutton",text:traduci("ALLEGA_FILE"),width:100,iconCls:"icon-allegato"},listeners:{afterrender:function(a){a.fileInputEl.set({accept:StdSipcar.getValidExtensions()})}}}]}]},{xtype:"container",itemId:"CntAnteprima",reference:"CntAnteprima",border:0,flex:2,layout:"fit"},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});
this.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.view.AnnullaRichiesta",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,flex:1,bodyPadding:10,layout:{type:"vbox",align:"stretch"},dockedItems:[{xtype:"toolbar",dock:"bottom",height:30,layout:{pack:"center"},items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:"CONFERMA"},{xtype:"tbspacer",width:30},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",
iconCls:"icon-esciGriglia",text:"ANNULLA"}]}],items:[{xtype:"form",itemId:"Form",reference:"Form",layout:{type:"vbox",align:"stretch"},flex:1,border:0,items:[{xtype:"datefield",itemId:"DataAnnullamento",reference:"DataAnnullamento",maxWidth:260,allowBlank:!1,name:"dataAnnullamento",fieldLabel:traduci("DATA"),labelClsExtra:"cbaLabel"},{xtype:"combobox",itemId:"CBUtente",reference:"CBUtente",store:Ext.create("Generali.gestPwdNew.store.CboxUtenti",{asynchronousLoad:!1}),fieldLabel:"UTENTE",displayField:"valore",
queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"},{xtype:"textarea",fieldLabel:"NOTE",itemId:"Note",reference:"Note",name:"note",minWidth:275,flex:1,enforceMaxLength:!0,maxLength:2E3,labelClsExtra:"cbaLabel"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.view.DettaglioArticoli",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"CBAShortcutGrid",itemId:"GridArticoli",reference:"GridArticoli",title:"ARTICOLI",autoScroll:!0,overFlowX:"hidden",overFlowY:"auto",flex:1,border:0,plugins:[Ext.create("RowEditingAutoInsert",{autoCancel:!1,errorSummary:!1,activeOnNewRecordsOnly:!1})],store:Ext.create("GeneraliEC.nuovaRichiesta.store.RichiestaDet"),
columns:{defaults:{variableRowHeight:!0},items:[{xtype:"numbercolumn",dataIndex:"id",hidden:!0},{xtype:"numbercolumn",dataIndex:"idTestata",hidden:!0},{xtype:"gridcolumn",flex:1,text:"DESCRIZIONE",minWidth:200,dataIndex:"codArticolo",sorter:StdEconomato.sortDescrizioneCodice,renderer:function(a,c,d){return d.get("descrizioneCodice")},editor:{xtype:"comboModifica",displayField:"valore",selectOnFocus:!0,allowBlank:!1,queryMode:"local",valueField:"codice",minChars:3,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxArticoliRC"),
listeners:{afterrender:function(b,c){b.cbaConfig.modificaClick=a.controller.gestCatalogoArticoli},change:function(b,c){a.controller.compilaUnitaMisura(b.getSelection())}}}},{xtype:"gridcolumn",text:"UM",width:60,dataIndex:"udm",renderer:function(a,c,d){return d.get("um")},editor:{xtype:"combobox",displayField:"valore",allowBlank:!1,readOnly:!0,queryMode:"local",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxUniMis")}},{xtype:"gridcolumn",text:"GIACENZA",align:"center",
dataIndex:"giacenza",renderer:cell_renderer_prezzo,width:110,editor:{xtype:"displayfield",fieldStyle:"text-align:right !important"}},{xtype:"gridcolumn",text:"QTA_RICHIESTA",dataIndex:"qtaOrdine",width:90,renderer:cell_renderer_prezzo,editor:{xtype:"numberfield",allowBlank:!1,selectOnFocus:!0,decimalPrecision:5}},{xtype:"gridcolumn",text:"QTA_CONSEGNATA",width:90,renderer:cell_renderer_prezzo,dataIndex:"qtaEvasa"},{xtype:"gridcolumn",text:"DIFFERENZA",width:90,renderer:cell_renderer_prezzo,dataIndex:"qtaDaCons"},
{xtype:"gridcolumn",text:"STATO",width:60,dataIndex:"stato",renderer:function(a,c,d,e,g,h,k){return StdEconomato.getDecrStatoDettaglio(d.get("stato"))}},{xtype:"gridcolumn",text:"NOTE",flex:1,dataIndex:"note",minWidth:60,renderer:function(a,c,d,e,g,h,k){c.tdCls="";c.tdAttr='data-qtip=""';return a&&650>k.getWidth()?(c.tdCls="icon-edit16",c.tdAttr='data-qtip="'+Ext.String.htmlEncode(d.get("note"))+'"',""):a}}]},listeners:{resize:function(b,c,d,e,g,h){if(d=b.columns.find(function(a){return"note"===a.dataIndex})){e=
b.getStore();var k=b.getSelectionModel();g=k.getSelection()[0];650>c?"container"!==d.field.getXType()&&d.setEditor({xtype:"container",layout:{type:"hbox",pack:"center",align:"middle"},items:[{xtype:"button",itemId:"btnNote",iconCls:"icon-edit16",width:25,handler:function(b){(b=k.getSelection()[0])&&a.controller.noteDettaglioArt(b)}}]}):"textfield"!==d.field.getXType()&&d.setEditor({xtype:"textfield",maxLength:255,enforceMaxLength:!0,value:g?g.get("note"):""});e&&e.each(function(a){a.commit()})}b.columns.forEach(function(a){a.field._marginWidth=
5;a.field.setWidth(a.getWidth()-a.field._marginWidth)})}},viewConfig:{loadMask:!1,getRowClass:function(a,c,d,e){c=e.classifyRecord(a);if(null==c||""==c.trim())switch(a.get("stato")){case "P":c+="cba-dirty-record";break;case "E":c+="cba-new-record"}"T"==a.get("newRiga")&&(c+=" in_grassetto");return c}},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",
iconCls:"icon-eliminaGriglia",text:"ELIMINA",hidden:!0},{xtype:"button",itemId:"BtnRipristina",reference:"BtnRipristina",iconCls:"icon-eliminaGriglia",text:"RIPRISTINA",hidden:!0},{xtype:"radiogroup",itemId:"Ordinamento",reference:"Ordinamento",labelClsExtra:"cbaLabel",fieldLabel:"ORDINAMENTO",labelWidth:90,defaults:{margin:"auto 5 auto 5"},items:[{boxLabel:"INSERIMENTO",name:"tipo",inputValue:0,cls:"cbaLabel",checked:!0},{boxLabel:"ALFABETICO",name:"tipo",inputValue:1,cls:"cbaLabel"},{boxLabel:"GRUPPO",
name:"tipo",inputValue:2,cls:"cbaLabel"},{boxLabel:"CATEGORIA",name:"tipo",inputValue:3,cls:"cbaLabel"}]},{xtype:"tbfill"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esci",text:"ESCI",handler:function(a){(a=a.up("window"))&&a.close()},hidden:!0}]}]}]});a.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.view.InterventiEffettuati",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"CBAShortcutGrid",itemId:"GridArticoli",reference:"GridArticoli",store:Ext.create("GeneraliEC.nuovaRichiesta.store.InterventiEffettuati",{autoLoad:!1}),autoScroll:!0,overFlowX:"hidden",overFlowY:"auto",flex:1,border:0,columns:{defaults:{variableRowHeight:!0},items:[{xtype:"numbercolumn",dataIndex:"id",
hidden:!0},{xtype:"numbercolumn",dataIndex:"idOrganizzazione",hidden:!0},{xtype:"numbercolumn",dataIndex:"idIntervento",hidden:!0},{xtype:"datecolumn",format:"d/m/Y",text:"DATA_PREVISTA",dataIndex:"dataIntervento",align:"center",width:90},{xtype:"datecolumn",format:"d/m/Y",text:"DATA_EFFETTUAZIONE",dataIndex:"dataEffIntervento",align:"center",width:90},{text:"ORA",columns:[{xtype:"datecolumn",format:"H:i",text:"INIZIO",align:"center",dataIndex:"oraInizio",width:90,editor:{xtype:"timefield24",format:"H:i"}},
{xtype:"datecolumn",format:"H:i",text:"FINE",align:"center",dataIndex:"oraFine",width:90,editor:{xtype:"timefield24",format:"H:i"}}]},{xtype:"gridcolumn",text:"STATO",width:60,dataIndex:"idStato",renderer:function(a,b,c){return c.get("desStato")}},{xtype:"gridcolumn",text:"MANUTENTORE",minWidth:200,flex:1,dataIndex:"idManutentore",renderer:function(a,b,c){return c.get("desManutentore")}},{xtype:"gridcolumn",text:"CAUSA",dataIndex:"idCausaProblemi",renderer:function(a,b,c){return c.get("desCausaProblemi")}},
{xtype:"gridcolumn",text:"NOTE",minWidth:200,flex:1,dataIndex:"note"}]},viewConfig:{loadMask:!1}}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.view.NuovaRichiesta",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"PnlRicerca",reference:"PnlRicerca",hidden:this.cbaConfig.caricamentoEsterno,title:"RICERCA",width:370,border:0,split:!0,collapsible:!0,collapseDirection:"left",layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",itemId:"FormRicerca",reference:"FormRicerca",noModificaDati:!0,border:0,
padding:5,fieldDefaults:{margin:"0 5 5 0"},layout:{type:"vbox",align:"stretch"},items:this.parametriRicerca()},{xtype:"gridpanel",itemId:"GridRisultato",reference:"GridRisultato",store:Ext.create("GeneraliEC.nuovaRichiesta.store.Richiesta"),flex:1,columns:{defaults:{variableRowHeight:!0},items:[{xtype:"datecolumn",format:"d/m/Y",text:"DATA",dataIndex:"dataCreazione",align:"center",width:70},{xtype:"gridcolumn",text:"NUM",dataIndex:"numRif",width:70,renderer:cell_renderer_destra},{xtype:"gridcolumn",
text:"UTENTE",dataIndex:"nomeUtente",flex:1},{xtype:"gridcolumn",text:"STATO",dataIndex:"stato",width:90,renderer:function(a,b,c,d,e,g,h){return StdEconomato.getDecrStatoRichiesta(a)}}]},viewConfig:{loadMask:!1,getRowClass:function(a,b){switch(a.get("stato")){case "P":return"cba-dirty-record";case "E":return"cba-new-record";case "L":return"cba-new-record"}}},dockedItems:[{xtype:"pagingtoolbar",dock:"bottom",itemId:"PTRicerca",reference:"PTRicerca"}]}]},{xtype:"container",border:0,flex:1,layout:{type:"hbox",
align:"stretch"},items:[{xtype:"container",border:0,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",itemId:"PnlPrincipale",reference:"PnlPrincipale",frame:!0,minHeight:180,layout:"fit"},{xtype:"splitter",height:1,nonDisabilitare:!0},{xtype:"tabpanel",border:0,scrollable:!0,activeTab:0,itemId:"TabPaginatore",reference:"TabPaginatore",flex:1,layout:"fit",items:[{xtype:"panel",itemId:"PnlDettaglio",reference:"PnlDettaglio",title:"INTERVENTI_EFFETTUATI",layout:"fit",frame:!0,flex:1},
{xtype:"panel",itemId:"PnlAllegati",reference:"PnlAllegati",title:"ALLEGATI",layout:"fit",frame:!0,flex:1}]}]}]}]});this.callParent(arguments)},parametriRicerca:function(){var a=[],b=[],c={};Ext.apply(c,{xtype:"checkboxgroup",itemId:"StatoRicerca",reference:"StatoRicerca",columns:2,items:[{boxLabel:"PARZ_EVASA",inputValue:"P",cls:"cbaLabel",checked:!0},{boxLabel:"INEVASA",inputValue:"C,D,I",cls:"cbaLabel",checked:!0},{boxLabel:"EVASA",inputValue:"E",cls:"cbaLabel"},{boxLabel:"RIC_ANNULLATA",inputValue:"A",
cls:"cbaLabel"},{boxLabel:"PROPOSTE",inputValue:"R",cls:"cbaLabel"}]});b.push({xtype:"button",cls:"btnLarge",itemId:"BtnCercaRicerca",reference:"BtnCercaRicerca",width:80,iconCls:"icon-ricerca",scale:"large",text:"CERCA"});var d=Ext.create("GeneraliEC.storeGenerali.CboxCdc");3===CBA.moduli.modulo60.tipoRichiesta&&(a.push({xtype:"combobox",itemId:"CBSedeRicerca",reference:"CBSedeRicerca",store:Ext.create("Generali.sediReparti.store.CboxSedi",{asynchronousLoad:!1}),flex:1,labelWidth:70,fieldLabel:"SEDE",
displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"}),Ext.apply(c,{columns:3}),d=Ext.create("Generali.sediReparti.store.CboxReparti",{autoLoad:!0}));a.push({xtype:"combobox",itemId:"CBRepartoRicerca",reference:"CBRepartoRicerca",name:"reparto",store:d,flex:1,labelWidth:70,fieldLabel:"REPARTO",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"});d={};3!==CBA.moduli.modulo60.tipoRichiesta?(a.push({xtype:"combobox",itemId:"CBDepositoRicerca",
reference:"CBDepositoRicerca",name:"deposito",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi",{asynchronousLoad:!1}),flex:1,labelWidth:70,fieldLabel:"DEPOSITO",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"}),c.items.splice(0,0,{boxLabel:"TEMPORANEE",name:"stato",inputValue:"T",cls:"cbaLabel",checked:!0}),b.push({xtype:"button",cls:"btnLarge",itemId:"BtnCopiaRicerca",reference:"BtnCopiaRicerca",margin:"auto auto auto 50",width:80,iconCls:"icon-copia",
scale:"large",text:"COPIA"}),Ext.apply(d,{xtype:"combobox",itemId:"CBArticolo",reference:"CBArticolo",name:"codArticolo",labelWidth:70,flex:1,fieldLabel:"ARTICOLO",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"})):Ext.apply(d,{xtype:"smArticoli",labelWidth:70,flex:1});a.push({xtype:"combobox",itemId:"CBUtenteRicerca",reference:"CBUtenteRicerca",store:Ext.create("Generali.gestPwdNew.store.CboxUtenti",{asynchronousLoad:!1}),flex:1,labelWidth:70,fieldLabel:"UTENTE",
displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"},d,{xtype:"container",layout:"column",items:[{xtype:"datefield",itemId:"DataDalRicerca",reference:"DataDalRicerca",name:"dataDal",fieldLabel:"DATA_DAL",labelWidth:70,width:175,labelClsExtra:"cbaLabel"},{xtype:"datefield",itemId:"DataAlRicerca",reference:"DataAlRicerca",name:"dataAl",fieldLabel:"AL",labelWidth:65,width:170,margin:"0 0 0 5",labelClsExtra:"cbaLabel"}]},{xtype:"container",layout:"column",items:[{xtype:"numberfield",
allowDecimals:!1,itemId:"NumRifDal",reference:"NumRifDal",name:"numRifDal",fieldLabel:"DAL_NUMERO",labelWidth:70,width:175,labelClsExtra:"cbaLabel"},{xtype:"numberfield",allowDecimals:!1,itemId:"NumRifAl",reference:"NumRifAl",name:"numRifAl",fieldLabel:"AL",labelWidth:65,width:170,margin:"0 0 0 5",labelClsExtra:"cbaLabel"}]},{xtype:"fieldset",title:"STATO",layout:"fit",items:c},{xtype:"container",layout:"column",padding:5,fieldDefaults:{margin:"0 5 5 0"},items:b});return a}});
Ext.define("GeneraliEC.nuovaRichiesta.view.Testata",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni"},{xtype:"form",itemId:"Form",reference:"Form",autoScroll:!0,trackResetOnLoad:!0,flex:1,maxWidth:800,margin:"15 5 5 5",border:0,fieldDefaults:{margin:"0 5 5 0"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",hidden:!0,name:"id"},
{xtype:"textfield",hidden:!0,name:"idOrganizzazione"},{xtype:"textfield",hidden:!0,name:"idEsercizio"},{xtype:"textfield",hidden:!0,name:"tipoRichiesta"},{xtype:"textfield",hidden:!0,name:"codUtente"},{xtype:"textfield",hidden:!0,name:"classificazione"},{xtype:"textfield",hidden:!0,name:"stato"},{xtype:"container",layout:"column",itemId:"TxOperatore",reference:"TxOperatore",hidden:!0,items:[{xtype:"displayfield",itemId:"Stato",reference:"Stato",columnWidth:.5,minWidth:275,labelWidth:80,fieldLabel:"STATO",
name:"desStato",labelClsExtra:"cbaLabel",fieldStyle:"font-weight: bold; color:green;",renderer:function(a){a&&(a=a.toUpperCase());return a}},{xtype:"displayfield",columnWidth:.5,minWidth:275,labelWidth:80,fieldLabel:"OPERATORE",fieldStyle:"font-weight: bold;",name:"nomeUtente",labelClsExtra:"cbaLabel"}]},{xtype:"container",layout:"column",items:[{xtype:"displayfield",columnWidth:.5,minWidth:275,labelWidth:80,fieldLabel:"NUMERO",fieldStyle:"font-weight: bold;",name:"numRif",labelClsExtra:"cbaLabel"},
{xtype:"displayfield",columnWidth:.5,minWidth:275,labelWidth:80,fieldLabel:"DATA",name:"dataCreazione",labelClsExtra:"cbaLabel",fieldStyle:"font-weight: bold;",renderer:function(a){a&&(a=FormattaData(a,"d/m/Y H:i"));return a}}]},{xtype:"container",layout:"column",items:[{xtype:"combobox",itemId:"CBPriorita",reference:"CBPriorita",store:Ext.create("GeneraliEC.priorita.store.PrioritaCbox",{autoLoad:!1}),columnWidth:.5,minWidth:275,labelWidth:80,fieldLabel:"PRIORITA",name:"priorita",displayField:"valore",
queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item"><span>{[this.renderRec(values)]}</span></div>',"</tpl>",{renderRec:function(a){var b=a.extra;a=a.valore;if(null!==b)for(b=+b.split(",")[1];0<b;)a+='<img style="float: right; width:16px;" src="/cba/generali/images/16/star.png"/>',b--;return a}})},{xtype:"combobox",itemId:"CBDeposito",reference:"CBDeposito",allowBlank:!1,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi"),
name:"idDeposito",columnWidth:.5,minWidth:275,labelWidth:80,fieldLabel:"DEPOSITO",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"}]},{xtype:"container",layout:"column",itemId:"TrasferimentoScorte",reference:"TrasferimentoScorte",items:[{xtype:"checkboxfield",minWidth:50,columnWidth:.2,itemId:"ChTrasferimScorte",reference:"ChTrasferimScorte",boxLabel:"TRASFERIM_SCORTE",cls:"cbaLabel",name:"trasferimentoScorte",inputValue:"T",uncheckedValue:"F"},{xtype:"combobox",
minWidth:200,columnWidth:.4,itemId:"CBDepositoTs",reference:"CBDepositoTs",name:"idDepositoTs",labelWidth:80,fieldLabel:"Dep. Carico",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",disabled:!0},{xtype:"combobox",itemId:"CBCausaleTs",reference:"CBCausaleTs",columnWidth:.4,minwidth:200,store:Ext.create("GeneraliEC.causali.store.CboxCausali",{autoLoad:!1}),name:"idCausaleTs",fieldLabel:"CAUSALE",labelClsExtra:"cbaLabel",allowBlank:!0,displayField:"valore",queryMode:"local",
valueField:"codice",minChars:3,disabled:!0}]},{xtype:"container",layout:"column",items:[{xtype:"combobox",itemId:"CBReparto",reference:"CBReparto",allowBlank:!1,store:Ext.create("GeneraliEC.storeGenerali.CboxCdc"),name:"idCda",columnWidth:.5,minWidth:275,labelWidth:80,fieldLabel:"REP_RICHIEDENTE",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"},{xtype:"combobox",itemId:"CBCarica",reference:"CBCarica",store:Ext.create("GeneraliEC.nuovaRichiesta.store.CboxModelloRichiesta"),
name:"provvisorio",columnWidth:.5,minWidth:275,labelWidth:80,fieldLabel:"CARICA",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",listeners:{afterrender:function(a){a.setEmptyText(traduci("RICHIESTE_STANDARD"))}},triggers:{change:{cls:"icon-ok",tooltip:traduci("CARICA_RICHIESTA_STANDARD"),hidden:!0,handler:function(b){if(!Ext.isEmpty(b.getValue())&&b.isValid()){b=a.controller;var c=b.getCBCarica().getValue();b.cambioCarica(c)}}}}}]},{xtype:"container",layout:"column",
items:[{xtype:"textarea",fieldLabel:"NOTE",itemId:"Note",reference:"Note",name:"note",columnWidth:1,minWidth:275,height:50,labelWidth:80,enforceMaxLength:!0,maxLength:2E3,labelClsExtra:"cbaLabel"}]}]}]});a.callParent(arguments)}});
Ext.define("GeneraliEC.nuovaRichiesta.view.TestataMan",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni"},{xtype:"form",itemId:"Form",reference:"Form",autoScroll:!0,trackResetOnLoad:!0,flex:1,maxWidth:700,margin:"15 5 5 5",border:0,fieldDefaults:{margin:"0 5 5 0"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",hidden:!0,name:"id"},{xtype:"textfield",
hidden:!0,name:"idOrganizzazione"},{xtype:"textfield",hidden:!0,name:"idEsercizio"},{xtype:"textfield",hidden:!0,name:"tipoRichiesta"},{xtype:"textfield",hidden:!0,name:"codUtente"},{xtype:"textfield",hidden:!0,name:"classificazione"},{xtype:"textfield",hidden:!0,name:"stato"},{xtype:"container",layout:"column",itemId:"TxOperatore",reference:"TxOperatore",hidden:!0,items:[{xtype:"displayfield",itemId:"Stato",reference:"Stato",columnWidth:.5,minWidth:275,labelWidth:70,fieldLabel:"STATO",name:"desStato",
labelClsExtra:"cbaLabel",fieldStyle:"font-weight: bold; color:green;",renderer:function(a){a&&(a=a.toUpperCase());return a}},{xtype:"displayfield",columnWidth:.5,minWidth:275,labelWidth:70,fieldLabel:"OPERATORE",fieldStyle:"font-weight: bold;",name:"nomeUtente",labelClsExtra:"cbaLabel"}]},{xtype:"container",layout:"column",items:[{xtype:"displayfield",columnWidth:.5,minWidth:275,labelWidth:70,fieldLabel:"NUMERO",fieldStyle:"font-weight: bold;",name:"numRif",labelClsExtra:"cbaLabel"},{xtype:"displayfield",
columnWidth:.5,minWidth:275,labelWidth:70,fieldLabel:"DATA",name:"dataCreazione",labelClsExtra:"cbaLabel",fieldStyle:"font-weight: bold;",renderer:function(a){a&&(a=FormattaData(a,"d/m/Y H:i"));return a}}]},{xtype:"container",layout:"column",items:[{xtype:"container",minWidth:250,columnWidth:.5,layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",itemId:"CBPriorita",reference:"CBPriorita",store:Ext.create("GeneraliEC.priorita.store.PrioritaCbox",{autoLoad:!1}),minWidth:275,labelWidth:70,
fieldLabel:"PRIORITA",name:"priorita",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item"><span>{[this.renderRec(values)]}</span></div>',"</tpl>",{renderRec:function(a){var b=a.extra;a=a.valore;if(null!==b)for(b=+b.split(",")[1];0<b;)a+='<img style="float: right; width:24px" src="/cba/generali/images/20/star.png"/>',b--;return a}})},{xtype:"combobox",itemId:"CBTipo",reference:"CBTipo",minWidth:275,
labelWidth:70,fieldLabel:"TIPO",allowBlank:!1,name:"tipoIntervento",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",store:Ext.create("GeneraliEC.tabelleBase.store.CboxTipoIntervento",{autoLoad:!0})},{xtype:"combobox",itemId:"CBUfficio",reference:"CBUfficio",store:Ext.create("GeneraliEC.tabelleBase.store.ManutentoreCbox",{autoLoad:!1}),minWidth:275,labelWidth:70,fieldLabel:"UFFICIO",name:"codUfficio",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"},
{xtype:"combobox",itemId:"CBCdc",reference:"CBCdc",allowBlank:!1,store:Ext.create("GeneraliEC.storeGenerali.CboxCdc",{autoLoad:!1}),name:"idCda",minWidth:275,labelWidth:70,fieldLabel:"REP_RICHIEDENTE",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"}]},{xtype:"container",minWidth:250,columnWidth:.5,layout:{type:"vbox",align:"stretch"},items:[{xtype:"smArticoli",name:"clcCodArticolo",labelWidth:70,minChars:3},{xtype:"combobox",itemId:"CBSede",reference:"CBSede",
minWidth:275,labelWidth:70,fieldLabel:"SEDE",name:"codSede",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",store:Ext.create("Generali.sediReparti.store.CboxSedi",{autoLoad:!0}),listConfig:{tpl:'<tpl for="."><tpl if="extra == \'T\'"><div class="x-boundlist-item non_attivi">{valore}</div></tpl><tpl if="extra != \'T\'"><div class="x-boundlist-item">{valore}</div></tpl></tpl>'},listeners:{afterrender:function(a){a.doAutoSelect=function(){return StdEconomato.doAutoSelect(a)}}}},
{xtype:"combobox",itemId:"CBReparto",reference:"CBReparto",minWidth:275,labelWidth:70,fieldLabel:"REPARTO",name:"codReparto",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",store:Ext.create("Generali.sediReparti.store.CboxReparti",{autoLoad:!0}),listConfig:{tpl:'<tpl for="."><tpl if="extra == \'T\'"><div class="x-boundlist-item non_attivi">{valore}</div></tpl><tpl if="extra != \'T\'"><div class="x-boundlist-item">{valore}</div></tpl></tpl>'},listeners:{afterrender:function(a){a.doAutoSelect=
function(){return StdEconomato.doAutoSelect(a)}}}},{xtype:"combobox",itemId:"CBStanza",reference:"CBStanza",minWidth:275,labelWidth:70,fieldLabel:"STANZA",name:"codStanza",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",store:Ext.create("Generali.sediReparti.store.CboxStanze",{autoLoad:!0}),listConfig:{tpl:'<tpl for="."><tpl if="extra == \'T\'"><div class="x-boundlist-item non_attivi">{valore}</div></tpl><tpl if="extra != \'T\'"><div class="x-boundlist-item">{valore}</div></tpl></tpl>'},
listeners:{afterrender:function(a){a.doAutoSelect=function(){return StdEconomato.doAutoSelect(a)}}}}]}]},{xtype:"combobox",columnWidth:1,itemId:"CBClassificazione",reference:"CBClassificazione",store:Ext.create("GeneraliEC.tabelleBase.store.ClassificazioneCbox",{autoLoad:!0}),name:"idClassificazione",fieldLabel:"Classific.",displayField:"valore",queryMode:"local",valueField:"codice",minWidth:250,labelWidth:70,labelClsExtra:"cbaLabel"},{id:"RPTXDesc",xtype:"textarea",labelWidth:70,fieldLabel:"DESCRIZIONE",
itemId:"Descrizione",reference:"Descrizione",name:"descrizione",minWidth:250,height:50,enforceMaxLength:!0,allowBlank:!1,maxLength:2E3,labelClsExtra:"cbaLabel"}]}]});this.callParent(arguments)}});Ext.define("GeneraliEC.personalizzazioni.controller.FARPersonalizza",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.personalizzazioni.controller.MAGPersonalizza",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.personalizzazioni.controller.MNPersonalizza",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.personalizzazioni.controller.OFPersonalizza",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.personalizzazioni.controller.RCPersonalizza",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.personalizzazioni.store.FARPersonalizza",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",url:"/cba/eco/far/ws/prszn/conf/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},
a)])}});
Ext.define("GeneraliEC.personalizzazioni.store.MAGPersonalizza",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",url:"/cba/eco/mag/ws/prszn/conf/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},
a)])}});
Ext.define("GeneraliEC.personalizzazioni.store.MNPersonalizza",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",url:"/cba/eco/mn/ws/prszn/conf/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},a)])}});
Ext.define("GeneraliEC.personalizzazioni.store.OFPersonalizza",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",url:"/cba/eco/of/ws/prszn/conf/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},
a)])}});
Ext.define("GeneraliEC.personalizzazioni.store.RCPersonalizza",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",url:"/cba/eco/rc/ws/prszn/conf/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},a)])}});
Ext.define("GeneraliEC.personalizzazioni.view.FARPersonalizza",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"PERSONALIZZAZIONI"},{xtype:"panel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"}}]}],listeners:{beforerender:{fn:this.onContainerBeforeRender,scope:this}}});this.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.personalizzazioni.store.FARPersonalizza");ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,
b){b.data.text=traduci(b.data.text)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,e,m,n){a=c.queryById("content");a.removeAll();d=b.data;null!=d.panelType&&""!=d.panelType&&(d.forceOpen=!0);if(d.leaf||d.forceOpen){var g={};b.get("params")&&(b=b.get("params").split(","),Ext.each(b,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));g.permesso=c.cbaConfig.permesso;
g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var h;"GEORGANIZZAZIONI"==d.panelType?h=Ext.create("Generali.organizzazioni.view.Organizzazioni",{flex:1}):"FARPERS"==d.panelType?h=Ext.create("MF.personalizzazioni.view.PannelloPerson",{cbaConfig:g,flex:1}):"FARDOCPERS"==d.panelType?h=Ext.create("Generali.docPerson.view.DocPerson",{cbaConfig:g,flex:1}):"PERS_REPORT"==d.panelType?(Ext.apply(g,{idOrganizzazione:getIdOrg()}),
h=Ext.create("personStampe.view.Container",{cbaConfig:g,flex:1})):"FASCHEDULER"==d.panelType&&(h=Ext.create("Generali.gestioneScheduler.view.Scheduler",{cbaConfig:g,flex:1}));a.add(h)}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.personalizzazioni.view.MAGPersonalizza",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"PERSONALIZZAZIONI"},{xtype:"panel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"}}]}],listeners:{beforerender:{fn:this.onContainerBeforeRender,scope:this}}});this.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.personalizzazioni.store.MAGPersonalizza");ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,
b){b.data.text=traduci(b.data.text)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,e,m,n){a=c.queryById("content");a.removeAll();d=b.data;null!=d.panelType&&""!=d.panelType&&(d.forceOpen=!0);if(d.leaf||d.forceOpen){var g={};b.get("params")&&(b=b.get("params").split(","),Ext.each(b,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));g.permesso=c.cbaConfig.permesso;
g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var h;"GEORGANIZZAZIONI"==d.panelType?h=Ext.create("Generali.organizzazioni.view.Organizzazioni",{flex:1}):"MAGPERS"==d.panelType?h=Ext.create("MF.personalizzazioni.view.PannelloPerson",{cbaConfig:g,flex:1}):"MAGDOCPERS"==d.panelType?h=Ext.create("Generali.docPerson.view.DocPerson",{cbaConfig:g,flex:1}):"PERS_REPORT"==d.panelType?(Ext.apply(g,{idOrganizzazione:getIdOrg()}),
h=Ext.create("personStampe.view.Container",{cbaConfig:g,flex:1})):"MASCHEDULER"==d.panelType&&(h=Ext.create("Generali.gestioneScheduler.view.Scheduler",{cbaConfig:g,flex:1}));a.add(h)}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.personalizzazioni.view.MNPersonalizza",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"PERSONALIZZAZIONI"},{xtype:"panel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"}}]}],listeners:{beforerender:{fn:this.onContainerBeforeRender,scope:this}}});this.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.personalizzazioni.store.MNPersonalizza");ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,
b){b.data.text=traduci(b.data.text)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,e,m,n){a=c.queryById("content");a.removeAll();d=b.data;null!=d.panelType&&""!=d.panelType&&(d.forceOpen=!0);if(d.leaf||d.forceOpen){var g={};b.get("params")&&(b=b.get("params").split(","),Ext.each(b,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));g.permesso=c.cbaConfig.permesso;
g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var h;"GEORGANIZZAZIONI"==d.panelType?h=Ext.create("Generali.organizzazioni.view.Organizzazioni",{flex:1}):"MNPERS"==d.panelType?h=Ext.create("MN.personalizzazioni.view.PannelloPerson",{cbaConfig:g,flex:1}):"MNDOCPERS"==d.panelType?h=Ext.create("Generali.docPerson.view.DocPerson",{cbaConfig:g,flex:1}):"MNSCHEDULER"==d.panelType?h=Ext.create("Generali.gestioneScheduler.view.Scheduler",
{cbaConfig:g,flex:1}):"MNAPPINTERVENTI"==d.panelType?h=Ext.create("MN.interventiApp.view.UtentiApp",{cbaConfig:g,flex:1}):"MNFORMIO"==d.panelType&&(h=Ext.create("MN.formIO.view.FormIO",{cbaConfig:g,flex:1}));a.add(h)}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.personalizzazioni.view.OFPersonalizza",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"PERSONALIZZAZIONI"},{xtype:"panel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"}}]}],listeners:{beforerender:{fn:this.onContainerBeforeRender,scope:this}}});this.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.personalizzazioni.store.OFPersonalizza");ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,
b){b.data.text=traduci(b.data.text)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,e,m,n){a=c.queryById("content");a.removeAll();d=b.data;null!=d.panelType&&""!=d.panelType&&(d.forceOpen=!0);if(d.leaf||d.forceOpen){var g={};b.get("params")&&(b=b.get("params").split(","),Ext.each(b,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));g.permesso=c.cbaConfig.permesso;
g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var h;"GEORGANIZZAZIONI"==d.panelType?h=Ext.create("Generali.organizzazioni.view.Organizzazioni",{flex:1}):"OFPERS"==d.panelType?h=Ext.create("OF.personalizzazioni.view.PannelloPerson",{cbaConfig:g,flex:1}):"OFMODORD"==d.panelType?h=Ext.create("OF.modelliOrdine.view.ModelliOrdine",{cbaConfig:g,flex:1}):"OFDOCPERS"==d.panelType?h=Ext.create("Generali.docPerson.view.DocPerson",
{cbaConfig:g,flex:1}):"PERS_REPORT"==d.panelType?(Ext.apply(g,{idOrganizzazione:getIdOrg()}),h=Ext.create("personStampe.view.Container",{cbaConfig:g,flex:1})):"OFSCHEDULER"==d.panelType&&(h=Ext.create("Generali.gestioneScheduler.view.Scheduler",{cbaConfig:g,flex:1}));a.add(h)}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.personalizzazioni.view.RCPersonalizza",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"PERSONALIZZAZIONI"},{xtype:"panel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"}}]}],listeners:{beforerender:{fn:this.onContainerBeforeRender,scope:this}}});this.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.personalizzazioni.store.RCPersonalizza");ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,
b){b.data.text=traduci(b.data.text)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,e,m,n){a=c.queryById("content");a.removeAll();d=b.data;null!=d.panelType&&""!=d.panelType&&(d.forceOpen=!0);if(d.leaf||d.forceOpen){var g={};b.get("params")&&(b=b.get("params").split(","),Ext.each(b,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));g.permesso=c.cbaConfig.permesso;
g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var h;"GEORGANIZZAZIONI"==d.panelType?h=Ext.create("Generali.organizzazioni.view.Organizzazioni",{flex:1}):"RCPERS"==d.panelType?h=Ext.create("RC.personalizzazioni.view.PannelloPerson",{cbaConfig:g,flex:1}):"RCPRIORITA"==d.panelType?h=Ext.create("GeneraliEC.priorita.view.Priorita",{cbaConfig:g,flex:1}):"RCSCHEDULER"==d.panelType&&(h=Ext.create("Generali.gestioneScheduler.view.Scheduler",
{cbaConfig:g,flex:1}));a.add(h)}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.principiAttivi.controller.PrincipiAttivi",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"GridPriAtt",selector:a.selContainer+"#GridPriAtt"},{ref:"BtnNuovo",selector:a.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:a.selContainer+"#BtnElimina"},{ref:"TxtCerca",selector:a.selContainer+"#TxtCerca"}]);a.control(a.selContainer+"#GridPriAtt",{beforeedit:a.beforeeditGridPriAtt,
edit:a.editGridPriAtt,canceledit:a.canceleditGridPriAtt,validateedit:a.validateeditGridPriAtt});a.control(a.selContainer+"#BtnNuovo",{click:a.clickBtnNuovo});a.control(a.selContainer+"#BtnElimina",{click:a.clickBtnElimina});a.control(a.selContainer+"#TxtCerca",{change:Ext.Function.createBuffered(function(b){var c=a.getGridPriAtt(),d=c.getStore();d.clearFilter();d.filter(function(a){var c=!1;(a=a.get("descrizione"))&&0<=a.toUpperCase().indexOf(b.getValue().toUpperCase())&&(c=!0);return c});b.focus();
0<d.getCount()&&c.getSelectionModel().select(0);b.focus()},100,a)})},clickBtnNuovo:function(a){controller_nuovoRecordGrid({idOrganizzazione:this.cbaConfig.idOrganizzazione,id:null},this.getGridPriAtt())},clickBtnElimina:function(a){var b=this;a=b.getGridPriAtt();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},beforeeditGridPriAtt:function(a,b,c){return!1},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);
this.getBtnElimina().setDisabled(!a)},editGridPriAtt:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridPriAtt:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridPriAtt:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridPriAtt(),c=b.getStore();
this.getTxtCerca().setValue(Ext.emptyString);c.load({params:{idOrganizzazione:this.cbaConfig.idOrganizzazione,descrizione:""},callback:function(d,e,g){g?(d=null,a&&(d=trovaRecord(c,"id",a)),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d?[d]:0)):msgShowError("",e.getError())}})},svuotaStore:function(){svuotaStore(this.getGridPriAtt().getStore())},onLaunch:function(){this.getGridPriAtt().controller=this;this.aggiornaStore()}});
Ext.define("GeneraliEC.principiAttivi.store.PrincipiAttivi",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"descrizione"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/principiAttivi/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/principiAttivi/list",create:getUrlGen()+"/ws/principiAttivi/insert",update:getUrlGen()+"/ws/principiAttivi/update",destroy:getUrlGen()+"/ws/principiAttivi/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.principiAttivi.view.PrincipiAttivi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridPriAtt",reference:"GridPriAtt",store:Ext.create("GeneraliEC.principiAttivi.store.PrincipiAttivi"),columns:[{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"descrizione",flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}}],viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",
{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo",hidden:!0},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina",hidden:!0},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",width:200,fieldLabel:"",emptyText:"CERCA"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.priorita.controller.Priorita",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"GridPriorita",selector:this.selContainer+"#GridPriorita"},{ref:"Rating",selector:this.selContainer+"#Rating"}]);this.control(this.selContainer+"#GridPriorita",{select:this.selectGridPriorita});
this.control(this.selContainer+"#Rating",{change:this.changeRating})},changeRating:function(a,b){this.getForm().getForm().findField("priorita").setValue(StdEconomato.isValidID(b)?b:null)},selectGridPriorita:function(a,b){var c=this.getRating(),d=this.getForm();c.cancellaStar();clearForm(d);d.loadRecord(b);c.setValue(b.get("priorita"))},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm();
this.getRating();var c=b.getForm().getFieldValues();Ext.apply(c,{tipo:this.tipoPriorita,idOrganizzazione:this.cbaConfig.idOrganizzazione,proponiDefault:getBoolValue(c.proponiDefault)});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getRating(),c=a.getForm();c.permesso=a.cbaConfig.permesso;c.boxBottoni=a.getBoxBottoni();c.store=a.storeForm;c.controller=a;var d=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){var b=c.getForm().findField("id").getValue();a.aggiornaStore(StdEconomato.isValidID(b)?b:null)},nuovo_callback:function(){b.cancellaStar();controller_nuovoRecord(c)},elimina_callback:function(){var b=c.getForm().findField("id").getValue();Ext.isEmpty(b)||controller_eliminaRecord(c.store,{id:b},function(){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){a.cbaConfig.callbackRiapriStore&&
a.cbaConfig.callbackRiapriStore();a.getForm().up("window").close()}}});inserisciBottoni(c.boxBottoni,d);a.cbaConfig.mostraEsci||c.boxBottoni.queryById("btnEsci").hide();if("L"!=c.permesso)c.getForm().on("dirtychange",function(a,b){controller_abilitaBottoni(c)})},aggiornaStore:function(a){var b=this,c={},d=b.getForm(),e=b.getRating(),g=b.getGridPriorita();Ext.apply(c,{tipo:b.tipoPriorita,idOrganizzazione:b.cbaConfig.idOrganizzazione});e.cancellaStar();b.storeForm.load({params:c,callback:function(c,
e,l){if(l)if(Ext.isEmpty(c))clearForm(d);else{var h;a&&(h=trovaRecord(b.storeForm,"id",a));g.getSelectionModel().deselectAll();g.getSelectionModel().select(h?[h]:0)}else msgShowError("",e.getError())}})},onLaunch:function(){var a=this.getGridPriorita();this.storeForm=Ext.create("GeneraliEC.priorita.store.Priorita",{autoLoad:!1});this.tipoPriorita;switch(CBA.moduli.moduloAttivo){case 60:this.tipoPriorita="R"}a.bindStore(this.storeForm);this.gestioneForm();this.aggiornaStore()},destroy:function(){delete this.storeForm;
this.callParent()}});
Ext.define("GeneraliEC.priorita.store.Priorita",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"descrizione"},{name:"priorita"},{name:"proponiDefault"},{name:"tipo"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getPathGeneralModulo()+"priorita/list",api:{read:getPathGeneralModulo()+"priorita/list",create:getPathGeneralModulo()+"priorita/insert",update:getPathGeneralModulo()+"priorita/update",destroy:getPathGeneralModulo()+"priorita/delete"}}},
a)])},autoDestroy:!0});Ext.define("GeneraliEC.priorita.store.PrioritaCbox",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getPathGeneralModulo()+"priorita/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.priorita.view.Priorita",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"gridpanel",itemId:"GridPriorita",reference:"GridPriorita",width:220,columns:{defaults:{variableRowHeight:!0},items:[{xtype:"gridcolumn",dataIndex:"descrizione",text:"DESCRIZIONE",flex:1}]},viewConfig:{trackOver:!1,loadMask:!1,preserveScrollOnRefresh:!1}},{xtype:"form",flex:1,itemId:"Form",reference:"Form",autoScroll:!0,
flex:1,margin:"15 5 5 5",border:0,fieldDefaults:{margin:"0 5 5 0"},trackResetOnLoad:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"textfield",name:"tipo",hidden:!0},{xtype:"textfield",fieldLabel:"DESCRIZIONE",name:"descrizione",labelClsExtra:"cbaLabel",allowBlank:!1,maxLength:100,enforceMaxLength:!0},{xtype:"container",layout:"column",items:[{xtype:"label",text:"TAB_PRIORITA",width:100,cls:"cbaLabel"},{xtype:"rating",itemId:"Rating",reference:"Rating",
formBind:!0,listeners:{afterrender:function(a,b){var c=this;a.clickStar=function(){return c.fireEvent("change",a,a.getValue())}}}},{xtype:"numberfield",name:"priorita",hidden:!0}]},{xtype:"checkboxfield",itemId:"ChBProponi",reference:"ChBProponi",fieldLabel:"",boxLabel:"PROPONI_IN_AUTOMATICO",inputValue:"T",uncheckedValue:"F",name:"proponiDefault",cls:"cbaLabel"}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.stampe.controller.ControllerArchiviazione",{extend:"Generali.standard.stampe.Controller",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnArchiviaDocumentale",selector:this.selContainer+"#BtnArchiviaDocumentale"}]);this.control(this.selContainer+"#BtnArchiviaDocumentale",{afterrender:this.afterrenderBtnArchiviaDocumentale,click:this.clickBtnArchiviaDocumentale})},afterrenderBtnArchiviaDocumentale:function(a,b){a.setVisible(StdEconomato.isValidID(this.cbaConfig.idStampaDocumentale))},
clickBtnArchiviaDocumentale:function(a){var b=this;Messaggio("ARCHIVIAZIONE_DOCUMENTALE","ARCHIVIAZIONE_RICHIESTA_CONFERMA","YESNO","QUESTION",null,function(){b.doPrint(a,"UPL_DOC")})}});
Ext.define("GeneraliEC.stampe.controller.ECOStampaArticoli",{extend:"Generali.standard.stampe.Controller",init:function(){this.selContainer="#"+this.containerId+" ";this.cbaConfig.configBtnStampa&&(Ext.applyIf(this.parametriStampa,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(this.parametriStampa.params,this.cbaConfig.configBtnStampa.params));this.callParent(arguments);this.addRef([{ref:"TabPrincipale",selector:this.selContainer+"#TabPrincipale"},{ref:"CBTipoStampa",
selector:this.selContainer+"#CBTipoStampa"},{ref:"CBRaggruppamento",selector:this.selContainer+"#CBRaggruppamento"},{ref:"PageDepositi",selector:this.selContainer+"#PageDepositi"},{ref:"PageArticoli",selector:this.selContainer+"#PageArticoli"},{ref:"BtnAvanti",selector:this.selContainer+"#BtnAvanti"},{ref:"BtnIndietro",selector:this.selContainer+"#BtnIndietro"},{ref:"MCMagazzinoFarmacia",selector:this.selContainer+"#MCMagazzinoFarmacia"},{ref:"PageAnteprima",selector:this.selContainer+"#PageAnteprima"},
{ref:"CbxAttivo",selector:this.selContainer+"#CbxAttivo"},{ref:"CbxNonAttivo",selector:this.selContainer+"#CbxNonAttivo"},{ref:"CbxIsLasa",selector:this.selContainer+"#CbxIsLasa"},{ref:"CbGruppo",selector:this.selContainer+"#CbGruppo"},{ref:"CbCategoria",selector:this.selContainer+"#CbCategoria"},{ref:"CbFornitore",selector:this.selContainer+"#CbFornitore"},{ref:"CmcMagazzino",selector:this.selContainer+"#CmcMagazzino"},{ref:"CmcFarmacia",selector:this.selContainer+"#CmcFarmacia"}]);this.control(this.selContainer+
"#TabPrincipale",{tabchange:this.tabchangeTabPaginatore});this.control(this.selContainer+"#CbGruppo",{change:this.changeCbGruppo});this.control(this.selContainer+"#CmcFarmacia",{change:this.changeCmcFarmacia})},changeCmcFarmacia:function(){this.getCbxIsLasa().setVisible(1==this.getCmcFarmacia().getValue())},changeCbGruppo:function(a,b){b?this.storeCategorie.load({params:{idGruppo:b}}):(svuotaStore(this.storeCategorie),this.getCbCategoria().setValue(null))},tabchangeTabPaginatore:function(a,b,c,d){"PageDepositi"!==
b.getItemId()&&b.getItemId()},stampa:function(){var a=this.cbaConfig,b=newIdElab(),c={};a.stampaDiretta||(Ext.apply(c,{idOrganizzazione:this.idOrganizzazione,tipoStampa:this.getCBTipoStampa().getValue(),raggruppamento:this.getCBRaggruppamento().getValue(),magazzino:this.getCmcMagazzino().getValue()?"T":"F",farmacia:this.getCmcFarmacia().getValue()?"T":"F",attivo:this.getCbxAttivo().getValue()?"T":"F",nonAttivo:this.getCbxNonAttivo().getValue()?"T":"F",isLasa:this.getCbxIsLasa().getValue()?"T":"F",
idAvanzamentoElaborazione:b}),this.getCbGruppo().getValue()&&Ext.apply(c,{idGruppo:this.getCbGruppo().getValue()}),this.getCbCategoria().getValue()&&Ext.apply(c,{idCategoria:this.getCbCategoria().getValue()}),this.getCbFornitore().getValue()&&Ext.apply(c,{idCliFor:this.getCbFornitore().getValue()}));b=this.parametriStampa={url:this.cbaConfig.url,jsonData:a.jsonData,titolo:a.titolo,renderTo:this.getPageAnteprima(),winElaborazione:a.winElaborazione,params:{reportId:a.id}};Ext.apply(b.params,c);a.configBtnStampa&&
(Ext.applyIf(b,a.configBtnStampa),a.configBtnStampa.params&&Ext.applyIf(b.params,a.configBtnStampa.params))},selezioneDatiEsportazione:function(a){var b=this;return Ext.create("Ext.panel.Panel",{border:0,autoScroll:!0,flex:1,bodyPadding:10,layout:{align:"stretch",type:"hbox"},dockedItems:[{xtype:"toolbar",dock:"bottom",height:30,layout:{pack:"center"},items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:traduci("CONFERMA"),handler:function(b,d){var c=b.up("panel").query("checkboxgroup")[0];
if(c){for(var g={},c=$jscomp.makeIterator(c.getRefItems()),h=c.next();!h.done;h=c.next()){var h=h.value,k={};Ext.apply(g,(k[h.name]=getBoolValue(h.getValue()),k))}a&&a(g)}b.up("window").close()}},{xtype:"tbspacer",width:30},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-esciGriglia",text:traduci("ANNULLA"),handler:function(a,b){a.up("window").close()}}]}],items:[{xtype:"checkboxgroup",columns:3,vertical:!0,defaults:{width:200},items:function(){var a=[{boxLabel:traduci("DETTAGLIO_ARTICOLO"),
name:"visualizzaDettagli",cls:"cbaLabel",checked:!0},{boxLabel:traduci("FORMULA"),name:"visualizzaFormula",cls:"cbaLabel",checked:!0},{boxLabel:traduci("LISTINO"),name:"visualizzaListino",cls:"cbaLabel",checked:!0},{boxLabel:traduci("CONTABILITA"),name:"visualizzaConto",cls:"cbaLabel",checked:!0},{boxLabel:traduci("UBICAZIONE"),name:"visualizzaUbicazione",cls:"cbaLabel",checked:!0}];b.getCmcFarmacia().getValue()&&a.push({boxLabel:traduci("CARATTERISTICHE_FARMACO"),name:"visualizzaCaratteristiche",
cls:"cbaLabel",checked:!0});return a}()}]})},doPrint:function(a,b,c){var d=this;(void 0===c?0:c)?d.callParent([a,b]):(d.stampa(b),["UPL_DOC","PDF"].includes(b.toUpperCase())?d.callParent([a,b]):Ext.create("winCBA",{name:d.selezioneDatiEsportazione(function(c){Ext.apply(d.parametriStampa.params,c);d.doPrint(a,b,!0)}),titolo:"PARAMETRI_STAMPA",closable:!0}).show())},afterLoadPerson:function(a){},gestMultipleChoice:function(a){a.onAfter({afterrender:function(a,c){var b=a.query("checkbox");a.values={};
for(var e=$jscomp.makeIterator(b),g=e.next();!g.done;g=e.next()){var g=g.value,h={};Ext.apply(a.values,(h[g.name]=g.getValue(),h));g.onAfter("change",function(c,d,e,g){d={};c=a.values;e=$jscomp.makeIterator(b);for(g=e.next();!g.done;g=e.next()){g=g.value;var h={};Ext.apply(d,(h[g.name]=g.getValue(),h))}a.values=d;a.fireEvent("change",a,d,c)})}a.getValue=function(){return this.values}}})},onLaunch:function(){var a=this.getTabPrincipale();this.idOrganizzazione=getIdOrg();this.gestMultipleChoice(this.getMCMagazzinoFarmacia());
this.getCbGruppo().getStore().getProxy().extraParams={idOrganizzazione:this.idOrganizzazione};this.getCbFornitore().getStore().getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,attivo:"T",tipo:"F",limit:0};this.storeCategorie=this.getCbCategoria().getStore();this.storeCategorie.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione};this.cbaConfig.pageParametri?a.items.get("PageParametri").tab.show():a.remove(this.getPageParametri());var b=this.getTabPrincipale().items.getCount();
this.getBtnAvanti().setVisible(2<b);this.getBtnIndietro().setVisible(2<b);if(1==b||this.cbaConfig.eseguiStampa)a=a.down("#BtnStampa"),this.doPrint(a);this.getCmcMagazzino().setValue(!0);this.getCmcFarmacia().setValue(!0);this.getCbxIsLasa().setVisible(!1);this.getCbxIsLasa().setValue(!1);this.isMagazzino()&&(this.getCmcFarmacia().setValue(!1),this.getCmcMagazzino().readOnly=!0,this.getCmcFarmacia().readOnly=!0);this.isFarmacia()&&(this.getCmcMagazzino().setValue(!1),this.getCmcMagazzino().readOnly=
!0,this.getCmcFarmacia().readOnly=!0,this.getCbxIsLasa().setVisible(!0))},isMagazzino:function(){return 58==CBA.moduli.moduloAttivo},isFarmacia:function(){return 62==CBA.moduli.moduloAttivo},destroy:function(){this.callParent();eliminaStore(this.storeCategorie)}});
Ext.define("GeneraliEC.stampe.controller.ECOStampaListini",{extend:"Generali.standard.stampe.Controller",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.cbaConfig.configBtnStampa&&(Ext.applyIf(a.parametriStampa,a.cbaConfig.configBtnStampa),a.cbaConfig.configBtnStampa.params&&Ext.applyIf(a.parametriStampa.params,a.cbaConfig.configBtnStampa.params));a.callParent(arguments);a.addRef([{ref:"TabPrincipale",selector:a.selContainer+"#TabPrincipale"},{ref:"PageParametri",selector:a.selContainer+
"#PageParametri"},{ref:"PageAnteprima",selector:a.selContainer+"#PageAnteprima"},{ref:"BtnAvanti",selector:a.selContainer+"#BtnAvanti"},{ref:"BtnIndietro",selector:a.selContainer+"#BtnIndietro"},{ref:"Form",selector:a.selContainer+"#Form"},{ref:"MCMagazzinoFarmacia",selector:a.selContainer+"#MCMagazzinoFarmacia"},{ref:"PageArticoli",selector:a.selContainer+"#PageArticoli"},{ref:"PageFornitori",selector:a.selContainer+"#PageFornitori"},{ref:"GridArticoli",selector:a.selContainer+"#GridArticoli"},{ref:"GridFornitori",
selector:a.selContainer+"#GridFornitori"},{ref:"CmcMagazzino",selector:a.selContainer+"#CmcMagazzino"},{ref:"CmcFarmacia",selector:a.selContainer+"#CmcFarmacia"},{ref:"CbxAttivo",selector:a.selContainer+"#CbxAttivo"},{ref:"CbxNonAttivo",selector:a.selContainer+"#CbxNonAttivo"},{ref:"StpForPerPag",selector:a.selContainer+"#StpForPerPag"},{ref:"CercaGruppo",selector:a.selContainer+"#CercaGruppo"},{ref:"CercaCategoria",selector:a.selContainer+"#CercaCategoria"},{ref:"CercaDescrizione",selector:a.selContainer+
"#CercaDescrizione"},{ref:"CercaFornitore",selector:a.selContainer+"#CercaFornitore"},{ref:"EdtData",selector:a.selContainer+"#EdtData"}]);a.control(a.selContainer+"#MCMagazzinoFarmacia",{change:a.cambioMCMagazzinoFarmacia});a.control(a.selContainer+"#TabPrincipale",{tabchange:a.tabchangeTabPaginatore});a.control(a.selContainer+"#CercaGruppo",{change:Ext.Function.createBuffered(function(b){return a.genericSearch(b,"desGruppo")},100,a)});a.control(a.selContainer+"#CercaCategoria",{change:Ext.Function.createBuffered(function(b){return a.genericSearch(b,
"desCategoria")},100,a)});a.control(a.selContainer+"#CercaDescrizione",{change:Ext.Function.createBuffered(function(b){return a.genericSearch(b,"descrizione")},100,a)});a.control(a.selContainer+"#CercaFornitore",{change:Ext.Function.createBuffered(function(b){return a.genericSearch(b,"desCliFor")},100,a)})},genericSearch:function(a,b){for(var c=this.getGridArticoli().getStore(),d=0,e=c.data.items.length;d<e;d++)c.data.items[d].checked=!1;for(var g=this.getGridArticoli().getSelectionModel().getSelection(),
d=0,e=g.length;d<e;d++)g[d].checked=!0;c.filter(function(c){var d=!1,e=c.get(b);e&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase())&&(d=!0);c.checked&&(d=!0);return d});a.focus()},tabchangeTabPaginatore:function(a,b,c,d){"PageArticoli"===b.getItemId()?(a=this.getGridArticoli().getStore(),this.loadArticoli(a)):"PageFornitori"===b.getItemId()&&(a=this.getGridFornitori().getStore(),this.loadFornitori(a))},loadFornitori:function(a){var b={};Ext.apply(b,{idOrganizzazione:this.idOrganizzazione,attivo:"T",
tipo:"F",limit:0});a.getProxy().extraParams=b;a.load()},loadArticoli:function(a){var b={};Ext.apply(b,{idOrganizzazione:this.idOrganizzazione,tipoArticolo:this.tipoArticolo(),attivo:this.attivo(),hasListino:"T"});a.getProxy().extraParams=b;a.load({})},tipoArticolo:function(){var a="";this.getCmcMagazzino().getValue()&&!this.getCmcFarmacia().getValue()?a="M":!this.getCmcMagazzino().getValue()&&this.getCmcFarmacia().getValue()&&(a="F");return a},attivo:function(){var a="";this.getCbxAttivo().getValue()&&
!this.getCbxNonAttivo().getValue()?a="T":!this.getCbxAttivo().getValue()&&this.getCbxNonAttivo().getValue()&&(a="F");return a},cambioMCMagazzinoFarmacia:function(a,b,c){},stampa:function(){var a=this.cbaConfig,b=newIdElab(),c={};if(!a.stampaDiretta){var d="T";this.getStpForPerPag().checked||(d="F");Ext.apply(c,{idOrganizzazione:this.idOrganizzazione,tipoArticolo:this.tipoArticolo(),attivo:this.attivo(),stpForPerPag:d,dataListino:this.getEdtData().getValue(),idAvanzamentoElaborazione:b});d=this.getGridArticoli().getSelectionModel().getSelection();
b=[];if(!Ext.isEmpty(d)){for(var d=$jscomp.makeIterator(d),e=d.next();!e.done;e=d.next())b.push(e.value.get("id"));Ext.apply(c,{elencoIdArticoli:b.toString()})}d=this.getGridFornitori().getSelectionModel().getSelection();b=[];if(!Ext.isEmpty(d)){d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next())b.push(e.value.get("codice"));Ext.apply(c,{elencoIdCliFor:b.toString()})}}this.setParametriStampa(c);b=this.parametriStampa={url:this.cbaConfig.url,jsonData:a.jsonData,titolo:a.titolo,renderTo:this.getPageAnteprima(),
winElaborazione:a.winElaborazione,params:{reportId:a.id}};Ext.apply(b.params,c);a.configBtnStampa&&(Ext.applyIf(b,a.configBtnStampa),a.configBtnStampa.params&&Ext.applyIf(b.params,a.configBtnStampa.params))},doPrint:function(a,b){this.stampa();this.callParent([a,b])},afterLoadPerson:function(a){},setParametriStampa:function(a){for(var b in a)Ext.isDefined(a[b])&&null!==a[b]||delete a[b]},gestMultipleChoice:function(a){a.onAfter({afterrender:function(a,c){var b=a.query("checkbox");a.values={};for(var e=
$jscomp.makeIterator(b),g=e.next();!g.done;g=e.next()){var g=g.value,h={};Ext.apply(a.values,(h[g.name]=g.getValue(),h));g.onAfter("change",function(c,d,e,g){d={};c=a.values;e=$jscomp.makeIterator(b);for(g=e.next();!g.done;g=e.next()){g=g.value;var h={};Ext.apply(d,(h[g.name]=g.getValue(),h))}a.values=d;a.fireEvent("change",a,d,c)})}a.getValue=function(){return this.values}}})},isMagazzino:function(){return 58==CBA.moduli.moduloAttivo},isFarmacia:function(){return 62==CBA.moduli.moduloAttivo},onLaunch:function(){var a=
this.cbaConfig,b=this.getTabPrincipale();this.idOrganizzazione=getIdOrg();this.gestMultipleChoice(this.getMCMagazzinoFarmacia());this.getEdtData().validate();this.getEdtData().setValue(new Date);a.pageParametri?this.getPageParametri().tab.show():b.remove(this.getPageParametri());(1==this.getTabPrincipale().items.getCount()||a.eseguiStampa)&&this.doPrint(b.down("#BtnStampa"));this.getBtnAvanti().setVisible(!0);this.getBtnIndietro().setVisible(!0);this.getCmcMagazzino().setValue(!0);this.getCmcFarmacia().setValue(!0);
this.isMagazzino()&&(this.getCmcFarmacia().setValue(!1),this.getCmcMagazzino().readOnly=!0,this.getCmcFarmacia().readOnly=!0);this.isFarmacia()&&(this.getCmcMagazzino().setValue(!1),this.getCmcMagazzino().readOnly=!0,this.getCmcFarmacia().readOnly=!0)}});
Ext.define("GeneraliEC.stampe.view.ECOStampaArticoli",{extend:"Generali.standard.ControlledContainer",uses:["Generali.standard.stampe.Button"],initComponent:function(){Ext.applyIf(this,{items:[{xtype:"stampaCBA",itemId:"TabPrincipale",reference:"TabPrincipale",useNewButtonStampa:!0,border:0,items:[{xtype:"panel",itemId:"PageParametri",reference:"PageParametri",bodyPadding:5,layout:{type:"hbox",align:"stretch"},tabConfig:{title:"PARAMETRI_GENERALI",height:44},items:[{xtype:"form",itemId:"Form",reference:"Form",
noModificaDati:!0,border:0,flex:1,maxWidth:692,layout:"fit",items:[{xtype:"container",flex:1,maxWidth:692,items:[{xtype:"fieldset",title:"PARAMETRI",layout:{type:"vbox",align:"stretch"},items:[{xtype:"cbaMultipleChoice",layout:"column",itemId:"MCMagazzinoFarmacia",reference:"MCMagazzinoFarmacia",style:"border: 0px!important",cbaConfig:{itemsCfg:[{html:traduci("MAGAZZINO"),style:"text-align:  center",name:"magazzino",itemId:"CmcMagazzino",reference:"CmcMagazzino",inputValue:"M",width:155},{html:traduci("FARMACIA"),
style:"text-align: center",name:"farmacia",itemId:"CmcFarmacia",reference:"CmcFarmacia",inputValue:"F",width:155}]}},{xtype:"checkboxgroup",flex:1,margin:"0 0 5 0",labelClsExtra:"cbaLabel",items:[{xtype:"checkboxfield",itemId:"CbxAttivo",reference:"CbxAttivo",boxLabel:"ATTIVO",checked:!0,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxNonAttivo",reference:"CbxNonAttivo",boxLabel:"NON_ATTIVO",checked:!0,cls:"cbaLabel"}]},{xtype:"combobox",width:305,fieldLabel:"GRUPPO",labelClsExtra:"cbaLabel",labelWidth:65,
itemId:"CbGruppo",reference:"CbGruppo",displayField:"valore",minChars:0,queryParam:"descrizione",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGruppi")},{xtype:"combobox",width:305,fieldLabel:"CATEGORIA",labelClsExtra:"cbaLabel",labelWidth:65,itemId:"CbCategoria",reference:"CbCategoria",displayField:"valore",queryMode:"local",valueField:"codice",minChars:0,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxCategorie")},{xtype:"checkboxgroup",flex:1,margin:"0 0 5 0",
labelClsExtra:"cbaLabel",items:[{xtype:"checkboxfield",itemId:"CbxIsLasa",reference:"CbxIsLasa",boxLabel:"STAMPA_SOLO_LASA",cls:"cbaLabel"}]},{xtype:"combobox",labelWidth:65,width:305,hidden:!0,fieldLabel:"FORNITORE",labelClsExtra:"cbaLabel",itemId:"CbFornitore",reference:"CbFornitore",displayField:"valore",queryParam:"descrizione",valueField:"codice",minChars:0,store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor")},{xtype:"combobox",itemId:"CBTipoStampa",reference:"CBTipoStampa",labelClsExtra:"cbaLabel",
fieldLabel:"TIPO_STAMPA",displayField:"valore",valueField:"codice",editable:!1,labelWidth:110,minChars:0,allowBlank:!1,store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"codice"},{name:"valore"}],data:[["E",traduci("ELENCO")],["MR",traduci("MODULO_RICHIESTE")]],autoLoad:!0,autoDestroy:!0}),listeners:{afterrender:function(a,b){a.setValue(a.getStore().getAt(0))}}},{xtype:"combobox",itemId:"CBRaggruppamento",reference:"CBRaggruppamento",labelClsExtra:"cbaLabel",fieldLabel:"RAGGRUPPAMENTO",displayField:"valore",
valueField:"codice",editable:!1,labelWidth:110,minChars:0,allowBlank:!1,store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"codice"},{name:"valore"}],data:[["N",traduci("NESSUN_GRUPPO")],["GC",traduci("GRUPPO_CATEGORIE")]],autoLoad:!0,autoDestroy:!0}),listeners:{afterrender:function(a,b){a.setValue(a.getStore().getAt(0))}}}]}]}]}]},{xtype:"panel",itemId:"PageDepositi",reference:"PageDepositi",bodyPadding:5,layout:{type:"hbox",align:"stretch"},tabConfig:{title:traduci("DEPOSITI"),height:44},hidden:!0,
items:[]},{xtype:"panel",itemId:"PageArticoli",reference:"PageArticoli",bodyPadding:5,layout:{type:"hbox",align:"stretch"},tabConfig:{title:traduci("ARTICOLI"),height:44},hidden:!0,items:[]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.stampe.view.ECOStampaListini",{extend:"Generali.standard.ControlledContainer",uses:["Generali.standard.stampe.Button"],initComponent:function(){this.disabilitaClickTab=!0;Ext.applyIf(this,{items:[{xtype:"stampaCBA",itemId:"TabPrincipale",reference:"TabPrincipale",useNewButtonStampa:!0,disableClickTab:this.disabilitaClickTab,border:0,items:[{xtype:"panel",itemId:"PageParametri",reference:"PageParametri",bodyPadding:5,layout:{type:"hbox",align:"stretch"},tabConfig:{title:"PARAMETRI_GENERALI",
height:44},items:[{xtype:"form",itemId:"Form",reference:"Form",noModificaDati:!0,border:0,flex:1,maxWidth:692,layout:"fit",items:[{xtype:"container",flex:1,maxWidth:692,items:[{xtype:"fieldset",title:"PARAMETRI",layout:{type:"vbox",align:"stretch"},items:[{xtype:"cbaMultipleChoice",layout:"column",itemId:"MCMagazzinoFarmacia",reference:"MCMagazzinoFarmacia",style:"border: 0px!important",cbaConfig:{itemsCfg:[{html:traduci("MAGAZZINO"),style:"text-align:  center",name:"magazzino",itemId:"CmcMagazzino",
reference:"CmcMagazzino",inputValue:"M",width:155},{html:traduci("FARMACIA"),style:"text-align: center",name:"farmacia",itemId:"CmcFarmacia",reference:"CmcFarmacia",inputValue:"F",width:155}]}},{xtype:"checkboxgroup",flex:1,margin:"0 0 5 0",labelClsExtra:"cbaLabel",items:[{xtype:"checkboxfield",itemId:"CbxAttivo",reference:"CbxAttivo",boxLabel:"ATTIVO",checked:!0,cls:"cbaLabel"},{xtype:"checkboxfield",itemId:"CbxNonAttivo",reference:"CbxNonAttivo",boxLabel:"NON_ATTIVO",checked:!0,cls:"cbaLabel"}]},
{xtype:"checkboxfield",itemId:"StpForPerPag",reference:"StpForPerPag",boxLabel:"STAMPA_UN_FORNITORE_PER_PAGINA",cls:"cbaLabel",checked:!0,margin:"0 0 0 5"},{xtype:"datefield",itemId:"EdtData",reference:"EdtData",fieldLabel:"DATA",labelClsExtra:"cbaLabel",labelWidth:60,maxWidth:170,allowBlank:!1,margin:"0 0 0 5"}]}]}]}]},{xtype:"panel",itemId:"PageArticoli",reference:"PageArticoli",bodyPadding:5,layout:{type:"hbox",align:"stretch"},tabConfig:{title:traduci("ARTICOLI"),height:44},items:[{xtype:"gridpanel",
selModel:Ext.create("Ext.selection.CheckboxModel"),store:Ext.create("GeneraliEC.storeGenerali.CatalogoShort",{autoLoad:!1}),border:0,flex:1,itemId:"GridArticoli",reference:"GridArticoli",columns:[{xtype:"gridcolumn",text:"GRUPPO",dataIndex:"desGruppo",flex:1,align:"left",items:[{xtype:"textfield",itemId:"CercaGruppo",reference:"CercaGruppo",fieldLabel:"",emptyText:"CERCA_GRUPPO",maxWidth:400,width:323,margin:5}]},{xtype:"gridcolumn",text:"CATEGORIA",dataIndex:"desCategoria",flex:1,align:"left",items:[{xtype:"textfield",
itemId:"CercaCategoria",reference:"CercaCategoria",fieldLabel:"",emptyText:"CERCA_CATEGORIA",maxWidth:400,width:323,margin:5}]},{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"descrizione",flex:1,align:"left",items:[{xtype:"textfield",itemId:"CercaDescrizione",reference:"CercaDescrizione",fieldLabel:"",maxWidth:400,width:323,emptyText:"CERCA_DESCRIZIONE",margin:5}]},{xtype:"gridcolumn",text:"FORNITORE",dataIndex:"desCliFor",flex:1,align:"left",items:[{xtype:"textfield",itemId:"CercaFornitore",reference:"CercaFornitore",
fieldLabel:"",maxWidth:400,width:323,emptyText:"CERCA_FORNITORE",margin:5}]}],viewConfig:{border:0,loadMask:!1,stripeRows:!0,preserveScrollOnRefresh:!0,forceFit:!1}}]},{xtype:"panel",itemId:"PageFornitori",reference:"PageFornitori",bodyPadding:5,layout:{type:"hbox",align:"stretch"},tabConfig:{title:traduci("FORNITORI"),height:44},items:[{xtype:"gridpanel",selModel:Ext.create("Ext.selection.CheckboxModel"),store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor",{autoLoad:!1}),border:0,flex:1,itemId:"GridFornitori",
reference:"GridFornitori",columns:[{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"valore",flex:1,align:"left"}],dockedItems:[{xtype:"cercaGrid",maxWidth:300,cbaConfig:{searchField:"valore",noIcon:!0}}],viewConfig:{border:0,loadMask:!1,stripeRows:!0,preserveScrollOnRefresh:!0,forceFit:!1}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.storeGenerali.CatalogoShort",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idGruppo"},{name:"idCategoria"},{name:"idDeposito"},{name:"idCliFor"},{name:"descrizione"},{name:"desGruppo"},{name:"desCategoria"},{name:"desCliFor"},{name:"attivo"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/catalogo/listSearch"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.storeGenerali.CboxCausaliIVA",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:"/cba/eco/of/ws/prszn/varie/causaCont/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("GeneraliEC.storeGenerali.CboxCdc",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/centriConsumo/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.storeGenerali.CboxRegistroIVA",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:"/cba/eco/of/ws/prszn/varie/registriIva/cboxByDate",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliEC.storeGenerali.UnitaMisuraPN",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/farmaci/unimis/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/farmaci/unimis/list"}},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.controller.Articolo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridArticolo",selector:this.selContainer+"#GridArticolo"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#GridArticolo",{beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,
validateedit:this.validateeditGrid});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnNuovo:function(a){a={};var b=this.getGridArticolo(),c=b.getStore().getCount();Ext.apply(a,{idOrganizzazione:this.idOrganizzazione});controller_nuovoRecordGrid(a,b,c)},clickBtnElimina:function(a){var b=this;a=b.getGridArticolo();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),
{id:c?c.get("id"):""},function(a){b.aggiornaStore()})},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},beforeeditGrid:function(a,b,c){if(a.editing)return!1;var d=(a=b.column)?a.field:null;setTimeout(function(){d&&d.el&&d.el.dom&&b.column.field.selectText()},100);this.abilitaBottoniGrid(!1)},editGrid:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?
this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGrid:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGrid:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridArticolo(),c=b.getStore();c.load({params:{idOrganizzazione:this.idOrganizzazione},callback:function(d,e,g){if(g){var h;StdEconomato.isValidID(a)&&(h=trovaRecord(c,"id",a));b.getSelectionModel().select(h?[h]:0)}else msgShowError("",e.getError())}})},
onLaunch:function(){var a=this.getGridArticolo();this.idOrganizzazione=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg();a.controller=this;this.aggiornaStore()},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.controller.BeniManutenzione",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TPBeniManutenzione",selector:this.selContainer+"#TPBeniManutenzione"},{ref:"PanelArticolo",selector:this.selContainer+"#PanelArticolo"},{ref:"PanelGuastiFrequenti",selector:this.selContainer+"#PanelGuastiFrequenti"}])},onLaunch:function(){var a={},b=this.getPanelArticolo(),c=this.getPanelGuastiFrequenti();
this.idOrganizzazione=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg();Ext.apply(a,{controllerPrincipale:this,idOrganizzazione:this.idOrganizzazione,cbaConfig:{permesso:this.cbaConfig.permesso}});b.add(Ext.create("GeneraliEC.tabelleBase.view.Articolo",a));c.add(Ext.create("GeneraliEC.tabelleBase.view.GuastiFrequenti",a))},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.controller.CausaProblemi",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridCausaProb",selector:this.selContainer+"#GridCausaProb"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#GridCausaProb",{beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,
validateedit:this.validateeditGrid});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnNuovo:function(a){a=this.getGridCausaProb();var b=a.getStore().getCount();controller_nuovoRecordGrid({},a,b)},clickBtnElimina:function(a){var b=this;a=b.getGridCausaProb();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(a){b.aggiornaStore()})},
abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},beforeeditGrid:function(a,b,c){if(a.editing)return!1;var d=(a=b.column)?a.field:null;setTimeout(function(){d&&d.el&&d.el.dom&&b.column.field.selectText()},100);this.abilitaBottoniGrid(!1)},editGrid:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,
0)},canceleditGrid:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGrid:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridCausaProb(),c=b.getStore();c.load({callback:function(d,e,g){if(g){var h;StdEconomato.isValidID(a)&&(h=trovaRecord(c,"id",a));b.getSelectionModel().select(h?[h]:0)}else msgShowError("",e.getError())}})},onLaunch:function(){var a=this.getGridCausaProb();this.idOrganizzazione=this.cbaConfig.idOrganizzazione?
this.cbaConfig.idOrganizzazione:getIdOrg();a.controller=this;this.aggiornaStore()},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.controller.Classificazione",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridClassificazione",selector:this.selContainer+"#GridClassificazione"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#GridClassificazione",{beforeedit:this.beforeeditGrid,edit:this.editGrid,
canceledit:this.canceleditGrid,validateedit:this.validateeditGrid});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnNuovo:function(a){a={};var b=this.getGridClassificazione(),c=b.getStore().getCount();Ext.apply(a,{idOrganizzazione:this.idOrganizzazione});controller_nuovoRecordGrid(a,b,c)},clickBtnElimina:function(a){var b=this;a=b.getGridClassificazione();var c=a.getSelectionModel().getSelection()[0];
controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(a){b.aggiornaStore()})},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},beforeeditGrid:function(a,b,c){if(a.editing)return!1;var d=(a=b.column)?a.field:null;setTimeout(function(){d&&d.el&&d.el.dom&&b.column.field.selectText()},100);this.abilitaBottoniGrid(!1)},editGrid:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();
controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGrid:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGrid:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridClassificazione(),c=b.getStore();c.load({params:{idOrganizzazione:this.idOrganizzazione},callback:function(d,e,g){if(g){var h;StdEconomato.isValidID(a)&&(h=trovaRecord(c,"id",a));b.getSelectionModel().select(h?
[h]:0)}else msgShowError("",e.getError())}})},onLaunch:function(){var a=this.getGridClassificazione();this.idOrganizzazione=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg();a.controller=this;this.aggiornaStore()},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.controller.GuastiFrequenti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridGuastiFrequenti",selector:this.selContainer+"#GridGuastiFrequenti"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"CBGruppo",selector:this.selContainer+"#CBGruppo"},{ref:"CBCategoria",selector:this.selContainer+"#CBCategoria"},{ref:"DescCerca",selector:this.selContainer+"#DescCerca"},
{ref:"GridArticoli",selector:this.selContainer+"#GridArticoli"},{ref:"BtnCerca",selector:this.selContainer+"#BtnCerca"},{ref:"ChkSoloSelezionati",selector:this.selContainer+"#ChkSoloSelezionati"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"}]);this.control(this.selContainer+"#GridGuastiFrequenti",{select:this.selectGrid});this.control(this.selContainer+"#CBGruppo",{change:this.changeGruppo});this.control(this.selContainer+"#BtnCerca",{click:this.loadArticoli});this.control(this.selContainer+
"#GridArticoli",{deselect:this.changeRecord,select:this.changeRecord});this.control(this.selContainer+"#DescCerca",{change:Ext.Function.createBuffered(this.loadArticoli,500,this,[])})},changeRecord:function(a,b,c,d){b.set("modificato",!0)},changeGruppo:function(a,b){var c=this.getCBCategoria().getStore();b?c.load({params:{idGruppo:b}}):(svuotaStore(c),this.getCBCategoria().setValue(null))},caricaStoreGruppo:function(){var a=this.getCBGruppo().getStore();this.getCBCategoria().getStore();svuotaStore(a);
a.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione};a.load()},selectGrid:function(a,b,c,d){a=this.getGridArticoli();c=this.getForm();clearForm(c);a.setDisabled(!b);b&&(c.loadRecord(b),this.loadArticoli())},gestioneForm:function(){var a=this,b=a.getGridGuastiFrequenti().getStore(),c=a.getForm(),d=c.getForm(),e=a.getGridArticoli(),g=e.getStore();c.permesso=a.cbaConfig.permesso;c.boxBottoni=a.getBoxBottoni();c.store=b;c.controller=a;b=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{itemId:"cntBottoni",cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){var b=d.findField("id").getValue();a.aggiornaStore(b);e.setDisabled(!1)},nuovo_callback:function(){controller_nuovoRecord(c);d.setValues({idOrganizzazione:a.idOrganizzazione});svuotaStore(g);e.setDisabled(!0)},elimina_callback:function(){var b=d.findField("id").getValue();StdEconomato.isValidID(b)&&controller_eliminaRecord(c.store,{id:b},function(b){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},
esci_callback:function(){}}});inserisciBottoni(c.boxBottoni,b);c.boxBottoni.queryById("btnEsci").hide();b=function(){var a=c.isDirty()||g.isModified()||c.getRecord()&&c.getRecord().phantom;!a||c.isDirty()||g.isModified()||(a=!1);c.boxBottoni.queryById("cntBottoni").setBtnEditMode(a)};if("L"!=c.permesso&&(c.getForm().on("dirtychange",b),g.on({datachanged:b,update:b}),"L"!=c.permesso))c.getForm().on("dirtychange",function(a,b){controller_abilitaBottoni(c)})},verificaCampiForm:function(){var a=[],b=
this.getForm();b.getForm().getFieldValues();b.isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{idOrganizzazione:this.idOrganizzazione});(b=controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"}))?this.saveGridArticoli(b,a):a&&this.callbackEsci&&this.callbackEsci()},saveGridArticoli:function(a,b){var c=this,d=c.getGridArticoli(),e=d.getStore(),g=a.id;d.setDisabled(!1);var h=e.getChanges();null!=
h&&(Ext.each(h,function(a){a.attivo="T"==a.attivo?"F":"T";StdEconomato.isValidID(a.idGuasto)||(a.idGuasto=g);StdEconomato.isValidID(a.idOrganizzazione)||(a.idOrganizzazione=c.idOrganizzazione);delete a.modificato;delete a.eliminare}),Ext.apply(h,{id:g}),controller_salvaRecord(d,h,b,{forzaRegistrazione:"F"})?b&&c.callbackEsci?c.callbackEsci():StdEconomato.isValidID(g)&&(e=trovaRecord(e,"id",g),d.getSelectionModel().select(e?[e]:0)):(d=c.getBoxBottoni(),d.queryById("cntBottoni").setBtnEditMode(!0),
d.queryById("btnNuovo").setDisabled(!1)))},aggiornaStore:function(a){var b=this,c=b.getGridGuastiFrequenti(),d=c.getStore();StdEconomato.isValidID(a)&&(b.idTestata=a);svuotaStore(d);d.load({params:{idOrganizzazione:b.idOrganizzazione},callback:function(a,g,h){if(h)if(Ext.isEmpty(a))b.selectGrid(c,null);else{var e;StdEconomato.isValidID(b.idTestata)&&(e=trovaRecord(d,"id",b.idTestata));c.getSelectionModel().select(e?[e]:0)}else msgShowError("",g.getError())}})},leggiParam:function(){var a={},b=this.getCBGruppo().getValue(),
c=this.getCBCategoria().getValue(),d=this.getDescCerca().getValue(),e=getBoolValue(this.getChkSoloSelezionati().getValue()),g=this.getForm().getRecord().get("id");Ext.apply(a,{idOrganizzazione:this.idOrganizzazione});b&&Ext.apply(a,{idGruppo:b});c&&Ext.apply(a,{idCategoria:c});d&&Ext.apply(a,{descrizione:d});e&&Ext.apply(a,{soloSelezionati:e});g&&Ext.apply(a,{idGuasto:g});return a},loadArticoli:function(){var a=this;grid=a.getGridArticoli();store=grid.getStore();params=a.leggiParam();svuotaStore(store);
store.load({params:params,callback:function(b,c,d){d?Ext.isEmpty(b)||a.impostaArtAttivi(b):msgShowError("",c.getError())}})},impostaArtAttivi:function(a){var b=this.getGridArticoli(),c=[];Ext.isEmpty(a)||(Ext.each(a,function(a){"T"==a.get("attivo")&&c.push(a)}),Ext.suspendLayouts(),b.getSelectionModel().select(c,!0,!0),b.getStore().commitChanges(),Ext.resumeLayouts())},onLaunch:function(){this.getGridArticoli().controller=this;this.gestioneForm();this.caricaStoreGruppo();this.aggiornaStore()},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.controller.Manutentore",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridManutentori",selector:this.selContainer+"#GridManutentori"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"CBUfficio",selector:this.selContainer+"#CBUfficio"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"}]);this.control(this.selContainer+"#GridManutentori",{select:this.selectGrid})},
cambioTipo:function(a,b,c){a=this.getForm().getForm();c=this.getCBUfficio().getStore();a.findField("idCliFor").setVisible("F"===b);a.findField("idUfficio").setVisible("P"===b);a.findField("descrizione").setVisible("F"!==b);a.findField("idCliFor").setDisabled("P"===b);a.findField("idUfficio").setDisabled("F"===b);a.findField("descrizione").setDisabled("F"===b);"P"===b&&(svuotaStore(c),c.load({params:{tipo:"U"},callback:function(a,b,c){c||msgShowError("",b.getError())}}))},selectGrid:function(a,b,c,
d){a=this.getForm();clearForm(a);b&&a.loadRecord(b)},aggiornaStore:function(a){var b=this,c=b.getGridManutentori(),d=c.getStore();svuotaStore(d);d.load({params:{},callback:function(e,g,h){if(h)if(Ext.isEmpty(e))b.selectGrid(c,null);else{var k;StdEconomato.isValidID(a)&&(k=trovaRecord(d,"id",a));c.getSelectionModel().select(k?[k]:0)}else msgShowError("",g.getError())}})},verificaCampiForm:function(){var a=[],b=this.getForm(),c=b.getForm().getFieldValues();b.isValid()&&!Ext.isEmpty(c.tipo)||msgAddError(a,
"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm(),d=c.getFieldValues();Ext.apply(d,{idOrganizzazione:this.idOrganizzazione,attivo:getBoolValue(d.attivo)});"F"===d.tipo&&(c=c.findField("idCliFor"),Ext.apply(d,{descrizione:c.getRawValue()}));controller_salvaRecord(b,d,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getGridManutentori().getStore(),c=a.getForm(),d=c.getForm();c.permesso=
a.cbaConfig.permesso;c.boxBottoni=a.getBoxBottoni();c.store=b;c.controller=a;b=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){var b=d.findField("id").getValue();a.aggiornaStore(b)},nuovo_callback:function(){controller_nuovoRecord(c,d.findField("descrizione"));d.setValues({attivo:"T"})},elimina_callback:function(){var b=d.findField("id").getValue();StdEconomato.isValidID(b)&&controller_eliminaRecord(c.store,
{id:b},function(b){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){}}});inserisciBottoni(c.boxBottoni,b);c.boxBottoni.queryById("btnEsci").hide();if("L"!=c.permesso)c.getForm().on("dirtychange",function(a,b){controller_abilitaBottoni(c)})},onLaunch:function(){var a=this.getGridManutentori();this.idOrganizzazione=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg();a.controller=this;this.gestioneForm();this.aggiornaStore()},
destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.controller.StatoIntervento",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridStato",selector:this.selContainer+"#GridStato"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"}]);this.control(this.selContainer+"#GridStato",{select:this.selectGrid})},selectGrid:function(a,b,c,d){a=this.getForm();clearForm(a);
b&&a.loadRecord(b)},aggiornaStore:function(a){var b=this,c=b.getGridStato(),d=c.getStore();svuotaStore(d);d.load({params:{},callback:function(e,g,h){if(h)if(Ext.isEmpty(e))b.selectGrid(c,null);else{var k;StdEconomato.isValidID(a)&&(k=trovaRecord(d,"id",a));c.getSelectionModel().select(k?[k]:0)}else msgShowError("",g.getError())}})},verificaCampiForm:function(){var a=[],b=this.getForm(),c=b.getForm().getFieldValues();b.isValid()&&!Ext.isEmpty(c.stato)||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",
a)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues();Ext.apply(c,{idOrganizzazione:this.idOrganizzazione,proponiDefault:getBoolValue(c.proponiDefault)});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getGridStato().getStore(),c=a.getForm(),d=c.getForm();c.permesso=a.cbaConfig.permesso;c.boxBottoni=a.getBoxBottoni();c.store=b;c.controller=a;b=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){var b=d.findField("id").getValue();a.aggiornaStore(b)},nuovo_callback:function(){controller_nuovoRecord(c)},elimina_callback:function(){var b=d.findField("id").getValue();StdEconomato.isValidID(b)&&controller_eliminaRecord(c.store,{id:b},function(b){a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){}}});inserisciBottoni(c.boxBottoni,b);c.boxBottoni.queryById("btnEsci").hide();
if("L"!=c.permesso)c.getForm().on("dirtychange",function(a,b){controller_abilitaBottoni(c)})},onLaunch:function(){var a=this.getGridStato();this.idOrganizzazione=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg();a.controller=this;this.gestioneForm();this.aggiornaStore()},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.controller.TipoIntervento",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridTipoInterv",selector:this.selContainer+"#GridTipoInterv"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#GridTipoInterv",{beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,
validateedit:this.validateeditGrid});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina})},clickBtnNuovo:function(a){a={};var b=this.getGridTipoInterv(),c=b.getStore().getCount();Ext.apply(a,{idOrganizzazione:this.idOrganizzazione});controller_nuovoRecordGrid(a,b,c)},clickBtnElimina:function(a){var b=this;a=b.getGridTipoInterv();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),
{id:c?c.get("id"):""},function(a){b.aggiornaStore()})},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},beforeeditGrid:function(a,b,c){if(a.editing)return!1;var d=(a=b.column)?a.field:null;setTimeout(function(){d&&d.el&&d.el.dom&&b.column.field.selectText()},100);this.abilitaBottoniGrid(!1)},editGrid:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();controller_salvaRecord(d,c,!1,{forzaRegistrazione:!1})?
this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGrid:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGrid:function(a,b,c){return msgShow("",[])},aggiornaStore:function(a){var b=this.getGridTipoInterv(),c=b.getStore();c.load({params:{idOrganizzazione:this.idOrganizzazione},callback:function(d,e,g){if(g){var h;StdEconomato.isValidID(a)&&(h=trovaRecord(c,"id",a));b.getSelectionModel().select(h?[h]:0)}else msgShowError("",e.getError())}})},
onLaunch:function(){var a=this.getGridTipoInterv();this.idOrganizzazione=this.cbaConfig.idOrganizzazione?this.cbaConfig.idOrganizzazione:getIdOrg();a.controller=this;this.aggiornaStore()},destroy:function(){this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.store.Articolo",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"descrizione"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/articoli/get",api:{read:getUrlGen()+"/ws/tabelle/base/articoli/list",create:getUrlGen()+"/ws/tabelle/base/articoli/insert",update:getUrlGen()+"/ws/tabelle/base/articoli/update",destroy:getUrlGen()+"/ws/tabelle/base/articoli/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.ArticoloCbox",{extend:"Generali.data.StoreCodiceValore",fields:[{name:"idGruppo"},{name:"clcCodice",convert:function(a,b){a=b.get("codice");return a=a+"."+StdEconomato.coalesce(b.get("idGruppo"),0)}}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/articoli/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.CausaProblemi",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"descrizione"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/causaProblemi/get",api:{read:getUrlGen()+"/ws/tabelle/base/causaProblemi/list",create:getUrlGen()+"/ws/tabelle/base/causaProblemi/insert",update:getUrlGen()+"/ws/tabelle/base/causaProblemi/update",destroy:getUrlGen()+"/ws/tabelle/base/causaProblemi/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.CausaProblemiCbox",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/causaProblemi/cbox"}},a)])},autoDestroy:!0});Ext.define("GeneraliEC.tabelleBase.store.CboxArticoliMn",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/guastoArticoloSearch/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.CboxTipoIntervento",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/tipoIntervento/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.Classificazione",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"classificazione"},{name:"descrizione"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/classificazione/get",api:{read:getUrlGen()+"/ws/tabelle/base/classificazione/list",create:getUrlGen()+"/ws/tabelle/base/classificazione/insert",update:getUrlGen()+"/ws/tabelle/base/classificazione/update",destroy:getUrlGen()+
"/ws/tabelle/base/classificazione/delete"}}},a)])},autoDestroy:!0});Ext.define("GeneraliEC.tabelleBase.store.ClassificazioneCbox",{extend:"Generali.data.StoreJson",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/classificazione/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.Guasto",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"descrizione"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/guasto/get",api:{read:getUrlGen()+"/ws/tabelle/base/guasto/list",create:getUrlGen()+"/ws/tabelle/base/guasto/insert",update:getUrlGen()+"/ws/tabelle/base/guasto/update",destroy:getUrlGen()+"/ws/tabelle/base/guasto/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.GuastoArticolo",{extend:"Generali.data.Store",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"tipoArticolo"},{name:"codArticolo"},{name:"descrizioneArticolo"},{name:"targa"},{name:"registro"},{name:"idGuasto"},{name:"descrizioneGuasto"},{name:"attivo"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{type:"ajax",reader:{type:"json",messageProperty:"message",rootProperty:"data"},url:getUrlGen()+"/ws/tabelle/base/guastoArticoloSearch/get",
api:{read:getUrlGen()+"/ws/tabelle/base/guastoArticoloSearch/list",create:getUrlGen()+"/ws/tabelle/base/guastoArticoloSearch/save",update:getUrlGen()+"/ws/tabelle/base/guastoArticoloSearch/save",destroy:getUrlGen()+"/ws/tabelle/base/guastoArticoloSearch/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.GuastoCbox",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/guasto/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.Manutentore",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"attivo"},{name:"tipo"},{name:"descrizione"},{name:"idCliFor"},{name:"idUfficio"},{name:"telefono"},{name:"fax"},{name:"mail"},{name:"idDeposito"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/manutentore/get",api:{read:getUrlGen()+"/ws/tabelle/base/manutentore/list",create:getUrlGen()+"/ws/tabelle/base/manutentore/insert",
update:getUrlGen()+"/ws/tabelle/base/manutentore/update",destroy:getUrlGen()+"/ws/tabelle/base/manutentore/delete"}}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.ManutentoreCbox",{extend:"Generali.data.StoreJson",fields:[{name:"codice"},{name:"valore"},{name:"extra"},{name:"isFornitore",convert:function(a,b){a=void 0===a?!1:a;var c=b.get("extra");Ext.isEmpty(c)||(c=c.split(","),Ext.isEmpty(c)||(a="F"==c[1]));return a},depends:["extra"]}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/manutentore/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.StatoIntervento",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"descrizione"},{name:"stato"},{name:"proponiDefault"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/statoIntervento/get",api:{read:getUrlGen()+"/ws/tabelle/base/statoIntervento/list",create:getUrlGen()+"/ws/tabelle/base/statoIntervento/insert",update:getUrlGen()+"/ws/tabelle/base/statoIntervento/update",
destroy:getUrlGen()+"/ws/tabelle/base/statoIntervento/delete"}}},a)])},autoDestroy:!0});Ext.define("GeneraliEC.tabelleBase.store.StatoInterventoCbox",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/statoIntervento/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.TargheCbox",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/articoli/targhe/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.store.TipoIntervento",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"descrizione"}],constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/tipoIntervento/get",api:{read:getUrlGen()+"/ws/tabelle/base/tipoIntervento/list",create:getUrlGen()+"/ws/tabelle/base/tipoIntervento/insert",update:getUrlGen()+"/ws/tabelle/base/tipoIntervento/update",destroy:getUrlGen()+"/ws/tabelle/base/tipoIntervento/delete"}}},
a)])},autoDestroy:!0});Ext.define("GeneraliEC.tabelleBase.store.UtentiCbox",{extend:"Generali.data.StoreJson",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tabelle/base/manutentore/utentiPwd"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tabelleBase.view.Articolo",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"CBAShortcutGrid",itemId:"GridArticolo",reference:"GridArticolo",store:Ext.create("GeneraliEC.tabelleBase.store.Articolo",{autoLoad:!1}),columns:{defaults:{variableRowHeight:!0},items:[{xtype:"numbercolumn",dataIndex:"id",hidden:!0},{xtype:"numbercolumn",dataIndex:"idOrganizzazione",hidden:!0},{xtype:"gridcolumn",text:traduci("DESCRIZIONE")+" "+
traduci("ARTICOLO"),dataIndex:"descrizione",flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:100,enforceMaxLength:!0}}]},viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"cercaGrid",
width:void 0,flex:1,minWidth:150,maxWidth:350,minChars:0,listeners:{afterrender:function(a,b){a.setEmptyText(traduci("CERCA"))}},cbaConfig:{noIcon:!0,searchField:"descrizione"}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.view.BeniManutenzione",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"tabpanel",itemId:"TPBeniManutenzione",reference:"TPBeniManutenzione",flex:1,layout:"fit",items:[{xtype:"panel",itemId:"PanelArticolo",reference:"PanelArticolo",title:"ARTICOLI",layout:"fit"},{xtype:"panel",itemId:"PanelGuastiFrequenti",reference:"PanelGuastiFrequenti",title:"GUASTI_FREQUENTI",layout:"fit"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.view.CausaProblemi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"CBAShortcutGrid",itemId:"GridCausaProb",reference:"GridCausaProb",store:Ext.create("GeneraliEC.tabelleBase.store.CausaProblemi",{autoLoad:!1}),columns:{defaults:{variableRowHeight:!0,enableTextSelection:!0},items:[{xtype:"numbercolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",text:"DESCRIZIONE",dataIndex:"descrizione",flex:1,editor:{xtype:"textfield",
selectOnFocus:!0,allowBlank:!1,maxLength:100,enforceMaxLength:!0}}]},viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"cercaGrid",width:void 0,flex:1,minWidth:150,maxWidth:350,
minChars:0,listeners:{afterrender:function(a,b){a.setEmptyText(traduci("CERCA"))}},cbaConfig:{noIcon:!0,searchField:"descrizione"}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.view.Classificazione",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"CBAShortcutGrid",itemId:"GridClassificazione",reference:"GridClassificazione",store:Ext.create("GeneraliEC.tabelleBase.store.Classificazione",{autoLoad:!1}),columns:{defaults:{variableRowHeight:!0},items:[{xtype:"numbercolumn",dataIndex:"id",hidden:!0},{xtype:"numbercolumn",dataIndex:"idOrganizzazione",hidden:!0},{xtype:"gridcolumn",text:"Classificazione",
dataIndex:"classificazione",maxWidth:100,flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:10,enforceMaxLength:!0}},{xtype:"gridcolumn",text:traduci("DESCRIZIONE"),dataIndex:"descrizione",flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:255,enforceMaxLength:!0}}]},viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",
text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"cercaGrid",width:void 0,flex:1,minWidth:150,maxWidth:350,minChars:0,listeners:{afterrender:function(a,b){a.setEmptyText(traduci("CERCA"))}},cbaConfig:{noIcon:!0,searchField:"classificazione"}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.view.GuastiFrequenti",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"CBAShortcutGrid",itemId:"GridGuastiFrequenti",reference:"GridGuastiFrequenti",store:Ext.create("GeneraliEC.tabelleBase.store.Guasto",{autoLoad:!1}),width:200,columns:{defaults:{variableRowHeight:!0},items:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"descrizione",text:"DESCRIZIONE",
flex:1}]},viewConfig:{loadMask:!1}},{xtype:"container",flex:1,layout:{align:"stretch",type:"vbox"},items:[{xtype:"form",itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox",align:"stretch"},fieldDefaults:{maxWidth:555,minWidth:275},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"numberfield",name:"id",hidden:!0},{xtype:"numberfield",name:"idOrganizzazione",hidden:!0},{xtype:"textfield",fieldLabel:"DESCRIZIONE",name:"descrizione",allowBlank:!1,maxLength:100,enforceMaxLength:!0,labelClsExtra:"cbaLabel"}]},
{xtype:"CBAShortcutGrid",itemId:"GridArticoli",reference:"GridArticoli",title:"ARTICOLI_COLLEGATI",store:Ext.create("GeneraliEC.tabelleBase.store.GuastoArticolo",{autoLoad:!1}),flex:1,selModel:Ext.create("Ext.selection.CheckboxModel"),dockedItems:[{xtype:"toolbar",dock:"top",flex:1,itemId:"TBRicerca",reference:"TBRicerca",layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",itemId:"CBGruppo",reference:"CBGruppo",store:Ext.create("GeneraliAM.store.CboxGruppoArticoli"),name:"gruppoCbx",minWidth:275,
maxWidth:555,labelWidth:95,fieldLabel:"GRUPPO",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",margin:"5 5 0 0",listeners:{afterrender:function(a){a.setEmptyText(traduci("GRUPPO"))}}},{xtype:"combobox",itemId:"CBCategoria",reference:"CBCategoria",store:Ext.create("GeneraliAM.store.CboxCategoriaArticoli"),name:"categoriaCbx",minWidth:275,maxWidth:555,labelWidth:95,fieldLabel:"CATEGORIA",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",
margin:"5 5 0 0",listeners:{afterrender:function(a){a.setEmptyText(traduci("CATEGORIA"))}}},{xtype:"textfield",itemId:"DescCerca",reference:"DescCerca",labelWidth:95,maxWidth:555,fieldLabel:"CERCA",name:"descrizione",allowBlank:!0,margin:"5 5 0 0",enforceMaxLength:!0,labelClsExtra:"cbaLabel",emptyText:"CERCA"},{xtype:"container",layout:"hbox",items:[{xtype:"checkboxfield",itemId:"ChkSoloSelezionati",reference:"ChkSoloSelezionati",name:"selezionati",margin:"5 5 0 0",boxLabel:"VISUALIZZA_SOLO_SELEZIONATI",
inputValue:"T",uncheckedValue:"F",checked:!0},{xtype:"button",cls:"btnLarge",itemId:"BtnCerca",reference:"BtnCerca",margin:"5 5 0 0",width:80,iconCls:"icon-ricerca",scale:"medium",text:"CERCA"}]}]}],columns:{defaults:{variableRowHeight:!0},items:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"descrizioneArticolo",text:"DESCRIZIONE",flex:1},{xtype:"gridcolumn",text:"TIPO_ARTICOLO",renderer:function(a,b,c){return StdEconomato.isValidID(c.get("tipoArticolo"))?traduci("CESP_INV"):
traduci("SERV_MAN")}},{xtype:"gridcolumn",text:"TARGA",renderer:function(a,b,c){a="";var d=c.getData(),e=d.targa,d=d.registro;StdEconomato.isValidID(e)&&(a+=e.toString(),d&&(a+=d));return cell_renderer_numero(a,b,c)}}]},viewConfig:{loadMask:!1}}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.view.Manutentore",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"CBAShortcutGrid",itemId:"GridManutentori",reference:"GridManutentori",store:Ext.create("GeneraliEC.tabelleBase.store.Manutentore",{autoLoad:!1}),width:200,columns:{defaults:{variableRowHeight:!0},items:[{xtype:"gridcolumn",dataIndex:"descrizione",
text:"DESCRIZIONE",flex:1}]},viewConfig:{loadMask:!1,getRowClass:function(a,c){return"T"!=a.get("attivo")?"non_attivi":""}}},{xtype:"form",flex:1,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox",align:"stretch"},fieldDefaults:{maxWidth:555,minWidth:275,margin:"0 5 5 0"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"numberfield",name:"id",hidden:!0},{xtype:"numberfield",name:"idOrganizzazione",hidden:!0},{xtype:"numberfield",name:"idDeposito",hidden:!0},{xtype:"container",maxWidth:555,
layout:{type:"hbox",pack:"center",align:"middle"},items:[{xtype:"cbaMultipleChoice",flex:1,layout:"column",style:{border:"0px!important","border-radius":"25px",padding:"0px 5px 0px 0px"},cbaConfig:{esclusivo:!0,itemsCfg:[{html:traduci("FORNITORE"),style:"text-align: center",isFormField:!0,name:"tipo",inputValue:"F",width:160},{html:traduci("PERSONA_FISICA"),style:"text-align: center",isFormField:!0,name:"tipo",inputValue:"P",width:160},{html:traduci("UFFICIO"),style:"text-align: center",isFormField:!0,
name:"tipo",inputValue:"U",width:160}]},listeners:{choicechange:function(b,c,d){a.controller.cambioTipo(b,c,d)}}}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"DESCRIZIONE",name:"descrizione",allowBlank:!1,maxLength:100,enforceMaxLength:!0,labelClsExtra:"cbaLabel"},{xtype:"combobox",itemId:"CBCliFor",reference:"CBCliFor",store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor",{autoLoad:!1}),fieldLabel:"FORNITORE",name:"idCliFor",displayField:"valore",
queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel",listeners:{afterrender:function(b,c){var d=b.getStore();d.getProxy().extraParams={idOrganizzazione:a.controller.idOrganizzazione,tipo:"F",attivo:"T"};d.load()}}},{xtype:"combobox",itemId:"CBUfficio",reference:"CBUfficio",store:Ext.create("GeneraliEC.tabelleBase.store.ManutentoreCbox",{autoLoad:!1}),fieldLabel:"UFFICIO",name:"idUfficio",displayField:"valore",queryMode:"local",valueField:"codice",labelClsExtra:"cbaLabel"}]},{xtype:"checkboxfield",
itemId:"Attivo",reference:"Attivo",fieldLabel:"",boxLabel:"ATTIVO",inputValue:"T",uncheckedValue:"F",name:"attivo",cls:"cbaLabel"},{xtype:"container",maxWidth:560,layout:"column",items:[{xtype:"textfield",columnWidth:.5,minWidth:275,fieldLabel:"TELEFONO",name:"telefono",maskRe:/[0-9.]/,fieldStyle:"text-align:right !important",labelClsExtra:"cbaLabel",maxLength:20,enforceMaxLength:!0},{xtype:"textfield",columnWidth:.5,minWidth:275,fieldLabel:"FAX",name:"fax",maskRe:/[0-9.]/,fieldStyle:"text-align:right !important",
labelClsExtra:"cbaLabel",maxLength:20,enforceMaxLength:!0}]},{xtype:"textfield",vtype:"email",fieldLabel:"EMAIL",name:"mail",maxLength:200,enforceMaxLength:!0,labelClsExtra:"cbaLabel",listeners:{change:function(a,c,d,e){d=!0;c&&a.isValid()&&(Ext.isEmpty(c)||Ext.isEmpty(c.trim())||(d=!1));a.triggers.change.setHidden(d)}},triggers:{change:{cls:"icon-email16",hidden:!0,handler:function(a){}}}}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]});a.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.view.StatoIntervento",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"CBAShortcutGrid",itemId:"GridStato",reference:"GridStato",store:Ext.create("GeneraliEC.tabelleBase.store.StatoIntervento",{autoLoad:!1}),width:200,columns:{defaults:{variableRowHeight:!0},items:[{xtype:"gridcolumn",dataIndex:"descrizione",
text:"DESCRIZIONE",flex:1}]},viewConfig:{loadMask:!1}},{xtype:"form",flex:1,itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"numberfield",fieldLabel:"ID",name:"id",hidden:!0},{xtype:"numberfield",fieldLabel:"ID",name:"idOrganizzazione",hidden:!0},{xtype:"textfield",fieldLabel:"DESCRIZIONE",maxWidth:420,name:"descrizione",allowBlank:!1,maxLength:100,enforceMaxLength:!0,labelClsExtra:"cbaLabel"},{xtype:"fieldset",title:"STATO",
maxWidth:420,items:[{xtype:"container",layout:{type:"hbox",pack:"center",align:"middle"},items:[{xtype:"cbaMultipleChoice",layout:"column",style:{border:"0px!important","border-radius":"25px",padding:"0px 5px 0px 0px"},cbaConfig:{esclusivo:!0,itemsCfg:[{html:traduci("APERTO"),style:"text-align: center",isFormField:!0,name:"stato",inputValue:"T",width:150},{html:traduci("CHIUSO"),style:"text-align: center",isFormField:!0,name:"stato",inputValue:"F",width:150}]},listeners:{choicechange:function(b,c,
d){(b=a.controller.getForm().getForm().findField("proponiDefault"))&&b.setVisible("T"==c).setDisabled(!b.isVisible())}}}]}]},{xtype:"checkboxfield",hidden:!0,disabled:!0,boxLabel:"PROPONI_IN_AUTOMATICO",inputValue:"T",uncheckedValue:"F",name:"proponiDefault",cls:"cbaLabel"}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]}]});a.callParent(arguments)}});
Ext.define("GeneraliEC.tabelleBase.view.TipoIntervento",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"CBAShortcutGrid",itemId:"GridTipoInterv",reference:"GridTipoInterv",store:Ext.create("GeneraliEC.tabelleBase.store.TipoIntervento",{autoLoad:!1}),columns:{defaults:{variableRowHeight:!0},items:[{xtype:"numbercolumn",dataIndex:"id",hidden:!0},{xtype:"numbercolumn",dataIndex:"idOrganizzazione",hidden:!0},{xtype:"gridcolumn",text:"DESCRIZIONE",
dataIndex:"descrizione",flex:1,editor:{xtype:"textfield",allowBlank:!1,maxLength:100,enforceMaxLength:!0}}]},viewConfig:{width:300,loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGriglia",text:"ELIMINA"},{xtype:"cercaGrid",width:void 0,
flex:1,minWidth:150,maxWidth:350,minChars:0,listeners:{afterrender:function(a,b){a.setEmptyText(traduci("CERCA"))}},cbaConfig:{noIcon:!0,searchField:"descrizione"}}]}]}]});this.callParent(arguments)}});Ext.define("GeneraliEC.tabelle.controller.FARMenuTabelle",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.tabelle.controller.MAGMenuTabelle",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.tabelle.controller.MNMenuTabelle",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.tabelle.controller.OFMenuTabelle",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"}])},renderLogo:function(a){"L"!=this.permesso&&getPopupMenuFoto(a)}});
Ext.define("GeneraliEC.tabelle.store.FARMenuTabelle",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",urlGen:"/ws/tabelle/base/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},a)])}});
Ext.define("GeneraliEC.tabelle.store.MAGMenuTabelle",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",urlGen:"/ws/tabelle/base/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},a)])}});
Ext.define("GeneraliEC.tabelle.store.MNMenuTabelle",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",urlGen:"/ws/tabelle/base/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},a)])}});
Ext.define("GeneraliEC.tabelle.store.OFMenuTabelle",{extend:"Ext.data.TreeStore",fields:[{name:"idRecord"},{name:"text"},{name:"expanded"},{name:"leaf"},{name:"iconCls"},{name:"idServizio"},{name:"panelType"},{name:"children"},{name:"params"},{name:"forceOpen"},{name:"idOrganizzazione"}],proxy:{type:"ajax",urlGen:"/ws/tabelle/base/tree",reader:{type:"json",rootProperty:"children"}},constructor:function(a){a=a||{};this.callParent([Ext.apply({autoLoad:!1,storeId:"albero",root:{expanded:!1}},a)])}});
Ext.define("GeneraliEC.tabelle.view.FARMenuTabelle",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"GEST_TABELLE"},{xtype:"tabpanel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"},listeners:{beforetabchange:function(a,c,d,e){if(getFormDirty(d))return!1},tabchange:function(b,c,d,e){1024>=Ext.getBody().getViewSize().width&&"GEANFOCL"==c.cbaConfig.panelType&&a.queryById("pnlPerson").collapse();this.updateDatiTab&&alert("qui")}}}]}],listeners:{beforerender:{fn:a.onContainerBeforeRender,scope:a}}});a.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.tabelle.store.FARMenuTabelle");
ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,b){b.data.text=traduci(b.data.text)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,l,m,n){a=c.queryById("content");d=b.data;if(getFormDirty(a))return Messaggio("MSG_SALVATAGGIO_DATI","MSG_DATI_DA_CONFERMARE",
"OK","WARNING",!1),!1;var g={};b.get("params")&&(l=b.get("params").split(","),Ext.each(l,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));(l=d.permesso)||(l="S");m=b.get("text");var h;"L"==l&&(m=m+" - "+traduci("SOLA_LETTURA"),h="icon-solalettura");g.permesso=l;g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var k="";"GEANFOCL"==d.panelType&&(k="Generali.anaCliFor.view.AnaCliFor");"GECODIVA"==
d.panelType&&(k="Generali.aliquotaiva.view.AliIva");"GEUNIMIS"==d.panelType&&(k="Generali.unitaMisura.view.UniMis");"GEBANCHE"==d.panelType&&(k="Generali.banche.view.Banche");"GECONDPAG"==d.panelType&&(k="Generali.condizionidipagamento.view.CondPag");"GECATFOCL"==d.panelType&&(k="Generali.catCliFor.view.CatCliFor");"GEORGANIZZAZIONI"==d.panelType&&(k="Generali.organizzazioni.view.Organizzazioni");"DEPOSITI"==d.panelType&&(k="GeneraliEC.depositi.view.Depositi");"GEANACDA"==d.panelType&&(k="GeneraliEC.cda.view.PnlGestCda");
"GEGRPCAT"==d.panelType&&(k="GeneraliEC.gruppiCategorie.view.PnlGruppoCategoria");"GEPRIATT"==d.panelType&&(k="GeneraliEC.principiAttivi.view.PrincipiAttivi");"GEUBICA"==d.panelType&&(k="GeneraliEC.ubicazioni.view.PnlGestUbicazioni");"GEGRPATC"==d.panelType&&(k="GeneraliEC.gruppiAtc.view.PnlGestGrpAtc");"GECATALOGO"==d.panelType&&(k="GeneraliEC.catalogoArticoli.view.PnlCatalogoArticoli");"GELIVRIORDINO"==d.panelType&&(k="GeneraliEC.livelloRiordino.view.RicercaLivRiordino");"GECAUSALI"==d.panelType&&
(k="GeneraliEC.causali.view.Causali");if(b.get("panelType")){l="TabTabella"+b.get("idRecord");d.idOrganizzazione&&(n=b.parentNode.get("text"),22<n.length&&(n=n.substr(0,20)+"..."),m=m+" ("+n+")");a.down("#"+l)||(c.updateDatiTab=!1,"GEORGANIZZAZIONI"!=d.panelType&&a.add({xtype:"panel",itemId:l,title:m,iconCls:h,closable:!0,layout:"fit",cbaConfig:{panelType:b.get("panelType")},items:[],listeners:{beforeclose:function(a,b){var c=!getFormDirty(a);c&&a.cbaConfig&&a.cbaConfig.puoiChiudere&&(c=a.cbaConfig.puoiChiudere());
return c},close:function(a){e.getSelectionModel().deselectAll()}}}));a.setActiveTab(l);var p=a.getActiveTab();g.currentTab=p;Ext.isEmpty(p.down())&&(g.protezionePwd?Ext.widget("passwordCBA",{callBackSbloccoPwd:function(a){a&&p.add(Ext.create(k,{cbaConfig:g,flex:1}))}}).show():p.add(Ext.create(k,{cbaConfig:g,flex:1})));c.updateDatiTab=!0}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.tabelle.view.MAGMenuTabelle",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"GEST_TABELLE"},{xtype:"tabpanel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"},listeners:{beforetabchange:function(a,c,d,e){if(getFormDirty(d))return!1},tabchange:function(b,c,d,e){1024>=Ext.getBody().getViewSize().width&&"GEANFOCL"==c.cbaConfig.panelType&&a.queryById("pnlPerson").collapse();this.updateDatiTab&&alert("qui")}}}]}],listeners:{beforerender:{fn:a.onContainerBeforeRender,scope:a}}});a.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.tabelle.store.MAGMenuTabelle");
ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,b){"N"!=b.get("permesso")?b.set("text",traduci(b.get("text"))):b.set("visible",!1)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,l,m,n){a=c.queryById("content");d=b.data;if(getFormDirty(a))return Messaggio("MSG_SALVATAGGIO_DATI",
"MSG_DATI_DA_CONFERMARE","OK","WARNING",!1),!1;var g={};b.get("params")&&(l=b.get("params").split(","),Ext.each(l,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));(l=d.permesso)||(l="S");m=b.get("text");var h;"L"==l&&(m=m+" - "+traduci("SOLA_LETTURA"),h="icon-solalettura");g.permesso=l;g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var k="";"GEANFOCL"==d.panelType&&(k="Generali.anaCliFor.view.AnaCliFor");
"GECODIVA"==d.panelType&&(k="Generali.aliquotaiva.view.AliIva");"GEUNIMIS"==d.panelType&&(k="Generali.unitaMisura.view.UniMis");"GEBANCHE"==d.panelType&&(k="Generali.banche.view.Banche");"GECONDPAG"==d.panelType&&(k="Generali.condizionidipagamento.view.CondPag");"GECATFOCL"==d.panelType&&(k="Generali.catCliFor.view.CatCliFor");"GEORGANIZZAZIONI"==d.panelType&&(k="Generali.organizzazioni.view.Organizzazioni");"DEPOSITI"==d.panelType&&(k="GeneraliEC.depositi.view.Depositi");"GEANACDA"==d.panelType&&
(k="GeneraliEC.cda.view.PnlGestCda");"GEGRPCAT"==d.panelType&&(k="GeneraliEC.gruppiCategorie.view.PnlGruppoCategoria");"GEPRIATT"==d.panelType&&(k="GeneraliEC.principiAttivi.view.PrincipiAttivi");"GEUBICA"==d.panelType&&(k="GeneraliEC.ubicazioni.view.PnlGestUbicazioni");"GEGRPATC"==d.panelType&&(k="GeneraliEC.gruppiAtc.view.PnlGestGrpAtc");"GECATALOGO"==d.panelType&&(k="GeneraliEC.catalogoArticoli.view.PnlCatalogoArticoli");"GELIVRIORDINO"==d.panelType&&(k="GeneraliEC.livelloRiordino.view.RicercaLivRiordino");
"GECAUSALI"==d.panelType&&(k="GeneraliEC.causali.view.Causali");if(b.get("panelType")){l="TabTabella"+b.get("idRecord");d.idOrganizzazione&&(n=b.parentNode.get("text"),22<n.length&&(n=n.substr(0,20)+"..."),m=m+" ("+n+")");a.down("#"+l)||(c.updateDatiTab=!1,"GEORGANIZZAZIONI"!=d.panelType&&a.add({xtype:"panel",itemId:l,title:m,iconCls:h,closable:!0,layout:"fit",cbaConfig:{panelType:b.get("panelType")},items:[],listeners:{beforeclose:function(a,b){var c=!getFormDirty(a);c&&a.cbaConfig&&a.cbaConfig.puoiChiudere&&
(c=a.cbaConfig.puoiChiudere());return c},close:function(a){e.getSelectionModel().deselectAll()}}}));a.setActiveTab(l);var p=a.getActiveTab();g.currentTab=p;Ext.isEmpty(p.down())&&(g.protezionePwd?Ext.widget("passwordCBA",{callBackSbloccoPwd:function(a){a&&p.add(Ext.create(k,{cbaConfig:g,flex:1}))}}).show():p.add(Ext.create(k,{cbaConfig:g,flex:1})));c.updateDatiTab=!0}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.tabelle.view.MNMenuTabelle",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"GEST_TABELLE"},{xtype:"tabpanel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"},listeners:{beforetabchange:function(a,c,d,e){if(getFormDirty(d))return!1},tabchange:function(b,c,d,e){1024>=Ext.getBody().getViewSize().width&&"GEANFOCL"==c.cbaConfig.panelType&&a.queryById("pnlPerson").collapse();this.updateDatiTab&&alert("qui")}}}]}],listeners:{beforerender:{fn:a.onContainerBeforeRender,scope:a}}});a.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.tabelle.store.MNMenuTabelle");
ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,b){b.data.text=traduci(b.data.text)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,l,m,n){a=c.queryById("content");d=b.data;if(getFormDirty(a))return Messaggio("MSG_SALVATAGGIO_DATI","MSG_DATI_DA_CONFERMARE",
"OK","WARNING",!1),!1;var g={};b.get("params")&&(l=b.get("params").split(","),Ext.each(l,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));(l=d.permesso)||(l="S");m=b.get("text");var h;"L"==l&&(m=m+" - "+traduci("SOLA_LETTURA"),h="icon-solalettura");g.permesso=l;g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var k="";panelType=d.panelType;"MNCAUSAPROBLEMI"==panelType&&(k="GeneraliEC.tabelleBase.view.CausaProblemi");
"MNTIPOINTERVENTO"==panelType&&(k="GeneraliEC.tabelleBase.view.TipoIntervento");"MNRICORRENZE"==panelType&&(k="MN.tabelleBase.view.Ricorrenze");"MNMANUTENTORE"==panelType&&(k="GeneraliEC.tabelleBase.view.Manutentore");"MNBENIMAN"==panelType&&(k="GeneraliEC.tabelleBase.view.BeniManutenzione");"MNCLASSIFICAZIONI"==panelType&&(k="GeneraliEC.tabelleBase.view.Classificazione");"MNSTATO"==panelType&&(k="GeneraliEC.tabelleBase.view.StatoIntervento");"GESEDI_REPART_STANZE"==panelType&&(k="Generali.sediReparti.view.SediReparti");
"GEANACDA"==panelType&&(k="GeneraliEC.cda.view.PnlGestCda");"MNCONTRATTI"==panelType&&(k="GeneraliEC.contratti.view.PnlContratti");"GEANFOCL"==d.panelType&&(k="Generali.anaCliFor.view.AnaCliFor");if(b.get("panelType")){l="TabTabella"+b.get("idRecord")+(d.idOrganizzazione?"-Org"+d.idOrganizzazione:"");d.idOrganizzazione&&(n=b.parentNode.get("text"),22<n.length&&(n=n.substr(0,20)+"..."),m=m+" ("+n+")");a.down("#"+l)||(c.updateDatiTab=!1,"GEORGANIZZAZIONI"!=d.panelType&&a.add({xtype:"panel",itemId:l,
title:m,iconCls:h,closable:!0,layout:"fit",cbaConfig:{panelType:b.get("panelType")},items:[],listeners:{beforeclose:function(a,b){var c=!getFormDirty(a);c&&a.cbaConfig&&a.cbaConfig.puoiChiudere&&(c=a.cbaConfig.puoiChiudere());return c},close:function(a){e.getSelectionModel().deselectAll()}}}));a.setActiveTab(l);var p=a.getActiveTab();(g.currentTab=p)&&Ext.isEmpty(p.down())&&(g.protezionePwd?Ext.widget("passwordCBA",{callBackSbloccoPwd:function(a){a&&p.add(Ext.create(k,{cbaConfig:g,flex:1}))}}).show():
p.add(Ext.create(k,{cbaConfig:g,flex:1})));c.updateDatiTab=!0}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.tabelle.view.OFMenuTabelle",{extend:"Generali.standard.ControlledContainer",border:0,height:700,itemId:"containerCPPerson",reference:"containerCPPerson",layout:{type:"fit"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",border:0,layout:{type:"border"},items:[{xtype:"panel",region:"west",split:!0,border:0,itemId:"pnlPerson",reference:"pnlPerson",width:250,layout:{align:"stretch",type:"vbox"},collapsible:!0,title:"GEST_TABELLE"},{xtype:"tabpanel",
region:"center",border:0,itemId:"content",reference:"content",layout:{align:"stretch",type:"vbox"},listeners:{beforetabchange:function(a,c,d,e){if(getFormDirty(d))return!1},tabchange:function(b,c,d,e){1024>=Ext.getBody().getViewSize().width&&"GEANFOCL"==c.cbaConfig.panelType&&a.queryById("pnlPerson").collapse();this.updateDatiTab&&alert("qui")}}}]}],listeners:{beforerender:{fn:a.onContainerBeforeRender,scope:a}}});a.callParent(arguments)},onContainerBeforeRender:function(a,b){var c=this,d=Ext.create("GeneraliEC.tabelle.store.OFMenuTabelle");
ImpostaUrl([d]);var e=Ext.create("Ext.tree.Panel",{flex:1,store:d,itemId:"pnlAlbero",reference:"pnlAlbero",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},listeners:{itemappend:function(a,b){b.data.text=traduci(b.data.text)},beforeitemcontextmenu:function(a,b,c,d,e,n){return getPopupMenuTree(e,a)},beforeselect:function(a,b){return!getFormDirty(c.queryById("content"))},select:function(a,b,d,l,m,n){a=c.queryById("content");d=b.data;if(getFormDirty(a))return Messaggio("MSG_SALVATAGGIO_DATI","MSG_DATI_DA_CONFERMARE",
"OK","WARNING",!1),!1;var g={};b.get("params")&&(l=b.get("params").split(","),Ext.each(l,function(a){a=a.split("=");var b=[];b[a[0]]=a[1];Ext.apply(g,b)}));(l=d.permesso)||(l="S");m=b.get("text");var h;"L"==l&&(m=m+" - "+traduci("SOLA_LETTURA"),h="icon-solalettura");g.permesso=l;g.text=d.text;g.idRecord=d.idRecord;d.idServizio&&(g.idServizio=d.idServizio);d.idOrganizzazione&&(g.idOrganizzazione=d.idOrganizzazione);var k="";"GEANFOCL"==d.panelType&&(k="Generali.anaCliFor.view.AnaCliFor");"GECODIVA"==
d.panelType&&(k="Generali.aliquotaiva.view.AliIva");"GEUNIMIS"==d.panelType&&(k="Generali.unitaMisura.view.UniMis");"GEBANCHE"==d.panelType&&(k="Generali.banche.view.Banche");"GECONDPAG"==d.panelType&&(k="Generali.condizionidipagamento.view.CondPag");"GECATFOCL"==d.panelType&&(k="Generali.catCliFor.view.CatCliFor");"GEORGANIZZAZIONI"==d.panelType&&(k="Generali.organizzazioni.view.Organizzazioni");"DEPOSITI"==d.panelType&&(k="GeneraliEC.depositi.view.Depositi");"GEANACDA"==d.panelType&&(k="GeneraliEC.cda.view.PnlGestCda");
"GEGRPCAT"==d.panelType&&(k="GeneraliEC.gruppiCategorie.view.PnlGruppoCategoria");"GEPRIATT"==d.panelType&&(k="GeneraliEC.principiAttivi.view.PrincipiAttivi");"GEUBICA"==d.panelType&&(k="GeneraliEC.ubicazioni.view.PnlGestUbicazioni");"GEGRPATC"==d.panelType&&(k="GeneraliEC.gruppiAtc.view.PnlGestGrpAtc");"GECATALOGO"==d.panelType&&(k="GeneraliEC.catalogoArticoli.view.PnlCatalogoArticoli");"GELIVRIORDINO"==d.panelType&&(k="GeneraliEC.livelloRiordino.view.RicercaLivRiordino");"GECAUSALI"==d.panelType&&
(k="GeneraliEC.causali.view.Causali");"OFCONTRATTI"==d.panelType&&(k="GeneraliEC.contratti.view.PnlContratti");"OFVARIAFATTURA"==d.panelType&&(k="OF.variazioniFattura.view.VariazioniFattura");"OFTIPOORDINE"==d.panelType&&(k="OF.tipoOrdine.view.TipoOrdine");"OFTIPOCONTRATTI"==d.panelType&&(k="GeneraliEC.tipCatContratti.view.PnlTipCatContratti");if(b.get("panelType")){l="TabTabella"+b.get("idRecord")+(d.idOrganizzazione?"-Org"+d.idOrganizzazione:"");d.idOrganizzazione&&(n=b.parentNode.get("text"),22<
n.length&&(n=n.substr(0,20)+"..."),m=m+" ("+n+")");a.down("#"+l)||(c.updateDatiTab=!1,"GEORGANIZZAZIONI"!=d.panelType&&a.add({xtype:"panel",itemId:l,title:m,iconCls:h,closable:!0,layout:"fit",cbaConfig:{panelType:b.get("panelType")},items:[],listeners:{beforeclose:function(a,b){var c=!getFormDirty(a);c&&a.cbaConfig&&a.cbaConfig.puoiChiudere&&(c=a.cbaConfig.puoiChiudere());return c},close:function(a){e.getSelectionModel().deselectAll()}}}));a.setActiveTab(l);var p=a.getActiveTab();g.currentTab=p;Ext.isEmpty(p.down())&&
(g.protezionePwd?Ext.widget("passwordCBA",{callBackSbloccoPwd:function(a){a&&p.add(Ext.create(k,{cbaConfig:g,flex:1}))}}).show():p.add(Ext.create(k,{cbaConfig:g,flex:1})));c.updateDatiTab=!0}}}});a.queryById("pnlPerson").add(e);e.getStore().load({callback:function(a,b,c){c?e.expandAll():msgShowError("",b.getError())}});Localizer.localize(a)}});
Ext.define("GeneraliEC.tipCatContratti.controller.Categoria",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"FormCategoria",selector:this.selContainer+"#FormCategoria"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CodiceTipo",selector:this.selContainer+"#CodiceTipo"},{ref:"DescrizioneCategoria",selector:this.selContainer+"#DescrizioneCategoria"}])},verificaCampiForm:function(){var a=
[];this.getFormCategoria().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},salvaForm:function(a){var b=this.getFormCategoria(),c=b.getForm().getFieldValues();this.datiLocale=c;this.recordModificato=!0;controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getFormCategoria();b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();b.store=a.storeCategoria;b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",
{cbaConfig:{conferma_callback:function(c){store=a.cbaConfig.controllerTree.getTreeRep().getStore();if(a.cbaConfig.nuovoInserimento)var d=trovaRecord(store,"text",a.getDescrizioneCategoria().getValue());d&&d.get("idTipo")!=a.cbaConfig.codiceTipo?Messaggio("ATTENZIONE","DATI_STESSA_DESCR","YESNO","QUESTION",!1,function(){a.salvaForm(c)},function(){var c=b.getForm().findField("id").getValue();a.recordModificato=!0;a.aggiornaStore(c)}):a.salvaForm(c)},annulla_callback:function(){var c=b.getForm().findField("id").getValue(),
e=b.getForm().findField("idTipo").getValue();0<c?a.aggiornaStore():a.cbaConfig.controllerTree.aggiornaStore(null,null,e)},nuovo_callback:function(){controller_nuovoRecord(b);"T"==a.cbaConfig.deteriorabile&&a.getChbDeteriorabile().setValue(!0);"F"==a.cbaConfig.tipo&&a.getChbDeteriorabile().setVisible(!1)},elimina_callback:function(){var c=b.getForm().findField("id").getValue(),e=b.getForm().findField("idTipo").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.recordModificato=
!0;a.cbaConfig.controllerTree.aggiornaStore(null,null,e)})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});a.cbaConfig.codiceArticolo||(inserisciBottoni(b.boxBottoni,c),b.boxBottoni.queryById("btnEsci").hide(),b.boxBottoni.queryById("btnNuovo").hide());if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);a.cbaConfig.controllerTree.getTreeRep().setDisabled(e)})},aggiornaStore:function(a){var b=this,c=b.storeCategoria,d=b.getFormCategoria().getForm();
b.cbaConfig.controllerTree.getTreeRep().setDisabled(!1);b.cbaConfig.codiceCategoria||a?c.load({params:{id:b.cbaConfig.codiceCategoria?b.cbaConfig.codiceCategoria:a},callback:function(c,g,h){h?(g=b.cbaConfig.controllerTree,Ext.isEmpty(c)||d.loadRecord(c[0]),b.recordModificato&&(b.recordModificato=!1,g.aggiornaStore(null,a,null),delete g.cbaConfig.nuovaCategoria)):msgShowError("",g.getError())}}):(b.cbaConfig.CntPrincipale.removeAll(),b.cbaConfig.controllerTree.aggiornaStore())},onLaunch:function(){this.idOrganizzazione=
this.cbaConfig.idOrganizzazione;this.idEsercizio=this.cbaConfig.anno;this.storeCategoria=Ext.create("GeneraliEC.tipCatContratti.store.Categoria");this.gestioneForm();this.cbaConfig.nuovoInserimento?(this.getBoxBottoni().queryById("btnNuovo").handler(),this.getCodiceTipo().setValue(this.cbaConfig.codiceTipo)):this.aggiornaStore()},destroy:function(){eliminaStore(this.storeCategoria)}});
Ext.define("GeneraliEC.tipCatContratti.controller.PnlTipCatContratti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TreeRep",selector:this.selContainer+"#TreeRep"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"},{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"CntFinestra",selector:this.selContainer+"#CntFinestra"},
{ref:"BtnSeleziona",selector:this.selContainer+"#BtnSeleziona"},{ref:"TxtCerca",selector:this.selContainer+"#TxtCerca"},{ref:"LblSelettore",selector:this.selContainer+"#LblSelettore"}]);this.control(this.selContainer+"#TreeRep",{select:this.selectTree,itemdblclick:this.itemdblclickTree,beforeitemcontextmenu:this.beforeitemcontextmenuTree});this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnEsci",{click:this.clickBtnEsci});this.control(this.selContainer+
"#BtnSeleziona",{click:this.clickBtnSeleziona});this.control(this.selContainer+"#TxtCerca",{change:Ext.Function.createBuffered(this.filtraTree,500,this)})},filtraTree:function(a){var b=this.getTreeRep(),c=b.getStore(),d=[];this.getLblSelettore().setVisible(!1);c.clearFilter();Ext.isEmpty(a.getValue())?(c.each(function(a){a.set("cls","")}),b.getSelectionModel().select(0)):(c.each(function(b){if(b.isLeaf()){var c=!1,e=b.get("text");e&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase())&&(c=!0);c?
(b.set("cls","cba-dirty-record"),d.push(b)):b.set("cls","")}}),this.filtraPadri(c,d),this.getLblSelettore().setVisible(1<d.length),Ext.isEmpty(d)?b.getSelectionModel().select(0):(b.ensureVisible(d[0]),this.getLblSelettore().setText(traduci("NUM_ELEMENTI_TROVATI",[d.length]))));a.focus()},filtraPadri:function(a,b){a.filter(function(a){for(var c=!1,e=0,g=b.length;e<g;e++)if(a.contains(b[e])){c=!0;break}else if(a.isLeaf()&&(c=a===b[e]))break;return c})},clickBtnSeleziona:function(a){a.up("window").close()},
clickBtnEsci:function(a){a.up("window").close()},clickBtnNuovo:function(){var a=this.getTreeRep().getSelectionModel().getSelection()[0],b=this.getCntPrincipale(),c={};b.removeAll();Ext.apply(c,{nuovoInserimento:!0,controllerTree:this,CntPrincipale:b,idOrganizzazione:this.idOrganizzazione,nodeID:a.get("nodeID"),codiceTipo:a.get("idTipo"),codiceCategoria:a.get("idCategoria")});a&&(Ext.isEmpty(a.get("idTipo"))?b.add(Ext.create("GeneraliEC.tipCatContratti.view.Tipo",{cbaConfig:c})):Ext.isEmpty(a.get("idCategoria"))&&
(this.cbaConfig.nuovaCategoria&&this.cbaConfig.caricamentoEsterno&&Ext.apply(c,{nuovaCategoria:this.cbaConfig.nuovaCategoria}),b.add(Ext.create("GeneraliEC.tipCatContratti.view.Categoria",{cbaConfig:c}))))},selectTree:function(a,b,c,d){a={};b=b.data;c=this.getCntPrincipale();b.params&&(a=b.params[0]);Ext.apply(a,{nuovoInserimento:this.nuovoRecord,controllerTree:this,CntPrincipale:c,idOrganizzazione:this.idOrganizzazione,permesso:"S",text:b.text,nodeID:b.nodeID,codiceTipo:b.idTipo,codiceCategoria:b.idCategoria,
anno:this.idEsercizioDefault,permesso:this.cbaConfig.permesso});c.removeAll();Ext.isEmpty(b.idTipo)&&!Ext.isEmpty(b.idCategoria)?(this.getBtnNuovo().setText(traduci("NUOVO")),this.getBtnNuovo().setDisabled(!0)):(this.getBtnNuovo().setText(traduci("NUOVO_TIPO")),this.getBtnNuovo().setDisabled(!1),Ext.isEmpty(b.idTipo)||(this.getBtnNuovo().setText(traduci("NUOVA_CATEGORIA")),c.add(Ext.create("GeneraliEC.tipCatContratti.view.Tipo",{cbaConfig:a}))),Ext.isEmpty(b.idCategoria)||(this.getBtnNuovo().setDisabled(!0),
c.add(Ext.create("GeneraliEC.tipCatContratti.view.Categoria",{cbaConfig:a}))),"L"==this.cbaConfig.permesso&&this.getBtnNuovo().setDisabled(!0))},beforeitemcontextmenuTreeView:function(a,b,c,d,e,g){return getPopupMenuTree(e,a)},aggiornaStore:function(a,b,c){var d=this,e={},g=d.getTreeRep(),h=g.getStore();Ext.apply(e,{idOrganizzazione:d.idOrganizzazione});h.load({params:e,callback:function(e,h,m){if(m){var k;b&&(k=g.getRootNode().findChild("idCategoria",b,!0));c&&(k=g.getRootNode().findChild("idTipo",
c,!0));a&&(k=g.getRootNode().findChild("nodeID",a,!0));g.expandAll();d.cbaConfig.caricamentoEsterno&&d.cbaConfig.idCategoria&&(k=g.getRootNode().findChild("idCategoria",d.cbaConfig.idCategoria,!0));k?(g.getSelectionModel().select(0),g.getSelectionModel().select([k]),d.cbaConfig.idCategoria&&d.clickBtnNuovo()):g.getSelectionModel().select(0)}else msgShowError("",h.getError())}})},onLaunch:function(){this.idOrganizzazione=this.cbaConfig.idOrganizzazione;this.getTreeRep().controller=this;this.getCntFinestra().setVisible(this.cbaConfig.caricamentoEsterno);
this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.tipCatContratti.controller.Tipo",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"FormTipo",selector:this.selContainer+"#FormTipo"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"DescrizioneTipo",selector:this.selContainer+"#DescrizioneTipo"}])},verificaCampiForm:function(){var a=[];this.getFormTipo().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",
a)},salvaForm:function(a){var b=this.getFormTipo(),c=b.getForm().getFieldValues();this.datiLocale=c;this.recordModificato=!0;Ext.apply(c,{idOrganizzazione:this.cbaConfig.idOrganizzazione});controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getFormTipo();b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();b.store=a.storeTipo;b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},
annulla_callback:function(){a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.recordModificato=!0;a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});a.cbaConfig.codiceCategoria||(inserisciBottoni(b.boxBottoni,c),b.boxBottoni.queryById("btnEsci").hide(),b.boxBottoni.queryById("btnNuovo").hide());
if("L"!=b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);a.cbaConfig.controllerTree.getTreeRep().setDisabled(e)})},aggiornaStore:function(a){var b=this,c=b.storeTipo,d=b.getFormTipo(),e=d.getForm();b.cbaConfig.codiceCategoria&&containerSolaLettura(d);b.cbaConfig.controllerTree.getTreeRep().setDisabled(!1);b.cbaConfig.codiceTipo||a?c.load({params:{id:b.cbaConfig.codiceTipo?b.cbaConfig.codiceTipo:a},callback:function(c,d,k){k?(Ext.isEmpty(c)||e.loadRecord(c[0]),b.recordModificato&&
(b.recordModificato=!1,b.cbaConfig.controllerTree.aggiornaStore(null,null,a))):msgShowError("",d.getError())}}):(b.cbaConfig.CntPrincipale.removeAll(),b.cbaConfig.controllerTree.aggiornaStore())},onLaunch:function(){this.idOrganizzazione=this.cbaConfig.idOrganizzazione;this.storeTipo=Ext.create("GeneraliEC.tipCatContratti.store.Tipo");this.gestioneForm();this.cbaConfig.nuovoInserimento?this.getBoxBottoni().queryById("btnNuovo").handler():this.aggiornaStore()},destroy:function(){eliminaStore(this.storeTipo)}});
Ext.define("GeneraliEC.tipCatContratti.store.Categoria",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idTipo"},{name:"descrizione"},{name:"desTipo"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/categorieContratti/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/categorieContratti/get",create:getUrlGen()+"/ws/categorieContratti/insert",update:getUrlGen()+"/ws/categorieContratti/update",destroy:getUrlGen()+"/ws/categorieContratti/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.tipCatContratti.store.CboxCategorieContratti",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/categorieContratti/cbox"}},a)])},autoDestroy:!0});Ext.define("GeneraliEC.tipCatContratti.store.CboxTipiContratti",{extend:"Generali.data.StoreCodiceValore",constructor:function(a){a=a||{};this.callParent([Ext.apply({proxy:{url:getUrlGen()+"/ws/tipiContratti/cbox"}},a)])},autoDestroy:!0});
Ext.define("GeneraliEC.tipCatContratti.store.PnlTipCatContratti",{extend:"Ext.data.TreeStore",fields:[{name:"children"},{name:"expanded"},{name:"iconCls"},{name:"idCategoria"},{name:"idTipo"},{name:"leaf"},{name:"nodeID"},{name:"text"}],autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:getUrlGen()+"/ws/tipiContratti/tree",reader:{type:"json",messageProperty:"message",rootProperty:"children"}},autoDestroy:!0});
Ext.define("GeneraliEC.tipCatContratti.store.Tipo",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"descrizione"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/tipiContratti/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/tipiContratti/get",create:getUrlGen()+"/ws/tipiContratti/insert",update:getUrlGen()+"/ws/tipiContratti/update",destroy:getUrlGen()+"/ws/tipiContratti/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.tipCatContratti.view.Categoria",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"fieldset",title:"GESTIONE_CATEGORIA",flex:1,bodyPadding:10,items:[{xtype:"form",itemId:"FormCategoria",reference:"FormCategoria",trackResetOnLoad:!0,border:0,bodyPadding:10,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},
{xtype:"textfield",itemId:"CodiceTipo",reference:"CodiceTipo",fieldLabel:"ID_TIPO",name:"idTipo",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"textfield",labelWidth:150,maxLength:50,flex:1,name:"descrizione",itemId:"DescrizioneCategoria",reference:"DescrizioneCategoria",fieldLabel:"DESCRIZIONE_CATEGORIA",allowBlank:!1,enforceMaxLength:!0,labelClsExtra:"cbaLabel"}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.tipCatContratti.view.PnlTipCatContratti",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"treepanel",itemId:"TreeRep",reference:"TreeRep",width:380,border:0,store:Ext.create("GeneraliEC.tipCatContratti.store.PnlTipCatContratti"),rootVisible:!1,useArrows:!0,viewConfig:{loadMask:!1,getRowClass:function(a,b,c,d){return a.get("cls")}},dockedItems:[{xtype:"toolbar",dock:"top",itemId:"CntFinestra",
reference:"CntFinestra",items:[{xtype:"button",itemId:"BtnSeleziona",reference:"BtnSeleziona",iconCls:"icon-ok32",scale:"large",text:"CONFERMA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-annulla32",scale:"large",text:"ANNULLA"}]},{xtype:"toolbar",dock:"top",layout:{type:"hbox",align:"left"},border:0,items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",align:"left",text:"NUOVO"},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",
emptyText:"CERCA",flex:1}]},{xtype:"label",border:0,dock:"top",hidden:!0,itemId:"LblSelettore",reference:"LblSelettore"}]},{xtype:"panel",itemId:"CntPrincipale",reference:"CntPrincipale",flex:1,bodyPadding:10,autoScroll:!0,layout:{align:"stretch",type:"vbox"}}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.tipCatContratti.view.Tipo",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"fieldset",title:"GESTIONE_TIPO",flex:1,bodyPadding:10,items:[{xtype:"form",itemId:"FormTipo",reference:"FormTipo",trackResetOnLoad:!0,border:0,bodyPadding:10,flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"ID",name:"id",hidden:!0,labelClsExtra:"cbaLabel"},{xtype:"textfield",
labelWidth:150,maxLength:50,flex:1,name:"descrizione",itemId:"DescrizioneTipo",reference:"DescrizioneTipo",fieldLabel:"DESCRIZIONE_TIPO",allowBlank:!1,enforceMaxLength:!0,labelClsExtra:"cbaLabel"}]}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",width:120}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.trasferisciListini.controller.ConfermaTrasfListini",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"BtnConferma",selector:this.selContainer+"#BtnConferma"},{ref:"CBFornitore",selector:this.selContainer+"#CBFornitore"}]);this.control(this.selContainer+"#BtnEsci",{click:this.esciClick});this.control(this.selContainer+"#BtnConferma",
{click:this.conferma})},conferma:function(){var a=this,b=a.cbaConfig.selected.map(function(a){return a.get("id")}).join(",");Ext.Ajax.request({method:"GET",async:!1,url:"/cba/eco/of/ws/catalogoListino/procedure/trasferimListino/elabora",params:{elencoArticoli:b,dataInizioUtilizzo:a.cbaConfig.controllerRicerca.getEdtData().getValue(),idCliFor:a.getCBFornitore().getValue()},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(a.cbaConfig.controllerRicerca.effettuaRicerca(),a.esciClick()):
msgShowError("",b.message)}})},esciClick:function(){this.getBtnEsci().up("window").close()},onLaunch:function(){var a=this.getCBFornitore().getStore();this.idOrganizzazione=getIdOrg();a.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,attivo:"T",limit:0};this.getCBFornitore().validate()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.trasferisciListini.controller.RicercaTrasfListini",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Paginatore",selector:this.selContainer+"#Paginatore"},{ref:"BtnAvanti",selector:this.selContainer+"#BtnAvanti"},{ref:"BtnIndietro",selector:this.selContainer+"#BtnIndietro"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"Risultati",selector:this.selContainer+"#Risultati"},
{ref:"EdtData",selector:this.selContainer+"#EdtData"},{ref:"CBGruppo",selector:this.selContainer+"#CBGruppo"},{ref:"CBCategoria",selector:this.selContainer+"#CBCategoria"},{ref:"CBDeposito",selector:this.selContainer+"#CBDeposito"},{ref:"CBFornitore",selector:this.selContainer+"#CBFornitore"}]);this.control(this.selContainer+"#BtnElabora",{click:this.conferma});this.control(this.selContainer+"#Paginatore",{beforetabchange:this.beforetabchangePaginatore,render:this.rendertabPaginatore});this.control(this.selContainer+
"#BtnAvanti",{click:this.avanti});this.control(this.selContainer+"#BtnIndietro",{click:this.indietro});this.control(this.selContainer+"#Paginatore",{tabchange:this.tabchangePaginatore});this.control(this.selContainer+"#CBGruppo",{change:this.changeCBGruppo})},changeCBGruppo:function(a,b){var c=this.getCBCategoria().getStore();b?c.load({params:{idGruppo:b}}):svuotaStore(c);this.getCBCategoria().setDisabled(!b)},disabilitaClickTab:function(){var a=this.getPaginatore();a.items.each(function(b){if(!Ext.isDefined(b.tab.giaCreato))b.tab.on("click",
function(){b.tab.giaCreato=!0;a.cambiaTab=!1})})},rendertabPaginatore:function(){this.disabilitaClickTab()},beforetabchangePaginatore:function(a,b,c,d){return a.cambiaTab},avanti:function(){this.naviga("next")},indietro:function(){this.naviga("prev")},naviga:function(a){var b=this.getPaginatore(),c=b.getLayout(),d=b.getActiveTab();b.cambiaTab=!0;a?(c[a](),"next"==a&&"ParametriRicerca"==d.itemId?this.effettuaRicerca():this.abilitaPulsanti(!0)):this.abilitaPulsanti(!0);return!0},abilitaPulsanti:function(a){var b=
this.getPaginatore().getActiveTab(),c=this.getBtnIndietro(),d=this.getBtnAvanti(),e=this.getBtnElabora();!1===a?(c.setDisabled(!0),d.setDisabled(!0),e.setDisabled(!0)):(c.setDisabled("ParametriRicerca"==b.itemId),d.setDisabled("Risultati"==b.itemId),e.setDisabled("Risultati"!=b.itemId||!b.down("gridpanel").getSelectionModel().selected.length))},aggiornaSuSelezione:function(a,b){this.abilitaPulsanti(!0)},tabchangePaginatore:function(a,b,c,d){this.abilitaPulsanti(!0)},effettuaRicerca:function(){if(null==
this.getEdtData().getValue()||null==this.getCBFornitore().getValue())return Messaggio("ATTENZIONE","MSG_CAMPI_OBBLIGATORI","OK","INFORMATION"),this.naviga("prev"),!1;paginatore=this.getPaginatore();risultati=this.getRisultati().down("gridpanel");store=risultati.getStore();params={dataInizioUtilizzo:this.getEdtData().getValue(),idCliFor:this.getCBFornitore().getValue()};this.getCBDeposito().getValue()&&Ext.apply(params,{idDeposito:this.getCBDeposito().getValue()});this.getCBGruppo().getValue()&&Ext.apply(params,
{idGruppo:this.getCBGruppo().getValue()});this.getCBCategoria().getValue()&&Ext.apply(params,{idCategoria:this.getCBCategoria().getValue()});store.load({params:params,callback:function(a,b,c){c?Ext.isEmpty(a)?(Messaggio("RICERCA","NESSUN_ARTICOLO_PER_IL_FORNITORE_SELEZIONATO","OK","INFORMATION"),paginatore.setActiveTab(0)):risultati.getSelectionModel().deselectAll():msgShowError("",b.getError())}})},conferma:function(){var a=this,b=a.getRisultati().down("gridpanel");Ext.create("winCBA",{name:"GeneraliEC.trasferisciListini.view.ConfermaTrasfListini",
titolo:traduci("TRASFERISCI_LISTINO"),dimensione:3,altezzaWin:250,larghezzaWin:450,configItem:{selected:b.getSelectionModel().getSelection(),controllerRicerca:a,closeWindowCallback:function(c){c||(b.getSelectionModel().deselectAll(),a.indietro())}},closable:!0}).show()},onLaunch:function(){var a=this.getCBGruppo().getStore(),b=this.getCBCategoria().getStore(),c=this.getCBFornitore().getStore();this.idOrganizzazione=getIdOrg();a.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione};b.getProxy().extraParams=
{idOrganizzazione:this.idOrganizzazione};c.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,attivo:"T",limit:0};this.getEdtData().validate();this.getCBFornitore().validate();this.getEdtData().focus(!1,500);a=this.getRisultati();a.add(Ext.create(a.cbaConfig.url,{codVideataPwd:this.cbaConfig.codVideataPwd,controllerRicerca:this})).down("gridpanel").getSelectionModel().on("selectionchange",this.aggiornaSuSelezione,this);"L"==this.cbaConfig.permesso&&(this.getBtnAvanti().setDisabled(!0),
this.getBtnIndietro().setDisabled(!0));a=this.getCBDeposito().getStore();a.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,isInsert:"T"};a.load()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.trasferisciListini.controller.RisultatoTrasfListini",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"GridRisultato",selector:a.selContainer+"#GridRisultato"},{ref:"LblScelto",selector:a.selContainer+"#LblScelto"},{ref:"TxtCerca",selector:a.selContainer+"#TxtCerca"}]);a.control(a.selContainer+"#GridRisultato",{selectionchange:a.CambioSelezioneGriglia});a.control(a.selContainer+
"#TxtCerca",{change:Ext.Function.createBuffered(function(b){var c=a.getGridRisultato().getStore();c.clearFilter();c.filter(function(a){var c=!1;(a=a.get("desArticolo"))&&0<=a.toUpperCase().indexOf(b.getValue().toUpperCase())&&(c=!0);return c});b.focus();b.focus()},100,a)})},CambioSelezioneGriglia:function(a,b,c){var d=0;Ext.each(this.getGridRisultato().getSelectionModel().getSelection(),function(a){d+=1});this.getLblScelto().setText(traduci("SCELTO")+" ("+d+")")},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.trasferisciListini.store.RisultatoTrasfListini",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idCatalogo"},{name:"codArtFornitore"},{name:"desArticolo"},{name:"prezzo"},{name:"sconto1"},{name:"sconto2"},{name:"desUdm"},{name:"desAliquotaIva"}],proxy:{type:"ajax",url:"/cba/eco/of/ws/catalogoListino/procedure/trasferimListino/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/eco/of/ws/catalogoListino/procedure/trasferimListino/list"}},
autoDestroy:!0});
Ext.define("GeneraliEC.trasferisciListini.view.ConfermaTrasfListini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,flex:1,bodyPadding:10,layout:{align:"stretch",type:"vbox"},dockedItems:[{xtype:"toolbar",dock:"top",height:48,items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok32",scale:"large",text:"CONFERMA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-annulla32",scale:"large",
text:"ANNULLA"}]}],items:[{xtype:"fieldset",title:"PARAMETRI",layout:{type:"hbox"},items:[{xtype:"combobox",labelWidth:70,width:380,fieldLabel:"FORNITORE",labelClsExtra:"cbaLabel",itemId:"CBFornitore",reference:"CBFornitore",displayField:"valore",queryParam:"descrizione",valueField:"codice",store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor"),allowBlank:!1,minChars:3,margin:"10 0 10 0"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.trasferisciListini.view.RicercaTrasfListini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"tabpanel",itemId:"Paginatore",reference:"Paginatore",flex:1,tabBar:{height:48,items:[{xtype:"tbfill"},{xtype:"toolbar",border:0,items:[{xtype:"button",itemId:"BtnIndietro",reference:"BtnIndietro",iconCls:"icon-indietro",scale:"large",tooltip:"INDIETRO",disabled:!0},{xtype:"tbspacer",width:10},{xtype:"button",itemId:"BtnAvanti",
reference:"BtnAvanti",iconCls:"icon-avanti",tooltip:"AVANTI",scale:"large"},{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-elabora32",scale:"large",text:"ELABORA",disabled:!0}]}]},items:[{xtype:"form",itemId:"ParametriRicerca",reference:"ParametriRicerca",bodyPadding:10,border:0,tabConfig:{title:"RICERCA",height:44},fieldDefaults:{margin:"5 5 5 5"},layout:{type:"vbox"},noModificaDati:!0,trackResetOnLoad:!0,items:[{xtype:"fieldset",title:"PARAMETRI",width:this.larghezza,layout:{type:"vbox"},
items:[{xtype:"datefield",itemId:"EdtData",reference:"EdtData",fieldLabel:"DATA",labelClsExtra:"cbaLabel",allowBlank:!1,labelWidth:70,width:180},{xtype:"combobox",labelWidth:70,width:400,fieldLabel:"FORNITORE",labelClsExtra:"cbaLabel",itemId:"CBFornitore",reference:"CBFornitore",displayField:"valore",queryParam:"descrizione",valueField:"codice",store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor"),allowBlank:!1,minChars:3},{xtype:"combobox",width:400,fieldLabel:"DEPOSITO",labelClsExtra:"cbaLabel",
labelWidth:70,itemId:"CBDeposito",reference:"CBDeposito",displayField:"valore",queryParam:"descrizione",valueField:"codice",minChars:0,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi"),emptyText:"Tutti i Depositi"},{xtype:"combobox",width:400,fieldLabel:"GRUPPO",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBGruppo",reference:"CBGruppo",displayField:"valore",minChars:0,queryParam:"descrizione",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGruppi")},
{xtype:"combobox",width:400,fieldLabel:"CATEGORIA",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBCategoria",reference:"CBCategoria",displayField:"valore",minChars:0,queryMode:"local",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxCategorie"),disabled:!0}]}]},{xtype:"panel",itemId:"Risultati",reference:"Risultati",tabConfig:{title:"SELEZIONE",height:44},border:0,layout:{type:"fit"},cbaConfig:{url:"GeneraliEC.trasferisciListini.view.RisultatoTrasfListini"}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.trasferisciListini.view.RisultatoTrasfListini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.apply(this,{items:[{xtype:"gridpanel",border:0,itemId:"GridRisultato",reference:"GridRisultato",flex:1,selType:"checkboxmodel",viewConfig:{stripeRows:!0,loadMask:!1},store:Ext.create("GeneraliEC.trasferisciListini.store.RisultatoTrasfListini"),columns:[{xtype:"gridcolumn",dataIndex:"desArticolo",text:"ARTICOLO",flex:1},{xtype:"gridcolumn",dataIndex:"desUdm",
text:"UNITA_MISURA",align:"center",width:60},{xtype:"gridcolumn",dataIndex:"codArtFornitore",text:"CODICE_ARTICOLO_FOR",align:"center",renderer:cell_renderer_stringa},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"PREZZO",dataIndex:"prezzo",renderer:function(a,b,c,d,e,g,h){b.style="text-align:right !important";return Ext.util.Format.number(a,"0.00000,")}},{text:"SCONTO_PERC",columns:[{xtype:"gridcolumn",width:50,align:"center",sortable:!1,dataIndex:"sconto1",renderer:cell_renderer_importo},
{xtype:"gridcolumn",width:50,align:"center",sortable:!1,dataIndex:"sconto2",renderer:cell_renderer_importo}]},{xtype:"gridcolumn",dataIndex:"desAliquotaIva",text:"IVA",align:"center",width:60}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",width:200,fieldLabel:"",emptyText:"CERCA"}]},{xtype:"toolbar",dock:"bottom",items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"panel",height:20,width:300,layout:{type:"hbox",pack:"middle"},items:[{xtype:"label",
text:"SCELTO",itemId:"LblScelto",reference:"LblScelto",flex:1},{xtype:"label",itemId:"LblSceltoImp",reference:"LblSceltoImp",width:120,style:{"text-align":"right"}}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.ubicazioni.controller.AlberoUbicazioni",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TreeRep",selector:a+"#TreeRep"},{ref:"BtnNuovo",selector:a+"#BtnNuovo"},{ref:"BtnElimina",selector:a+"#BtnElimina"},{ref:"BtnConferma",selector:a+"#BtnConferma"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"TxtCerca",selector:a+"#TxtCerca"},{ref:"LblSelettore",selector:a+"#LblSelettore"}]);this.control(a+
"#TreeRep",{beforeitemcontextmenu:this.beforeitemcontextmenuTreeRep,beforeedit:this.beforeeditTreeRep,edit:this.editTreeRep,canceledit:this.canceleditTreeRep,validateedit:this.validateeditTreeRep,select:this.selectTreeRep,itemdblclick:this.itemdblclickTreeRep});this.control(a+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(a+"#BtnElimina",{click:this.clickBtnElimina});this.control(a+"#BtnConferma",{click:this.clickBtnConferma});this.control(a+"#BtnEsci",{click:this.clickBtnEsci});this.control(a+
"#TxtCerca",{change:Ext.Function.createBuffered(this.cercaTree,500,this)})},cercaTree:function(a){var b=this.getTreeRep(),c=b.getStore(),d=[];this.getLblSelettore().setVisible(!1);c.clearFilter();Ext.isEmpty(a.getValue())?(c.each(function(a){a.set("cls","")}),b.getSelectionModel().hasSelection()?b.ensureVisible(b.getSelectionModel().getSelection()[0]):b.getSelectionModel().select(0)):(c.each(function(b){if(b.isLeaf()){var c=!1,e=b.get("text");e&&0<=e.toUpperCase().indexOf(a.getValue().toUpperCase())&&
(c=!0);c?(b.set("cls","cba-dirty-record"),d.push(b)):b.set("cls","")}}),this.filtraPadri(c,d),this.getLblSelettore().setVisible(1<d.length),Ext.isEmpty(d)?b.getSelectionModel().select(0):(b.ensureVisible(d[0]),this.getLblSelettore().setText(traduci("NUM_ELEMENTI_TROVATI",[d.length]))));a.focus()},filtraPadri:function(a,b){a.filter(function(a){for(var c=!1,e=0,g=b.length;e<g;e++)if(a.contains(b[e])){c=!0;break}else if(a.isLeaf()&&(c=a===b[e]))break;return c})},itemdblclickTreeRep:function(a,b,c,d,
e,g){b.get("leaf")&&(1==this.cbaConfig.soloIntermedi?"I"==b.get("tipoCda")?this.selezionaEsci():msgShowError("","MSG_INTERMEDI"):this.selezionaEsci())},selezionaEsci:function(){var a=this.getBtnConferma();if(a.isVisible()){if(this.cbaConfig.afterConferma){var b=[];Ext.each(this.getTreeRep().getSelectionModel().getSelection(),function(a){a.get("leaf")&&b.push(a)});Ext.isEmpty(b)||this.cbaConfig.afterConferma(b)}a.up("window").close()}},clickBtnConferma:function(a){this.selezionaEsci()},clickBtnEsci:function(a){a.up("window").close()},
selectTreeRep:function(a,b){this.getBtnElimina().setDisabled(0===b.get("ubicaCode")||"L"==this.cbaConfig.permesso);this.cbaConfig.multiSelezione||this.getBtnConferma().setDisabled(0===b.get("ubicaCode")||!b.get("leaf"));if(!this.cbaConfig.onlyTree){var c=this.getTreeRep().up("#CntPrincipale").down("#FormUbicazioni").controller;c.idTestata=b.get("ubicaCode");c.getFormUbicazioni().setDisabled(0==b.get("ubicaCode"));c.hasChild=b.hasChildNodes();0!=b.get("ubicaCode")?c.aggiornaStore():clearForm(c.getFormUbicazioni())}},
beforeeditTreeRep:function(a,b,c){if(!0===a.editing||0===b.record.get("ubicaCode"))return!1;this.abilitaBottoniGrid(!1)},editTreeRep:function(a,b,c){var d=b.record.getData();c=a.getEditor().getForm();c.controller=this;c.store=this.getTreeRep().getStore();d={id:d.ubicaCode?d.ubicaCode:null,idOrganizzazione:getIdOrg(),idPadre:d.idPadre,descrizione:d.text};controller_salvaRecord(c,d,!1,!1)?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditTreeRep:function(a,b,c){this.abilitaBottoniGrid(!0);
this.aggiornaStore(b.record.get("ubicaCode"))},validateeditTreeRep:function(a,b,c){return msgShow("",[])},beforeitemcontextmenuTreeRep:function(a,b,c,d,e,g){return getPopupMenuTree(e,a)},aggiornaStore:function(a){var b=this.getTreeRep();b.getStore().load({params:{idOrganizzazione:this.cbaConfig.idOrganizzazione},callback:function(c,d,e){e?(c=b.getRootNode().findChild("ubicaCode",a,!0),b.expandAll(),c?(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0),b.getSelectionModel().select([c])):
(b.getSelectionModel().deselectAll(),b.getSelectionModel().select(0))):msgShowError("",d.getError())}})},clickBtnNuovo:function(){var a=this.getTreeRep();a.getStore();var b=a.getSelectionModel().getLastSelected();b.set("leaf",!1);b.appendChild({leaf:!0,idPadre:b.get("ubicaCode")});a.getView().refresh();b.expand();a.getPlugin().startEdit(b.lastChild,0);a.up("#CntPrincipale").down("#FormUbicazioni").controller.getFsTipoCda().setDisabled(!1);this.abilitaBottoniGrid(!1)},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);
this.getBtnElimina().setDisabled(!a)},clickBtnElimina:function(){var a=this,b=a.getTreeRep(),c=b.getSelectionModel().getSelection()[0],d=c.hasChildNodes()?"MSG_ELIMINA_NODO":"";controller_eliminaRecord(b.getStore(),{id:c?c.get("ubicaCode"):""},function(){a.aggiornaStore()},!1,d)},onLaunch:function(){var a=this.getTreeRep();this.cbaConfig.idOrganizzazione||(this.cbaConfig.idOrganizzazione=getIdOrg());a.controller=this;this.cbaConfig.onlyTree&&(this.getBtnConferma().setVisible(!0),this.getBtnEsci().setVisible(!0));
this.cbaConfig.multiSelezione&&(a.selModel.selectionMode="MULTI");this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.ubicazioni.controller.GestUbicazioni",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"FormUbicazioni",selector:this.selContainer+"#FormUbicazioni"},{ref:"IdForm",selector:this.selContainer+"#IdForm"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"}])},verificaCampiForm:function(){var a=[];this.getFormUbicazioni().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",
a)},salvaForm:function(a){var b=this.getFormUbicazioni(),c=b.getForm().getFieldValues();-9999==this.getIdForm().getValue()&&(c.idPadre=this.idTestata);Ext.apply(c,{idOrganizzazione:this.cbaConfig.idOrganizzazione});this.recordModificato=!0;controller_salvaRecord(b,c,a,{forzaRegistrazione:"F"})&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getFormUbicazioni();b.permesso=a.permesso;b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.storeUbicazioni;b.controller=
a;var c=Ext.create("Generali.standard.controller_PannelloBottoniVert",{cbaConfig:{conferma_callback:function(b){a.salvaForm(b)},annulla_callback:function(){a.recordModificato=!0;a.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(b);b.setDisabled(!1)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)||controller_eliminaRecord(b.store,{id:c},function(){a.recordModificato=!0;a.aggiornaStore()})},verificaCampiForm_callback:function(){return a.verificaCampiForm()}}});
inserisciBottoni(b.boxBottoni,c);b.boxBottoni.queryById("btnEsci").hide();if("L"!=b.permesso)b.getForm().on("dirtychange",function(a,c){controller_abilitaBottoni(b)});"L"==b.permesso&&containerSolaLettura(a.getContainer())},aggiornaStore:function(a){var b=this,c=b.storeUbicazioni,d=b.getFormUbicazioni();d.getForm();b.recordModificato?(b.recordModificato=!1,b.cbaConfig.controllerAlbero.aggiornaStore(a)):c.load({params:{id:b.idTestata},callback:function(a,c,h){h?(clearForm(d),a&&b.getFormUbicazioni().loadRecord(a[0])):
msgShowError("",c.getError())}})},onLaunch:function(){this.cbaConfig.idOrganizzazione||(this.cbaConfig.idOrganizzazione=getIdOrg());this.storeUbicazioni=Ext.create("GeneraliEC.ubicazioni.store.GestUbicazioni");this.gestioneForm()},destroy:function(){eliminaStore(this.storeUbicazioni);eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliEC.ubicazioni.controller.PnlGestUbicazioni",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntPrincipale",selector:this.selContainer+"#CntPrincipale"}])},onLaunch:function(){this.cbaConfig.idOrganizzazione||(this.cbaConfig.idOrganizzazione=getIdOrg());var a=Ext.create("GeneraliEC.ubicazioni.view.AlberoUbicazioni",{cbaConfig:{idOrganizzazione:this.cbaConfig.idOrganizzazione,permesso:this.cbaConfig.permesso,
idAnno:this.cbaConfig.idAnno,onlyTree:this.cbaConfig.onlyTree,multiSelezione:this.cbaConfig.multiSelezione,currentCda:this.cbaConfig.currentCda,controllerPadre:this,afterConferma:this.cbaConfig.afterConferma?this.cbaConfig.afterConferma:!1,idAnnoVideata:this.cbaConfig.idAnnoVideata}});this.getCntPrincipale().add({xtype:"panel",layout:"fit",flex:1,items:a});a.cbaConfig.onlyTree||this.getCntPrincipale().add({xtype:"panel",layout:"fit",flex:1,items:Ext.create("GeneraliEC.ubicazioni.view.GestUbicazioni",
{cbaConfig:{permesso:this.cbaConfig.permesso,idOrganizzazione:this.cbaConfig.idOrganizzazione,controllerAlbero:a.down("#TreeRep").controller}})})}});
Ext.define("GeneraliEC.ubicazioni.model.AlberoUbicazioni",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"ubicaCode"},{name:"idOrganizzazione"},{name:"idPadre"},{name:"idVisibile"},{name:"descrizione"},{name:"children"},{name:"text",convert:function(a,b){return b.get("idVisibile")?b.get("idVisibile")+" . "+b.get("descrizione"):b.get("descrizione")}},{name:"expanded"},{name:"leaf"},{name:"iconCls"}]});
Ext.define("GeneraliEC.ubicazioni.store.AlberoUbicazioni",{extend:"Ext.data.TreeStore",model:"GeneraliEC.ubicazioni.model.AlberoUbicazioni",autoLoad:!1,root:{expanded:!1},proxy:{type:"ajax",url:getUrlGen()+"/ws/ubicazioni/tree",reader:{type:"json",messageProperty:"message",rootProperty:"children"},api:{create:getUrlGen()+"/ws/ubicazioni/insert",update:getUrlGen()+"/ws/ubicazioni/update",destroy:getUrlGen()+"/ws/ubicazioni/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.ubicazioni.store.GestUbicazioni",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"idPadre"},{name:"idVisibile"},{name:"descrizione"}],proxy:{type:"ajax",url:getUrlGen()+"/ws/ubicazioni/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:getUrlGen()+"/ws/ubicazioni/get",create:getUrlGen()+"/ws/ubicazioni/insert",update:getUrlGen()+"/ws/ubicazioni/update",destroy:getUrlGen()+"/ws/ubicazioni/delete"}},autoDestroy:!0});
Ext.define("GeneraliEC.ubicazioni.view.AlberoUbicazioni",{extend:"Generali.standard.ControlledContainer",layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"treepanel",flex:1,width:300,border:0,viewConfig:{loadMask:!1,getRowClass:function(a,b,c,d){return a.get("cls")}},itemId:"TreeRep",reference:"TreeRep",store:Ext.create("GeneraliEC.ubicazioni.store.AlberoUbicazioni"),useArrows:!0,rootVisible:!1,columns:[{xtype:"treecolumn",dataIndex:"text",text:"UBICAZIONI",
autoScroll:!0,flex:1,editor:{xtype:"textfield",allowBlank:!1}}],dockedItems:[{xtype:"toolbar",dock:"top",padding:"5 10 5 10",items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",iconCls:"icon-inserisciGriglia",text:"Nuovo",hidden:!0},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",iconCls:"icon-eliminaGrtiglia",text:"Elimina",hidden:!0},{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok",text:"SELEZIONA_ESCI",hidden:!0},{xtype:"button",itemId:"BtnEsci",
reference:"BtnEsci",iconCls:"icon-esciGriglia",text:"ESCI",hidden:!0},{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",emptyText:"CERCA",width:300}]},{xtype:"label",border:0,dock:"top",hidden:!0,itemId:"LblSelettore",reference:"LblSelettore"}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.ubicazioni.view.GestUbicazioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",flex:1,layout:{align:"stretch",type:"hbox"},items:[{xtype:"form",flex:1,itemId:"FormUbicazioni",reference:"FormUbicazioni",autoScroll:!0,layout:{type:"vbox",align:"stretch"},bodyPadding:10,trackResetOnLoad:!0,items:[{xtype:"textfield",name:"id",itemId:"IdForm",reference:"IdForm",hidden:!0},{xtype:"textfield",name:"idOrganizzazione",
hidden:!0},{xtype:"textfield",name:"idPadre",hidden:!0},{xtype:"container",items:[{xtype:"numberfield",fieldLabel:"CODICE",name:"idVisibile",width:150,allowBlank:!1,maxLength:3,enforceMaxLength:!0,allowDecimals:!1,useThousandSeparator:!1,minValue:1,baseChars:"123456789",listeners:{afterrender:function(){this.maskRe=/^[1-9]/}}}]},{xtype:"textfield",fieldLabel:"DESCRIZIONE",name:"descrizione",allowBlank:!1,maxLength:100,enforceMaxLength:!0}]},{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",
width:120}]}]});this.callParent(arguments)}});Ext.define("GeneraliEC.ubicazioni.view.PnlGestUbicazioni",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntPrincipale",reference:"CntPrincipale",layout:{align:"stretch",type:"hbox"}}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.variazioneListini.controller.ConfermaVarListini",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:this.selContainer+"#BtnEsci"},{ref:"BtnConferma",selector:this.selContainer+"#BtnConferma"},{ref:"RgbTipoOpera",selector:this.selContainer+"#RgbTipoOpera"},{ref:"RgbTipoOpera2",selector:this.selContainer+"#RgbTipoOpera2"},{ref:"TxValore",selector:this.selContainer+
"#TxValore"}]);this.control(this.selContainer+"#BtnEsci",{click:this.esciClick});this.control(this.selContainer+"#BtnConferma",{click:this.conferma})},conferma:function(){var a=this;if(!a.getTxValore().getValue())return Messaggio("ATTENZIONE","MSG_CAMPI_OBBLIGATORI","OK","INFORMATION"),!1;var b=a.cbaConfig.selected.map(function(a){return a.get("id")}).join(",");Ext.Ajax.request({method:"GET",async:!1,url:"/cba/eco/of/ws/catalogoListino/procedure/variazPerForn/elabora",params:{elencoArticoli:b,aumentaDiminuisci:a.getRgbTipoOpera().getValue().rbTipoOpera,
importoPercentuale:a.getRgbTipoOpera2().getValue().rbTipoOpera2,valore:a.getTxValore().getValue(),dataInizioUtilizzo:a.cbaConfig.dataInizioUtilizzo},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(a.cbaConfig.controllerRicerca.effettuaRicerca(),a.esciClick()):msgShowError("",b.message)}})},esciClick:function(){this.getBtnEsci().up("window").close()},onLaunch:function(){this.getTxValore().validate()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.variazioneListini.controller.RicercaVarListini",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Paginatore",selector:this.selContainer+"#Paginatore"},{ref:"BtnAvanti",selector:this.selContainer+"#BtnAvanti"},{ref:"BtnIndietro",selector:this.selContainer+"#BtnIndietro"},{ref:"BtnElabora",selector:this.selContainer+"#BtnElabora"},{ref:"Risultati",selector:this.selContainer+"#Risultati"},
{ref:"EdtData",selector:this.selContainer+"#EdtData"},{ref:"CBGruppo",selector:this.selContainer+"#CBGruppo"},{ref:"CBCategoria",selector:this.selContainer+"#CBCategoria"},{ref:"CBDeposito",selector:this.selContainer+"#CBDeposito"},{ref:"CBFornitore",selector:this.selContainer+"#CBFornitore"}]);this.control(this.selContainer+"#BtnElabora",{click:this.conferma});this.control(this.selContainer+"#Paginatore",{beforetabchange:this.beforetabchangePaginatore,render:this.rendertabPaginatore});this.control(this.selContainer+
"#BtnAvanti",{click:this.avanti});this.control(this.selContainer+"#BtnIndietro",{click:this.indietro});this.control(this.selContainer+"#Paginatore",{tabchange:this.tabchangePaginatore});this.control(this.selContainer+"#CBGruppo",{change:this.changeCBGruppo})},changeCBGruppo:function(a,b){var c=this.getCBCategoria().getStore();b?c.load({params:{idGruppo:b}}):svuotaStore(c);this.getCBCategoria().setDisabled(!b)},disabilitaClickTab:function(){var a=this.getPaginatore();a.items.each(function(b){if(!Ext.isDefined(b.tab.giaCreato))b.tab.on("click",
function(){b.tab.giaCreato=!0;a.cambiaTab=!1})})},rendertabPaginatore:function(){this.disabilitaClickTab()},beforetabchangePaginatore:function(a,b,c,d){return a.cambiaTab},avanti:function(){this.naviga("next")},indietro:function(){this.naviga("prev")},naviga:function(a){var b=this.getPaginatore(),c=b.getLayout(),d=b.getActiveTab();b.cambiaTab=!0;a?(c[a](),"next"==a&&"ParametriRicerca"==d.itemId?this.effettuaRicerca():this.abilitaPulsanti(!0)):this.abilitaPulsanti(!0);return!0},abilitaPulsanti:function(a){var b=
this.getPaginatore().getActiveTab(),c=this.getBtnIndietro(),d=this.getBtnAvanti(),e=this.getBtnElabora();!1===a?(c.setDisabled(!0),d.setDisabled(!0),e.setDisabled(!0)):(c.setDisabled("ParametriRicerca"==b.itemId),d.setDisabled("Risultati"==b.itemId),e.setDisabled("Risultati"!=b.itemId||!b.down("gridpanel").getSelectionModel().selected.length))},aggiornaSuSelezione:function(a,b){this.abilitaPulsanti(!0)},tabchangePaginatore:function(a,b,c,d){this.abilitaPulsanti(!0)},effettuaRicerca:function(){if(null==
this.getEdtData().getValue()||null==this.getCBFornitore().getValue())return Messaggio("ATTENZIONE","MSG_CAMPI_OBBLIGATORI","OK","INFORMATION"),this.naviga("prev"),!1;paginatore=this.getPaginatore();risultati=this.getRisultati().down("gridpanel");store=risultati.getStore();params={dataInizioUtilizzo:this.getEdtData().getValue(),idCliFor:this.getCBFornitore().getValue()};this.getCBDeposito().getValue()&&Ext.apply(params,{idDeposito:this.getCBDeposito().getValue()});this.getCBGruppo().getValue()&&Ext.apply(params,
{idGruppo:this.getCBGruppo().getValue()});this.getCBCategoria().getValue()&&Ext.apply(params,{idCategoria:this.getCBCategoria().getValue()});store.load({params:params,callback:function(a,b,c){c?Ext.isEmpty(a)?(Messaggio("RICERCA","NESSUN_ARTICOLO_PER_IL_FORNITORE_SELEZIONATO","OK","INFORMATION"),paginatore.setActiveTab(0)):risultati.getSelectionModel().deselectAll():msgShowError("",b.getError())}})},conferma:function(){var a=this,b=a.getRisultati().down("gridpanel");Ext.create("winCBA",{name:"GeneraliEC.variazioneListini.view.ConfermaVarListini",
titolo:traduci("VARIAZIONE_LISTINI"),dimensione:3,altezzaWin:250,larghezzaWin:450,configItem:{selected:b.getSelectionModel().getSelection(),controllerRicerca:a,dataInizioUtilizzo:a.getEdtData().getValue(),closeWindowCallback:function(c){c||(b.getSelectionModel().deselectAll(),a.indietro())}},closable:!0}).show()},onLaunch:function(){var a=this.getCBGruppo().getStore(),b=this.getCBCategoria().getStore(),c=this.getCBFornitore().getStore();this.idOrganizzazione=getIdOrg();a.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione};
b.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione};c.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,attivo:"T",limit:0};this.getEdtData().validate();this.getCBFornitore().validate();this.getEdtData().focus(!1,500);a=this.getRisultati();a.add(Ext.create(a.cbaConfig.url,{codVideataPwd:this.cbaConfig.codVideataPwd,controllerRicerca:this})).down("gridpanel").getSelectionModel().on("selectionchange",this.aggiornaSuSelezione,this);"L"==this.cbaConfig.permesso&&(this.getBtnAvanti().setDisabled(!0),
this.getBtnIndietro().setDisabled(!0));a=this.getCBDeposito().getStore();a.getProxy().extraParams={idOrganizzazione:this.idOrganizzazione,isInsert:"T"};a.load()},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.variazioneListini.controller.RisultatoVarListini",{extend:"Generali.standard.ViewController",init:function(){var a=this;a.selContainer="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"GridRisultato",selector:a.selContainer+"#GridRisultato"},{ref:"LblScelto",selector:a.selContainer+"#LblScelto"},{ref:"TxtCerca",selector:a.selContainer+"#TxtCerca"},{ref:"BtnConferma",selector:a.selContainer+"#BtnConferma"}]);a.control(a.selContainer+"#GridRisultato",{selectionchange:a.CambioSelezioneGriglia});
a.control(a.selContainer+"#BtnConferma",{click:a.clickBtnConferma});a.control(a.selContainer+"#TxtCerca",{change:Ext.Function.createBuffered(function(b){var c=a.getGridRisultato().getStore();c.clearFilter();c.filter(function(a){var c=!1;(a=a.get("desArticolo"))&&0<=a.toUpperCase().indexOf(b.getValue().toUpperCase())&&(c=!0);return c});b.focus();b.focus()},100,a)})},clickBtnConferma:function(a){var b=this;a=b.getGridRisultato();var c=[],d=a.getStore().getRange();a.getSelectionModel().getSelection();
Ext.each(d,function(a){a.dirty&&c.push(a.data)});Ext.Ajax.request({method:"POST",url:"/cba/eco/of/ws/catalogoListino/procedure/variazPerForn/conferma",jsonData:Ext.JSON.encode(c),writer:{type:"json"},params:{dataInizioUtilizzo:b.controllerRicerca.getEdtData().getValue()},success:function(a){a=Ext.JSON.decode(a.responseText);var c=[];a.success?(msgAdd(c,a.message),b.controllerRicerca.effettuaRicerca()):msgAddError(c,a.message);msgShow("",c)}})},CambioSelezioneGriglia:function(a,b,c){var d=0;Ext.each(this.getGridRisultato().getSelectionModel().getSelection(),
function(a){d+=1});this.getLblScelto().setText(traduci("SCELTO")+" ("+d+")")},destroy:function(){this.callParent()}});
Ext.define("GeneraliEC.variazioneListini.store.RisultatoVarListini",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idCatalogo"},{name:"codArtFornitore"},{name:"desArticolo"},{name:"prezzo"},{name:"sconto1"},{name:"sconto2"},{name:"desUdm"},{name:"desAliquotaIva"}],proxy:{type:"ajax",url:"/cba/eco/of/ws/catalogoListino/procedure/variazPerForn/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/eco/of/ws/catalogoListino/procedure/variazPerForn/list"}},autoDestroy:!0});
Ext.define("GeneraliEC.variazioneListini.view.ConfermaVarListini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",border:0,flex:1,bodyPadding:10,layout:{align:"stretch",type:"vbox"},dockedItems:[{xtype:"toolbar",dock:"top",height:48,items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-ok32",scale:"large",text:"CONFERMA"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:"icon-annulla32",scale:"large",
text:"ANNULLA"}]}],items:[{xtype:"fieldset",title:"PARAMETRI",layout:{type:"hbox"},items:[{xtype:"radiogroup",columns:1,vertical:!0,itemId:"RgbTipoOpera",reference:"RgbTipoOpera",items:[{boxLabel:"AUMENTA",name:"rbTipoOpera",inputValue:"A",cls:"cbaLabel",checked:!0},{boxLabel:"DIMINUISCI",name:"rbTipoOpera",inputValue:"D",cls:"cbaLabel"}]},{xtype:"radiogroup",columns:1,vertical:!0,margin:"0 0 0 20",itemId:"RgbTipoOpera2",reference:"RgbTipoOpera2",items:[{boxLabel:"IMPORTO",name:"rbTipoOpera2",inputValue:"I",
cls:"cbaLabel",checked:!0},{boxLabel:"PERCENTUALE",name:"rbTipoOpera2",inputValue:"P",cls:"cbaLabel"}]},{xtype:"textfield",width:160,labelWidth:60,fieldLabel:"VALORE",itemId:"TxValore",reference:"TxValore",labelClsExtra:"cbaLabel",margin:"0 0 0 20",allowBlank:!1}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.variazioneListini.view.RicercaVarListini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"tabpanel",itemId:"Paginatore",reference:"Paginatore",flex:1,tabBar:{height:48,items:[{xtype:"tbfill"},{xtype:"toolbar",border:0,items:[{xtype:"button",itemId:"BtnIndietro",reference:"BtnIndietro",iconCls:"icon-indietro",scale:"large",tooltip:"INDIETRO",disabled:!0},{xtype:"tbspacer",width:10},{xtype:"button",itemId:"BtnAvanti",reference:"BtnAvanti",
iconCls:"icon-avanti",tooltip:"AVANTI",scale:"large"},{xtype:"button",itemId:"BtnElabora",reference:"BtnElabora",iconCls:"icon-elabora32",scale:"large",text:"ELABORA",disabled:!0}]}]},items:[{xtype:"form",itemId:"ParametriRicerca",reference:"ParametriRicerca",bodyPadding:10,border:0,tabConfig:{title:"RICERCA",height:44},fieldDefaults:{margin:"5 5 5 5"},layout:{type:"vbox"},noModificaDati:!0,trackResetOnLoad:!0,items:[{xtype:"fieldset",title:"PARAMETRI",width:this.larghezza,layout:{type:"vbox"},items:[{xtype:"datefield",
itemId:"EdtData",reference:"EdtData",fieldLabel:"DATA",labelClsExtra:"cbaLabel",allowBlank:!1,labelWidth:70,width:180},{xtype:"combobox",labelWidth:70,width:400,fieldLabel:"FORNITORE",labelClsExtra:"cbaLabel",itemId:"CBFornitore",reference:"CBFornitore",displayField:"valore",queryParam:"descrizione",valueField:"codice",store:Ext.create("Generali.anaCliFor.store.cboxAnaCliFor"),allowBlank:!1,minChars:3},{xtype:"combobox",width:400,fieldLabel:"DEPOSITO",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBDeposito",
reference:"CBDeposito",displayField:"valore",queryParam:"descrizione",valueField:"codice",minChars:0,store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxDepositi"),emptyText:"Tutti i Depositi"},{xtype:"combobox",width:400,fieldLabel:"GRUPPO",labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBGruppo",reference:"CBGruppo",displayField:"valore",minChars:0,queryParam:"descrizione",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxGruppi")},{xtype:"combobox",width:400,fieldLabel:"CATEGORIA",
labelClsExtra:"cbaLabel",labelWidth:70,itemId:"CBCategoria",reference:"CBCategoria",displayField:"valore",queryMode:"local",valueField:"codice",store:Ext.create("GeneraliEC.catalogoArticoli.store.CboxCategorie"),disabled:!0}]}]},{xtype:"panel",itemId:"Risultati",reference:"Risultati",tabConfig:{title:"SELEZIONE",height:44},border:0,layout:{type:"fit"},cbaConfig:{url:"GeneraliEC.variazioneListini.view.RisultatoVarListini"}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.variazioneListini.view.RisultatoVarListini",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.apply(this,{items:[{xtype:"gridpanel",border:0,itemId:"GridRisultato",reference:"GridRisultato",flex:1,selType:"checkboxmodel",viewConfig:{stripeRows:!0,loadMask:!1},store:Ext.create("GeneraliEC.variazioneListini.store.RisultatoVarListini"),columns:[{xtype:"gridcolumn",dataIndex:"desArticolo",text:"ARTICOLO",flex:1},{xtype:"gridcolumn",dataIndex:"desUdm",
text:"UNITA_MISURA",align:"center",width:60},{xtype:"gridcolumn",dataIndex:"codArtFornitore",text:"CODICE_ARTICOLO_FOR",align:"center",renderer:cell_renderer_stringa},{xtype:"gridcolumn",width:90,align:"center",sortable:!1,text:"PREZZO",dataIndex:"prezzo",renderer:cell_renderer_importo,style:{"font-weight":"bold"},editor:{xtype:"numberfield",selectOnFocus:!0,decimalPrecision:5},renderer:function(a,b,c,d,e,g,h){b.tdCls="cbaGrassetto";return'<div style="text-align:right;">'+Ext.util.Format.number(a,
"0.00000,")+"</div>"}},{text:"SCONTO_PERC",style:{"font-weight":"bold"},columns:[{xtype:"gridcolumn",width:50,align:"center",sortable:!1,dataIndex:"sconto1",renderer:cell_renderer_importo,editor:{xtype:"numberfield",selectOnFocus:!0},renderer:function(a,b,c,d,e,g,h){b.tdCls="cbaGrassetto";return'<div style="text-align:right;">'+Ext.util.Format.number(a,"0.00,")+"</div>"}},{xtype:"gridcolumn",width:50,align:"center",sortable:!1,dataIndex:"sconto2",renderer:cell_renderer_importo,editor:{xtype:"numberfield",
selectOnFocus:!0},renderer:function(a,b,c,d,e,g,h){b.tdCls="cbaGrassetto";return'<div style="text-align:right;">'+Ext.util.Format.number(a,"0.00,")+"</div>"}}]},{xtype:"gridcolumn",dataIndex:"desAliquotaIva",text:"IVA",align:"center",width:60}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,onSpecialKey:function(a,b,c){if(c.getKey()===c.TAB){c.stopEvent();c.position=this.context;if(a)a.onEditorTab(c);b=a.getRefOwner().getSelectionModel();this.completeEdit();return b.onEditorTab(a.editingPlugin,
c)}}})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",itemId:"TxtCerca",reference:"TxtCerca",width:200,fieldLabel:"",emptyText:"CERCA"},{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:"icon-conferma",text:"Conferma"}]},{xtype:"toolbar",dock:"bottom",items:[{xtype:"container",layout:{type:"vbox"},items:[{xtype:"panel",height:20,width:300,layout:{type:"hbox",pack:"middle"},items:[{xtype:"label",text:"SCELTO",itemId:"LblScelto",reference:"LblScelto",flex:1},
{xtype:"label",itemId:"LblSceltoImp",reference:"LblSceltoImp",width:120,style:{"text-align":"right"}}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliEC.winSblocca.controller.WinSblocca",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"PnlPrincipale",selector:this.selContainer+"#PnlPrincipale"}])},loadData:function(){var a=this.getPnlPrincipale();a.removeAll();a.add(Ext.create(this.cbaConfig.url),{cbaConfig:this.cbaConfig})},destroy:function(){this.cbaConfig.callBackChiusura&&this.cbaConfig.callBackChiusura();this.callParent()}});
Ext.define("GeneraliEC.winSblocca.view.WinSblocca",{extend:"CbaUtils.componenti.all.PanelAttivaFunzioniCBA",initComponent:function(){var a=this.cbaConfig;Ext.apply(this,{messaggioAttivazione:StdEconomato.coalesce(a.messaggioAttivazione,this.messaggioAttivazione),nomeFunzioneDaAttivare:StdEconomato.coalesce(a.nomeFunzioneDaAttivare,this.nomeFunzioneDaAttivare),codiceFunzione:StdEconomato.coalesce(a.codiceFunzione,this.codiceFunzione)});Ext.applyIf(this,{items:[{xtype:"panel",itemId:"PnlPrincipale",
reference:"PnlPrincipale",layout:{align:"stretch",type:"hbox"}}]});this.callParent(arguments)}});