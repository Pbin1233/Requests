var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
var _destructuring=[].push.apply([],[].concat($jscomp.arrayFromIterable([])));function convertiBool(a){var b=[],c;for(c in a)b.push(c);var d;b.forEach(function(b){d=a[b];"boolean"==typeof d&&(a[b]=getBoolValue(d))});return a}function campiTempInString(a,b){var c=[],d=[],e;for(e in a)-1!=e.indexOf("_tmp")&&(c.push(e),1==a[e]&&d.push(e.substr(5)));c.forEach(function(b){delete a[b]});var f=[],g=b?b:";",h,k;d.forEach(function(b){f=b.split("_");h=f[0];k=a[h];a[h]=k?k+g+f[1]+g:g+f[1]+g});return a}
function caricaFieldString(a,b,c){if(Ext.isEmpty(b))return!1;var d={},e=b;Ext.String.endsWith(b,";")&&(e=b.substring(0,b.length-1));var f;e.split(";").forEach(function(a){""!=a&&(f="_tmp_"+c+"_"+a,d[f]=!0)});a.getForm().setValues(d)}
function genFieldsDinamiciCss(a,b,c,d,e,f,g){var h=null;Ext.Ajax.request({method:"GET",url:c,params:d,success:function(c){var d=Ext.JSON.decode(c.responseText);c=[];if(d.success){var g;0<d.data.length&&(d.data[0].label||msgAdd(c,"Problema server: campi entity non ancora standardizzata"),d.data.forEach(function(c){switch(b){case "checkbox":g={xtype:"checkboxfield",labelWidth:80,boxLabel:traduci(c.label),checked:!1,name:c.inputValueStr,inputValue:"T",uncheckedValue:"F",cls:"cbaCssOptionField"};break;
case "radio":g={name:a.cbaConfig.name,boxLabel:traduci(c.label),inputValue:Ext.isNumber(c.inputValueInt)?c.inputValueInt:c.inputValueStr,cls:"cbaCssOptionField",cbaConfig:{deselezionabile:!0}};break;case "checkboxstring":g={xtype:"checkboxfield",name:e?e+(Ext.isNumber(c.inputValueInt)?c.inputValueInt+"":c.inputValueStr):!1,boxLabel:traduci(c.label),inputValue:Ext.isNumber(c.inputValueInt)?c.inputValueInt+"":c.inputValueStr,cls:"cbaCssOptionField"}}f&&(g.listeners=f);a.add(g);a.cbaConfig.dati=d.data}),
h=d.data)}else msgAddError(c,d.message);msgShow("",c)},callback:function(){g&&g(h)}})}function eliminaCampiTmp(a){var b=[],c;for(c in a)-1!=c.indexOf("_tmp")&&b.push(c);b.forEach(function(b){delete a[b]});return a}
function monthName(a,b,c){if(0<=a&&12>a){var d="Gennaio Febbraio Marzo Aprile Maggio Giugno Luglio Agosto Settembre Ottobre Novembre Dicembre".split(" "),e="January February March April May June July August September October November December".split(" ");c=c?e:d;return b?c[a].substr(0,3)+".":c[a]}return""}function objToTree(a,b){var c={},d,e;for(e in a)-1==e.indexOf("_tmp")&&(d=e.split(b||"$"),1==d.length?c[d[0]]=a[e]:2==d.length&&(c[d[0]]||(c[d[0]]={}),c[d[0]][d[1]]=a[e]));return c}
function dmyIsEqual(a,b){var c=b?b:new Date;return a.getDate()==c.getDate()&&a.getMonth()==c.getMonth()&&a.getFullYear()==c.getFullYear()}
function initToolbarCbaCss(a,b){var c=a.getHeader(),d=a.titolo?a.titolo:" ";c.removeAll();if(a.videoHelp){var e=Ext.create("Ext.Img",{itemId:"ImgVideo",src:"https://cdn4.iconfinder.com/data/icons/social-messaging-ui-color-shapes-2-free/128/social-youtube-circle-128.png",height:20,width:20,margin:"0 3 0 3",listeners:{afterrender:function(a){creaToolTipBubble(a.getId(),"",!1,60,200,{xtype:"fieldset",layout:{type:"hbox"},items:[{xtype:"image",src:"https://cdn4.iconfinder.com/data/icons/social-messaging-ui-color-shapes-2-free/128/social-youtube-circle-128.png",
height:32,width:32},{xtype:"label",html:"<center>"+traduci("CLICK_VIDEO_GUIDA")+"</center>",cls:"cbaLabel",margin:"5 5 5 5",flex:1}]},!1,!1,!0);a.getEl().on("click",function(){alert("riproduci video")});a.getEl().setStyle("cursor","hand")}}});c.insert(0,e)}d=Ext.create("Ext.form.Label",{itemId:"LabelTitoloWinCss",margin:"5 0 0 5",cls:"cbaCssLabelTitolo",text:d});c.insert(1,d);c.insert(2,Ext.create("Ext.container.Container",{flex:1}));if(Ext.isDefined(b)&&b){if(!a.hideInfoUser){var d=b.dataNascitaFormatted&&
null!=b.dataNascitaFormatted?b.dataNascitaFormatted:"",e=b.codFisc&&null!=b.codFisc?b.codFisc:"",f=b.sesso&&null!=b.sesso?b.sesso:"",g="";b.residenza&&null!=b.residenza.desSede&&(g=b.residenza.desSede);var h="";b.residenza&&null!=b.residenza.desReparto&&(h=b.residenza.desReparto);var k="";b.residenza&&null!=b.residenza.desStanza&&(k=b.residenza.numStanza);var l="";b.residenza&&null!=b.residenza.desLetto&&(l=b.residenza.desLetto);var n="<b>"+traduci("CS_DATA_NASCITA")+"</b> "+d+"</br>\n\t\t\t\t<b>"+
traduci("CF")+":</b> "+e+"</br>\n\t\t\t\t<b>"+traduci("SESSO")+":</b> "+f+"</br>\n\t\t    \t<b>"+traduci("SEDE")+":</b> "+g+"</br>\n\t\t\t\t<b>"+traduci("REPARTO")+":</b> "+h+"</br>\n\t\t\t\t<b>"+traduci("STANZA")+":</b> "+k+"</br>\n\t\t\t\t<b>"+traduci("POSTO_LETTO")+":</b> "+l,d=Ext.create("Ext.button.Button",{height:17,width:17,iconCls:"icon-info",cls:"cbaBtnFunzione-mini",margin:"0 15 0 0",handler:function(a){var b=Ext.create("winCBA",{permesso:"S",larghezzaWin:350,altezzaWin:230,name:[{xtype:"container",
layout:{type:"vbox",align:"stretch"},style:"line-height:25px",cls:"cbaCssLabel",flex:1,margin:"0 5 5 5",html:n}],titolo:"TITOLO_ANAGRAFICA_UTENTE_CSS",maximizable:!1,closable:!0}).show(),c=a.getPosition()[0]+a.getWidth()-350;a=a.getPosition()[1]+a.getHeight();b.showAt(c,a)}});c.insert(3,d)}a.hideFotoOspite||(d=Ext.create("CbaUtilsCss.componenti.desktop.CssImgOspite",{itemId:"ImgFotoUtente",reference:"ImgFotoUtente",margin:"0 5 0 0",cbaConfig:{codOspite:b.codOspite}}),c.insert(4,d));d=b.cognome+" "+
b.nome;Ext.isEmpty(b.dataNascita)||a.hideDataDiNascita||(d+=" ("+FormattaData(b.dataNascita)+")");d=Ext.create("Ext.form.Label",{margin:"5 5 0 0",cls:"cbaCssLabelTitolo",text:""+d});c.insert(5,d)}if(!a.widgetMode){var p=Ext.create("Ext.slider.Single",{width:70,margin:"0 10 0 5",value:2,increment:1,minValue:0,maxValue:2,useTips:!1,style:{cursor:"pointer"},listeners:{change:function(b,c,d,e){if(null==Ext.EventObject||-1!=Ext.EventObject.target.id.indexOf("slider"))switch(c){case 0:a.setHeight(20);break;
case 1:a.setHeight(320);break;case 2:a.setHeight(a.altezzaWin)}},afterRender:function(a){var b=Ext.create("Ext.container.Container",{layout:{type:"hbox",pack:"center"},items:[{xtype:"image",src:"/cba/css/generali/images/generali/arrows/arrow-left.svg",height:16,width:16,margin:"10 0 0 0"},{xtype:"label",html:"<center>"+traduci("TRASCINA_RIDUCI_FINESTRA")+"</center>",cls:"cbaLabel",margin:5,flex:1},{xtype:"image",src:"/cba/css/generali/images/generali/arrows/arrow-right.svg",height:16,width:16,margin:"10 0 0 0"}]});
creaToolTipBubble(a.getId(),"","",!1,160,b,!1,!1,!0)}}});c.insert(5,p);a.on("resize",function(a,b,c){320>=c&&60<c?p.setValue(1):60>c?p.setValue(0):p.setValue(2)})}a.iniTool=!0}
function cssCreaWinSelDiario(a,b,c,d,e){b=void 0===b?"CS.diari.view.Diario":b;d=void 0===d?!1:d;e=void 0===e?{}:e;var f=CBA.moduli.modulo49.listaVideateDiari,g=0,h=0;b=b||"CS.diari.view.Diario";f.each(function(a,b){"S"===a.get("permessoVideata")&&(g++,h=b)});if(1===g){var k=f.getAt(h).get("idTipoDiario"),l=f.getAt(h).get("codVideata"),n=f.getAt(h).get("descrizione");creaSuperWin(b,k,n,a,600,480,{userStandAlone:c,params:e},d,l);return!1}Ext.create("winCBA",{bodyPadding:10,maximizable:!1,titolo:traduci("CREA_DIARIO_FLASH"),
closable:!0,layout:"fit",modal:!0,listeners:{afterrender:function(g){g.add({xtype:"container",items:[{xtype:"combobox",itemId:"CboxSceltaDiario",reference:"CboxSceltaDiario",margin:"3 0 0 0",width:200,store:f,emptyText:traduci("SELEZIONA_TIPO_DIARIO"),labelClsExtra:"cbaCssLabel",queryMode:"local",displayField:"descrizione",valueField:"idTipoDiario",listConfig:{tpl:'<tpl for="."><li role="option" class="x-boundlist-item" style="list-style-type: none;  "> <div style="height:50px;width:50px;display:inline-block;"><img src="/cba/css/generali/images/generali/allegato-file.svg" height="30" width="30"> </div><div style="display: inline-block;">{descrizione}</div></li></tpl>'},
listeners:{select:function(f,g){if(!Ext.isEmpty(g)){var h=g.get("descrizione"),k=g.get("codVideata"),l=g.get("idTipoDiario");creaSuperWin(b,l,h,a,600,480,{userStandAlone:c,params:e},d,k);Ext.defer(function(){f.up("window").close()},500)}},afterrender:function(a){a.expand()},expand:function(a){a.getStore().filterBy(function(a){return"S"===a.get("permessoVideata")})}}}]})}}}).show()}
function blockDash(a,b){CBA.moduli.modulo49.bloccaPortlet=a;var c=CBA.moduli.modulo49.controllerDashboard;if(c){if(!c.destroyed){var d=c.getCntCruscotto().query("[itemId=PortletStd]");Ext.isEmpty(d)||"portlet"!==c.tipoDashboard||d.forEach(function(c){var d=c.up(c.controller.cbaConfig.viewPortlet),e=d.queryById("IcnSuperView"),f=d.queryById("IcnCreate"),d=d.queryById("IcnDetails");f&&f.setHidden(a);d&&!b&&d.setHidden(a);e&&e.setHidden(a);b||(c=c.query("gridpanel"),Ext.isEmpty(c)||c.forEach(function(b){a?
b.suspendEvents():b.resumeEvents()}))})}if(null!=b&&!b){var e=CBA.moduli.modulo49.controllerCercaAnagrafica.getParametriRicerca().up("panel"),f=0!=e.getCollapsed(),d=Sipcar.app.getController("Menu").getCardApplicativo().getLayout().getActiveItem().down("#pnlAnadettab49"),g=CBA.parametriGenerali.cmpTbMenu.down("tabpanel").down("#tab49").down("toolbar"),h=CBA.moduli.modulo49.controllerCercaAnagrafica.CtrlMenu.getTabApplicativi().down("#BtnTipologia"),c=[e,c.btnImpostazioniDh,Sipcar.app.getController("Menu").getBtnMenuSipcar(),
c.containerOpzioni];Ext.isEmpty(h)||c.push(h);for(h=0;h<c.length;h++)c[h].setDisabled(a);containerSolaLettura(d,a);Ext.each(g.items.items,function(b){0==b.getItemId().indexOf("btnnull")&&b.setDisabled(a)});Ext.defer(function(){f||e.collapse()},500)}}}
function creaSuperWin(a,b,c,d,e,f,g,h,k){a=Ext.create("CSS_WinCBASuper",{name:a,bodyPadding:10,titolo:c,isPortlet:d,larghezzaWin:void 0===e?600:e,altezzaWin:void 0===f?480:f,resizable:!0,modal:void 0===h?!1:h,configItem:{superWin:!0,codVideata:void 0===k?null:k,anagraficaCorrente:g.userStandAlone||CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data,sottoTipoTestata:b,permesso:"S",extraConfig:g}});CBA.moduli.modulo49.superDiario=a.getId();a.cssDefaultShow();return a}
function abilitaFullScreen(a,b,c,d,e){a=a.getHeader();a.queryById("BtnResizeWin")||a.insert(5,{xtype:"button",itemId:"BtnResizeWin",reference:"BtnResizeWin",width:25,height:25,iconCls:"x-tool-img x-tool-tool-el x-tool-maximize",padding:"7 0 0 0",style:{background:"trasparent !important",border:"none !important",width:"25px !important",height:"25px !important"},listeners:{click:function(a,b,c){b=a.up("window");b.maximizzato?(a.setIconCls("x-tool-img x-tool-tool-el x-tool-maximize"),b.restore(),b.maximizzato=
!1):(a.setIconCls("x-tool-img x-tool-tool-el x-tool-restore"),b.maximizzato=b.maximize());e&&e()},afterrender:function(a){creaToolTipBubble(a.getId(),"ESPANDI_IN_FULL_SCREEN",null,null,null,null,null,null,!0)}}})}function descNomeProfUser(a){var b=CBA.moduli.modulo49.operatore,c=b.descr,b=b.figuraProfessionale;return a?b:c+" ("+b+")"}function cssHasBloccoSosia(a){return(a=cssGetBlocchi(a))&&"SI"===a[1]||"SA"===a[1]?!0:!1}
function cssGetBlocchi(a){var b=[];if(a&&0<a.length&&Ext.isDefined(a[0].codice)&&-1!=a[0].codice){var c=a[0].valore;a=a[0].extra;switch(c){case "S":case "B":b.push("WR",c,"B"==c?a:"");break;case "A":case "SA":b.push("DEL",c,a);break;case "P":b.push("SOME",c,a);break;case "C":case "M":case "L":case "SI":b.push("LOCK",c,a);break;default:b.push("SCONOSCIUTO",c,a),CBA.parametriGenerali.produzione||alert("Info Sviluppo: tipoBlocco non riconosciuto in fn cssGetBlocchi!")}}else CBA.parametriGenerali.produzione||
alert("Info Sviluppo WS: campo tipoBlocco deve restituire almeno un elemento valido!");return b}function cssHasBloccoModifica(a){return"WR"!=cssGetBlocchi(a)[0]}
function bloccaFormCss(a,b,c,d){b=!0===b?!0:!1;if(a){containerSolaLettura(a,b);containerSolaLettura(a.controller.getPnlCompilatore(),!0);a.cbaConfig.lock=b;d&&Ext.isArray(d)&&Ext.each(d,function(a){containerSolaLettura(a,b)});(d=a.boxBottoni?a.boxBottoni.queryById("btnElimina"):!1)&&(a.controller.modeAnnullabile?d.setDisabled(!d.cbaConfig.recordAnnullabile):d.setDisabled("L"==a.permesso||b));(d=a.boxBottoniSpecial?a.boxBottoniSpecial.queryById("btnConvalidaManuale"):!1)&&d.setHidden(!d.cbaConfig.recordConvalidabile);
Ext.each(a.query("cbaFieldsetHtmlEditor"),function(a){a.setSolaLettura(b)});c&&Ext.each(a.query("button"),function(a){a.setDisabled(b)});var e,f=a.controller.getPnlCompilatore();a.cbaConfig.idTooltipLock&&(Ext.getCmp(a.cbaConfig.idTooltipLock).destroy(),a.cbaConfig.idTooltipLock=!1,Ext.isDefined(f)&&(e=f.down("#PanelRecordAnnullato"),e.hide(),e.down("#LabelAnnullatoData").setText("")));var g=!1;b&&a.controller&&a.controller.cbaConfig.controllerTestata&&Ext.isDefined(a.controller.cbaConfig.controllerTestata.getCntRegistrazioni)&&
Ext.each(a.controller.cbaConfig.controllerTestata.getCntRegistrazioni().query("button"),function(b){if(b.cbaConfig.idRec&&b.cbaConfig.idRec==a.controller.testataSelezionata&&b.recordAnnullato&&(g="deleted",Ext.isDefined(f))){e=f.down("#PanelRecordAnnullato");b=" "+traduci("IL_GIORNO");var c,d=a.controller.cbaConfig.controllerTestata.storeRegistrazioni,h=d.findExact("id",parseInt(a.controller.testataSelezionata));Ext.isNumber(h)&&-1!=h&&(c=d.getAt(h),c=c.get("deletedData"));b+=" "+Ext.Date.format(Ext.Date.parse(c,
"c"),"d/m/Y");b+=" "+traduci("ALLE").toLowerCase()+" "+Ext.Date.format(Ext.Date.parse(c,"c"),"H:i");e.down("#LabelAnnullatoData").setText(b);e.show()}});c=!1;var h;a.controller&&a.controller.cbaConfig.controllerTestata&&a.controller.cbaConfig.controllerTestata.storeRegistrazioni?h=(c=cssTrovaRecordTestata(a))?c.get("tipoBlocco"):null:!c&&a.cbaConfig.tipoBlocco&&(h=a.cbaConfig.tipoBlocco);if(c=a.controller.getView().down("cssPnlBozza"))c.closePanel(),h&&"B"==cssGetBlocchi(h)[1]&&c.showPanel("L"==a.permesso);
"S"==a.permesso&&b&&h&&"SOME"==cssGetBlocchi(h)[0]?(cssAbilitaModificaTerzi(a,!0),g="unlocked"):cssAbilitaModificaTerzi(a,!1);h&&cssHasBloccoSosia(h)&&a.boxBottoni.query('button:not([itemId="btnNuovo"]):not([itemId="btnEsci"]):not([itemId="btnElimina"]):not([itemId="btnCopia"])').forEach(function(a){a&&a.setDisabled(!0)});c=cssGetWarningHours(h);b&&creaToolTipLock(a,g,c);(c=a.cbaConfig.secondaryForm)&&c.cbaConfig.secondaryFormLock&&c.cbaConfig.secondaryFormLock(h,b,g)}}
function cssAbilitaModificaTerzi(a,b){var c=a.query("[modificaTerzi]");Ext.each(c,function(a){b&&(containerSolaLettura(a,!b),Ext.each(a.query("cbaFieldsetHtmlEditor"),function(a){a.setSolaLettura(!b)}));b?a.addCls("css-area-modificabile"):a.removeCls("css-area-modificabile")})}function cssTraduciTipoBlocco(a){var b="";Ext.each(a,function(a){3!=a&&(b+="<br>",b+=traduci("CSSREGTIPOBLOCCO_"+a))});return b}
function margineStdBtnFunzione(a){Ext.each(a.query("button"),function(a){a.setMargin("0 2 0 2")})}function ImpostaNuovoDefault(a,b){a.cbaConfig.controllerTestata.cbaConfig.nuovo=b;a.cbaConfig&&a.cbaConfig.controllerTestata&&a.cbaConfig.controllerTestata.cbaConfig&&a.cbaConfig.controllerTestata.cbaConfig.controllerTestata&&a.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig&&(a.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.nuovoDefault=b)}
function cbaTabToTab(a){var b=a.layout.overflowHandler;b.cbaConfig.tabBar=a;b.cbaConfig.tabToTab=!0;b.scrollIncrement=0;var c=[];Ext.each(a.query("tab"),function(a){a.isVisible()&&c.push(a.x)});var d=[];for(a=c.length-1;0<=a;)d.push(c[a]),a--;b.posizione=0;b.fineCorsa=!1;b.on("scroll",function(a,b,c){a.fineCorsa=0!=b&&b==a.posizione?!0:!1;a.posizione=b});b._beforeScroller.on("click",function(){if(0<b.posizione){var a=!1;Ext.Array.each(d,function(c,d){!a&&b.posizione>c&&(a=d)});b.scrollTo(d[a],!0)}});
b._afterScroller.on("click",function(){if(!b.fineCorsa){var a=!1;Ext.Array.each(c,function(c,d){!a&&b.posizione<c&&(a=d)});b.scrollTo(c[a],!0)}})}
function creaToolTipLock(a,b,c){var d="deleted"===b?c?"css-lock-annullato-warning":"css-lock-annullato":"unlocked"===b?"css-unlock":"css-lock",e="deleted"===b?"cbabubble-error":"cbabubble-warning";c&&"deleted"!==b&&(d+="-warning");b=a.getId();var f=Ext.create("Ext.tip.ToolTip",{id:Ext.id(),target:b,delegate:"",title:!1,html:!1,cls:e,bodyCls:"cbabubble-text-color-blue",items:[{xtype:"image",src:"/cba/css/generali/images/generali/"+d+".svg",height:32,width:32}],height:32,width:32,closable:!1,autoHide:!0,
trackMouse:!0,dismissDelay:6E5,layout:{type:"fit"},listeners:{hide:function(b){Ext.defer(function(){var c=a.getId(),d=!1,e,f=0,g=0;Ext.WindowManager.zIndexStack.each(function(a){(e=a.down("form"))&&e.getId()==c&&(f=g);g++});f==g&&(d=!0);Ext.getCmp(c)&&a.cbaConfig.idTooltipLock&&d&&b.show()},100)}}});a.cbaConfig.idTooltipLock=f.getId();a.on("destroy",function(a){f.destroy()});return f}
function calcolaDataDiScadenza(a,b,c,d){d=void 0===d?!0:d;if(!b||!a)return setToolTip(!1,c.getId(),"NESSUNA_FREQUENZA_INSERITA","SCADENZA_TEST",50,180),!1;var e=null;b=b.data;var f=b.numero,g=null;switch(b.tipo){case "G":e=new Date((new Date(a)).setDate(a.getDate()+f));break;case "M":e=(new moment(a)).add(f,"M").toDate();break;case "S":f*=7,e=new Date((new Date(a)).setDate(a.getDate()+f))}e=Ext.Date.format(e,"d/m/Y");d&&(a=c.up("CssAgenda").down("FakeCbaMultipleChoice"),g=Ext.isEmpty(a.idAgenda)?
null:a.idAgenda);cbaValidId(g)?setToolTip(!1,c.getId(),"Click per informazioni","SCADENZA_TEST",50,180):(a=Ext.create("Ext.container.Container",{layout:{type:"hbox",align:"center",pack:"center"},flex:1,items:[{xtype:"image",imgCls:"icon-cartella-btn-left",width:20,height:16},{xtype:"label",text:e,cls:"cbaCssLabel"},{xtype:"image",imgCls:"icon-cartella-btn-right",width:20,height:16}]}),setToolTip(!1,c.getId(),"","SCADENZA_TEST",50,180,a));return e}
function sommaDataOra(a,b){var c;a?(c=Ext.Date.add(a,Ext.Date.HOUR,b?b.getHours():0,!0),b&&(c=Ext.Date.add(c,Ext.Date.MINUTE,b.getMinutes(),!0))):c=new Date;return c}function cssVisualizzaTab(a,b,c){var d=a.items.items;a=a.getTabBar().items.items;var e=0,f;Ext.each(d,function(a){a.getItemId()==b&&(f=e);e++});a[f].setHidden(!c);d[f].setHidden(!c);return f}function cercaObjInArray(a,b,c){var d=[null,-1];Ext.Array.findBy(a,function(a,f){a[c]==b&&(d=[a,f])});return d}
function MessaggioPrint(a,b,c){Ext.create("winCBA",{name:"GeneraliCS.componenti.view.MsgBoxPrint",titolo:b,altezzaWin:130,larghezzaWin:320,closable:!1,expandable:!1,maximizable:!1,configItem:{parametriStampa:a,messaggio:c}}).show()}function caricaPortletCSS(a,b,c,d){b=b?b:a.controllerContenuto;d||b.fireEvent("cleanPortlet");a.portletLoaded=!1;if(c||!a.cbaConfig.collapsedFromSchema)b.fireEvent("updatePortlet"),a.portletLoaded=!0}
function cssCaricaImpoVideata(a,b,c,d){Ext.isEmpty(b)||(a.storeImpostazioni=Ext.create(b),d&&(a.storeImpostazioni.getProxy().url=d),a.cbaConfig.testataGen&&ImpostaUrl([a.storeImpostazioni]),a.storeImpostazioni.load({params:{idProfilo:a.idProfilo},callback:function(b,d,g){g?c&&c(a,b[0]):msgShowError("",d.getError())}}))}
function genCodQualificatore(a,b,c,d,e){var f="",g=a[0];b||c||d?"b"==g||"e"==g?f=b?f+(a+"."+b):null:"s"==g?f+=a+"."+(b?b:" ")+(c?c:" ")+(d?d:" "):"d"==g&&("0"==e?f+=a+"."+(b?b:" ")+"_":"1"==e&&(f+=a+"._"+(b?b:" "))):f=null;return f}function genCodQualificatoreNew(a,b,c,d,e,f){var g="",h=a[0];b||c||d||e||f?"b"==h||"e"==h?g=b?g+(a+"."+b):null:"s"==h?g+=a+"."+(b?b:" ")+(c?c:" ")+(d?d:" "):"d"==h&&(e?g+=a+"."+(e?e:" ")+"_":f&&(g+=a+"._"+(f?f:" "))):g=null;return g}
function decodeQualificatore(a){var b={icf:null,qualificatore1:null,qualificatore2:null,qualificatore3:null,qualificatorePerf:null,qualificatoreCap:null},c;a&&-1!=a.indexOf(".")&&(c=a.split("."),a=b.icf=c[0],a=a[0],c=c[1],"b"==a||"e"==a?b.qualificatore1=c:"s"==a?(" "!=c[0]&&(b.qualificatore1=c[0])," "!=c[1]&&(b.qualificatore2=c[1])," "!=c[2]&&(b.qualificatore3=c[2])):"d"==a&&(a=c.split("_"),""!=a[0]?(b.qualificatorePerf=a[0],b.qualificatoreCap=null):(b.qualificatorePerf=null,b.qualificatoreCap=a[1])));
return b}function ajaxCall(a,b,c){return new Promise(function(d,e){a.load({params:b,callback:function(a,b,h){h?(c&&c(a),d(a)):e(""+b.getError())}})})}
function inizializzaVideateDiari(a,b){if(CBA.moduli.modulo49.listaVideateDiari)if(CBA.moduli.modulo49.listaVideateDiariTipologia!=CBA.parametriGenerali.idProfiloCss)delete CBA.moduli.modulo49.listaVideateDiari;else return!1;Ext.apply(CBA.moduli.modulo49,{listaVideateDiariTipologia:CBA.parametriGenerali.idProfiloCss});var c=Ext.create("GeneraliCS.listaVideate.store.ListaDiari",{});Ext.each(a.children,function(a){a.portletList&&0<a.portletList.length&&Ext.each(a.portletList,function(a){Ext.each(a.listaVideate,
function(a){"N"!=a.tipoPermesso&&"CS.diari.view.Diario"==a.voceMenu.nomeForm&&c.add({codVideata:a.codVideata,idTipoDiario:a.voceMenu.idModuloPrg,descrizione:a.voceMenu.descrizione,permesso:a.voceMenu.id,permessoVideata:a.tipoPermesso})})})});Ext.apply(CBA.moduli.modulo49,{listaVideateDiari:c})}
function initCssPanelAnagrafica(a){Ext.require("GeneraliCS.anagrafica.view.CruscottoPnlAnagrafica");Ext.require("GeneraliCS.anagrafica.view.CruscottoSpecialButtons");a.add(Ext.create("GeneraliCS.anagrafica.view.CruscottoPnlAnagrafica",{}));a.add(Ext.create("GeneraliCS.anagrafica.view.CruscottoSpecialButtons",{}))}
function inizializzaRicercaRapidaCss(a,b){if(CBA.moduli.modulo49.ricercaRapida)return!1;CBA.moduli.modulo49.dizionarioLogVideate?(CBA.moduli.modulo49.dizionarioLogVideate={},CBA.moduli.modulo49.dizionarioLogVideate_escluse=[]):Ext.apply(CBA.moduli.modulo49,{dizionarioLogVideate:{},dizionarioLogVideate_escluse:[]});var c=Ext.create("GeneraliCS.ricercaRapida.store.RicPortlets",{}),d=Ext.create("GeneraliCS.ricercaRapida.store.RicVideate",{}),e=Ext.create("GeneraliCS.ricercaRapida.store.RicRapida",{}),
f=Ext.create("GeneraliCS.listaVideate.store.RicVideate",{});Ext.each(a.children,function(a){a.portletList&&0<a.portletList.length&&Ext.each(a.portletList,function(a){c.insert(0,{id:a.id,idBottone:a.idBottone});f.insert(0,a);Ext.each(a.listaVideate,function(b){if("S"==b.tipoPermesso||"L"==b.tipoPermesso){d.insert(0,{id:b.voceMenu.id,idPortlet:a.id});var c=b.voceMenu.descrizione,f=b.desVideata;e.insert(0,{id:Ext.id(),tipo:"V",codice:b.voceMenu.id,titolo:traduci(b.desVideata),ricerca:f!=c?f+" "+c:f})}c=
b.desVideata;f=[1];if(b.voceMenu.nomeForm){var g=CBA.moduli.modulo49,h=g.dizionarioLogVideate,g=g.dizionarioLogVideate_escluse;-1==g.indexOf(b.voceMenu.nomeForm)&&(h[b.voceMenu.nomeForm]?(g.push(b.voceMenu.nomeForm),delete h[b.voceMenu.nomeForm]):h[b.voceMenu.nomeForm]={desVideata:c,portletLog:f.includes(a.tipoPortlet)})}})})});Ext.apply(CBA.moduli.modulo49,{elencoVideate:{storeListVid:f}});Ext.apply(CBA.moduli.modulo49,{ricercaRapida:{storePortlets:c,storeVideate:d,storeRicerca:e,comboRicerca:Ext.create("Ext.form.ComboBox",
{store:e,queryMode:"local",displayField:"titolo",valueField:"id",width:220,margin:"0 5 0 10",emptyText:traduci("DIGITA_NOME_FUNZIONE"),hidden:!0,listeners:{collapse:function(a){CBA.moduli.modulo49.ricercaRapida.functionRicerca(a,a.getValue())}}}),functionRicerca:function(a,c){if(c)if(CBA.moduli.modulo49.storeAnagraficaSel&&0<CBA.moduli.modulo49.storeAnagraficaSel.getCount()){var d=CBA.moduli.modulo49.ricercaRapida,e=d.storeRicerca,f=e.getAt(e.findExact("id",c));if(f){var g,h,k,u=b.getActiveTab().query("button");
"V"==f.get("tipo")&&(h=d.storeVideate.getAt(d.storeVideate.findExact("id",f.get("codice"))),g=d.storePortlets.getAt(d.storePortlets.findExact("id",h.get("idPortlet"))),k=g.get("idBottone"),Ext.each(u,function(b){if(b.cbaConfig.id&&k&&b.cbaConfig.id==k){b.handler(b);var c=0,d=Ext.Function.interval(function(){500>c?b.cbaConfig.controllerVideata&&b.cbaConfig.controllerVideata.fineCreazionePortlets&&Ext.each(b.cbaConfig.controllerVideata.listaPortletsCreati,function(b){b.down()&&b.cbaConfig.idPortletGetMenu==
g.get("id")&&"function"===typeof b.down().controller.apriPortletDiretto&&(b.down().controller.apriPortletDiretto(h),clearInterval(d),a&&a.setValue(),e.clearFilter(),a&&a.setHidden(!0))}):clearInterval(d);c++},20)}}))}}else a.setValue(),CBA.moduli.modulo49.ricercaRapida.storeRicerca.clearFilter(),a.setHidden(!0),msgShow("UTENTE_NON_SELEZIONATO","NECESSARIO_SEL_UTENTE")}}});var g=Sipcar.app.getController("Menu").getCardApplicativo().getLayout().getActiveItem().down("#pnlAnadettab49").down("#ContainerFlash");
g.add(CBA.moduli.modulo49.ricercaRapida.comboRicerca);Ext.apply(CBA.moduli.modulo49.ricercaRapida);g.add({xtype:"button",iconCls:"css-apri-ric-rapida",cls:"cbaCssBtnAnagrafica",width:32,height:36,tooltip:traduci("CSS_RICERCA_RAPIDA_FUNZIONE"),handler:function(a){a=CBA.moduli.modulo49.ricercaRapida;a.comboRicerca.setVisible(a.comboRicerca.isHidden());a.comboRicerca.isHidden()?a.comboRicerca.setValue():a.comboRicerca.focus()}})}
function doLogVideata(a,b){b=void 0===b?{}:b;a.videataLoggata=!0;a&&a.cbaConfig&&a.cbaConfig.logOspite&&Ext.isString(a.cbaConfig.logOspite)&&-1!==a.cbaConfig.logOspite.indexOf("idRicovero_")&&Ext.apply(b,{logOspite:a.logOspite});var c=b.logOspite&&Ext.isString(b.logOspite)&&-1!==b.logOspite.indexOf("idRicovero_")?parseInt(b.logOspite.substr(11)):null;c||(a&&a.cbaConfig.controllerTestata&&a.cbaConfig.controllerTestata.cbaConfig.controllerTestata&&a.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.standAlone&&
1==a.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.standAlone?c=a.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.anagraficaDaGestione:a&&a.cbaConfig.controllerTestata&&a.cbaConfig.controllerTestata.anagraficaCorrente?c=a.cbaConfig.controllerTestata.anagraficaCorrente:a&&a.cbaConfig.controllerTestata&&a.cbaConfig.controllerTestata.cbaConfig.standAlone&&a.cbaConfig.anagraficaExtra?c=a.cbaConfig.anagraficaExtra:a.cbaConfig.anagraficaExtra&&(c=a.cbaConfig.anagraficaExtra));
var d=b.desVideata,e=b.logOspite,f=CBA.moduli.moduloAttivo,g=Ext.isEmpty(b.tipoOperazione)?"V":b.tipoOperazione,h=CBA.parametriGenerali.codUtente,k=CBA.parametriGenerali.nomeUtente,l=CBA.parametriGenerali.codEntePwd,n=null,p=null,t=null,q=null,r={};e&&(c=Ext.isEmpty(c)?CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0].data:c,n=c.nominativo,p=c.codOspite,t=c.idRicovero,q="A");Ext.apply(r,{idEnte:l,idModulo:f,funzione:d,tipoOperazione:g,userName:k,userId:h,idRicovero:t,tipoSoggetto:q,idSoggetto:p,
nomeSoggetto:n});Ext.Ajax.request({method:"POST",url:"/cba/gen/ws/log/new",jsonData:Ext.JSON.encode(r),success:function(a){a=Ext.JSON.decode(a.responseText);a.success||msgShowError("",a.message)}})}function inizializzaBottoniRapidiCss(){}function returnListVid(a){var b;Ext.each(CBA.moduli.modulo49.elencoVideate.storeListVid.data.items,function(c){if(c.get("idPortlet")==a)return b=c.get("listaVideate"),!0});return b}
function findVideata(a,b,c,d){b=void 0===b?null:b;c=void 0===c?null:c;d=void 0===d?null:d;var e=null;CBA.moduli.modulo49.elencoVideate.storeListVid.getData().items.filter(function(f){var g=f.getData();f=g.idPortlet;(g=g.listaVideate)&&(b&&f==b||!b)&&(f=null,a?f=g.find(function(b){return b.codVideata==a}):d&&(f=g.find(function(a){return a.codVideata.startsWith(d)})),!f||c&&f.tipoPermesso!=c||(e=f))});return e}
function initRicercaAvanzataMobile(a,b,c,d,e,f,g){var h=Ext.create("Ext.form.FieldSet",{layout:{type:"hbox",align:"middle",pack:"center"},margin:"7 0 0 5",nonDisabilitare:!0,items:[{xtype:"button",cls:"cba-css-button-light",iconCls:"icon-filter-off",itemId:"BtnAvanzate",reference:"BtnAvanzate",width:35,scale:"medium",height:35}]});a.add(h);b.winRicerca=Ext.create("winCBA",{name:"GeneraliCS.componenti.view.RicercaAvanzata",titolo:"",maximizable:!1,header:!1,larghezzaWin:f||420,altezzaWin:g||0==g?null:
200,configItem:{controllerTestata:b,hideFiltriBase:c,filtriPerson:d,callbackFn:e}});b.addRef([{ref:"BtnAvanzate",selector:b.selContainer+"#BtnAvanzate"}]);b.clickBtnAvanzate=function(a){b.showWinRicerca(a)};b.showWinRicerca=function(a){var c=b.winRicerca;c.showAt(a.getX()-c.width+a.getWidth(),a.getY()+a.getHeight())};b.control(b.selContainer+"#BtnAvanzate",{click:b.clickBtnAvanzate})}
function initRicercaAvanzataCartella(a,b,c,d,e,f,g){var h=Ext.create("Ext.form.FieldSet",{layout:{type:"hbox"},margin:"7 0 0 5",cls:"cbaCssFieldset-dark",nonDisabilitare:!0,items:[{xtype:"slider",itemId:"FiltriAttivi",reference:"FiltriAttivi",width:40,value:0,increment:1,minValue:0,maxValue:1,margin:"5 10 10 5",height:32,fieldLabel:traduci("FILTRA"),labelAlign:"top",labelClsExtra:"cbaCssLabel cba-label-no-padding",labelSeparator:""},{xtype:"button",itemId:"BtnAvanzate",reference:"BtnAvanzate",cls:"cbaCssBtnAvanzate",
width:106,height:30,margin:"14 5 0 5",text:traduci("CS_FILTRI_OFF")}]});a.add(h);b.winRicerca=Ext.create("winCBA",{name:"GeneraliCS.componenti.view.RicercaAvanzata",titolo:"",maximizable:!1,header:!1,layout:"fit",larghezzaWin:f||420,altezzaWin:g||0==g?null:200,configItem:{controllerTestata:b,hideFiltriBase:c,filtriPerson:d,callbackFn:e}});b.addRef([{ref:"BtnAvanzate",selector:b.selContainer+"#BtnAvanzate"},{ref:"FiltriAttivi",selector:b.selContainer+"#FiltriAttivi"}]);b.clickBtnAvanzate=function(a){a.cbaConfig.attivo&&
b.showWinRicerca(a)};b.showWinRicerca=function(a){var c=b.winRicerca;Ext.defer(function(){c.showAt(a.getX()-c.width+a.getWidth(),a.getY()+a.getHeight())},300)};var k=this;k.labelFiltriAttivi=traduci("CS_FILTRI_AVANZATI");k.labelFiltriOff=traduci("CS_FILTRI_OFF");b.changeFiltriAttivi=function(a,c){var d=1==c;(b.getBtnAvanzate().cbaConfig.attivo=d)?(b.getBtnAvanzate().setText(k.labelFiltriAttivi),b.showWinRicerca(b.getBtnAvanzate())):(b.getBtnAvanzate().setText(k.labelFiltriOff),a.cbaConfig.aggiornaDati&&
b.aggiornaStore())};b.control(b.selContainer+"#BtnAvanzate",{click:b.clickBtnAvanzate});b.control(b.selContainer+"#FiltriAttivi",{change:b.changeFiltriAttivi});b.filtriAttivi=b.getFiltriAttivi();b.filtriAttivi.cbaConfig.aggiornaDati=!0}
function initFiltriConsegna(a,b,c,d,e){e=e||!1;c=c||!1;if((d=d||!1)&&!c)return a.setHidden(!0),!1;c&&a.add(c);d||(b=[{xtype:"container",layout:{type:"hbox"},padding:3,items:[{xtype:"checkbox",hidden:!e,margin:"0 0 0 0",boxLabel:traduci("ALLEGATI"),name:"allegati",inputValue:"T",uncheckedValue:"F"},{xtype:"checkbox",margin:"0 0 0 15",boxLabel:traduci("DA_EVIDENZIARE"),name:"eventoEvidenzia",inputValue:"T",uncheckedValue:"F"}]}],a.add(b))}
function cssFiltriStdOff(a){a&&a.cbaConfig.controllerTestata&&a.cbaConfig.controllerTestata.filtriAttivi&&(a=a.cbaConfig.controllerTestata.filtriAttivi,a.cbaConfig.aggiornaDati=!1,a.setValue(0),a.cbaConfig.aggiornaDati=!0)}
function setColorContainer(a,b,c,d,e,f,g){d=d||"#5fa2dd";e=e||"1a4977";d=Ext.isEmpty(b)?d:b;b||(labelColor=e);if(a){e=a.getEl();var h=Ext.create("Ext.draw.Color",{});h.setFromString(d);var k=h.createDarker(.3);Ext.isEmpty(f)||(h.a=f,d=h.toString());a.setStyle("background",d);Ext.each(e.query("span"),function(a){a.style.color=Ext.isEmpty(b)?labelColor:g?"black":c?"white".toString():k.toString()});Ext.each(a.query("label"),function(a){a.getEl().setStyle("color",Ext.isEmpty(b)?labelColor:g?"black":c?
"white".toString():k.toString())})}}
function cssOpenGestFree(a,b,c,d,e,f,g,h,k,l,n){l=void 0===l?null:l;n=void 0===n?!1:n;b=b?b:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data;Ext.apply(a,{voceMenu:a});Ext.apply(a.voceMenu,{descrizione:a.titoloVideata,titolo:a.titoloVideata,nascondiTestata:a.nascondiTestata});c=Ext.create("CSS_winCBA",{name:"GeneraliCS.popup.view.Popup",titolo:" ",visualizzaAnagrafica:b,configItem:{standAlone:!0,elencoVideate:[a],iconaPortlet:a.iconaPortlet,nuovoDefault:g?g:!1,videataDettaglio:a.nomeForm,permesso:a.tipoPermesso,
codOspitePopUp:b.codOspite,nominativoPopUp:b.cognome+b.nome,portlet:!1,anagraficaDaGestione:b,callbackOnOpen:e,callbackOnExit:f,selezioneTestata:c,soloUnaTestata:k?k:"F",dataTestataDiretta:d,importSosia:n,sottoTipoTestata:h,anagraficaExtra:b}});Ext.isObject(l)&&Ext.apply(c.configItem,l);c.cssDefaultShow();c.impostaTitolo(a.titoloVideata.toUpperCase())}
function cssUtenteByCodospite(a,b){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/anagrafica/fascicolo/get",async:!1,params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.data;a.success?b&&Ext.isFunction(b)&&b(c):msgShowError("",a.message)}})}function cssTrovaFormStd(a){var b=Ext.isDefined(a.getForm)?a.getForm():!1,c;b?c=b:(a=Ext.getCmp(a.controllerForm.containerId),Ext.isDefined(a)&&(c=a.down("form")));return c}
function cssSetAnnullabile(a){a.annullabile=!0;var b=a.getBoxBottoni().queryById("btnElimina");b.on("afterrender",function(b){b.setText(traduci("ANNULLA"));b.testo=traduci("ANNULLA");b.nonDisabilitare=!0;b.cssModeAnnullabile=!0;a.modeAnnullabile=!0;a.storeForm.controller=a});var c=cssTrovaFormStd(a);if(c)c.getForm().on("dirtychange",function(a,c){b.setDisabled(c||!b.cbaConfig.recordAnnullabile)})}function cssShowTip(a,b){var c=window.event.x,d=window.event.y;c&&d?a.showAt(c,d):a.showBy(b)}
function cssAbilitaConvalida(a,b,c){c=void 0===c?function(){return null}:c;a.convalidaManuale=!0;var d=a.storeForm.getProxy().api.read,e;if(d&&""!=d){var f=d.split("/"),f=f[Ext.isEmpty(f.length-1)?f.length-2:f.length-1];e=d.replace("/"+f,"/convalida")}else CBA.parametriGenerali.produzione||alert("Info Sviluppo: url create non trovato! Inserire nello store form.");a.getBoxBottoniSpecial().insert(a.getBoxBottoniSpecial().items.items.length,{xtype:"container",layout:{type:"hbox",align:"stretch",pack:"end"},
flex:1,items:[{xtype:"button",itemId:"btnConvalidaManuale",reference:"btnConvalidaManuale",textHint:traduci("CONVALIDA"),iconCls:"box-convalida-css",cls:"cbaBtnFunzione-mini",margin:"1 2 0 0",width:30,hidden:!0,handler:function(){Messaggio("ATTENZIONE","MSG_CONFERMA_CONVALIDA","YESNO","QUESTION","",function(){if(a.bozzaExists)return Messaggio("ATTENZIONE","MSG_INFO_BOZZA_OPEN","OK","WARNING"),!1;if(a.progetti&&a.schedaConvertita&&!a.verificaCampiForm())return a.getTabPanel().setActiveTab(0),!1;if(a.verificaPrimaDiConvalida&&
!a.verificaFormPrimaDiConvalida())return!1;var d={id:a.testataSelezionata};b&&Ext.apply(d,b);Ext.Ajax.request({method:"GET",url:e,params:d,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?(a.aggiornamentoTestata=!0,a.aggiornaStore(b.data.id||a.testataSelezionata,b),a.azionePostConvalida&&a.azionePostConvalida(),c()):msgShowError("",b.message)}})},function(){return!1})},listeners:{afterrender:function(a){a.on("mouseover",function(a){if(!a.isDisabled()){a.cbaTip||(a.cbaTip=Ext.create("CbaIconBtnTip",
{html:a.textHint,cls:"cba-tip-button",listeners:{show:function(a){Ext.defer(function(){Ext.isDefined(a)&&(a.destroyed||a.hide())},7E3)}}}));a.cbaTip.setStyle("opacity",.1);var b=a.getPosition();a.cbaTip.showAt(b[0],b[1]+a.getHeight());a.cbaTip.showAt(b[0]-a.cbaTip.getWidth()/2+a.getWidth()/2,b[1]+a.getHeight());a.cbaTip.setStyle("opacity",1)}});a.on("mouseout",function(a){a.isDisabled()||a.cbaTip.hide()});a.on("destroy",function(a){a.cbaTip&&a.cbaTip.destroy()});setBadgeImage(a,"/cba/css/generali/images/warning/alert.svg",
"topleft","css-arancio",14)}}}]});var g=a.getBoxBottoniSpecial().queryById("btnConvalidaManuale");if(d=cssTrovaFormStd(a))d.getForm().on("dirtychange",function(b,c){g.setHidden(a.testataSelezionata?c:!0)})}
function cssTrovaRecordTestata(a){if(a.controller&&a.controller.cbaConfig.controllerTestata){var b=a.controller.cbaConfig.controllerTestata.storeRegistrazioni;a=a.controller.testataSelezionata;Ext.isString(a)&&""!=a&&(a=parseInt(a));return b.getAt(b.findExact("id",a))}alert("Info Sviluppo: Passare il controller alla form!")}function cbaValidId(a){a=parseInt(a);return Ext.isNumber(a)&&0<=a}
function cssEnableAll(a){if(CBA.parametriGenerali.produzione)return!1;a=cssTrovaFormStd(a);bloccaFormCss(a,!1);a.boxBottoni.down("#btnElimina").setDisabled(!1);a.up("container").down("#PnlCompilatore").down("datefield").setReadOnly(!1)}function accertamentiCalcColoreEsame(a){switch(a.get("codEsameRoutine")?"x":a.get("tipo").toLowerCase()){case "e":a="verdescuro";break;case "v":a="arancio";break;case "x":a="viola";break;case "r":a="rosso";break;default:a="nero"}return a}
function openAttachment(a,b){Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/allegati/link",params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success&&(Ext.isEmpty(a.data)||window.open(getPathServer()+a.data.filePath),b&&b())}})}
function cssImpostazioniConsegne(){var a=Ext.create("GeneraliCS.store.PersonConsegne",{autoLoad:!1});Ext.isEmpty(a)||a.load({params:{idProfilo:CBA.parametriGenerali.idProfiloCss},callback:function(a,c,d){d?Ext.isDefined(CBA.moduli.modulo49)&&!Ext.isEmpty(a)&&(CBA.moduli.modulo49.impostazioniConsegne=a[0]):msgShowError("",c.getError())}})}
function cssCreaConsegna(a,b,c,d,e,f,g,h,k,l,n){k=void 0===k?{}:k;l=void 0===l?!0:l;var p,t=CBA.moduli.modulo49.impostazioniConsegne,q=!1,r=["Diari$D"];t&&(p=a.cbaConfig.tipoConsegna)&&(a.cbaConfig.tipoTestata&&r.forEach(function(b){b.includes(a.cbaConfig.tipoTestata)&&(p=b.split("$")[1])}),r=Ext.create("CS.consegne.store.TipoConsegna"),(r=trovaRecord(r,"abbreviazione",p))&&(q="T"==t.data[r.get("columnTblPersonConsegne")]));-1<["A1","B1","C1","D1","E1"].indexOf(a.cbaConfig.tipoConsegna)&&(q=!0);n||
(n=a.lookup("BoxBottoniSpecial"));n&&(n.setMargin("0 0 0 5"),n.insert(0,{xtype:"button",itemId:"BtnConsegna",reference:"BtnConsegna",disabled:"S"!=b,hidden:!q,text:traduci("CS_CREA_CONSEGNA"),cls:"cbaCssBtnFunzione-special",width:130,margin:"0 1 0 0",cbaConfig:{consegnaAbilitata:q},handler:function(l){l={controllerForm:a,consegna:a.cbaConfig.consegna,filtriPerson:d,fnInizializzaFiltri:e,fnVerifiCampiConsegne:f,campoNote:c,permesso:b,hideFiltriBase:g,showAllegati:h};Ext.apply(l,k);if(!a.cbaConfig.consegna||
!cbaValidId(a.cbaConfig.consegna.idRiferimento))return Messaggio(traduci("ATTENZIONE"),traduci("CS_COMPILARE_PRIMA"),"OK","QUESTION"),!1;a.win=Ext.create("winCBA",{name:"CS.consegne.view.Consegne",titolo:"",larghezzaWin:900,altezzaWin:600,maximizable:!1,visualizzaAnagrafica:a.cbaConfig.anagraficaCorrente,configItem:l});a.win.setTitolo=function(b){a.win.getHeader().down("#LblOperazioni").setText(b)};a.win.show();l=a.win.getHeader();var p=Ext.create("Ext.form.Label",{cls:"cbaCssLabelTitolo",text:a.cbaConfig.anagraficaCorrente.nominativo,
itemId:"LblNominativo"}),n=Ext.create("Ext.form.Label",{cls:"cbaCssLabelTitolo",itemId:"LblOperazioni"});l.insert(0,n);l.insert(1,Ext.create("Ext.toolbar.Fill",{}));l.insert(3,p);a.win.setTitolo(a.nuovaConsegna?traduci("CS_INSERIMENTO_CONSEGNA"):traduci("CS_GESTISCI_CONSEGNA"))}}),l&&(n.insert(1,Ext.create("Ext.container.Container",{layout:{type:"hbox",align:"center",pack:"begin"},padding:4,margin:"0 2 0 4",items:[{xtype:"label",cls:"cbaCssLabel",margin:"2 0 0 6",itemId:"LblStatoConsegna",reference:"LblStatoConsegna"}]})),
a.addRef([{ref:"LblStatoConsegna",selector:a.selContainer+"#LblStatoConsegna"}]),a.afterrenderLblStatoConsegna=function(b){b.getEl().on("click",function(){a.consegnaLetta&&a.cbaConfig.consegna.compilatoreConsegna==CBA.moduli.modulo49.operatore.id&&Ext.create("winCBA",{name:"CS.consegne.view.InfoConsegne",larghezzaWin:760,titolo:"CS_INFORMAZIONI_STATO_CONSEGNA",altezzaWin:445,maximizable:!1,configItem:{idConsegna:a.cbaConfig.consegna.idConsegna}}).showAt(b.getX(),b.getY()+b.getHeight())})},a.control(a.selContainer+
"#LblStatoConsegna",{afterrender:a.afterrenderLblStatoConsegna})));if(l)a.getForm().getForm().on("dirtychange",function(b,c){var d=a.getForm().getForm().findField("id").getValue(),e=n.down("#BtnConsegna");e.setDisabled(c);if(!cbaValidId(d)||!cbaValidId(d)&&a.resetBtnCosegna)setStatoConsegna(!1,a.getLblStatoConsegna()),a.resetBtnCosegna=!1,e.setText(traduci("CS_CREA_CONSEGNA"))})}
function cssGestioneConsegna(a,b,c,d){Ext.suspendLayouts();d||(d=b.lookup("BoxBottoniSpecial").down("#BtnConsegna"));var e=!1,f=!1;a=a.isModel?a.getData():a;cssHasBloccoModifica(a.tipoBlocco)?e=!1:f="B"==a.tipoBlocco[0].valore;Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/consegne/getStatoConsegnaByRiferimento",params:{idRiferimento:a.id,tipoConsegna:b.cbaConfig.tipoConsegna},success:function(g){var h=Ext.JSON.decode(g.responseText);g=h.data;h.success?(b.cbaConfig.consegna=g,b.consegnaLetta=
cbaValidId(g.idConsegna)&&g.letta,b.nuovaConsegna=!cbaValidId(g.idConsegna),Ext.apply(b.cbaConfig.consegna,{idRiferimento:a.id,compilatoreReg:a.compilatore,isRegAnnullata:e,compilatoreConsegna:g.compilatoreConsegna}),b.getLblStatoConsegna&&setStatoConsegna(g,b.getLblStatoConsegna()),d.cbaConfig.consegnaAbilitata&&(h=a.compilatore||CBA.moduli.modulo49.operatore.id,d.setHidden(g.idConsegna&&CBA.moduli.modulo49.operatore.id!=g.compilatoreConsegna||CBA.moduli.modulo49.operatore.id!=h||e&&b.nuovaConsegna),
f&&d.setHidden(!0),d.setText(traduci(b.nuovaConsegna?traduci("CS_CREA_CONSEGNA"):traduci("CS_GESTISCI_CONSEGNA"))),c&&c())):msgShowError("",h.message)}});Ext.resumeLayouts(!0)}
function cssSuperDiario(a,b){b=void 0===b?null:b;var c=null,d=!1;b?(c=b,d=!0):c=a.getBoxBottoni?a.getBoxBottoni():a.lookup("BoxBottoni");var e=[],e=c.query("button"),e=e.length-1;d||(c=c.down("panel"));c.insert(e,{nonDisabilitare:!0,xtype:"button",hidden:0==CBA.moduli.modulo49.listaVideateDiari.getCount(),itemId:"BtnSuperDiario",reference:"BtnSuperDiario",cls:"cbaBtnFunzione-mini",iconCls:"box-superDiario-css",testo:traduci("CREA_DIARIO_FLASH"),textHint:traduci("CREA_DIARIO_FLASH"),margin:"0 5 0 2",
handler:function(b){cssCreaWinSelDiario(!1,null,a.cbaConfig.anagraficaCorrente)}});if(null!=a.getForm&&a.getForm())a.getForm().getForm().on("dirtychange",function(a,b){0!=CBA.moduli.modulo49.listaVideateDiari.getCount()&&c.queryById("BtnSuperDiario").setDisabled(b)})}
function setStatoConsegna(a,b){var c;if(Ext.isEmpty(a)||Ext.isEmpty(a.idConsegna))b.setHtml("");else{if(a.letta){var d="<strong>"+a.numeroLettori+"</strong>";c='<span style="color: #86C567;">'+traduci("CS_CONSEGNA_LETTA")+"</span>";b.cbaConfig.tooltip&&(b.cbaConfig.tooltip.destroy(),delete b.cbaConfig.tooltip);b.cbaConfig.tooltip=creaToolTipBubble(b.getEl(),traduci("CS_CONSEGNA_LETTA_DA")+" "+d+" "+traduci("CS_OPERATORI"))}else c='<span style="color: #EE3442;">'+traduci("CS_CONSEGNA_NON_LETTA")+"</span>",
b.cbaConfig.tooltip&&(b.cbaConfig.tooltip.destroy(),delete b.cbaConfig.tooltip);b.setHtml("<span><strong>"+c+"</strong><span>");b.setStyle("cursor",a.letta?"pointer":"default")}}function setMsgOnDeleteRecWithConsegna(a){if(a=void 0===a?null:a){var b="MSG_ANNULLA_RECORD";Ext.isDefined(a.cbaConfig.consegna)&&!Ext.isEmpty(a.cbaConfig.consegna.idConsegna)&&(b="ANNULLAMENTO_RECORD_CONSEGNA_MOVIMENTATA");return b}}
function getIconButtons(){return{btnHelp:"box-help-css",btnNuovo:"box-add-css",btnElimina:"box-delete-css",btnConferma:"box-confirm-css",btnAnnulla:"box-annulla-css",BtnStampa:"box-print-css",btnEsci:"box-exit-css",btnCopia:"box-copy-css",btnEliminaX:"box-delete-x-css"}}
function cssInsertCopyBtn(a,b,c,d){a.down("panel").insert(b,{xtype:"button",itemId:"btnCopia",reference:"btnCopia",testo:traduci("COPIA"),cls:"cbaBtnFunzione-mini",iconCls:"box-copy-css",width:30,margin:"0 1 0 0",disabled:!0,handler:function(a){if(d.bozzaExists)return Messaggio("ATTENZIONE","MSG_INFO_BOZZA_OPEN","OK","WARNING"),!1;c(d)}})}
function addToolAtExactPosition(a,b){Ext.isArray(b)||(b=[b]);var c=a.header,d=b.length,e=a.tools,f,g;c&&c.isHeader||(c=null,e||(a.tools=e=[]));for(f=0;f<d;f++)g=b[f],g.toolOwner=a,c?g.cbaConfig&&g.cbaConfig.position&&c.insert(g.cbaConfig.position,Ext.ComponentManager.create(g,"tool")):e.splice(position,0,g);a.updateHeader()}
function risposteDescrizioneColoreReadOnly(a,b){return Ext.isEmpty(a.get("readOnly"))||"F"==a.get("readOnly")?a.get("descrizione"+b):'<div class="css-color-azzurro" '+("T"==a.get("readOnly")?'style="text-align:left;font-weight: bold;"':"")+">"+a.get("descrizione"+b)+"</div>"}function protectTimeRefresh(a){return Ext.isNumber(a)&&6E4<=a?a:6E4}
function requiredUserOnPortlet(a){var b=!0,c=[1];!Ext.isEmpty(a.tipoBottone)&&Ext.Array.contains(c,a.tipoBottone)&&(a=CBA.moduli["modulo"+a.idModuloPrg],a.storeAnagraficaSel&&0< !a.storeAnagraficaSel.getCount()&&(b=!1,msgShow("UTENTE_NON_SELEZIONATO","NECESSARIO_SEL_UTENTE"),a.controllerCercaAnagrafica.getParametriRicerca().up("#pnldettab49").expand()));return b}
function applyStyleCartellaMenuButton(a){a&&a.cbaConfig.bottoneOriginale&&(a=a.cbaConfig.bottoneOriginale);a||(a=this);a.up().query("button").forEach(function(a){a.removeCls("cbaCssBtnAvanzate");a.addCls("bottoni-menu-cartella")});a.removeCls("bottoni-menu-cartella");a.addCls("cbaCssBtnAvanzate");a.up("panel").updateLayout()}
function cbaCalcBrightness(a,b){if(a){var c=/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/,d;if(/[0-9A-Fa-f]{6}/g.test(a))(c=(c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null)&&(d=Math.sqrt(c.r*c.r*.299+c.g*c.g*.587+c.b*c.b*.114));else if(c.exec(a)){d=c.exec(a)[1];var e=c.exec(a)[2],c=c.exec(a)[3];d=Math.sqrt(d*d*.299+e*e*.587+c*c*.114)}else return!1;if(d)return Ext.isNumber(b)?d<b?"dark":"light":!0===b?190>d?"dark":"light":d}else return!1}
function getServerTime(){return new Promise(function(a,b){Ext.Ajax.request({method:"GET",url:"/cba/gen/config/serverDateTime",success:function(c){c=Ext.JSON.decode(c.responseText);c.success?a(c.data):b(c.message[0].testo)}})})}
function getServerTimeSync(){var a=null;Ext.Ajax.request({method:"GET",url:"/cba/gen/config/serverDateTime",async:!1,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?a=new Date(b.data):msgShowError(rsposta.message)}});CBA.moduli.modulo49.serverDate=Ext.clone(a);return a}function loadStorePromise(a,b,c){a=void 0===a?null:a;b=void 0===b?{}:b;c=void 0===c?null:c;if(a)return new Promise(function(d,e){a.load({params:b,callback:function(a,b,h){h&&c&&c(a);h?d(a):e(b.getError())}})})}
function cssGetWarningHours(a){return(a=void 0===a?[]:a)&&0!==a.length?a.find(function(a){return a.valore.includes("W")}):!1}
function cssGetPolicyRetrodatazione(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?null:c;var d=CBA.parametriGenerali.idProfiloCss,e=Ext.create("GeneraliCS.store.PersonRetrodatazione");ImpostaUrl([e]);cssSetDataOraRegistrazione(a,b,c);if(a.disableRetrodatazione)return!1;loadStorePromise(e,{idProfilo:d},null).then(function(d){var e=d[0].data;d=e.tipo;e="F"===e.consenti;a.cbaConfig.consentiRetrodatazione=!e;e?(b.setReadOnly(!0),c.setReadOnly(!0)):(d=1===d,b.setReadOnly(d),d?c.setReadOnly(!d):
c.setReadOnly(!1))})["catch"](function(a){return msgShowError("",a)})}function cssSetDataOraRegistrazione(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?null:c;a&&b&&c&&getServerTime().then(function(d){d=new Date(d);d.setSeconds(0);var e=Ext.clone(d),f=Ext.clone(d);e.setHours(0,0,0,0);b.setValue(e);c.setValue(f);a.$className.includes("CBAGrid")&&b&&b.setMaxValue(Ext.clone(d));a.cbaConfig.serverDate=d})}
function cssCheckDataOraRegistrazione(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?null:c;var d=null;a&&b&&c&&(d=!Ext.isDefined(a.cbaConfig.consentiRetrodatazione)||a.cbaConfig.consentiRetrodatazione||a.cbaConfig.disableRetrodatazione?sommaDataOra(b.getValue(),c.getValue()):a.cbaConfig.serverDate);return d}
function checkChiusuraSanitaria(a,b){var c=[];a&&(c=Ext.clone(a),c.forEach(function(a){("S"===a.tipoPermesso||a.data&&"S"===a.data.permessoVideata)&&b&&(a.tipoPermesso="L",a.data&&a.data.permessoVideata&&(a.data.permessoVideata="L"))}));return c}
function droppa(a,b,c,d,e,f){var g=d.records[0].data.id;c=d.view.grid.getStore().findExact("id",d.records[0].data.id)+1;Ext.Ajax.request({method:"GET",url:b,params:{id:g,dest:c},success:function(b){b=Ext.JSON.decode(b.responseText);b.success?a.aggiornaStore(g):msgShowError("",b.message)}})}
function setRecordAgenda(a,b,c,d){b=void 0===b?null:b;d=void 0===d?!1:d;var e=c;c||(e=b.lookup("CssAgenda"));if(e){var f=c=null,g=e.down("checkbox").getValue(),h=a,k=h.idRicovero,h=h.id;e&&"function"==typeof e.getTipo&&(c=e.getTipo());e&&"function"==typeof e.getIdVoceAgenda&&(f=e.getIdVoceAgenda());a=eliminaCampiTmp(a);var l=b.cbaConfig;b=l.codVideata;f=void 0===l.idVoceAgenda?f:l.idVoceAgenda;!cbaValidId(h)&&b&&g&&(d?(d={tipo:c,idVoceAgenda:f,funzione:b,idRicovero:k,dataScadenza:e.dateExpiration},
a.agenda?a.agenda.push(d):a.agenda=[d]):Ext.apply(a,{agenda:{tipo:c,idVoceAgenda:f,funzione:b,idRicovero:k,dataScadenza:e.dateExpiration}}))}return a}
function initAgenda(a,b,c,d){d=void 0===d?"idAgenda":d;a=a.isModel?a.getData():a;d=a[d];c||(c=b.lookup("CssAgenda"));var e=c?c.down("checkbox"):null,f=c?c.down("FakeCbaMultipleChoice"):null,g=b.lookup("Form");if(g&&e)g.on("dirtychange",function(a,c){var d=a.findField("id").getValue();c&&!cbaValidId(d)&&(e.suspendChangeEvent=!0,null!=b.isCopia&&b.isCopia||e.setValue(null),e.suspendChangeEvent=!1)});e&&(e.suspendChangeEvent=!0,e.setValue(cbaValidId(d)),e.suspendChangeEvent=!1);c.idAgenda=d;f.idAgenda=
d;c.idTestata=a.id;c.getExpirationDate()}function hideFiltroSettori(a){Ext.isEmpty(CBA.parametriGenerali.filtriAttivi.filtroSettori)?(a.setHidden(!0),a.setValue(!1)):(a.cbaConfig.descrizione=CBA.parametriGenerali.filtriAttivi.filtroSettori.extra,a.setBoxLabel(CBA.parametriGenerali.filtriAttivi.filtroSettori.extra),a.setValue(!0))}
function decodeFrequencyActivity(a){var b=new Date(a.dal),c,d=1===a.frequenza;if(Ext.isDate(b)){c=Ext.Date.isEqual(Ext.Date.clearTime(b,!0),Ext.Date.clearTime(new Date));var b=FormattaData(b),e=traduci("A_PARTIRE_DA_OGGI"),f=traduci("PROGRAMMATO_PER_OGGI"),g=traduci("A_PARTIRE_DAL"),h=traduci("PROGRAMMATO_PER_IL_GIORNO");c=c?d?""+f:""+e:d?h+" "+b:g+" "+b}switch(a.frequenza){case 1:strProgram=traduci("SINGOLO_EVENTO");break;case 2:strFreq=traduci("GIORNALMENTE");strOgni=traduci("OGNI").toLowerCase()+
" "+a.freqOgni+" "+traduci("GIORNOI");d=a.freqGTipo;d=traduci(1===d?"TUTTI_I_GG":2===d?"ESCLUDI_DOMENICA":3===d?"SOLO_GG_FERIALI":"");b="T"===a.freqGEsclFestivi?", "+traduci("ESCLUDI_GG_FESTIVI"):"";strProgram=strFreq+", "+strOgni+" "+c+"<br>"+d+b;break;case 3:strFreq=traduci("SETTIMANALMENTE");strOgni=traduci("OGNI").toLowerCase()+" "+a.freqOgni+" "+traduci("SETTIMANAE");var k="";"Lun Mar Mer Gio Ven Sab Dom".split(" ").forEach(function(b){"T"===a["freqS"+b]&&(k+=""!==k?", "+b:b)});k=traduci("NEI_GIORNI_DI")+
": "+k;strProgram=strFreq+", "+strOgni+" "+c+"<br>"+k;break;case 4:strFreq=traduci("MENSILMENTE");strOgni=traduci("OGNI").toLowerCase()+" "+a.freqOgni+" "+traduci("MESEI");d=a.freqMAOgniStessoGiorno;b="";"T"===d?b=traduci("OGNI_STESSO_GG_MESE"):"F"===d&&(e=a.freqMAOgniQuanto,d=a.freqMAOgniTipo,b=Ext.create("CS.personalizzazioni.personAttivita.store.FrequenzaOgniN"),b=trovaRecord(b,"codice",e),stGiorni=Ext.create("CS.personalizzazioni.personAttivita.store.FrequenzaOgniGiorno"),recGiorni=trovaRecord(stGiorni,
"codice",d),cb1=b?b.get("valore"):null,cb2=recGiorni?recGiorni.get("valore"):null,strO=traduci("OGNI"),strDM=traduci("DEL_MESE"),dei=d&&1==d?traduci("DEI"):"",b=cb1&&cb2?strO+" "+cb1+" "+dei+" "+cb2+" "+strDM:"");strProgram=strFreq+", "+strOgni+" "+c+"<br>"+b;break;case 5:strFreq=traduci("ANNUALMENTE");strOgni=traduci("OGNI").toLowerCase()+" "+a.freqOgni+" "+traduci("ANNOI");b=a.freqMAOgniStessoGiorno;d="";"T"===b?d=traduci("OGNI_STESSO_GG_ANNO"):"F"===b&&(e=a.freqMAOgniQuanto,d=a.freqMAOgniTipo,
b=Ext.create("CS.personalizzazioni.personAttivita.store.FrequenzaOgniN"),b=trovaRecord(b,"codice",e),stGiorni=Ext.create("CS.personalizzazioni.personAttivita.store.FrequenzaOgniGiorno"),recGiorni=trovaRecord(stGiorni,"codice",d),cb1=b?b.get("valore"):null,cb2=recGiorni?recGiorni.get("valore"):null,strO=traduci("OGNI"),strDM=traduci("DEL_MESE"),dei=d&&1==d?traduci("DEI"):"",d=cb1&&cb2?strO+" "+cb1+" "+dei+" "+cb2+" "+strDM:"");var l="",b=traduci("DELDEI_MESEI_DI"),n=0;"Gen Feb Mar Apr Mag Giu Lug Ago Set Ott Nov Dic".split(" ").forEach(function(b){"T"===
a["freqA"+b]&&(l+=""!==l?", "+b:": "+b,n++)});l=b+l;l=l.replace(1<n?"del/":"/dei","");l=l.replace(1<n?"e/":"/i","");strProgram=strFreq+", "+strOgni+" "+c+"<br>"+d+"<br>"+l}return strProgram}
function imgTitleFieldsetCss(a){imgTitleFieldset(a,"/cba/css/generali/images/generali/unchecked.png",function(){1==a.iconCmp.checked?(a.iconCmp.checked=!1,a.iconCmp.setSrc("/cba/css/generali/images/generali/unchecked.png"),a.query("checkbox").forEach(function(a){return a.setValue(!1)})):(a.iconCmp.checked=!0,a.iconCmp.setSrc("/cba/css/generali/images/generali/checked.png"),a.query("checkbox").forEach(function(a){return a.setValue(!0)}))})}
function addSintesi(a,b,c){b&&!c&&(a=a||b.lookup("BoxBottoni"),c=Object.assign({getCodVideata:function(){return b.cbaConfig.codVideata},getIdRicovero:function(){return b.idRicovero},getIdProfilo:function(){return b.idProfilo},permesso:b.cbaConfig.permesso}));if(!a)throw"Non ho trovato il container sul quale inserire il bottone di sintesi";if(!c)throw"parametri per sintesi non configurati!";if(!c.getCodVideata||!c.getCodVideata())throw"codvideata non passato o vuoto!";if(!c.getIdRicovero||!c.getIdRicovero())throw"idRicovero non passato o vuoto!";
if(!c.getIdProfilo||!c.getIdProfilo())throw"idProfilo non passato o vuoto!";if(!c.permesso)throw"permesso form non passato o vuoto!";(function(){return new Promise(function(a,b){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/bilancio/eco/sintesi/permission",params:{idProfiloPwdDeCss:CBA.parametriGenerali.idProfiloPwdDeCss,idProfilo:CBA.parametriGenerali.idProfiloCss},success:function(c){c=Ext.JSON.decode(c.responseText);var d=c.data,e=c.message;c.success?a(d):(msgShowError("",e),b(e))}})})})().then(function(b){if(b)return(a.down("Generali.standard.controller_PannelloBottoni")?
a.down("panel"):a).insert(0,{xtype:"CssSintesi",margin:"0 10 0 0",hidden:!1,cbaConfig:c})})["catch"](function(a){return console.error(a)})}function getPermessoVideata(a,b,c){Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/pwd/videatepwd/getbycodvideata",params:{codVideata:a,codModulo:49,idProfiloPwdDeCss:b||CBA.parametriGenerali.idProfiloPwdDeCss},success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.message,d=a.data;a.success?c(d):msgShowError("",b)}})}
function checkCoperturaTurni(a,b,c){var d=Ext.clone(a),e=!0;if(Ext.isEmpty(a))return!1;Ext.each(d,function(a){var d=new Date(a[b]),e=new Date(a[c]),d=Ext.Date.format(d,"H:i"),e=Ext.Date.format(e,"H:i");a[b]=d;a[c]=e});Ext.each(d,function(a){var f=a[c].split(":");a=parseInt(f[0]);var f=parseInt(f[1]),h=a,k=0,l=null;59>f?k=f+1:(k=0,h=a+1);l=new Date("12/30/1899 "+h+":"+k);l=Ext.Date.format(l,"H:i");-1==d.findIndex(function(a){return a[b]===l})&&(e=!1)});return e}
function formattaNosologico(a,b,c,d){var e="";if(!a)return e;b&&(e+=b);c&&(e+=c);for(b=a.toString().length;b<d;b++)a="0"+a;return e+a}function hasSvamaEnabled(a){a=void 0===a?CBA.parametriGenerali.idProfiloCss:a;return new Promise(function(b,c){Ext.Ajax.request({url:"/cba/css/cs/ws/menuprofilibottoni/isUsed",method:"GET",params:{codVideata:"Svama",idProfilo:a},success:function(a){a=Ext.JSON.decode(a.responseText);var d=a.data,f=a.message;a.success?b(!!d):(msgShowError("",f),c(f))}})})}
function hasSvamaEnabled(a){a=void 0===a?CBA.parametriGenerali.idProfiloCss:a;return hasCodVideataEnabled(a,"Svama")}function hasSosiaEnabled(a){a=void 0===a?CBA.parametriGenerali.idProfiloCss:a;return hasCodVideataEnabled(a,"Sosia")}function hasSchedaCdiEnabled(a){a=void 0===a?CBA.parametriGenerali.idProfiloCss:a;return hasCodVideataEnabled(a,"SCDI")}function hasFlussiRegEnabled(a){var b=hasSvamaEnabled(a),c=hasSosiaEnabled(a);a=hasSchedaCdiEnabled(a);return Promise.all([b,c,a])}
function hasCodVideataEnabled(a,b){a=void 0===a?CBA.parametriGenerali.idProfiloCss:a;return new Promise(function(c,d){Ext.Ajax.request({url:"/cba/css/cs/ws/menuprofilibottoni/isUsed",method:"GET",params:{codVideata:b,idProfilo:a},success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.data,e=a.message;a.success?c(!!b):(msgShowError("",e),d(e))}})})}function addCbSosia(){return{xtype:"checkbox",reference:"CbImportSosia",name:"importSosia",boxLabel:"VISUALIZZA_IMPORT_SOSIA",value:!1}}
function getPrevStatoMonitor(a,b,c,d){b=void 0===b?null:b;c=void 0===c?!1:c;d=void 0===d?!1:d;return(new Promise(function(e,f){var g=Object.assign({},{idRicovero:b,data:a,ultimoTampone:d,primoIsolamento:c});Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/protocovid/getprev",params:g,success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.data,c=a.message;a.success?e(b):(f(c),msgShowError("",c))}})}))["catch"](function(a){return a&&console.error(a)})}
function getImpostazPsiche(a){return(new Promise(function(b,c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/psiche/impostazioni/get",params:{idProfilo:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b(a.data):(msgShowError("",a.message),c())}})}))["catch"](function(a){return a&&console.error(a)})}
function getImpostazNoteAnnullamento(a){return(new Promise(function(b,c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/genCss/retrodatazione/getbyidprofilo",params:{idProfilo:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b(a.data):(msgShowError("",a.message),c())}})}))["catch"](function(a){return a&&console.error(a)})}
function getImpostazDiariDaCompletare(a){return(new Promise(function(b,c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/diari/impostazioni/checkDaCompletare",params:{idProfilo:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b(a.data):(msgShowError("",a.message),c())}})}))["catch"](function(a){return a&&console.error(a)})}
function getImpostazSintesi(a){return(new Promise(function(a,c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/bilancio/eco/sintesi/permission",params:{idProfiloPwdDeCss:CBA.parametriGenerali.idProfiloPwdDeCss,idProfilo:CBA.parametriGenerali.idProfiloCss},success:function(b){b=Ext.JSON.decode(b.responseText);var d=b.data,f=b.message;b.success?a(d):(msgShowError("",f),c(f))}})}))["catch"](function(a){return a&&console.error(a)})}
function openMonitoraggioCovid(a,b){b=void 0===b?!0:b;if(!a)throw"anagraficaSel not found!";var c=Ext.create("CSS_winCBA",{name:"CS.monitorcovid.fascicolo.view.MonitoraggioCovid",titolo:" ",visualizzaAnagrafica:a,configItem:{idRicovero:a.idRicovero}});c.cssDefaultShow();c.impostaTitolo(traduci("MONITOR_COVID"));if(b)c.on("close",function(){CBA.moduli.modulo49&&CBA.moduli.modulo49.controllerCercaAnagrafica&&CBA.moduli.modulo49.controllerCercaAnagrafica.refreshStatoCovid()});return c}
function checkRicognizione(a,b,c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/terapie/riconciliazione/terapie/list",params:{idRicovero:c.idRicovero||CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).get("idRicovero")},success:function(d){d=Ext.JSON.decode(d.responseText);var e=[];if(d.success){var f=d.data;Ext.isEmpty(f)||Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/ricoveri/get",params:{id:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).get("idRicovero")},success:function(d){d=Ext.JSON.decode(d.responseText);
if(d.success){if("T"!=d.data.fineRiconciliazione){var e=!1;f.terapieLightLst.forEach(function(a){a.idTerapiaRiconciliata||a.idRiconciliazione||(e=!0)});e&&a.insert(0,{xtype:"button",html:traduci("BTN_RICONCILIAZIONE"),cls:"cbaCssBtnFunzione-special",width:110,maxHeight:50,minHeight:50,maxWidth:110,margin:"10 10 0 10",listeners:{afterrender:function(a){return creaToolTipBubble(a,traduci("MSG_RIC_PRESENTE"),null,null,350)}},handler:function(d){d.setHidden(!0);createPanelRiconciliazione(f,a,b,c)}})}}else msgShowError("",
d.message)}})}else msgAddError(e,d.message);msgShow("",e)}})}
function createPanelRiconciliazione(a,b,c,d){var e=Ext.create("Ext.Container",{layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",itemId:"Riconciliazione",layout:{type:"hbox",align:"stretch"},flex:1,style:{"background-color":"#5FA2DD"},maxHeight:55,padding:10,margin:"10 10 0 10",items:[{xtype:"label",text:traduci("RICONCILIAZIONE_FARMACOLOGICA"),cls:"cbaCssLabelTitolo",margin:"5 5 0 0"},{xtype:"container",itemId:"CntIcona",reference:"CntIcona",layout:{type:"hbox",align:"center",pack:"end"},
flex:1,items:[{xtype:"image",src:"/cba/css/generali/images/generali/portlet-collapse.svg",height:20,width:20,nonDisabilitare:!0,collapsed:!1,listeners:{afterrender:function(a){a.getEl().on("click",function(){a.collapsed?(a.setSrc("/cba/css/generali/images/generali/portlet-collapse.svg"),a.collapsed=!1):(a.setSrc("/cba/css/generali/images/generali/portlet-expand.svg"),a.collapsed=!0);d.viewRiconciliazione.setHidden(a.collapsed)});a.getEl().setStyle("cursor","pointer")}}}]}]},{xtype:"container",itemId:"CntRiconciliazione",
margin:"0 10 10 10",items:[]}]});c.insert(0,e);d.viewRiconciliazione=Ext.create("CS.terapie.view.Riconciliazione",{style:{"border-left":"2px solid #4E9BD6","border-right":"2px solid #4E9BD6","border-bottom":"2px solid #4E9BD6"},padding:5,cbaConfig:{controllerTe:d,records:a,callbackOnSave:function(){e.destroy();checkRicognizione(b,c,d);d.aggiornaStore()}}});e.down("#CntRiconciliazione").add(d.viewRiconciliazione)}
function getActivityPaiPriProgrammaForPie(a,b,c){c=void 0===c?CBA.parametriGenerali.idProfiloCss:c;return new Promise(function(d,e){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/attivita/effettuate/pie/byRicovero",params:{idRicovero:a,idProfilo:c,idCollegamento:b},success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.data,c=a.message;a.success?d(b):(e(c),msgShowError("",c))}})})}
function getTipoPai(a){a=void 0===a?CBA.parametriGenerali.idProfiloCss:a;var b=null;CBA.moduli.modulo49.tipoPai?b=CBA.moduli.modulo49.tipoPai:Ext.Ajax.request({url:"/cba/css/cs/ws/pai/impostazioni/get",method:"GET",async:!1,params:{idProfilo:a},success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.data,e=a.message;a.success?(CBA.moduli.modulo49.tipoPai=c.tipoPai,b=CBA.moduli.modulo49.tipoPai):msgShowError("",e)}});return b}
function getRecordsByListId(a,b,c){var d=[];Ext.each(a,function(a){(a=trovaRecord(b,c,a))&&d.push(a)});return d}function setNoteDelete(a,b,c){CBA.moduli.modulo49.noteAnnullamentoAbilitata&&Ext.Ajax.request({method:"POST",url:getPathGeneralModulo()+"setNoteDelete",jsonData:c,params:{id:a,codVideata:b},success:function(a){a=Ext.JSON.decode(a.responseText);a.success||msgShowError("",a.message)}})}
function apriPopUpSchede(a,b,c,d){b={idGeMenuS2:b,idTestata:-9999,idProfiloPwdDeCss:CBA.parametriGenerali.idProfiloPwdDeCss,idProfilo:CBA.parametriGenerali.idProfiloCss};d&&Ext.apply(b,{progVisita:d});Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/parametri/visite/openPopup",params:b,success:function(b){var e=Ext.JSON.decode(b.responseText);if(e.success&&!Ext.isEmpty(e.data)){var g=!0;d&&(g=Ext.isEmpty(e.data.idTestata)&&"L"!=e.data.tipoPermesso);cssUtenteByCodospite(c,function(b){cssOpenGestFree(e.data,
b,e.data.idTestata,!1,function(){Ext.apply(this,{progVisita:d})},function(){},g,a,"T")})}}})}function getDepositoByIdRicovero(a){return(new Promise(function(b,c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/depositi/repartiarmadio/getbyidricovero",params:{idRicovero:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?b(a.data):(msgShowError("",a.message),c())}})}))["catch"](function(a){return a&&console.error(a)})}
function getLastFormIO(a,b,c,d){return new Promise(function(e,f){var g={idRicovero:c,nameField:b,codiceModulo:a};d&&Ext.apply(g,{dataAl:d});Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/pai/skval/formio/last",params:g,success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.data,c=a.message;a.success?e(b):(f(c),msgShowError("",c))}})})}
function openPopupVidetaFromLocal(a,b,c,d,e,f,g){d=void 0===d?!1:d;e=void 0===e?null:e;f=void 0===f?null:f;g=void 0===g?null:g;if(!a)return!1;b||(b=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data);"Parametri Clinici"==a&&(a="Parametri Vitali");if((a=findVideata(a))&&a.tipoPermesso&&"N"!=a.tipoPermesso){var h=a.voceMenu;Ext.create("CSS_winCBA",{name:"GeneraliCS.popup.view.Popup",titolo:h.titolo,visualizzaAnagrafica:b,configItem:{standAlone:!0,elencoVideate:[a],videataDettaglio:h.nomeForm,permesso:a.tipoPermesso,
codOspitePopUp:b.codOspite,anagraficaExtra:b,anagraficaDaGestione:b,nominativoPopUp:b.cognome+b.nome,controllerProvenienza:c,selezioneTestata:e,nuovoDefault:d,callbackOnOpen:f,callbackOnExit:g}}).cssDefaultShow()}else msgShowError("","NESSUN_PERMESSO")}
function checkConsultazioneCartella(a,b){a||(a=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data);var c=a.idRicovero,d=new Date,e=a.chiusuraSanitaria;e&&"string"==typeof e&&(e=new Date(e));return(new Promise(function(a,g){c||g("checkConsultazioneCartella: idRicovero non valido");b||g("checkConsultazioneCartella: richiedente non valido");e&&e<d?Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/consultazionecartella/check",params:{idRicovero:c,richiedente:b},success:function(b){b=Ext.JSON.decode(b.responseText);
b.success?a(b.data):g(b.message)}}):a(!0)}))["catch"](function(a){return a&&console.error(a)})}
Ext.define("GeneraliCS.standard.ControllerGenSchedeVal",{extend:"Generali.standard.stampe.Controller",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DataRegistrazione",selector:a+"#DataRegistrazione"},{ref:"ComboValidita",selector:a+"#ComboValidita"},{ref:"PnlCompilatore",selector:a+"#PnlCompilatore"},{ref:"PnlFunzioni",selector:a+"#PnlFunzioni"},{ref:"TabAndamento",selector:a+"#TabAndamento"},{ref:"TabAndamentoExtra",selector:a+"#TabAndamentoExtra"},
{ref:"TabAllegati",selector:a+"#TabAllegati"},{ref:"InfoScadenza",selector:a+"#InfoScadenza"},{ref:"TabPanel",selector:a+"#TabPanel"}]);this.control(a+"#DataRegistrazione",{change:this.changeData});this.control(a+"#ComboValidita",{change:this.changeScadenza});this.control(a+"#InfoScadenza",{afterrender:this.afterrenderInfoScadenza})},afterrenderInfoScadenza:function(a){a.setMargin("16 0 0 5");this.getComboValidita().readOnly="S"!==this.cbaConfig.permesso},caricaFattoreCorrezione:function(a){var b=
this;Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/anagrafica/fattorecorrezione",params:{idRicovero:b.idRicovero,data:a?a:new Date},success:function(a){a=Ext.JSON.decode(a.responseText);var c=[];a.success?(a=a.data,b.fattoreCorrezione=-999!=a?a:traduci("MESSAGGIO_PUNTEGGIO_COMPLESSIVO"),b.aggiornaLabelPunteggio()):msgAddError(c,a.message)}})},salvaStatoBottoni:function(){var a=this.getForm(),b=a.boxBottoni.queryById("btnNuovo"),c=a.boxBottoni.queryById("btnCopia"),d=a.boxBottoni.queryById("btnElimina"),
a=a.boxBottoni.queryById("BtnStampa");this.statoNuovo=b.isDisabled();this.statoElimina=d.isDisabled();this.statoCopia=c.isDisabled();this.statoStampa=a.isDisabled()},abilitaDisabilitaBoxBottoni:function(a){var b=this.getForm(),c=b.boxBottoni.queryById("btnNuovo"),d=b.boxBottoni.queryById("btnCopia"),e=b.boxBottoni.queryById("btnElimina"),b=b.boxBottoni.queryById("BtnStampa");a?(b=this.getForm(),this.getPnlFunzioni().setDisabled(a),this.cbaConfig.controllerTestata.getContainerStorico().setDisabled(a),
b.boxBottoni.queryById("btnNuovo").setDisabled(a),b.boxBottoni.queryById("btnCopia").setDisabled(a),b.boxBottoni.queryById("btnElimina").setDisabled(a),b.boxBottoni.queryById("BtnStampa").setDisabled(a)):(this.getPnlFunzioni().setDisabled(!1),e.setDisabled(this.statoElimina),c.setDisabled(this.statoNuovo),d.setDisabled(this.statoCopia),b.setDisabled(this.statoStampa),this.cbaConfig.controllerTestata.getContainerStorico().setDisabled(!1))},caricaStoreExtraDati:function(a){var b=this;b.storeExtra=Ext.create("GeneraliCS.schede.store.ExtraStore");
ImpostaUrl([b.storeExtra]);b.storeExtra.load({params:{id:b.cbaConfig.controllerTestata.cbaConfig.codVideata},callback:function(a,d,e){e?(a=a[0],Ext.isEmpty(a)||("T"==a.get("provvedimenti")&&b.getTabPanel().insert(1,Ext.create("CS.schede.standard.provvedimenti.view.TabProvvedimenti",{itemId:"TabProvvedimenti",reference:"TabProvvedimenti",title:traduci("PROVVEDIMENTI_ADOTTATI"),cbaConfig:{codDomanda:a.get("domandaRisp"),codArea:a.get("areaRisp"),idProfilo:b.idProfilo,controllerDettaglio:b}})),b.punteggioMax=
b.cbaConfig.punteggioMax||a.data.totale,b.hideTabGrafico||(b.generaTabGrafico(),b.viewGraficoExtra&&b.generaTabGrafico("ANDAMENTO2","TabAndamentoExtra")),b.hideTabAllegati||b.generaTabAllegati())):msgShowError("",d.getError())}})},setInfoPunteggio:function(a,b,c,d,e,f){if(!a)return!1;a.legend.add(Ext.create("Ext.Img",{src:"/cba/css/generali/images/skval/bibliografia.svg",id:"IconaInfo"+Ext.id(),width:16,height:16,margin:f||0,listeners:{afterrender:function(a){var f=Ext.create("Ext.tip.ToolTip",{target:a.getId(),
height:d?d:!1,width:e?e:!1,autoHide:!1,title:traduci(b),html:traduci(c),layout:{type:"fit"},listeners:{render:function(a){a.getEl().on("mouseleave",function(){Ext.defer(function(){f.close()},3E3)})}}})}}}))},generaTabAllegati:function(){var a=this.getTabPanel().items.items,b=a.length;this.getTabPanel().insert(a[b+1],Ext.create("Ext.panel.Panel",{title:traduci("ALLEGATI"),itemId:"TabAllegati",reference:"TabAllegati",layout:{type:"vbox",align:"stretch"},flex:1,autoScroll:!0,padding:5,nonDisabilitare:!0}));
this.getTabAllegati().add(Ext.create("GeneraliCS.standard.allegati.view.Allegati",{layout:{type:"vbox",align:"stretch"},flex:1,cbaConfig:{controllerTe:this,tipo:"2B",hideBtnEsci:!0,codVideata:this.cbaConfig.controllerTestata.cbaConfig.codVideata}}))},aggiornaTabAllegati:function(a){if(!a||1>a)return Messaggio("ERRORE","TESTATA_NON_VALIDA","OK","ERROR");this.getTabAllegati().down().controller.loadAttachmentsList(a)},generaTabGrafico:function(a,b){a=void 0===a?"ANDAMENTO":a;b=void 0===b?"TabAndamento":
b;var c=this.getTabPanel().items.items,d=c.length;this.getTabPanel().insert(c[d+1],Ext.create("Ext.panel.Panel",{title:traduci(a),itemId:b,reference:b,layout:{type:"vbox",align:"stretch"},flex:1,autoScroll:!0,padding:5,nonDisabilitare:!0}));c=this.typeSerie||"line";this["get"+b]().add(Ext.create("GeneraliCS.schede.grafico.view.AndamentoTestata",{cbaConfig:{desVideata:this.cbaConfig.controllerTestata.cbaConfig.desVideata,codiceModulo:this.cbaConfig.controllerTestata.cbaConfig.codVideata,idRicovero:this.idRicovero,
viewGrafico:("TabAndamento"==b?this.viewGrafico:this.viewGraficoExtra)||"GeneraliCS.schede.grafico.view.TabAndamento",testataGen:this.cbaConfig.testataGen,idRicoveroCu:Ext.isDefined(this.cbaConfig.anagraficaCorrente.idRicoveroCu)?this.cbaConfig.anagraficaCorrente.idRicoveroCu:null,punteggioMax:this.punteggioMax,punteggioMin:7==this.cbaConfig.controllerTestata.cbaConfig.codVideata?-12:0,extraConfig:this.configGraficoExtra,typeSerie:c}}))},caricaValidita:function(){this.cbaConfig.testataGen&&ImpostaUrl(this.getComboValidita().getStore());
this.getComboValidita().getStore().load({params:{altro:"T"}})},changeScadenza:function(a,b,c){b=this.lookup("CssAgenda");this.getForm().getForm();Ext.isEmpty(a.getValue());this.getDataRegistrazione().getValue()&&calcolaDataDiScadenza(this.getDataRegistrazione().getValue(),a.selection,b.getImageInfo())},changeData:function(a){var b=this.lookup("CssAgenda");a.getValue()instanceof Date&&calcolaDataDiScadenza(a.getValue(),this.getComboValidita().selection,b.getImageInfo())},caricaPunteggio:function(a){var b=
this;b.vettorePunteggi=null;b.storePunteggi=Ext.create("GeneraliCS.schede.store.Punteggio");b.cbaConfig.testataGen&&ImpostaUrl([b.storePunteggi]);b.storePunteggi.load({params:{codiceModulo:b.cbaConfig.controllerTestata.cbaConfig.codVideata},callback:function(c,d,e){e?Ext.isEmpty(c.length)?b.vettorePunteggi=null:(b.vettorePunteggi=c,a&&a(c)):msgShowError("",d.getError())}})},gestisciNonSomministrabile:function(a){(this.nonSomministrabile="T"==a)?(this.getFieldInfoPunteggio().legend.remove(Ext.getCmp("IconaWarning")),
this.getFieldInfoPunteggio().legend.add(Ext.create("Ext.Img",{src:"/cba/generali/images/16/information.png",id:"IconaWarning",width:16,height:16,listeners:{afterrender:function(a){creaToolTipBubble(a.getId(),"INFO_NON_SOMMINISTRABILE","ATTENZIONE",null,null,null,null,null,null,"W")}}}))):Ext.getCmp("IconaWarning")&&this.getFieldInfoPunteggio().legend.remove(Ext.getCmp("IconaWarning"))},stampa:function(){var a=this.getForm(),b="pdf";this.parametriStampa.params&&this.parametriStampa.params.format&&
(b=this.parametriStampa.params.format);this.cbaConfig.testataGen&&!this.moduloCss&&(this.parametriStampa.url="/cba/osp/far/ws/genCss/report/bina");a=Ext.apply(this.parametriStampa,{params:{reportId:4010,format:b,id:a.getForm().findField("id").getValue()}});Ext.apply(a.params,{});this.cbaConfig.configBtnStampa&&(Ext.applyIf(a,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(a.params,this.cbaConfig.configBtnStampa.params))},disabilitaNuovoCopia:function(){var a=this.getForm(),
b=a.boxBottoni.queryById("btnNuovo"),a=a.boxBottoni.queryById("btnCopia");b.setDisabled(!0);a.setDisabled(!0)},ingressoDaVisite:function(){this.getForm();this.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.soloUnaTestata&&"F"!=this.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.soloUnaTestata&&(this.soloUnaTestata="T"==this.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.soloUnaTestata,this.disabilitaNuovoCopia())},clickCopia:function(a){0<a.storeForm.getCount()?
(a.testataSelezionata=!1,a.isCopia=!0,a.getForm().getForm().findField("id").setValue(-9999),bloccaFormCss(a.getForm(),!1,!0,[a.getPnlFunzioni()])):Messaggio("ATTENZIONE","NESSUNA_REGISTRAZIONE_SELEZIONATA","OK","QUESTION")},doPrint:function(a,b){this.stampa();this.callParent([a,b])}});
Ext.define("GeneraliCS.standard.ListaCompilatori",{extend:"Generali.standard.stampe.Controller",init:function(){this.callParent(arguments)},onLaunch:function(){var a=this;this.getView().lookup("PnlCompilatore").on("afterrender",function(b){a.aggiungiListaCompilatori();a.initForm()})},initForm:function(){var a=this,b=cssTrovaFormStd(this);b.boxBottoni.lookup("btnNuovo");var c=b.query("[name=id]")[0];c.isInitChange||(c.isInitChange=!0,c.on("change",function(b,c){cbaValidId(c)||a.btnCompilatori.setHidden(!0)}));
b.store.on("datachanged",function(b){a.btnCompilatori.setHidden(!0);1===b.getCount()&&a.verificaCompilatori(b.getData().items[0])})},verificaCompilatori:function(a){(this.listaCompilatori=a.get("listaCompilatori"))&&1<this.listaCompilatori.length&&this.lookup("PnlCompilatore").query("#BtnHistoryCompilatori")[0].setHidden(!1)},aggiungiListaCompilatori:function(){var a=this,b=this.lookup("PnlCompilatore").items.items[0],c=b.items.items.length,d=b.getPosition(),e=b.getHeight();this.btnCompilatori=Ext.create("Ext.Button",
{itemId:"BtnHistoryCompilatori",iconCls:"btn-compilatori-css css-blu",iconAlign:"center",tooltip:traduci("LISTA_COMPILATORI"),margin:"5 20 0 0",width:32,maxHeight:32,style:{border:0,"border-radius":"100px","padding-top":"7px","padding-left":"6px","box-shadow":"1px 1px 1px #3A74A0",background:"white"},hidden:!0,listeners:{click:function(){a.apriHistoryCompilatori(a.listaCompilatori,d,e,890)}},nonDisabilitare:!0});b.insert(c+1,this.btnCompilatori)},apriHistoryCompilatori:function(a,b,c,d){Ext.create("winCBA",
{titolo:traduci("LISTA_COMPILATORI"),maximizable:!1,closable:!0,closeToolText:null,larghezzaWin:d,altezzaWin:195,name:[{xtype:"grid",itemId:"GridHistory",reference:"GridHistory",flex:1,autoScroll:!0,width:762,store:Ext.create("CS.eventi.cadute.store.History"),columns:[{xtype:"gridcolumn",flex:1,dataIndex:"id",hidden:!0},{xtype:"gridcolumn",flex:1,dataIndex:"compilatoreNominativo",text:traduci("CHI_HA_COMPILATO_SCHEDA")},{xtype:"gridcolumn",flex:1,dataIndex:"compilatoreFigProf",text:traduci("FIGURA_PROFESSIONALE")},
{xtype:"gridcolumn",flex:1,dataIndex:"compilatoreFirmatario",align:"center",sortable:!1,disabled:!1,inputValue:"T",uncheckedValue:"F",text:traduci("FIRMA_DOCUMENTO"),renderer:function(a,b,c,d,k,l,n){renderCheckColumn(b,a)}}],listeners:{afterrender:function(b){Ext.each(a,function(a){b.getStore().add(a)})}}}]}).showAt(b[0],b[1]+c)},creaHistory:function(a){var b=this,c=this.cbaConfig.controllerTestata?this.cbaConfig.controllerTestata.winRicerca:!1;if(c){var d=c.down("#FormFiltri");d.add({xtype:"checkboxfield",
itemId:"CheckHistory",reference:"CheckHistory",boxLabel:traduci("ABILITA_CONS_MOD"),cls:"cbaCssLabel",inputValue:!0,uncheckedValue:!1,margin:"5 0 0 0",listeners:{change:function(c,f,g,h){f&&Ext.create("winCBA",{name:"GeneraliCS.standard.history.view.History",maximizable:!1,titolo:traduci("HISTORY_MODIFICHE"),larghezzaWin:845,altezzaWin:630,clsWin:"cbaCssBordoPopup",configItem:{controller:b,idTe:b.testataSelezionata,filtriAttivi:d,tipo:a}}).showAt(.5*CBA.parametriGenerali.cmpTbMenu.getWidth()-400,
200)}}});c.query("#SoloOperatoreLog")[0].hidden=!0}},generaTabAllegati:function(a){var b=this.getTabPanel().items.items,c=b.length;this.getTabPanel().insert(b[c+1],Ext.create("Ext.panel.Panel",{title:traduci("ALLEGATI"),itemId:"TabAllegati",reference:"TabAllegati",layout:{type:"vbox",align:"stretch"},flex:1,autoScroll:!0,padding:5,nonDisabilitare:!0}));this.lookup("TabAllegati").add(Ext.create("GeneraliCS.standard.allegati.view.Allegati",{layout:{type:"vbox",align:"stretch"},flex:1,cbaConfig:{controllerTe:this,
tipo:a,hideBtnEsci:!0,codVideata:this.cbaConfig.controllerTestata.cbaConfig.codVideata}}))},aggiornaTabAllegati:function(a){this.lookup("TabAllegati").down().controller.loadAttachmentsList(a)},abilitaDisabilitaBoxBottoni:function(a){var b=this.getForm(),c=b.boxBottoni.queryById("btnNuovo"),d=b.boxBottoni.queryById("btnCopia"),e=b.boxBottoni.queryById("btnElimina"),f=b.boxBottoni.queryById("BtnStampa");a?(this.getPnlFunzioni().setDisabled(a),this.cbaConfig.controllerTestata.getContainerStorico().setDisabled(a),
b.boxBottoni.queryById("btnNuovo").setDisabled(a),b.boxBottoni.queryById("btnCopia").setDisabled(a),b.boxBottoni.queryById("btnElimina").setDisabled(a),b.boxBottoni.queryById("BtnStampa").setDisabled(a)):(this.getPnlFunzioni().setDisabled(!1),e.setDisabled(this.statoElimina),c.setDisabled(this.statoNuovo),d.setDisabled(this.statoCopia),f.setDisabled(this.statoStampa),this.cbaConfig.controllerTestata.getContainerStorico().setDisabled(!1))}});
Ext.define("GeneraliCS.anagrafica.model.Anagrafica",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"codOspite"},{name:"dataNascitaFormatted"},{name:"nominativo"},{name:"al"},{name:"attivo"},{name:"dal"},{name:"dataNascita"},{name:"descrProfilo"},{name:"descrProfiloWarning"},{name:"dataIsolamento",type:"date"},{name:"statoMonitoraggioCovid"},{name:"dataUltimoTampone",type:"date"},{name:"numeroDoseVaccino"},{name:"vaccinoCompletato"},{name:"vaccinoScaduto"},{name:"idProfilo"},{name:"idRicovero"},
{name:"progrTe"},{name:"residenza"},{name:"sesso"}],idProperty:"idRicovero"});
Ext.define("GeneraliCS.anagrafica.model.ElencoPazienti",{extend:"Ext.data.Model",fields:[{name:"id"},{name:"codOspite"},{name:"idRicovero"},{name:"colonna1"},{name:"colonna2"},{name:"colonna3"},{name:"colonna4"},{name:"colonna5"},{name:"colonna6"},{name:"colonna7"},{name:"colonna8"},{name:"colonna9"},{name:"colonna10"},{name:"colonna11"},{name:"colonna12"},{name:"colonna13"},{name:"colonna14"},{name:"colonna15"},{name:"colonna16"},{name:"colonna17"},{name:"colonna18"},{name:"colonna19"},{name:"colonna20"},
{name:"colonna21"},{name:"colonna22"},{name:"colonna23"},{name:"colonna24"},{name:"colonna25"},{name:"colonna26"},{name:"colonna27"},{name:"colonna28"},{name:"colonna29"},{name:"colonna30"}]});
Ext.define("GeneraliCS.anagrafica.controller.AssociaGruppiUtente",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridUtenteGruppi",selector:a+"#GridUtenteGruppi"},{ref:"CntMain",selector:a+"#CntMain"},{ref:"ComboGruppo",selector:a+"#ComboGruppo"},{ref:"BtnDissocia",selector:a+"#BtnDissocia"}]);this.control(a+"#GridUtenteGruppi",{beforeedit:this.beforeeditGridUtenteGruppi,edit:this.editGridUtenteGruppi,canceledit:this.canceleditGridUtenteGruppi,
validateedit:this.validateeditGridUtenteGruppi,selectionchange:this.selectionChangeGridUtenteGruppi});this.control(a+"#BtnDissocia",{click:this.onClickBtnDissocia})},selectionChangeGridUtenteGruppi:function(a,b){if(this.blocca)return!1;this.getBtnDissocia().setDisabled(Ext.isEmpty(b)||Ext.isEmpty(b[0].get("idGruppo")))},onClickBtnDissocia:function(){var a=this,b=this.getGridUtenteGruppi().getSelectionModel().getSelection()[0];Ext.isEmpty(b)||Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/gruppiutenti/dissocia",
params:{idArea:b.get("codArea"),ricoveri:this.idRicovero},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.message;b.success?(a.aggiornaStore(),msgShow("","Operazione eseguita con successo")):msgShowError("",c)}})},beforeeditGridUtenteGruppi:function(a,b,c){if(this.blocca)return!1;IsolaCmp(this.getGridUtenteGruppi(),!1);if(!0===a.editing)return!1;a=b.record;this.getComboGruppo().bindStore(this.storeGruppo);this.storeGruppo.load({params:{codArea:a.get("codArea"),idProfilo:this.idProfilo}})},
canceleditGridUtenteGruppi:function(a,b,c){IsolaCmp(this.getGridUtenteGruppi(),!1);this.aggiornaStore()},editGridUtenteGruppi:function(a,b,c){var d=a.context.record;c=a.getEditor().getForm();c.controller=this;c.store=b.view.getStore();d={idGruppo:d.get("idGruppo"),idArea:d.get("codArea"),ricoveri:this.idRicovero};controller_salvaRecord(c,null,!1,d,!0,null,"codArea")?IsolaCmp(this.getGridUtenteGruppi(),!1):a.startEdit(b.record,0)},validateeditGridUtenteGruppi:function(a,b,c){return msgShow("",[])},
aggiornaStore:function(a){var b=this.getGridUtenteGruppi(),c=b.getStore(),d=b.getSelectionModel().getSelection()[0];Ext.isEmpty(this.idRicovero)||(a=a||d&&d.get("codArea"),svuotaStore(c),c.load({params:{idRicovero:this.idRicovero},callback:function(d,f,g){g?(f=null,Ext.isEmpty(d)||(a&&(f=trovaRecord(c,"codArea",a)),f&&(b.getSelectionModel().deselectAll(),b.getSelectionModel().select([f])))):msgShowError("",f.getError())}}))},onLaunch:function(){this.blocca=!1;this.idRicovero=this.cbaConfig.idRicovero;
this.storeGruppo=Ext.create("CS.personalizzazioni.personGruppiUtenti.impostazioni.store.CboxGruppi",{});var a=this.cbaConfig,b=a.idProfilo,c=a.blocca;this.idRicovero=a.idRicovero;this.idProfilo=b;(this.blocca=c)&&containerSolaLettura(this.getCntMain(),!0);this.aggiornaStore()},destroy:function(){eliminaStore(this.storeGruppo);this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.Cerca",{extend:"Generali.standard.ViewController",uses:["GeneraliOSP.integrazioni.AnagraficaSearchUtils"],init:function(){var a=this,b=this,c="#"+b.containerId+" ";b.callParent(arguments);b.addRef([{selector:c+"#ParametriRicerca"},{ref:"Form",selector:c+"#Form"},{ref:"Cognome",selector:c+"#Cognome"},{ref:"RisultatiRicerca",selector:c+"#RisultatiRicerca"},{ref:"DataDal",selector:c+"#DataDal"},{ref:"DataAl",selector:c+"#DataAl"},{ref:"GridRicerca",selector:c+
"#GridRicerca"},{ref:"BtnCerca",selector:c+"#BtnCerca"},{ref:"FsAvanzate",selector:c+"#FsAvanzate"},{ref:"BtnEsci",selector:c+"#BtnEsci"},{ref:"CbFiltro",selector:c+"#CbFiltro"},{ref:"CbFiltroRis",selector:c+"#CbFiltroRis"},{ref:"NomeContiene",selector:c+"#NomeContiene"},{ref:"BtnAggiungiOspite",selector:c+"#BtnAggiungiOspite"},{ref:"BtnElencoPazienti",selector:c+"#BtnElencoPazienti"},{ref:"CbSede",selector:c+"#CbSede"},{ref:"CbReparto",selector:c+"#CbReparto"},{ref:"FiltroSettUtente",selector:c+
"#FiltroSettUtente"},{ref:"AncheNonAttivi",selector:c+"#AncheNonAttivi"},{ref:"FiltroMedico",selector:c+"#FiltroMedico"},{ref:"ColResidenziale",selector:c+"#ColResidenziale"},{ref:"ColDataNascita",selector:c+"#ColDataNascita"},{ref:"ColSesso",selector:c+"#ColSesso"},{ref:"ColIsolamentoCovid",selector:c+"#ColIsolamentoCovid"},{ref:"ColMonitoraggioCovid",selector:c+"#ColMonitoraggioCovid"},{ref:"ColDataUltimoTamponeCovid",selector:c+"#ColDataUltimoTamponeCovid"},{ref:"CntFilterServizi",selector:c+"#CntFilterServizi"},
{ref:"ColVaccinazioni",selector:c+"#ColVaccinazioni"}]);b.control(c+"#CbFiltro",{change:b.changeCbFiltro});b.control(c+"#BtnCerca",{click:b.cerca});b.control(c+"#BtnAggiungiOspite",{click:function(b){AnagraficaSearchUtils.openWinAnagrafica(a.aggiungiOspite.bind(a))}});b.control(c+"#BtnElencoPazienti",{click:b.clickBtnElencoPazienti});b.control(c+"#Cognome",{change:Ext.Function.createBuffered(function(a){var c="";b.codOspiteTemp&&(c=b.codOspiteTemp,delete b.codOspiteTemp);b.cerca(null,c);a.focus()},
200,b),render:b.renderCognome});b.control(c+"#DataDal",{keydown:b.keydownData,change:b.changeData});b.control(c+"#DataAl",{keydown:b.keydownData,change:b.changeData});b.control(c+"#GridRicerca",{select:b.selectGridRicerca,beforeselect:b.beforeselectGridRicerca,selectionchange:b.selectionchangeGridRicerca,celldblclick:b.onCellDblClick,afterrender:b.initPagedList});b.control(c+"#BtnEsci",{click:b.clickEsci});b.control(c+"#CbSede",{change:b.changeCbSede});b.control(c+"#AncheNonAttivi",{change:b.changeAncheNonAttivi});
b.control(c+"#AncheNonAttivi",{change:b.changeAncheNonAttivi})},impostaParametri:function(a){if(!Ext.isEmpty(a)&&(this.lookup("Cognome").setValue(""),this.lookup("AncheNonAttivi").setValue(!1),a.dal&&this.lookup("DataDal").setValue(a.dal),a.al&&this.lookup("DataAl").setValue(a.al),a.filtroMedico&&this.lookup("FiltroMedico").setValue("T"==a.filtroMedico),a.idSede&&cbaValidId(a.idSede))){var b=this.lookup("CbSede");a.idReparto&&cbaValidId(a.idReparto)&&(b.cbaConfig.repartoSelezionato=a.idReparto,this.lookup("CbReparto").setValue(a.idReparto));
b.setValue(a.idSede)}},collapseFiltroUtente:function(){var a=this,b=this.cardActiveApplicativo.query("#pnldettab49")[0];if(!b.collapsed){b.collapse();if(Ext.isEmpty(b.query("#CntIconaEP")[0]))var c=setInterval(function(){Ext.isEmpty(b.query("#CntIconaEP")[0])||clearInterval(c)},200);var d=b.query("#CntIconaEP")[0];if(!d.getEl().hasListeners.click)d.getEl().on("click",function(b){a.openWinAnagGovernance()});d.show()}this.winAnaGov&&this.winAnaGov.close()},changeAncheNonAttivi:function(a,b){this.getDataDal().setValue(b?
null:new Date);this.getDataAl().setValue(b?null:new Date);this.getDataDal().setDisabled(b);this.getDataAl().setDisabled(b)},changeCbSede:function(a,b,c){var d=this;SvuotaCombo(this.getCbReparto());0<a.value&&(this.getCbReparto().getStore().getProxy().extraParams={sede:a.value,filtroSedRepPwd:"T"},this.getCbReparto().getStore().load({callback:function(b,c,g){g?(c=1===b.length&&CBA.parametriGenerali.filtriAttivi&&CBA.parametriGenerali.filtriAttivi.filtroReparti,d.getCbReparto().setDisabled(c),a.cbaConfig.repartoSelezionato?
(d.getCbReparto().setValue(a.cbaConfig.repartoSelezionato),delete a.cbaConfig.repartoSelezionato):c&&d.getCbReparto().setValue(b[0])):reject(c.getError())}}))},refreshStatoCovid:function(){var a=this;if(!this.monitoraggioCovidAbilitato)return!1;var b=this.getGridRicerca().getSelectionModel().getSelection()[0];Ext.isEmpty(b)||getPrevStatoMonitor((new moment(getServerTimeSync())).endOf("day").toDate(),b.get("idRicovero"),!0,!0).then(function(c){var d=a.PnlAnagrafica.down("#BtnMonitorCovid");d&&(d.removeCls(d.cbaConfig["class"]),
d.addCls("cba-css-button-light"),c&&(c.stato&&(d.removeCls("cba-css-button-light"),d.cbaConfig["class"]="cba-css-stato-monitoraggio-covid-btn-anagrafica-"+c.stato,d.addCls(d.cbaConfig["class"])),b.set("statoMonitoraggioCovid",c.stato),b.set("dataIsolamento",c.dataIsolamento||null),b.set("dataUltimoTampone",c.dataUltimoTampone||null)))})},onCellDblClick:function(a,b,c,d,e,f,g,h){-1!=g.target.className.indexOf("cba-css-stato")&&openMonitoraggioCovid(d.getData(),!0)},clickBtnElencoPazienti:function(a){var b=
this;2==this.versioneAnagrafica?(this.pnlDettab49.hide(),this.pnlElencoPazienti?this.pnlElencoPazienti.show():(this.pnlElencoPazienti=Ext.create("GeneraliCS.anagrafica.view.ElencoPazientiCnt",{cbaConfig:{pnlCerca:this.pnlDettab49,gridCercaClassic:this.getGridRicerca(),controllerCerca:this}}),this.PnlAnagrafica.up().insert(0,this.pnlElencoPazienti),this.getGridRicerca().on("select",function(){b.pnlElencoPazienti.down("grid").getSelectionModel().deselectAll()}))):this.openWinAnagGovernance()},openWinAnagGovernance:function(){var a=
this,b=this.getGridRicerca();this.creazioneParametri(b,null,{});b={dal:this.lookup("DataDal").getValue()||new Date,al:this.lookup("DataAl").getValue()||new Date,filtroMedico:this.lookup("FiltroMedico").getValue(),idSede:b.getStore().cbaConfig.parametri.idSede||-1,idReparto:b.getStore().cbaConfig.parametri.idReparto||-1};convertiBool(b);this.winAnaGov=Ext.create("CSS_winCBA",{name:"GeneraliCS.anagrafica.governanceAnagrafica.view.GovernanceAnagrafica",titolo:"",minWidth:!1,minHeight:!1,widgetMode:!0,
larghezzaWin:Ext.getBody().getViewSize().width-20,visualizzaAnagrafica:!1,configItem:{filtri:b,controllerCerca:this},listeners:{close:function(b){b.items.items[0].lookupController().getCntGridEP().items.items[0].lookupController().parametriModificati&&a.cerca();b.items.items[0].lookupController().winRicerca&&b.items.items[0].lookupController().winRicerca.close()}}});this.winAnaGov.show()},initPagedList:function(a){this.CtrlMenu.getBtnMenuSipcar().addCls("cba-css-btn-menu-sipcar");this.CtrlMenu.getTbMenu().addCls("cba-css-toolbar-tb-menu");
this.CtrlMenu.getTabApplicativi().getActiveTab().down("toolbar").addCls("cba-css-toolbar-tb-menu");this.CtrlMenu.getTabApplicativi().updateLayout();a=this.CtrlMenu.getCardApplicativo().getLayout().getActiveItem();var b=this.tabPanel49;this.pnlDettab49=a.down("#pnldettab49");b.add({title:"cruscotto",layout:{type:"hbox",align:"stretch"},cbaConfig:{utenteObbligatorio:!0},items:[{xtype:"container",layout:{type:"fit"},flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"middle",pack:"center"},items:[{xtype:"label",
itemId:"LabelMessaggio",reference:"LabelMessaggio",text:traduci("SELEZIONARE_UTENTE"),cls:"cbaCssLabel",style:{"font-weight":"bold","font-size":"20px"}}]}]}]});CBA.moduli.modulo49.cartella_old&&CBA.moduli.modulo49.ricovero_old&&(CBA.parametriGenerali.cmpTbMenu.down("tabpanel").down("#tab49").down("toolbar"),this.PnlAnagrafica.down("#BtnNomeUtente"),a=CBA.moduli.modulo49.ricovero_old,Ext.define("myModel",{extend:"Ext.data.Model",fields:[{name:"idRicovero"},{name:"codOspite"}]}),a=Ext.create("myModel",
a),this.loadStoreAnaSel(a))},intervalRicercaOspiti:function(a){var b=this;inizioAttesa();var c=0,d=Ext.Function.interval(function(){2E3>c?Ext.isDefined(CBA.moduli.modulo49.componentiCaricati)&&CBA.moduli.modulo49.componentiCaricati&&(b.loadStoreAnaSel(a),clearInterval(d),fineAttesa()):(clearInterval(d),b.loadStoreAnaSel(a),fineAttesa());c++},20)},getRicoveriPrecedenti:function(a,b){var c=this,d=Ext.create("GeneraliCS.anagrafica.store.ListRicoveriPrec"),e=a.data;d.load({params:{codOspite:e.codOspite,
codProfilo:CBA.parametriGenerali.codProfilo,idRicoveroEscluso:e.idRicovero,codEnte:CBA.parametriGenerali.codEntePwd,soloUno:"T",idTipologia:CBA.parametriGenerali.idProfiloCss,filtraTipologia:"F"},callback:function(a,d,e){e&&(c.PnlAnagrafica.down("#BtnRicoveriOld").setHidden(Ext.isEmpty(a)||CBA.moduli.modulo49.cartella_old),c.aggiornaDatiAnagrafici(b))}})},getImpostazMonitoraggioCovid:function(){var a=this,b=Ext.create("CS.personalizzazioni.personProtoCovid.impostazioni.store.Impostazioni");return new Promise(function(c,
d){b.load({params:{idProfilo:CBA.parametriGenerali.idProfiloCss},callback:function(b,f,g){g?Ext.isEmpty(b)||(b=b[0].getData().abilita,a.monitoraggioCovidAbilitato="T"==b,a.PnlAnagrafica.down("#BtnMonitorCovid").setHidden(!(b&&"T"==b)),c()):(msgShowError("",f.getError()),d())}})})},afterrenderParametriRicerca:function(){var a=this,b=a.getParametriRicerca().up("panel");if(b){b=b.getHeader();b.removeAll();var c=Ext.create("Ext.form.Label",{cls:"cbaCssLabelTitolo",text:traduci("FILTRO_UTENTE")});b.insert(0,
c);b.insert(1,Ext.create("Ext.toolbar.Fill"));b.insert(2,Ext.create("Ext.Img",{itemId:"IcnCreate",src:"/cba/css/generali/images/puntina.png",height:16,width:16,margin:"0 8 0 0",listeners:{afterrender:function(b){b.getEl().on("click",function(){a.collassaEspandi()});b.getEl().setStyle("cursor","pointer")}}}))}},changeCbFiltro:function(a,b){var c=this.getCbFiltroRis(),d;SvuotaCombo(c);this.getCbFiltroRis().setVisible(3!==b&&1!==b);if(b){switch(b){case 1:d=0}c.getStore().load({params:{idGroup:getIdGruppo(),
tiporec:d},callback:function(a,b,c){c||msgShowError("",b.getError())}})}},changeData:function(a){if(!Ext.isDefined(this.cbaConfig.changeDataDal)||!1!==this.cbaConfig.changeDataDal){this.cbaConfig.changeData&&this.cbaConfig.changeData();var b=this.getDataDal().getValue(),c=this.getDataAl().getValue();Ext.isDate(b)&&Ext.isDate(c)&&(b=Ext.Date.clearTime(b),c=Ext.Date.clearTime(c),b.getTime()>c.getTime()&&("DataAl"==a.getItemId()?(Messaggio("ATTENZIONE","CS_DATA_AL_PRECEDENTE_DAL_SET_DATADAL","OK","WARNING"),
this.getDataDal().setValue(c)):(Messaggio("ATTENZIONE","CS_DATA_DAL_SUCCESSIVA_AL_SET_DATAAL","OK","WARNING"),this.getDataAl().setValue(b))))}},clickEsci:function(a){a.up("window").close()},renderCognome:function(a){a.up("window")?Ext.Function.defer(function(){a.focus()},1E3):a.focus()},winModificaOspite:function(a,b){Ext.create("winCBA",{permesso:b.permesso,name:"GeneraliOSP.fascicoloNoApp.view.EditFascicolo",titolo:"TITOLO_ANAGRAFICA_UTENTE_CSS",dimensione:"GestioneUtente",configItem:b}).show()},
winControllaOspiti:function(a,b){Ext.create("winCBA",{permesso:"S",name:"CS.profili.associazioni.view.ServiziUtenti",titolo:"TITOLO_ANAGRAFICA_UTENTE_CSS",dimensione:"GestioneUtente",maximizable:!1,closable:!0,configItem:b}).show()},aggiungiOspite:function(a){this.versioneAnagrafica=Ext.isEmpty(this.versioneAnagrafica)?1:this.versioneAnagrafica;a={permesso:"S",nuovo:!0,hideFunzioni:!0,controllerFascicolo:this,editVersioneAnagrafica:2==this.versioneAnagrafica?!1:!0,versioneAnagrafica:this.versioneAnagrafica,
desVideata:traduci("ANAGRAFICA"),recordIntegrazione:a};if(1==this.versioneAnagrafica){var b=trovaRecord(CBA.moduli.modulo49.storeVideateGen,"codVideata","OSP_Anagrafica").get("permesso"),c=trovaRecord(CBA.moduli.modulo49.storeVideateGen,"codVideata","EditRicoveri").get("permesso");"S"==b&&"S"==c?this.winModificaOspite("NUOVO_TITOLO",a):Messaggio("ATTENZIONE","MSG_NO_PERMESSI_EDIT_ANAG","OK","INFO")}else this.winControllaOspiti("NUOVO_TITOLO",a)},startInitGestAnagrafica:function(){var a=this,b=this;
this.initBtnAnagrafica||(this.PnlAnagrafica.setVisible(!0),this.initBtnAnagrafica=!0,this.PnlAnagrafica.down("#BtnNomeUtente").on("click",function(){var c={permesso:"S",currOspite:a.utenteSelezionato.data,nuovo:!1,controllerFascicolo:a,callbackEsci:Ext.Function.bind(a.aggiornaUtenteSel,a,[a],!0),editVersioneAnagrafica:2==b.versioneAnagrafica?!1:!0,desVideata:traduci("ANAGRAFICA"),isEditMode:!0,CSS_assenze:!0,CSS_residenza:!0,CSS_permessi:b.visualizzaTabPermessi,CSS_consenso:b.visualizzaTabConsenso,
CSS_servizi:!0};a.winModificaOspite("TITOLO_MODIFICA_UTENTE",c)}))},updateDashboard:function(){var a=this,b=this.tabPanel49.getActiveTab();checkConsultazioneCartella(CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data,CBA.moduli.modulo49.operatore.id).then(function(c){if(b){var d=b.down("dashboard");null!=d&&d.setHidden(!c);b.cbaConfig.utenteObbligatorio&&(d=b.query("#PortletStd"),Ext.each(d,function(a){a.controller.controllerContenuto.fireEvent("cleanPortlet")}),c&&Ext.each(d,function(a){caricaPortletCSS(a.controller,
null,null,!0)}))}c?a.openOneDash():Messaggio("ATTENZIONE","MSG_NO_PERMESSI_CONSULTAZIONE","OK","INFO",null,null,null,null,!0)})["catch"](function(a){msgShowError("",a)})},openOneDash:function(){var a=0,b=null;this.CtrlMenu.getTabApplicativi().getActiveTab().query("button").forEach(function(c){c.cbaConfig.utenteObbligatorio&&(a++,b=c)});1==a?b.handler():this.tabPanel49.query("#LabelMessaggio")[0].setText(traduci("SELEZIONARE_CRUSCOTTO"))},stackCallbackLoadAnagrafica:function(a,b){this.utenteSelezionato=
a;this.startInitGestAnagrafica();this.updateDashboard()},loadStoreAnaSel:function(a){var b=this;CBA.moduli.modulo49.storeAnagraficaSel.load({params:{id:a.get("codOspite"),idRicovero:a.get("idRicovero")},callback:function(c,d,e){fineAttesa();e?(b.stackCallbackLoadAnagrafica(a,c[0]),b.getRicoveriPrecedenti(a,c[0]),b.monitoraggioCovidAbilitato&&b.refreshStatoCovid()):msgShowError("",d.getError())}})},selectGridRicerca:function(a,b){this.cbaConfig.dblclickGridRicerca&&this.cbaConfig.dblclickGridRicerca(a,
b);this.cbaConfig.callbackExtraCerca?this.cbaConfig.callbackExtraCerca(b):this.loadStoreAnaSel(b);this.cbaConfig.select&&this.cbaConfig.select(a,b)},beforeselectGridRicerca:function(a,b){if(this.cbaConfig.beforeselect&&!this.cbaConfig.beforeselect(a,b))return!1},selectionchangeGridRicerca:function(a,b){this.cbaConfig.selectionChange&&this.cbaConfig.selectionChange(a,b)},aggiornaUtenteSel:function(){var a=this.pnlElencoPazienti?this.pnlElencoPazienti.lookupController().getCntGridEP().down("#GridEP"):
this.getGridRicerca();Ext.isEmpty(a.getSelectionModel().getSelection()[0])&&(a=this.getGridRicerca());var b=CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0],c=CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0].get("codOspite"),d=trovaRecord(a.getStore(),"codOspite",c),a=[],e;for(e in d.data)a.push(e);Ext.each(a,function(a){d.get(a)&&b.get(a)&&d.set(a,b.get(a))});this.aggiornaDatiAnagrafici(b)},aggiornaDatiAnagrafici:function(a){var b=this,c=this.PnlAnagrafica.down("#BtnNomeUtente"),
d=this.PnlAnagrafica.down("#ImgFotoUtente"),e=this.PnlAnagrafica.down("#ImgChiusuraSanitaria"),f=a.get("codOspite");CBA.moduli.modulo49.controllerDashboard&&blockDash(a.get("chiusuraSanitaria")?!0:!1,!0);e.setHidden(!a.get("chiusuraSanitaria"));e="<spam>"+a.get("nominativo")+"</spam>";Ext.isEmpty(a.get("lingua"))||(e+="<spam style='font-size:60%;margin-left:5px'>"+a.get("lingua")+"</spam>");c.setText(e);e="#FFFFFF";"T"==a.get("convenzionato")&&(e=a.get("coloreConvenzionato"));c.btnInnerEl.setStyle({color:e});
a.get("isAssente")?(c.setIconCls("box-ospite-assente"),c.btnIconEl.setStyle({position:"inherit","margin-top":"1px"}),c.btnInnerEl.setStyle({marginLeft:0}),c.setTooltip(Ext.String.format(traduci("MSG_OSP_ASSENTE"),a.get("nominativo")))):(c.setIconCls(""),c.setTooltip(null));d.loadFotoOspite(f);Ext.create("GeneraliCS.anagrafica.store.InformazioniAnagrafica").load({params:{idRicovero:a.get("idRicovero")},callback:function(a,c,d){if(d){if(!Ext.isEmpty(a)){var e=b.PnlAnagrafica.down("#LblInfoUtente"),
f="";e.setHtml();Ext.suspendLayouts();a.forEach(function(a){18===a.get("codice")&&(1==a.data.extra?a.data.extra='<img src="/cba/css/generali/images/generali/malattia_infet.svg" width=14px height=14px>':2==a.data.extra?a.data.extra='<img src="/cba/css/generali/images/generali/malattia.svg" width=14px height=14px>':3==a.data.extra&&(a.data.extra='<img src="/cba/css/generali/images/generali/malattia_inf_trasm.png" width=14px height=14px>'));if(a.get("extra")){var b=e.html||"";f=a.get("valore")?"<nobr><strong>"+
a.get("valore")+":</strong> "+a.get("extra")+"</nobr>":"<nobr> "+a.get("extra")+"</nobr>";e.setHtml(b+f);e.getWidth()+3>=e.up().getWidth()?e.setHtml(b+"<br>"+f+"&nbsp&nbsp&nbsp&nbsp"):e.setHtml(b+f+"&nbsp&nbsp&nbsp&nbsp")}});Ext.resumeLayouts(!0)}}else msgShowError("",c.getError())}});CBA.moduli.modulo49.superDiario&&Ext.getCmp(CBA.moduli.modulo49.superDiario)&&Ext.getCmp(CBA.moduli.modulo49.superDiario).close()},keydownData:function(a,b){12==b.button&&this.cerca()},creazioneParametri:function(a,
b,c){var d=a.getStore();if(b){this.getCognome().setValue("");c=this.getDataDal();var e=this.getDataAl();b.dataDal<c.getValue()&&c.setValue(b.dataDal);b.dataDal>e.getValue()&&e.setValue(b.dataDal);this.getCbFiltro().setValue("")}d.cbaConfig.parametri||(d.cbaConfig.parametri={});b=this.getDataAl().getValue();c=this.getDataDal().getValue();b&&dmyIsEqual(b,new Date)&&(b=new Date);c&&dmyIsEqual(c,new Date)&&(c=new Date);c={idProfilo:CBA.parametriGenerali.idProfiloCss,nome:this.getCognome().getValue(),
dal:c,al:b,contiene:getBoolValue(!this.getNomeContiene().getValue()),maxResults:a.cbaConfig.paged.maxResults};var f,g;if(1===this.getCbSede().getStore().data.length&&this.getCbReparto().getValue()||1<this.getCbSede().getStore().data.length&&this.getCbSede().getValue())f=this.getCbSede().getValue(),g=this.getCbReparto().getValue();f?Ext.apply(c,{idSede:f}):delete d.cbaConfig.parametri.idSede;g?Ext.apply(c,{idReparto:g}):delete d.cbaConfig.parametri.idReparto;this.getFiltroSettUtente()&&Ext.apply(c,
{filtroSettori:getBoolValue(this.getFiltroSettUtente().getValue())});this.getAncheNonAttivi()&&Ext.apply(c,{ancheNonAttivi:getBoolValue(this.getAncheNonAttivi().getValue())});this.getFiltroMedico()&&Ext.apply(c,{filtroMedico:getBoolValue(this.getFiltroMedico().getValue())});a=CBA.parametriGenerali.filtroServiziCss;var h="";(f=this.lookup("GridServiziCu"))&&0<f.getStore().data.items.length&&(h="",f.getStore().data.items.forEach(function(a){a.get("checked")&&(h+=a.get("codice")+",")}));Ext.apply(c,
{filtroServiziCss:h||a});this.cbaConfig.myParams&&(Ext.apply(c,this.cbaConfig.myParams),b=this.cbaConfig.myParams);Ext.apply(d.cbaConfig.parametri,c);for(var k in d.cbaConfig.parametri)Ext.isEmpty(d.cbaConfig.parametri[k])&&delete d.cbaConfig.parametri[k]},cerca:function(a,b,c){if(CBA.moduli.modulo49.cartella_old)return fineAttesa(),this.pnlDettab49.hide(),!1;var d=this,e=d.getGridRicerca(),f=d.getCbFiltro(),g=d.getCbFiltroRis(),h=e.getStore(),k={};e.cbaConfig.paged.fromScroll||(svuotaStore(h),Ext.apply(e.cbaConfig.paged,
{fromScroll:!1}),Ext.apply(h.cbaConfig.parametri,{firstResult:0}));d.creazioneParametri(e,a,k);d.cbaConfig.callbackFnCerca&&d.cbaConfig.callbackFnCerca(k);if(f.getValue()){var f=f.getValue(),l="";1==f?Ext.isEmpty(d.listaReparti)||(l=d.listaReparti.toString()):l=g.getValue().toString();Ext.apply(k,{tabFilter:f,idTabFilter:l,maxResults:0})}g=Ext.isDefined(d.cbaConfig.myUrl)?d.cbaConfig.myUrl:"/cba/css/cs/ws/anagrafica/list";Ext.Ajax.request({method:"GET",url:g,async:!1,params:h.cbaConfig.parametri,
success:function(f){f=Ext.JSON.decode(f.responseText);var g=f.data;if(f.success){if(Ext.isEmpty(g))Ext.apply(e.cbaConfig.paged,{fromScroll:!1});else{e.getSelectionModel().deselectAll();d.cbaConfig.callBackCerca&&(d.cbaConfig.callBackCerca(g,e),d.getCognome().focus());var h;Ext.each(g,function(a){h=Ext.create("GeneraliCS.anagrafica.model.Anagrafica",a);e.getStore().add(h)});Ext.apply(e.cbaConfig.paged,{fromScroll:!1});a&&a.idAna&&((f=trovaRecord(e.getStore(),"id",a.idAna))?e.getSelectionModel().select([f]):
gestioneMsgUtenteNonTrovato&&Messaggio("ATTENZIONE","UTENTE_NON_TROVATO","OK","WARNING"));b&&((f=trovaRecord(e.getStore(),"id",b))&&e.getSelectionModel().select([f]),c&&d.collapseFiltroUtente());d.cbaConfig.somministrazioneTerapie&&1==e.getStore().getData().length&&e.getSelectionModel().select(0)}isSecondWinCss()||CBA.taskNotifiche.stopped&&CBA.taskNotifiche.start();fineAttesa()}else msgShowError("",f.message)}})},controllaRicoveriDaUscitaAna:function(){var a=this.getGridRicerca(),b=this;Ext.Ajax.request({method:"GET",
url:"css/cs/ws/ricoveri/search",async:!1,params:{codospite:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).get("codOspite"),idProfilo:CBA.parametriGenerali.idProfiloCss},success:function(c){var d=Ext.JSON.decode(c.responseText);c=d.data;if(d.success){if(!Ext.isEmpty(c)){var d=Ext.Date.format(new Date,"Y-m-d H:i:s"),e=trovaRecord(a.getStore(),"codOspite",c[0].codOspite);e&&(!Ext.isEmpty(c[0].al)&&c[0].al<d&&1==e.data.attivo?(a.cbaConfig.paged.fromScroll=!1,e.data.al=c[0].al,b.cerca()):(Ext.isEmpty(c[0].al)&&
0==e.data.attivo&&(e.data.al=""),b.aggiornaDatiUtente()))}}else msgShowError("",d.message)}})},aggiornaDatiUtente:function(){var a=this.getGridRicerca(),b=this;Ext.Ajax.request({method:"GET",url:"css/cs/ws/anagrafica/get",async:!1,params:{id:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).get("codOspite"),idRicovero:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).get("idRicovero")},success:function(c){var d=Ext.JSON.decode(c.responseText);c=d.data;if(d.success){if(!Ext.isEmpty(c)){var e=trovaRecord(a.getStore(),
"codOspite",c.codOspite),d=a.getStore().indexOf(e);a.getStore().remove(e);c.al=e.get("al");c.chiusuraSanitaria=e.get("chiusuraSanitaria");c.compilatoreChiusuraSanitaria=e.get("compilatoreChiusuraSanitaria");b.ordinamentoResidenziale&&(c.numStanza=c.residenza&&c.residenza.numStanza,c.numLetto=c.residenza&&c.residenza.numLetto);c=Ext.create("GeneraliCS.anagrafica.model.Anagrafica",c);a.getStore().insert(d,c);a.getSelectionModel().deselectAll();a.getSelectionModel().select(d)}fineAttesa()}else msgShowError("",
d.message)}})},collassaEspandi:function(){var a=this.getParametriRicerca().up("panel");a&&(a.collapsed?a.expand():a.collapse())},onLaunch:function(){var a=this,b=this;b.getGridRicerca();b.cbaConfig.permesso="S";b.ordinamentoResidenziale=!1;b.monitoraggioCovidAbilitato=!1;this.getBtnAggiungiOspite().setHidden(Ext.isDefined(this.cbaConfig.hideBtnFascicoloOsp)&&this.cbaConfig.hideBtnFascicoloOsp);this.cbaConfig.dataDal&&this.lookup("DataDal").setValue(this.cbaConfig.dataDal);if(!Ext.isEmpty(CBA.parametriGenerali.filtroServiziCss)){var c=
b.lookup("GridServiziCu");c.getStore().load({async:!1,params:{idOrganizzazione:CBA.parametriGenerali.idOrganizzazione},callback:function(a,d,g){g?(c.getStore().data.items.forEach(function(a){Ext.isEmpty(CBA.parametriGenerali.filtroServiziCss)||CBA.parametriGenerali.filtroServiziCss.split(",").includes(a.get("codice").toString())&&a.set("checked",!0)}),b.getCntFilterServizi().show()):msgShowError("",d.getError())}})}b.versioneAnagrafica=1;b.visualizzaTabPermessi=!1;var d=!(Ext.isDefined(this.cbaConfig.hideBtnElencoPaz)&&
this.cbaConfig.hideBtnElencoPaz);Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/anagrafica/impostazioni/get",async:!1,params:{idProfilo:CBA.parametriGenerali.idProfiloCss},success:function(a){a=Ext.JSON.decode(a.responseText);a.success&&!Ext.isEmpty(a.data)&&(b.versioneAnagrafica=a.data.versioneAnagrafica,d="T"==a.data.elencoPazienti&&d?!0:!1,b.visualizzaTabPermessi="T"==a.data.permessi?!0:!1)}});b.getCbSede().getStore().load({params:{filtroSedRepPwd:"T"},callback:function(a,c,d){d?1==a.length?
(b.getCbSede().setValue(a[0]),b.getCbSede().setDisabled(!0)):b.getCbSede().setDisabled(!1):msgShowError("",c.getError())}});this.getBtnElencoPazienti().setHidden(!d);this.CtrlMenu=Sipcar.app.getController("Menu");this.cardActiveApplicativo=this.CtrlMenu.getCardApplicativo().getLayout().getActiveItem();this.PnlAnagrafica=this.cardActiveApplicativo.down("#pnlAnadettab49");this.tabPanel49=this.cardActiveApplicativo.down("#tbdettab49");CBA.parametriGenerali.produzione?CBA.moduli.modulo49.cartella_old||
insertTipologiaCss(this.CtrlMenu):Ext.defer(function(){CBA.moduli.modulo49.cartella_old||insertTipologiaCss(a.CtrlMenu)},1200);b.visualizzaTabConsenso=!1;Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/dossier/impostazioni/get",async:!1,params:{},success:function(a){var c=Ext.JSON.decode(a.responseText);c.success&&(Ext.isEmpty(c.data)||Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/anagrafica/impostazioni/get",async:!1,params:{idProfilo:CBA.parametriGenerali.idProfiloCss},success:function(a){var d=
Ext.JSON.decode(a.responseText);if(d.success&&!Ext.isEmpty(d.data)){a=c.data.dossier;d=d.data.anagTipoOrdinamento;"T"==CBA.parametriGenerali.consenso&&(b.visualizzaTabConsenso="T"==a?!0:!1);var e=b.ordinamentoResidenziale=2==d;b.getColResidenziale().setHidden(!e);b.getGridRicerca().sortableColumns=!e;b.getColSesso().setHidden(e);e&&!b.cbaConfig.fromFiltroUtente&&b.getColDataNascita().setHidden(!0);b.cbaConfig.fromFiltroUtente&&b.getImpostazMonitoraggioCovid().then(function(){var a=300;b.getColIsolamentoCovid().setHidden(!b.monitoraggioCovidAbilitato);
b.getColMonitoraggioCovid().setHidden(!b.monitoraggioCovidAbilitato);b.getColDataUltimoTamponeCovid().setHidden(!b.monitoraggioCovidAbilitato);b.monitoraggioCovidAbilitato&&(e&&(a=360),a+=280);var c=b.cardActiveApplicativo.down("panel");c.hide();c.setMaxWidth(a);c.updateLayout();c.show()})}}}))}});b.getGridRicerca().controller=b;b.getFsAvanzate().collapse();b.cbaConfig.callbackExtraCerca||Ext.apply(CBA.moduli.modulo49,{storeAnagraficaSel:Ext.create("GeneraliCS.anagrafica.store.AnagraficaUtSelezionato")});
if(CBA.moduli.modulo49&&!Ext.isDefined(CBA.moduli.modulo49.controllerCercaAnagrafica)||Ext.isDefined(CBA.moduli.modulo49.controllerCercaAnagrafica)&&CBA.moduli.modulo49.controllerCercaAnagrafica.isDestroyed)CBA.moduli.modulo49.controllerCercaAnagrafica=b;b.cbaConfig.fnAggiorna=b.cerca;hideFiltroSettori(b.getFiltroSettUtente())},destroy:function(){eliminaStore(this.storeTipologia);this.lookup("CbSede")&&eliminaStore(this.lookup("CbSede").getStore());this.lookup("CbReparto")&&eliminaStore(this.lookup("CbReparto").getStore());
this.lookup("GridServiziCu")&&eliminaStore(this.lookup("GridServiziCu").getStore());this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.CruscottoPnlAnagrafica",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"ImgFotoUtente",selector:a+"#ImgFotoUtente"}]);this.control(a+"#ImgFotoUtente",{click:this.clickImgFotoUtente})},estensioneValida:function(a){if(-1!=a.search(/.png/i)||-1!=a.search(/.jpg/i)||-1!=a.search(/.jpeg/i))return!0;Messaggio("ATTENZIONE","PER_ERRORE_FORMATO_FOTO","OK","ERROR");return!1},clickImgFotoUtente:function(a){var b=
Ext.create("winCBA",{permesso:"S",name:"GeneraliCS.anagrafica.view.ModificaPazienteImg",titolo:"MODIFICA_IMG_PAZIENTE",clsWin:"cbaCssBordoPopup",closable:!0,maximizable:!1,maximized:!1,resizable:!1,larghezzaWin:300,altezzaWin:350,configItem:{permesso:"S",elImg:a}}).show(),c=a.getPosition()[0]+a.getWidth();a=a.getPosition()[1]+a.getHeight();b.showAt(c,a)},onLaunch:function(){},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.CruscottoSpecialButtons",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnAnagraficaMore",selector:a+"#BtnAnagraficaMore"},{ref:"BtnRicoveriOld",selector:a+"#BtnRicoveriOld"},{ref:"BtnMonitorCovid",selector:a+"#BtnMonitorCovid"}]);this.control(a+"#BtnAnagraficaMore",{click:this.clickBtnAnagraficaMore});this.control(a+"#BtnRicoveriOld",{click:this.clickBtnRicoveriOld});
this.control(a+"#BtnMonitorCovid",{click:this.onClickBtnMonitorCovid})},onClickBtnMonitorCovid:function(a){(a=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0))&&openMonitoraggioCovid(a.getData())},clickBtnRicoveriOld:function(a){var b=Ext.create("winCBA",{titolo:traduci("STORICO_RICOVERI"),larghezzaWin:500,altezzaWin:400,layout:"fit",maximizable:!1,closable:!1,name:"GeneraliCS.anagrafica.view.ListRicoveriPrec"});b.showBy(a,"bl",[-b.larghezzaWin,0])},clickBtnAnagraficaMore:function(a){if(!this.rapidsHidden)return!1;
this.hideShowFABsPanel(a)},hideShowFABsPanel:function(a){var b=this;this.rapidsHidden?(this.fabsPanel.showBy(a),a.setIconCls("css-more-white-horizontal")):(this.fabsPanel.setHidden(!0),a.setIconCls("css-more-white"));a.addCls("animated flipInX");setTimeout(function(){a.removeCls("animated flipInX")},1E3);this.fabsPanel.query("[buttonRapid]").forEach(function(a,d){b.rapidsHidden?setTimeout(function(){a.addCls("animated fadeInDownBig animation-duration-04");a.setHidden(!1);setTimeout(function(){a.removeCls("animated fadeInDownBig animation-duration-04")},
1E3+30*(d+1))},30*(d+1)):a.setHidden(!0)});this.rapidsHidden=!this.rapidsHidden;Ext.defer(function(){b.fabsPanel.isOpen=!b.rapidsHidden},100)},createFABsPanel:function(a){var b=this,c=[];this.FABsConfig.forEach(function(a){c.push(b.createFAB(a))});var d=Ext.create("Ext.Container",{itemId:"FABsPanel",floating:!0,constrain:!0,hidden:!0,hideMode:"visibility",mouseLeaveDelay:50,defaultAlign:"tl-bl?",focusOnToFront:!1,bringParentToFront:!1,alignOnScroll:!1,layout:{type:"vbox",align:"right",overflowHandler:"Scroller"},
shadow:!1,items:c,style:{"box-shadow":"white 0px 1px 5px",padding:"13px 5px 5px 5px","background-color":"rgba(255,255,255,0.3)"}});Ext.getBody().on("click",function(){d&&d.isOpen&&b.hideShowFABsPanel(a)});return d},createFAB:function(a){Ext.apply(a,{cls:"cbaCssBtnAnagrafica cbaCssBtnAnagrafica-orange css-ana-special-button",buttonRapid:!0,hidden:!0,style:{"box-shadow":"rgb(171, 171, 171) 0px 2px 6px",margin:"0px 10px 10px 10px",minWidth:32}});return Ext.create("Ext.button.Button",a)},clickBtnStampaCartella:function(a){Ext.create("CSS_winCBA",
{name:"CS.stampe.view.StampaCartella",titolo:traduci("STAMPA_CARTELLA"),visualizzaAnagrafica:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data,configItem:{permesso:"S"}}).cssDefaultShow()},clickBtnStampaTerapieSom:function(a){Ext.create("winCBA",{name:"CS.terapie.view.StampaTerapieSomministrate",titolo:traduci("STAMPA_TERAPIE_SOMMINISTRATE"),configItem:{permesso:"S"}}).on("afterrender",function(a){a.el.dom.style.opacity=0})},clickBtnAssociaTipologia:function(a){a=Ext.getBody().getViewSize().height-
40;var b=Ext.create("winCBA",{name:"CS.profili.associazioni.view.ServiziUtenti",titolo:traduci("ASSOCIA_TIPOLOGIA"),maximizable:!1,closable:!0,configItem:{permesso:"S",hideFunzioni:!1}});b.setWidth(1024);b.setHeight(a);b.showAt(.5*CBA.parametriGenerali.cmpTbMenu.getWidth()-512,20)},clickBtnAttivita:function(a){a=Ext.getBody().getViewSize().width-40;var b=Ext.getBody().getViewSize().height-40,c=Ext.create("winCBA",{name:"CS.personalizzazioni.personAttivita.view.Generale",titolo:traduci("ATTIVITA"),
maximizable:!1,closable:!0,configItem:{permesso:"S"}});c.setWidth(a);c.setHeight(b);c.showAt(.5*CBA.parametriGenerali.cmpTbMenu.getWidth()-.5*a,20)},clickBtnWarning:function(a){Ext.create("CSS_winCBA",{name:"CS.warning.view.Warning",titolo:traduci("GEST_PROF_WARNING"),configItem:{permesso:"S",idProfilo:CBA.parametriGenerali.idProfiloCss,idModulo:CBA.moduli.moduloAttivo,fromAnagrafica:!0,tipo:null}}).cssDefaultShow()},clickBtnGestoreConsultazione:function(a){Ext.create("CSS_winCBA",{name:"CS.consultazioneCartella.view.ConsultazioneCartella",
titolo:traduci("GESTIONE_CONSULTAZIONE_CARTELLA"),configItem:{permesso:"S",idOrganizzazione:CBA.parametriGenerali.idOrganizzazione,idProfilo:CBA.parametriGenerali.idProfiloCss}}).cssDefaultShow()},clickBtnProdottiMedicazioni:function(a){a=Ext.getBody().getViewSize().height-40;this.cbaConfig.idProfilo=CBA.parametriGenerali.idProfiloCss;var b=Ext.create("winCBA",{name:"CS.personalizzazioni.personLesioni.medicazioni.view.MedMain",titolo:traduci("PRODOTTI_MEDICAZIONI"),maximizable:!1,closable:!0,configItem:{permesso:"S",
hideFunzioni:!1,idProfilo:CBA.parametriGenerali.idProfiloCss}});b.setWidth(1024);b.setHeight(a);b.showAt(.5*CBA.parametriGenerali.cmpTbMenu.getWidth()-512,20)},setDisabledStyle:function(a,b){a.getEl().dom.style.opacity=b?"0.9":"";a.getEl().dom.style.filter=b?"saturate(0.8)":"";a.getEl().dom.style.cursor=b?"not-allowed":""},onLaunch:function(){this.rapidsHidden=!0;this.FABsConfig=[{itemId:"BtnStampaCartella",reference:"BtnStampaCartella",text:traduci("STAMPA_CARTELLA"),handler:this.clickBtnStampaCartella},
{itemId:"BtnStampaTerapieSom",reference:"BtnStampaTerapieSom",text:traduci("STAMPA_TERAPIE_SOMMINISTRATE"),handler:this.clickBtnStampaTerapieSom}];"T"===CBA.moduli.modulo49.operatore.prescrittore&&this.FABsConfig.push({itemId:"BtnWarning",reference:"BtnWarning",text:traduci("GEST_PROF_WARNING"),handler:this.clickBtnWarning});"T"===CBA.moduli.modulo49.operatore.cssGestoreConsultazione&&this.FABsConfig.push({itemId:"BtnGestoreConsultazione",reference:"BtnGestoreConsultazione",text:traduci("GESTORE_CONSULTAZIONE_CARTELLA"),
handler:this.clickBtnGestoreConsultazione});"T"!==CBA.parametriGenerali.amministratore&&"T"!==CBA.parametriGenerali.ricoveriCss||this.FABsConfig.push({itemId:"BtnAssociaTipologia",reference:"BtnAssociaTipologia",text:traduci("ASSOCIA_TIPOLOGIA"),handler:this.clickBtnAssociaTipologia});"T"!==CBA.parametriGenerali.amministratore&&"T"!==CBA.parametriGenerali.cssAttivita||this.FABsConfig.push({itemId:"BtnAttivita",reference:"BtnAttivita",text:traduci("ATTIVITA"),handler:this.clickBtnAttivita});"T"!==
CBA.parametriGenerali.amministratore&&"T"!==CBA.parametriGenerali.cssProdottiMedicazioni||this.FABsConfig.push({itemId:"BtnProdottiMedicazioni",reference:"BtnAttivita",text:traduci("PRODOTTI_MEDICAZIONI"),handler:this.clickBtnProdottiMedicazioni});this.fabsPanel=this.createFABsPanel(this.getBtnAnagraficaMore())},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.ElencoPazientiCmp",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"CntGrid",selector:a+"#CntGrid"},{ref:"CntTitleAnteprimaEP",selector:a+"#CntTitleAnteprimaEP"}]);this.control(a+"#BtnEsci",{click:this.clickBtnEsci})},clickBtnEsci:function(a){a.up("window").close()},checkGenGrid:function(){var a=this;this.cbaConfig.fakeGrid?this.genGrid():
(this.cbaConfig.store=Ext.create("CS.personalizzazioni.elencoPazienti.impostazioni.store.Impostazioni"),this.cbaConfig.store.load({params:{idProfilo:this.idProfilo},callback:function(b,c,d){d?(Ext.each(b,function(b){-1!=b.getData().descrTipoCampo.indexOf("Regime")&&(a.cbaConfig.controlleCnt.cbaConfig.idRegime=b.getData().tipoCampo);-1!=b.getData().descrTipoCampo.indexOf("Categoria")&&(a.cbaConfig.controlleCnt.cbaConfig.idCategoria=b.getData().tipoCampo)}),a.genGrid()):msgShowError("",c.getError())}}))},
genGrid:function(){var a=this;Ext.suspendLayouts();var b=[],c=[],d=this.getCntGrid().getWidth()-15,e=null,f=null,g=0,h=0;this.cbaConfig.store.each(function(b){c.push(b.data);e=trovaRecord(a.storeLarghezzaColonna,"codice",b.data.larghezzaColonna);if(!e)return!1;"px"===e.get("unit")?h+=e.get("extra"):"%"===e.get("unit")&&(g+=e.get("extra")/100)});d-=h;c.forEach(function(c){e=trovaRecord(a.storeLarghezzaColonna,"codice",c.larghezzaColonna);f=e.get("unit");b.push({xtype:"gridcolumn",text:c.titoloColonna,
dataIndex:"campo"+(b.length+1),centered:5===e.get("codice")?!0:!1,sortable:!1,width:"px"===f?e.get("extra"):d/g*(e.get("extra")/100),renderer:function(b,d,e,f,g,h,k){if("P"===c.tipoColonna){e=a.storeIconeSiNo;if(b="T"===b?c.iconaSi:"F"===b?c.iconaNo:null)if(b=trovaRecord(e,"codice",b))d.tdCls=b.get("extra");return""}return b}})});var k=this.cbaConfig.fakeGrid;this.getCntGrid().add(Ext.create("Ext.grid.Panel",{itemId:k?"GridAnteprima":"GridEP",reference:k?"GridAnteprima":"GridEP",autoScroll:"vertical",
scrollable:!0,cbaPaged:k?null:!0,store:Ext.create("GeneraliCS.anagrafica.store.ElencoPazientiCmp"),disableSelection:k,flex:1,margin:k?null:"1 3 1 5",cls:"grid-elenco-pazienti",columns:b,viewConfig:k?null:{loadMask:!1},listeners:{select:"selectGrid"}}));Ext.resumeLayouts();k?this.getCntGrid().up("window").updateLayout():this.getCntGrid().up("#CntGridEP").updateLayout();this.cbaConfig.fnAggiorna=this.cerca;this.cerca()},selectGrid:function(a,b){this.cbaConfig.gridCercaClassic.getSelectionModel().deselectAll();
this.cbaConfig.controllerCerca.loadStoreAnaSel(b)},aggiornaStore:function(a){this.getCntGrid().down("grid").getStore().load({params:{idProfilo:this.idProfilo,maxResults:this.cbaConfig.fakeGrid?1:5},callback:function(a,c,d){d||msgShowError("",c.getError())}})},cerca:function(a){var b=this.getCntGrid().down("grid"),c=b.getStore();b.cbaConfig.paged&&!b.cbaConfig.paged.fromScroll&&(svuotaStore(c),Ext.apply(b.cbaConfig.paged,{fromScroll:!1}),Ext.apply(c.cbaConfig.parametri,{firstResult:0}));c.cbaConfig.parametri||
(c.cbaConfig.parametri={});Ext.apply(c.cbaConfig.parametri,{idProfilo:CBA.parametriGenerali.idProfiloCss,maxResults:this.cbaConfig.fakeGrid?1:5});var d=this.filtriAggiuntivi;this.filtriAggiuntivi&&Ext.apply(d,c.cbaConfig.parametri);Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/elencopazienti/list",async:!1,params:this.filtriAggiuntivi?d:c.cbaConfig.parametri,success:function(d){var e=Ext.JSON.decode(d.responseText);d=e.data;if(e.success){if(!Ext.isEmpty(d)){b.getSelectionModel().deselectAll();
a&&a.idAna&&((e=trovaRecord(b.getStore(),"id",a.idAna))?b.getSelectionModel().select(e):Messaggio("ATTENZIONE","UTENTE_NON_TROVATO","OK","WARNING"));var g;Ext.each(d,function(a){g=Ext.create("GeneraliCS.anagrafica.model.ElencoPazienti",a);c.add(g)});b.cbaConfig.paged&&Ext.apply(b.cbaConfig.paged,{fromScroll:!1})}fineAttesa()}else msgShowError("",e.message)}})},updatePaziente:function(){var a=this.getCntGrid().down("grid").getStore(),b=CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0];Ext.Ajax.request({method:"GET",
url:a.getProxy().api.read,async:!1,params:{idProfilo:CBA.parametriGenerali.idProfiloCss,codOspite:b.get("codOspite")},success:function(b){var c=Ext.JSON.decode(b.responseText);b=c.data;if(c.success)if(Ext.isEmpty(b))Messaggio("ATTENZIONE","NESSUN_ESAME_ABBINATO","OK");else{var c=trovaRecord(a,"idRicovero",b[0].idRicovero),e;for(e in b[0])c.set(e,b[0][e])}else msgShowError("",c.message)}})},onLaunch:function(){var a=this;this.idProfilo=CBA.parametriGenerali.idProfiloCss;this.storeLarghezzaColonna=
Ext.create("CS.personalizzazioni.elencoPazienti.impostazioni.store.LarghezzaColonna",{autoDestroy:!1});this.storeIconeSiNo=Ext.create("CS.personalizzazioni.elencoPazienti.impostazioni.store.IconeSiNo",{autoDestroy:!1});this.storeIconeSiNo.genRecordsIcon();this.getCntTitleAnteprimaEP().setHidden(!this.cbaConfig.fakeGrid);this.getCntGrid().on("afterrender",function(b){return Ext.defer(function(){return a.checkGenGrid()},20)})},destroy:function(){this.cbaConfig.fakeGrid||eliminaStore(this.cbaConfig.store);
this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.ElencoPazientiCnt",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnExitEP",selector:a+"#BtnExitEP"},{ref:"CntGridEP",selector:a+"#CntGridEP"},{ref:"BtnFilterEP",selector:a+"#BtnFilterEP"},{ref:"BtnRefresh",selector:a+"#BtnRefresh"},{ref:"BtnMaximizeMinimize",selector:a+"#BtnMaximizeMinimize"},{ref:"SpacerBottom",selector:a+"#SpacerBottom"}]);this.control(a+"#BtnExitEP",
{click:this.clickBtnExitEP});this.control(a+"#BtnFilterEP",{click:this.clickBtnFilterEP});this.control(a+"#BtnRefresh",{click:this.clickBtnRefresh});this.control(a+"#BtnMaximizeMinimize",{click:this.clickBtnMaximizeMinimize})},clickBtnMaximizeMinimize:function(a){a.maximizedEP=a.maximizedEP?!1:!0;var b=a.lookupController().getView(),c=b.up().getHeight();b.setHeight(a.maximizedEP?c:98);this.getSpacerBottom().setHidden(!a.maximizedEP);this.getBtnMaximizeMinimize().setIconCls(a.maximizedEP?"minimize-ep-css":
"maximize-ep-css")},clickBtnRefresh:function(){this.getCntGridEP().down("grid").lookupController().cerca()},clickBtnExitEP:function(a){this.getView().hide();this.cbaConfig.pnlCerca.show()},clickBtnFilterEP:function(a){var b=a.getPosition()[0]+a.getWidth()-this.winRicercaWidth;a=a.getPosition()[1]+a.getHeight();this.winRicerca.showAt(b,a)},onLaunch:function(){var a=Ext.create("GeneraliCS.anagrafica.view.ElencoPazientiCmp",{cbaConfig:{controlleCnt:this,pnlCerca:this.cbaConfig.pnlCerca,gridCercaClassic:this.cbaConfig.gridCercaClassic,
controllerCerca:this.cbaConfig.controllerCerca}});this.getCntGridEP().add(a);this.winRicercaWidth=400;this.winRicerca=Ext.create("winCBA",{name:"GeneraliCS.anagrafica.view.ElencoPazientiFilters",titolo:"",maximizable:!1,header:!1,layout:"fit",larghezzaWin:this.winRicercaWidth,altezzaWin:350,resizable:!1,configItem:{controllerElencoPazienti:a.lookupController(),btnFilters:this.getBtnFilterEP()}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.ElencoPazientiFilters",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Sede",selector:a+"#Sede"},{ref:"Reparto",selector:a+"#Reparto"},{ref:"Stanza",selector:a+"#Stanza"},{ref:"BtnEPFiltra",selector:a+"#BtnEPFiltra"},{ref:"BtnEPCancFiltri",selector:a+"#BtnEPCancFiltri"},{ref:"FormEPFiltri",selector:a+"#FormEPFiltri"}]);this.control(a+"#Sede",{change:this.changeCboxSede});
this.control(a+"#Reparto",{change:this.changeCboxReparto});this.control(a+"#BtnEPFiltra",{click:this.clickBtnEPFiltra});this.control(a+"#BtnEPCancFiltri",{click:this.clickBtnEPCancFiltri})},clickBtnEPFiltra:function(a){a=this.cbaConfig.controllerElencoPazienti;var b=a.getCntGrid().down("grid");svuotaStore(b.getStore());b=this.getFormEPFiltri().getForm().getFieldValues();Ext.isEmpty(b.categoria)||(b.idCategoria=this.cbaConfig.controllerElencoPazienti.cbaConfig.controlleCnt.cbaConfig.idCategoria);Ext.isEmpty(b.regime)||
(b.idRegime=this.cbaConfig.controllerElencoPazienti.cbaConfig.controlleCnt.cbaConfig.idRegime);for(var c in b)Ext.isEmpty(b[c])&&delete b[c];c=0==Object.keys(b).length;a.filtriAggiuntivi=b;a.cerca();this.btnExitFilters.hide();this.getView().up("window").hide();this.cbaConfig.btnFilters.removeCls("cbaCssBtnAnagrafica-orange");c||this.cbaConfig.btnFilters.addCls("cbaCssBtnAnagrafica-orange")},clickBtnEPCancFiltri:function(a){a=this.cbaConfig.controllerElencoPazienti;var b=a.getCntGrid().down("grid");
svuotaStore(b.getStore());clearForm(this.getFormEPFiltri());a.filtriAggiuntivi=null;a.cerca();this.btnExitFilters.hide();this.getView().up("window").hide();this.cbaConfig.btnFilters.removeCls("cbaCssBtnAnagrafica-orange")},changeCboxSede:function(a,b,c){SvuotaCombo(this.getReparto());SvuotaCombo(this.getStanza());0<b&&(this.getReparto().getStore().getProxy().extraParams={sede:b},this.getReparto().getStore().load())},changeCboxReparto:function(a,b,c){SvuotaCombo(this.getStanza());0<b&&0<this.getSede().getValue()&&
(this.getStanza().getStore().getProxy().extraParams={sede:this.getSede().getValue(),reparto:b},this.getStanza().getStore().load())},clickBtnExitFilters:function(a){a.hide();a.up("window").hide()},onLaunch:function(){var a=this;this.getView().on("afterrender",function(b){a.btnExitFilters=b.up("window").add({xtype:"button",cls:"cbaCssBtnAnagrafica",iconCls:"icon-delete-cross-white-css height-icn-ep",tooltip:traduci("CHIUDI_FILTRI"),maxWidth:32,maxHeight:26,style:{position:"fixed !important",opacity:"0"},
handler:a.clickBtnExitFilters,listeners:{afterrender:function(b){Ext.defer(function(){b.el.dom.style.opacity="1";b.setPosition(a.cbaConfig.btnFilters.getPosition())},100)},show:function(b){return b.setPosition(a.cbaConfig.btnFilters.getPosition())}}});a.getView().up("window").on("show",function(b){return a.btnExitFilters.show()})});ImpostaUrl([this.getSede().getStore(),this.getReparto().getStore(),this.getStanza().getStore()]);this.getSede().getStore().load()},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.ListRicoveriPrec",{extend:"Generali.standard.ViewController",init:function(){this.callParent(arguments);this.addRef([])},changeTipologia:function(a,b){this.collapseAll();b?(a.setFieldLabel("Raggruppa per tipologia"),this.lookup("Grid").getStore().group("descrProfilo")):(a.setFieldLabel("Ordine cronologico"),this.lookup("Grid").getStore().clearGrouping(),this.lookup("Grid").getStore().setSorters({property:"dal",direction:"DESC"}))},collapseAll:function(){for(var a=
this.lookup("Grid"),b=a.getStore(),a=a.getPlugin(),c=a.view.getNodes(),d=0;d<c.length;d++)Ext.fly(c[d]).hasCls(a.rowCollapsedCls)||a.toggleRow(d,b.getAt(d))},openRicovero:Ext.Function.createBuffered(function(a,b,c){if(localStorage.getItem("cartella_old")&&"T"==localStorage.getItem("cartella_old"))return Messaggio("ATTENZIONE","ATTENZIONE_RIC_PREC","OK","WARNING"),!1;a=a.getStore().getAt(b);b="";a&&(b=trovaRecord(this.lookup("CBoxTipologia").getStore(),"codice",a.get("idProfilo")));b&&(b=b.get("extra").split(";"),
idRicovero=a.get("id"),codOspite=a.get("codOspite"),idProfiloPwdDe=b[0],idProfilo=a.get("idProfilo"),localStorage.setItem("idProfiloPwdDeCss",b[1]),localStorage.setItem("idProfiloCss",idProfilo),localStorage.setItem("cartella_old","T"),localStorage.setItem("ricovero_old",JSON.stringify({idRicovero:idRicovero,codOspite:codOspite,idProfiloPwdDe:idProfiloPwdDe,idProfilo:idProfilo})),openSecondaryWin())},200),changeCboxTipologia:function(a,b){this.lookup("Grid").getStore().clearFilter();b&&this.lookup("Grid").getStore().filterBy(function(a){return a.get("idProfilo")==
b})},onExpandBody:function(a,b,c,d){if(!(a.cnt||Ext.isEmpty(b.getData())||Ext.isEmpty(b.getData().coRicoveroLight))){c=b.getData().id;b=b.getData().coRicoveroLight;c=this.getView().getId()+"grid-row-"+c;var e="";b.forEach(function(a){e+='\n\t\t\t<tr>\n\t\t\t\t<td style="\n\t\t\t\tpadding: 4px 7px;">'+(FormattaData(a.dal)+" "+FormattaOra(a.dal))+'</td>\n\t\t\t\t<td style="\n\t\t\t\tpadding: 4px 7px;">'+(a.al?FormattaData(a.al)+" "+FormattaOra(a.al):"")+'</td>\n\t\t\t\t<td style="\n\t\t\t\tpadding: 4px 7px; font-weight: bold;">'+
a.desServizio+"</td></tr>\n\t\t\t"});a.cnt=Ext.create("Ext.container.Container",{html:'\n\t\t\t<table style="\n\t\t\t\tborder-collapse: collapse;\n\t\t\t\tmin-width: 350px;\n\t\t\t\toverflow: hidden;\n\t\t\t\tmargin: auto;">\n\t\t\t\t<caption>\n\t\t\t\t\t<p class="cbaCssLabel">Cronologia ricoveri amministrativi</p>\n\t\t\t\t</caption>\n\t\t\t\t<thead style="\n\t\t\t\tbackground-color: #2f5f8f;\n\t\t\t\tcolor: #ffffff;\n\t\t\t\ttext-align: left;\n\t\t\t\tfont-weight: bold;">\n\t\t\t\t\t<tr style="\n\t\t\t\tbackground-color: #2f5f8f;\n\t\t\t\tcolor: #ffffff;\n\t\t\t\ttext-align: left;\n\t\t\t\tfont-weight: bold;">\n\t\t\t\t\t\t<th style="\n\t\t\t\tpadding: 2px 7px;">Dal</th>\n\t\t\t\t\t\t<th style="\n\t\t\t\tpadding: 2px 7px;">Al</th>\n\t\t\t\t\t\t<th style="\n\t\t\t\tpadding: 2px 7px;">Servizio</th></tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t'+
e+"\n\t\t\t\t</tbody>\n\t\t\t</table>",style:{backgroundColor:"#FFFFFF"}});a.cnt.render(c)}},aggiornaStore:function(a){a=this.lookup("Grid").getStore();var b=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0);svuotaStore(a);a.clearFilter();a.load({params:{codProfilo:CBA.parametriGenerali.codProfilo,codOspite:b.get("codOspite"),idRicoveroEscluso:b.get("idRicovero"),codEnte:CBA.parametriGenerali.codEntePwd,soloUno:"F",filtraTipologia:Ext.isEmpty(this.lookup("CBoxTipologia").getValue())?"F":"T",idTipologia:CBA.parametriGenerali.idProfiloCss}})},
onLaunch:function(){var a=this;this.lookup("Grid").view.on("expandbody",function(b,c,d,e){return a.onExpandBody(b,c,d,e)});this.lookup("CBoxTipologia").getStore().load({params:{codEnte:CBA.parametriGenerali.codEntePwd,codProfilo:CBA.parametriGenerali.codProfilo,codOspite:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.codOspite,idTipologia:CBA.parametriGenerali.idProfiloCss},callback:function(b,c,d){d?a.aggiornaStore():msgShowError("",c.getError())}})},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.ModificaPazienteImg",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:a+"#Form"},{ref:"ImgPaziente",selector:a+"#ImgPaziente"},{ref:"BtnModificaFoto",selector:a+"#BtnModificaFoto"}]);this.control(a+"#BtnEsci",{click:this.clickBtnEsci});this.control(a+"#BtnModificaFoto",{change:this.changeBtnModificaFoto});this.control(a+"#ImgPaziente",{afterrender:this.afterrenderImgPaziente})},
afterrenderImgPaziente:function(a){var b=a.up("window");a.el.on({load:function(a,d,e){a=d.height;b.setWidth(d.width+20);b.setHeight(a+80)}})},changeBtnModificaFoto:function(a){var b=this;a.up("form");var c=a.getValue();if(""!==c&&this.estensioneValida(c)){var d=this.getImgPaziente();a=a.fileInputEl.dom.files[0];c=new FormData;c.append("file",a);Ext.Ajax.request({url:d.urlUpload,method:"POST",rawData:c,headers:{"Content-Type":null},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(msgShowText("TRASFERIMENTO_FILE",
a.message),d.setSrc(d.urlSrc+"&date="+Ext.Date.now()),b.aggiornaImgPaziente()):msgShowError("",a.message)}})}},aggiornaImgPaziente:function(){var a=CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0].get("codOspite");setSrcImage(this.getImgPaziente(),getUrlGen()+"/ws/genOsp/foto/get?codospite="+a+"&date="+Ext.Date.now());this.cbaConfig.elImg.loadFotoOspite(a)},estensioneValida:function(a){if(-1!=a.search(/.png/i)||-1!=a.search(/.jpg/i)||-1!=a.search(/.jpeg/i))return!0;Messaggio("ATTENZIONE",
"PER_ERRORE_FORMATO_FOTO","OK","ERROR");return!1},gestioneForm:function(){var a=this,b=a.getForm();b.permesso="S";b.boxBottoni=a.getBoxBottoni();b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(b){a.cbaConfig.controllerTestata.nuovoDefault&&(a.aggiornamentoTestata=!0,ImpostaNuovoDefault(a,!1));a.salvaForm(!1)},annulla_callback:function(){a.testataSelezionata||(a.aggiornamentoTestata=!0);a.cbaConfig.controllerTestata.nuovoDefault&&
(a.aggiornamentoTestata=!0,ImpostaNuovoDefault(a,!1));a.aggiornaStore()},esci_callback:function(){b.up("window").close()},verificaCampiForm_callback:function(){return a.verificaCampiForm()},noText:!0,personIcons:getIconButtons()}}),d=Ext.create("Ext.form.field.File",{itemId:"BtnCambiaFoto",reference:"BtnCambiaFoto",width:100,margin:"1 0 0 0",cls:"cba-stdbutton-25",disabled:!1,hideLabel:!0,readOnly:!1,name:"f_fotoDip",buttonConfig:{iconCls:"icon-upload",height:25},buttonOnly:!0,buttonText:traduci("PO_DA_CAMBIA_FOTO")});
b.boxBottoni.add(d);inserisciBottoni(b.boxBottoni,c,!0);b.boxBottoni.queryById("btnElimina").setHidden(!0);if("S"==b.permesso)b.getForm().on("dirtychange",function(a,c){controller_abilitaBottoni(b);b.boxBottoni.queryById("btnEsci").setDisabled(c)})},verificaCampiForm:function(){var a=[],b=this.getForm();b.down("grid").down("#ColumnReferto").getEditor().getRawValue();var c=b.down("datefield");(c=c.validator(c))&&Ext.isString(c)&&msgAddError(a,c);0!=a.length||b.isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");
return msgShow("",a)},aggiornaStore:function(a){this.getCntGrid().down("grid").getStore().load({params:{idProfilo:this.idProfilo,maxResults:this.cbaConfig.fakeGrid?1:5},callback:function(a,c,d){d||msgShowError("",c.getError())}})},onLaunch:function(){var a=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.codOspite,b=this.getImgPaziente();b.urlSrc="/cba/css/cs/ws/genOsp/foto/get?codospite="+a;b.urlUpload="/cba/css/cs/ws/genOsp/foto/upload?codospite="+a;b.urlDelete="/cba/css/cs/ws/genOsp/foto/delete?codospite="+
a;setSrcImage(b,getUrlGen()+"/ws/genOsp/foto/get?codospite="+a+"&date="+Ext.Date.now())},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.anagrafica.controller.MonitoraggioCovid_Filters",{extend:"Generali.standard.ViewController",init:function(){},getCbGroupParametri:function(){return this.lookup("CbGroupParametri")},generaCb:function(a,b){a=void 0===a?[]:a;b=void 0===b?!0:b;return a.map(function(a){var c=b?a.getData():a;return{boxLabel:c.descrizione,checked:c.checked,cls:"cbaLabel",name:"_tmp_parametri_"+c.id,inputValue:"T",uncheckedValue:"F",listeners:{change:function(){a.set("checked",!a.get("checked"))}}}})},
onLaunch:function(){var a=this,b=this.getCbGroupParametri();Ext.isEmpty(this.cbaConfig.items)?(this.storeParametri=Ext.create("GeneraliCS.store.RisposteCSS",{autoDestroy:!0,autoLoad:!1}),loadStorePromise(this.storeParametri,{codArea:3,codDomanda:1230,idProfilo:CBA.parametriGenerali.idProfiloCss}).then(function(c){b.add(a.generaCb(c))})):b.add(this.generaCb(this.cbaConfig.items))},destroy:function(){Ext.isEmpty(this.cbaConfig.items)||eliminaStore(this.storeParamtri);this.callParent()}});
Ext.define("GeneraliCS.anagrafica.governanceAnagrafica.controller.ElencoPazientiCmp",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"CntGrid",selector:a+"#CntGrid"},{ref:"CntTitleAnteprimaEP",selector:a+"#CntTitleAnteprimaEP"}]);this.control(a+"#BtnEsci",{click:this.clickBtnEsci})},clickBtnEsci:function(a){a.up("window").close()},checkGenGrid:function(){var a=this;this.cbaConfig.fakeGrid?
this.genGrid():(this.cbaConfig.store=Ext.create("CS.personalizzazioni.personGovernance.personalizzazioni.store.CampiPersonalizzati"),this.cbaConfig.store.load({params:{idProfilo:this.idProfilo,codFigProf:CBA.moduli.modulo49.operatore.tipo},callback:function(b,c,d){d?Ext.isEmpty(b)?msgShowError("ERRORE","MSG_NO_PROFILO_GOV"):(a.idProfiloGov=b[0].get("idProfiloGov"),a.genGrid()):msgShowError("ERRORE","MSG_NO_PROFILO_GOV")}}))},genGrid:function(){var a=this;Ext.suspendLayouts();var b=[],c=[],d=this.getCntGrid().getWidth()-
15,e=null,f=null,g=0,h=0;this.cbaConfig.store.each(function(b){c.push(b.data);e=trovaRecord(a.storeLarghezzaColonna,"codice",b.data.larghezzaColonna);if(!e)return!1;"px"===e.get("unit")?h+=e.get("extra"):"%"===e.get("unit")&&(g+=e.get("extra")/100)});d-=h;c.forEach(function(c){e=trovaRecord(a.storeLarghezzaColonna,"codice",c.larghezzaColonna);f=e.get("unit");var h={xtype:null,text:c.titoloColonna,dataIndex:"campo"+(b.length+1),centered:5===e.get("codice")?!0:!1,width:"px"===f?e.get("extra"):d/g*(e.get("extra")/
100),renderer:function(b,d,e,f,g,h,k){if("P"===c.tipoColonna){e=a.storeIconeSiNo;if(b="T"===b?c.iconaSi:"F"===b?c.iconaNo:null)if(b=trovaRecord(e,"codice",b))d.tdCls=b.get("extra");return""}if(2==c.tipoCampo||3==c.tipoCampo||4==c.tipoCampo||16==c.tipoCampo||18==c.tipoCampo||19==c.tipoCampo)b&&(d=b.split("-"),b=d[2]+"/"+d[1]+"/"+d[0]);else if(17==c.tipoCampo)return Ext.isEmpty(b)?"":'\n\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t<div class="cba-css-stato-monitoraggio-covid-'+b+'" style="height: 20px; width: 20px;"></div>\n\t\t\t\t\t\t\t</center>';
return b}};b.push(h)});var k=this.cbaConfig.fakeGrid;this.getCntGrid().add(Ext.create("Ext.grid.Panel",{itemId:k?"GridAnteprima":"GridEP",reference:k?"GridAnteprima":"GridEP",autoScroll:"vertical",scrollable:!0,store:Ext.create("GeneraliCS.anagrafica.governanceAnagrafica.store.ElencoPazientiCmp"),disableSelection:k,flex:1,margin:k?null:"1 3 1 5",cls:"grid-elenco-pazienti",columns:b,viewConfig:k?null:{loadMask:!1},listeners:{rowdblclick:"onRowDbClick"}}));Ext.resumeLayouts();k?this.getCntGrid().up("window").updateLayout():
this.getCntGrid().up("#CntGridEP").updateLayout();k||this.cerca()},onRowDbClick:function(a,b){this.cbaConfig.onDbClickOspite(b.get("codOspite"),b.get("cognome"))},cerca:function(a){var b=this.getCntGrid().down("grid").getStore();this.parametriModificati=!Ext.isEmpty(a);a=Ext.isEmpty(a)?Object.assign({},this.cbaConfig.filtri):a;Ext.apply(a,{idProfiloGov:this.idProfiloGov,idProfilo:CBA.parametriGenerali.idProfiloCss});this.cbaConfig.controlleCnt.setFiltri(a);b.load({params:a,callback:function(a,b,e){e||
msgShowError("ERRORE",b.getError())}})},updatePaziente:function(){var a=this.getCntGrid().down("grid").getStore(),b=CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0];Ext.Ajax.request({method:"GET",url:a.getProxy().api.read,async:!1,params:{idProfilo:CBA.parametriGenerali.idProfiloCss,codOspite:b.get("codOspite")},success:function(b){var c=Ext.JSON.decode(b.responseText);b=c.data;if(c.success)if(Ext.isEmpty(b))Messaggio("ATTENZIONE","NESSUN_ESAME_ABBINATO","OK");else{var c=trovaRecord(a,"idRicovero",
b[0].idRicovero),e;for(e in b[0])c.set(e,b[0][e])}else msgShowError("",c.message)}})},onLaunch:function(){var a=this;this.idProfilo=CBA.parametriGenerali.idProfiloCss;this.storeLarghezzaColonna=Ext.create("CS.personalizzazioni.elencoPazienti.impostazioni.store.LarghezzaColonna",{autoDestroy:!1});this.storeIconeSiNo=Ext.create("CS.personalizzazioni.elencoPazienti.impostazioni.store.IconeSiNo",{autoDestroy:!1});this.storeIconeSiNo.genRecordsIcon();this.getCntTitleAnteprimaEP().setHidden(!this.cbaConfig.fakeGrid);
this.getCntGrid().on("afterrender",function(b){return Ext.defer(function(){return a.checkGenGrid()},20)})},destroy:function(){this.cbaConfig.fakeGrid||eliminaStore(this.cbaConfig.store);this.callParent()}});
Ext.define("GeneraliCS.anagrafica.governanceAnagrafica.controller.ElencoPazientiFilters",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Sede",selector:a+"#Sede"},{ref:"Reparto",selector:a+"#Reparto"},{ref:"Stanza",selector:a+"#Stanza"},{ref:"BtnEPFiltra",selector:a+"#BtnEPFiltra"},{ref:"BtnEPCancFiltri",selector:a+"#BtnEPCancFiltri"},{ref:"FormEPFiltri",selector:a+"#FormEPFiltri"}]);this.control(a+"#CbSede",{change:this.changeCboxSede});
this.control(a+"#Reparto",{change:this.changeCboxReparto});this.control(a+"#BtnEPFiltra",{click:this.clickBtnEPFiltra})},clickBtnEPFiltra:function(a){a=this.cbaConfig.controllerElenco;var b=this.cbaConfig.controllerCerca,c=this.getFormEPFiltri().getForm().getFieldValues(),d=CBA.parametriGenerali.filtroServiziCss,e="",f=this.lookup("GridServizi");f&&0<f.getStore().data.items.length&&(e="",f.getStore().data.items.forEach(function(a){a.get("checked")&&(e+=a.get("codice")+",")}));Ext.apply(c,{filtroServiziCss:e||
d});for(var g in c)Ext.isEmpty(c[g])&&delete c[g];convertiBool(c);b.impostaParametri(c);a.cerca(c);this.btnExitFilters.hide();this.getView().up("window").hide()},changeCboxSede:function(a,b,c){var d=this;SvuotaCombo(this.lookup("CbReparto"));0<a.value&&(this.lookup("CbReparto").getStore().getProxy().extraParams={sede:a.value,filtroSedRepPwd:"T"},this.lookup("CbReparto").getStore().load({callback:function(a,b,c){c?(b=1===a.length,d.lookup("CbReparto").setDisabled(b),b&&d.lookup("CbReparto").setValue(a[0])):
reject(b.getError())}}))},clickBtnExitFilters:function(a){a.hide();a.up("window").hide()},initConf:function(){var a=this.cbaConfig.controllerCerca,b=this.lookup("FormEPFiltri");hideFiltroSettori(this.lookup("FiltroSettUtente"));this.lookup("CbSede").bindStore(a.lookup("CbSede").getStore());this.lookup("CbReparto").bindStore(a.lookup("CbReparto").getStore());a.lookup("CntFilterServizi").isHidden()||(this.lookup("GridServizi").bindStore(a.lookup("GridServiziCu").getStore()),this.lookup("CntFilterServizi").show());
b.getForm().setValues(this.cbaConfig.filtri)},onLaunch:function(){var a=this;this.initConf();this.getView().on("afterrender",function(b){a.btnExitFilters=b.up("window").add({xtype:"button",cls:"cbaCssBtnAnagrafica",iconCls:"icon-delete-cross-white-css height-icn-ep",tooltip:traduci("CHIUDI_FILTRI"),maxWidth:32,maxHeight:26,style:{position:"fixed !important",opacity:"0"},handler:a.clickBtnExitFilters,listeners:{afterrender:function(b){Ext.defer(function(){b.el.dom.style.opacity="1";b.setPosition(a.cbaConfig.btnFilters.getPosition())},
100)},show:function(b){return b.setPosition(a.cbaConfig.btnFilters.getPosition())}}});a.getView().up("window").on("show",function(b){return a.btnExitFilters.show()})})},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.anagrafica.governanceAnagrafica.controller.GovernanceAnagrafica",{extend:"Generali.standard.stampe.Controller",parametriStampa:{url:"/cba/css/cs/ws/report/elencopazienti",titolo:"ELENCO_PAZIENTI",hideXml:!0,hideXls:!0,hideCsv:!0,hideTxt:!0,hideBtnStampaOnSecondaryWin:!0},init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BtnExitEP",selector:a+"#BtnExitEP"},{ref:"CntGridEP",selector:a+"#CntGridEP"},{ref:"BtnFilterEP",selector:a+"#BtnFilterEP"},
{ref:"BtnRefresh",selector:a+"#BtnRefresh"},{ref:"BtnMaximizeMinimize",selector:a+"#BtnMaximizeMinimize"},{ref:"BtnStampa",selector:a+"#BtnStampa"},{ref:"SpacerBottom",selector:a+"#SpacerBottom"}]);this.control(a+"#BtnEsci",{click:this.onClickBtnEsci});this.control(a+"#BtnFilterEP",{click:this.clickBtnFilterEP});this.control(a+"#BtnRefresh",{click:this.clickBtnRefresh});this.control(a+"#BtnMaximizeMinimize",{click:this.clickBtnMaximizeMinimize});this.control(a+"#BtnStampa",{click:this.clickBtnStampa})},
clickBtnStampa:function(){this.stampa()},stampa:function(){Ext.apply(this.parametriStampa.params,{idProfilo:CBA.parametriGenerali.idProfiloCss,codFigProf:CBA.moduli.modulo49.operatore.tipo});Ext.apply(this.parametriStampa.params,this.filtri)},doPrint:function(a,b){this.stampa();this.callParent([a,b])},clickBtnMaximizeMinimize:function(a){a.maximizedEP=a.maximizedEP?!1:!0;var b=a.lookupController().getView(),c=b.up().getHeight();b.setHeight(a.maximizedEP?c:98);this.getSpacerBottom().setHidden(!a.maximizedEP);
this.getBtnMaximizeMinimize().setIconCls(a.maximizedEP?"minimize-ep-css":"maximize-ep-css")},setFiltri:function(a){this.filtri=a},clickBtnRefresh:function(){this.getCntGridEP().down("grid").lookupController().cerca()},onClickBtnEsci:function(a){this.getView().up("window").close()},clickBtnFilterEP:function(a){var b=a.getPosition()[0]+a.getWidth()-this.winRicercaWidth;a=a.getPosition()[1]+a.getHeight();this.winRicerca.showAt(b,a)},selezionaOspite:function(a,b){this.cbaConfig.controllerCerca.lookup("NomeContiene").setValue(!0);
this.cbaConfig.controllerCerca.lookup("Cognome").setValue(b);this.cbaConfig.controllerCerca.cerca(null,a,!0)},onLaunch:function(){var a=this;this.cmp=Ext.create("GeneraliCS.anagrafica.governanceAnagrafica.view.ElencoPazientiCmp",{cbaConfig:{controlleCnt:this,pnlCerca:this.cbaConfig.pnlCerca,gridCercaClassic:this.cbaConfig.gridCercaClassic,controllerCerca:this.cbaConfig.controllerCerca,filtri:this.cbaConfig.filtri,onDbClickOspite:function(b,c){return a.selezionaOspite(b,c)}}});this.getCntGridEP().add(this.cmp);
this.winRicercaWidth=350;this.winRicerca=Ext.create("winCBA",{name:"GeneraliCS.anagrafica.governanceAnagrafica.view.ElencoPazientiFilters",titolo:"",maximizable:!1,header:!1,layout:"fit",larghezzaWin:this.winRicercaWidth,altezzaWin:350,resizable:!1,configItem:{controllerElenco:this.cmp.lookupController(),btnFilters:this.getBtnFilterEP(),controllerCerca:this.cbaConfig.controllerCerca,filtri:this.cbaConfig.filtri}});this.winRicerca.on("close",function(a){a.items.items[0].lookupController().lookup("CbSede").bindStore(null);
a.items.items[0].lookupController().lookup("CbReparto").bindStore(null);a.items.items[0].lookupController().lookup("GridServizi").bindStore(null)})},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.anagrafica.governanceAnagrafica.store.ElencoPazientiCmp",{extend:"Ext.data.Store",model:"GeneraliCS.anagrafica.model.ElencoPazienti",proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/governance/anag/list",api:{read:"/cba/css/cs/ws/governance/anag/list"},reader:{type:"json",messageProperty:"message",rootProperty:"data"},extraParams:{hideInizioAttesa:!0}},autoDestroy:!0});
Ext.define("GeneraliCS.anagrafica.governanceAnagrafica.view.ElencoPazientiCmp",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",itemId:"CntTitleAnteprimaEP",reference:"CntTitleAnteprimaEP",layout:"hbox",border:0,margin:"0 0 5 0",items:[{xtype:"label",text:traduci("CS_ANTEPRIMA_CMP_ELENCO_PAZIENTI"),margin:"10 0 0 15",
cls:"cbaGrassetto cbaCssLabel"},{xtype:"CSSButtonsPanel",itemId:"ContainerButtons",reference:"ContainerButtons",layout:{type:"hbox",pack:"end"},flex:1,margin:"5 0 0 0",items:[{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",text:"ESCI",cls:"cbaCssBtnFunzione"}]}]},{xtype:"container",itemId:"CntGrid",reference:"CntGrid",layout:{type:"vbox",align:"stretch"},flex:1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.governanceAnagrafica.view.ElencoPazientiFilters",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},flex:1,initComponent:function(){var a=!1,b=!1;CBA.parametriGenerali.filtroMedico&&(a=!0,0>CBA.parametriGenerali.filtroMedico&&(b=!0));Ext.applyIf(this,{items:[{xtype:"form",itemId:"FormEPFiltri",reference:"FormEPFiltri",layout:{type:"vbox",align:"stretch"},flex:1,padding:5,border:0,defaults:{margin:5,labelClsExtra:"cbaCssLabel"},items:[{xtype:"fieldset",
title:"DATA_INIZIO_RICOVERO",layout:{type:"hbox",align:"stretch"},padding:5,items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",fieldLabel:"DAL",labelClsExtra:"cbaCssLabel",maxValue:new Date,labelWidth:35,width:145,name:"dal"},{xtype:"datefield",itemId:"DataAl",reference:"DataAl",margin:"0 0 0 10",fieldLabel:"AL",labelClsExtra:"cbaCssLabel",maxValue:new Date,labelWidth:35,width:145,name:"al"}]},{xtype:"combobox",itemId:"CbFiltroRis",reference:"CbFiltroRis",hideLabel:!0,hidden:!0,emptyText:"FILTRA_TUTTI_VALORI",
displayField:"valore",queryMode:"local",valueField:"codice",isFormField:!1,multiSelect:!0,listConfig:{getInnerTpl:function(){return'<div class="x-combo-list-item"><img src="'+Ext.BLANK_IMAGE_URL+'" class="chkCombo-default-icon chkCombo" /> {valore} </div>'}}},{xtype:"combobox",itemId:"CbSede",reference:"CbSede",name:"idSede",hideLabel:!0,labelClsExtra:"cbaCssLabel",emptyText:"SEDE",displayField:"valore",queryMode:"local",fieldLabel:"SEDE",valueField:"codice"},{xtype:"combobox",itemId:"CbReparto",
reference:"CbReparto",name:"idReparto",hideLabel:!0,labelClsExtra:"cbaCssLabel",emptyText:"REPARTO",displayField:"valore",queryMode:"local",fieldLabel:"REPARTO",valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i style="text-decoration: line-through;">{valore}</i></div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"FiltroSettUtente",reference:"FiltroSettUtente",
margin:"0 5 0 0",checked:!0,inputValue:"T",uncheckedValue:"F",name:"filtroSettori"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"FiltroMedico",reference:"FiltroMedico",margin:"0 5 0 0",inputValue:"T",boxLabel:"FILTRO_MEDICO",uncheckedValue:"F",hidden:!a,disabled:b,name:"filtroMedico"},{xtype:"container",itemId:"CntFilterServizi",reference:"CntFilterServizi",layout:{type:"vbox",align:"stretch"},hidden:!0,margin:"5 0 5 0",flex:1,items:[{xtype:"label",html:"Filtro Servizi",labelClsExtra:"cbaLabel",
labelWidth:85},{xtype:"gridpanel",margin:0,width:170,height:95,itemId:"GridServizi",reference:"GridServizi",store:Ext.create("GeneraliCS.anagrafica.store.GridServizi"),columns:[{xtype:"gridcolumn",dataIndex:"codice",hidden:!0},{xtype:"checkcolumn",width:24,align:"center",dataIndex:"checked"},{xtype:"gridcolumn",flex:1,dataIndex:"valore",text:"SERVIZIO"}],hideHeaders:!0}]}]},{xtype:"container",layout:{type:"hbox",align:"stretch",pack:"end"},padding:"0 10 5 0",items:[{xtype:"button",itemId:"BtnEPFiltra",
reference:"BtnEPFiltra",cls:"cba-css-button-light",text:"FILTRA",margin:0,width:110,height:32}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.governanceAnagrafica.view.GovernanceAnagrafica",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"CSSButtonsPanel",itemId:"BoxBottoni",reference:"BoxBottoni",layout:"hbox",nonDisabilitare:!0,margin:"10 10 0 10",items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnFilterEP",reference:"BtnFilterEP",cls:"cbaCssBtnAnagrafica",
iconCls:"box-filter-css",tooltip:traduci("FILTRI_ELENCO_PAZIENTI")},{xtype:"button",itemId:"BtnStampa",reference:"BtnStampa",text:"STAMPA",cls:"cbaCssBtnFunzione"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",cls:"cbaCssBtnFunzione",margin:"0 0 0 1",text:"ESCI"},{xtype:"container",itemId:"SpacerBottom",reference:"SpacerBottom",flex:1,hidden:!0}]},{xtype:"container",itemId:"CntGridEP",reference:"CntGridEP",layout:{type:"vbox",align:"stretch"},flex:1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.store.AnagraficaUtSelezionato",{extend:"Ext.data.Store",fields:[{name:"id"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/anagrafica/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.anagrafica.store.AssociaGruppiUtente",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idGruppo"},{name:"codArea"},{name:"dscrArea"},{name:"descrGruppo"},{name:"ragg",convert:function(a,b){return-1==b.get("codArea")||-2==b.get("codArea")?"ragg_altro":"ragg_attivita"}}],proxy:{url:"/cba/css/cs/ws/gruppiutenti/ricovero/listreegruppi",api:{create:"/cba/css/cs/ws/gruppiutenti/associa",destroy:"/cba/css/cs/ws/gruppiutenti/dissocia"}},groupField:"ragg",autoDestroy:!0,
autoLoad:!1});Ext.define("GeneraliCS.anagrafica.store.CboxTipologiaCartella",{extend:"Ext.data.Store",alias:"store.tipologia",fields:[{name:"codice"},{name:"valore"},{name:"extra"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/profili/listbyprofiloandente",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0,autoLoad:!1});
Ext.define("GeneraliCS.anagrafica.store.CboxUtenti",{extend:"Ext.data.Store",fields:[{name:"codice"},{name:"valore"},{name:"extra"},{name:"nome",convert:function(a,b){return b.get("valore")}}],proxy:{type:"ajax",url:"/cba/css/cs/ws/anagrafica/cbox",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0,autoLoad:!1});
Ext.define("GeneraliCS.anagrafica.store.Cerca",{extend:"Ext.data.Store",alias:"store.cerca",model:"GeneraliCS.anagrafica.model.Anagrafica",proxy:{type:"ajax",url:"/cba/css/cs/ws/anagrafica/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},extraParams:{hideInizioAttesa:!0}},autoDestroy:!0});
Ext.define("GeneraliCS.anagrafica.store.CercaLight",{extend:"Ext.data.Store",alias:"store.cercaLight",fields:[{name:"codOspite"},{name:"nome"},{name:"cognome"},{name:"nominativo",convert:function(a,b){return b.get("cognome")+" "+b.get("nome")}}],proxy:{type:"ajax",url:"/cba/css/cs/ws/anagrafica/listLight",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},pageSize:7,autoDestroy:!0});
Ext.define("GeneraliCS.anagrafica.store.ElencoPazientiCmp",{extend:"Ext.data.Store",model:"GeneraliCS.anagrafica.model.ElencoPazienti",proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/elencopazienti/list",api:{read:"/cba/css/cs/ws/elencopazienti/list"},reader:{type:"json",messageProperty:"message",rootProperty:"data"},extraParams:{hideInizioAttesa:!0}},autoDestroy:!0});
Ext.define("GeneraliCS.anagrafica.store.GridServizi",{extend:"Ext.data.ArrayStore",fields:[{name:"codice"},{name:"valore"},{name:"checked"},{name:"extra"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/genOsp/serviziConFiltro/cbox",api:{read:"/cba/css/cs/ws/genOsp/serviziConFiltro/cbox"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.anagrafica.store.InformazioniAnagrafica",{extend:"Ext.data.Store",fields:[{name:"id"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/anagrafica/informazioniAnagrafica/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.anagrafica.store.ListRicoveriPrec",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"codOspite"},{name:"dal",type:"date"},{name:"al",type:"date"},{name:"idProfilo"},{name:"descrProfilo"},{name:"comboRicoveri",convert:function(a,b){var c=Ext.Date.format(b.get("dal"),"d/m/Y H:i"),d=Ext.Date.format(b.get("al"),"d/m/Y H:i");return b.get("id")+" - "+c+" - "+d}}],proxy:{type:"ajax",url:"/cba/css/cs/ws/ricoveri/searchdossier",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},
autoDestroy:!0,autoLoad:!1});
Ext.define("GeneraliCS.anagrafica.view.AssociaGruppiUtente",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},flex:1,initComponent:function(){this._GRUPPI_SEL_GRUPPO=traduci("GRUPPI_SEL_GRUPPO");this._GRUPPI_SEL_AREA=traduci("GRUPPI_SEL_AREA");Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntMain",reference:"CntMain",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"gridpanel",itemId:"GridUtenteGruppi",reference:"GridUtenteGruppi",store:Ext.create("GeneraliCS.anagrafica.store.AssociaGruppiUtente",
{}),flex:1,columns:[{xtype:"gridcolumn",dataIndex:"idArea",flex:1,text:"AREA",renderer:function(a,b,c){return c.get("descrArea")}},{xtype:"gridcolumn",dataIndex:"idGruppo",text:"GRUPPO",flex:1,editor:{xtype:"combobox",labelClsExtra:"cbaCssLabel",itemId:"ComboGruppo",reference:"ComboGruppo",emptyText:this._GRUPPI_SEL_GRUPPO,store:Ext.create("CS.personalizzazioni.personGruppiUtenti.impostazioni.store.CboxGruppi",{}),valueField:"codice",displayField:"valore",minChars:0,queryMode:"local",name:"idGruppo",
allowBlank:!1},renderer:function(a,b,c){return c.get("descrGruppo")}}],features:[{ftype:"grouping",groupHeaderTpl:["{name:this.ragg}",{ragg:function(a){return traduci("ragg_altro"===a?"ALTRO":"ATTIVITA")}}]}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"tbfill"},{xtype:"button",text:"DISSOCIA",width:150,disabled:!0,cls:"cbaCssBtnFunzione-special",itemId:"BtnDissocia",reference:"BtnDissocia"}]}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.Cerca",{extend:"Generali.standard.ControlledContainer",uses:["GeneraliCS.anagrafica.store.Cerca","GeneraliCS.anagrafica.controller.Cerca","GeneraliCS.anagrafica.store.CboxTipologiaCartella"],layout:{align:"stretch",type:"vbox"},flex:1,initComponent:function(){var a=new Date,b=!1,c=!1,d=!1;CBA.parametriGenerali.filtroMedico&&(b=d=!0,0>CBA.parametriGenerali.filtroMedico&&(c=!0),"F"==CBA.parametriGenerali.filtroMedico&&(d=!1));Ext.applyIf(this,{items:[{xtype:"container",
itemId:"ParametriRicerca",reference:"ParametriRicerca",nonDisabilitare:!0,layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"form",itemId:"Form",reference:"Form",noModificaDati:!0,border:0,padding:"5",layout:{align:"stretch",type:"vbox"},trackResetOnLoad:!0,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},margin:"0 0 5 0",items:[{xtype:"textfield",itemId:"Cognome",reference:"Cognome",fieldLabel:"CS_NOMINATIVO",
labelAlign:"top",labelClsExtra:"cbaLabel",enableKeyEvents:!0,flex:1},{xtype:"button",cls:"btnLarge",itemId:"BtnAggiungiOspite",reference:"BtnAggiungiOspite",formBind:!0,margin:"10 5 0 15",width:40,iconCls:"icon-user-add",scale:"large",tooltip:"NUOVO_UTENTE"},{xtype:"button",cls:"btnLarge",itemId:"BtnElencoPazienti",reference:"BtnElencoPazienti",formBind:!0,hidden:!0,margin:"10 5 0 5",width:40,iconCls:"icon-cta-elenco-pazienti",scale:"large",tooltip:"ELENCO_PAZIENTI"}]},{xtype:"container",layout:{type:"hbox",
align:"stretch"},margin:"5 0 10 0",items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",width:138,format:"d/m/Y",fieldLabel:"DAL",labelClsExtra:"cbaLabel",labelWidth:23,value:a,maxValue:a,margin:"0 5 0 5"},{xtype:"datefield",itemId:"DataAl",reference:"DataAl",width:131,format:"d/m/Y",margin:"0 0 0 8",fieldLabel:"AL",labelClsExtra:"cbaLabel",labelWidth:16,value:a,maxValue:a}]}]},{xtype:"container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},
flex:1,itemId:"FsAvanzate",reference:"FsAvanzate",collapsible:!0,title:"CS_FILTRI_AVANZATI",items:[{xtype:"combobox",itemId:"CbFiltro",reference:"CbFiltro",hideLabel:!0,emptyText:"FILTRA_PER",displayField:"valore",queryMode:"local",hidden:!0,typeAhead:!0,valueField:"codice"},{xtype:"combobox",itemId:"CbFiltroRis",reference:"CbFiltroRis",hideLabel:!0,hidden:!0,emptyText:"FILTRA_TUTTI_VALORI",displayField:"valore",queryMode:"local",valueField:"codice",multiSelect:!0,listConfig:{getInnerTpl:function(){return'<div class="x-combo-list-item"><img src="'+
Ext.BLANK_IMAGE_URL+'" class="chkCombo-default-icon chkCombo" /> {valore} </div>'}}},{xtype:"combobox",itemId:"CbSede",reference:"CbSede",name:"sedi",hideLabel:!0,labelClsExtra:"cbaCssLabel",emptyText:"SEDE",displayField:"valore",queryMode:"local",fieldLabel:"SEDE",store:Ext.create("CS.consegne.store.Sedi",{autoDestroy:!1}),valueField:"codice",cbaConfig:{},tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i style="text-decoration: line-through;">{valore}</i></div>',
"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"combobox",itemId:"CbReparto",reference:"CbReparto",name:"reparti",hideLabel:!0,labelClsExtra:"cbaCssLabel",emptyText:"REPARTO",displayField:"valore",queryMode:"local",fieldLabel:"REPARTO",store:Ext.create("CS.consegne.store.Reparti",{autoDestroy:!1}),valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i style="text-decoration: line-through;">{valore}</i></div>',
"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"NomeContiene",reference:"NomeContiene",margin:"0 5 0 0",boxLabel:"CS_NOMINATIVO_INIZIA_PER",checked:!0,inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"AncheNonAttivi",reference:"AncheNonAttivi",margin:"0 5 0 0",boxLabel:"ANCHE_NON_ATTIVI",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"FiltroSettUtente",reference:"FiltroSettUtente",
margin:"0 5 0 0",checked:!0,inputValue:"T",uncheckedValue:"F",name:"filtroSettori"},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"FiltroMedico",reference:"FiltroMedico",margin:"0 5 0 0",inputValue:"T",boxLabel:"FILTRO_MEDICO",uncheckedValue:"F",hidden:!b,checked:d,disabled:c},{xtype:"container",itemId:"CntFilterServizi",reference:"CntFilterServizi",layout:{type:"vbox",align:"stretch"},hidden:!0,margin:"5 0 5 0",flex:1,items:[{xtype:"label",html:"Filtro Servizi",labelClsExtra:"cbaLabel",labelWidth:85},
{xtype:"gridpanel",margin:0,width:170,height:95,itemId:"GridServiziCu",reference:"GridServiziCu",store:Ext.create("GeneraliCS.anagrafica.store.GridServizi",{autoDestroy:!1}),columns:[{xtype:"gridcolumn",dataIndex:"codice",hidden:!0},{xtype:"checkcolumn",width:24,align:"center",dataIndex:"checked"},{xtype:"gridcolumn",flex:1,dataIndex:"valore",text:"SERVIZIO"}],hideHeaders:!0}]}]},{xtype:"button",cls:"btnLarge",itemId:"BtnCerca",reference:"BtnCerca",formBind:!0,margin:"0 5 0 5",width:40,iconCls:"icon-ricerca",
scale:"large"}]}]},{xtype:"gridpanel",itemId:"GridRicerca",reference:"GridRicerca",autoScroll:"vertical",scrollable:!0,cbaPaged:!0,store:Ext.create("GeneraliCS.anagrafica.store.Cerca"),cls:"no-cell-focused-border",flex:1,leadingBufferZone:40,trailingBufferZone:30,columns:[{xtype:"gridcolumn",width:24,dataIndex:"sesso",itemId:"ColSesso",reference:"ColSesso",renderer:function(a,b,c){Ext.isEmpty(c.get("chiusuraSanitaria"))?a&&(b.tdCls="F"==a?"css-icon-female":"css-icon-male"):b.tdCls="css-icon-denied css-rosso"},
variableRowHeight:!0},{xtype:"gridcolumn",hidden:!0,dataIndex:"",itemId:"ColResidenziale",reference:"ColResidenziale",text:"STANZA_LETTO",width:80,align:"center",variableRowHeight:!0,renderer:function(a,b,c){b=c.getData();a=void 0===b.numStanza?"":b.numStanza;b=void 0===b.numLetto?"":b.numLetto;c="";a&&(c=a);b&&(c=c+" - "+b);return c}},{xtype:"gridcolumn",dataIndex:"nominativo",text:"CS_NOMINATIVO",flex:1,renderer:function(a,b,c){var d=a,e=!1;if(!Ext.isEmpty(c.get("al")))var e=new moment(c.get("al")),
f=new moment,e=!e.isAfter(f);if(e||!Ext.isEmpty(c.get("chiusuraSanitaria")))d='<span style="color:#bbb;"><i>'+a+"</i></span>",Ext.isEmpty(c.get("chiusuraSanitaria"))?b.tdAttr='data-qtip="'+traduci("PAZIENTE")+" "+traduci("DIMESSO")+'"':b.tdAttr='data-qtip="'+traduci("CARTELLA_SAN_CHIUSA")+'"';return d},variableRowHeight:!0},{xtype:"gridcolumn",dataIndex:"utenteAutoSomm",width:30,align:"center",sortable:!1,variableRowHeight:!0,hidden:!this.cbaConfig.somministrazioneTerapie,renderer:function(a,b,c){return a?
"<span style='font-weight:bold;color:orange'>A</span>":""}},{xtype:"gridcolumn",itemId:"ColDataNascita",reference:"ColDataNascita",dataIndex:"dataNascitaFormatted",text:"CS_DATA_NASCITA",width:90,align:"center",variableRowHeight:!0},{xtype:"gridcolumn",itemId:"ColMonitoraggioCovid",reference:"ColMonitoraggioCovid",dataIndex:"statoMonitoraggioCovid",text:"ABBR_MONITORAGGIO_COVID",width:60,hidden:!0,align:"center",variableRowHeight:!0,renderer:function(a,b,c){return Ext.isEmpty(a)?"":'\n\t\t\t\t\t\t\t\t\t\t<center>\n\t\t\t\t\t\t\t\t\t\t\t<div class="cba-css-stato-monitoraggio-covid-'+
a+'" style="height: 20px; width: 20px;"></div>\n\t\t\t\t\t\t\t\t\t\t</center>'}},{xtype:"datecolumn",format:"d/m/Y H:i",itemId:"ColDataUltimoTamponeCovid",reference:"ColDataUltimoTamponeCovid",dataIndex:"dataUltimoTampone",text:"DATA_ULTIMO_TEST",width:93,hidden:!0,align:"center",variableRowHeight:!0},{xtype:"datecolumn",format:"d/m/Y H:i",itemId:"ColIsolamentoCovid",reference:"ColIsolamentoCovid",dataIndex:"dataIsolamento",text:"ISOLAMENTO",width:93,hidden:!0,align:"center",variableRowHeight:!0},
{xtype:"gridcolumn",itemId:"ColVaccinazioni",reference:"ColVaccinazioni",dataIndex:"numeroDoseVaccino",text:"VACCINAZIONI",width:60,hidden:!0,align:"center",variableRowHeight:!0,renderer:function(a,b,c){if(Ext.isEmpty(a))return"";a=c.get("numeroDoseVaccino");b=c.get("vaccinoCompletato");var d="";"T"==c.get("scaduto")?d="css-rosso":"T"==b?d="css-verde":a&&(d="css-blu");return'<center><div style="width: 25px; height: 25px; display: '+(d?"block":"none")+'" class="icon-accertamenti '+d+'"></div></center>'}},
{xtype:"gridcolumn",dataIndex:"somministrato",width:26,align:"center",sortable:!1,variableRowHeight:!0,hidden:!this.cbaConfig.somministrazioneTerapie,renderer:function(a,b,c){c=null;2===a?(c="icon-checked-css",b.tdAttr='data-qtip="'+traduci("TERAPIE_SOMM")+'"'):1===a?(c="icon-exclamation-css",b.tdAttr='data-qtip="'+traduci("TERAPIE_PARZ_SOMM")+'"'):b.tdAttr='data-qtip="'+traduci("TERAPIE_NO_SOMM")+'"';return c?'<div class="'+c+'" style="width:16px; height:16px; margin-left:-2px"></div>':null}}],viewConfig:{loadMask:!1}}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.CruscottoPnlAnagrafica",{extend:"Generali.standard.ControlledContainer",uses:["GeneraliCS.anagrafica.controller.CruscottoPnlAnagrafica","CbaUtilsCss.componenti.desktop.CssImgOspite"],layout:{type:"hbox",align:"fit"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",reference:"CntImgOspite"},{xtype:"cssImgOspite",margin:"0 3 0 0",itemId:"ImgFotoUtente",reference:"ImgFotoUtente",cbaConfig:{abilitaEditFotoOspite:!0}},{xtype:"button",itemId:"BtnNomeUtente",
cls:"cbaCssBtnAnagrafica",height:36},{xtype:"container",layout:{type:"hbox",align:"middle"},flex:1,items:[{xtype:"label",itemId:"LblInfoUtente",cls:"cbaCssLabelAnagrafica",style:{"vertical-align":"center","font-size":"14.5px"},margin:"5 2 0 5",height:36}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.CruscottoSpecialButtons",{extend:"Generali.standard.ControlledContainer",uses:["GeneraliCS.anagrafica.controller.CruscottoSpecialButtons","GeneraliCS.anagrafica.view.ListRicoveriPrec"],layout:{type:"hbox",align:"stretch"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"button",itemId:"ImgChiusuraSanitaria",reference:"ImgChiusuraSanitaria",margin:"0 4 0 0",minWidth:32,iconCls:"css-icon-denied css-rosso",scale:"medium",style:{border:"2px solid","border-color":"#2F5F8F",
"background-color":"transparent",cursor:"auto"},hidden:!0,listeners:{afterrender:function(a){return creaToolTipBubble(a,"CARTELLA_SAN_CHIUSA",null,null,null,null,null,null,!0,null)}}},{xtype:"container",itemId:"ContainerFlash",reference:"ContainerFlash",layout:{type:"hbox",align:"middle"},margin:"0 4 0 0"},{xtype:"button",margin:"0 4 0 0",itemId:"BtnMonitorCovid",reference:"BtnMonitorCovid",width:140,cls:"cba-css-button-light",scale:"medium",text:"MONITOR_COVID",hidden:!0},{xtype:"button",margin:"0 4 0 0",
itemId:"BtnRicoveriOld",reference:"BtnRicoveriOld",minWidth:32,cls:"cbaCssBtnAnagrafica",scale:"medium",iconCls:"css-bianco icon-storico",hidden:!0},{xtype:"button",itemId:"BtnAnagraficaMore",reference:"BtnAnagraficaMore",minWidth:32,cls:"cbaCssBtnAnagrafica",iconCls:"css-more-white"}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.ElencoPazientiCmp",{extend:"Generali.standard.ControlledContainer",uses:["GeneraliCS.anagrafica.store.ElencoPazientiCmp","GeneraliCS.anagrafica.controller.ElencoPazientiCmp"],initComponent:function(){Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",itemId:"CntTitleAnteprimaEP",reference:"CntTitleAnteprimaEP",layout:"hbox",border:0,margin:"0 0 5 0",items:[{xtype:"label",
text:traduci("CS_ANTEPRIMA_CMP_ELENCO_PAZIENTI"),margin:"10 0 0 15",cls:"cbaGrassetto cbaCssLabel"},{xtype:"CSSButtonsPanel",itemId:"ContainerButtons",reference:"ContainerButtons",layout:{type:"hbox",pack:"end"},flex:1,margin:"5 0 0 0",items:[{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",text:"ESCI",cls:"cbaCssBtnFunzione"}]}]},{xtype:"container",itemId:"CntGrid",reference:"CntGrid",layout:{type:"vbox",align:"stretch"},flex:1}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.ElencoPazientiCnt",{extend:"Generali.standard.ControlledContainer",uses:["GeneraliCS.anagrafica.controller.ElencoPazientiCnt"],layout:{align:"stretch",type:"vbox"},height:98,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"container",itemId:"CntGridEP",reference:"CntGridEP",layout:{type:"vbox",align:"stretch"},flex:1},{xtype:"container",layout:{type:"vbox",align:"stretch",pack:"end"},
padding:"1 4 0 5",items:[{xtype:"button",itemId:"BtnRefresh",reference:"BtnRefresh",cls:"cbaCssBtnAnagrafica",iconCls:"refresh-orrible-css",width:32,height:18,tooltip:traduci("RICARICA_ELENCO"),margin:"2 0 3 0"},{xtype:"button",itemId:"BtnMaximizeMinimize",reference:"BtnMaximizeMinimize",cls:"cbaCssBtnAnagrafica",iconCls:"maximize-ep-css",width:32,height:18,tooltip:traduci("ESPANDI_COLLASSA"),margin:"0 0 3 0"},{xtype:"button",itemId:"BtnFilterEP",reference:"BtnFilterEP",cls:"cbaCssBtnAnagrafica",
iconCls:"box-filter-white-css height-icn-ep",width:32,height:26,tooltip:traduci("FILTRI_ELENCO_PAZIENTI")},{xtype:"button",itemId:"BtnExitEP",reference:"BtnExitEP",cls:"cbaCssBtnAnagrafica",iconCls:"icon-delete-cross-white-css height-icn-ep",width:32,height:26,margin:"3 0 0 0",tooltip:traduci("CHIUDI_ELENCO_PAZIENTI")},{xtype:"container",itemId:"SpacerBottom",reference:"SpacerBottom",flex:1,hidden:!0}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.ElencoPazientiFilters",{extend:"Generali.standard.ControlledContainer",uses:["GeneraliCS.anagrafica.controller.ElencoPazientiFilters","GeneraliOSP.cercaFascicolo.store.Sedi","GeneraliOSP.cercaFascicolo.store.Reparti","GeneraliOSP.fascicoloNoApp.store.Stanze"],layout:{align:"stretch",type:"vbox"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"form",itemId:"FormEPFiltri",reference:"FormEPFiltri",layout:{type:"vbox",align:"stretch"},flex:1,padding:5,
border:0,defaults:{margin:5,labelWidth:70,labelClsExtra:"cbaCssLabel"},items:[{xtype:"textfield",itemId:"Nominativo",reference:"Nominativo",labelWidth:120,fieldLabel:"CS_NOMINATIVO",labelAlign:"left",name:"nome",enableKeyEvents:!0,margin:"10 5 5 5"},{xtype:"fieldset",title:"DATA_INIZIO_RICOVERO",layout:{type:"hbox",align:"stretch"},margin:"5 5 10 3",padding:"5 10 10 10",items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",fieldLabel:"DAL",margin:"0 30 0 25",labelClsExtra:"cbaCssLabel",maxValue:new Date,
labelWidth:35,width:145,name:"dal"},{xtype:"datefield",itemId:"DataAl",reference:"DataAl",fieldLabel:"AL",labelClsExtra:"cbaCssLabel",maxValue:new Date,labelWidth:35,width:145,name:"al"}]},{xtype:"combobox",itemId:"Sede",reference:"Sede",labelWidth:120,name:"idSede",fieldLabel:"SEDE",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Sedi"),valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i style="text-decoration: line-through;">{valore}</i></div>',
"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"combobox",itemId:"Reparto",reference:"Reparto",labelWidth:120,name:"idReparto",fieldLabel:"REPARTO",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.cercaFascicolo.store.Reparti"),valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i style="text-decoration: line-through;">{valore}</i></div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',
"</tpl>","</tpl>")},{xtype:"combobox",itemId:"Stanza",reference:"Stanza",name:"idStanza",labelWidth:120,fieldLabel:"STANZA",displayField:"valore",queryMode:"local",store:Ext.create("GeneraliOSP.fascicoloNoApp.store.Stanze"),valueField:"codice",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"<tpl if=\"extra=='T'\">",'<div class="x-boundlist-item"><i style="text-decoration: line-through;">{valore}</i></div>',"<tpl else>",'<div class="x-boundlist-item">{valore}</div>',"</tpl>","</tpl>")},{xtype:"textfield",
itemId:"RegimeRic",reference:"RegimeRic",fieldLabel:"REGIME_RICOVERO",labelAlign:"left",name:"regime",enableKeyEvents:!0,margin:"5 5 5 5",labelWidth:120},{xtype:"textfield",itemId:"CategoriaRic",reference:"CategoriaRic",fieldLabel:"CATEGORIA",labelAlign:"left",name:"categoria",enableKeyEvents:!0,labelWidth:120},{xtype:"textfield",itemId:"TipoRic",reference:"TipoRic",fieldLabel:"TIPO_RICOVERO",labelAlign:"left",name:"tipoRicovero",enableKeyEvents:!0,labelWidth:120,hidden:!0}]},{xtype:"container",layout:{type:"hbox",
align:"stretch",pack:"end"},padding:"0 10 5 0",items:[{xtype:"button",itemId:"BtnEPCancFiltri",reference:"BtnEPCancFiltri",cls:"cba-css-button-light",text:"CANCELLA_FILTRI",margin:"0 3 0 0",width:110,height:32},{xtype:"button",itemId:"BtnEPFiltra",reference:"BtnEPFiltra",cls:"cba-css-button-light",text:"FILTRA",margin:0,width:110,height:32}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.ListRicoveriPrec",{extend:"Generali.standard.ControlledContainer",uses:["GeneraliCS.anagrafica.store.ListRicoveriPrec","GeneraliCS.anagrafica.controller.ListRicoveriPrec","GeneraliCS.anagrafica.store.CboxTipologiaCartella"],layout:{align:"stretch",type:"vbox"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"hbox",align:"center"},flex:1,maxHeight:80,items:[{xtype:"combobox",itemId:"CBoxTipologia",reference:"CBoxTipologia",
name:"tipologia",store:{type:"tipologia"},fieldLabel:"TIPOLOGIA",queryMode:"local",displayField:"valore",valueField:"codice",labelWidth:70,maxWidth:280,margin:"10 8 10 5",listeners:{change:"changeCboxTipologia"}},{xtype:"tbfill"},{xtype:"slider",useTips:!1,itemId:"RaggruppaTipologia",reference:"RaggruppaTipologia",fieldLabel:"Ordine cronologico",labelAlign:"right",labelWidth:150,width:190,increment:1,minValue:0,maxValue:1,margin:"5 5 10 5",listeners:{change:"changeTipologia"}}]},{xtype:"gridpanel",
store:Ext.create("GeneraliCS.anagrafica.store.ListRicoveriPrec"),itemId:"Grid",reference:"Grid",scrollable:!0,flex:1,columns:[{hidden:!0,dataIndex:"id"},{hidden:!0,dataIndex:"codOspite"},{dataIndex:"idProfiloPwdDe",hidden:!0},{xtype:"datecolumn",format:"d/m/Y",text:"DAL",dataIndex:"dal"},{xtype:"datecolumn",format:"d/m/Y",text:"AL",dataIndex:"al"},{dataIndex:"descrProfilo",flex:1},{xtype:"actioncolumn",width:32,items:[{icon:"/cba/css/generali/images/generali/apri.svg",tooltip:"Apri ricovero",width:24,
height:24,handler:"openRicovero"}]}],features:[{ftype:"grouping",collapsible:!1,groupHeaderTpl:["{name:this.formatText}",{formatText:function(a){return a}}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"CSSButtonsPanel",itemId:"BoxBottoni",reference:"BoxBottoni",flex:1,items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",handler:function(a){return a.up("window").close()}}]}]}],plugins:[{ptype:"rowexpander",expandOnDblClick:!1,rowBodyTpl:['<div id="'+this.getId()+
'grid-row-{id}"> </div>']}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.ModificaPazienteImg",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"hbox",pack:"end"},margin:"5 5 0 0",items:[{xtype:"form",cls:"cbaCssForm",itemId:"Form",reference:"Form",items:[{xtype:"filefield",itemId:"BtnModificaFoto",reference:"BtnModificaFoto",name:"nomeFile",
width:90,buttonText:traduci("CAMBIA_FOTO"),disabled:!1,buttonOnly:!0,nonDisabilitare:!0,buttonConfig:{cls:"cbaCssBtnFunzione",width:90}}]}]},{xtype:"container",style:{textAlign:"center"},items:[{xtype:"image",border:1,itemId:"ImgPaziente",reference:"ImgPaziente"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.anagrafica.view.MonitoraggioCovid_Filters",{extend:"Generali.standard.ControlledContainer",uses:[],layout:{align:"stretch",type:"vbox"},flex:1,initComponent:function(){Ext.apply(this,{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,border:!1,items:[{xtype:"checkbox",cls:"cbaLabel",boxLabel:"VISUALIZZA_ANNULLATI",name:"annullati",inputValue:"T",uncheckedValue:"F"},{xtype:"checkboxgroup",flex:1,labelAlign:"top",
vertical:!0,fieldLabel:"PARAMETRI",labelClsExtra:"cbaLabel",reference:"CbGroupParametri",columns:3,items:[]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.assenze.controller.Assenze",{extend:"Generali.standard.ViewController",init:function(){var a=this,b="#"+a.containerId+" ";a.callParent(arguments);a.addRef([{ref:"Container",selector:b+"#Container"},{ref:"GridAssenze",selector:b+"#GridAssenze"},{ref:"BtnNuovo",selector:b+"#BtnNuovo"},{ref:"BtnElimina",selector:b+"#BtnElimina"},{ref:"ComboMotivo",selector:b+"#ComboMotivo"},{ref:"ComboOspedale",selector:b+"#ComboOspedale"},{ref:"OspColumn",selector:b+"#OspColumn"}]);a.control(b+
"#BtnNuovo",{click:a.clickBtnNuovo});a.control(b+"#BtnElimina",{click:a.clickBtnElimina});a.control(b+"#ComboMotivo",{change:a.changeComboMotivo});a.control(b+"#GridAssenze",{beforeedit:a.beforeeditGridAssenze,edit:a.editGridAssenze,canceledit:a.canceleditGridAssenze,validateedit:a.validateeditGridAssenze});a.on({esci:function(){a.getForm().boxBottoni.queryById("btnEsci").handler()}});a.on({changeTab:function(){return a.changeTab()}})},changeComboMotivo:function(a,b,c){svuotaStore(this.storeElencoRegole);
Ext.isEmpty(b)||(a=a.getSelectedRecord().getData().regole,Ext.isEmpty(a)||this.storeElencoRegole.loadData(a))},beforeeditGridAssenze:function(a,b,c){this.abilitaBottoniGridDe(!1);if(!0===a.editing)return!1;var d=a.editor.query("#ComboMotivo")[0].getStore();b=CBA.parametriGenerali.idProfiloCss;d.loaded||d.load({params:{scheda:"H",domanda:3,idServizio:b,idRicovero:this.cbaConfig.idRicoveroCSS},callback:function(a,b,c){c?d.loaded=!0:msgShowError("",b.getError())}});a=a.editor.query("#ComboOspedale")[0].getStore();
a.loaded||(b=Ext.create("Generali.data.StoreCodiceValore",{proxy:{url:getUrlGen()+"/ws/genOsp/ospedali/cbox"},autoLoad:!1,autoDestroy:!1}),loadStore(b,{regione:currOspite.ricovero.servizio.regione}),this.getComboOspedale().bindStore(b),a.loaded=!0)},editGridAssenze:function(a,b,c){this.beforeSalva(a,b)},beforeSalva:function(a,b){var c=this;if((Ext.isEmpty(b.record.getData().id)||0>=b.record.getData().id)&&!Ext.isEmpty(c.storeElencoRegole.getData().items))if(1<c.storeElencoRegole.getData().items.length&&
"N"!=c.storeElencoRegole.getData().items[0].get("operazioneNuovo"))Ext.create("winCBA",{permesso:"S",larghezzaWin:420,altezzaWin:200,name:"GeneraliOSP.raccordoAssenze.view.WinRaccordoAssenze",titolo:"Selezionare Motivo Assenza",maximizable:!1,closable:!1,configItem:{store:c.storeElencoRegole,onSave:function(a,b,d,h){c.salva(a,b,d,h)},onCancel:function(){c.ripristina()},testoHtml:"Selezionare il motivo di Assenza da creare in Contabilità Utenti",lbl:"Motivo Assenza",editor:a,context:b}}).show();else{var d=
c.storeElencoRegole.getData().items[0].data.idPadre||c.storeElencoRegole.getData().items[0].data.id;c.salva(a,b,c.storeElencoRegole.getData().items[0].data.idEsterno,d)}else c.salva(a,b)},salva:function(a,b,c,d){var e=this,f=b.record.getData();form=a.getEditor().getForm();form.controller=this;form.store=b.view.getStore();Ext.apply(f,{id:f.id,idRicovero:e.cbaConfig.idRicoveroCSS,dal:this.dataDal,al:this.dataAl,codiceOspedale:this.getComboOspedale().getValue()});delete f.dal_ore;delete f.al_ore;var g=
{};Ext.isEmpty(d)||(Ext.apply(g,{idRegola:d}),Ext.isEmpty(c)||Ext.apply(g,{idEsterno:c}));c=Ext.isEmpty(f.id)?form.store.getProxy().api.create:form.store.getProxy().api.update;Ext.Ajax.request({method:"POST",url:c,jsonData:f,async:!1,params:g,success:function(c){var d=Ext.JSON.decode(c.responseText);d.success?(c=d.data)?(e.abilitaBottoniGridDe(!0),!Ext.isEmpty(f.id)&&c.motivoUscita&&c.listAssenzeCu?e.creaWinSceltaAssenzaCu(c.listAssenzeCu,c.motivoUscita):msgShow("MSG_SALVATAGGIO_DATI",d.message,null,
null,null,null,null,null,1),e.aggiornaStore(c.id)):a.startEdit(b.record,0):(msgShowError("ERRORE",d.message),e.ripristina())}})},canceleditGridAssenze:function(a,b,c){this.ripristina(b.record.get("id"))},ripristina:function(a){this.abilitaBottoniGridDe(!0);this.aggiornaStore(a)},validateeditGridAssenze:function(a,b,c){a=[];b=b.newValues;c=b.dal;Ext.isEmpty(b.dal_ore)&&(b.dal_ore=new Date(1899,11,30,0,0));var d=b.dal_ore;this.dataDal=new Date(c.getFullYear(),c.getMonth(),c.getDate(),d.getHours(),d.getMinutes());
if(this.dataAl=b.al)c=b.al,Ext.isEmpty(b.al_ore)&&(b.al_ore=new Date(1899,11,30,0,0)),b=b.al_ore,this.dataAl=new Date(c.getFullYear(),c.getMonth(),c.getDate(),b.getHours(),b.getMinutes()),this.dataAl<=this.dataDal&&msgAddError(a,"MSG_DATADAL_MAGGIORE_DATAAL");return msgShow("",a)},clickBtnNuovo:function(a){a=this.getGridAssenze();a.getSelectionModel().getSelection();var b=a.getStore(),c=new Date;c.setHours(0);c.setMinutes(0);b.insert(0,{idRicovero:this.cbaConfig.idRicoveroCSS,dal:c,dal_ore:c});a.getSelectionModel().select(0);
a.getPlugin().startEdit(0,0);this.abilitaBottoniGridDe(!1)},clickBtnElimina:function(a){var b=this;a=b.getGridAssenze();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},abilitaBottoniGridDe:function(a){IsolaCmp(this.getGridAssenze(),!a);this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},aggiornaStore:function(a){var b=this,c=b.getGridAssenze().getStore();c.load({params:{idRicovero:b.cbaConfig.idRicoveroCSS},
callback:function(d,e,f){f?Ext.isEmpty(d)||(d=trovaRecord(c,"id",a),b.getGridAssenze().getSelectionModel().select(d?d:0)):msgShowError("",e.getError())}})},changeTab:function(){var a=this,b=a.getForm().up("window");controller_puoiUscire(b,a.getForm(),function(){a.salva(!1)},function(){a.aggiornaStore();a.cbaConfig.controllerEditFascicolo.navigaWizard(a.cbaConfig.controllerEditFascicolo.navDirection,!0)},function(){a.aggiornaStore()})},refreshDatiVideataFascicolo:function(){var a=null;48==CBA.moduli.moduloAttivo?
a=this.cbaConfig.ricerca:43==CBA.moduli.moduloAttivo&&(a=Ext.getCmp("app-options").queryById("ParametriRicerca"));var b={};Ext.apply(b,{codOspite:this.cbaConfig.codOspite});a.controller.cerca(b)},creaWinSceltaAssenzaCu:function(a,b){this.storeAssenzeCu.loadData(a);var c=CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0].getData().cognome+" "+CBA.moduli.modulo49.storeAnagraficaSel.getData().items[0].getData().nome;Ext.create("winCBA",{permesso:"S",larghezzaWin:450,altezzaWin:200,name:"GeneraliOSP.raccordoAssenze.view.WinSincroAssenzaCollegata",
titolo:"Selezionare Assenza di Contabilità Utenti",maximizable:!1,configItem:{store:this.storeAssenzeCu,htmlText:"Selezionare assenza aperta in Contabilità Utenti per l'ospite <i>"+c+"</i> che si desidera chiudere",dalProperty:"dataDal",alProperty:"dataAl",url:"/ws/genOsp/asstemp/sincro",idMotivo:b}}).show()},onLaunch:function(){var a=this;!a.cbaConfig.codOspite&&a.cbaConfig.controllerEditFascicolo&&(a.cbaConfig.codOspite=a.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.codOspite);!a.cbaConfig.idRicoveroCSS&&
a.cbaConfig.controllerEditFascicolo&&(a.cbaConfig.idRicoveroCSS=a.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.idRicovero);!a.cbaConfig.idProfiloCSS&&a.cbaConfig.controllerEditFascicolo&&(a.cbaConfig.idProfiloCSS=a.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite.idProfilo);a.getGridAssenze().controller=a;a.storeForm=a.getGridAssenze().getStore();"L"==a.cbaConfig.permesso&&containerSolaLettura(a.getGridAssenze());a.storeElencoRegole=Ext.create("Ext.data.Store",{fields:[{name:"descrizioneFormatted",
convert:function(a,c){return c.get("descIdEsterno")+" ("+c.get("descServ")+")"}}]});a.storeAssenzeCu=Ext.create("Ext.data.Store",{fields:[{name:"id"},{name:"dataDal"},{name:"descrizineFormatted",convert:function(a,c){return c.get("desMotivoUscita")+" - Dal: "+FormattaData(c.get("dataDal"))}}]});Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/anagrafica/impostazioni/get",async:!1,params:{idProfilo:CBA.parametriGenerali.idProfiloCss},success:function(b){b=Ext.JSON.decode(b.responseText);b.success&&
"T"!=b.data.abilitaOspedale&&a.getOspColumn().setHidden(!0)}});a.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.assenze.store.Assenze",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idRicovero"},{name:"dal",type:"date"},{name:"dal_ore",type:"date",convert:function(a,b){return b.get("dal")}},{name:"al",type:"date"},{name:"al_ore",type:"date",convert:function(a,b){return b.get("al")}},{name:"motivoUscita"},{name:"desMotivo"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/assenze/listByUtente",api:{read:"/cba/css/cs/ws/assenze/listByUtente",create:"/cba/css/cs/ws/assenze/new",
update:"/cba/css/cs/ws/assenze/update",destroy:"/cba/css/cs/ws/assenze/delete"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.assenze.view.Assenze",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){var a=49===CBA.moduli.moduloAttivo;Ext.applyIf(this,{items:[{xtype:"panel",border:0,layout:{type:"vbox",align:"stretch"},flex:1,bodyPadding:"",title:"",items:[{xtype:"gridpanel",itemId:"GridAssenze",reference:"GridAssenze",store:Ext.create("GeneraliCS.assenze.store.Assenze"),flex:1,margin:8,minHeight:165,columns:[{xtype:"gridcolumn",dataIndex:"id",
text:"ID",hidden:!0},{xtype:"datecolumn",dataIndex:"dal",text:"DAL",format:"d/m/Y",width:100,sortable:a?!1:!0,resizable:a?!1:!0,editor:{xtype:"datefield",allowBlank:!1}},{xtype:"datecolumn",dataIndex:"dal_ore",text:"DALLE",width:72,format:"H:i",sortable:a?!1:!0,resizable:a?!1:!0,editor:{xtype:"timefield",format:"H:i",width:72,allowBlank:!1}},{xtype:"datecolumn",dataIndex:"al",text:"AL",format:"d/m/Y",sortable:a?!1:!0,resizable:a?!1:!0,width:100,editor:{xtype:"datefield"}},{xtype:"datecolumn",dataIndex:"al_ore",
text:"ALLE",width:72,format:"H:i",sortable:a?!1:!0,resizable:a?!1:!0,editor:{xtype:"timefield",format:"H:i",width:72}},{xtype:"gridcolumn",dataIndex:"codiceOspedale",itemId:"OspColumn",reference:"OspColumn",text:"OSPEDALE",width:a?null:200,flex:a?1:null,sortable:a?!1:!0,resizable:a?!1:!0,renderer:function(a,c,d,e,f,g){return d.get("desOspedale")},editor:{xtype:"combobox",itemId:"ComboOspedale",reference:"ComboOspedale",store:Ext.create("Generali.data.StoreCodiceValore"),queryMode:"local",queryParam:"valore",
labelClsExtra:"cbaLabel",name:"codiceOspedale",displayField:"valore",valueField:"codice"}},{xtype:"gridcolumn",dataIndex:"motivoUscita",text:"MOTIVO",width:a?null:200,flex:a?1:null,sortable:a?!1:!0,resizable:a?!1:!0,renderer:function(a,c,d,e,f,g){return d.get("desMotivo")},editor:{xtype:"combobox",itemId:"ComboMotivo",reference:"ComboMotivo",store:Ext.create("GeneraliOSP.store.MotivoAssenzaRegole"),displayField:"valore",queryMode:"local",valueField:"codice",allowBlank:!1}},{xtype:"gridcolumn",dataIndex:"idAssenzaCo",
hidden:!0}],dockedItems:[{xtype:"toolbar",layout:{type:"hbox",align:"stretch"},flex:1,dock:"bottom",items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",text:"NUOVO",cls:"cbaCssBtnFunzione",tooltip:"NUOVO"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",text:"ELIMINA",cls:"cbaCssBtnFunzione",tooltip:"ELIMINA"}]}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.componenti.controller.MsgBoxPrint",{extend:"Generali.standard.stampe.Controller",parametriStampa:{url:"",titolo:"TITOLO_REPORT",hideXml:!0,hideXls:!0,hideCsv:!0,hideTxt:!0,hideBtnStampaOnSecondaryWin:!0},init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"BoxBottoni",selector:a+"#BoxBottoni"},{ref:"BtnStampa",selector:a+"#BtnStampa"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"LabelMessaggio",selector:a+"#LabelMessaggio"}]);this.control(a+
"#BtnEsci",{click:this.clickBtnEsci})},clickBtnEsci:function(a){a.up("window").close()},stampa:function(){var a=Ext.apply(this.parametriStampa,{params:{reportId:4010,format:"pdf"}});Ext.apply(a.params,{});this.cbaConfig.configBtnStampa&&(Ext.applyIf(a,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(a.params,this.cbaConfig.configBtnStampa.params))},doPrint:function(a,b){this.stampa();this.callParent([a,b])},onLaunch:function(){Ext.apply(this.parametriStampa,this.cbaConfig.parametriStampa);
this.configurePrintButton(this.getBtnStampa(),"preview");this.getLabelMessaggio().setText(this.cbaConfig.messaggio)}});
Ext.define("GeneraliCS.componenti.controller.PanelComportamento",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"LblDescr",selector:this.selContainer+"#LblDescr"},{ref:"LblTipologiaCB",selector:this.selContainer+"#LblTipologiaCB"},{ref:"PanelColor",selector:this.selContainer+"#PanelColor"}]);this.callParent(arguments)},caricaDati:function(a){var b=this.getLblDescr(),c=a.get("tipoComportamento"),d=this.getLblTipologiaCB();
b.setHtml(null);d.setHtml(null);a&&(this.getPanelColor().show(),b.setHtml(a.get("descrizione")),d.setHtml(a.get("descrTipoCB")),1==c?(a=traduci("COMPORTAMENTO_PROBLEMA"),b="#D02F42"):(a=traduci("COMPORTAMENTO_TARGET"),b="#75ad3e"),this.getPanelColor().changeStylePanel({title:a,color:b}))},loadComportamento:function(){var a=this;this.storeComportamento.load({params:{id:this.idComportamento},callback:function(b,c,d){d?a.caricaDati(b&&b[0]):msgShowError("",c.getError())}})},onLaunch:function(){var a=
this.cbaConfig,b=a.comportamento;this.idComportamento=a.idComportamento;this.storeComportamento=Ext.create("CS.comportamento.analisiCP.regole.store.AnalisiCP_Comportamento",{autoLoad:!1});b?this.caricaDati(b):this.loadComportamento()},destroy:function(){eliminaStore(this.storeComportamento);this.callParent()}});
Ext.define("GeneraliCS.componenti.controller.RicercaAvanzata",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:a+"#Container"},{ref:"BtnConferma",selector:a+"#BtnConferma"},{ref:"BtnAnnulla",selector:a+"#BtnAnnulla"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"FormFiltri",selector:a+"#FormFiltri"},{ref:"DataAl",selector:a+"#DataAl"},{ref:"DataDal",selector:a+"#DataDal"},{ref:"FiltriAttiviMobile",
selector:a+"#FiltriAttiviMobile"},{ref:"ContainerButtons",selector:a+"#ContainerButtons"}]);this.control(a+"#BtnEsci",{click:function(a){a.up("window").hide()}});this.control(a+"#BtnAnnulla",{click:this.clearFiltri});this.control(a+"#BtnConferma",{click:this.applicaFiltri});this.control(a+"#DataAl",{change:this.changeDataAl});this.control(a+"#DataDal",{change:this.changeDataDal});this.control(a+"#FiltriAttiviMobile",{choicechange:this.changeFiltriAttiviMobile})},changeFiltriAttiviMobile:function(a,
b,c){if(this.cbaConfig.controllerTestata.isDesktop)return!1;this.manualClick=!0;a="T"==b;b=this.cbaConfig.controllerTestata.getBtnAvanzate();(c=this.getContainer().down("#CntInner"))&&c.setHtml(traduci(a?"CS_ATTIVO":"CS_SPENTO"));b.cbaConfig.attivo=a;b.setIconCls(a?"icon-filter-on":"icon-filter-off")},changeDataDal:function(a,b,c){c=this.getDataAl();b&&isValidDate(a)&&(!c.getValue()||b.getTime()>c.getValue().getTime())&&c.setValue(b)},changeDataAl:function(a,b){var c=this.getDataDal();b?c.getValue()&&
isValidDate(a)&&b.getTime()<c.getValue().getTime()&&c.setValue(b):c.setValue()},clearFiltri:function(){clearForm(this.getFormFiltri())},applicaFiltri:function(a){if(!a.stopEvent){!this.getDataAl()||this.getDataAl().getValue()||this.getDataDal().getValue()||this.getDataAl().setValue(new Date);this.cbaConfig.callbackCerca&&this.cbaConfig.callbackCerca();this.getContainer().up("window").hide();Ext.isDefined(this.cbaConfig.controllerTestata.isDesktop)&&!this.cbaConfig.controllerTestata.isDesktop&&(this.manualClick||
"F"!=this.getFiltriAttiviMobile().getValueExclusive()&&this.getFiltriAttiviMobile().getValueExclusive()||this.getFiltriAttiviMobile().setValueExclusive("T"),this.manualClick=!1);a=this.getFormFiltri().queryById("ExtraParams");if(!Ext.isEmpty(a)){var b="",c;Ext.each(a.items.items,function(a){if(a&&Ext.isDefined(a.getValue())&&!Ext.isEmpty(a.getValue())&&a.cbaConfig&&a.cbaConfig.nomeProp){var d=a.getValue();c=!0;"checkboxfield"==a.xtype&&(d?d="T":c=!1);c&&("comportamentoNote"==a.cbaConfig.nomeProp&&
(d="%"+d+"%"),b+=a.cbaConfig.nomeProp+":"+d+";")}});a.queryById("Params").setValue(b)}this.cbaConfig.controllerTestata.aggiornaStore()}},onLaunch:function(){var a=this;a.cbaConfig.hideFiltriBase&&(Ext.each(a.getFormFiltri().query("field"),function(a){a.cbaConfig.filtroBase&&(a.hide(),a.destroy())}),Ext.each(a.getFormFiltri().query("fieldset"),function(a){Ext.isEmpty(a.items.items)&&(a.hide(),a.destroy())}));a.cbaConfig.filtriPerson&&a.getFormFiltri().add(a.cbaConfig.filtriPerson);a.cbaConfig.callbackFn&&
a.cbaConfig.callbackFn();CBA.parametriGenerali.produzione||a.getBtnConferma().up("container").add(Ext.create("Ext.Button",{width:25,height:25,text:"E",tooltip:"Visibile SOLO in fase di SVILUPPO!",handler:function(b){cssEnableAll(a.cbaConfig.controllerTestata);b.up("window").hide()}}));55==CBA.moduli.moduloAttivo&&(a.getBtnConferma().setIconCls("icon-ok"),a.getBtnConferma().setText(traduci("CONFERMA")),a.getBtnConferma().setMargin("0 1 0 0"),a.getBtnAnnulla().setIconCls("icon-annulla16"),a.getBtnAnnulla().setText(traduci("RIPRISTINA")),
a.getBtnAnnulla().setMargin("0 1 0 0"),a.getBtnEsci().setIconCls("icon-esci"),a.getBtnEsci().setText(traduci("ESCI")),a.getBtnEsci().setMargin("0 1 0 0"))},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.componenti.controller.Sintesi",{extend:"Generali.standard.ViewController",init:function(){this.callParent(arguments)},aggiornaStore:function(){var a=this.lookup("Form");clearForm(a);var b=this.cbaConfig;this.storeForm.load({params:{idRicovero:b.idRicovero,codVideata:b.codVideata},callback:function(b,d,e){if(e){if(!Ext.isEmpty(b)){var c={};b.forEach(function(b){var d="_tmp_"+b.data.idCampo;c[d]=b.data.note;a.getForm().findField(d).cbaConfig.id=b.data.id});a.getForm().setValues(c)}}else msgShowError("",
d.getError())}})},salvaForm:function(a){var b=this.cbaConfig.idRicovero,c=this.lookup("Form"),d=this.lookup("Form").query("textarea"),e=[];d&&0<d.length&&d.forEach(function(a){a=Object.assign({},a.cbaConfig,{idRicovero:b,compilatore:CBA.moduli.modulo49.operatore.id,note:a.getValue()});e.push(a)});controller_salvaRecord(c,e,a)},verificaCampiForm:function(){var a=[];this.lookup("Form").isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},gestioneForm:function(){var a=this,b=this.lookup("Form");
b.boxBottoni=this.lookup("BoxBottoni");this.storeForm=b.store=Ext.create("GeneraliCS.store.Sintesi");b.controller=this;var c=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(b){a.salvaForm(!1)},annulla_callback:function(){a.aggiornaStore()},verificaCampiForm_callback:function(){return a.verificaCampiForm()},esci_callback:function(){b.up("window").hide()},noText:!0,personIcons:getIconButtons()}});inserisciBottoni(b.boxBottoni,c,!0);margineStdBtnFunzione(b.boxBottoni);
b.boxBottoni.queryById("btnNuovo").hide();b.boxBottoni.queryById("btnElimina").hide();b.getForm().on("dirtychange",function(c,e){IsolaCmp(a.lookup("Container"),e);controller_abilitaBottoni(b)})},getImpostazioniCampi:function(){var a=this,b=this.cbaConfig,c=b.idProfilo,d=b.codVideata;return new Promise(function(b,f){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/bilancio/eco/person/campi/list",params:{idProfilo:c,codVideata:d,insertDefault:!0},success:function(c){var d=Ext.JSON.decode(c.responseText);
c=d.data;var e=d.message;d.success?(c&&0<c.length&&(Ext.suspendLayouts(),d=c.map(function(a,b){return{xtype:"textarea",labelClsExtra:"cbaCssLabel",fieldLabel:a.label,labelAlign:"top",height:150,name:"_tmp_"+a.id,cbaConfig:{idCampo:a.id,codVideata:a.codVideata}}}),a.lookup("Form").add(d),"S"!=a.cbaConfig.permesso&&containerSolaLettura(a.lookup("Form"),!0),Ext.resumeLayouts(!0)),b(c)):(msgShowError("",e),f(e))}})})},onLaunch:function(){var a=this;this.gestioneForm();this.getImpostazioniCampi().then(function(){return a.aggiornaStore()})["catch"](function(a){return console.error(a)})}});
Ext.define("GeneraliCS.componenti.view.MsgBoxPrint",{extend:"Generali.standard.ControlledContainer",uses:["Generali.standard.stampe.Button"],initComponent:function(){Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"middle",pack:"center"},flex:1,items:[{xtype:"label",itemId:"LabelMessaggio",reference:"LabelMessaggio"}]},{xtype:"panel",itemId:"BoxBottoni",reference:"BoxBottoni",
layout:{type:"hbox",pack:"center"},items:[{xtype:"newButtonStampa",itemId:"BtnStampa",reference:"BtnStampa",scale:"small",cls:"cbaCssBtnFunzione",margin:"5 5 5 0"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",text:"ANNULLA",cls:"cbaCssBtnFunzione",margin:"5 5 5 0"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.componenti.view.PanelComportamento",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"vbox"},flex:1,initComponent:function(){Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},flex:1,padding:4,items:[{xtype:"cssColorPanel",hidden:!0,itemId:"PanelColor",reference:"PanelColor",cbaConfig:{items:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"label",cls:"cbaCssLabel cbaGrassetto",text:traduci("DESCRIZIONE")+":"},{xtype:"label",margin:"0 0 0 8",
itemId:"LblDescr",reference:"LblDescr",cls:"cbaCssLabel"},{xtype:"label",margin:"0 0 0 8",cls:"cbaCssLabel cbaGrassetto",text:traduci("TIPOLOGIA_CB")+":"},{xtype:"label",itemId:"LblTipologiaCB",reference:"LblTipologiaCB",cls:"cbaCssLabel"}]}]}}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.componenti.view.RicercaAvanzata",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",width:250,layout:{align:"stretch",type:"vbox"},padding:5,items:[{xtype:"form",itemId:"FormFiltri",reference:"FormFiltri",layout:{type:"vbox",align:"stretch"},flex:1,border:0,padding:10,items:[{xtype:"checkboxfield",name:"avanzate",checked:!0,hidden:!0},{xtype:"fieldset",title:"CS_INTERVALLO_DATE",
layout:{type:"hbox"},items:[{xtype:"datefield",itemId:"DataDal",reference:"DataDal",name:"dal",width:150,fieldLabel:"DAL",labelClsExtra:"cbaLabel",labelWidth:35,margin:"5 30 5 5",cbaConfig:{filtroBase:!0}},{xtype:"datefield",itemId:"DataAl",reference:"DataAl",name:"al",width:150,fieldLabel:"AL",labelClsExtra:"cbaLabel",labelWidth:35,margin:"5 30 5 5",cbaConfig:{filtroBase:!0}}]},{xtype:"checkboxfield",cls:"cbaLabel",itemId:"SoloOperatoreLog",reference:"SoloOperatoreLog",name:"me",margin:"5 5 0 0",
boxLabel:"CS_SOLO_OPERATORE_LOG",checked:!1,inputValue:"T",uncheckedValue:"F",cbaConfig:{filtroBase:!0}}]},{xtype:"container",layout:{type:"hbox",align:"middle"},padding:"0 0 5 10",items:[{xtype:55==CBA.moduli.moduloAttivo?"container":"CSSButtonsPanel",itemId:"ContainerButtons",reference:"ContainerButtons",layout:{type:"hbox",pack:"end"},flex:1,items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",cls:55==CBA.moduli.moduloAttivo?"cba-button-25":"cbaCssBtnFunzione"},{xtype:"button",itemId:"BtnAnnulla",
reference:"BtnAnnulla",cls:55==CBA.moduli.moduloAttivo?"cba-button-25":"cbaCssBtnFunzione"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",cls:55==CBA.moduli.moduloAttivo?"cba-button-25":"cbaCssBtnFunzione"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.componenti.view.Sintesi",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",reference:"Container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",reference:"BoxBottoni",style:{borderBottom:"1px solid #eceff1 !important"}},{xtype:"form",margin:"5 0 0 0",layout:{type:"vbox",align:"stretch"},flex:1,reference:"Form",trackResetOnLoad:!0,scrollable:!0,border:!1,items:[]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.listaVideate.store.ListaDiari",{extend:"Ext.data.ArrayStore",fields:[],autoDestroy:!1});Ext.define("GeneraliCS.listaVideate.store.RicVideate",{extend:"Ext.data.ArrayStore",fields:[],autoDestroy:!0});
Ext.define("GeneraliCS.permessi.controller.GridPermessi",{extend:"Generali.standard.stampe.Controller",parametriStampa:{url:"/cba/css/cs/ws/report/permessi",hideXml:!0,hideCsv:!0,hideBtnStampaOnSecondaryWin:!0},init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grid",selector:a+"#Grid"},{ref:"ColAl",selector:a+"#ColAl"},{ref:"ColMotivo",selector:a+"#ColMotivo"},{ref:"ColAccompagnatore",selector:a+"#ColAccompagnatore"},{ref:"BtnNuovo",selector:a+"#BtnNuovo"},
{ref:"BtnElimina",selector:a+"#BtnElimina"},{ref:"DataDal",selector:a+"#DataDal"},{ref:"DataAl",selector:a+"#DataAl"},{ref:"BtnSospendi",selector:a+"#BtnSospendi"},{ref:"BtnStampa",selector:a+"#BtnStampa"},{ref:"TimeAlle",selector:a+"#TimeAlle"}]);this.control(a+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(a+"#BtnElimina",{click:this.clickBtnElimina});this.control(a+"#BtnSospendi",{click:this.creaWinSospensione});this.control(a+"#DataAl",{expand:this.expandDataAl});this.control(a+"#Grid",
{selectionchange:this.selectionchangeGrid,beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,validateedit:this.validateeditGrid})},controllaDate:function(a,b){var c=b.dal,d=b.dalle,e=b.al,f=b.alle,g=null,h=null;c&&f&&(g=sommaDataOra(c,d));e&&f&&(h=sommaDataOra(e,f));g&&h&&g.getTime()>h.getTime()&&msgAddError(a,"MSG_LIMITE_DATE")},verificaCampiForm:function(a,b){var c=[];a.isValid()||msgAddError(c,traduci("MSG_CAMPI_OBBLIGATORI"));this.controllaDate(c,b);return msgShow("",
c)},stampa:function(){var a=Ext.apply(this.parametriStampa,{params:{reportId:4010,format:"pdf",tipo:this.cbaConfig.type.includes("S")?1:2,idRicovero:this.idRicovero}});Ext.apply(a.params,{});this.cbaConfig.configBtnStampa&&(Ext.applyIf(a,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(a.params,this.cbaConfig.configBtnStampa.params))},doPrint:function(a,b){this.stampa();this.callParent([a,b])},creaWinSospensione:function(a){var b=this,c=this.getGrid().getSelectionModel().getSelection()[0],
d=Ext.create("winCBA",{larghezzaWin:278,altezzaWin:146,maximizable:!1,closable:!0,titolo:traduci("SOSPENDI"),name:[{xtype:"panel",layout:{type:"vbox",align:"middle",pack:"center"},items:[{xtype:"label",cls:"cbaCssLabel",html:traduci("SOSPENDI")+" "+traduci("PERMESSI")+" "+traduci("DEL")+": <b>"+FormattaData(c.get("dal"),"d/m/Y")+"</b>"},{xtype:"datefield",width:120,minValue:c.get("dal"),margin:"8 0 0 0",itemId:"DataSospensione",reference:"DataSospensione",format:"d/m/Y",labelAlign:"top",labelClsExtra:"cbaCssLabel",
allowBlank:!1,listeners:{afterrender:function(a){return a.isValid()}}}],buttons:[{xtype:"button",text:"OK",handler:function(a){var e=d.down("#DataSospensione"),g=c.get("dal");messaggi=[];if(e.getValue()){if(e.getValue().getTime()<g.getTime())return Messaggio("ATTENZIONE",traduci("MSG_LIMITE_DATE"),"OK","WARNING"),!1;b.sospendiPermesso(e.getValue(),function(){return a.up("window").close()})}else return Messaggio("ATTENZIONE",traduci("MSG_CAMPI_OBBLIGATORI"),"OK","ERROR"),!1}}]}]});d.show()},sospendiPermesso:function(a,
b){var c=this,d=this.getGrid().getSelectionModel().getSelection()[0];Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/permessi/sosp",params:{id:d.get("id"),compilMod:this.compilatore,dataMod:new Date,dataAl:a},success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(c.aggiornaStore(a.data.id),b&&b()):msgShowError("",a.message)}})},selectionchangeGrid:function(a,b){this.cbaConfig.type.includes("G")?(this.getBtnSospendi().setHidden(0===b.length),0<b.length&&this.getBtnSospendi().setDisabled(b[0].get("deletedData")||
b[0].get("al"))):this.getBtnSospendi().setHidden(!0);0<b.length&&this.getBtnElimina().setDisabled("A"===b[0].data.tipoBlocco[0].valore)},expandDataAl:function(a){a.setMinValue(this.getDataDal().getValue())},abilitaBottoni:function(a){IsolaCmp(this.getGrid(),!a);this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},clickBtnElimina:function(a){var b=this;a=this.getGrid();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){return b.aggiornaStore()},
!1,"MSG_ANNULLA_RECORD","ANNULLA")},clickBtnNuovo:function(a){var b=this,c=this.getGrid();c.getSelectionModel().getSelection();var d=c.getStore();getServerTime().then(function(a){d.insert(0,{id:null,idRicovero:b.idRicovero,data:new Date(a),tipo:b.cbaConfig.type.includes("S")?1:2,compilatore:b.compilatore,compilatoreNominativo:CBA.moduli.modulo49.operatore.descr,compilatoreFigProf:CBA.moduli.modulo49.operatore.figuraProfessionale});c.getSelectionModel().select(0);b.cbaConfig.type.includes("G")&&b.getColAl().hide();
c.getPlugin().startEdit(0,0);b.abilitaBottoni(!1)})},beforeeditGrid:function(a,b,c){this.abilitaBottoni(!1);if(!0===a.editing)return!1;this.getTimeAlle().allowBlank=this.cbaConfig.type.includes("G")},canceleditGrid:function(a,b,c){this.abilitaBottoni(!0);this.aggiornaStore(b.record.get("id"))},editGrid:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();Ext.apply(c,{id:c.id});if(this.cbaConfig.type.includes("S")){var e,f;e=sommaDataOra(c.dal,
c.dalle);f=sommaDataOra(c.al,c.alle);delete c.dalle;delete c.alle;Ext.apply(c,{dal:e,al:f})}controller_salvaRecord(d,c)?this.abilitaBottoni(!0):a.startEdit(b.record,0)},validateeditGrid:function(a,b,c){b=[];a=a.getEditor().getForm().getFieldValues();this.controllaDate(b,a);return msgShow("",b)},aggiornaStore:function(a){var b=this,c=this.getGrid(),d=c.getStore(),e=1;this.cbaConfig.type.includes("G")&&(e=2);d.load({params:{idRicovero:this.idRicovero,tipo:e},callback:function(e,g,h){h?(b.cbaConfig.type.includes("G")&&
b.getColAl().show(),b.getBtnElimina().setDisabled(Ext.isEmpty(e)),b.getBtnStampa().setDisabled(Ext.isEmpty(e)),e=null,a&&(e=trovaRecord(d,"id",a)),c.getSelectionModel().deselectAll(),c.getSelectionModel().select(e?[e]:0)):msgShowError("",g.getError())}})},loadStore:function(a,b,c){b=void 0===b?null:b;c=void 0===c?null:c;ImpostaUrl(a.store);return new Promise(function(d,e){a.store.load({params:b,callback:function(a,b,h){h?(c&&c(a),d(a)):e(""+b.getError())}})})},renderer_cell_combobox:function(a,b){var c=
this.getGrid().down("[dataIndex="+b+"]").getEditor().getStore(),c=trovaRecord(c,"codice",a),d="";c&&(d=c.get("valore"));return d},checkValidityDataAl:function(a){var b=!0;Ext.isEmpty(a)&&this.cbaConfig.type.includes("S")&&(b=!1);return b||traduci("CS_CAMPO_OBBLIGATORIO")},onLaunch:function(){var a=this,b=this.getGrid();b.cbaConfig.btnElimina=this.getBtnElimina();b.controller=this;this.serverDate=null;this.idProfiloCss=this.cbaConfig.idProfiloCss;this.idRicovero=this.cbaConfig.idRicovero;this.compilatore=
CBA.moduli.modulo49.operatore.id;this.cbaConfig.type.includes("G")&&(b.getColumns().forEach(function(a){"dalle"===a.dataIndex&&a.destroy()}),b.getColumnManager().headerCt.insert(5,{xtype:"datecolumn",format:"H:i",dataIndex:"dalle",width:61,text:"DALLE",editor:{xtype:"timefield",format:"H:i",allowBlank:!0},renderer:function(a,b,e){a=null;Ext.isEmpty(e.get("dalle"))||(a=FormattaData(e.get("dalle"),"H:i"));return a}}),b.getView().refresh());this.loadStore(this.getColMotivo().editor,{scheda:"H",domanda:3,
idProfilo:this.idProfiloCss}).then(function(b){return a.loadStore(a.getColAccompagnatore().editor)}).then(function(b){a.cbaConfig.fireAggiornaStore&&a.aggiornaStore()})["catch"](function(a){return msgShowError("",a)})},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.permessi.controller.Main",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"TabPermessiSingolari",selector:a+"#TabPermessiSingolari"},{ref:"TabPermessiGiornalieri",selector:a+"#TabPermessiGiornalieri"},{ref:"TabPanel",selector:a+"#TabPanel"}]);this.control(a+"#TabPanel",{tabchange:this.tabchangeTabPanel})},tabchangeTabPanel:function(a,b,c){b.controllerGrid.aggiornaStore()},carciaGridPermessi:function(a,
b){var c=Ext.create("GeneraliCS.permessi.view.GridPermessi",{cbaConfig:{controllerMain:this,type:b,idProfiloCss:this.idProfiloCss,idRicovero:this.idRicovero,fireAggiornaStore:b.includes("S"),desVideata:"Anagrafica - Permessi"}});a.add(c);a.controllerGrid=c.lookupController()},onLaunch:function(){this.idProfiloCss=null;var a=this.cbaConfig.controllerEditFascicolo.cbaConfig.currOspite;Ext.isDefined(a)&&(this.idProfiloCss=a.idProfilo,this.idRicovero=a.idRicovero);this.carciaGridPermessi(this.getTabPermessiSingolari(),
"S");this.carciaGridPermessi(this.getTabPermessiGiornalieri(),"G")},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.permessi.store.GridPermessi",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"dal",type:"date"},{name:"al",type:"date"},{name:"dalle",type:"date"},{name:"alle",type:"date"},{name:"idRicovero"},{name:"compilatore"},{name:"deletedData"},{name:"data_mod"},{name:"compilatore_mod"},{name:"data",type:"date"},{name:"firmato"},{name:"nonEffettuato"},{name:"motivo"},{name:"accompagnatore"},{name:"note"},{name:"tipo"},{name:"compilatoreNominativo"},{name:"compilatoreFigProf"},{name:"nominativo"}],
proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/permessi/list",api:{read:"/cba/css/cs/ws/permessi/list",update:"/cba/css/cs/ws/permessi/update",create:"/cba/css/cs/ws/permessi/new",destroy:"/cba/css/cs/ws/permessi/delete"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.permessi.view.GridPermessi",{extend:"Generali.standard.ControlledContainer",uese:["GeneraliCS.permessi.store.GridPermessi","GeneraliCS.store.RisposteCU","GeneraliOSP.portlet.store.TipiParentela","Generali.standard.stampe.Button"],layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){var a=this;Ext.applyIf(this,{items:[{xtype:"CBAGridAnnullabile",scrollable:!0,itemId:"Grid",reference:"Grid",flex:1,store:Ext.create("GeneraliCS.permessi.store.GridPermessi"),columns:[{xtype:"gridcolumn",
dataIndex:"id",hidden:!0},{xtype:"datecolumn",format:"d/m/Y",text:"DAL",dataIndex:"dal",editor:{xtype:"datefield",itemId:"DataDal",reference:"DataDal",format:"d/m/Y",allowBlank:!1}},{xtype:"datecolumn",format:"H:i",dataIndex:"dalle",width:61,text:"DALLE",editor:{xtype:"timefield",format:"H:i",allowBlank:!1},renderer:function(a,c,d){return Ext.isEmpty(d.get("dalle"))?FormattaData(d.get("dal"),"H:i"):FormattaData(d.get("dalle"),"H:i")}},{xtype:"datecolumn",format:"d/m/Y",itemId:"ColAl",reference:"ColAl",
dataIndex:"al",text:"AL",editor:{xtype:"datefield",itemId:"DataAl",reference:"DataAl",name:"al",format:"d/m/Y",validator:function(b){return a.controller.checkValidityDataAl(b)}}},{xtype:"datecolumn",format:"H:i",text:"ALLE",dataIndex:"alle",width:61,editor:{xtype:"timefield",itemId:"TimeAlle",reference:"TimeAlle",format:"H:i",allowBlank:"G"===this.cbaConfig.type},renderer:function(a,c,d){return Ext.isEmpty(d.get("alle"))?FormattaData(d.get("al"),"H:i"):FormattaData(d.get("alle"),"H:i")}},{xtype:"gridcolumn",
itemId:"ColMotivo",reference:"ColMotivo",text:"MOTIVO",width:172,dataIndex:"motivo",editor:{xtype:"combobox",store:Ext.create("GeneraliCS.store.RisposteCU",{}),displayField:"valore",valueField:"codice",minChars:0,queryMode:"local",allowBlank:!1},renderer:function(a,c,d){return this.lookupController().renderer_cell_combobox(a,"motivo")}},{xtype:"gridcolumn",width:134,text:"ACCOMPAGNATORE",itemId:"ColAccompagnatore",reference:"ColAccompagnatore",dataIndex:"accompagnatore",editor:{xtype:"combobox",store:Ext.create("GeneraliOSP.portlet.store.TipiParentela"),
displayField:"valore",valueField:"codice",minChars:0,queryMode:"local"},renderer:function(a,c,d){return this.lookupController().renderer_cell_combobox(a,"accompagnatore")}},{xtype:"gridcolumn",flex:1,text:"NOTE",dataIndex:"note",editor:{xtype:"textarea"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",hidden:!0,itemId:"BtnSospendi",reference:"BtnSospendi",text:traduci("TERAPIE_SOSPENDI"),
cls:"cbaCssBtnFunzione-special"},{xtype:"tbfill"},{xtype:"container",itemId:"HeaderContainer",reference:"HeaderContainer",layout:{type:"hbox",align:"stretch"},margin:"0 0 5 0",items:[{xtype:"CSSButtonsPanel",itemId:"BoxBottoni",reference:"BoxBottoni",flex:1,items:[{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",disabled:!0},{xtype:"button",scale:"small",itemId:"BtnStampa",reference:"BtnStampa"}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.permessi.view.Main",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"tabpanel",itemId:"TabPanel",reference:"TabPanel",items:[{title:"PERMESSI_SINGOLI",itemId:"TabPermessiSingolari",reference:"TabPermessiSingolari",layout:{type:"vbox",align:"stretch"}},{title:"PERMESSI_GIORNALIERI",itemId:"TabPermessiGiornalieri",reference:"TabPermessiGiornalieri",layout:{type:"vbox",align:"stretch"}},{title:"PERMESSI_PERIODICI",itemId:"TabPermessiPeriodici",
reference:"TabPermessiPeriodici",layout:{type:"vbox",align:"stretch"},hidden:!0}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.popup.controller.Popup",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"PnlTestata",selector:a+"#PnlTestata"},{ref:"Container",selector:a+"#Container"},{ref:"CntForm",selector:a+"#CntForm"},{ref:"TpVideate",selector:a+"#TpVideate"},{ref:"TxtCerca",selector:a+"#TxtCerca"},{ref:"CntMenu",selector:a+"#CntMenu"},{ref:"IconaTipoVideata",selector:a+"#IconaTipoVideata"},{ref:"LabelNoResult",selector:a+
"#LabelNoResult"}]);this.control(a+"#TpVideate",{afterrender:this.afterrenderTpVideate,tabchange:this.apriVideata});this.control(a+"#TxtCerca",{change:this.filtraVideate})},filtraVideate:function(a){var b=this.getTpVideate();b.setHidden(!1);this.getLabelNoResult().setHidden(!0);Ext.each(b.tabBar.items.items,function(b){var c=!0;Ext.isEmpty(a.getValue())||(c=-1!=b.title.toUpperCase().indexOf(a.getValue().toUpperCase()))||(c=-1!=b.card.titoloEsteso.toUpperCase().indexOf(a.getValue().toUpperCase()));
c&&!b.card.nascosto?b.show():b.hide()});countResult=0;b.tabBar.items.items.forEach(function(a){if(!1===a.hidden)return countResult++,!1});0===countResult&&(b.setHidden(!0),this.getLabelNoResult().setHidden(!1))},afterrenderTpVideate:function(a){var b=this;Ext.each(a.tabBar.items.items,function(a){a.getEl().setHtml('<span id="tab-1467-btnWrap" data-ref="btnWrap" role="presentation" unselectable="on" style="table-layout:fixed;" class="x-tab-wrap x-tab-wrap-default "><span id="tab-1467-btnEl" data-ref="btnEl" role="presentation" unselectable="on" style="height:auto;" class="x-tab-button x-tab-button-default  x-tab-no-text   x-tab-button-center "><span id="tab-1467-btnIconEl" data-ref="btnIconEl" role="presentation" unselectable="on" class="x-tab-icon-el x-tab-icon-el-default  " style=""></span><span id="tab-1467-btnInnerEl" data-ref="btnInnerEl" unselectable="on" class="x-tab-inner x-tab-inner-default">'+
b.spezzaParole(a.title)+"</span></span></span>");a.card.titoloEsteso!=a.title&&creaToolTipBubble(a.getId(),a.card.titoloEsteso,"",!1,!1)})},apriVideata:function(a,b,c,d){this.getPnlTestata().removeAll();var e=80048==b.cbaConfig.videata.voceMenu.id&&1==getTipoPai();e&&(b.cbaConfig.videata.voceMenu.nomeForm="CS.progetti.paiObGen.view.PaiObGen");if(!this.cbaConfig.standAlone)if(this.cbaConfig.videataDettaglio=b.cbaConfig.videata.voceMenu.nomeForm,b.cbaConfig.videata.voceMenu.iconCls&&(this.ultimaClasse&&
this.getIconaTipoVideata().removeCls(this.ultimaClasse),this.getIconaTipoVideata().addCls(b.cbaConfig.videata.voceMenu.iconCls),this.ultimaClasse=b.cbaConfig.videata.voceMenu.iconCls),a=this.getContainer().up("window"))a.impostaTitolo(b.title),e&&a.maximize();else if(b.title)this.getContainer().on("afterrender",function(a){var c=a.up("window");Ext.defer(function(){c&&(c.impostaTitolo(b.title),e&&c.maximize())},50)});c={controllerTestata:this,idModuloPrg:b.cbaConfig.videata.voceMenu.idModuloPrg,idVoceAgenda:b.cbaConfig.videata.voceMenu.idVoceAgenda,
codVideata:b.cbaConfig.videata.codVideata,idVideata:b.cbaConfig.videata.idVideata,desVideata:b.cbaConfig.videata.desVideata,callbackFnPortlet:c?!1:this.cbaConfig.callbackFn};this.cbaConfig.importSosia&&Ext.apply(c,{importSosia:this.cbaConfig.importSosia});this.cbaConfig.selezioneTestata&&!Ext.isEmpty(this.cbaConfig.selezioneTestata)&&Ext.apply(c,{selezioneTestata:this.cbaConfig.selezioneTestata});this.cbaConfig.anagraficaExtra&&!Ext.isEmpty(this.cbaConfig.anagraficaExtra)&&Ext.apply(c,{anagraficaExtra:this.cbaConfig.anagraficaExtra});
b.cbaConfig.videata.voceMenu.nascondiTestata?(Ext.apply(c,{permesso:b.cbaConfig.videata.tipoPermesso}),this.getPnlTestata().add(Ext.create(this.cbaConfig.videataDettaglio,{cbaConfig:c}))):(Ext.apply(c,{permessoDe:b.cbaConfig.videata.tipoPermesso}),this.getPnlTestata().add(Ext.create("GeneraliCS.testatapopup.view.TestataPopUp",{cbaConfig:c})),delete this.cbaConfig.selezioneTestata);this.cbaConfig.callbackOnOpen&&Ext.isFunction(this.cbaConfig.callbackOnOpen)&&this.cbaConfig.callbackOnOpen()},spezzaParole:function(a){a=
a.trim();if(14>=a.length)return a;for(var b=0,c,d=a;14>=b&&-1!=d.indexOf(" ");)if(c=d.indexOf(" ")+1,14>=b+c)b+=c,d=d.substr(c,d.length);else break;0==b&&(b=14);return a=a.substr(0,b).trim()+"<br>"+this.spezzaParole(a.substr(b,a.length))},aggiungiTab:function(a,b,c,d){a=a.add({title:traduci(b),hidden:d,nascosto:d});a.titoloEsteso=c.voceMenu&&c.voceMenu.descrizione?c.voceMenu.descrizione:"";a.cbaConfig={videata:c};return a},onLaunch:function(){var a=this,b=!1;if(!Ext.isEmpty(a.cbaConfig.iconaPortlet)){var c=
"icons-css-90 "+a.cbaConfig.iconaPortlet+" css-blu";a.getIconaTipoVideata().addCls(c);a.ultimaClasse=c}var d=a.getTpVideate();d.removeAll();var e=c=!1;a.cbaConfig.portlet&&(c=a.cbaConfig.portlet.up("#NewPortletStd").controller,e=c.videataAperturaDiretta);if(a.cbaConfig.elencoVideate){var f=a.cbaConfig.elencoVideate,g=0;f.forEach(function(b){if("N"!=b.tipoPermesso){var c="V"==b.tipoPermesso;a.aggiungiTab(d,b.voceMenu&&b.voceMenu.titolo?b.voceMenu.titolo:"",b,a.cbaConfig.nuovoDefault&&("L"==b.tipoPermesso||
c));g++}});Ext.each(d.tabBar.items.items,function(a){a.setHeight(70);a.setWidth(95);a.setMargin("5 1 5 1")});if(!e){if(Ext.isEmpty(a.cbaConfig.videataDettaglio)&&a.cbaConfig.nuovoDefault){var h=0,k;f.forEach(function(a){"S"==a.tipoPermesso&&(h++,1==h&&(k=a))});1==h&&(a.cbaConfig.videataDettaglio=k.voceMenu.nomeForm)}Ext.isEmpty(a.cbaConfig.videataDettaglio)||Ext.each(d.tabBar.items.items,function(c){if(a.cbaConfig.standAlone||c.card.cbaConfig.videata.voceMenu.nomeForm==a.cbaConfig.videataDettaglio&&
(Ext.isEmpty(a.cbaConfig.codVideata)||a.cbaConfig.codVideata&&a.cbaConfig.codVideata==c.card.cbaConfig.videata.codVideata))if(a.cbaConfig.sottoTipoTestata){if(a.cbaConfig.standAlone||c.card.cbaConfig.videata.codVideata==a.cbaConfig.sottoTipoTestata||c.card.cbaConfig.videata.voceMenu.idModuloPrg==a.cbaConfig.sottoTipoTestata)return d.setActiveTab(c.card),b=!0,!1}else return d.setActiveTab(c.card),b=!0,!1});if(b)return!1;if(!a.cbaConfig.standAlone&&!a.cbaConfig.nuovoDefault&&1==g)return d.setActiveTab(d.tabBar.items.items[0].card),
b=!0,!1;if(b)return!1}}else a.getPnlTestata().add(Ext.create("GeneraliCS.testatapopup.view.TestataPopUp",{cbaConfig:{controllerTestata:a,permessoDe:a.cbaConfig.permesso}}));if(e){var l,n=c.videataAperturaDiretta.get("id");Ext.each(d.tabBar.items.items,function(a){l=a.card.cbaConfig.videata.voceMenu.id;if(l==n)return d.setActiveTab(a.card),b=!0,!1});c.videataAperturaDiretta=!1}if(b)return!1},destroy:function(){this.cbaConfig.portlet&&this.cbaConfig.portlet.controller&&this.cbaConfig.portlet.controller.cbaConfig&&
this.cbaConfig.portlet.controller.cbaConfig.controllerPortlet&&this.cbaConfig.portlet.controller.cbaConfig.controllerPortlet.cbaConfig&&!Ext.isEmpty(this.cbaConfig.portlet.controller.cbaConfig.controllerPortlet.cbaConfig.collapsedFromSchema)&&0==this.cbaConfig.portlet.controller.cbaConfig.controllerPortlet.cbaConfig.collapsedFromSchema&&this.cbaConfig.portlet.controller.updatePortlet();this.cbaConfig.callbackOnExit&&Ext.isFunction(this.cbaConfig.callbackOnExit)&&this.cbaConfig.callbackOnExit();var a=
CBA.moduli.modulo49.controllerCercaAnagrafica;(a=a?a.pnlElencoPazienti:null)&&a.isVisible()&&a.down("grid").lookupController().updatePaziente();this.callParent()}});
Ext.define("GeneraliCS.popup.view.Popup",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"Container",reference:"Container",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"container",itemId:"CntMenu",reference:"CntMenu",cls:"panelCssChiaro",margin:"5 0 3 3",style:{border:"1px solid"},layout:{type:"vbox",align:"stretch"},minWidth:100,width:100,height:"100%",items:[{xtype:"image",itemId:"IconaTipoVideata",reference:"IconaTipoVideata",
height:85,width:85,margin:"10 5 0 5",src:"",mode:"image"},{xtype:"textfield",width:90,emptyText:"CERCA",itemId:"TxtCerca",reference:"TxtCerca",margin:"15 0 0 0"},{xtype:"tabpanel",tabPosition:"left",itemId:"TpVideate",reference:"TpVideate",flex:1,tabRotation:0,titleRotation:0,maxWidth:100,maxTabWidth:100},{xtype:"label",itemId:"LabelNoResult",reference:"LabelNoResult",margin:"15 0 0 0",cls:"cbaCssLabel",html:'<div style="font-weight:bold;text-align: center;">'+traduci("NO_RISULTATO_RICERCA")+"</div>",
hidden:!0}]},{xtype:"container",itemId:"PnlTestata",reference:"PnlTestata",layout:{type:"fit"},flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"middle",pack:"center"},items:[{xtype:"label",text:"SELEZIONARE_VIDEATA_DA_MENU_SINISTRA",cls:"cbaCssLabel",style:{"font-weight":"bold"}},{xtype:"button",text:"ANNULLA",cls:"cbaCssBtnFunzione",margin:5,handler:function(a){a.up("window").close()},nonDisabilitare:!0}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.portlet.controller.PortletStd",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"PortletStd",selector:this.selContainer+"#PortletStd"},{ref:"CntPortletDe",selector:this.selContainer+"#CntPortletDe"}]);this.control(this.selContainer+"#PortletStd",{afterrender:this.afterrenderPortlet,resize:this.resizePortletStd})},resizePortletStd:function(a){this.cbaConfig.controllerWebPortal.fireEvent("updateLayoutDh")},
afterrenderPortlet:function(a){this.gestorePortlet&&this.gestisciPortlet(this.gestorePortlet)},gestisciPortlet:function(a){var b=this;b.controllerContenuto=a.controllerContenuto;var c=b.getPortletStd().up(b.cbaConfig.viewPortlet),d=c.getHeader();d.removeAll();d.addCls("css-header-portlet");var e=0;if(!Ext.isEmpty(b.cbaConfig.iconaPortlet)){var f=Ext.create("Ext.Img",{itemId:"IconaPortlet",cls:"default-icons-css-24 "+b.cbaConfig.iconaPortlet+" css-bianco",margin:"0 3 0 0"});d.insert(e++,f)}b.cbaConfig.titoloPortlet=
b.cbaConfig.isDescrPersonalizzata?b.cbaConfig.titoloPortlet:traduci(b.cbaConfig.titoloPortlet);f=Ext.create("Ext.form.Label",{itemId:"LabelTitoloWinCss",cls:"cbaCssLabelTitolo",text:b.cbaConfig.titoloPortlet,style:{"white-space":"nowrap","text-overflow":"ellipsis",display:"block"},flex:1,margin:"0 10 0 0",listeners:{render:function(a){if(b.cbaConfig.isDescrPersonalizzata)a.getEl().on("dblclick",function(){var c=a.getX()+a.getWidth()+10,d=a.getY();Ext.create("winCBA",{titolo:traduci("TITOLO_ORIG_PORTLET"),
altezzaWin:70,larghezzaWin:200,maximizable:!1,closable:!0,x:c,y:d,name:{xtype:"container",cls:"cbaCssLabel",margin:"5 5 5 5",items:[{xtype:"container",layout:{align:"middle"},html:b.cbaConfig.descrStandardPortlet}]}}).show()})}}});d.insert(e++,f);a.switchModeOptions&&0<a.switchModeOptions.length&&(f=Ext.create("Ext.slider.Single",{flex:1,margin:"0 2 0 2",value:0,increment:1,minValue:0,maxValue:a.switchModeOptions.length-1,useTips:!1,style:{cursor:"pointer"},listeners:{change:function(c,d){a.switchModeOptions[d].callbackFn();
c.up("container").setStyle("border-bottom-color",a.switchModeOptions[d].color);b.cbaConfig.valoreSwitch3D=d;b.cbaConfig.controllerWebPortal.fireEvent("updateLayoutDh")},afterrender:function(c){b.cbaConfig.valoreSwitch3D?(c.setValue(b.cbaConfig.valoreSwitch3D),b.cbaConfig.valoreSwitch3D=b.cbaConfig.valoreSwitch3D):a.switchModeValue&&(c.setValue(a.switchModeValue),b.cbaConfig.valoreSwitch3D=a.switchModeValue)}}}),d.insert(e++,Ext.create("Ext.container.Container",{layout:{type:"hbox",align:"stretch",
pack:"center"},width:15*a.switchModeOptions.length+4,margin:"0 8 0 0",style:{"border-bottom":"4px solid transparent !important"},items:[f],listeners:{afterrender:function(b){var c=[];Ext.each(a.switchModeOptions,function(a){c.push({xtype:"label",cls:a.classeAlternativa||"cbaCssLabel",text:"- "+a.descrizione})});var d=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"image",src:"/cba/css/generali/images/generali/slide-demo.gif",maxWidth:92,height:31,listeners:{afterrender:function(a){}}},
{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},title:traduci("OPZIONI"),items:c}]});creaToolTipBubble(b.getId(),"",traduci("TRASCINA_PER_CAMBIARE_MODALITA"),!1,210,d)}}})));a.abilitaBtnNuovo&&d.insert(e++,Ext.create("Ext.Img",{itemId:"IcnCreate",src:"/cba/css/generali/images/generali/plus-css.svg",height:16,width:16,margin:"0 8 0 0",listeners:{afterrender:function(a){a=a.getEl();a.on("click",function(){b.controllerContenuto.fireEvent("apriPortlet",!1,!0)});a.setStyle("cursor","pointer");creaToolTipBubble(a,
traduci("CS_PORTLET_NUOVA_REG"))}}}));a.abilitaBtnFlashView&&d.insert(e++,Ext.create("Ext.Img",{itemId:"IcnSuperView",src:"/cba/css/generali/images/generali/plus-css.svg",height:16,cls:"css-arancio",width:16,margin:"0 8 0 0",listeners:{afterrender:function(a){a=a.getEl();a.on("click",function(){b.controllerContenuto.fireEvent("eventSpecialButton")});a.setStyle("cursor","pointer")}}}));a.abilitaBtnVisualizza&&d.insert(e++,Ext.create("Ext.Img",{itemId:"IcnDetails",src:"/cba/css/generali/images/generali/open-details.svg",
height:16,width:16,margin:"0 8 0 0",listeners:{afterrender:function(a){a=a.getEl();a.on("click",function(){b.controllerContenuto.cbaConfig.openFromButton=!0;b.controllerContenuto.fireEvent("apriPortlet",!1,!1)});a.setStyle("cursor","pointer");creaToolTipBubble(a,traduci("CS_PORTLET_APRI"))}}}));if(a.bottoniAggiuntivi&&Ext.isArray(a.bottoniAggiuntivi)){var g=e;a.bottoniAggiuntivi.forEach(function(a){d.insert(g,a);g++;e++})}d.insert(e++,Ext.create("Ext.Img",{itemId:"IcnCollapse",hidden:this.cbaConfig.hideExpand,
src:"/cba/css/generali/images/generali/"+(c.getCollapsed()?"portlet-expand.svg":"portlet-collapse.svg"),height:16,width:16,listeners:{afterrender:function(d){d.getEl().setStyle("cursor","pointer");if(a.noExpand)creaToolTipBubble(d.getEl().id,"CS_NESSUN_ELEMENTO_VISUALIZZARE");else d.getEl().on("click",function(){var a=0!=c.getCollapsed();c.setCollapsed(!a);d.setSrc("/cba/css/generali/images/generali/"+(a?"portlet-collapse.svg":"portlet-expand.svg"));b.cbaConfig.controllerWebPortal.fireEvent("updateLayoutDh");
a?(caricaPortletCSS(b,!1,!0),b.cbaConfig.collapsedFromSchema=!1):b.cbaConfig.collapsedFromSchema=!0})}}}));d.setHeight(45);b.getCntPortletDe().getEl().on("dblclick",function(){if(CBA.moduli.modulo49.bloccaPortlet)return!1;if(b.usaEventoGrid)return b.usaEventoGrid=!1;b.controllerContenuto.fireEvent("apriPortlet",a.videataDefault,!1)});if(b.cbaConfig.collapsedFromSchema||a.portletCollapsed)b.getPortletStd().cbaConfig.collassa=!0,d.down("#IcnCollapse").setSrc("/cba/css/generali/images/generali/portlet-expand.svg");
Ext.defer(function(){if(b.cbaConfig.collapsedFromSchema||a.portletCollapsed)c.setCollapsed(!0),d.down("#IcnCollapse").setSrc("/cba/css/generali/images/generali/portlet-expand.svg")},50);b.apriPortletDiretto=function(a){Ext.defer(function(){a&&b.cbaConfig.extraParamsContenuto&&b.cbaConfig.extraParamsContenuto.listaVideate&&0<b.cbaConfig.extraParamsContenuto.listaVideate.length&&(b.videataAperturaDiretta=a);b.controllerContenuto.fireEvent("apriPortlet",!1,!1)},20)};a.altezzaDefault&&c.setHeight(a.altezzaDefault)},
onLaunch:function(){this.getPortletStd().controller=this;var a={},b=this.cbaConfig.extraParamsContenuto,c;for(c in b)a[c]=b[c];Ext.apply(a,{controllerPortlet:this});this.videataContenuto=Ext.create(this.cbaConfig.contenutoPortlet,{flex:1,layout:{type:"vbox",align:"stretch"},cbaConfig:a});this.getCntPortletDe().add(this.videataContenuto)},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.portlet.controller.WidgetStd",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"PortletStd",selector:this.selContainer+"#PortletStd"},{ref:"CntPortletDe",selector:this.selContainer+"#CntPortletDe"}]);this.control(this.selContainer+"#PortletStd",{afterrender:this.afterrenderPortlet,resize:this.resizePortletStd})},resizePortletStd:function(a,b,c,d,e,f){if("T"==this.mioWidget.abilitato){var g=
this.videataContenuto.down("#ContainerWidget").controller;g.resizePortlet&&g.resizePortlet(a,b,c,d,e,f);this.cbaConfig.controllerWebPortal.fireEvent("updateLayoutDh")}},afterrenderPortlet:function(a){this.gestoreWidget&&this.gestisciWidget(this.gestoreWidget)},gestisciWidget:function(a){var b=this;b.controllerContenuto=a.controllerContenuto;var c=b.colore,d=b.getPortletStd().up(b.cbaConfig.viewPortlet),e=d.getHeader(),f=d.items.items;e.removeAll();var g=0;if(!Ext.isEmpty(b.cbaConfig.iconaPortlet)){var h=
"prt-cba"==b.cbaConfig.iconaPortlet?Ext.create("Ext.Img",{itemId:"IconaPortlet",cls:"default-icons-css-24 "+b.cbaConfig.iconaPortlet,margin:"0 3 0 0"}):"light"==cbaCalcBrightness(c,!0)?Ext.create("Ext.Img",{itemId:"IconaPortlet",cls:"default-icons-css-24 "+b.cbaConfig.iconaPortlet+" css-nero",margin:"0 3 0 0"}):Ext.create("Ext.Img",{itemId:"IconaPortlet",cls:"default-icons-css-24 "+b.cbaConfig.iconaPortlet+" css-bianco",margin:"0 3 0 0"});e.insert(g++,h)}h=Ext.create("Ext.form.Label",{itemId:"LabelTitoloWinCss",
cls:"cbaCssLabelTitolo",html:"&nbsp"+traduci(b.cbaConfig.titoloPortlet)});e.insert(g++,h);e.insert(g++,Ext.create("Ext.toolbar.Fill"));if(a.bottoniAggiuntivi&&Ext.isArray(a.bottoniAggiuntivi)){var k=g;a.bottoniAggiuntivi.forEach(function(a){e.insert(k,a);k++;g++})}e.setHeight(45);b.getCntPortletDe().getEl().on("dblclick",function(){if(b.usaEventoGrid)return b.usaEventoGrid=!1;b.controllerContenuto.fireEvent("apriPortlet",a.videataDefault,!1)});a.altezzaDefault&&d.setHeight(a.altezzaDefault);d.setStyle("borderColor",
c);e.setStyle("backgroundColor",c);e.setStyle("borderColor",c);"light"==cbaCalcBrightness(c,!0)&&(e.down("label").removeCls("cbaCssLabelTitolo"),e.down("label").setStyle("color","#2f5f8f"),e.down("label").setStyle("font-size","20px"),e.down("label").setStyle("font-family","Oswald"));for(h=0;h<f.length;h++)f[h].cbaConfig.idPortlet==b.mioWidget.id&&(f[h].query("#ContainerWidget")[0].setStyle("background-color",c),d.setBodyStyle("border-color",c));"F"==b.mioWidget.abilitato&&d.hide()},onLaunch:function(){var a=
this;a.getPortletStd().controller=a;a.widget=a.cbaConfig.controllerWebPortal.widgetList;Ext.suspendLayouts();Ext.each(a.widget,function(b){a.cbaConfig.idPortlet==b.id&&(a.mioWidget=b,a.colore=b.coloreWidget,a.abilitato=b.abilitato)});var b={},c=a.cbaConfig.extraParamsContenuto,d;for(d in c)b[d]=c[d];Ext.apply(b,{controllerWidget:a});"T"==a.abilitato?(a.videataContenuto=Ext.create(a.cbaConfig.contenutoPortlet,{flex:1,layout:{type:"vbox",align:"stretch"},cbaConfig:b,border:0}),a.getCntPortletDe().add(a.videataContenuto)):
a.cbaConfig.viewPortlet.hide();Ext.resumeLayouts(!0)},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.portlet.view.PortletStd",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"PortletStd",reference:"PortletStd",header:!1,layout:{type:"vbox",align:"stretch"},flex:1,resizable:!1,collapsible:!1,border:0,tools:[],items:[{xtype:"container",itemId:"CntPortletDe",reference:"CntPortletDe",flex:1,layout:{type:"vbox",align:"stretch"}}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.portlet.view.WidgetStd",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",itemId:"PortletStd",reference:"PortletStd",header:!1,layout:{type:"vbox",align:"stretch"},flex:1,resizable:!1,collapsible:!1,border:0,tools:[],items:[{xtype:"container",itemId:"CntPortletDe",reference:"CntPortletDe",flex:1,layout:{type:"vbox",align:"stretch"},border:0}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.ricercaRapida.store.RicPortlets",{extend:"Ext.data.ArrayStore",fields:[{name:"id"},{name:"idBottone"}],autoDestroy:!0});Ext.define("GeneraliCS.ricercaRapida.store.RicRapida",{extend:"Ext.data.ArrayStore",fields:[{name:"id"},{name:"tipo"},{name:"codice"},{name:"titolo"},{name:"ricerca"}],autoDestroy:!0});Ext.define("GeneraliCS.ricercaRapida.store.RicVideate",{extend:"Ext.data.ArrayStore",fields:[{name:"id"},{name:"idPortlet"}],autoDestroy:!0});
Ext.define("GeneraliCS.schede.bina.controller.Bina",{extend:"GeneraliCS.standard.ControllerGenSchedeVal",parametriStampa:{url:"/cba/css/cs/ws/genCss/report/bina",titolo:"SCHEDE_VALUTAZIONE",hideXml:!0,hideCsv:!0,hideBtnStampaOnSecondaryWin:!0},init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:a+"#Form"},{ref:"BoxBottoni",selector:a+"#BoxBottoni"},{ref:"Note",selector:a+"#Note"},{ref:"BtnCollassaTutto",selector:a+"#BtnCollassaTutto"},{ref:"BtnEspandiTutto",
selector:a+"#BtnEspandiTutto"},{ref:"CntNote",selector:a+"#CntNote"},{ref:"TabPanel",selector:a+"#TabPanel"},{ref:"FieldInfoPunteggio",selector:a+"#FieldInfoPunteggio"},{ref:"CntCorpoDomande",selector:a+"#CntCorpoDomande"},{ref:"TotPunteggio",selector:a+"#TotPunteggio"},{ref:"CboxTipoValutaz",selector:a+"#CboxTipoValutaz"},{ref:"DescrizionePunteggio",selector:a+"#DescrizionePunteggio"},{ref:"CntUVG",selector:a+"#CntUVG"},{ref:"RadioUVG",selector:a+"#RadioUVG"},{ref:"Container",selector:a+"#Container"},
{ref:"LabelMesiScadenza",selector:a+"#LabelMesiScadenza"}]);this.control(a+"#TabPanel",{beforetabchange:this.beforetabchangeTabPanel});this.control(a+"#BtnCollassaTutto",{click:this.btnClickCollassaTutto});this.control(a+"#BtnEspandiTutto",{click:this.btnClickEspandiTutto});this.control(a+"#CboxTipoValutaz",{change:this.changeCboxTipoValutaz})},changeCboxTipoValutaz:function(a,b){var c=1===b;this.getCntUVG().setHidden(!c);c||this.getRadioUVG().setValueExclusive(!1)},beforetabchangeTabPanel:function(a,
b,c){a=this.getForm();if(-1!=b.getItemId().indexOf("TabAndamento")){if(a.isDirty()||!this.recordTestata)return msgShow("ATTENZIONE","COMPILARE_IL_TEST"),!1;this.abilitaDisabilitaBoxBottoni(!0);b.down().controller.generaGrafico()}else-1!=c.getItemId().indexOf("TabAndamento")&&this.abilitaDisabilitaBoxBottoni()},btnClickCollassaTutto:function(a){this.GestioneEsapndiCollassa(a,"collassa")},btnClickEspandiTutto:function(a){this.GestioneEsapndiCollassa(a,"espandi")},GestioneEsapndiCollassa:function(a,
b){Ext.suspendLayouts();for(var c,d=this.getForm().query("[itemId=CntCorpoDomanda]"),e=0;e<d.length;e++)c=d[e].up().controller,c.apriPanel="espandi"==b,c.collassa(c.getCntIcona().down("image"));Ext.resumeLayouts(!0)},clickCopiaBINA:function(a){a=a?a:this;0<a.storeForm.getCount()?(a.testataSelezionata=!1,this.isCopia=!0,a.getForm().getForm().findField("id").setValue(-9999),bloccaFormCss(a.getForm(),!1,!0,[a.getPnlFunzioni()]),a.moduloCss||a.moduleCss1Exists()||a.moduleCss2Exists()||containerSolaLettura(a.getPnlCompilatore(),
!1)):Messaggio("ATTENZIONE","NESSUNA_REGISTRAZIONE_SELEZIONATA","OK","QUESTION")},gestioneForm:function(){var a=this,b=this,c=b.getForm();c.permesso=b.cbaConfig.permesso?b.cbaConfig.permesso:"L";c.boxBottoni=b.getBoxBottoni();b.storeForm=c.store=Ext.create("GeneraliCS.schede.bina.store.Bina");ImpostaUrl([b.storeForm]);c.controller=b;var d=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(a){b.cbaConfig.controllerTestata.nuovoDefault&&(b.aggiornamentoTestata=
!0,ImpostaNuovoDefault(b,!1));b.salvaForm(!1)},annulla_callback:function(){b.testataSelezionata||(b.aggiornamentoTestata=!0);b.cbaConfig.controllerTestata.nuovoDefault&&(b.aggiornamentoTestata=!0,ImpostaNuovoDefault(b,!1));b.aggiornaStore()},nuovo_callback:function(){controller_nuovoRecord(c);b.moduloCss&&b.getComboValidita().setValue(b.scadenzaDaImpoTest);bloccaFormCss(b.getForm(),!1,!0,[b.getPnlFunzioni()]);b.generaDomande(!1);b.moduloCss||b.moduleCss1Exists()||b.moduleCss2Exists()||containerSolaLettura(b.getPnlCompilatore(),
!1)},elimina_callback:function(){var a=c.getForm().findField("id").getValue();Ext.isEmpty(a)?Messaggio("ATTENZIONE","NESSUNA_REGISTRAZIONE_SELEZIONATA","OK","QUESTION"):controller_eliminaRecord(c.store,{id:a},function(){b.aggiornamentoTestata=!0;b.aggiornaStore()})},esci_callback:function(){b.moduloCss||b.controllerPortletFAR.updatePortlet();c.up("window").close()},verificaCampiForm_callback:function(){return b.verificaCampiForm()},noText:b.moduloCss,personIcons:b.moduloCss?getIconButtons():!1}});
inserisciBottoni(c.boxBottoni,d,!0);c.boxBottoni.down("panel").insert(2,{xtype:"button",itemId:"btnCopia",reference:"btnCopia",text:traduci("COPIA"),cls:b.moduloCss?"cbaCssBtnFunzione":"cba-button-25",tooltip:"COPIA_REGISTRAZIONE_SELEZIONATA",margin:"0 1 0 0",disabled:!0,handler:function(){b.onCopy=!0;b.clickCopiaBINA()}});d=c.boxBottoni.queryById("BtnStampa");d.show();b.configurePrintButton(d,"preview");b.moduloCss&&cssInsertCopyBtn(c.boxBottoni,2,b.clickCopiaBINA,b);b.moduloCss&&addSintesi(this.lookup("BoxBottoni"),
this);margineStdBtnFunzione(c.boxBottoni);if("S"==c.permesso)c.getForm().on("dirtychange",function(d,f){controller_abilitaBottoni(c);c.boxBottoni.queryById("btnEsci").setDisabled(f);c.boxBottoni.queryById("btnCopia").setDisabled(f);b.cbaConfig.controllerTestata.getContainerStorico().setDisabled(f);b.cbaConfig.controllerTestata.cbaConfig.controllerTestata.getCntMenu().setDisabled(f);var e=c.getForm().getFieldValues().id;if(f&&!cbaValidId(e))if(b.getCboxTipoValutaz().setValue(a.binaExists?2:1),b.moduloCss)if(b.getPnlCompilatore().setNuovoRecord(),
b.cbaConfig.controllerTestata.nuovoDefault)var h=setInterval(function(){b.stopInterval||Ext.isEmpty(b.scadenzaDaImpoTest)?b.stopInterval&&clearInterval(h):(b.getComboValidita().setValue(b.scadenzaDaImpoTest),clearInterval(h))},300);else b.isCopia||b.getComboValidita().isDirty()||b.getComboValidita().setValue(b.scadenzaDaImpoTest);else{e=b.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.compilatore;if(Ext.isEmpty(e.idCompilatore))b.getPnlCompilatore().setLabelCompilatore("");else{var k=
Ext.isEmpty(e.figuraProfessionale)?"":" ("+e.figuraProfessionale+")";b.getPnlCompilatore().down("#LabelCompilatore").setText(e.nominativo+k)}b.getPnlCompilatore().setDataRegistrazione(new Date);b.getPnlCompilatore().setOraRegistrazione(new Date)}});if(!b.moduloCss)return!1;cssCaricaImpoVideata(b,"GeneraliCS.schede.store.Impostazioni",function(a,b){Ext.isEmpty(b)||(a.scadenzaDaImpoTest=b.get("scadenza"));a.stopInterval=Ext.isEmpty(b.get("scadenza"))})},salvaForm:function(a){var b=this.getForm(),c=
b.getForm().getFieldValues();delete c.dataRegAppo;delete c.oraRegAppo;c.id=parseInt(c.id);this.aggiornamentoTestata=!0;cssFiltriStdOff(this);this.salvataggioRecord=!0;this.dataRecord=this.getPnlCompilatore().getDataOraReg();Ext.apply(c,{compilatore:this.cbaConfig.controllerTestata.compilatore,data:this.getPnlCompilatore().getDataOraReg(),codUtente:Ext.isDefined(CBA.moduli.modulo49.storeAnagraficaSel)?CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.codOspite:this.cbaConfig.anagraficaCorrente.codOspite,
idRicovero:this.idRicovero,puntConv:"T"});setRecordAgenda(c,this);Ext.isDefined(this.cbaConfig.anagraficaCorrente.idRicoveroCu)&&(this.cbaConfig.anagraficaCorrente.idRicovero||delete c.idRicovero,Ext.apply(c,{idRicoveroCu:this.cbaConfig.anagraficaCorrente.idRicoveroCu}));Ext.apply(c,{recordModificato:0>c.id?"T":c.recordModificato});controller_salvaRecord(b,c,!1,!1,!0)&&a&&this.callbackEsci&&this.callbackEsci()},controllaCampiTest:function(){Ext.suspendLayouts();var a=!0,b,c=[],d=this.getForm().getForm().getFieldValues(),
e,f=this.getCntCorpoDomande().query("[itemId=CntCorpoDomanda]");this.testValido=!0;for(var g=0;g<=f.length-1;g++)if(b=f[g].up().controller,e=b.cbaConfig.domanda.data.risposta,9!=b.cbaConfig.domanda.data.ordine||this.pre2012)Ext.isEmpty(e)?(this.testValido=!1,b.getPanelRisposte().up().addCls("cbaCssBordoErrore"),msgAddError(c,"Campo "+traduci(b.cbaConfig.domanda.data.descrDomanda)+" non compilato</br>"),a&&(b.getCntCorpoDomanda().focusable=!0,b.getCntCorpoDomanda().focus(),a=!1),b.apriPanel=!0):b.apriPanel=
!1,11==b.cbaConfig.domanda.data.ordine&&100==b.cbaConfig.domanda.data.risposta&&(e=b.getPanelRisposte().down("#RadioOccupazionali"))&&Ext.Object.isEmpty(e.getValue())&&(e.focusable=!0,e.focus(),b.getPanelRisposte().down("#RadioOccupazionali").addCls("cbaCssBordoErrore"),msgAddError(c,"Campo "+traduci(b.cbaConfig.domanda.data.descrDomanda)+" non compilato</br>"),b.apriPanel=!0),b.collassa(b.getCntIcona().down("image"));1===this.getCboxTipoValutaz().getValue()&&Ext.isEmpty(this.getRadioUVG().getValueExclusive())&&
msgAddError(c,"MSG_ERRORE_CONFERMA_VALUTAZIONE_UVG");this.pre2012||this.verificaTrattamenti(d,c);Ext.resumeLayouts(!0);return c},verificaTrattamenti:function(a,b){var c=this.getForm().down("#CntTrattamenti");if(!c.abilitaTrattamenti)return!1;c.up("#PanelRisposte").up("#CntCorpoDomanda");var d=!1,e=0,f=!1,g=!1,h=[],k=null;c.query("radiogroup").forEach(function(a){if(Ext.Object.isEmpty(a.getValue()))return d=!0,!1;e=a.getValue()[Ext.Object.getAllKeys(a.getValue())[0]];if(0!=e){if(k&&(valRadioPrec=k.getValue()[Ext.Object.getAllKeys(k.getValue())[0]],
0==valRadioPrec)){g=!0;return}if(Ext.Array.contains(h,e)){f=!0;return}h.push(e)}k=a});if(d)return msgAddError(b,"Campo "+traduci("TRATTAMENTI")+" non compilato</br>"),this.getForm().down("#CntTrattamenti").up("#PanelRisposte").up().addCls("cbaCssBordoErrore"),!1;g&&(msgAddError(b,"Dei trattamenti con numero precedente non sono stati avvalorati"),this.getForm().down("#CntTrattamenti").up("#PanelRisposte").up().addCls("cbaCssBordoErrore"));f&&(msgAddError(b,"Campo "+traduci("TRATTAMENTI")+" ci sono almeno due trattamenti con lo stesso valore </br>"),
this.getForm().down("#CntTrattamenti").up("#PanelRisposte").up().addCls("cbaCssBordoErrore"))},verificaCampiForm:function(){var a=this,b=[],c=a.getForm().down("datefield");(c=c.validator(c))&&Ext.isString(c)&&msgAddError(b,c);b=a.controllaCampiTest();if(0<b.length)return msgShow("",b);if(!a.moduloCss&&a.dataInizioPratica&&0==a.cbaConfig.controllerTestata.storeRegistrazioni.count())if(b=Ext.clone(Ext.Date.subtract(a.dataInizioPratica,Ext.Date.DAY,-15)),a.getPnlCompilatore().down("datefield").getValue()>
b)Messaggio("ATTENZIONE","MSG_DATAVALUTAZIONE_OUT_OF_DATE","YESNO","QUESTION",!1,function(){a.salvaForm(!1)});else return!0;else return!0},aggiornaStore:function(a){var b=this,c=this;if(c.aggiornamentoTestata)c.aggiornamentoTestata=!1,c.cbaConfig.controllerTestata.aggiornaStore(a);else if(clearForm(c.getForm()),c.getPnlCompilatore().setLabelCompilatore(""),c.moduloCss||this.bloccaCmpSchedaBina((this.moduleCss1Exists()||this.moduleCss2Exists())&&c.areaValutazioneExists),a||c.testataSelezionata){var d=
c.getForm(),e=d.getForm();c.storeForm.load({params:{id:a?a:c.testataSelezionata},callback:function(a,g,h){if(h){var f=a[0];Ext.isEmpty(f)||(e.setValues({dataRegAppo:f.get("data"),oraRegAppo:f.get("data")}),c.generaDomande(f,function(){e.loadRecord(f);var a="L"==d.permesso?!0:cssHasBloccoModifica(c.recordTestata.get("tipoBlocco"));c.moduloCss||(b.moduleCss1Exists()||b.moduleCss2Exists()||(c.getPnlCompilatore().down("datefield").setReadOnly(!1),c.getPnlCompilatore().down("timefield").setReadOnly(!1),
a=!1),b.bloccaCmpSchedaBina((b.moduleCss1Exists()||b.moduleCss2Exists())&&c.areaValutazioneExists));bloccaFormCss(d,a,!1,[c.getPnlFunzioni()]);containerSolaLettura(c.getPnlCompilatore(),a);if(!c.pre2012){var g=c.getCntCorpoDomande().down("#CntTrattamenti"),h=g.up("#CntCorpoDomanda").up().controller;a||h.fnAbilitaRadioTrattamenti(g.abilitaTrattamenti,!1)}}),(b.moduleCss1Exists()||b.moduleCss2Exists())&&b.setValiditaPerDatiConvertiti(f.data.scadenza,f.data.mesiScadenza),c.salvaStatoBottoni(),c.getPnlCompilatore().setLabelCompilatore(""),
0!=f.get("compilatore")&&(a=f.get("compilatoreNominativo"),g=Ext.isEmpty(f.get("compilatoreFigProf"))?"":" ("+f.get("compilatoreFigProf")+")",c.getPnlCompilatore().setLabelCompilatore(a+g)),initAgenda(f,c))}else msgShowError("",g.getError())}})}else c.generaDomande(!1),calcolaDataDiScadenza(!1,!1,c.getInfoScadenza())},aggiornaLabelPunteggio:function(a){var b=a?a:this,c="";b.vettorePunteggi&&Ext.each(b.vettorePunteggi,function(a){b.punteggioTest<=a.data.punteggioMax&&b.punteggioTest>=a.data.punteggioMin&&
(c=a.data.descrizione)});b.getTotPunteggio().setHtml("Tot.Punteggio: "+b.punteggioTest+"/"+b.totalePunteggio);b.getDescrizionePunteggio().setHtml(c)},generaDomande:function(a,b){var c=this;Ext.suspendLayouts();c.punteggioTest=0;var d=null;c.getCntCorpoDomande().removeAll();c.pre2012=a?2012>(new Date(a.get("data"))).getFullYear():!1;c.storeBina.each(function(b,f){var e=b.data.descrDomanda;c.pre2012&&b.data.descrDomandaPre2012&&(e=b.data.descrDomandaPre2012);d=Ext.create("GeneraliCS.schede.bina.view.Dettaglio",
{cbaConfig:{domanda:b,testoDomanda:e,record:a,pre2012:c.pre2012,controllerMain:c}});c.getCntCorpoDomande().add(d)});c.aggiungiCampoNote();c.aggiornaLabelPunteggio();Ext.resumeLayouts(!0);b&&b()},aggiungiCampoNote:function(){var a={xtype:"container",flex:1,itemId:"CntNote",reference:"CntNote",margin:"20 0 0  0",padding:10,items:[{xtype:"cbaFieldsetHtmlEditor",height:200,title:traduci("NOTE"),itemId:"Note",reference:"Note",cbaConfig:{name:"note"}}]};this.getCntCorpoDomande().add(a)},checkBinaExists:function(){var a=
this,b={};if(Ext.isDefined(CBA.moduli.modulo49.storeAnagraficaSel)){var c=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero;Object.assign(b,{idRicoveroCss:c})}else Ext.isDefined(this.cbaConfig.anagraficaCorrente.idRicoveroCu)&&Object.assign(b,{idRicoveroCu:this.cbaConfig.anagraficaCorrente.idRicoveroCu});Ext.Ajax.request({method:"GET",url:(this.moduloCss?"/cba/css/cs":"/cba/osp/far")+"/ws/genCss/skval/bina/exists",params:b,success:function(b){b=Ext.JSON.decode(b.responseText);b.success?
a.binaExists=b.data:msgShowError("",b.message)}})},moduleCss1Exists:function(){return CBA.moduli.modulo38.abilitato&&CBA.moduli.modulo38.installato},moduleCss2Exists:function(){return CBA.moduli.modulo49.abilitato&&CBA.moduli.modulo49.installato},bloccaCmpSchedaBina:function(a){var b=this;["btnCopia","btnNuovo","btnElimina","btnConferma"].forEach(function(c){(c=b.getContainer().queryById(c))&&c.setHidden(a)})},setValiditaPerDatiConvertiti:function(a,b){var c=Ext.isEmpty(a)&&!Ext.isEmpty(b);this.getComboValidita().setHidden(c);
this.getLabelMesiScadenza().setHidden(!c);this.getInfoScadenza().setHidden(c);c&&(b=b||0,this.getLabelMesiScadenza().update(traduci("VALIDITA")+": <b>"+b+" mesi/e</b>"))},onLaunch:function(){var a=this,b=this;this.binaExists=!1;b.punteggioTest=0;b.totalePunteggio=1E3;b.moduloCss=49==CBA.moduli.moduloAttivo;b.storeBina=Ext.create("GeneraliCS.schede.bina.store.StoreDati");b.getForm().controller=b;b.cbaConfig.tipoTestata="Bina";b.cbaConfig.testataGen=!0;b.idProfilo=CBA.parametriGenerali.idProfiloCss;
b.moduloCss||(b.cbaConfig.controllerTestata.cbaConfig.controllerTestata.getCntMenu().setHidden(!0),b.lookup("CssAgenda").down("cbaMultipleChoice").setHidden(!0),Ext.isDefined(b.cbaConfig.controllerTestata)&&Ext.isDefined(b.cbaConfig.controllerTestata.cbaConfig.controllerTestata)&&Ext.isDefined(b.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.dataInizioPratica)&&(b.dataInizioPratica=b.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.dataInizioPratica),b.areaValutazioneExists=
b.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.areaValutazioneExists,b.controllerPortletFAR=b.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.controllerPortlet);this.getComboValidita().setHidden(!this.moduleCss1Exists()&&!this.moduleCss2Exists());this.getInfoScadenza().setHidden(!this.moduleCss1Exists()&&!this.moduleCss2Exists());this.lookup("CssAgenda").down("cbaMultipleChoice").setHidden(!this.moduleCss1Exists()&&!this.moduleCss2Exists());b.idRicovero=Ext.isDefined(CBA.moduli.modulo49.storeAnagraficaSel)?
CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero:null;Ext.isDefined(b.cbaConfig.anagraficaCorrente.idRicoveroCu)&&(b.cbaConfig.controllerTestata.compilatore=b.cbaConfig.controllerTestata.cbaConfig.controllerTestata.cbaConfig.compilatore.idCompilatore,b.idRicovero=b.cbaConfig.anagraficaCorrente.idRicovero,b.getFieldInfoPunteggio().setMargin("0 0 0 3"));var c=new Ext.data.ArrayStore({fields:["codice","valore"],data:[[1,traduci("VALUTAZIONE_IMMISSIONE")],[2,traduci("RIVALUTAZIONE_PERIODICA")],
[3,traduci("RIVALUTAZIONE_STRAORDINARIA")]],autoLoad:!0});b.getCboxTipoValutaz().setStore(c);this.checkBinaExists();b.gestioneForm();this.lookup("CssAgenda").prepare({getPnlCompilatore:function(){return a.lookup("PnlCompilatore")}});b.caricaValidita();b.caricaStoreExtraDati();b.caricaPunteggio(function(a){b.aggiornaLabelPunteggio()});b.getPnlCompilatore().on("afterrender",function(a){b.moduloCss||(a.removeCls("cbaCssPnlCompilatore"),a.addCls("skvalTemaFarMode"))});cssSetAnnullabile(b);b.aggiornaDaTestata=
!0},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliCS.schede.bina.controller.Dettaglio",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"PanelRisposte",selector:a+"#PanelRisposte"},{ref:"CntCorpoDomanda",selector:a+"#CntCorpoDomanda"},{ref:"CntIcona",selector:a+"#CntIcona"}]);this.control(a+"#CntCorpoDomanda",{afterrender:this.afterenderCntDomandeDe})},afterenderCntDomandeDe:function(a){(this.apriPanel=Ext.isEmpty(this.cbaConfig.domanda.data.risposta))||
this.collassa()},gestioneSelezione:function(a,b){var c=this.getCntCorpoDomanda().down("textfield"),d=this.getCntCorpoDomanda().down("image");Ext.suspendLayouts();this.cbaConfig.domanda.data.risposta==a.punteggio?(a.removeCls("cbaCssRispostaSelezionata"),b=0,c.setValue(""),this.cbaConfig.domanda.data.risposta=null,this.apriPanel=!0,this.collassa(d)):(Ext.each(this.getPanelRisposte().items.items,function(a){a.removeCls("cbaCssRispostaSelezionata")}),a.addCls("cbaCssRispostaSelezionata"),c.setValue(b),
this.cbaConfig.domanda.data.risposta=b);a.up().up().removeCls("cbaCssBordoErrore");Ext.resumeLayouts(!0);this.cbaConfig.domanda.data.nascondiPunteggio||this.aggiornaPunteggio(b)},collassa:function(a){var b=this;a&&a.setSrc("/cba/css/generali/images/generali/"+(1==b.apriPanel?"portlet-collapse.svg":"portlet-expand.svg"));Ext.suspendLayouts();Ext.each(b.cbaConfig.domanda.data.risposte,function(a){var c=b.getPanelRisposte().query("[punteggio="+a.punteggio+"]"),e=!b.cbaConfig.pre2012&&b.cbaConfig.domanda.data.nascondiCollapse;
e||b.apriPanel||a.punteggio==b.cbaConfig.domanda.data.risposta?b.apriPanel&&!e&&c[0].show():c[0].hide()});Ext.resumeLayouts(!0)},setValueRadioGroup:function(a){a.forEach(function(a){var b=a.getBoxes()[0].name,d={};d[b]=0;a.setValue(d)})},gestisciTrattamenti:function(a){if(!this.cbaConfig.pre2012){a=a.abilitaTrattamenti&&!Ext.isEmpty(this.cbaConfig.domanda.data.risposta);var b=this.cbaConfig.controllerMain.getForm().down("#CntTrattamenti");this.fnAbilitaRadioTrattamenti(a);this.resetRadioGroup(b.query("radiogroup"));
a?this.setValueRadioGroup(b.query("radiogroup")):b.up("#PanelRisposte").up().removeCls("cbaCssBordoErrore");b.abilitaTrattamenti=a}},aggiornaPunteggio:function(a){var b=this.cbaConfig.controllerMain;b.punteggioTest=b.punteggioTest?b.punteggioTest-(Ext.isEmpty(this.punteggioDomanda)?0:this.punteggioDomanda)+(Ext.isEmpty(a)?0:a):Ext.isEmpty(a)?0:a;this.punteggioDomanda=a;b&&b.getTotPunteggio()&&b.aggiornaLabelPunteggio&&b.aggiornaLabelPunteggio(b)},fnAbilitaRadioTrattamenti:function(a,b){Ext.suspendLayouts();
var c=b?b.getCntTrattamenti():this.cbaConfig.controllerMain.getForm().down("#CntTrattamenti");c.query("radiogroup").forEach(function(b){b.setReadOnly(!a)});a?c.removeCls("css-grigio"):c.addCls("css-grigio");Ext.resumeLayouts(!0)},resetRadioGroup:function(a){a.forEach(function(a){a.items.items.forEach(function(a){a.setValue(!1)})})},generaIcona:function(a){var b=this;b.getCntIcona().add(Ext.create("Ext.Img",{itemId:"IcnCollapse",src:"/cba/css/generali/images/generali/"+(Ext.isEmpty(a.risposta)?"portlet-collapse.svg":
"portlet-expand.svg"),height:20,hidden:a.nascondiCollapse&&!b.cbaConfig.pre2012,width:20,nonDisabilitare:!0,listeners:{afterrender:function(a){a.getEl().on("click",function(){"S"==b.cbaConfig.controllerMain.getForm().permesso&&(b.apriPanel?(b.apriPanel=!1,a.setSrc("/cba/css/generali/images/generali/portlet-expand.svg")):(b.apriPanel=!0,a.setSrc("/cba/css/generali/images/generali/portlet-collapse.svg")),b.collassa(a))});a.getEl().setStyle("cursor","pointer")}}}))},setLabelInfoTrattamenti:function(){var a=
Ext.create("Ext.form.Label",{});this.cbaConfig.pre2012?a.setHtml(traduci("TRATTAMENTI_DESCR_PRE")):a.setHtml(traduci("TRATTAMENTI_DESCR_POST"));this.getCntCorpoDomanda().down("#CntDescrDomanda").add(a)},onLaunch:function(){var a=this;Ext.suspendLayouts();a.punteggioDomanda=0;a.apriPanel=!1;a.getCntCorpoDomanda().ordine=a.cbaConfig.domanda.data.ordine;a.cbaConfig.domanda.data.risposta=a.cbaConfig.record.data?a.cbaConfig.record.data[a.cbaConfig.domanda.data.name]:null;a.generaIcona(a.cbaConfig.domanda.data);
9==a.cbaConfig.domanda.data.ordine&&a.setLabelInfoTrattamenti();a.cbaConfig.pre2012||9!=a.cbaConfig.domanda.data.ordine?Ext.each(a.cbaConfig.domanda.data.risposte,function(b){var c=b.testoRisp;a.cbaConfig.pre2012&&b.testoRispPre2012&&(c=b.testoRispPre2012);if(!a.cbaConfig.pre2012&&b.abilitaRadio){var d=Ext.create("Ext.container.Container",{padding:10}),e=Ext.create("Ext.form.RadioGroup",{margin:"0 0 0 180",itemId:"RadioOccupazionali",columns:1,style:"border: 1px solid #C3DAF9; border-radius: 4px",
width:230,hidden:!a.cbaConfig.record||100!=a.cbaConfig.record.data.attivitaImpiegoTempo,vertical:!0,items:[{boxLabel:traduci("BINA_11_RISP_5_POST2012"),name:"attivitaImpiegoTempoRifiuto",inputValue:"1"},{boxLabel:traduci("BINA_11_RISP_6_POST2012"),name:"attivitaImpiegoTempoRifiuto",inputValue:"2"}],listeners:{change:function(a,b,c){a.removeCls("cbaCssBordoErrore")}}});d.add(e)}c=Ext.create("Ext.container.Container",{punteggio:b.punteggio,cls:b.punteggio==a.cbaConfig.domanda.data.risposta?"cbaCssRispostaSelezionata":
"",padding:6,layout:{type:"hbox",align:"center"},flex:1,margin:"0 0 8 0",items:[{xtype:"container",flex:1,items:[{xtype:"label",text:traduci(c)}]},{xtype:"container",style:"display: "+(a.cbaConfig.domanda.data.nascondiPunteggio?"none":"visible"),layout:{type:"hbox",align:"center"},width:60,items:[{xtype:"container",width:50,height:30,cls:"cbaCssPunteggioRisposta",html:'<p style="text-align:center;">'+b.punteggio+"</p>"}]}],listeners:{afterrender:function(c){c.getEl().on("click",function(){var d=a.cbaConfig.controllerMain,
e=d.recordTestata;"S"==d.getForm().permesso&&(!e||e&&!cssHasBloccoModifica(e.get("tipoBlocco"))||0>d.getForm().getForm().findField("id").getValue())&&(a.gestioneSelezione(c,b.punteggio),11==a.cbaConfig.domanda.data.ordine&&(d=1==b.abilitaRadio&&!Ext.isEmpty(a.cbaConfig.domanda.data.risposta),e=c.up("#PanelRisposte").down("#RadioOccupazionali"),e.setHidden(!d),d||a.resetRadioGroup([e])),8==a.cbaConfig.domanda.data.ordine&&a.gestisciTrattamenti(b))});c.setStyle("cursor","pointer")}}});b.punteggio==
a.cbaConfig.domanda.data.risposta&&(a.cbaConfig.domanda.data.nascondiPunteggio||a.aggiornaPunteggio(b.punteggio));a.getPanelRisposte().add(c);d&&a.getPanelRisposte().add(d)}):a.getPanelRisposte().add(Ext.create("GeneraliCS.schede.bina.view.Trattamenti",{fnAbilitaRadioTrattamenti:[a.fnAbilitaRadioTrattamenti,a.cbaConfig.record&&100==a.cbaConfig.record.data.necessitaPrestSan],layout:{type:"vbox",align:"stretch"},flex:1}));Ext.resumeLayouts(!0)}});
Ext.define("GeneraliCS.schede.bina.controller.Trattamenti",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntTrattamenti",selector:a+"#CntTrattamenti"}]);this.control(a+"#CntTrattamenti",{afterrender:this.afterrenderCntTrattamenti})},afterrenderCntTrattamenti:function(){this.fnAbilitaRadioTrattamenti&&(this.fnAbilitaRadioTrattamenti[0](this.fnAbilitaRadioTrattamenti[1],this),this.getCntTrattamenti().abilitaTrattamenti=
this.fnAbilitaRadioTrattamenti[1])},onLaunch:function(){this.getCntTrattamenti().controller=this;this.getCntTrattamenti().query("radiogroup").forEach(function(a){a.addListener("change",function(a){a.up("#PanelRisposte").up().removeCls("cbaCssBordoErrore")})})},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.schede.bina.store.Bina",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"codUtente"},{name:"data",type:"date"},{name:"idValutazazioneUtente"},{name:"tipoValutazione"},{name:"compilatore"},{name:"medicazioni"},{name:"necessitaPrestSan"},{name:"ctrlSfint"},{name:"distComport"},{name:"comunicazione"},{name:"deficitSens"},{name:"mobilita"},{name:"attivitaVitaQuot"},{name:"attivitaImpiegoTempo"},{name:"reteSociale"},{name:"trattamentiSpecialist"},{name:"note"},{name:"mesiScadenza"},
{name:"nonSomministrabile"},{name:"confermaValutazioneUvg"},{name:"trattamentiSpecialist2"},{name:"trattamentiSpecialist3"},{name:"trattamentiSpecialist4"},{name:"trattamentiSpecialist5"},{name:"idRicovero"},{name:"scadenza"},{name:"agenda"},{name:"slider"},{name:"compilatoreNominativo"},{name:"compilatoreFigProf"},{name:"recordModificato"},{name:"puntConv"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/genCss/skval/bina/get",urlGen:"/ws/genCss/skval/bina/get",api:{read:"/cba/css/cs/ws/genCss/skval/bina/get",
create:"/cba/css/cs/ws/genCss/skval/bina/new",update:"/cba/css/cs/ws/genCss/skval/bina/update",destroy:"/cba/css/cs/ws/genCss/skval/bina/delete"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.schede.bina.store.StoreDati",{extend:"Ext.data.ArrayStore",fields:[{name:"ordine"},{name:"descrDomanda"},{name:"name"},{name:"descrDomandaPre2012"},{name:"risposte"},{name:"nascondiCollapse"},{name:"nascondiPunteggio"}],data:[[1,"BINA_1_POST2012","attivitaVitaQuot","BINA_1_PRE2012",[{testoRisp:"BINA_1_RISP_1_POST2012",punteggio:10,ordine:1},{testoRisp:"BINA_1_RISP_2_POST2012",testoRispPre2012:"BINA_1_RISP_2_PRE2012",punteggio:20,ordine:2},{testoRisp:"BINA_1_RISP_3_POST2012",
testoRispPre2012:"BINA_1_RISP_3_PRE2012",punteggio:50,ordine:3},{testoRisp:"BINA_1_RISP_4_POST2012",punteggio:100,ordine:4}]],[2,"BINA_2_POST2012","mobilita",null,[{testoRisp:"BINA_2_RISP_1_POST2012",punteggio:10,ordine:1},{testoRisp:"BINA_2_RISP_2_POST2012",testoRispPre2012:"BINA_2_RISP_2_PRE2012",punteggio:30,ordine:2},{testoRisp:"BINA_2_RISP_3_POST2012",testoRispPre2012:"BINA_2_RISP_3_PRE2012",punteggio:80,ordine:3},{testoRisp:"BINA_2_RISP_4_POST2012",testoRispPre2012:"BINA_2_RISP_4_PRE2012",punteggio:100,
ordine:4}]],[3,"BINA_3_POST2012","comunicazione",null,[{testoRisp:"BINA_3_RISP_1_POST2012",testoRispPre2012:"BINA_3_RISP_1_PRE2012",punteggio:10,ordine:1},{testoRisp:"BINA_3_RISP_2_POST2012",punteggio:30,ordine:2},{testoRisp:"BINA_3_RISP_3_POST2012",testoRispPre2012:"BINA_3_RISP_3_PRE2012",punteggio:70,ordine:3},{testoRisp:"BINA_3_RISP_4_POST2012",punteggio:100,ordine:4}]],[4,"BINA_4_POST2012","distComport","BINA_4_PRE2012",[{testoRisp:"BINA_4_RISP_1_POST2012",punteggio:10,ordine:1},{testoRisp:"BINA_4_RISP_2_POST2012",
testoRispPre2012:"BINA_4_RISP_2_PRE2012",punteggio:50,ordine:2},{testoRisp:"BINA_4_RISP_3_POST2012",testoRispPre2012:"BINA_4_RISP_3_PRE2012",punteggio:80,ordine:3},{testoRisp:"BINA_4_RISP_4_POST2012",testoRispPre2012:"BINA_4_RISP_4_PRE2012",punteggio:100,ordine:4}]],[5,"BINA_5_POST2012","deficitSens",null,[{testoRisp:"BINA_5_RISP_1_POST2012",punteggio:10,ordine:1},{testoRisp:"BINA_5_RISP_2_POST2012",punteggio:20,ordine:2},{testoRisp:"BINA_5_RISP_3_POST2012",punteggio:80,ordine:3},{testoRisp:"BINA_5_RISP_4_POST2012",
punteggio:100,ordine:4}]],[6,"BINA_6_POST2012","ctrlSfint",null,[{testoRisp:"BINA_6_RISP_1_POST2012",punteggio:10,ordine:1},{testoRisp:"BINA_6_RISP_2_POST2012",testoRispPre2012:"BINA_6_RISP_2_PRE2012",punteggio:30,ordine:2},{testoRisp:"BINA_6_RISP_3_POST2012",testoRispPre2012:"BINA_6_RISP_3_PRE2012",punteggio:70,ordine:3},{testoRisp:"BINA_6_RISP_4_POST2012",testoRispPre2012:"BINA_6_RISP_4_PRE2012",punteggio:100,ordine:4}]],[7,"BINA_7_POST2012","medicazioni",null,[{testoRisp:"BINA_7_RISP_1_POST2012",
punteggio:10,ordine:1},{testoRisp:"BINA_7_RISP_2_POST2012",punteggio:30,ordine:2},{testoRisp:"BINA_7_RISP_3_POST2012",testoRispPre2012:"BINA_7_RISP_3_PRE2012",punteggio:40,ordine:3},{testoRisp:"BINA_7_RISP_4_POST2012",testoRispPre2012:"BINA_7_RISP_4_PRE2012",punteggio:100,ordine:4}]],[8,"BINA_8_POST2012","necessitaPrestSan",null,[{testoRisp:"BINA_8_RISP_1_POST2012",testoRispPre2012:"BINA_8_RISP_1_PRE2012",punteggio:10,ordine:1},{testoRisp:"BINA_8_RISP_2_POST2012",testoRispPre2012:"BINA_8_RISP_2_PRE2012",
punteggio:20,ordine:2},{testoRisp:"BINA_8_RISP_3_POST2012",punteggio:40,ordine:3},{testoRisp:"BINA_8_RISP_4_POST2012",testoRispPre2012:"BINA_8_RISP_4_PRE2012",punteggio:100,ordine:4,abilitaTrattamenti:!0}]],[9,"BINA_9_POST2012","trattamentiSpecialist",null,[{testoRisp:"BINA_9_RISP_1_PRE2012",punteggio:1,ordine:1},{testoRisp:"BINA_9_RISP_2_PRE2012",punteggio:2,ordine:2},{testoRisp:"BINA_9_RISP_3_PRE2012",punteggio:3,ordine:3},{testoRisp:"BINA_9_RISP_4_PRE2012",punteggio:4,ordine:4},{testoRisp:"BINA_9_RISP_5_PRE2012",
punteggio:5,ordine:5},{testoRisp:"BINA_9_RISP_6_PRE2012",punteggio:6,ordine:6},{testoRisp:"BINA_9_RISP_7_PRE2012",punteggio:7,ordine:7},{testoRisp:"BINA_9_RISP_8_PRE2012",punteggio:8,ordine:8},{testoRisp:"BINA_9_RISP_9_PRE2012",punteggio:9,ordine:9}],!0,!0],[10,"BINA_10_POST2012","reteSociale",null,[{testoRisp:"BINA_10_RISP_1_POST2012",punteggio:10,ordine:1},{testoRisp:"BINA_10_RISP_2_POST2012",punteggio:30,ordine:2},{testoRisp:"BINA_10_RISP_3_POST2012",testoRispPre2012:"BINA_10_RISP_3_PRE2012",punteggio:70,
ordine:3},{testoRisp:"BINA_10_RISP_4_POST2012",testoRispPre2012:"BINA_10_RISP_4_PRE2012",punteggio:100,ordine:4}]],[11,"BINA_11_POST2012","attivitaImpiegoTempo",null,[{testoRisp:"BINA_11_RISP_1_POST2012",testoRispPre2012:"BINA_11_RISP_1_PRE2012",punteggio:10,ordine:1},{testoRisp:"BINA_11_RISP_2_POST2012",punteggio:30,ordine:2},{testoRisp:"BINA_11_RISP_3_POST2012",punteggio:60,ordine:3},{testoRisp:"BINA_11_RISP_4_POST2012",testoRispPre2012:"BINA_11_RISP_4_PRE2012",punteggio:100,ordine:4,abilitaRadio:!0}]]],
autoLoad:!0,autoDestroy:!0});
Ext.define("GeneraliCS.schede.bina.view.Bina",{extend:"Generali.standard.ControlledContainer",uses:["Generali.standard.stampe.Button","CbaUtilsCss.componenti.desktop.CssAgenda"],initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",cls:"cbaCssPnlPopup",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni"},{xtype:"form",itemId:"Form",reference:"Form",cls:"cbaCssForm",trackResetOnLoad:!0,
border:!1,layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"textfield",hidden:!0,name:"id"},{xtype:"textfield",hidden:!0,name:"idValutazioneUtente"},{xtype:"textfield",hidden:!0,name:"recordModificato"},{xtype:"tabpanel",flex:1,margin:"3 0 0 0",itemId:"TabPanel",reference:"TabPanel",items:[{title:"TEST",autoScroll:!0,layout:{type:"vbox",align:"stretch"},flex:1,padding:5,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},
height:100,items:[{xtype:"fieldset",width:400,layout:{type:"vbox",align:"middle",pack:"center"},items:[{xtype:"combobox",minChars:0,width:350,allowBlank:!1,labelClsExtra:"cbaCssLabel",fieldLabel:"TIPO_VALUTAZIONE",name:"tipoValutazione",store:"",displayField:"valore",valueField:"codice",itemId:"CboxTipoValutaz",reference:"CboxTipoValutaz"}]},{xtype:"fieldset",hidden:!0,itemId:"CntUVG",reference:"CntUVG",layout:{type:"vbox",align:"stretch"},flex:1,title:"CONFERMA_VALUTAZIONE_UVG_DOMICILIO",items:[{xtype:"container",
flex:1,items:[{xtype:"label",cls:"cbaCssLabel",style:"text-align: center",text:"CONFERMA_VALUTAZIONE_UVG_DOMICILIO_TESTO"}]},{xtype:"cbaMultipleChoice",itemId:"RadioUVG",reference:"RadioUVG",style:"border: none !important;",layout:{type:"hbox",align:"middle",pack:"center"},flex:1,margin:"0 0 0 0",cbaConfig:{itemsCfg:[{html:"SI",margin:"0 0 0 0",style:"font-size: 16px !important;padding-left: 6px !important;",checkedClsPerson:"choice-checked-css",cls:"choice-round-unchecked-css-border2",name:"confermaValutazioneUvg",
isFormField:!0,inputValue:1},{html:"NO",margin:"0 0 0 15",style:"padding-left: 3px !important;font-size: 16px !important;",checkedClsPerson:"choice-checked-css",cls:"choice-round-unchecked-css-border2",name:"confermaValutazioneUvg",isFormField:!0,inputValue:2}],esclusivo:!0}}]}]}]},{xtype:"container",padding:10,margin:"0 0 20 0",itemId:"CntCorpoDomande",reference:"CntCorpoDomande"}]}]}],dockedItems:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"cssPanelCompilatore",itemId:"PnlCompilatore",
reference:"PnlCompilatore",docked:"top",cbaDataAllowBlank:!0,cbaOraAllowBlank:!0},{xtype:"container",itemId:"PnlFunzioni",reference:"PnlFunzioni",margin:"0 6 10 6",layout:{type:"hbox",align:"middle"},items:[{xtype:"fieldset",hidden:!0,itemId:"FieldMesiScadenza",reference:"FieldMesiScadenza",height:70,flex:1,layout:{type:"vbox",align:"center",pack:"center"},items:[{xtype:"label",itemId:"LabelMesiScadenza",reference:"LabelMesiScadenza",cls:"cbaCssLabel"}]},{xtype:"CssAgenda",height:70,nameFrequenze:"scadenza",
extraItems:[{xtype:"button",margin:"16 5 0 5",cls:"icon-cartella-btn-espandi",itemId:"BtnEspandiTutto",reference:"BtnEspandiTutto",style:"background:transparent;border:none",tooltip:"ESPANDI_TUTTO"},{xtype:"button",margin:"16 0 0 5",cls:"icon-cartella-btn-collassa",itemId:"BtnCollassaTutto",reference:"BtnCollassaTutto",style:"background:transparent;border:none;font-weight:bold",tooltip:"COLLASSA_TUTTO"}]},{xtype:"fieldset",itemId:"FieldInfoPunteggio",reference:"FieldInfoPunteggio",height:70,flex:1,
layout:{type:"vbox",align:"center",pack:"center"},items:[{xtype:"container",layout:{type:"hbox",align:"middle",pack:"center"},margin:"0 0 0 0",flex:1,items:[{xtype:"container",layout:{type:"vbox",pack:"center",align:"center"},style:"text-align:center",flex:1,items:[{xtype:"label",cls:"cbaCssLabel",itemId:"TotPunteggio",reference:"TotPunteggio",style:"font-weight:bold"},{xtype:"label",cls:"cbaCssLabel",itemId:"DescrizionePunteggio",reference:"DescrizionePunteggio",style:"font-weight:bold"}]}]}]}]}]}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.bina.view.Dettaglio",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var a=this.cbaConfig.domanda.data.name,b=!0;this.cbaConfig.pre2012||9!=this.cbaConfig.domanda.data.ordine||(a="",b=!1);Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntCorpoDomanda",reference:"CntCorpoDomanda",layout:{type:"vbox",align:"stretch"},flex:1,margin:"10 0 10 0",items:[{xtype:"container",layout:{type:"hbox",align:"center"},width:405,items:[{xtype:"textfield",
width:50,name:a,isFormField:b,hidden:!0},{xtype:"container",layout:{type:"hbox"},style:{background:"#5FA2DD"},width:480,padding:10,items:[{xtype:"container",layout:{type:"hbox",align:"begin ",pack:"center"},items:[{xtype:"label",height:20,name:"descrizione",cls:"cbaCssLabelTitolo",margin:"0 0 0 8",text:this.cbaConfig.testoDomanda}]},{xtype:"container",itemId:"CntIcona",reference:"CntIcona",layout:{type:"hbox",align:"center",pack:"end"},flex:1}]}]},{xtype:"container",padding:5,itemId:"CntDescrDomanda"},
{xtype:"container",padding:10,items:[{xtype:"fieldset",flex:1,margin:"5 0 0 0",items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,itemId:"PanelRisposte",reference:"PanelRisposte",margin:"8 0 0 0"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.bina.view.Trattamenti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"CntTrattamenti",reference:"CntTrattamenti",layout:{type:"vbox",align:"stretch"},flex:1,margin:"10 0 10 0",items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"container",style:"border-right: 1px solid #5fa2dd",layout:{type:"vbox",align:"stretch"},width:72,items:[{xtype:"container",style:"border-bottom: 1px solid #5fa2dd",
layout:{type:"hbox",align:"stretch"},height:90,items:[{xtype:"label",text:"TRATTAMENTI_1",style:"-webkit-transform: rotate(-45deg);margin-top: 22px; margin-left: 18px;"}]},{xtype:"radiogroup",vertical:!0,columns:1,items:[{boxLabel:"",name:"trattamentiSpecialist",inputValue:"0"},{boxLabel:"",name:"trattamentiSpecialist",inputValue:"2"},{boxLabel:"",name:"trattamentiSpecialist",inputValue:"3"},{boxLabel:"",name:"trattamentiSpecialist",inputValue:"4"},{boxLabel:"",name:"trattamentiSpecialist",inputValue:"5"},
{boxLabel:"",name:"trattamentiSpecialist",inputValue:"6"},{boxLabel:"",name:"trattamentiSpecialist",inputValue:"8"},{boxLabel:"",name:"trattamentiSpecialist",inputValue:"9"},{boxLabel:"",margin:"17 0 0 0",inputValue:"10",name:"trattamentiSpecialist"},{boxLabel:"",margin:"14 0 0 0",inputValue:"11",name:"trattamentiSpecialist"}]}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},style:"border-right: 1px solid #5fa2dd",width:72,items:[{xtype:"container",style:"border-bottom: 1px solid #5fa2dd",
layout:{type:"hbox",align:"stretch"},height:90,items:[{xtype:"label",text:"TRATTAMENTI_2",style:"-webkit-transform: rotate(-45deg);margin-top: 22px; margin-left: 18px;"}]},{xtype:"radiogroup",vertical:!0,columns:1,items:[{boxLabel:"",inputValue:"0",name:"trattamentiSpecialist2"},{boxLabel:"",inputValue:"2",name:"trattamentiSpecialist2"},{boxLabel:"",inputValue:"3",name:"trattamentiSpecialist2"},{boxLabel:"",inputValue:"4",name:"trattamentiSpecialist2"},{boxLabel:"",inputValue:"5",name:"trattamentiSpecialist2"},
{boxLabel:"",inputValue:"6",name:"trattamentiSpecialist2"},{boxLabel:"",inputValue:"8",name:"trattamentiSpecialist2"},{boxLabel:"",inputValue:"9",name:"trattamentiSpecialist2"},{boxLabel:"",margin:"17 0 0 0",inputValue:"10",name:"trattamentiSpecialist2"},{boxLabel:"",inputValue:"11",margin:"14 0 0 0",name:"trattamentiSpecialist2"}]}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},width:72,style:"border-right: 1px solid #5fa2dd",items:[{xtype:"container",style:"border-bottom: 1px solid #5fa2dd",
layout:{type:"hbox",align:"stretch"},height:90,items:[{xtype:"label",text:"TRATTAMENTI_3",style:"-webkit-transform: rotate(-45deg);margin-top: 22px; margin-left: 18px;"}]},{xtype:"radiogroup",vertical:!0,columns:1,items:[{boxLabel:"",inputValue:"0",name:"trattamentiSpecialist3"},{boxLabel:"",inputValue:"2",name:"trattamentiSpecialist3"},{boxLabel:"",inputValue:"3",name:"trattamentiSpecialist3"},{boxLabel:"",inputValue:"4",name:"trattamentiSpecialist3"},{boxLabel:"",inputValue:"5",name:"trattamentiSpecialist3"},
{boxLabel:"",inputValue:"6",name:"trattamentiSpecialist3"},{boxLabel:"",inputValue:"8",name:"trattamentiSpecialist3"},{boxLabel:"",inputValue:"9",name:"trattamentiSpecialist3"},{boxLabel:"",inputValue:"10",margin:"17 0 0 0",name:"trattamentiSpecialist3"},{boxLabel:"",inputValue:"11",margin:"14 0 0 0",name:"trattamentiSpecialist3"}]}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},width:72,style:"border-right: 1px solid #5fa2dd",items:[{xtype:"container",style:"border-bottom: 1px solid #5fa2dd",
layout:{type:"hbox",align:"stretch"},height:90,items:[{xtype:"label",text:"TRATTAMENTI_4",style:"-webkit-transform: rotate(-45deg);margin-top: 22px; margin-left: 18px;"}]},{xtype:"radiogroup",vertical:!0,columns:1,items:[{boxLabel:"",inputValue:"0",name:"trattamentiSpecialist4"},{boxLabel:"",inputValue:"2",name:"trattamentiSpecialist4"},{boxLabel:"",inputValue:"3",name:"trattamentiSpecialist4"},{boxLabel:"",inputValue:"4",name:"trattamentiSpecialist4"},{boxLabel:"",inputValue:"5",name:"trattamentiSpecialist4"},
{boxLabel:"",inputValue:"6",name:"trattamentiSpecialist4"},{boxLabel:"",inputValue:"8",name:"trattamentiSpecialist4"},{boxLabel:"",inputValue:"9",name:"trattamentiSpecialist4"},{boxLabel:"",inputValue:"10",margin:"17 0 0 0",name:"trattamentiSpecialist4"},{boxLabel:"",inputValue:"11",margin:"14 0 0 0",name:"trattamentiSpecialist4"}]}]},{xtype:"container",width:72,style:"border-right: 1px solid #5fa2dd",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",style:"border-bottom: 1px solid #5fa2dd",
layout:{type:"hbox",align:"stretch"},height:90,items:[{xtype:"label",text:"TRATTAMENTI_5",style:"-webkit-transform: rotate(-45deg);margin-top: 22px; margin-left: 18px;"}]},{xtype:"radiogroup",vertical:!0,columns:1,items:[{inputValue:"0",name:"trattamentiSpecialist5"},{inputValue:"2",name:"trattamentiSpecialist5"},{inputValue:"3",name:"trattamentiSpecialist5"},{inputValue:"4",name:"trattamentiSpecialist5"},{inputValue:"5",name:"trattamentiSpecialist5"},{inputValue:"6",name:"trattamentiSpecialist5"},
{inputValue:"8",name:"trattamentiSpecialist5"},{inputValue:"9",name:"trattamentiSpecialist5"},{inputValue:"10",margin:"17 0 0 0",name:"trattamentiSpecialist5"},{inputValue:"11",margin:"14 0 0 0",name:"trattamentiSpecialist5"}]}]},{xtype:"container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",style:"border-bottom: 1px solid #5fa2dd",layout:{type:"hbox",align:"stretch"},height:90},{xtype:"container",margin:"0 0 0 5",layout:{type:"vbox",align:"stretch"},items:[{xtype:"label",
margin:"3 0 0 0",html:traduci("BINA_9_RISP_1_POST2012")},{xtype:"label",margin:"6 0 0 0",text:"BINA_9_RISP_2_PRE2012"},{xtype:"label",margin:"6 0 0 0",text:"BINA_9_RISP_3_PRE2012"},{xtype:"label",margin:"6 0 0 0",text:"BINA_9_RISP_4_PRE2012"},{xtype:"label",margin:"9 0 0 0",text:"BINA_9_RISP_5_POST2012"},{xtype:"label",margin:"6 0 0 0",text:"BINA_9_RISP_6_POST2012"},{xtype:"label",margin:"6 0 0 0",text:"BINA_9_RISP_7_POST2012"},{xtype:"label",margin:"6 0 0 0",text:"BINA_9_RISP_8_POST2012"},{xtype:"label",
margin:"6 0 0 0",text:"BINA_9_RISP_9_POST2012"},{xtype:"label",margin:"6 0 0 0",text:"BINA_9_RISP_10_POST2012"}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.graficoCustom.controller.Grafico_BASIQ",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grafico",selector:a+"#Grafico"}])},aggiornaStore:function(a,b){a=void 0===a?{}:a;b=void 0===b?function(){return null}:b;var c=this.getGrafico().getStore();svuotaStore(c);c.load({params:a,callback:function(a,c,f){f?Ext.isEmpty(a)?Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"):b(a):msgShowError("",
c.getError())}})},onLaunch:function(){this.cbaConfig.controllerTestata&&(this.cbaConfig.controllerTestata.controllerGrafico=this)}});
Ext.define("GeneraliCS.schede.graficoCustom.controller.Grafico_BPRS",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grafico",selector:a+"#Grafico"}])},aggiornaStore:function(a,b){a=void 0===a?{}:a;b=void 0===b?function(){return null}:b;var c=this.getGrafico().getStore();svuotaStore(c);c.load({params:a,callback:function(a,c,f){f?Ext.isEmpty(a)?Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"):b(a):msgShowError("",
c.getError())}})},onLaunch:function(){this.cbaConfig.controllerTestata&&(this.cbaConfig.controllerTestata.controllerGrafico=this)}});
Ext.define("GeneraliCS.schede.graficoCustom.controller.Grafico_NOSIE",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grafico",selector:a+"#Grafico"}])},aggiornaStore:function(a,b){a=void 0===a?{}:a;b=void 0===b?function(){return null}:b;this.getGrafico().getStore().load({params:a,callback:function(a,d,e){e?Ext.isEmpty(a)?Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"):b(a):msgShowError("",d.getError())}})},
onLaunch:function(){this.cbaConfig.controllerTestata&&(this.cbaConfig.controllerTestata.controllerGrafico=this)}});
Ext.define("GeneraliCS.schede.graficoCustom.controller.Grafico_WISCWAIS",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grafico",selector:a+"#Grafico"}])},aggiornaStore:function(a,b){a=void 0===a?{}:a;b=void 0===b?function(){return null}:b;this.getGrafico().getStore().load({params:a,callback:function(a,d,e){e?Ext.isEmpty(a)?Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"):b(a):msgShowError("",d.getError())}})},
onLaunch:function(){this.cbaConfig.controllerTestata&&(this.cbaConfig.controllerTestata.controllerGrafico=this)}});
Ext.define("GeneraliCS.schede.graficoCustom.controller.Grafico_WISCWAIS2",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grafico",selector:a+"#Grafico"}])},aggiornaStore:function(a,b){a=void 0===a?{}:a;b=void 0===b?function(){return null}:b;var c=this.getGrafico().getStore();a&&a.idReg&&(a.idReg*=-1);c.load({params:a,callback:function(a,c,f){f?Ext.isEmpty(a)?Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"):
b(a):msgShowError("",c.getError())}})},onLaunch:function(){this.cbaConfig.controllerTestata&&(this.cbaConfig.controllerTestata.controllerGrafico=this)}});
Ext.define("GeneraliCS.schede.graficoCustom.view.Grafico_BASIQ",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"chart",nonDisabilitare:!0,flex:1,itemId:"Grafico",reference:"Grafico",store:Ext.create("GeneraliCS.schede.grafico.store.Andamento"),innerPadding:{top:10,left:15,right:15,bottom:10},border:0,legend:{docked:"bottom",type:"sprite"},
axes:[{type:"numeric",fields:["punteggio","punteggioComplessivo"],position:"left",grid:!0,title:{text:traduci("PUNTEGGIO"),fontSize:15}},{type:"category",fields:"lblPunteggio",position:"bottom",grid:!0,label:{rotation:-90}}],series:[{type:"bar",showInLegend:!0,stacked:!1,colors:["orange","violet"],title:[traduci("VALUTAZIONE_ATTUALE"),traduci("VALUTAZIONE_INGRESSO")],xField:"lblPunteggio",yField:["punteggio","punteggioComplessivo"],label:{display:"outside",field:["punteggio","punteggioComplessivo"],
orientation:"horizontal",font:"bold 12px Arial",color:"#000000",renderer:function(a){if("0"==a)return"NV"}}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.graficoCustom.view.Grafico_BPRS",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"chart",nonDisabilitare:!0,flex:1,itemId:"Grafico",reference:"Grafico",store:Ext.create("GeneraliCS.schede.grafico.store.Andamento"),innerPadding:{top:10,left:15,right:15,bottom:10},border:0,legend:{docked:"bottom",type:"sprite"},
axes:[{type:"numeric",fields:["punteggio","punteggioComplessivo"],position:"left",grid:!0,title:{text:traduci("PUNTEGGIO"),fontSize:15}},{type:"category",fields:"lblPunteggio",position:"bottom",grid:!0,label:{rotation:-90}}],series:[{type:"bar",showInLegend:!0,stacked:!1,colors:["orange","violet"],title:[traduci("VALUTAZIONE_ATTUALE"),traduci("VALUTAZIONE_INGRESSO")],xField:"lblPunteggio",yField:["punteggio","punteggioComplessivo"],label:{display:"outside",field:["punteggio","punteggioComplessivo"],
orientation:"horizontal",font:"bold 12px Arial",color:"#000000",renderer:function(a){if("0"==a)return"NV"}}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.graficoCustom.view.Grafico_NOSIE",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"chart",nonDisabilitare:!0,flex:1,itemId:"Grafico",reference:"Grafico",store:Ext.create("GeneraliCS.schede.grafico.store.Andamento"),innerPadding:{top:10,left:15,right:15,bottom:10},border:0,legend:{docked:"bottom",type:"sprite"},
axes:[{type:"numeric",fields:["punteggio","punteggioComplessivo"],position:"left",grid:!0,title:{text:traduci("PUNTEGGIO"),fontSize:15}},{type:"category",fields:"lblPunteggio",position:"bottom",grid:!0,label:{rotation:-90}}],series:[{type:"bar",showInLegend:!0,stacked:!1,colors:["orange","violet"],title:[traduci("VALUTAZIONE_ATTUALE"),traduci("VALUTAZIONE_INGRESSO")],xField:"lblPunteggio",yField:["punteggio","punteggioComplessivo"],label:{display:"outside",field:["punteggio","punteggioComplessivo"],
orientation:"horizontal",font:"bold 12px Arial",color:"#000000",renderer:function(a){if("0"==a)return"NV"}}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.graficoCustom.view.Grafico_WISCWAIS",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"chart",nonDisabilitare:!0,flex:1,itemId:"Grafico",reference:"Grafico",store:Ext.create("GeneraliCS.schede.grafico.store.Andamento"),innerPadding:{top:30,left:15,right:15,bottom:10},border:0,legend:{docked:"bottom",type:"sprite"},
axes:[{type:"numeric",fields:["punteggio","punteggioCorretto"],maximum:19,minimum:0,increment:1,position:"left",grid:!0,title:{text:traduci("PUNTEGGIO"),fontSize:15}},{type:"category",fields:["lblPunteggio","lblPunteggio2","lblPunteggio3","lblPunteggio4"],position:"top",grid:!0},{type:"category",fields:["lblPunteggioCorretto"],hidden:!0,grid:!1,label:{renderer:function(a){return""}}}],series:[{type:"line",showInLegend:!1,style:{stroke:"black","stroke-width":1},xField:["lblPunteggioCorretto"],yField:["punteggioCorretto"]},
{type:"line",showInLegend:!0,style:{stroke:"green","stroke-width":1},title:traduci("WISCWAIS_CV"),xField:"lblPunteggio",yField:["punteggio"],marker:{type:"square",fill:"green",opacity:1,fx:{duration:200,easing:"backOut"}},label:{display:"outside",field:["punteggio"],orientation:"horizontal",font:"bold 12px Arial",color:"#000000"}},{type:"line",showInLegend:!0,style:{stroke:"orange","stroke-width":1},title:traduci("WISCWAIS_RP"),xField:"lblPunteggio2",yField:["punteggio"],marker:{type:"square",fill:"orange",
opacity:1,fx:{duration:200,easing:"backOut"}},label:{display:"outside",field:["punteggio"],orientation:"horizontal",font:"bold 12px Arial",color:"#000000"}},{type:"line",showInLegend:!0,style:{stroke:"blue","stroke-width":1},title:traduci("WISCWAIS_ML"),xField:"lblPunteggio3",yField:["punteggio"],marker:{type:"square",fill:"blue",opacity:1,fx:{duration:200,easing:"backOut"}},label:{display:"outside",field:["punteggio"],orientation:"horizontal",font:"bold 12px Arial",color:"#000000"}},{type:"line",
showInLegend:!0,style:{stroke:"purple","stroke-width":1},title:traduci("WISCWAIS_VE"),xField:"lblPunteggio4",yField:["punteggio"],marker:{type:"square",fill:"purple",opacity:1,fx:{duration:200,easing:"backOut"}},label:{display:"outside",field:["punteggio"],orientation:"horizontal",font:"bold 12px Arial",color:"#000000"}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.graficoCustom.view.Grafico_WISCWAIS2",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"chart",nonDisabilitare:!0,flex:1,itemId:"Grafico",reference:"Grafico",store:Ext.create("GeneraliCS.schede.grafico.store.Andamento"),innerPadding:{top:30,left:15,right:15,bottom:10},border:0,legend:{docked:"bottom",type:"sprite"},
axes:[{type:"numeric",fields:["punteggio","punteggioCorretto"],maximum:160,minimum:40,increment:1,position:"left",grid:!0,title:{text:traduci("PUNTEGGIO"),fontSize:15}},{type:"category",fields:["lblPunteggio"],position:"top",grid:!0},{type:"category",fields:["lblPunteggioCorretto"],hidden:!0}],series:[{type:"line",showInLegend:!1,style:{stroke:"black","stroke-width":1},xField:["lblPunteggioCorretto"],yField:["punteggioCorretto"]},{type:"line",showInLegend:!0,style:{stroke:"red","stroke-width":1},
xField:"lblPunteggio",yField:"punteggio",title:traduci("PUNTEGGIO"),marker:{type:"square",fill:"#ff8809",opacity:1,fx:{duration:200,easing:"backOut"}},label:{display:"outside",field:["punteggio"],orientation:"horizontal",font:"bold 12px Arial",color:"#000000"}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.graficoRadar.controller.TabAndamento",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grafico",selector:a+"#Grafico"}])},controllaSerie:function(a){Ext.isEmpty(a[0].data.datoRadar1)||(this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.legend1&&this.getGrafico().series[0].setTitle(this.cbaConfig.extraConfig.legend1),this.getGrafico().series[0].setShowInLegend(!0),this.getGrafico().series[0].setHidden(!1));
Ext.isEmpty(a[0].data.datoRadar2)||(this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.legend2&&this.getGrafico().series[1].setTitle(this.cbaConfig.extraConfig.legend2),this.getGrafico().series[1].setHidden(!1),this.getGrafico().series[1].setShowInLegend(!0));Ext.isEmpty(a[0].data.datoRadar3)||(this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.legend3&&this.getGrafico().series[2].setTitle(this.cbaConfig.extraConfig.legend3),this.getGrafico().series[2].setHidden(!1),this.getGrafico().series[2].setShowInLegend(!0));
this.getGrafico().refreshLegendStore()},controllaAssi:function(a){Ext.isEmpty(a[0].data.datoRadar1)||this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.max&&this.getGrafico().axes[0].setMaximum(this.cbaConfig.extraConfig.max);Ext.isEmpty(a[0].data.datoRadar1)||this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.max&&this.getGrafico().axes[1].setMaximum(this.cbaConfig.extraConfig.max);Ext.isEmpty(a[0].data.datoRadar1)||this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.max&&this.getGrafico().axes[2].setMaximum(this.cbaConfig.extraConfig.max)},
aggiornaStore:function(a,b){b=void 0===b?function(){return null}:b;var c=this,d=c.getGrafico().getStore();c.cbaConfig.testataGen&&ImpostaUrl([d]);"189"==this.cbaConfig.codiceModulo&&Ext.apply(a,{almenouna:!0});d.load({params:a,callback:function(a,f,g){g?Ext.isEmpty(a)?Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"):(c.controllaSerie(a),c.controllaAssi(a),d.removeAll(),d.loadData(a),b(a)):msgShowError("",f.getError())}})},onLaunch:function(){this.cbaConfig.controllerTestata&&(this.cbaConfig.controllerTestata.controllerGrafico=
this);this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.colore1&&this.getGrafico().series[0].setStyle({fillOpacity:0,strokeStyle:this.cbaConfig.extraConfig.colore1,strokeOpacity:1,lineWidth:2});this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.colore2&&this.getGrafico().series[1].setStyle({fillOpacity:0,strokeStyle:this.cbaConfig.extraConfig.colore2,strokeOpacity:1,lineWidth:2});this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.colore3&&this.getGrafico().series[2].setStyle({fillOpacity:0,
strokeStyle:this.cbaConfig.extraConfig.colore3,strokeOpacity:1,lineWidth:2})}});
Ext.define("GeneraliCS.schede.graficoRadar.store.Andamento",{extend:"Ext.data.Store",fields:[{name:"data",type:"date"},{name:"punteggio"},{name:"punteggioComplessivo"},{name:"punteggioCorretto"},{name:"andatura"},{name:"equilibrio"},{name:"totale"},{name:"dataRadar1"},{name:"dataRadar2"},{name:"dataRadar3"},{name:"dal",type:"date"},{name:"al",type:"date"}],proxy:{type:"ajax",method:"GET",urlGen:"/ws/genCss/skval/graph/get",url:"/cba/css/cs/ws/skval/graph/get",api:{read:"/cba/css/cs/ws/skval/graph/get"},
reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.schede.graficoRadar.view.TabAndamento",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,reference:"PanelChart",scrollable:!0,items:[{xtype:"polar",nonDisabilitare:!0,height:480,itemId:"Grafico",reference:"Grafico",insetPadding:{top:18,left:18,right:18,bottom:18},store:Ext.create("GeneraliCS.schede.graficoRadar.store.Andamento"),
legend:{docked:"right",type:"sprite"},series:[{type:"radar",angleField:"lblPunteggio",radiusField:"datoRadar1",rotation:-90,showInLegend:!1,style:{fillOpacity:0,strokeStyle:"#000000",strokeOpacity:1,lineWidth:1},marker:{type:"circle",radius:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,b,c){a.setHtml(traduci("PUNTEGGIO")+" "+b.get("datoRadar1")+" al  "+FormattaData(b.get("dal")))}}},{type:"radar",angleField:"lblPunteggio",radiusField:"datoRadar2",showInLegend:!1,rotation:-90,
style:{fillOpacity:0,strokeStyle:"#000000",strokeOpacity:1,lineWidth:1},marker:{type:"circle",radius:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,b,c){a.setHtml(traduci("PUNTEGGIO")+" "+b.get("datoRadar2")+" al  "+FormattaData(b.get("data")))}}},{type:"radar",angleField:"lblPunteggio",radiusField:"datoRadar3",showInLegend:!1,rotation:-90,style:{fillOpacity:0,strokeStyle:"#000000",strokeOpacity:1,lineWidth:1},marker:{type:"circle",radius:2},tooltip:{trackMouse:!0,style:"background: #fff",
renderer:function(a,b,c){a.setHtml(traduci("PUNTEGGIO")+" "+b.get("datoRadar3")+" al  "+FormattaData(b.get("dal")))}}}],axes:[{type:"numeric",position:"radial",fields:"datoRadar1",grid:!0,label:{fontSize:"15px"},maximum:7,increment:2,minimum:0},{type:"numeric",position:"radial",fields:"datoRadar2",grid:!0,label:{fontSize:"15px"},maximum:7,increment:2,minimum:0},{type:"numeric",position:"radial",fields:"datoRadar3",grid:!0,maximum:7,increment:2,minimum:0,label:{fontSize:"15px"}},{type:"category",position:"angular",
fields:"lblPunteggio",style:{estStepSize:1},grid:!0}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.grafico.controller.AndamentoTestata",{extend:"Generali.standard.stampe.Controller",parametriStampa:{url:"/cba/css/cs/ws/report/skval/grafico",hideXml:!0,hideCsv:!0,hideText:!0,hideExcel:!1,hideBtnStampaOnSecondaryWin:!0,ignoreFormatCss:!0},init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntGrafico",selector:a+"#CntGrafico"},{ref:"BtnAndamento",selector:a+"#BtnAndamento"},{ref:"BtnAndamentoCompleto",selector:a+"#BtnAndamentoCompleto"},
{ref:"DataDal",selector:a+"#DataDal"},{ref:"DataAl",selector:a+"#DataAl"},{ref:"PnlFiltroGrafico",selector:a+"#PnlFiltroGrafico"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"BtnStampa",selector:a+"#BtnStampa"},{ref:"BtnStampaXls",selector:a+"#BtnStampaXls"}]);this.control(a+"#BtnAndamento",{click:this.calcolaAndamento});this.control(a+"#BtnAndamentoCompleto",{click:this.calcolaAndamentoCompleto});this.control(a+"#BtnEsci",{click:this.clickBtnEsci})},doPrint:function(a,b){this.stampa();this.callParent([a,
b])},getGrafico:function(){var a;a=this.controllerGrafico.getGrafico?this.controllerGrafico.getGrafico():this.getCntGrafico().down("chart");if(!a)throw"Nessun componente grafico trovato!";return a},stampa:function(){var a=this.getGrafico().getImage().data.replace(/^data:image\/(png|jpg);base64,/,"");this.parametriStampa.url="/cba/css/cs/ws/report/skval/grafico";a=Ext.apply(this.parametriStampa,{winElaborazione:!0,params:{tipo:this.parametriStampa.params.format,titolo:this.cbaConfig.desVideata||"",
base64:a,dal:this.getDataDal().getValue(),al:this.getDataAl().getValue(),tutto:0,idRicovero:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero}});Ext.apply(this.cbaConfig,{winElaborazione:!0});Ext.apply(a.params,{});this.cbaConfig.configBtnStampa&&(Ext.applyIf(a,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(a.params,this.cbaConfig.configBtnStampa.params))},clickBtnEsci:function(a){a.up("window").close()},calcolaAndamento:function(a){this.generaGrafico()},
calcolaAndamentoCompleto:function(a){this.generaGrafico(1)},generaGrafico:function(a){a=void 0===a?0:a;var b=this;this.cbaConfig.idSchedaSel&&(this.lookup("DataDal").setHidden(!0),this.lookup("DataAl").setHidden(!0));var c=this.getDataDal().getValue(),d=this.getDataAl().getValue();a&&(d=c=null);c={idRicovero:b.cbaConfig.idRicovero,dal:c,al:d,tutto:a||0,codiceModulo:b.cbaConfig.codiceModulo};this.cbaConfig.idSchedaSel&&Ext.apply(c,{idReg:this.cbaConfig.idSchedaSel});b.cbaConfig.idRicoveroCu&&(b.idRicovero||
delete c.idRicovero,Ext.apply(c,{idRicoveroCu:b.cbaConfig.idRicoveroCu}));this.controllerGrafico.aggiornaStore(c,function(c){if(!Ext.isEmpty(c)){var d=c[0];c=c[c.length-1];d&&c&&(b.getDataDal().setValue(d.get("data")),b.getDataAl().setValue(c.get("data")));a&&b.getDataDal().setValue(d.get("data"))}})},onLaunch:function(){var a=this.cbaConfig,a=void 0===a.viewGrafico?"GeneraliCS.schede.grafico.view.TabAndamento":a.viewGrafico;this.getBtnEsci().up("toolbar").setHidden(!this.cbaConfig.ingressoDaPortlet);
55==CBA.moduli.moduloAttivo&&this.getBtnStampa().setHidden(!0);this.getCntGrafico().add(Ext.create(a,{layout:{type:"vbox",align:"stretch"},flex:1,cbaConfig:Object.assign(this.cbaConfig,{controllerTestata:this})}));this.controllerGrafico?("bar"==this.cbaConfig.typeSerie&&(this.lookup("DataDal").setHidden(!0),this.lookup("DataAl").setHidden(!0),Ext.apply(this.getGrafico().innerPadding,{top:25})),this.cbaConfig.ingressoDaPortlet&&this.generaGrafico()):StdSipcar.warn("Attenzione, 'controllerGrafico' non impostato nel metodo onLaunch del controller "+
a.replace("view","controller"))}});
Ext.define("GeneraliCS.schede.grafico.controller.TabAndamento",{extend:"Generali.standard.stampe.Controller",parametriStampa:{url:"/cba/css/cs/ws/report/skval/grafico",hideXml:!0,hideCsv:!0,hideText:!0,hideExcel:!1,hideBtnStampaOnSecondaryWin:!0,ignoreFormatCss:!0},init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Grafico",selector:a+"#Grafico"},{ref:"BtnEsci",selector:a+"#BtnEsci"}])},controllaSerie:function(a){"line"==this.cbaConfig.typeSerie?(Ext.isEmpty(a[0].data.punteggio)||
(this.getGrafico().series[0].setShowInLegend(!0),this.getGrafico().series[0].setHidden(!1)),Ext.isEmpty(a[0].data.punteggioComplessivo)||(this.getGrafico().series[1].setTitle(a[0].data.lblPunteggioComplessivo),this.getGrafico().series[1].setHidden(!1),this.getGrafico().series[1].setShowInLegend(!0)),Ext.isEmpty(a[0].data.punteggioCorretto)||(this.getGrafico().series[2].setTitle(a[0].data.lblPunteggioCorretto),this.getGrafico().series[2].setHidden(!1),this.getGrafico().series[2].setShowInLegend(!0)),
Ext.isEmpty(a[0].data.andatura)||(this.getGrafico().series[3].setHidden(!1),this.getGrafico().series[3].setShowInLegend(!0)),Ext.isEmpty(a[0].data.equilibrio)||(this.getGrafico().series[4].setHidden(!1),this.getGrafico().series[4].setShowInLegend(!0)),Ext.isEmpty(a[0].data.totale)||(this.getGrafico().series[5].setHidden(!1),this.getGrafico().series[5].setShowInLegend(!0)),Ext.isEmpty(a[0].data.comunicazione)||(this.getGrafico().series[7].setHidden(!1),this.getGrafico().series[7].setShowInLegend(!0)),
Ext.isEmpty(a[0].data.abQuotidiane)||(this.getGrafico().series[8].setHidden(!1),this.getGrafico().series[8].setShowInLegend(!0)),Ext.isEmpty(a[0].data.socializzazione)||(this.getGrafico().series[9].setHidden(!1),this.getGrafico().series[9].setShowInLegend(!0)),Ext.isEmpty(a[0].data.abMotorie)||(this.getGrafico().series[10].setHidden(!1),this.getGrafico().series[10].setShowInLegend(!0)),Ext.isEmpty(a[0].data.dolore)||(this.getGrafico().series[11].setHidden(!1),this.getGrafico().series[11].setShowInLegend(!0)),
Ext.isEmpty(a[0].data.stanchezza)||(this.getGrafico().series[12].setHidden(!1),this.getGrafico().series[12].setShowInLegend(!0)),Ext.isEmpty(a[0].data.nausea)||(this.getGrafico().series[13].setHidden(!1),this.getGrafico().series[13].setShowInLegend(!0)),Ext.isEmpty(a[0].data.depressione)||(this.getGrafico().series[14].setHidden(!1),this.getGrafico().series[14].setShowInLegend(!0)),Ext.isEmpty(a[0].data.ansia)||(this.getGrafico().series[15].setHidden(!1),this.getGrafico().series[15].setShowInLegend(!0)),
Ext.isEmpty(a[0].data.sonnolenza)||(this.getGrafico().series[16].setHidden(!1),this.getGrafico().series[16].setShowInLegend(!0)),Ext.isEmpty(a[0].data.mancanzaAppetito)||(this.getGrafico().series[17].setHidden(!1),this.getGrafico().series[17].setShowInLegend(!0)),Ext.isEmpty(a[0].data.malessere)||(this.getGrafico().series[18].setHidden(!1),this.getGrafico().series[18].setShowInLegend(!0)),Ext.isEmpty(a[0].data.difficoltaRespiro)||(this.getGrafico().series[19].setHidden(!1),this.getGrafico().series[19].setShowInLegend(!0)),
Ext.isEmpty(a[0].data.altro)||(this.getGrafico().series[20].setHidden(!1),this.getGrafico().series[20].setShowInLegend(!0))):"bar"==this.cbaConfig.typeSerie&&(a=this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.color?this.cbaConfig.extraConfig.color:"green",this.getGrafico().series[6].setColors([a]),this.getGrafico().series[6].setHidden([!1]));this.getGrafico().refreshLegendStore()},controllaAxes:function(a){this.getGrafico().getAxes()[0].setMaximum(this.cbaConfig.punteggioMax?this.cbaConfig.punteggioMax:
this.calcolaPunteggioMax(a));this.getGrafico().getAxes()[0].setMinimum(this.cbaConfig.punteggioMin?this.cbaConfig.punteggioMin:0);"line"==this.cbaConfig.typeSerie?(this.getGrafico().getAxes()[0].setGrid(!0),this.getGrafico().getAxes()[2].setGrid(!1)):"bar"==this.cbaConfig.typeSerie&&(a=this.cbaConfig.extraConfig&&this.cbaConfig.extraConfig.titleNumeric?this.cbaConfig.extraConfig.titleNumeric:{},this.getGrafico().getAxes()[0].setGrid(!1),this.getGrafico().getAxes()[2].setGrid(!0),this.getGrafico().getAxes()[0].setTitle(a))},
calcolaPunteggioMax:function(a){var b=0;Ext.isEmpty(a)||Ext.each(a,function(a){a.get("punteggio")>b&&(b=a.get("punteggio"))});return b},aggiornaStore:function(a,b){b=void 0===b?function(){return null}:b;var c=this,d=c.getGrafico().getStore();c.cbaConfig.testataGen&&ImpostaUrl([d]);d.load({params:a,callback:function(a,f,g){g?Ext.isEmpty(a)?Messaggio("RICERCA","RISULTATO_VUOTO","OK","INFORMATION"):(b(a),c.controllaSerie(a),c.controllaAxes(a),d.removeAll(),d.loadData(a)):msgShowError("",f.getError())}})},
onLaunch:function(){this.cbaConfig.controllerTestata&&(this.cbaConfig.controllerTestata.controllerGrafico=this)}});
Ext.define("GeneraliCS.schede.grafico.store.Andamento",{extend:"Ext.data.Store",fields:[{name:"data",type:"date"},{name:"punteggio"},{name:"punteggioComplessivo"},{name:"punteggioCorretto"},{name:"andatura"},{name:"equilibrio"},{name:"totale"},{name:"comunicazione"},{name:"abMotorie"},{name:"abQuotidiane"},{name:"socializzazione"}],proxy:{type:"ajax",method:"GET",urlGen:"/ws/genCss/skval/graph/get",url:"/cba/css/cs/ws/skval/graph/get",api:{read:"/cba/css/cs/ws/skval/graph/get"},reader:{type:"json",
messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.schede.grafico.view.AndamentoTestata",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"fieldset",itemId:"PnlFiltroGrafico",reference:"PnlFiltroGrafico",layout:{type:"hbox",align:"center",pack:"center"},height:70,margin:"6 6 0 6",items:[{xtype:"datefield",margin:"0 15 0 0",labelClsExtra:"cbaCssLabel",itemId:"DataDal",
reference:"DataDal",fieldLabel:"PERIODO_DAL",name:"graficoDataDal",labelAlign:"top",isFormField:!1},{xtype:"datefield",labelClsExtra:"cbaCssLabel",itemId:"DataAl",reference:"DataAl",fieldLabel:"AL",name:"graficoDataAl",labelAlign:"top",isFormField:!1},{xtype:"container",flex:1,layout:{type:"hbox",pack:"end"},items:[{xtype:"newButtonStampa",itemId:"BtnStampa",reference:"BtnStampa",text:traduci("Stampa"),margin:"20 0 0 0",iconCls:"box-print-css",scale:"medium"},{xtype:"splitbutton",iconCls:"icon-edit",
scale:"medium",margin:"20 0 0 5",text:"MOSTRA_ANDAMENTO",itemId:"BtnAndamento",reference:"BtnAndamento",menu:new Ext.menu.Menu({items:[{text:"MOSTRA_TUTTO",itemId:"BtnAndamentoCompleto",reference:"BtnAndamentoCompleto"}]})}]}]},{xtype:"container",itemId:"CntGrafico",reference:"CntGrafico",layout:{type:"vbox",align:"stretch"},flex:1,itmes:[]}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",cls:"cbaCssBtnFunzione",text:"ESCI"}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.grafico.view.TabAndamento",{extend:"Generali.standard.ControlledContainer",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){var a={duration:200,easing:"backOut"};Ext.applyIf(this,{items:[{xtype:"panel",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"chart",nonDisabilitare:!0,flex:1,itemId:"Grafico",reference:"Grafico",store:Ext.create("GeneraliCS.schede.grafico.store.Andamento"),innerPadding:{top:10,left:5,right:25,bottom:10},border:0,legend:{docked:"bottom",
type:"sprite"},axes:[{type:"numeric",fields:"punteggio punteggioComplessivo punteggioCorretto andatura equilibrio totale".split(" "),position:"left",grid:!0},{type:"category",fields:"data",position:"bottom",grid:!0,renderer:function(a,c){return FormattaData(c,"d/m/Y")}},{type:"category",fields:"lblPunteggio",position:"bottom",grid:!1,label:{rotation:-45}}],series:[{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"red",fill:"rgba(100, 149, 237, 0.2)","stroke-width":1},
colors:["#ff8809"],xField:"data",yField:"punteggio",title:traduci("PUNTEGGIO"),marker:{type:"square",fill:"#ff8809",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("PUNTEGGIO")+" "+c.get("punteggio")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#299a0b","stroke-width":1},colors:["#299a0b"],xField:"data",yField:"punteggioComplessivo",title:traduci("PUNTEGGIO_COMPLESSIVO"),
marker:{type:"square",fill:"#299a0b",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("PUNTEGGIO_COMPLESSIVO")+" "+c.get("punteggioComplessivo")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#E5128A","stroke-width":1},colors:["#E5128A"],xField:"data",yField:"punteggioCorretto",title:traduci("PUNTEGGIO_CORRETTO"),marker:{type:"square",fill:"#E5128A",
opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("PUNTEGGIO_CORRETTO")+" "+c.get("punteggioCorretto")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#0B9191","stroke-width":1},colors:["#0B9191"],xField:"data",yField:"andatura",title:traduci("ANDATURA"),marker:{type:"square",fill:"#0B9191",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,
style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ANDATURA")+" "+c.get("andatura")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#F75013","stroke-width":1},colors:["#F75013"],xField:"data",yField:"equilibrio",title:traduci("EQUILIBRIO"),marker:{type:"square",fill:"#F75013",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("EQUILIBRIO")+
" "+c.get("equilibrio")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#7C0936","stroke-width":1},colors:["#7C0936"],xField:"data",yField:"totale",title:traduci("TOTALE"),marker:{type:"square",fill:"#7C0936",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("TOTALE")+" "+c.get("totale")+" al  "+FormattaData(c.get("data")))}}},{type:"bar",hidden:[!0],
showInLegend:!1,colors:[],title:traduci("PUNTEGGIO"),xField:"lblPunteggio",yField:"punteggio",label:{display:"outside",field:"punteggio",orientation:"horizontal",font:"bold 12px Arial",color:"#000000"}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#5013f7","stroke-width":1},colors:["#5013f7"],xField:"data",yField:"comunicazione",title:traduci("COMUNICAZIONE"),marker:{type:"square",fill:"#5013f7",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",
renderer:function(a,c,d){a.setHtml(traduci("COMUNICAZIONE")+" "+c.get("comunicazione")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#f75013","stroke-width":1},colors:["#f75013"],xField:"data",yField:"abQuotidiane",title:traduci("ABILITA_QUOTIDIANE"),marker:{type:"square",fill:"#f75013",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ABQUOTIDIANE")+
" "+c.get("abQuotidiane")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#13f750","stroke-width":1},colors:["#13f750"],xField:"data",yField:"socializzazione",title:traduci("SOCIALIZZAZIONE"),marker:{type:"square",fill:"#13f750",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("SOCIALIZZAZIONE")+" "+c.get("socializzazione")+" al  "+FormattaData(c.get("data")))}}},
{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#F7C213","stroke-width":1},colors:["#F7C213"],xField:"data",yField:"abMotorie",title:traduci("ABILITA_MOTORIE"),marker:{type:"square",fill:"#F7C213",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ABMOTORIE")+" "+c.get("abMotorie")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#C84630",
"stroke-width":1},colors:["#C84630"],xField:"data",yField:"dolore",title:traduci("ESAS_DOLORE"),marker:{type:"square",fill:"#C84630",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_DOLORE")+" "+c.get("dolore")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#5DA271","stroke-width":1},colors:["#5DA271"],xField:"data",yField:"stanchezza",title:traduci("ESAS_STANCHEZZA"),
marker:{type:"square",fill:"#5DA271",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_STANCHEZZA")+" "+c.get("stanchezza")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#E6C229","stroke-width":1},colors:["#E6C229"],xField:"data",yField:"nausea",title:traduci("ESAS_NAUSEA"),marker:{type:"square",fill:"#E6C229",opacity:1,fx:a},highlightCfg:{scaling:2},
tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_NAUSEA")+" "+c.get("nausea")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#B3C2F2","stroke-width":1},colors:["#B3C2F2"],xField:"data",yField:"depressione",title:traduci("ESAS_DEPRESSIONE"),marker:{type:"square",fill:"#B3C2F2",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,
c,d){a.setHtml(traduci("ESAS_DEPRESSIONE")+" "+c.get("depressione")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#37000A","stroke-width":1},colors:["#37000A"],xField:"data",yField:"ansia",title:traduci("ESAS_ANSIA"),marker:{type:"square",fill:"#37000A",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_ANSIA")+" "+c.get("ansia")+" al  "+FormattaData(c.get("data")))}}},
{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#3C3C3C","stroke-width":1},colors:["#3C3C3C"],xField:"data",yField:"sonnolenza",title:traduci("ESAS_SONNOLENZA"),marker:{type:"square",fill:"#3C3C3C",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_SONNOLENZA")+" "+c.get("sonnolenza")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",
style:{stroke:"#315C2B","stroke-width":1},colors:["#315C2B"],xField:"data",yField:"mancanzaAppetito",title:traduci("ESAS_MANCANZA_APPETITO"),marker:{type:"square",fill:"#315C2B",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_MANCANZA_APPETITO")+" "+c.get("mancanzaAppetito")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#256EFF","stroke-width":1},
colors:["#256EFF"],xField:"data",yField:"malessere",title:traduci("ESAS_MALESSERE"),marker:{type:"square",fill:"#256EFF",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_MALESSERE")+" "+c.get("malessere")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#FFD275","stroke-width":1},colors:["#FFD275"],xField:"data",yField:"difficoltaRespiro",title:traduci("ESAS_DIFF_RESP"),
marker:{type:"square",fill:"#FFD275",opacity:1,fx:a},highlightCfg:{scaling:2},tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_DIFF_RESP")+" "+c.get("difficoltaRespiro")+" al  "+FormattaData(c.get("data")))}}},{type:"line",hidden:!0,showInLegend:!1,axis:"left",color:"#fff",style:{stroke:"#D0C88E","stroke-width":1},colors:["#D0C88E"],xField:"data",yField:"altro",title:traduci("ESAS_ALTRO"),marker:{type:"square",fill:"#D0C88E",opacity:1,fx:a},highlightCfg:{scaling:2},
tooltip:{trackMouse:!0,style:"background: #fff",renderer:function(a,c,d){a.setHtml(traduci("ESAS_ALTRO")+" "+c.get("altro")+" al  "+FormattaData(c.get("data")))}}}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.schede.store.ExtraStore",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"descrModulo"},{name:"provvedimenti"},{name:"descrArea"},{name:"totale"},{name:"areaRisp"},{name:"domandaRisp"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/skval/moduli/get",urlGen:"/ws/genCss/skval/moduli/get",api:{read:"/cba/css/cs/ws/skval/moduli/get"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.schede.store.Frequenze",{extend:"Ext.data.Store",fields:[{name:"codEnte"},{name:"id"},{name:"idRicovero"},{name:"descFreq"},{name:"tipo"},{name:"numero"},{name:"terapie"},{name:"altro"}],proxy:{type:"ajax",method:"GET",urlGen:"/ws/genCss/tgen/frequenze/list",url:"/cba/css/cs/ws/genCss/tgen/frequenze/list",api:{read:"/cba/css/cs/ws/genCss/tgen/frequenze/list"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.schede.store.Impostazioni",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idProfilo"},{name:"scadenza"},{name:"ggControlloIngresso"},{name:"scadenzaSis"},{name:"segnalazioneScadenza"},{name:"schedeAbilitate"},{name:"collegamentoSkValBprs"}],proxy:{type:"ajax",method:"GET",urlGen:"/ws/genCss/skval/impostazioni/getbyprofilo",url:"/cba/css/cs/ws/genCss/skval/impostazioni/getbyprofilo",api:{read:"/cba/css/cs/ws/genCss/skval/impostazioni/getbyprofilo",update:"/cba/css/cs/ws/genCss/skval/impostazioni/update"},
reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.schede.store.Punteggio",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"codiceModulo"},{name:"punteggioMin"},{name:"punteggioMax"},{name:"descrizione"}],proxy:{type:"ajax",method:"GET",urlGen:"/ws/genCss/skval/risultati/listbymodulo",url:"/cba/css/cs/ws/genCss/skval/risultati/listbymodulo",api:{read:"/cba/css/cs/ws/genCss/skval/risultati/listbymodulo"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.standard.BozzaUtils",{alternateClassName:"BozzaUtils",statics:{type:{PAI:1,DIARI:2,PI:3},getUrlImpostaz:function(a){var b={};return(b[this.type.PAI]="pai/impostazioni",b[this.type.DIARI]="diari/impostazioni",b[this.type.PI]="programma/impostazioni",b)[a]},checkImpostazBozza:function(a,b){var c=this.getUrlImpostaz(b);return new Promise(function(b,e){Ext.Ajax.request({method:"GET",params:{idProfilo:a},url:"/cba/css/cs/ws/"+c+"/bozza/enabled",success:function(a){a=Ext.JSON.decode(a.responseText);
var c=a.message,d=a.data;a.success?b(d):e(c)}})})},checkBozza:function(a,b,c){c=void 0===c?-1:c;return new Promise(function(d,e){Ext.Ajax.request({method:"GET",params:{idRicovero:a,type:b,idSottoTipo:c},url:"/cba/css/cs/ws/bozza/opened",success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.message,c=a.data;a.success?d(c):e(b)}})})},insertBtnBozza:function(a,b,c,d,e){if(b){b=a&&a.lookup("BoxBottoniSpecial");var f=a.lookup("PnlBozza"),g=cssTrovaFormStd(a);if(g){var h=b.insert(0,{xtype:"button",
hidden:!0,width:165,reference:"BtnBozza",cls:"cbaCssBtnFunzione-special",text:"Abilita modalità bozza",handler:function(b){b.pressed=!b.pressed;Object.assign(a.cbaConfig,{bozza:b.pressed});b.pressed?(b.setText("Esci dalla modalità bozza"),f.showPanel()):(b.setText("Abilita modalità bozza"),f.closePanel());d(b.pressed)}});if("S"===g.permesso)g.getForm().on("dirtychange",function(b,d){var f=c(),g=!1,k=a.lookup("PnlBozza"),l=a.cbaConfig.controllerTestata;l&&l.storeRegistrazioni&&!l.cbaConfig.controllerTestata.cbaConfig.nuovoDefault&&
a.cbaConfig&&"Pai"!=a.cbaConfig.tipoTestata&&(g=l.storeRegistrazioni.getCount(),g=0==g);h.setHidden(g||cbaValidId(f)||a.bozzaExists||!d);k.setSolaLettura(d);g||(e&&d&&!cbaValidId(f)&&(h.pressed=!1,h.handler(h)),d||(h.pressed=!0,h.handler(h)))})}}},attivaBozza:function(a,b){var c=void 0===b.onClickBtnAbilitaBozza?function(){return null}:b.onClickBtnAbilitaBozza,d=(void 0===b.getIdRegistrazione?function(){return null}:b.getIdRegistrazione)(),e=!1,f=a.lookup("PnlBozza"),g=a.lookup("BtnBozza"),h=-1,k=
a.cbaConfig.controllerTestata;k&&k.storeRegistrazioni&&!k.cbaConfig.controllerTestata.cbaConfig.nuovoDefault&&(h=k.storeRegistrazioni.getCount(),e=0==h,1==h&&(e=k.storeRegistrazioni.getData().items.some(function(a){return!Ext.isEmpty(a.get("deletedData"))})));d=e||cbaValidId(d)||a.bozzaExists;g.setHidden(d);f.setSolaLettura(!1);Object.assign(a.cbaConfig,{bozza:!d});d?(g.setText("Abilita modalità bozza"),f.closePanel(),c(!1)):(g.setText("Esci dalla modalità bozza"),f.showPanel(),c(!0));g.pressed=d;
g.handler(g)},isBozza:function(a){return"B"==cssGetBlocchi(a)[1]},cssSetBozza:function(a,b){var c=this;if(!a||!a.lookup("BoxBottoniSpecial"))throw"Nessun BoxBottoniSpecial trovato!!!!";var d=a.lookup("PnlBozza");if(!d)throw"Nessun PnlBozza trovato!!!!";var e=void 0===b.getIdRegistrazione?function(){return null}:b.getIdRegistrazione,f=void 0===b.onClickBtnAbilitaBozza?function(){return null}:b.onClickBtnAbilitaBozza,g=b.idProfilo,h=b.type,k=void 0===b.bozzaOnNew?!1:b.bozzaOnNew;Object.assign(d.cbaConfig,
{getIdRegistrazione:e,callBackAfterUnLock:void 0===b.callBackAfterUnLock?function(){return null}:b.callBackAfterUnLock,callBackAfterWinRendered:void 0===b.callBackAfterWinRendered?function(){return null}:b.callBackAfterWinRendered,type:h,viewRif:b.viewRif});this.checkImpostazBozza(g,h).then(function(b){a.bozzaEnabled=b;c.insertBtnBozza(a,b,e,f,k)})["catch"](function(a){return msgShowError("",a)})}}});
Ext.define("GeneraliCS.standard.ControllerFormIO",{extend:"GeneraliCS.standard.ListaCompilatori",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:a+"#Form"},{ref:"BoxBottoni",selector:a+"#BoxBottoni"},{ref:"PnlCompilatore",selector:a+"#PnlCompilatore"},{ref:"CampoDirty",selector:a+"#CampoDirty"},{ref:"BoxBottoniSpecial",selector:a+"#BoxBottoniSpecial"}])},salvaForm:function(a,b,c){b=void 0===b?!1:b;c=void 0===c?"":c;var d=this.lookup("Form"),
e=this.lookup("CBAFormio"),f=d.getForm().getFieldValues(),g=e.getValues();this.dataRecord=this.getPnlCompilatore().getDataOraReg();g&&(g=JSON.stringify(g));delete f._tmp_dirty;delete f.dataRegAppo;delete f.oraRegAppo;var h="codiceModulo";"TestJson"!=this.cbaConfig.tipoTestata&&(h="codVideata");e.getIframe().contentWindow.scrollTo(0,0);inizioAttesa();b?(fineAttesa(!0),b={},c=Object.assign(f,(b.idRicovero=this.idRicovero,b.data=this.dataRecord,b.formResult=g,b.idVersioneModello=cbaValidId(f.id)?this.idVersione:
this.idLastVersione,b[h]=this.sottoTipoTestata,b.compilatore=this.idOperatoreLog,b.htmlRender=c,b)),this.aggiornamentoTestata=!0,cssFiltriStdOff(this),this.salvataggioRecord=!0,setRecordAgenda(c,this),controller_salvaRecord(d,c,!1,!1,!0)&&a&&this.callbackEsci&&this.callbackEsci()):e.getIframe().contentWindow.postMessage("getBase64","*")},verificaCampiForm:function(){var a,b=this.lookup("Form");a=this.lookup("CBAFormio").getError();b&&!b.isValid()&&msgAddError(a,"CAMPI_OBBLIGATORI");return msgShow("",
a)},fetchFormio:function(a,b){b=void 0===b?function(){return null}:b;this.lookup("CBAFormio").makeFormioForm(JSON.parse(a),function(){b()})},getModelloVersione:function(a){a=void 0===a?null:a;return new Promise(function(b,c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/formio/modelli/versioni/get",params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);var d=a.data,f=a.message;a.success?b(d):(msgShowError("",f),c())}})})},getJsonForm:function(){var a=this;return new Promise(function(b,
c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/formio/modelli/last",params:{modulo:a.idModuloSipcar,codVideata:a.sottoTipoTestata},success:function(a){a=Ext.JSON.decode(a.responseText);var d=a.data,f=a.message;a.success?b(d):(msgShowError("",f),c())}})})},getAnagraficaInfo:function(a,b,c){var d=null;Ext.Ajax.request({method:"GET",async:!1,url:"/cba/css/cs/ws/anagrafica/get",params:{idRicovero:a,id:b,data:c},success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.message,c=a.data;a.success?
c&&(d=c):msgShowError("",b)}});return d},getCompilatoreInfo:function(a){var b=null;Ext.Ajax.request({async:!1,method:"GET",url:"/cba/css/cs/ws/teanapers/get",params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.message,e=a.data;a.success?e&&(b=e):msgShowError("",c)}});return b},getInfoScheda:function(a){var b=null;Ext.Ajax.request({async:!1,method:"GET",url:"/cba/css/cs/ws/teanapers/get",params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.message,e=a.data;
a.success?e&&(b=e):msgShowError("",c)}});return b},getInfoTest:function(a){var b=null;Ext.Ajax.request({async:!1,method:"GET",url:"/cba/css/cs/ws/genCss/skval/moduli/get",params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.message,e=a.data;a.success?e&&(b=e):msgShowError("",c)}});return b},createHtmlPrintMode:function(a){var b=null;this.recordTestata&&this.recordTestata.get("data")?b=this.recordTestata.get("data"):this.getDataRegistrazione()&&(b=this.getDataRegistrazione().getValue());
var c=this.getAnagraficaInfo(this.idRicovero,this.codOspite,b),b=this.getCompilatoreInfo(this.idOperatoreLog),d=this.getInfoTest(this.sottoTipoTestata),e=b||{},b=e.descr,e=e.figuraProfessionale,f=c.cognome,g=c.codFisc,h=c.dataNascita,k=c.dataNascitaFormatted,l=c.nome,n=c.sesso,p=c.ricoveroDal,c=c.residenza,t="";a&&(t=this.lookup("CssAgenda").getCboxFreq().getSelection(),t=(t&&t.getData()||{}).descFreq);var d=d||{},d=void 0===d.descrModulo?traduci(this.parametriStampa.titolo):d.descrModulo,q=(new moment).hours(0).minutes(0).seconds(0).milliseconds(0),
h=moment.duration(q.diff(new moment(h))).asYears(),q=null;if(this.testataSelezionata){var r=this.recordTestata.getData(),u=r.deletedData;"DEL"==cssGetBlocchi(r.tipoBlocco)[0]&&(q='\n\t\t\t\t<div style="\n\t\t\t\t\tbackground: #c31317 !important;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\tpadding: 4px;\n\t\t\t\t\tborder-radius: 5px !important;\n\t\t\t\t\tborder: 1px solid #6f0003 !important;\n\t\t\t\t">\n\t\t\t\t\t'+traduci("CS_RECORD_ANNULLATO_DA")+" "+b+" ("+e+")\n\t\t\t\t\t"+traduci("IL_GIORNO")+
" "+(new moment(u)).format("DD/MM/YYYY HH:mm")+"\n\t\t\t\t</div>\n\t\t\t\t")}r=this.lookup("CBAFormio");a="\n                    "+(d?'\n                        <div style="width:100%;text-align: center; font-weight: bold; padding: 4px; color: #FFF; border: 1px solid #5fa2dd; border-radius: 4px;">\n                            '+(d&&d.toUpperCase()||"")+"\n                        </div>\n                    ":"")+'\n\t\t\t\t\t\n\t\t\t\t\t<div style="display: flex; flex-direction: row;margin-top: 5px; margin-bottom: 5px;">\n\t\t\t\t\t\t<div style="display: flex;flex-direction: column; flex: 1; border: 1px solid #5fa2dd; border-radius: 4px; padding: 3px;">\n\t\t\t\t\t\t\t<div>Assistito:<b>'+
f+" "+l+'</b></div>\t\n\t\t\t\t\t\t\t<div style="display: flex;flex-direction: row; justify-content:space-between;">\n\t\t\t\t\t\t\t\t<span>Codice Fiscale:'+g+"</span>\n\t\t\t\t\t\t\t\t<span>Data di nascita:"+k+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="display: flex; flex-direction: row; justify-content:space-between;">\n\t\t\t\t\t\t\t\t<span>Eta:'+Math.trunc(h)+"</span>\n\t\t\t\t\t\t\t\t<span>Data di ingresso: "+(new moment(p)).format("DD/MM/YYYY HH:mm")+"</span>\n\t\t\t\t\t\t\t\t<span>Sesso: "+
n+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="display: flex;flex-direction: row; justify-content:space-between;">\n\t\t\t\t\t\t\t\t<span>Sede: '+c.desSede+"</span>\n\t\t\t\t\t\t\t\t<span>reparto: "+c.desReparto+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style="display:flex;  margin-left: 4px;  flex-direction: column; border: 1px solid #5fa2dd; border-radius: 4px; align-items: center; justify-content:center; padding: 3px;">\n\t\t\t\t\t\t\t<label>Dati di compilazione</label>\n\t\t\t\t\t\t\t<span>'+
b+"</span>\n\t\t\t\t\t\t\t<span>("+e+")</span>\n\t\t\t\t\t\t\t<span>"+(new moment(this.getPnlCompilatore().getDataOraReg())).format("DD/MM/YYYY HH:mm").toString()+"</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t"+(q?q:"")+"\n                    "+(a?'\n                        <div style="margin-bottom: 5px;width:100%; text-align: center; font-weight: bold; padding: 4px; border: 1px solid #5fa2dd; border-radius: 4px;">\n                            Validita: '+t+"\n                        </div>\n                    ":
"")+"\n\t\t\t";r.getPrintDiv().innerHTML=a;r.print()},checkSync:function(){var a=this;return new Promise(function(b,c){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/formio/modelli/versioni/totaltosync",params:{modulo:a.idModuloSipcar,codVideata:a.sottoTipoTestata},success:function(d){d=Ext.JSON.decode(d.responseText);var e=d.message,f=d.data;d.success?(d=f&&f.length||null)&&0<d?Ext.create("inputBoxCBA",{buttonCls:"cbaCssBtnFunzione",cbaConfig:{titoloFinestra:"ATTENZIONE",testoDomanda:"INFO_NEW_VERSIONE",
closeOnConferma:!1,height:150,width:500,controller:a,statoAggiornamento:null,items:[{xtype:"label",itemId:"lblMessaggio"}],callBack:function(c){if(c.cbaConfig.statoAggiornamento)b(),c.close();else{var d=c.down("#lblMessaggio");Ext.Ajax.request({method:"GET",url:getUrlGen()+"/ws/formio/modelli/versioni/sync",params:{hideInizioAttesa:!0,modulo:a.idModuloSipcar,codVideata:a.sottoTipoTestata},success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.data;if(a.success){var e="";b.forEach(function(a){var b=
a.testo;a=a.tipo;2!=a&&(b=traduci("FORMIO_MODULO_AGGIORNATO"));c.cbaConfig.statoAggiornamento=2!=a;e+='<span style="color: '+(2==a?"red":"green")+'">'+b+"</span>"});d.setHtml(e)}}})}},callBackAnnulla:function(a){a.close();a.cbaConfig.statoAggiornamento?b():(c(),a.cbaConfig.controller.getView().up("window").close())}}}).show():b():(msgShowError("",e),c())}})})},clickCopia:function(a){0<a.storeForm.getCount()?(a.testataSelezionata=!1,a.isCopia=!0,a.getForm().getForm().findField("id").setValue(-9999),
bloccaFormCss(a.getForm(),!1,!0,[])):Messaggio("ATTENZIONE","NESSUNA_REGISTRAZIONE_SELEZIONATA","OK","QUESTION")},afterCheckSync:function(){},loadDataInForm:function(a,b){b=void 0===b?function(){return null}:b;var c=a.getData(),d=c.formResult,e=c.compilatoreNominativo,f=c.compilatoreFigProf,g=c.permessiAnnulla,h=c.tipoBlocco,c=this.lookup("Form"),h="L"==c.permesso?!0:cssHasBloccoModifica(h),k=this.lookup("CBAFormio");bloccaFormCss(c,h,!1);k.resetForm();k.setValues(Ext.JSON.decode(d),!0);k.readOnly(h);
this.getPnlCompilatore().setLabelCompilatore(e+" ("+f+")");this.getBoxBottoniSpecial()&&this.getBoxBottoniSpecial().queryById("btnConvalidaManuale")&&(d=g.includes(this.idOperatoreLog),this.getBoxBottoniSpecial().queryById("btnConvalidaManuale").setHidden(!d||h));b(h)},preLoadData:function(a,b){b=void 0===b?function(){return null}:b;var c=this,d=a.getData().idVersioneModello;this.idVersione!=d?this.getModelloVersione(d).then(function(e){e=e.jsonSchema;c.idVersione=d;c.fetchFormio(e,function(){return c.loadDataInForm(a,
b)})}):this.loadDataInForm(a,b)},canInsert:function(a){this.salvaForm(!1,!0,a)},onLaunch:function(){var a=this;this.message=function(b){b.data&&a.canInsert(b.data)};window.addEventListener("message",this.message,{passive:!1});this.callParent();this.cbaConfig.tipoTestata=this.cbaConfig.tipoTestata||"TestJson";this.sottoTipoTestata=this.cbaConfig.controllerTestata.cbaConfig.codVideata;this.idProfilo=CBA.parametriGenerali.idProfiloCss;this.idRicovero=this.cbaConfig.anagraficaCorrente.idRicovero;this.codOspite=
this.cbaConfig.anagraficaCorrente.codOspite;this.idOperatoreLog=CBA.moduli.modulo49.operatore.id;this.idLastVersione=this.idVersione=null;this.idModuloSipcar=CBA.moduli.moduloAttivo;this.lastJsonSchema=null;this.getForm().controller=this;this.cbaConfig.sottoTipoTestata=this.sottoTipoTestata;this.getForm().on("afterrender",function(){var b=a.lookup("CampoDirty");a.lookup("CBAFormio").on("dirtychangecbaformio",function(a,d){b.setValue(d?1:"")})});this.checkSync().then(function(){return a.getJsonForm()}).then(function(b){a.lastJsonSchema=
b.jsonSchema;a.lookup("CBAFormio").makeFormioForm(JSON.parse(b.jsonSchema),function(){a.aggiornaDaTestata=!0;a.idLastVersione=b.idVersione;a.idVersione=a.idLastVersione;a.cbaConfig.controllerTestata.aggiornaStore();a.afterCheckSync()})})["catch"](function(a){console.error("errore durante il fetch del jsonschema",a)})},doPrintNativeBrowser:function(){this.lookup("CBAFormio").getPrintDiv()&&this.createHtmlPrintMode()},destroy:function(){this.message&&window.removeEventListener("message",this.message,
!1);this.callParent()}});
Ext.define("GeneraliCS.standard.ControllerGenCalendarioOperatore",{extend:"Generali.standard.stampe.Controller",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DatePickerNavigate",selector:a+"#DatePickerNavigate"}]);this.control(a+"#DatePickerNavigate",{select:this.selectDatePickerNavigate})},selectDatePickerNavigate:function(a,b){this.getCalendar().setValue(b)},scrollTo8am:function(){var a=this.getCalendar(),b=setInterval(function(){a.el.isPainted&&(a.el.dom.querySelectorAll(".x-calendar-days-time").forEach(function(b){if(-1!==
b.innerHTML.indexOf("08:00")){var c=a.el.dom.querySelectorAll(".x-calendar-days-body-cell.x-scroller");0<c.length&&c[0].scrollTo(0,b.offsetTop)}}),clearInterval(b))},20)},changeSwitcher:function(a,b){"month"!==b&&(this.overrideDoCheckNowMarker(),this.highlightNowMarker(),this.scrollTo8am())},highlightNowMarker:function(){var a=this.getCalendar().down("calendar-multiview").down("calendar-daysview"),b=a.el.dom.querySelectorAll(".x-calendar-days-day-column"),c=a.markerEl,d=Ext.id()+"-marker-el";c&&(c.id=
d);b.forEach(function(a){a.style.backgroundColor="";if(c){var b=a.querySelector("#"+d);b&&-1!==b.id.indexOf("marker-el")&&(a.style.backgroundColor="rgb(255, 255, 214)")}})},overrideDoCheckNowMarker:function(){var a=this.getCalendar().down("calendar-multiview").down("calendar-daysview");Ext.override(a,{doCheckNowMarker:function(){this.lookupController().highlightNowMarker();this.callParent(arguments)}})},overrideEventElement:function(){},onLaunch:function(){this.callParent(arguments);var a=this.getCalendar().lookup("switcher");
a.firstChange=!0;a.on("change",this.changeSwitcher,this);this.overrideDoCheckNowMarker();this.overrideEventElement()},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.standard.ControllerGenSchedeValCompilatori",{extend:"GeneraliCS.standard.ControllerGenSchedeVal",init:function(){this.callParent(arguments)},onLaunch:function(){var a=this;this.getView().lookup("PnlCompilatore").on("afterrender",function(b){a.aggiungiListaCompilatori();a.initForm()})},initForm:function(){var a=this,b=cssTrovaFormStd(this);b.boxBottoni.lookup("btnNuovo");var c=b.query("[name=id]")[0];c.isInitChange||(c.isInitChange=!0,c.on("change",function(b,c){cbaValidId(c)||
a.btnCompilatori.setHidden(!0)}));b.store.on("datachanged",function(b){a.btnCompilatori.setHidden(!0);1===b.getCount()&&a.verificaCompilatori(b.getData().items[0])})},verificaCompilatori:function(a){(this.listaCompilatori=a.get("listaCompilatori"))&&1<this.listaCompilatori.length&&this.lookup("PnlCompilatore").query("#BtnHistoryCompilatori")[0].setHidden(!1)},aggiungiListaCompilatori:function(){var a=this,b=this.lookup("PnlCompilatore").items.items[0],c=b.items.items.length,d=b.getPosition(),e=b.getHeight();
this.btnCompilatori=Ext.create("Ext.Button",{itemId:"BtnHistoryCompilatori",iconCls:"btn-compilatori-css css-blu",iconAlign:"center",tooltip:traduci("LISTA_COMPILATORI"),margin:"5 20 0 0",width:32,maxHeight:32,style:{border:0,"border-radius":"100px","padding-top":"7px","padding-left":"6px","box-shadow":"1px 1px 1px #3A74A0",background:"white"},hidden:!0,listeners:{click:function(){a.apriHistoryCompilatori(a.listaCompilatori,d,e,890)}},nonDisabilitare:!0});b.insert(c+1,this.btnCompilatori)},apriHistoryCompilatori:function(a,
b,c,d){Ext.create("winCBA",{titolo:traduci("LISTA_COMPILATORI"),maximizable:!1,closable:!0,closeToolText:null,larghezzaWin:d,altezzaWin:195,name:[{xtype:"grid",itemId:"GridHistory",reference:"GridHistory",flex:1,autoScroll:!0,width:762,store:Ext.create("CS.eventi.cadute.store.History"),columns:[{xtype:"gridcolumn",flex:1,dataIndex:"id",hidden:!0},{xtype:"gridcolumn",flex:1,dataIndex:"compilatoreNominativo",text:traduci("CHI_HA_COMPILATO_SCHEDA")},{xtype:"gridcolumn",flex:1,dataIndex:"compilatoreFigProf",
text:traduci("FIGURA_PROFESSIONALE")},{xtype:"gridcolumn",flex:1,dataIndex:"compilatoreFirmatario",align:"center",sortable:!1,disabled:!1,inputValue:"T",uncheckedValue:"F",text:traduci("FIRMA_DOCUMENTO"),renderer:function(a,b,c,d,k,l,n){renderCheckColumn(b,a)}}],listeners:{afterrender:function(b){Ext.each(a,function(a){b.getStore().add(a)})}}}]}).showAt(b[0],b[1]+c)},creaHistory:function(a){var b=this,c=this.cbaConfig.controllerTestata?this.cbaConfig.controllerTestata.winRicerca:!1;if(c){var d=c.down("#FormFiltri");
d.add({xtype:"checkboxfield",itemId:"CheckHistory",reference:"CheckHistory",boxLabel:traduci("ABILITA_CONS_MOD"),cls:"cbaCssLabel",inputValue:!0,uncheckedValue:!1,margin:"5 0 0 0",listeners:{change:function(c,f,g,h){f&&Ext.create("winCBA",{name:"GeneraliCS.standard.history.view.History",maximizable:!1,titolo:traduci("HISTORY_MODIFICHE"),larghezzaWin:845,altezzaWin:630,clsWin:"cbaCssBordoPopup",configItem:{controller:b,idTe:b.testataSelezionata,filtriAttivi:d,tipo:a}}).showAt(.5*CBA.parametriGenerali.cmpTbMenu.getWidth()-
400,200)}}});c.query("#SoloOperatoreLog")[0].hidden=!0}},generaTabAllegati:function(a){a=this.getTabPanel().items.items;var b=a.length;this.getTabPanel().insert(a[b+1],Ext.create("Ext.panel.Panel",{title:traduci("ALLEGATI"),itemId:"TabAllegati",reference:"TabAllegati",layout:{type:"vbox",align:"stretch"},flex:1,autoScroll:!0,padding:5,nonDisabilitare:!0}));this.lookup("TabAllegati").add(Ext.create("GeneraliCS.standard.allegati.view.Allegati",{layout:{type:"vbox",align:"stretch"},flex:1,cbaConfig:{controllerTe:this,
tipo:"2B",hideBtnEsci:!0,codVideata:this.cbaConfig.controllerTestata.cbaConfig.codVideata}}))},aggiornaTabAllegati:function(a){this.lookup("TabAllegati").down().controller.loadAttachmentsList(a)},abilitaDisabilitaBoxBottoni:function(a){var b=this.getForm(),c=b.boxBottoni.queryById("btnNuovo"),d=b.boxBottoni.queryById("btnCopia"),e=b.boxBottoni.queryById("btnElimina"),f=b.boxBottoni.queryById("BtnStampa");a?(this.getPnlFunzioni().setDisabled(a),this.cbaConfig.controllerTestata.getContainerStorico().setDisabled(a),
b.boxBottoni.queryById("btnNuovo").setDisabled(a),b.boxBottoni.queryById("btnCopia").setDisabled(a),b.boxBottoni.queryById("btnElimina").setDisabled(a),b.boxBottoni.queryById("BtnStampa").setDisabled(a)):(this.getPnlFunzioni().setDisabled(!1),e.setDisabled(this.statoElimina),c.setDisabled(this.statoNuovo),d.setDisabled(this.statoCopia),f.setDisabled(this.statoStampa),this.cbaConfig.controllerTestata.getContainerStorico().setDisabled(!1))}});
Ext.define("GeneraliCS.standard.ControllerGenSchedeValFormIO",{extend:"GeneraliCS.standard.ControllerFormIO",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DataRegistrazione",selector:a+"#DataRegistrazione"},{ref:"ComboValidita",selector:a+"#ComboValidita"},{ref:"PnlCompilatore",selector:a+"#PnlCompilatore"},{ref:"PnlFunzioni",selector:a+"#PnlFunzioni"},{ref:"TabAndamento",selector:a+"#TabAndamento"},{ref:"InfoScadenza",selector:a+"#InfoScadenza"}]);this.control(a+
"#DataRegistrazione",{change:this.changeData});this.control(a+"#ComboValidita",{change:this.changeScadenza});this.control(a+"#InfoScadenza",{afterrender:this.afterrenderInfoScadenza})},afterCheckSync:function(){this.insertTabGrafico();this.insertTabAllegati()},showHideTabAndamento:function(a){a=void 0===a?function(){return null}:a;Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/skval/form/showandamento",params:{idVersione:this.idVersione},success:function(b){b=Ext.JSON.decode(b.responseText);var c=
b.data,d=b.message;b.success?a(c):msgShowError("",d)}})},insertTabGrafico:function(){var a=this,b=this.lookup("TabAndamento"),c=b.add(Ext.create("CS.schede.testjson.view.JsonGraph",{layout:{type:"vbox",align:"stretch"},flex:1,cbaConfig:{getIdVersione:function(){return a.idVersione},getIdRegistrazione:function(){return a.idReg},codiceModulo:this.sottoTipoTestata,idRicovero:this.idRicovero}}));b.controller=c.lookupController();this.showHideTabAndamento(function(a){b.tab.setHidden(!a)})},insertTabAllegati:function(){this.lookup("TabAllegati").add(Ext.create("GeneraliCS.standard.allegati.view.Allegati",
{layout:{type:"vbox",align:"stretch"},flex:1,cbaConfig:{controllerTe:this,tipo:"2B",hideBtnEsci:!0,codVideata:this.sottoTipoTestata}}))},afterrenderInfoScadenza:function(a){a.setMargin("16 0 0 5");this.getComboValidita().readOnly="S"!==this.cbaConfig.permesso},salvaStatoBottoni:function(){var a=this.getForm(),b=a.boxBottoni.queryById("btnNuovo"),c=a.boxBottoni.queryById("btnCopia"),d=a.boxBottoni.queryById("btnElimina"),a=a.boxBottoni.queryById("BtnStampa"),e=this.getBoxBottoniSpecial().queryById("btnConvalidaManuale");
this.statoNuovo=b.isDisabled();this.statoElimina=d.isDisabled();this.statoCopia=c.isDisabled();this.statoStampa=a.isDisabled();this.statoConvalida=e.isDisabled()},abilitaDisabilitaBoxBottoni:function(a){var b=this.getForm(),c=b.boxBottoni.queryById("btnNuovo"),d=b.boxBottoni.queryById("btnCopia"),e=b.boxBottoni.queryById("btnElimina"),b=b.boxBottoni.queryById("BtnStampa"),f=this.getBoxBottoniSpecial().queryById("btnConvalidaManuale");a?(b=this.getForm(),this.getPnlFunzioni().setDisabled(a),this.cbaConfig.controllerTestata.getContainerStorico().setDisabled(a),
b.boxBottoni.queryById("btnNuovo").setDisabled(a),b.boxBottoni.queryById("btnCopia").setDisabled(a),b.boxBottoni.queryById("btnElimina").setDisabled(a),b.boxBottoni.queryById("BtnStampa").setDisabled(a),f.setDisabled(a)):(this.getPnlFunzioni().setDisabled(!1),e.setDisabled(this.statoElimina),c.setDisabled(this.statoNuovo),d.setDisabled(this.statoCopia),b.setDisabled(this.statoStampa),f.setDisabled(this.statoConvalida),this.cbaConfig.controllerTestata.getContainerStorico().setDisabled(!1))},stampa:function(){var a=
this.getForm(),a=Ext.apply(this.parametriStampa,{params:{reportId:4010,format:"pdf",id:a.getForm().findField("id").getValue()}});Ext.apply(a.params,{});this.cbaConfig.configBtnStampa&&(Ext.applyIf(a,this.cbaConfig.configBtnStampa),this.cbaConfig.configBtnStampa.params&&Ext.applyIf(a.params,this.cbaConfig.configBtnStampa.params))},caricaValidita:function(){this.cbaConfig.testataGen&&ImpostaUrl(this.getComboValidita().getStore());this.getComboValidita().getStore().load({params:{altro:"T"}})},changeScadenza:function(a,
b,c){b=this.lookup("CssAgenda");this.getDataRegistrazione().getValue()&&calcolaDataDiScadenza(this.getDataRegistrazione().getValue(),a.selection,b.getImageInfo())},changeData:function(a){var b=this.lookup("CssAgenda");calcolaDataDiScadenza(a.getValue(),this.getComboValidita().selection,b.getImageInfo())},clickCopia:function(a){a.callParent(arguments);a.lookup("CBAFormio").readOnly(!1)},getAnagraficaInfo:function(a,b){var c=null;Ext.Ajax.request({method:"GET",async:!1,url:"/cba/css/cs/ws/anagrafica/get",
params:{idRicovero:a,id:b},success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.message,d=a.data;a.success&&d?c=d:msgShowError("",b)}});return c},getCompilatoreInfo:function(a){var b=null;Ext.Ajax.request({async:!1,method:"GET",url:"/cba/css/cs/ws/teanapers/get",params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.message,e=a.data;a.success&&e?b=e:msgShowError("",c)}});return b},getInfoTest:function(a){var b=null;Ext.Ajax.request({async:!1,method:"GET",url:"/cba/css/cs/ws/genCss/skval/moduli/get",
params:{id:a},success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.message,e=a.data;a.success&&e?b=e:msgShowError("",c)}});return b},createHtmlPrintMode:function(){var a=this.getAnagraficaInfo(this.idRicovero,this.codOspite),b=this.getCompilatoreInfo(this.compilatoreScheda),c=this.getInfoTest(this.sottoTipoTestata);cssAgenda=this.lookup("CssAgenda");var d=cssAgenda.getCboxFreq().getSelection(),e=b||{},b=e.descr,e=e.figuraProfessionale,f=a.cognome,g=a.codFisc,h=a.dataNascita,k=a.dataNascitaFormatted,
l=a.nome,n=a.sesso,p=a.ricoveroDal,a=a.residenza,d=(d&&d.getData()||{}).descFreq,t=(c||{}).descrModulo,q=(new moment).hours(0).minutes(0).seconds(0).milliseconds(0),q=moment.duration(q.diff(new moment(h))).asYears(),h=this.lookup("CBAFormio"),c='\n\t\t\t\t\t<div style="width:100%;text-align: center; font-weight: bold; padding: 4px; color: #FFF; border: 1px solid #dee2e6; border-radius: 4px;">\n\t\t\t\t\t\t'+(c&&t.toUpperCase())+'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="display: flex; flex-direction: row;margin-top: 5px; margin-bottom: 5px;">\n\t\t\t\t\t\t<div style="display: flex;flex-direction: column; flex: 1; border: 1px solid #dee2e6; border-radius: 4px; padding: 3px;">\n\t\t\t\t\t\t\t<div>Assistito:<b>'+
f+" "+l+'</b></div>\t\n\t\t\t\t\t\t\t<div style="display: flex;flex-direction: row; justify-content:space-between;">\n\t\t\t\t\t\t\t\t<span>Codice Fiscale:'+g+"</span>\n\t\t\t\t\t\t\t\t<span>Data di nascita:"+k+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="display: flex; flex-direction: row; justify-content:space-between;">\n\t\t\t\t\t\t\t\t<span>Eta:'+Math.trunc(q)+"</span>\n\t\t\t\t\t\t\t\t<span>Data di ingresso: "+(new moment(p)).format("DD/MM/YYYY HH:mm")+"</span>\n\t\t\t\t\t\t\t\t<span>Sesso: "+
n+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="display: flex;flex-direction: row; justify-content:space-between;">\n\t\t\t\t\t\t\t\t<span>Sede: '+(a&&a.desSede)+"</span>\n\t\t\t\t\t\t\t\t<span>reparto: "+(a&&a.desReparto)+"</span>\n\t\t\t\t\t\t\t\t<span>Stanza: "+(a&&a.desStanza)+'</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style="display:flex;  margin-left: 4px;  flex-direction: column; border: 1px solid #dee2e6; border-radius: 4px; align-items: center; justify-content:center; padding: 3px;">\n\t\t\t\t\t\t\t<label>Dati di compilazione</label>\n\t\t\t\t\t\t\t<span>'+
b+"</span>\n\t\t\t\t\t\t\t<span>("+e+")</span>\n\t\t\t\t\t\t\t<span>"+(new moment(this.getPnlCompilatore().getDataOraReg())).format("DD/MM/YYYY HH:mm").toString()+'</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div style="margin-bottom: 5px;width:100%; text-align: center; font-weight: bold; padding: 4px; border: 1px solid #dee2e6; border-radius: 4px;">\n\t\t\t\t\t\tValidita: '+d+"\n\t\t\t\t\t</div>\n\t\t\t";h.getPrintDiv().innerHTML=c;h.print()},onLaunch:function(){CBA.moduli.modulo49.dizionarioLogVideate[this.$className]=
{desVideata:this.cbaConfig.desVideata?this.cbaConfig.desVideata:this.cbaConfig.controllerTestata.cbaConfig.desVideata?this.cbaConfig.controllerTestata.cbaConfig.desVideata:this.cbaConfig.controllerTestata.cbaConfig.codVideata};doLogVideata(this.view,{className:this.$className,desVideata:this.cbaConfig.desVideata?this.cbaConfig.desVideata:this.cbaConfig.controllerTestata.cbaConfig.desVideata?this.cbaConfig.controllerTestata.cbaConfig.desVideata:this.cbaConfig.controllerTestata.cbaConfig.codVideata,
logOspite:!0});this.callParent(arguments)},doPrintNativeBrowser:function(){this.lookup("CBAFormio").getPrintDiv()&&this.createHtmlPrintMode()},previewButtonClick:function(a){if(2==a.cbaConfig.type)return this.doPrintNativeBrowser(),!1;this.callParent(arguments)},doPrint:function(a,b){this.stampa();this.callParent([a,b])}});
Ext.define("GeneraliCS.standard.ControllerTranscodifica",{extend:"Generali.standard.stampe.Controller",constructor:function(a){this.callParent([a])},init:function(){this.callParent(arguments)},aggiornaTransIcf:function(a){var b=this,c=b.storeImpostazioni.id?b.storeImpostazioni.id:b.storeImpostazioni.getAt(0).data.id;Ext.suspendLayouts();Ext.each(b.campiDomandeTrans_campo,function(a){imgTitleFieldset(a,"/cba/generali/images/16/tree/css/foglia-vuota-16.png")});Ext.resumeLayouts();c={idTabella:b.idTabellaIcf,
idImpostaz:c,idProfilo:b.idProfilo};a&&Ext.apply(c,{id:a});b.storeTransDati.clearFilter();b.storeTransDati.load({params:c,callback:function(a,c,f){if(f){if(!Ext.isEmpty(a)){b.verificaTransRisposte(a);var d=[],e;Ext.each(a,function(a){e=a.get("idCampo");-1==d.indexOf(e)&&d.push(e)});var k=[];Ext.each(d,function(a){b.storeTransDati.filter("idCampo",a);b.storeTransDati.each(function(b){(b.get("icfQualificatore")||"-999"==b.get("icf"))&&k.push(a)});b.storeTransDati.clearFilter()});Ext.suspendLayouts();
Ext.each(b.campiDomandeTrans_campo,function(a,c){var d=-1!=k.indexOf(b.campiDomandeTrans_idCampo[c]);a.cbaConfig.idCampo=b.campiDomandeTrans_idCampo[c];d=imgTitleFieldset(a,d?"/cba/generali/images/16/tree/css/foglia-piena-16.png":"/cba/generali/images/16/tree/css/foglia-vuota-16.png",function(){if("S"==b.permessiIcf||"L"==b.permessiIcf){var d=b.campiDomandeTrans_idCampo[c],e=b.storeTransDati.getAt(b.storeTransDati.findExact("idCampo",d));null!=e&&"-999"==e.get("icf")?b.apriWinIcf(d):b.getForm().cbaConfig.lock?
creaToolTipBubble(this.id,traduci("IMPOSSIBILE_INSERIRE_ICF_RECORD_BLOCCATO"),null,null,null,null,null,null,null,"W"):"S"==b.permessiIcf?b.apriWinTranscodifica(d,a):creaToolTipBubble(this.id,traduci("NON_DISPONE_PERMESSI_ICF"),null,null,null,null,null,null,null,"W")}});"N"==b.permessiIcf&&creaToolTipBubble(d.id,traduci("NON_DISPONE_PERMESSI_ICF"),null,null,null,null,null,null,null,"W")});Ext.resumeLayouts()}}else msgShowError("",c.getError())}})},elaboraStoreIcf:function(){this.transcodificaRisposteAttiva&&
this.trovaCampiRispostaCompilati();var a=[];Ext.each(this.storeTransDati.getData().items,function(b){a.push(b.data)});return a},apriWinTranscodifica:function(a,b){this.storeTransDati.filterBy(function(b){return b.get("idCampo")===a&&Ext.isEmpty(b.get("valoreRisposta"))});var c=this.storeTransDati.getData().items;this.storeTransDati.clearFilter();var d=traduci("TRANSCODIFICA").toUpperCase()+" - "+traduci(b.title).toUpperCase();if(this.transcodificaRisposteAttiva){var e=[],f=this.getForm().getForm().getFieldValues(),
g=f[b.cbaConfig.campoRispostaTrans],h=[];if(g)h.push(g+"");else{var g=[],k;for(k in f)-1!=k.indexOf(b.cbaConfig.campoRispostaTrans)&&g.push(k);Ext.each(g,function(a){f[a]&&h.push(a.split("_")[3]+"")})}if(0<h.length){this.storeTransDati.filterBy(function(b){return b.get("idCampo")===a&&-1!=h.indexOf(b.get("valoreRisposta"))});e=this.storeTransDati.getData().items;this.storeTransDati.clearFilter();var l=this.getForm().getForm();k=l.findField(b.cbaConfig.campoRispostaTrans)?"radio":"check";var n;"check"==
k?Ext.each(h,function(a,c){if(n=l.findField("_tmp_"+b.cbaConfig.campoRispostaTrans+"_"+a))0==c?d+=" ( ":0!=c&&c!=h.length&&(d+=", "),d+=n.boxLabel,c==h.length-1&&(d+=" )"),85<d.length&&(d=d.substr(0,80)+"... )")}):"radio"==k&&(n=l.findField(b.cbaConfig.campoRispostaTrans))&&(d+=" ( "+n.boxLabel+" )")}}Ext.create("CSS_winCBA",{name:"CS.anamnesi.transcodifica.view.TranscodificaIcfQual",titolo:d,visualizzaAnagrafica:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data,configItem:{permesso:"S",controllerTe:this,
items:c,iconaIcf:b.cssIcon,itemsRisposte:this.transcodificaRisposteAttiva&&0<e.length?e:!1}}).cssDefaultShow()},apriWinIcf:function(a){var b=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data;Ext.create("CSS_winCBA",{name:"CS.icf.view.Icf",titolo:traduci("FUNZIONAMENTO").toUpperCase(),visualizzaAnagrafica:b,configItem:{permesso:"S",codOspitePopUp:b.codOspite,nominativoPopUp:b.cognome+b.nome,desVideata:"Funzionamento",evidenziaTranscodifiche:{idCampo:a,idColl:this.storeForm.getAt(0).get("id"),idTabella:this.idTabellaIcf}}}).cssDefaultShow()},
transAutoRisposta:function(a,b){if(!a||0==a.length)return!1;var c=this,d=!0;c.storeTransDati.filterBy(function(a){return a.get("idCampo")===b&&!a.get("valoreRisposta")});var e=c.storeTransDati.getData().items;Ext.each(e,function(a){a.get("icfQualificatore")&&(d=!1)});c.storeTransDati.clearFilter();if(d){var f,g;Ext.each(a,function(a){f=[];g=[];c.storeTransDati.filterBy(function(c){return c.get("idCampo")===b&&c.get("valoreRisposta")==a});Ext.each(c.storeTransDati.getData().items,function(a){f.push(a.get("icf"));
c.storeTransDati.insert(0,{idCampo:a.get("idCampo"),icf:a.get("icf"),descrizione:a.get("descrizione"),icfQualificatore:a.get("icf")+"."+a.get("qualificatoreRisposta"),valoreRisposta:null})});c.storeTransDati.clearFilter();0<f.length&&(c.storeTransDati.each(function(a){-1==f.indexOf(a.get("icf"))||a.get("icfQualificatore")||a.get("valoreRisposta")||a.get("idCampo")!==b||g.push(a)}),c.storeTransDati.remove(g))})}c.storeTransDati.clearFilter()},trovaCampiRispostaCompilati:function(){var a=this,b=a.campiDomandeTrans_campo,
c=a.getForm().getForm().getFieldValues();Ext.each(b,function(b){var d=c[b.cbaConfig.campoRispostaTrans];if(d)a.transAutoRisposta([d],b.cbaConfig.idCampo);else{var d=[],f=[],g;for(g in c)-1!=g.indexOf(b.cbaConfig.campoRispostaTrans)&&d.push(g);Ext.each(d,function(a){c[a]&&f.push(a.split("_")[3]+"")});0<f.length&&a.transAutoRisposta(f,b.cbaConfig.idCampo)}})},verificaTransRisposte:function(a){var b=this;b.transcodificaRisposteAttiva=!1;Ext.each(a,function(a){if(a.get("qualificatoreRisposta"))return b.transcodificaRisposteAttiva=
!0,!1})}});
Ext.define("GeneraliCS.standard.ControllerTranscodificaCompilatori",{extend:"GeneraliCS.standard.ListaCompilatori",constructor:function(a){this.callParent([a])},init:function(){this.callParent(arguments)},aggiornaTransIcf:function(a){var b=this,c=b.storeImpostazioni.id?b.storeImpostazioni.id:b.storeImpostazioni.getAt(0).data.id;Ext.suspendLayouts();Ext.each(b.campiDomandeTrans_campo,function(a){imgTitleFieldset(a,"/cba/generali/images/16/tree/css/foglia-vuota-16.png")});Ext.resumeLayouts();c={idTabella:b.idTabellaIcf,
idImpostaz:c,idProfilo:b.idProfilo};a&&Ext.apply(c,{id:a});b.storeTransDati.clearFilter();b.storeTransDati.load({params:c,callback:function(a,c,f){if(f){if(!Ext.isEmpty(a)){b.verificaTransRisposte(a);var d=[],e;Ext.each(a,function(a){e=a.get("idCampo");-1==d.indexOf(e)&&d.push(e)});var k=[];Ext.each(d,function(a){b.storeTransDati.filter("idCampo",a);b.storeTransDati.each(function(b){(b.get("icfQualificatore")||"-999"==b.get("icf"))&&k.push(a)});b.storeTransDati.clearFilter()});Ext.suspendLayouts();
Ext.each(b.campiDomandeTrans_campo,function(a,c){var d=-1!=k.indexOf(b.campiDomandeTrans_idCampo[c]);a.cbaConfig.idCampo=b.campiDomandeTrans_idCampo[c];d=imgTitleFieldset(a,d?"/cba/generali/images/16/tree/css/foglia-piena-16.png":"/cba/generali/images/16/tree/css/foglia-vuota-16.png",function(){if("S"==b.permessiIcf||"L"==b.permessiIcf){var d=b.campiDomandeTrans_idCampo[c],e=b.storeTransDati.getAt(b.storeTransDati.findExact("idCampo",d));null!=e&&"-999"==e.get("icf")?b.apriWinIcf(d):b.getForm().cbaConfig.lock?
creaToolTipBubble(this.id,traduci("IMPOSSIBILE_INSERIRE_ICF_RECORD_BLOCCATO"),null,null,null,null,null,null,null,"W"):"S"==b.permessiIcf?b.apriWinTranscodifica(d,a):creaToolTipBubble(this.id,traduci("NON_DISPONE_PERMESSI_ICF"),null,null,null,null,null,null,null,"W")}});"N"==b.permessiIcf&&creaToolTipBubble(d.id,traduci("NON_DISPONE_PERMESSI_ICF"),null,null,null,null,null,null,null,"W")});Ext.resumeLayouts()}}else msgShowError("",c.getError())}})},elaboraStoreIcf:function(){this.transcodificaRisposteAttiva&&
this.trovaCampiRispostaCompilati();var a=[];Ext.each(this.storeTransDati.getData().items,function(b){a.push(b.data)});return a},apriWinTranscodifica:function(a,b){this.storeTransDati.filterBy(function(b){return b.get("idCampo")===a&&Ext.isEmpty(b.get("valoreRisposta"))});var c=this.storeTransDati.getData().items;this.storeTransDati.clearFilter();var d=traduci("TRANSCODIFICA").toUpperCase()+" - "+traduci(b.title).toUpperCase();if(this.transcodificaRisposteAttiva){var e=[],f=this.getForm().getForm().getFieldValues(),
g=f[b.cbaConfig.campoRispostaTrans],h=[];if(g)h.push(g+"");else{var g=[],k;for(k in f)-1!=k.indexOf(b.cbaConfig.campoRispostaTrans)&&g.push(k);Ext.each(g,function(a){f[a]&&h.push(a.split("_")[3]+"")})}if(0<h.length){this.storeTransDati.filterBy(function(b){return b.get("idCampo")===a&&-1!=h.indexOf(b.get("valoreRisposta"))});e=this.storeTransDati.getData().items;this.storeTransDati.clearFilter();var l=this.getForm().getForm();k=l.findField(b.cbaConfig.campoRispostaTrans)?"radio":"check";var n;"check"==
k?Ext.each(h,function(a,c){if(n=l.findField("_tmp_"+b.cbaConfig.campoRispostaTrans+"_"+a))0==c?d+=" ( ":0!=c&&c!=h.length&&(d+=", "),d+=n.boxLabel,c==h.length-1&&(d+=" )"),85<d.length&&(d=d.substr(0,80)+"... )")}):"radio"==k&&(n=l.findField(b.cbaConfig.campoRispostaTrans))&&(d+=" ( "+n.boxLabel+" )")}}Ext.create("CSS_winCBA",{name:"CS.anamnesi.transcodifica.view.TranscodificaIcfQual",titolo:d,visualizzaAnagrafica:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data,configItem:{permesso:"S",controllerTe:this,
items:c,iconaIcf:b.cssIcon,itemsRisposte:this.transcodificaRisposteAttiva&&0<e.length?e:!1}}).cssDefaultShow()},apriWinIcf:function(a){var b=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data;Ext.create("CSS_winCBA",{name:"CS.icf.view.Icf",titolo:traduci("FUNZIONAMENTO").toUpperCase(),visualizzaAnagrafica:b,configItem:{permesso:"S",codOspitePopUp:b.codOspite,nominativoPopUp:b.cognome+b.nome,desVideata:"Funzionamento",evidenziaTranscodifiche:{idCampo:a,idColl:this.storeForm.getAt(0).get("id"),idTabella:this.idTabellaIcf}}}).cssDefaultShow()},
transAutoRisposta:function(a,b){if(!a||0==a.length)return!1;var c=this,d=!0;c.storeTransDati.filterBy(function(a){return a.get("idCampo")===b&&!a.get("valoreRisposta")});var e=c.storeTransDati.getData().items;Ext.each(e,function(a){a.get("icfQualificatore")&&(d=!1)});c.storeTransDati.clearFilter();if(d){var f,g;Ext.each(a,function(a){f=[];g=[];c.storeTransDati.filterBy(function(c){return c.get("idCampo")===b&&c.get("valoreRisposta")==a});Ext.each(c.storeTransDati.getData().items,function(a){f.push(a.get("icf"));
c.storeTransDati.insert(0,{idCampo:a.get("idCampo"),icf:a.get("icf"),descrizione:a.get("descrizione"),icfQualificatore:a.get("icf")+"."+a.get("qualificatoreRisposta"),valoreRisposta:null})});c.storeTransDati.clearFilter();0<f.length&&(c.storeTransDati.each(function(a){-1==f.indexOf(a.get("icf"))||a.get("icfQualificatore")||a.get("valoreRisposta")||a.get("idCampo")!==b||g.push(a)}),c.storeTransDati.remove(g))})}c.storeTransDati.clearFilter()},trovaCampiRispostaCompilati:function(){var a=this,b=a.campiDomandeTrans_campo,
c=a.getForm().getForm().getFieldValues();Ext.each(b,function(b){var d=c[b.cbaConfig.campoRispostaTrans];if(d)a.transAutoRisposta([d],b.cbaConfig.idCampo);else{var d=[],f=[],g;for(g in c)-1!=g.indexOf(b.cbaConfig.campoRispostaTrans)&&d.push(g);Ext.each(d,function(a){c[a]&&f.push(a.split("_")[3]+"")});0<f.length&&a.transAutoRisposta(f,b.cbaConfig.idCampo)}})},verificaTransRisposte:function(a){var b=this;b.transcodificaRisposteAttiva=!1;Ext.each(a,function(a){if(a.get("qualificatoreRisposta"))return b.transcodificaRisposteAttiva=
!0,!1})}});
Ext.define("GeneraliCS.standard.allegati.controller.Allegati",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridAttachments",selector:a+"#GridAttachments"},{ref:"LabelHintAttachment",selector:a+"#LabelHintAttachment"},{ref:"PreviewAllegato",selector:a+"#PreviewAllegato"},{ref:"BtnNuovo",selector:a+"#BtnNuovo"},{ref:"BtnDownload",selector:a+"#BtnDownload"},{ref:"BtnElimina",selector:a+"#BtnElimina"},{ref:"BtnEsci",
selector:a+"#BtnEsci"}]);this.control(a+"#GridAttachments",{select:this.selectGridAttachments});this.control(a+"#BtnNuovo",{click:this.clickBtnAllega});this.control(a+"#BtnDownload",{click:this.clickBtnDownload});this.control(a+"#BtnElimina",{click:this.clickBtnElimina});this.control(a+"#BtnEsci",{click:this.clickBtnEsci})},clickBtnAllega:function(){this.idTestata||"2B"!=this.cbaConfig.tipo||(this.idTestata=this.cbaConfig.controllerTe.idTestataPerAllegato);Ext.create("winCBA",{name:"GeneraliCS.standard.allegati.view.WinAllega",
titolo:"INSERIMENTO_ALLEGATO",maximizable:!1,minWidth:300,maxHight:400,larghezzaWin:450,closable:!1,layout:"fit",clsWin:"cbaCssBordoPopup",configItem:{controllerTabAllegati:this,tipo:this.cbaConfig.tipo,tipoVideo:this.cbaConfig.tipoVideo}}).show()},clickBtnDownload:function(){var a=this.getGridAttachments().getSelectionModel().getSelection()[0];a&&("4B"===a.get("tipo")?window.open(a.get("nomeFile")):openAttachment(a.get("id")))},clickBtnElimina:function(){var a=this.getGridAttachments().getSelectionModel().getSelection()[0];
a&&this.deleteAttachment(a)},clickBtnEsci:function(){("2E"===this.cbaConfig.tipo||"2C"===this.cbaConfig.tipo||"5A"===this.cbaConfig.tipo||"2G"===this.cbaConfig.tipo)&&this.cbaConfig.controllerTe&&this.cbaConfig.controllerTe.updateNotification&&this.cbaConfig.controllerTe.updateNotification(this.getGridAttachments().getStore().getTotalCount());"2E"!==this.cbaConfig.tipo&&"2G"!==this.cbaConfig.tipo||this.cbaConfig.controllerTe.aggiornaStore(this.cbaConfig.controllerTe.idPerAllegato);this.getGridAttachments().up("window").close()},
selectGridAttachments:function(a,b){var c=this;!this.cbaConfig.controllerTe||"Diari"!=this.cbaConfig.controllerTe.cbaConfig.tipoTestata&&"Referti"!=this.cbaConfig.controllerTe.cbaConfig.tipoTestata||(b.get("deletedData")?this.getBtnDownload().setDisabled(!0):this.getBtnDownload().setDisabled(!1));var d=this.getPreviewAllegato(),e="";b.get("tipo")===this.cbaConfig.tipo?Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/allegati/link",params:{id:b.get("id")},success:function(a){a=Ext.JSON.decode(a.responseText);
if(a.success&&!Ext.isEmpty(a.data)){var b=a.data.fileType.toLowerCase().toLowerCase();"jpg"===b||"jpeg"===b||"png"===b||"gif"===b||"pdf"===b||"mp4"===b||"m4v"===b?(e='<iframe class="animated fadeIn" width="100%" height="100%" style="border:none !important; padding: 8px;"src="'+(getPathServer()+a.data.filePath)+'"></iframe>',d.setHtml(e)):d.setHtml('<div style="margin-top:80px;text-align:center"><h3>'+traduci("NO_ANTEPRIMA")+"</h3></div>");(c.cbaConfig.solaLettura||c.cbaConfig.tipoBlocco&&("A"===c.cbaConfig.tipoBlocco[0].valore||
"C"===c.cbaConfig.tipoBlocco[0].valore))&&c.getBtnElimina().setDisabled(!0)}}}):this.cbaConfig.ingressoDaPortlet||(e='<iframe  class="animated  fadeIn" width="100%" style="border:none !important; padding: 8px;" height="100%" src="'+b.get("nomeFile")+'"></iframe>',d.setHtml(e))},deleteAttachment:function(a){var b=this;(a=a.get("id"))&&cbaValidId(a)&&controller_eliminaRecord(this.getGridAttachments().getStore(),{id:a},function(){b.loadAttachmentsList()},!1,"MSG_ANNULLA_ALLEGATO","ANNULLA_RECORD")},
loadAttachmentsList:function(a){var b=this;a&&(this.idTestata=a);var c=this.getGridAttachments();a=c.getStore();var d=CBA.moduli.modulo49.operatore.id;if(Ext.isDefined(this.cbaConfig.controllerTe)&&"2E"!==this.cbaConfig.tipo){var e=this.cbaConfig.controllerTe;this.getBtnNuovo().setHidden("L"==e.cbaConfig.permesso||e.recordTestata&&e.recordTestata.get("compilatore")!=d)}"5A"===this.cbaConfig.tipo&&(d=this.cbaConfig.controllerTe.getGrid().getSelectionModel().getSelected().items[0].get("tipoBlocco")[0].valore,
this.getBtnNuovo().setDisabled("A"==d||"C"==d));this.getPreviewAllegato().setHtml();d={idTestata:this.idTestata,tipo:this.cbaConfig.tipoVideo?[this.cbaConfig.tipo,this.cbaConfig.tipoVideo]:this.cbaConfig.tipo};this.cbaConfig.codVideata&&Ext.apply(d,{codVideata:this.cbaConfig.codVideata});a.load({params:d,callback:function(a,d,e){e?(Ext.isEmpty(a)&&b.cbaConfig.obbligaAllegato&&b.getBtnEsci().setDisabled(!0),c.getSelectionModel().deselectAll(),c.getSelectionModel().select(0)):msgShowError("",d.getError())}})},
onLaunch:function(){this.idTestata=this.idTestata?this.idTestata:this.cbaConfig.idTestata;this.getGridAttachments().cbaConfig.btnElimina=this.getBtnElimina();this.cbaConfig.controllerTe&&(this.cbaConfig.controllerTe.cbaConfig.controllerAllegati=this);"4A"===this.cbaConfig.tipo&&this.cbaConfig.tipoVideo&&this.cbaConfig.controllerTe.campiAbilitati.tipologia&&(this.cbaConfig.tipoVideo=null);this.idTestata&&this.loadAttachmentsList();if(this.cbaConfig.solaLettura||this.cbaConfig.tipoBlocco&&("A"===this.cbaConfig.tipoBlocco[0].valore||
"C"===this.cbaConfig.tipoBlocco[0].valore))this.getBtnNuovo().setDisabled(!0),this.getBtnElimina().setDisabled(!0)}});
Ext.define("GeneraliCS.standard.allegati.controller.WinAllega",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"DescBreve",selector:a+"#DescBreve"},{ref:"Attachment",selector:a+"#Attachment"},{ref:"LabelHintAttachment",selector:a+"#LabelHintAttachment"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"PercorsoVideo",selector:a+"#PercorsoVideo"},{ref:"LabelHintAttachmentVideo",selector:a+"#LabelHintAttachmentVideo"},
{ref:"AttachmentVideo",selector:a+"#AttachmentVideo"},{ref:"DescVideo",selector:a+"#DescVideo"},{ref:"FieldVideo",selector:a+"#FieldVideo"},{ref:"CntAllegaFile",selector:a+"#CntAllegaFile"},{ref:"CheckAllegaVideo",selector:a+"#CheckAllegaVideo"}]);this.control(a+"#DescBreve",{change:this.changeDescBreve});this.control(a+"#Attachment",{change:this.changeAttachment});this.control(a+"#PercorsoVideo",{change:this.changePercorsoVideo});this.control(a+"#AttachmentVideo",{click:this.clickAttachmentVideo});
this.control(a+"#DescVideo",{change:this.changeDescVideo});this.control(a+"#PercorsoVideo",{change:this.changePercorsoVideo});this.control(a+"#CheckAllegaVideo",{change:this.changeCheckAllegaVideo});this.control(a+"#BtnEsci",{click:function(a){a.up("window").close()}})},changeCheckAllegaVideo:function(a,b){b&&(this.getDescBreve().setValue(),this.getAttachment().setDisabled(!0));this.getFieldVideo().setHidden(!b);this.getDescVideo().setValue();this.getPercorsoVideo().setValue();this.getCntAllegaFile().setDisabled(b)},
changePercorsoVideo:function(a,b){this.getAttachmentVideo().setDisabled(Ext.isEmpty(b)||!Ext.isEmpty(b)&&Ext.isEmpty(this.getDescVideo().getValue()))},changeDescVideo:function(a,b){this.getAttachmentVideo().setDisabled(Ext.isEmpty(b)||!Ext.isEmpty(b)&&Ext.isEmpty(this.getPercorsoVideo().getValue()))},clickAttachmentVideo:function(a){var b=this;this.getDescVideo().getValue();a=this.getPercorsoVideo().getValue();var c=this.cbaConfig.controllerTabAllegati.idTestata;this.getDescVideo().up("form");var d=
[],d=[],e="",e=0;Ext.isEmpty(a)&&msgAddError(d,traduci("MSG_CAMPO_LINKVIDEO"));if(0<d.length)return msgShow("ATTENZIONE",d),!1;-1<a.indexOf("watch")?(d=a.split("v="),e=d.length,e=-1<d[e-1].indexOf("t")?"https://www.youtube.com/embed/"+d[e-1].split("&")[0]:"https://www.youtube.com/embed/"+d[e-1]):e=-1<a.indexOf("embed")?a:"https://www.youtube.com/embed/"+a.split("/")[3];a={idRicovero:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero,compilatore:CBA.moduli.modulo49.operatore.id,idTestata:c,
descrizione:this.getDescVideo().getValue(),nomeFile:e,tipo:this.cbaConfig.tipoVideo};var f=Ext.MessageBox.wait(traduci("TRASFERIMENTO_FILE"),traduci("TRASFERIMENTO_FILE"));Ext.Ajax.request({method:"POST",url:"/cba/css/cs/ws/allegati/uploadVideo",jsonData:Ext.JSON.encode(a),success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(msgShowText("TRASFERIMENTO_FILE",a.message),f.hide(),b.cbaConfig.controllerTabAllegati.loadAttachmentsList()):msgShowError("",a.message);b.getDescVideo().up("window").close()}})},
changeDescBreve:function(a,b){var c=!Ext.isEmpty(b);this.getAttachment().setDisabled(!c);this.getLabelHintAttachment().setHidden(c);this.getLabelHintAttachmentVideo().setHidden(c);this.getFieldVideo().setDisabled(c)},changeAttachment:function(a,b){var c=this,d=b.lastIndexOf("\\")||b.lastIndexOf("/");b=b.substring(d+1);CBA.moduli.modulo49.storeAnagraficaSel.getAt(0);var e=this.getDescBreve().getValue(),f=this.cbaConfig.controllerTabAllegati.idTestata,g=this.cbaConfig.controllerTabAllegati.cbaConfig.codVideata,
d=this.getAttachment().up("form");!Ext.isEmpty(b)&&d.isValid()&&(d="/cba/css/cs/ws/allegati/upload?id=-9999&nomeFile="+b+("&idRicovero="+CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero),d=d+("&descrizione="+e)+("&idTestata="+f),d+="&tipo="+this.cbaConfig.tipo,d+="&compilatore="+CBA.moduli.modulo49.operatore.id,g&&(d+="&codVideata="+g),e=a.fileInputEl.dom.files[0],f=new FormData,f.append("file",e),Ext.Ajax.request({url:d,method:"POST",rawData:f,headers:{"Content-Type":null},success:function(a){a=
Ext.JSON.decode(a.responseText);a.success?(msgShowText("TRASFERIMENTO_FILE",a.message),c.getDescBreve().setValue(),c.cbaConfig.controllerTabAllegati.loadAttachmentsList(),c.cbaConfig.controllerTabAllegati.cbaConfig.obbligaAllegato&&c.cbaConfig.controllerTabAllegati.getBtnEsci().setDisabled(!1)):msgShowError("",a.message);c.getDescBreve().up("window").close()}}))},onLaunch:function(){"4A"===this.cbaConfig.tipo&&this.cbaConfig.tipoVideo&&"4B"===this.cbaConfig.tipoVideo&&this.getCheckAllegaVideo().setHidden(!1)}});
Ext.define("GeneraliCS.standard.allegati.controller.WinAllegaFileAic",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Attachment",selector:a+"#Attachment"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"CntAllegaFile",selector:a+"#CntAllegaFile"}]);this.control(a+"#Attachment",{change:this.changeAttachment});this.control(a+"#BtnEsci",{click:function(a){a.up("window").close()}})},esci:function(){this.cbaConfig.controllerProntuario.aggiornaStore();
this.getAttachment().up("window").close()},changeAttachment:function(a,b){var c=this,d=this.getAttachment().up("form");if(!Ext.isEmpty(b)&&d.isValid()){var d="/cba/css/cs/ws/genCss/farmadati/prontuario/importaElencoDaPn?idOrganizzazione="+getIdOrg(),e=filefield.fileInputEl.dom.files[0],f=new FormData;f.append("file",e);Ext.Ajax.request({url:d,method:"POST",rawData:f,headers:{"Content-Type":null},success:function(a){a=Ext.JSON.decode(a.responseText);if(a.success){var b="";Ext.each(a.data,function(a){0==
a.codice&&(b+=a.extra+": "+a.valore+"<BR>")});""!=b?Messaggio("ATTENZIONE","Alcuni farmaci non sono stati inseriti:<BR>"+b,"OK",c.esci()):(c.cbaConfig.controllerProntuario.aggiornaStore(),c.getAttachment().up("window").close())}else msgShowError("",a.message)}})}},onLaunch:function(){}});
Ext.define("GeneraliCS.standard.allegati.store.Allegati",{extend:"Ext.data.Store",fields:[{name:"nomeFile"},{name:"descrizione"},{name:"tipo"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/allegati/listByTipo",api:{read:"/cba/css/cs/ws/allegati/listByTipo",destroy:"/cba/css/cs/ws/allegati/delete"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.standard.allegati.store.TipoAllegato",{extend:"Ext.data.Store",fields:[{name:"tipo"},{name:"icona"}],data:[["svg","allegato-img"],["png","allegato-img"],["jpg","allegato-img"],["jpeg","allegato-img"],["mpeg","allegato-video"],["divx","allegato-video"],["avi","allegato-video"],["wmv ","allegato-video"],["pdf","allegato-pdf"],["mp3","allegato-audio"]],autoDestroy:!0});
Ext.define("GeneraliCS.standard.allegati.view.Allegati",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var a=Ext.create("GeneraliCS.standard.allegati.store.TipoAllegato");Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},bodyPaddin:8,flex:1,items:[{xtype:"CBAGridAnnullabile",itemId:"GridAttachments",reference:"GridAttachments",flex:1,border:1,store:Ext.create("GeneraliCS.standard.allegati.store.Allegati"),
autoScroll:!0,hideHeaders:!0,emptyText:traduci("NESSUN_ALLEGATO"),margin:"3 5 0 5",hideCompilatore:!0,columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",width:45,renderer:function(b,c,d,e,f,g){b=d.get("nomeFile").substr(d.get("nomeFile").lastIndexOf(".")+1);return(b=trovaRecord(a,"tipo",b))?"<img src='/cba/css/generali/images/generali/"+b.get("icona")+".svg'  height='20' width='20' />":"4B"==d.get("tipo")?"<img src='/cba/css/generali/images/generali/allegato-video.svg' height='20' width='20' />":
"<img src='/cba/css/generali/images/generali/allegato-file.svg'  height='20' width='20' />"}},{xtype:"gridcolumn",width:200,dataIndex:"descrizione"},{xtype:"gridcolumn",flex:1,dataIndex:"nomeFile"}],dockedItems:[{xtype:"toolbar",dock:"top",style:"border:none !important",layout:{type:"hbox",align:"stretch"},items:[{xtype:"label",text:"MSG_NO_ALLEGATI_STAMPA_CARTELLA",margin:"0 10 0 1",cls:"cbaCssLabel",style:{"font-weight":"bold"},flex:1},{xtype:"CSSButtonsPanel",height:30,margin:"0 0 0 0",items:[{xtype:"tbfill",
flex:1},{xtype:"tbfill",flex:1},{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",text:"NUOVO",cls:"cbaCssBtnFunzione",nonDisabilitare:!0,margin:"0 0 0 1"},{xtype:"button",itemId:"BtnDownload",reference:"BtnDownload",textHint:traduci("SCARICA_ALLEGATO"),margin:"0 0 0 1",cls:"cbaCssBtnFunzione",iconCls:"box-download-css",nonDisabilitare:!0},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",margin:"0 0 0 1",cls:"cbaCssBtnFunzione",nonDisabilitare:!0,text:"ELIMINA"},{xtype:"button",itemId:"BtnEsci",
reference:"BtnEsci",margin:"0 0 0 1",cls:"cbaCssBtnFunzione",nonDisabilitare:!0,text:"ESCI",hidden:this.cbaConfig.hideBtnEsci}]}]}],viewConfig:{loadMask:!1}},{xtype:"fieldset",itemd:"PreviewAllegato",reference:"PreviewAllegato",hidden:this.cbaConfig.ingressoDaPortlet,margin:"10 5 5 5",title:"ANTEPRIMA_ALLEGATO",flex:1}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.standard.allegati.view.WinAllega",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"form",itemId:"FormAttachments",reference:"FormAttachments",layout:{type:"vbox",align:"stretch"},flex:1,margin:5,border:0,items:[{xtype:"container",itemId:"CntAllegaFile",reference:"CntAllegaFile",layout:{type:"vbox",align:"stretch"},flex:1,margin:"0 0 3 0",
items:[{xtype:"textfield",itemId:"DescBreve",reference:"DescBreve",name:"descrizione",fieldLabel:"DESC_BREVE",labelClsExtra:"cbaCssLabel",labelWidth:130,maxLength:100,enforceMaxLength:!0,isFormField:!1},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"label",itemId:"LabelHintAttachment",reference:"LabelHintAttachment",text:traduci("INSERISCI_DESC_BREVE_POI_ALLEGA"),margin:"5 0 0 0",cls:"cbaCssLabel"},{xtype:"container",flex:1},{xtype:"container",layout:{type:"hbox"},width:90,items:[{xtype:"filefield",
itemId:"Attachment",reference:"Attachment",name:"nomeFile",width:80,msgTarget:"side",buttonText:traduci("ALLEGA"),disabled:!0,buttonOnly:!0,nonDisabilitare:!0,buttonConfig:{cls:"cbaCssBtnFunzione",width:90},listeners:{afterrender:function(a){a.fileInputEl.set({accept:StdSipcar.getValidExtensions()})}}}]}]}]},{xtype:"checkbox",margin:"12 0 0 0",itemId:"CheckAllegaVideo",reference:"CheckAllegaVideo",boxLabel:"ALLEGA_VIDEO",cls:"cbaCssLabel",inputValue:"T",hidden:!0},{xtype:"fieldset",collapsible:!0,
hidden:!0,margin:"5 0 5 0",itemId:"FieldVideo",reference:"FieldVideo",title:"VIDEO",layout:{type:"vbox",align:"stretch"},padding:3,flex:1,items:[{xtype:"textfield",margin:"5 0 0 0",itemId:"PercorsoVideo",reference:"PercorsoVideo",fieldLabel:"PERCORSO",allowBlank:!1,labelClsExtra:"cbaCssLabel",labelWidth:130},{xtype:"textfield",margin:"5 0 0 0",allowBlank:!1,itemId:"DescVideo",reference:"DescVideo",fieldLabel:"DESCRIZIONE",labelClsExtra:"cbaCssLabel",labelWidth:130},{xtype:"container",margin:"5 0 0 0",
layout:{type:"hbox"},items:[{xtype:"label",itemId:"LabelHintAttachmentVideo",reference:"LabelHintAttachmentVideo",text:traduci("INSRISCI_PERCORSO_VIDEO"),margin:"5 0 0 0",cls:"cbaCssLabel"},{xtype:"container",flex:1},{xtype:"container",layout:{type:"hbox"},width:55,items:[{xtype:"button",itemId:"AttachmentVideo",reference:"AttachmentVideo",flex:1,text:traduci("ALLEGA"),disabled:!0,nonDisabilitare:!0}]}]}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"CSSButtonsPanel",height:25,flex:1,
margin:"0 0 0 0",items:[{xtype:"tbfill",flex:1},{xtype:"button",cls:"cbaCssBtnFunzione",itemId:"BtnEsci",reference:"BtnEsci",text:"ESCI"}]}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.standard.allegati.view.WinAllegaFileAic",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"form",itemId:"FormAttachments",reference:"FormAttachments",layout:{type:"vbox",align:"stretch"},flex:1,margin:5,border:0,items:[{xtype:"tbfill"},{xtype:"filefield",itemId:"Attachment",reference:"Attachment",name:"nomeFile",width:80,msgTarget:"side",
buttonText:traduci("SELEZIONA_FILE"),buttonOnly:!0,nonDisabilitare:!0,buttonConfig:{cls:"cbaCssBtnFunzione",width:190}},{xtype:"tbfill"}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"CSSButtonsPanel",height:25,flex:1,margin:"0 0 0 0",items:[{xtype:"tbfill",flex:1},{xtype:"button",cls:"cbaCssBtnFunzione",itemId:"BtnEsci",reference:"BtnEsci",text:"ESCI"}]}]}]}]}]});this.callParent(arguments)}});
function inizializzaBtnMenuCss(a,b,c){a.addCls("bottoni-menu-cartella");b.fontSizeBottoni=16;b.maxFontSizeBottoni=16;b.minFontSizeBottoni=11;a.btnInnerEl.setStyle("font-size",b.fontSizeBottoni+"px");b.updateLayout();b.on("resize",function(a,c,d,h,k){b.attesaResize||c==h||(b.attesaResize=!0,Ext.defer(function(){b.attesaResize=!1;ricalcoloBtnMenuCSS_onResize(b)},200))});if(c){b.menuBottoniNonVisibili=Ext.create("Ext.menu.Menu",{});a=b.up("tabpanel").getActiveTab();var d=a.cbaConfig.idModulo;b.btnMenuBottoniNonVisibili=
Ext.create("Ext.button.Button",{itemId:"BtnOtherMenu",cls:"btn-menu-others-cartella",iconAlign:"center",icon:"/cba/css/generali/images/generali/apps-cartella.svg",floating:!0,height:24,width:48,text:"0",hidden:!0,handler:function(a){b.menuBottoniNonVisibili.showAt(a.getPosition())}});b.cbaConfig.autoresizeMenuEventsInit||(b.up("tabpanel").on("tabchange",function(a,c){!b.isDestroyed&&b.cbaConfig.autoresizeMenuInitialized&&(c.cbaConfig.idModulo==d?0<b.menuBottoniNonVisibili.items.items.length&&b.btnMenuBottoniNonVisibili.show():
b.btnMenuBottoniNonVisibili.hide())}),a.on("beforedestroy",function(a){ricalcoloBtnMenuCSS_destroyAM(b)}),b.cbaConfig.autoresizeMenuEventsInit=!0);ricalcoloBtnMenuCSS_onResize(b)}b.cbaConfig.autoresizeMenuInitialized=!0}
function ricalcoloBtnMenuCSS_onResize(a){Ext.each(a.query("button"),function(a){a.show()});ricalcoloBtnMenuCss(a);var b=Ext.Function.interval(function(){if(!a.attesaRicalcolo)if(clearInterval(b),a.fontSizeBottoni==a.minFontSizeBottoni)if(ricalcoloBtnMenuCSS_btnMancanti(a)){var c=a.up("panel"),d=c.getPosition(),c=[d[0]+c.getWidth()-a.btnMenuBottoniNonVisibili.width,d[1]+c.getHeight()];a.btnMenuBottoniNonVisibili.showAt(c[0],c[1])}else a.btnMenuBottoniNonVisibili.hide();else a.btnMenuBottoniNonVisibili.hide()},
50)}function ricalcoloBtnMenuCss(a){a.attesaRicalcolo=!0;Ext.defer(function(){if(a.attesaRicalcolo&&a){a.attesaRicalcolo=!1;a.getWidth();var b=a.query("button");ricalcoloBtnMenuCSS_onTarget(b,a)?ricalcoloBtnMenuCSS_aumenta(b,a):ricalcoloBtnMenuCSS_diminuisci(b,a)}},200)}function ricalcoloBtnMenuCSS_onTarget(a,b){var c=a[a.length-1];return c.getPosition()[0]+c.getWidth()<b.getPosition()[0]+b.getWidth()}
function ricalcoloBtnMenuCSS_aumenta(a,b,c){if(b.fontSizeBottoni<b.maxFontSizeBottoni){b.fontSizeBottoni++;Ext.each(a,function(a){a.btnInnerEl.setStyle("font-size",b.fontSizeBottoni+"px");ricalcoloBtnMenuCSS_resizeIcon(a,2*b.fontSizeBottoni);b.updateLayout()});if(c)return!1;ricalcoloBtnMenuCSS_onTarget(a,b)?ricalcoloBtnMenuCSS_aumenta(a,b):ricalcoloBtnMenuCSS_diminuisci(a,b,!0)}}
function ricalcoloBtnMenuCSS_diminuisci(a,b,c){if(b.fontSizeBottoni>b.minFontSizeBottoni){b.fontSizeBottoni--;Ext.each(a,function(a){a.btnInnerEl.setStyle("font-size",b.fontSizeBottoni+"px");ricalcoloBtnMenuCSS_resizeIcon(a,2*b.fontSizeBottoni);b.updateLayout()});if(c)return!1;ricalcoloBtnMenuCSS_onTarget(a,b)||ricalcoloBtnMenuCSS_diminuisci(a,b)}}
function ricalcoloBtnMenuCSS_resizeIcon(a,b){var c,d,e=a.getEl().select("*");Ext.each(e.elements,function(a){-1!=a.id.toUpperCase().indexOf("ICON")?c=a:-1!=a.id.toUpperCase().indexOf("BTNINNEREL")&&(d=a)});b+="px";c.style.backgroundSize=b;c.style.width=b;d.style.maxWidth="calc("+a.getWidth()+"px - "+b+")"}
function ricalcoloBtnMenuCSS_btnMancanti(a){var b=[],c=a.getPosition()[0]+a.getWidth(),d=a.query("button");Ext.each(d,function(a){a.getPosition()[0]+a.getWidth()>c&&(b.push(a),a.hide())});a.menuBottoniNonVisibili.removeAll();var e;Ext.each(b,function(b){Ext.each(a.query("button"),function(a){b.getText()==a.getText()&&(e=a)});a.menuBottoniNonVisibili.add({text:b.getText(),iconCls:b.iconCls,handler:b.handler,cbaConfig:{bottoneOriginale:e}})});a.btnMenuBottoniNonVisibili.setText(b.length);return 0<b.length}
function ricalcoloBtnMenuCSS_destroyAM(a){Ext.getCmp(a.menuBottoniNonVisibili.getId()).destroy();Ext.getCmp(a.btnMenuBottoniNonVisibili.getId()).destroy();a.cbaConfig.autoresizeMenuInitialized=!1}
Ext.define("GeneraliCS.standard.descrizioniFrequenti.controller.PersDescrFrequenti",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"GridDescrizioni",selector:this.selContainer+"#GridDescrizioni"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"ComboScheda",selector:this.selContainer+"#ComboScheda"},{ref:"ComboArea",selector:this.selContainer+
"#ComboArea"},{ref:"ComboCampo",selector:this.selContainer+"#ComboCampo"},{ref:"TxtTesto",selector:this.selContainer+"#TxtTesto"},{ref:"ClmArea",selector:this.selContainer+"#ClmArea"},{ref:"ClmCampo",selector:this.selContainer+"#ClmCampo"}]);this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#ComboScheda",{change:this.changeComboScheda});this.control(this.selContainer+"#ComboArea",
{beforerender:this.beforeshowCombo,expand:this.expandComboArea,collapse:this.collapseComboArea,change:this.changeComboArea});this.control(this.selContainer+"#GridDescrizioni",{edit:this.editGrid,canceledit:this.canceleditGrid,validateedit:this.validateeditGrid,beforeedit:this.beforeeditGrid})},changeComboScheda:function(a,b,c,d){"5"==this.cbaConfig.type&&b&&(this.getComboCampo().getStore().removeAll(),this.getComboCampo().setValue(),this.getComboArea().setValue(),this.loadComboArea(b,null))},loadComboArea:function(a,
b){var c=this,d=this,e=d.getComboArea().getStore();e.removeAll();Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/schedeLibere/imp/modelli/listByIdProfilo",async:!1,params:{idScheda:a},success:function(a){a=Ext.JSON.decode(a.responseText);var f=a.data;a.success?Ext.isEmpty(f)||(Ext.each(f,function(a){e.add({codice:a.id,valore:a.id,extra:a.descrizione,abilitata:a.abilitato})}),StdSipcar.isValidID(b)&&d.getComboArea().select(trovaRecord(e,"id",b))):msgShowError("",a.message,function(){c.getForm().up("window").close()})}})},
changeComboArea:function(a,b,c,d){"5"==this.cbaConfig.type&&b&&(this.getComboCampo().setValue(),this.loadComboDomanda(b,null));this.filtraStoreCampi()},loadComboDomanda:function(a,b){var c=this,d=this,e=d.getComboCampo().getStore();e.removeAll();Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/schedeLibere/imp/domande/listByIdModello",async:!1,params:{idModello:a},success:function(a){a=Ext.JSON.decode(a.responseText);var f=a.data;a.success?Ext.isEmpty(f)||Ext.each(f,function(a){d.contieneRisposteConNote(a.id).then(function(c){c&&
(e.add({codice:a.id,valore:a.id,extra:a.descrizione}),StdSipcar.isValidID(b)&&d.getComboCampo().select(trovaRecord(e,"codice",b)))})["catch"](function(a){msgShowError("",a)})}):msgShowError("",a.message,function(){c.getForm().up("window").close()})}})},contieneRisposteConNote:function(a){var b=this;return new Promise(function(c,d){Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/schedeLibere/imp/risposte/listByIdDomanda",async:!1,params:{idDomanda:a},success:function(a){a=Ext.JSON.decode(a.responseText);
var e=a.data;if(a.success){if(!Ext.isEmpty(e)){var g=!1;Ext.each(e,function(a){-1!=b.storeTipiRisp.find("id",a.tipo)&&(g=!0)});c(g)}}else d(""+operation.getError())}})})},canceleditGrid:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore()},validateeditGrid:function(a,b,c){return msgShow("",[])},beforeeditGrid:function(a,b,c){this.abilitaBottoniGrid(!1);if(!0===a.editing)return!1;"5"==this.cbaConfig.type&&(a=b.record.get("codiceScheda"),c=b.record.get("codiceArea"),b=b.record.get("codiceCampo"),
StdSipcar.isValidID(a)&&this.loadComboArea(a,c),StdSipcar.isValidID(c)&&this.loadComboDomanda(c,b));this.filtraStoreCampi()},expandComboArea:function(a){a=a.getStore();a.getData();a.filterBy(function(a,c){return"F"!==a.get("abilitata")})},collapseComboArea:function(a){a.getStore().clearFilter()},abilitaBottoniGrid:function(a){IsolaCmp(this.getGridDescrizioni(),!a);this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a)},filtraStoreCampi:function(){var a=this.getComboCampo().getStore();
a.clearFilter();1==this.cbaConfig.type&&1==this.tipoPai&&-1==this.getComboArea().getValue()&&a.filterBy(function(a){return!1})},editGrid:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=this;d.store=b.view.getStore();Ext.apply(c,{idProfilo:this.idProfilo,codiceArea:this.getComboArea().getValue(),codiceCampo:this.getComboCampo().getValue(),testo:this.getTxtTesto().getValue(),tipoPai:this.tipoPai||0});"5"==this.cbaConfig.type&&Ext.apply(c,{codiceScheda:this.getComboScheda().getValue()});
delete c.codiceAreaFormatted;delete c.codiceCampoFormatted;"1"!=this.cbaConfig.type&&delete c.tipoPai;controller_salvaRecord(d,c,!1,!1)?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},clickBtnNuovo:function(a){a=this.getGridDescrizioni();a.getStore().insert(0,{});a.getSelectionModel().select(0);a.getPlugin().startEdit(0,0)},clickBtnElimina:function(a){var b=this;a=this.getGridDescrizioni();var c=a.getSelectionModel().getSelection()[0];c&&controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):
""},function(){b.aggiornaStore()})},beforeshowCombo:function(){var a=this;"5"==this.cbaConfig.type?Ext.each(this.comboScheda,function(b){a.getComboScheda().getStore().add({codice:b.id,valore:b.id,extra:b.descrizione,abilitata:b.abilitata})}):(Ext.each(this.comboArea,function(b){a.getComboArea().getStore().add({codice:b.id,valore:b.id,extra:b.descrizione,abilitata:b.abilitata})}),Ext.each(this.comboCampo,function(b){"1"==a.cbaConfig.type&&1==a.tipoPai?a.getComboCampo().getStore().add({codice:+b.extra,
valore:+b.extra,extra:b.valore}):"1"==a.cbaConfig.type||"3"==a.cbaConfig.type?a.getComboCampo().getStore().add({codice:b.id,valore:b.id,extra:b.descrizione}):"8"==a.cbaConfig.type?a.getComboCampo().getStore().add({codice:b.id,valore:b.id,extra:b.descrizione}):a.getComboCampo().getStore().add({codice:b.id,valore:b.id,extra:b.etichetta})}))},caricaRispostePerCombo:function(){var a=this,b=this.cbaConfig.type;"3"===b&&(Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/diari/person/listByProfilo",async:!1,
params:{idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.data;b.success?Ext.isEmpty(c)||Ext.each(c,function(b){a.comboArea.push(b)}):msgShowError("",b.message,function(){a.getForm().up("window").close()})}}),Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",async:!1,params:{codArea:this.codArea,codDomanda:2,idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.data;b.success?Ext.isEmpty(c)||c.forEach(function(b){return a.comboCampo.push(b)}):
msgShowError("",b.message,function(){a.getForm().up("window").close()})}}));if("1"===b||"2"===b){var c=10;"1"===b&&1==this.tipoPai&&(c=50);Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",async:!1,params:{codArea:this.codArea,codDomanda:c,idProfilo:this.idProfilo},success:function(c){c=Ext.JSON.decode(c.responseText);var d=c.data;c.success?Ext.isEmpty(d)||(Ext.each(d,function(b){a.comboArea.push(b)}),"1"===b&&1==a.tipoPai&&a.comboArea.push({id:-1,descrizione:traduci("PAI_OB_GEN_MICRO_OB"),
label:traduci("PAI_OB_GEN_MICRO_OB")})):msgShowError("",c.message,function(){a.getForm().up("window").close()})}})}"2"===b&&Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",async:!1,params:{codArea:this.codArea,codDomanda:50,idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.data;b.success?Ext.isEmpty(c)||Ext.each(c,function(b){a.comboCampo.push(b)}):msgShowError("",b.message,function(){a.getForm().up("window").close()})}});if("1"===b||"2"===b)"1"===
b&&1==this.tipoPai?Ext.create("CS.progetti.paiObGen.store.VociObiettiviPaiObGen").load({callback:function(b,c,f){f?Ext.isEmpty(b)||Ext.each(b,function(b){a.comboCampo.push(b.getData())}):msgShowError("",c.getError(),function(){a.getForm().up("window").close()})}}):(this.codDomanda="1"===b?20:60,Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",async:!1,params:{codArea:this.codArea,codDomanda:this.codDomanda,idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);
var c=b.data,d=[];b.success?Ext.isEmpty(c)||(Ext.each(c,function(b){"1"==a.cbaConfig.type?d.push(b):6!=b.ordinamento&&d.push(b)}),d.sort(function(a,b){return a.ordinamento-b.ordinamento}),d.map(function(b){a.comboCampo.push(b)})):msgShowError("",b.message,function(){a.getForm().up("window").close()})}}));"2"==this.cbaConfig.type&&(Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",async:!1,params:{codArea:this.codArea,codDomanda:70,idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);
var c=b.data,d=[];b.success?Ext.isEmpty(c)||(Ext.each(c,function(a){1!=a.ordinamento&&3!=a.ordinamento&&d.push(a)}),d.sort(function(a,b){return a.ordinamento-b.ordinamento}),d.map(function(b){return a.comboCampo.push(b)})):msgShowError("",b.message,function(){a.getForm().up("window").close()})}}),Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",async:!1,params:{codArea:this.codArea,codDomanda:80,idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);var c=
b.data,d=[];b.success?Ext.isEmpty(c)||(Ext.each(c,function(a){d.push(a)}),d.sort(function(a,b){return a.ordinamento-b.ordinamento}),d.map(function(b){a.comboCampo.push(b)})):msgShowError("",b.message,function(){a.getForm().up("window").close()})}}));"5"==b&&Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/schedeLibere/schede/list",async:!1,params:{idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.data;b.success?Ext.isEmpty(c)||Ext.each(c,function(b){a.comboScheda.push(b)}):
msgShowError("",b.message,function(){a.getForm().up("window").close()})}});"8"==b&&(Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",async:!1,params:{codArea:this.codArea,codDomanda:1,idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.data;b.success?Ext.isEmpty(c)||Ext.each(c,function(b){a.comboArea.push(b)}):msgShowError("",b.message,function(){a.getForm().up("window").close()})}}),Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",
async:!1,params:{codArea:this.codArea,codDomanda:2,idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.data,d=[];b.success?Ext.isEmpty(c)||(Ext.each(c,function(a){d.push(a)}),d.sort(function(a,b){return a.ordinamento-b.ordinamento}),d.map(function(b){a.comboCampo.push(b)})):msgShowError("",b.message,function(){a.getForm().up("window").close()})}}));"9"==b&&Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/risposte/get",async:!1,params:{codArea:this.codArea,codDomanda:10,
idProfilo:this.idProfilo},success:function(b){b=Ext.JSON.decode(b.responseText);var c=b.data;b.success?Ext.isEmpty(c)||Ext.each(c,function(b){a.comboArea.push(b)}):msgShowError("",b.message,function(){a.getForm().up("window").close()})}});this.aggiornaStore()},getImpostazioniByType:function(){var a=this;return new Promise(function(b,c){1==a.cbaConfig.type?Ext.create("CS.personalizzazioni.personPai.impostazioni.store.Impostazioni").load({params:{idProfilo:a.idProfilo},callback:function(d,e,f){f?(a.tipoPai=
d[0].get("tipoPai"),b()):c(e.getError())}}):b()})},aggiornaStore:function(a){var b=this;this.getGridDescrizioni().getStore().load({async:!1,params:{idProfilo:this.idProfilo},callback:function(a,d,e){e?(a=a[0],Ext.isEmpty(a)||(b.getGridDescrizioni().getSelectionModel().deselectAll(),b.getGridDescrizioni().getSelectionModel().select(a))):msgShowError("",d.getError())}})},onLaunch:function(){var a=this;this.idProfilo=this.cbaConfig.idProfilo;this.getGridDescrizioni().controller=this;"1"==this.cbaConfig.type?
(this.codArea=7,this.storeGrid=Ext.create("CS.personalizzazioni.personPai.descrizioni.store.DescrizioniFrequentiPai"),this.getGridDescrizioni().setStore(this.storeGrid)):"2"==this.cbaConfig.type?(this.codArea=19,this.storeGrid=Ext.create("CS.personalizzazioni.personPai.descrizioni.store.DescrizioniFrequentiPri"),this.getGridDescrizioni().setStore(this.storeGrid)):"3"==this.cbaConfig.type?(this.codArea=46,this.storeGrid=Ext.create("CS.personalizzazioni.personDiari.descrizioni.store.DescrizioniFrequentiDiari"),
this.getGridDescrizioni().setStore(this.storeGrid)):"5"==this.cbaConfig.type?(this.codArea=46,this.storeGrid=Ext.create("CS.personalizzazioni.personSchedeLibere.personalizzazioni.store.DescrizioniFrequentiSchedeLibere"),this.getGridDescrizioni().setStore(this.storeGrid),this.storeTipiRisp=Ext.create("CS.personalizzazioni.standardSchedePersonalizzabili.store.OpzioniRisp"),this.storeTipiRisp.filterBy(function(a){return 1==a.get("isNote")})):"6"==this.cbaConfig.type?(this.storeGrid=Ext.create("CS.personalizzazioni.personECG.descrizioni.store.DescrizioniFrequentiEcg"),
this.getGridDescrizioni().setStore(this.storeGrid)):"7"==this.cbaConfig.type?(this.storeGrid=Ext.create("CS.personalizzazioni.personContenzioni.descrizioni.store.DescrizioniFrequentiContenzioni"),this.getGridDescrizioni().setStore(this.storeGrid)):"8"==this.cbaConfig.type?(this.codArea=53,this.storeGrid=Ext.create("CS.personalizzazioni.personProgramma.descrizioni.store.DescrizioniFrequentiProgramma"),this.getGridDescrizioni().setStore(this.storeGrid)):"9"==this.cbaConfig.type&&(this.codArea=41,this.storeGrid=
Ext.create("CS.personalizzazioni.personPi.descrizioni.store.DescrizioniFrequentiPi"),this.getGridDescrizioni().setStore(this.storeGrid));this.comboScheda=[];this.comboArea=[];this.comboCampo=[];this.getImpostazioniByType().then(function(){return a.caricaRispostePerCombo()})},destroy:function(){eliminaStore(this.storeTipiRisp);this.callParent()}});
Ext.define("GeneraliCS.standard.descrizioniFrequenti.controller.WinDescrFrequenti",{extend:"Generali.standard.stampe.Controller",init:function(){var a="#"+this.containerId+" ";this.selContainer=a;this.callParent(arguments);this.addRef([{ref:"BtnAggiungi",selector:a+"#BtnAggiungi"},{ref:"BtnEsci",selector:a+"#BtnEsci"},{ref:"Grid",selector:a+"#Grid"},{ref:"BtnNuovo",selector:a+"#BtnNuovo"},{ref:"BtnEliminaHard",selector:a+"#BtnEliminaHard"},{ref:"Text",selector:a+"#Text"},{ref:"Check",selector:a+"#Check"}]);
this.control(a+"#Grid",{afterrender:this.aferrenderGrid,beforeedit:this.beforeeditGrid,edit:this.editGrid,canceledit:this.canceleditGrid,validateedit:this.validateeditGrid});this.control(a+"#BtnEsci",{click:this.clickBtnEsci});this.control(a+"#BtnAggiungi",{click:this.clickBtnAggiungi});this.control(a+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(a+"#BtnEliminaHard",{click:this.clickBtnEliminaHard});this.control(a+"#Check",{checkchange:this.changeCheck})},changeCheck:function(a,b,c,d){this.getGrid().getStore().getData();
c?this.countCheck++:this.countCheck--;this.getBtnAggiungi().setDisabled(0>=this.countCheck)},clickBtnEliminaHard:function(){var a=this,b=this.getGrid().getStore().getData().items,c="",d=0;Ext.each(b,function(a,b){if(a.get("checkSel")&&1==a.get("checkSel")){d++;if(1<d)return!1;c=a.get("id")}});if(1<d)return Messaggio("ATTENZIONE","E_POSSIBILE_ELIMINARE_SOLO_1_EL","OK","QUESTION"),!1;""!=c?controller_eliminaRecord(this.store,{id:c},function(){a.aggiornaStore()}):Messaggio("ATTENZIONE","NESSUNA_REGISTRAZIONE_SELEZIONATA",
"OK","QUESTION")},beforeeditGrid:function(a,b,c){this.abilitaBottoniGrid(!1);if(!0===a.editing)return!1},canceleditGrid:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore()},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnEliminaHard().setDisabled(!a);this.getBtnEsci().setDisabled(!a);this.getBtnAggiungi().setDisabled(!a)},validateeditGrid:function(a,b,c){return msgShow("",[])},editGrid:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm();d.controller=
this;d.store=b.view.getStore();Ext.apply(c,{idProfilo:CBA.parametriGenerali.idProfiloCss,codiceArea:this.cbaConfig.area,codiceCampo:this.cbaConfig.campo,testo:this.getText().getValue(),tipoPiano:this.cbaConfig.tipo});"5"==this.cbaConfig.tipo&&Ext.apply(c,{codiceScheda:this.cbaConfig.scheda});1==this.cbaConfig.tipo&&Ext.apply(c,{tipoPai:getTipoPai()});c.testo=c.testo.replaceAll("&nbsp;","");delete c.codiceAreaFormatted;delete c.codiceCampoFormatted;delete c.checkSel;controller_salvaRecord(d,c,!1,!1)?
this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},clickBtnNuovo:function(){var a=this.getGrid(),b=a.getSelectionModel();a.getStore().insert(0,{});b.select(0);a.getPlugin().startEdit(0,0)},clickBtnAggiungi:function(a){this.controllerTe=this.cbaConfig.controller;a=this.getGrid().getStore().getData().items;var b="",c="5"!=this.cbaConfig.tipo?"<br/>":"\n";Ext.each(a,function(a,d){a.get("checkSel")&&!0===a.get("checkSel")&&(b=0===d?a.get("testo")+c:b+(a.get("testo")+c))});var b=b.substring(0,b.length-
c.length),b=b.replaceAll("<div>",c),b=b.replaceAll("</div>",""),b=b.replaceAll("<br>",""),b=b.replaceAll("&nbsp;",""),d=b.split(c),e=!1;if("5"!=this.cbaConfig.tipo){var f=this.controllerTe.lookup(this.cbaConfig.textareaCollegata).getValue()||this.controllerTe.lookup(this.cbaConfig.textareaCollegata).value;f&&Ext.each(d,function(a){if(""!==a&&-1!==f.toUpperCase().indexOf(a.toUpperCase()))return Messaggio("ATTENZIONE",traduci("DESCRIZIONE")+' "'+a+'" '+traduci("GIA_PRESENTE"),"OK","QUESTION"),e=!0,
!1});if(!e){if(-1!=this.cbaConfig.textareaCollegata.indexOf("TxtObiettivi"))if(a=this.controllerTe.lookup(this.cbaConfig.textareaCollegata),""!=a.getValue()&&-1!=a.getValue().indexOf("div_ris_attesi")){var g=a.getValue().indexOf('<div id="div_ris_attesi"'),g=a.getValue().substring(0,g)+b+a.getValue().substring(g);a.setValue("");this.controllerTe.lookup(this.cbaConfig.textareaCollegata).setValue(g)}else this.controllerTe.lookup(this.cbaConfig.textareaCollegata).setValue(this.controllerTe.lookup(this.cbaConfig.textareaCollegata).getValue()+
b);else this.controllerTe.lookup(this.cbaConfig.textareaCollegata).getValue()?this.controllerTe.lookup(this.cbaConfig.textareaCollegata).setValue(this.controllerTe.lookup(this.cbaConfig.textareaCollegata).getValue()+b):this.controllerTe.lookup(this.cbaConfig.textareaCollegata).setValue(b);this.getGrid().up("window").close()}}else{var h="";this.cbaConfig.controller.lookup("CntRisposte").query("textarea").forEach(function(a){e=!1;h=a.getValue();Ext.each(d,function(a){if(""!==a&&-1!==h.toUpperCase().indexOf(a.toUpperCase()))return Messaggio("ATTENZIONE",
traduci("DESCRIZIONE")+' "'+a+'" '+traduci("GIA_PRESENTE"),"OK","QUESTION"),e=!0,!1});e||(a.getValue()?a.setValue(a.getValue()+"\n"+b):a.setValue(b))});this.getGrid().up("window").close()}},clickBtnEsci:function(a){this.getGrid().up("window").close()},aggiornaStore:function(){var a=this;this.store.load({params:{idProfilo:CBA.parametriGenerali.idProfiloCss},callback:function(b,c,d){if(d){if(b&&0<b.length){var e=[];b.forEach(function(b){var c=b.get("codiceArea"),d=b.get("codiceCampo"),f=b.get("codiceScheda");
d!=a.cbaConfig.campo&&null!=d||c!=a.cbaConfig.area&&null!=c||f!=a.cbaConfig.scheda&&null!=f||e.push(b)});a.getGrid().getStore().loadData(e)}a.getBtnAggiungi().setDisabled(!0)}else msgShowError("",c.getError())}})},aferrenderGrid:function(a){this.aggiornaStore()},onLaunch:function(){this.countCheck=0;"1"==this.cbaConfig.tipo?(this.codArea=7,this.store=Ext.create("CS.personalizzazioni.personPai.descrizioni.store.DescrizioniFrequentiPai"),this.getGrid().setStore(this.store)):"2"==this.cbaConfig.tipo?
(this.codArea=19,this.store=Ext.create("CS.personalizzazioni.personPai.descrizioni.store.DescrizioniFrequentiPri"),this.getGrid().setStore(this.store)):"3"==this.cbaConfig.tipo?(this.codArea=46,this.store=Ext.create("CS.personalizzazioni.personDiari.descrizioni.store.DescrizioniFrequentiDiari"),this.getGrid().setStore(this.store)):"5"==this.cbaConfig.tipo?(this.store=Ext.create("CS.personalizzazioni.personSchedeLibere.personalizzazioni.store.DescrizioniFrequentiSchedeLibere"),this.getGrid().setStore(this.store)):
"6"==this.cbaConfig.tipo?(this.store=Ext.create("CS.personalizzazioni.personECG.descrizioni.store.DescrizioniFrequentiEcg"),this.getGrid().setStore(this.store)):"7"==this.cbaConfig.tipo?(this.store=Ext.create("CS.personalizzazioni.personContenzioni.descrizioni.store.DescrizioniFrequentiContenzioni"),this.getGrid().setStore(this.store)):"8"==this.cbaConfig.tipo?(this.store=Ext.create("CS.personalizzazioni.personProgramma.descrizioni.store.DescrizioniFrequentiProgramma"),this.getGrid().setStore(this.store)):
"9"==this.cbaConfig.tipo&&(this.store=Ext.create("CS.personalizzazioni.personPi.descrizioni.store.DescrizioniFrequentiPi"),this.getGrid().setStore(this.store))},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.standard.descrizioniFrequenti.view.PersDescrFrequenti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){var a=new Ext.data.ArrayStore({fields:["codice","valore","extra","abilitata"],data:[],autoLoad:!0,autoDestroy:!0}),b=new Ext.data.ArrayStore({fields:["codice","valore","extra","abilitata"],data:[],autoLoad:!0,autoDestroy:!0}),c=new Ext.data.ArrayStore({fields:["codice","valore","extra"],data:[],autoLoad:!0,autoDestroy:!0});Ext.applyIf(this,{layout:{type:"vbox",
align:"stretch"},flex:1,items:[{xtype:"gridpanel",itemId:"GridDescrizioni",reference:"GridDescrizioni",flex:1,columns:[{xtype:"gridcolumn",flex:1,dataIndex:"testo",text:"TESTO",sortable:!1,editor:{xtype:"htmleditor",itemId:"TxtTesto",reference:"TxtTesto",layout:"fit",labelClsExtra:"cbaCssLabel",allowBlank:!1,maxLength:80,maxHeight:95,cbaConfig:{name:"testo"},enforceMaxLength:!0}},{xtype:"gridcolumn",itemId:"ClmScheda",reference:"ClmScheda",text:"SCHEDA",dataIndex:"codiceScheda",maxWidth:400,flex:1,
sortable:!1,hidden:"5"==this.cbaConfig.type?!1:!0,editor:{xtype:"combobox",itemId:"ComboScheda",reference:"ComboScheda",store:a,name:"codiceScheda",queryMode:"local",displayField:"extra",valueField:"valore",allowBlank:!0,editable:!0},renderer:function(a,b,c,g,h,k,l){return c.get("codiceSchedaFormatted")}},{xtype:"gridcolumn",itemId:"ClmArea",reference:"ClmArea",text:"3"==this.cbaConfig.type?"DIARIO":"5"==this.cbaConfig.type?"AREA":"SEZIONE",dataIndex:"codiceArea",maxWidth:400,flex:1,sortable:!1,hidden:"6"==
this.cbaConfig.type||7==this.cbaConfig.type?!0:!1,editor:{xtype:"combobox",itemId:"ComboArea",reference:"ComboArea",store:b,name:"codiceArea",queryMode:"local",displayField:"extra",valueField:"valore",allowBlank:!0,editable:!0},renderer:function(a,b,c,g,h,k,l){return c.get("codiceAreaFormatted")}},{xtype:"gridcolumn",itemId:"ClmCampo",reference:"ClmCampo",text:"3"==this.cbaConfig.type?"TIPOLOGIA":"5"==this.cbaConfig.type?"DOMANDA":"CAMPO",dataIndex:"codiceCampo",maxWidth:280,flex:1,sortable:!1,hidden:"6"==
this.cbaConfig.type||7==this.cbaConfig.type?!0:!1,editor:{xtype:"combobox",itemId:"ComboCampo",reference:"ComboCampo",store:c,name:"codiceCampo",queryMode:"local",displayField:"extra",valueField:"valore",allowBlank:!0,editable:!0},renderer:function(a,b,c,g,h,k,l){return c.get("codiceCampoFormatted")}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{pack:"end"},items:[{xtype:"button",itemId:"BtnNuovo",
reference:"BtnNuovo",text:"NUOVO",cls:"cbaCssBtnFunzione"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",text:"ELIMINA",cls:"cbaCssBtnFunzione"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.standard.descrizioniFrequenti.view.WinDescrFrequenti",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},flex:1,itemId:"CntGlobale",reference:"CntGlobale",items:[{xtype:"grid",itemId:"Grid",reference:"Grid",flex:1,autoScroll:!0,store:Ext.create("CS.personalizzazioni.personPai.descrizioni.store.DescrizioniFrequentiPai"),columns:[{xtype:"checkcolumn",itemId:"Check",reference:"Check",dataIndex:"checkSel",
width:28,align:"center",sortable:!1},{xtype:"gridcolumn",itemId:"ClmCommento",reference:"ClmCommento",dataIndex:"testo",text:"DESCRIZIONI",flex:1,editor:{xtype:"htmleditor",itemId:"Text",reference:"Text",height:80,allowBlank:!1,cbaConfig:{name:"testo"}}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"CSSButtonsPanel",height:30,flex:1,margin:"0 0 0 0",items:[{xtype:"tbfill",flex:1},
{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",text:"NUOVO",cls:"cbaCssBtnFunzione",nonDisabilitare:!0,margin:"0 0 0 1"},{xtype:"button",itemId:"BtnEliminaHard",reference:"BtnEliminaHard",text:"ELIMINA",cls:"cbaCssBtnFunzione",nonDisabilitare:!0,margin:"0 0 0 1"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",margin:"0 0 0 1",cls:"cbaCssBtnFunzione",nonDisabilitare:!0,text:"ESCI"}]}]},{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbfill",flex:1},{xtype:"CSSButtonsPanel",height:30,flex:1,
margin:"0 0 0 0",items:[{xtype:"tbfill",flex:1},{xtype:"button",itemId:"BtnAggiungi",reference:"BtnAggiungi",text:"INSERISCI_DESCR",cls:"cbaCssBtnFunzione-special",disabled:!0,margin:"0 3 0 0",width:165,special:!0}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.standard.history.controller.History",{extend:"Generali.standard.stampe.Controller",init:function(){var a="#"+this.containerId+" ";this.selContainer=a;this.callParent(arguments);this.addRef([{ref:"CtnConsultaModifiche",selector:a+"#CtnConsultaModifiche"},{ref:"GridHistory",selector:a+"#GridHistory"},{ref:"HistoryV1",selector:a+"#HistoryV1"},{ref:"Note",selector:a+"#Note"},{ref:"BtnEsci",selector:a+"#BtnEsci"}]);this.control(a+"#GridHistory",{afterrender:this.aferrenderGrid});
this.control(a+"#HistoryV1",{beforecheckchange:this.beforecheckchangeHistoryV1});this.control(a+"#BtnEsci",{click:this.clickBtnEsci})},clickBtnEsci:function(){var a=this;if(this.cbaConfig.filtriAttivi){var b=this.cbaConfig.filtriAttivi.query("#CheckHistory")?this.cbaConfig.filtriAttivi.query("#CheckHistory")[0]:!1;b&&b.setValue(!1);this.cbaConfig.filtriAttivi.up("window").setHidden(!0);this.cbaConfig.controller&&this.cbaConfig.controller.cbaConfig.controllerTestata&&this.cbaConfig.controller.cbaConfig.controllerTestata.getFiltriAttivi().setValue(0)}Ext.defer(function(){a.getCtnConsultaModifiche().up("window").close()},
100)},beforecheckchangeHistoryV1:function(a,b,c,d){a.up("grid").getStore().each(function(a,c){a.get("version")-1!=b&&a.set("v1",!1)});c?(a=a.up("grid").getStore().getAt(b),this.getNote().setHidden(!1),this.getNote().setValue(a.get("descrizioneModifiche"))):(this.getNote().setHidden(!0),this.getNote().setValue(""))},aferrenderGrid:function(a){var b=this;a=null;switch(this.cbaConfig.tipo){case "cadute":a=Ext.create("CS.eventi.cadute.store.History");break;case "pai":a=Ext.create("CS.progetti.store.History");
break;case "pri":a=Ext.create("CS.progetti.pri.store.History");break;case "programma":a=Ext.create("CS.progetti.programma.store.History");break;case "progetto":a=Ext.create("CS.progetti.progetto.store.History");break;case "prgIng":a=Ext.create("CS.progetti.pi.store.History");break;case "diagnosi":a=Ext.create("CS.diagnosi.store.HistoryDiagnosi");break;case "csEventiAvversi":a=Ext.create("CS.eventi.eventiAvversi.store.History");break;case "interventi":a=Ext.create("CS.diagnosi.store.HistoryInterventi");
break;case "raccoltaBisogni":a=Ext.create("CS.cartella.store.HistoryRaccoltaBisogni");break;case "incidentReporting":a=Ext.create("CS.eventi.incident.store.History");break;case "gordon":a=Ext.create("CS.anamnesi.skGordon.store.History");break;case "sfkt":a=Ext.create("CS.fisioterapia.schedaFkt.store.History");break;case "bilancioEco":a=Ext.create("CS.bilancio.eco.store.History");break;case "cartellaEntrataEstesa":a=Ext.create("CS.cartella.store.HistoryCartellaEntrataEstesa");break;case "cartellaEntrataConcisa":a=
Ext.create("CS.cartella.store.HistoryCartellaEntrataConcisa");break;case "schedelibere":a=Ext.create("CS.schedeLibere.store.History");break;default:return!1}this.getGridHistory().setStore(a);this.cbaConfig.idTe&&this.getGridHistory().getStore().load({params:{id:this.cbaConfig.idTe},callback:function(a,d,e){if(e&&(b.dataDal||b.dataAl)){var c=[];b.getGridHistory().getStore().filterBy(function(a){return b.dataDal&&b.dataAl?a.get("datah")>=b.dataDal&&a.get("datah")<=b.dataAl?c.push(a):null:b.dataDal&&
!b.dataAl?a.get("datah")>=b.dataDal?c.push(a):null:!b.dataDal&&b.dataAl?a.get("datah")<=b.dataAl?c.push(a):null:a})}}})},onLaunch:function(){this.dataAl=this.dataDal=null},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.standard.history.view.History",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",layout:{type:"vbox",align:"stretch",dock:"top"},itemId:"CtnConsultaModifiche",reference:"CtnConsultaModifiche",flex:1,margin:"0 0 5 0",items:[{xtype:"gridpanel",flex:1,itemId:"GridHistory",reference:"GridHistory",height:300,width:860,border:"1px solid black",padding:5,columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"checkcolumn",
dataIndex:"v1",text:traduci("V1"),itemId:"HistoryV1",reference:"HistoryV1",width:40,sortable:!1},{xtype:"gridcolumn",text:traduci("COMPILATORE"),dataIndex:"compilatoreFormatted",width:350,sortable:!1},{xtype:"datecolumn",text:traduci("DATA_ORA_MODIFICA"),dataIndex:"datah",width:300,sortable:!1,format:"d/m/Y H:i",renderer:function(a,b,c,d,e,f,g){return FormattaData(c.get("datah"))+" "+FormattaOra(c.get("datah"))}},{xtype:"gridcolumn",text:traduci("VERSIONE"),dataIndex:"version",sortable:!1,flex:1}],
viewConfig:{loadMask:!1,getRowClass:function(a,b,c,d){b="";1==a.get("v1")&&(b="righeTranscodificateIcf");1==a.get("v2")&&(b="righeHistoryArancio");return b}}},{xtype:"cbaFieldsetHtmlEditor",margin:"0 0 5 0",flex:1,itemId:"Note",reference:"Note",title:" ",labelClsExtra:"cbaCssLabel",solaLettura:!0,hidden:!0},{xtype:"CSSButtonsPanel",layout:{type:"hbox",align:"center",pack:"end"},dock:"bottom",margin:"5 5 5 0",items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",margin:"0 0 0 1"}]}]}]});
this.callParent(arguments)}});
Ext.define("GeneraliCS.standard.schedePersonalizzabili.UtilsSchedePerson",{alternateClassName:"UtilsSchedePerson",statics:{type:"",linkStore:new Map([["CsPsichicaTe",{storeModelli:"CS.personalizzazioni.personEsamePsichico.personalizzazioni.store.Aree",storeDomande:"CS.personalizzazioni.personEsamePsichico.personalizzazioni.store.Domande",storeRisposte:"CS.personalizzazioni.personEsamePsichico.personalizzazioni.store.Risposte",urlDnd:"/cba/css/cs/ws/anamnesi/psichica"}],["CsGordonTe",{storeModelli:"CS.personalizzazioni.personGordon.personalizzazioni.store.Aree",
storeDomande:"CS.personalizzazioni.personGordon.personalizzazioni.store.Domande",storeRisposte:"CS.personalizzazioni.personGordon.personalizzazioni.store.Risposte",urlDnd:"/cba/css/cs/ws/skgordon"}],["Fkt",{storeModelli:"CS.personalizzazioni.personFisioTerapia.impostazioni.store.Impo_SfktModelli",storeDomande:"CS.personalizzazioni.personFisioTerapia.impostazioni.store.Impo_SfktDomande",storeRisposte:"CS.personalizzazioni.personFisioTerapia.impostazioni.store.Impo_SfktRisposte",urlDnd:"/cba/css/cs/ws/fisioterapia/impostaz/sfkt"}],
["CsSchedeLibereTe",{storeModelli:"CS.personalizzazioni.personSchedeLibere.personalizzazioni.store.Aree",storeDomande:"CS.personalizzazioni.personSchedeLibere.personalizzazioni.store.Domande",storeRisposte:"CS.personalizzazioni.personSchedeLibere.personalizzazioni.store.Risposte",urlDnd:"/cba/css/cs/ws/schedeLibere"}],["CsTaskAnalysisTe",{storeModelli:"CS.personalizzazioni.personTaskAnalysis.impostazioni.store.Aree",storeDomande:"CS.personalizzazioni.personTaskAnalysis.impostazioni.store.Domande",
storeRisposte:"CS.personalizzazioni.personTaskAnalysis.impostazioni.store.Risposte"}]]),setType:function(a){this.type=a},getType:function(){return this.type},getLinkStore:function(){return this.linkStore},getLinkStoreModelli:function(a){return this.getLinkStore().get(a||this.getType()).storeModelli},getLinkStoreDomande:function(a){return this.getLinkStore().get(a||this.getType()).storeDomande},getLinkStoreRisposte:function(a){return this.getLinkStore().get(a||this.getType()).storeRisposte},getUrlDnd:function(a){return this.getLinkStore().get(a||
this.getType()).urlDnd}}});
Ext.define("GeneraliCS.standard.schedePersonalizzabili.controller.Area",{extend:"Generali.standard.stampe.Controller",uses:["GeneraliCS.standard.schedePersonalizzabili.controller.StdComponentiSchedePersonalizzabili"],uses:["GeneraliCS.standard.schedePersonalizzabili.controller.Domanda"],init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:a+"#Form"},{ref:"BoxBottoni",selector:a+"#BoxBottoni"},{ref:"PnlCompilatore",selector:a+"#PnlCompilatore"},
{ref:"CntIcona",selector:a+"#CntIcona"}])},loadDomande:function(){var a=this,b=this.cbaConfig,c=b.type,d=b.propertyParamArea,e=b.properyFieldDescrizione,b=Ext.create(UtilsSchedePerson.getLinkStoreDomande(c));e||(e="descrizione");d||(d="idModello");var f={};b.load({params:(f.idProfilo=CBA.parametriGenerali.idProfiloCss,f[d]=this.cbaConfig.idModello,f),callback:function(b,d,f){f&&!Ext.isEmpty(b)&&(Ext.suspendLayouts(),a.lookup("CntDomande").loadDomande=!0,b.forEach(function(b){var d=null;a.cbaConfig.datiModello&&
a.cbaConfig.datiModello.lstDomande&&a.cbaConfig.datiModello.lstDomande.map(function(a){a.idCsImpDomande===b.get("id")&&(d=a)});a.lookup("CntDomande").add(Ext.create("GeneraliCS.standard.schedePersonalizzabili.view.Domanda",{layout:{type:"vbox",align:"stretch"},flex:1,cbaConfig:{controllerArea:a,idDomanda:b.get("id"),testoDomanda:b.get(e),idCollegamento:b.get("idCollegamento"),tipo:b.get("tipo"),blocco:a.cbaConfig.checkCompiled?1!==a.valoreSwitch3D||"S"!==a.cbaConfig.permesso:"S"!==a.cbaConfig.permesso,
datiDomanda:d,linkToView:a.cbaConfig.linkToView,checkCompiled:a.cbaConfig.checkCompiled,type:c}}))}),Ext.resumeLayouts(!0))}})},createSlider:function(){var a=this,b=this.cbaConfig.controllerMain.blocco||"S"!==this.cbaConfig.permesso,c=null;this.cbaConfig.datiModello&&(c="T"===this.cbaConfig.datiModello.presenza);b=Ext.create("Ext.Container",{xtype:"container",layout:{type:"hbox",align:"stretch",pack:"end"},width:40,style:{"border-bottom-style":"solid","border-bottom-width":"4px !important","border-bottom-color":c?
"#34D095":"#FF611A"},items:[{xtype:"slider",reference:"Slider",name:"presenza",width:40,value:c?1:0,minValue:0,maxValue:1,flex:1,tipText:!1,style:{cursor:b?"auto":"pointer"},readOnly:b,margin:"0 0 15 0",listeners:{change:function(b,c){b.up("container").setStyle("border-bottom-color",0===c?"#FF611A":"#34D095");a.valoreSwitch3D=c;containerSolaLettura(a.lookup("CntDomande"),1!==c)},afterrender:function(){return a.valoreSwitch3D=c?1:0}}}],listeners:{afterrender:function(b){var c=Ext.create("Ext.container.Container",
{layout:{type:"hbox",align:"center",pack:"center"},style:{"border-bottom":"4px solid transparent !important"},flex:1,padding:3,items:[{xtype:"image",src:"/cba/css/generali/images/generali/slide-demo.gif",maxWidth:92,height:31,flex:1},{xtype:"fieldset",layout:{type:"vbox",align:"stretch"},title:traduci("OPZIONI"),flex:1,margin:"0 0 0 10",items:[{xtype:"label",cls:"cbaCssLabel",html:'<div style = "color: #FF611A">- '+traduci("NON_PRESENTE")+'</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div style = "color: #34D095">- '+
traduci("PRESENTE")+"</div>"}]}]});creaToolTipBubble(b.getId(),"",traduci("PRESENZA")+' "'+a.cbaConfig.titoloArea+'"',!1,320,c)}}});this.lookup("Modello").insert(1,b)},onLaunch:function(){this.permesso=this.cbaConfig.permesso;this.idProfilo=CBA.parametriGenerali.idProfiloCss;this.cbaConfig.checkCompiled&&this.createSlider();var a=this.lookup("CntDomande").hidden;a||this.loadDomande();StdComponentiSchedePersonalizzabili.collapsePanel(a,this.lookup("CntIcona"),this.lookup("CntDomande"))},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.standard.schedePersonalizzabili.controller.Domanda",{extend:"Generali.standard.stampe.Controller",uses:["GeneraliCS.standard.schedePersonalizzabili.controller.StdComponentiSchedePersonalizzabili","GeneraliCS.standard.schedePersonalizzabili.UtilsSchedePerson"],uses:["GeneraliCS.popup.view.Popup","CS.patologieproblemi.main.view.Patologie"],init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:a+"#Form"},{ref:"BoxBottoni",selector:a+
"#BoxBottoni"},{ref:"PnlCompilatore",selector:a+"#PnlCompilatore"},{ref:"ImgDescrFreq_"+this.cbaConfig.idDomanda,selector:a+"#ImgDescrFreq_"+this.cbaConfig.idDomanda}]);this.control(a+"#InfoScheda",{afterrender:this.afterrenderInfoScheda,click:this.clickInfoScheda});this.control(a+"#ImgDescrFreq_"+this.cbaConfig.idDomanda,{click:this.clickBtnShortcut})},clickBtnShortcut:function(a){a=this.cbaConfig.idDomanda;var b=this.cbaConfig.controllerArea.cbaConfig.idModello,c=this.cbaConfig.controllerArea.cbaConfig.idSchedaLibera;
Ext.create("winCBA",{name:"GeneraliCS.standard.descrizioniFrequenti.view.WinDescrFrequenti",titolo:traduci("DESCR_FREQ"),larghezzaWin:860,altezzaWin:400,configItem:{permesso:"S",controller:this,scheda:c,campo:a,area:b,tipo:5}}).show()},afterrenderInfoScheda:function(a){this.cbaConfig.linkToView&&creaToolTipBubble(a,"APRI_SCHEDA")},clickInfoScheda:function(a){var b=this;Ext.create("CS.anamnesi.skGordon.store.ApriVideata").load({params:{tipoVideata:this.cbaConfig.idCollegamento,idProfilo:CBA.parametriGenerali.idProfiloCss,
idProfiloPwdDe:CBA.parametriGenerali.idProfiloPwdDe,idProfiloPwdDeCss:CBA.parametriGenerali.idProfiloPwdDeCss,idRicovero:CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data.idRicovero},callback:function(a,d,e){e?Ext.isEmpty(a)||(a=a[0],a.get("codice").includes("N")?Messaggio("ATTENZIONE",traduci("NESSUN_PERMESSO"),"OK","INFO"):(a=b.ciclaVideate(a))&&b.apriVideata(a)):msgShowError("",d.getError())}})},ciclaVideate:function(a){var b=this,c=trovaRecord(this.lightStoreVideate,"codVideata",a.get("extra"));
c?c=c.data:CBA.moduli.modulo49.elencoVideate.storeListVid.data.items.forEach(function(d){d.data.listaVideate.forEach(function(d){d.voceMenu.nomeForm==a.get("valore")&&d.codVideata==a.get("extra")&&(c=d,b.lightStoreVideate.add(c))})});return c},apriVideata:function(a){var b="GeneraliCS.popup.view.Popup",c=CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data;80008===a.voceMenu.id&&(b="CS.patologieproblemi.main.view.Patologie");if("N"===a.tipoPermesso)Messaggio("ATTENZIONE","NESSUN_PERMESSO","OK","QUESTION");
else{var b=Ext.create("CSS_winCBA",{name:b,titolo:" ",visualizzaAnagrafica:c,larghezzaWin:320,altezzaWin:900,configItem:{elencoVideate:[a],nuovoDefault:!1,anagraficaExtra:c,codOspitePopUp:80008===a.voceMenu.id?c.codOspite:null,permesso:a.tipoPermesso,fromSchedePers:!0}}),c=this.lookup("CntRisposte").up("#Form"),d=c.getPosition()[0]+c.getWidth()-1E3;y=c.getPosition()[1]+c.getHeight()-310;b.showAt(d,y);b.impostaTitolo(a.voceMenu.titolo.toUpperCase())}},loadRisposta:function(a,b){var c=this.lookup("CntRisposte"),
d=null;if(c){switch(a.get("tipo")){case 1:c.down("checkboxgroup")?c=c.down("checkboxgroup"):(d=Ext.create("Ext.form.CheckboxGroup",{layout:{type:"vbox",align:"stretch"},items:[]}),c.add(d),c=d);d=StdComponentiSchedePersonalizzabili.creaRispostaSingola(a,b);break;case 2:c.down("checkboxgroup")?c=c.down("checkboxgroup"):(d=Ext.create("Ext.form.CheckboxGroup",{layout:{type:"vbox",align:"stretch"},items:[]}),c.add(d),c=d);d=StdComponentiSchedePersonalizzabili.creaRispostaSingolaConNote(a,b);this.showDescrFreq=
!0;break;case 3:d=StdComponentiSchedePersonalizzabili.creaRispostaMultipla(a,b);break;case 4:d=StdComponentiSchedePersonalizzabili.creaRispostaMultiplaConNote(a,b);this.showDescrFreq=!0;break;case 5:d=StdComponentiSchedePersonalizzabili.creaRispostaNote(a,b);this.showDescrFreq=!0;break;case 6:d=StdComponentiSchedePersonalizzabili.creaRispostaSiNo(a,b);break;case 7:d=StdComponentiSchedePersonalizzabili.creaRispostaSiNoSpecifSeSi(a,b);this.showDescrFreq=!0;break;case 8:d=StdComponentiSchedePersonalizzabili.creaRispostaSiNoSpecifSeNo(a,
b);this.showDescrFreq=!0;break;default:this.showDescrFreq=!1}d&&c.add(d)}},aggiornaStore:function(){var a=this;this.onLoad=!0;Ext.create(UtilsSchedePerson.getLinkStoreRisposte(this.cbaConfig.type)).load({params:{idProfilo:CBA.parametriGenerali.idProfiloCss,idDomanda:this.cbaConfig.idDomanda},callback:function(b,c,d){if(d)if(Ext.isEmpty(b))a.lookup("Domanda").setHidden(!0);else{Ext.suspendLayouts();var e=a.cbaConfig.controllerArea.cbaConfig.controllerMain.blocco||a.cbaConfig.blocco;b.forEach(function(b){return a.loadRisposta(b,
e)});"CsSchedeLibereTe"==a.cbaConfig.type&&a.lookup("ImgDescrFreq_"+a.cbaConfig.idDomanda).setHidden(!a.showDescrFreq);a.cbaConfig.datiDomanda&&(b=a.cbaConfig.controllerArea.cbaConfig.controllerMain.lookup("Form"),StdComponentiSchedePersonalizzabili.loadDati(a.cbaConfig.datiDomanda,a.lookup("CntRisposte"),b));e&&a.lookup("CntRisposte").query("cbaMultipleChoice").forEach(function(a){a.query("checkbox").forEach(function(a){return a.setReadOnly(!0)})});a.onLoad=!1;Ext.resumeLayouts(!0)}}})},onLaunch:function(){this.idProfilo=
CBA.parametriGenerali.idProfiloCss;this.showDescrFreq=!1;this.cbaConfig.idCollegamento&&this.cbaConfig.linkToView&&this.lookup("InfoScheda").setHidden(!1);Ext.define("lightStoreVideate",{extend:"Ext.data.Store",fields:[{name:"nomeForm"},{name:"codVideata"},{name:"permesso"}],autoDestroy:!0});this.lightStoreVideate=Ext.create("lightStoreVideate");this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.standard.schedePersonalizzabili.controller.StdComponentiSchedePersonalizzabili",{alternateClassName:"StdComponentiSchedePersonalizzabili",statics:{elaboroModelli:function(a,b){var c=[];a.lookup("CntModello").items.items.forEach(function(d){var e=d.lookupController().lookup("Modello");if(!e.hidden){var f={id:d.cbaConfig.datiModello?d.cbaConfig.datiModello.id:"-9999",idTestata:a.testataSelezionata?a.testataSelezionata:"-9999",idCsImpModelli:d.cbaConfig.idModello,lstDomande:[]};
b&&(Ext.apply(f,{idTe:f.idTestata}),delete f.idTestata);var g=null;e.query("[reference=Slider]")[0]&&(g=1===e.query("[reference=Slider]")[0].getValue()?"T":"F",Ext.apply(f,{presenza:g}));d.query("[modello="+d.cbaConfig.idModello+"]")[0].items.items.forEach(function(a){a.lookupController().lookup("Domanda").hidden||(a={id:a.cbaConfig.datiDomanda?a.cbaConfig.datiDomanda.id:"-9999",idCsImpDomande:a.cbaConfig.idDomanda,valore:StdComponentiSchedePersonalizzabili.elaboroValoreRisposta(a)},f.lstDomande.push(a))});
c.push(f)}});return c},loadModelli:function(a,b){var c=a.lookup("Form");b.forEach(function(d){(b||!b&&"T"===d.get("abilitato"))&&a.lookup("CntModello").items.items.forEach(function(a){a.cbaConfig.idModello===d.idCsImpModelli&&(a.cbaConfig.datiModello=d)});d.lstDomande.forEach(function(a){var b=Ext.isEmpty(c.query("[modello="+d.idCsImpModelli+"]"))?null:c.query("[modello="+d.idCsImpModelli+"]")[0];b&&b.items.items.forEach(function(b){b.cbaConfig.idDomanda===a.idCsImpDomande&&(b.cbaConfig.datiDomanda=
a)});(b=Ext.isEmpty(c.query("[domanda="+a.idCsImpDomande+"]"))?null:c.query("[domanda="+a.idCsImpDomande+"]")[0])&&StdComponentiSchedePersonalizzabili.loadDati(a,b,c)})})},loadModello:function(a,b){var c=controller.lookup("Form");a.cbaConfig.datiModello=b;m.lstDomande.forEach(function(a){var b=Ext.isEmpty(c.query("[modello="+m.idCsImpModelli+"]"))?null:c.query("[modello="+m.idCsImpModelli+"]")[0];b&&b.items.items.forEach(function(b){b.cbaConfig.idDomanda===a.idCsImpDomande&&(b.cbaConfig.datiDomanda=
a)});(b=Ext.isEmpty(c.query("[domanda="+a.idCsImpDomande+"]"))?null:c.query("[domanda="+a.idCsImpDomande+"]")[0])&&StdComponentiSchedePersonalizzabili.loadDati(a,b,c)})},collapsePanel:function(a,b,c){b.add(Ext.create("Ext.Img",{itemId:"IcnCollapse",src:"/cba/css/generali/images/generali/"+(a?"portlet-expand.svg":"portlet-collapse.svg"),height:20,width:20,nonDisabilitare:!0,listeners:{afterrender:function(b){b.getEl().on("click",function(){a?(b.setSrc("/cba/css/generali/images/generali/portlet-collapse.svg"),
a=!1,c.loadDomande||c.lookupController().loadDomande()):(b.setSrc("/cba/css/generali/images/generali/portlet-expand.svg"),a=!0);c.setHidden(a)});b.getEl().setStyle("cursor","pointer")}}}))},collapsePanelBlu:function(a,b,c){b.add(Ext.create("Ext.Img",{itemId:"IcnCollapse",src:"/cba/css/generali/images/generali/"+(a?"portlet-expand-blu.svg":"portlet-collapse-blu.svg"),height:20,width:20,nonDisabilitare:!0,listeners:{afterrender:function(b){b.getEl().on("click",function(){a?(b.setSrc("/cba/css/generali/images/generali/portlet-collapse-blu.svg"),
a=!1,c.loadDomande||c.lookupController().loadDomande()):(b.setSrc("/cba/css/generali/images/generali/portlet-expand-blu.svg"),a=!0);c.setHidden(a)});b.getEl().setStyle("cursor","pointer")}}}))},collapseAll:function(a){a.lookup("CntModello").query("[reference=CntDomande]").forEach(function(a){a.loadDomande=!1;var b=a.up().query("#IcnCollapse")[0];b&&(b.setSrc("/cba/css/generali/images/generali/portlet-expand.svg"),collapsed=!0,a.setHidden(!0))})},elaboroValoreRisposta:function(a){var b=null;switch(a.cbaConfig.tipo){case 1:var c=
!1;a.query("radiofield").forEach(function(a){if(a.getValue()){c=!0;var d=a.lookupController().lookup("Txt"+a.inputValue);b=d?a.inputValue+"$$*!"+d.getValue():a.inputValue}if(c)return!1});break;case 2:var d=";";a.query("checkbox").forEach(function(a){if(a.value){var b=a.lookupController().lookup("Txt"+a.inputValue);d=b?d+(a.inputValue+"$$*!"+b.getValue()+"$$*!;"):d+(a.inputValue+";")}});";"===d&&(d=null);b=d;break;case 3:var e=a.query("textarea"),f="";1<e.length?(f="$$*!",e.forEach(function(a){a.getValue()&&
(f+=a.cbaConfig.id+";;;"+a.getValue()+"$$*!")})):f+=e[0].getValue();"$$*!"===f&&(f=null);b=f;break;case 4:var g=a.query("cbaMultipleChoice")[0],e=g.getValueExclusive(),g=g.cbaConfig.idRisposta;a=a.lookupController().lookup("Txt"+g);e&&a?b=e+"$$*!"+a.getValue():e&&(b=e)}return b},autoExpand:function(a){a.grow=!0;a.autoSize();a.grow=!1},creaRispostaSingola:function(a,b){return Ext.create("Ext.form.field.Radio",{boxLabel:a.get("descrizione"),margin:"5 0 0 0",inputValue:a.get("id"),cls:"cbaCssLabel",
name:"_tmp_radio_"+a.get("idDomanda"),readOnly:b,cbaConfig:{id:a.get("id")},listeners:{change:function(a){var b=a.up("#Form").lookupController();b.notDirtyForm||b.lookup("CampoDirty").setValue(1);b.callBkChangeRisposta&&b.callBkChangeRisposta(a)}}})},creaRispostaSingolaConNote:function(a,b){return Ext.create("Ext.Container",{layout:{type:"vbox",align:"stretch"},margin:"5 0 0 0",items:[{xtype:"radiofield",boxLabel:a.get("descrizione"),inputValue:a.get("id"),cls:"cbaCssLabel",name:"_tmp_radio_"+a.get("idDomanda"),
readOnly:b,cbaConfig:{id:a.get("id")},listeners:{change:function(b,d){var c=b.up("#Form").lookupController(),f=b.lookupController(),g=f.lookup("Txt"+a.get("id"));c.notDirtyForm?(g.setDisabled(!d),g.allowBlank=!d):(g.setDisabled(!d),g.allowBlank=!d,d||g.setValue(null),c.lookup("CampoDirty").setValue(1));f&&f.cbaConfig&&"CsTaskAnalysisTe"===f.cbaConfig.type&&(g.allowBlank=!0)}}},{xtype:"textarea",reference:"Txt"+a.get("id"),cls:"cbaCssLabel css-textarea-radius",flex:1,margin:"0 0 0 25",name:"_tmp_txtRadio_"+
a.get("id"),readOnly:b,maxLength:1E4,disabled:!0,grow:!1,growMin:36,listeners:{change:function(a){StdComponentiSchedePersonalizzabili.autoExpand(a);a=a.up("#Form").lookupController();a.notDirtyForm||a.lookup("CampoDirty").setValue(1)}}}]})},creaRispostaMultipla:function(a,b){return Ext.create("Ext.form.field.Checkbox",{boxLabel:a.get("descrizione"),inputValue:a.get("id"),cls:"cbaCssLabel",margin:"5 0 0 0",name:"_tmp_check_"+a.get("id"),idDomanda:a.get("idDomanda"),readOnly:b,listeners:{change:function(a){a=
a.up("#Form").lookupController();a.notDirtyForm||a.lookup("CampoDirty").setValue(1)}}})},creaRispostaMultiplaConNote:function(a,b){return Ext.create("Ext.Container",{layout:{type:"vbox",align:"stretch"},margin:"5 0 0 0",items:[{xtype:"checkbox",boxLabel:a.get("descrizione"),inputValue:a.get("id"),cls:"cbaCssLabel",name:"_tmp_check_"+a.get("id"),readOnly:b,listeners:{change:function(b,d){var c=b.up("#Form").lookupController(),f=b.lookupController().lookup("Txt"+a.get("id"));c.notDirtyForm?(f.setDisabled(!d),
f.allowBlank=!d):(f.setDisabled(!d),f.allowBlank=!d,d||f.setValue(null),c.lookup("CampoDirty").setValue(1))}}},{xtype:"textarea",reference:"Txt"+a.get("id"),cls:"cbaCssLabel css-textarea-radius",flex:1,margin:"0 0 0 25",name:"_tmp_txtCheck_"+a.get("id"),readOnly:b,maxLength:1E4,disabled:!0,grow:!1,growMin:36,listeners:{change:function(a){StdComponentiSchedePersonalizzabili.autoExpand(a);a=a.up("#Form").lookupController();a.notDirtyForm||a.lookup("CampoDirty").setValue(1)}}}]})},creaRispostaNote:function(a,
b){var c=Ext.create("Ext.form.field.TextArea",{cls:"cbaCssLabel css-textarea-radius",margin:"5 0 0 0",name:"_tmp_note_"+a.get("id"),readOnly:b,maxLength:1E4,grow:!1,growMin:36,cbaConfig:{id:a.get("id")},listeners:{change:function(a){StdComponentiSchedePersonalizzabili.autoExpand(a);a=a.up("#Form").lookupController();a.notDirtyForm||a.lookup("CampoDirty").setValue(1)}}});if(Ext.isEmpty(a.get("descrizione")))return c;var d=Ext.create("Ext.Container",{layout:{type:"vbox",align:"stretch"},margin:"5 0 0 0",
items:[{xtype:"label",text:a.get("descrizione"),cls:"cbaCssLabel"}]});d.add(c);return d},creaRispostaSiNo:function(a,b){return Ext.create("cbaMultipleChoice",{layout:{type:"hbox",pack:"start"},padding:5,width:115,style:"border: none !important;",margin:"5 10 0 0",cbaConfig:{itemsCfg:[{html:"SI",margin:"0 0 0 5",style:"font-size: 17px !important;padding-left: 5px !important;",checkedClsPerson:"choice-checked-css",cls:"choice-round-unchecked-css-border2",isFormField:!0,name:"_tmp_mc_"+a.get("id"),inputValue:"1"},
{html:"NO",margin:"0 0 0 30",style:"font-size: 17px !important;padding-left: 2px !important;",checkedClsPerson:"choice-checked-css",cls:"choice-round-unchecked-css-border2",isFormField:!0,name:"_tmp_mc_"+a.get("id"),inputValue:"0"}],esclusivo:!0,idRisposta:a.get("id")},listeners:{choicechange:function(a){a=a.up("#Form");a.lookupController().notDirtyForm||(a.getForm().getFieldValues().campoDirty="1")}}})},creaRispostaSiNoSpecifSeSi:function(a,b){return Ext.create("Ext.Container",{layout:{type:"hbox",
align:"middle"},items:[{xtype:"cbaMultipleChoice",layout:{type:"hbox",pack:"start"},padding:5,width:115,style:"border: none !important;",margin:"5 10 0 0",cbaConfig:{itemsCfg:[{html:"SI",margin:"0 0 0 5",style:"font-size: 17px !important;padding-left: 5px !important;",checkedClsPerson:"choice-checked-css",cls:"choice-round-unchecked-css-border2",isFormField:!0,name:"_tmp_mc_"+a.get("id"),inputValue:"1"},{html:"NO",margin:"0 0 0 30",style:"font-size: 17px !important;padding-left: 2px !important;",
checkedClsPerson:"choice-checked-css",cls:"choice-round-unchecked-css-border2",isFormField:!0,name:"_tmp_mc_"+a.get("id"),inputValue:"0"}],esclusivo:!0,idRisposta:a.get("id")},listeners:{choicechange:function(c,d){var e=c.up("#Form"),f=e.lookupController(),g=c.lookupController(),h=g.lookup("Txt"+a.get("id"));if(g.onLoad&&b)return!1;f.notDirtyForm?(h.setReadOnly("1"!==d),h.allowBlank="1"!==d):(h.setReadOnly("1"!==d),h.allowBlank="1"!==d,"1"!==d&&h.setValue(null),e.getForm().getFieldValues().campoDirty=
"1")}}},{xtype:"textarea",reference:"Txt"+a.get("id"),name:"_tmp_txt_"+a.get("id"),flex:1,cls:"cbaCssLabel css-textarea-radius",readOnly:b,maxLength:1E4,grow:!1,growMin:36,listeners:{change:function(a){StdComponentiSchedePersonalizzabili.autoExpand(a);a=a.up("#Form");a.lookupController().notDirtyForm||(a.getForm().getFieldValues().campoDirty="1")}}}]})},creaRispostaSiNoSpecifSeNo:function(a,b){return Ext.create("Ext.Container",{layout:{type:"hbox",align:"middle"},items:[{xtype:"cbaMultipleChoice",
layout:{type:"hbox",pack:"start"},padding:5,width:115,style:"border: none !important;",margin:"5 10 0 0",cbaConfig:{itemsCfg:[{html:"SI",margin:"0 0 0 5",style:"font-size: 17px !important;padding-left: 5px !important;",checkedClsPerson:"choice-checked-css",cls:"choice-round-unchecked-css-border2",isFormField:!0,name:"_tmp_mc_"+a.get("id"),inputValue:1},{html:"NO",margin:"0 0 0 30",style:"font-size: 17px !important;padding-left: 2px !important;",checkedClsPerson:"choice-checked-css",cls:"choice-round-unchecked-css-border2",
isFormField:!0,name:"_tmp_mc_"+a.get("id"),inputValue:"0"}],esclusivo:!0,idRisposta:a.get("id")},listeners:{choicechange:function(c,d){var e=c.up("#Form");e.lookupController();var f=c.lookupController(),g=f.lookup("Txt"+a.get("id"));if(f.onLoad&&b)return!1;c.lookupController().notDirtyForm?(g.setReadOnly("1"===d),g.allowBlank="1"===d):(g.setReadOnly("1"===d),g.allowBlank="1"===d,"1"===d&&g.setValue(null),e.getForm().getFieldValues().campoDirty="1")}}},{xtype:"textarea",reference:"Txt"+a.get("id"),
name:"_tmp_txt_"+a.get("id"),flex:1,cls:"cbaCssLabel css-textarea-radius",readOnly:b,maxLength:1E4,grow:!1,growMin:36,listeners:{change:function(a){StdComponentiSchedePersonalizzabili.autoExpand(a);a=a.up("#Form");a.lookupController().notDirtyForm||(a.getForm().getFieldValues().campoDirty="1")}}}]})},loadDati:function(a,b,c){var d=a.valore,e=a.tipo,f={},g;if(d){c.lookupController().notDirtyForm=!0;switch(e){case 1:b.query("checkboxgroup")[0].query("radiofield").forEach(function(a){if(-1!==d.indexOf("$$*!")){var b=
d.split("$$*!");a.inputValue===parseInt(b[0])&&(g=a.getName(),f[g]=a.inputValue,g="_tmp_txtRadio_"+b[0],f[g]=b[1])}else a.inputValue===parseInt(d)&&(g=a.getName(),f[g]=a.inputValue)});break;case 2:var h=d.split(";");h.forEach(function(a){-1!==a.indexOf("$$*!")&&(h.push(a.split("$$*!")[0]),g="_tmp_check_"+a.split("$$*!")[0],f[g]=!0,g="_tmp_txtCheck_"+a.split("$$*!")[0],f[g]=a.split("$$*!")[1])});b.query("[idDomanda="+a.idCsImpDomande+"]").forEach(function(a){-1!==h.indexOf(a.inputValue.toString())&&
(g="_tmp_check_"+a.inputValue,f[g]=!0)});break;case 3:if(b=b.query("textarea"))1<b.length?(b=d.split("$$*!"))&&b.forEach(function(a){-1!==a.indexOf(";;;")&&(a=a.split(";;;"),f["_tmp_note_"+a[0]]=a[1])}):(g="_tmp_note_"+b[0].cbaConfig.id,f[g]=d);break;case 4:if(a=d.split("$$*!"),b=Ext.isEmpty(b.query("cbaMultipleChoice"))?null:b.query("cbaMultipleChoice")[0])g="_tmp_mc_"+b.cbaConfig.idRisposta,f[g]=a[0],1<a.length&&(g="_tmp_txt_"+b.cbaConfig.idRisposta,f[g]=a[1])}c.getForm().setValues(f);c.lookupController().notDirtyForm=
!1;c.query("textarea").forEach(function(a){a.on("afterrender",function(a){a.grow=!0;a.autoSize();a.grow=!1})})}}}});
Ext.define("GeneraliCS.standard.schedePersonalizzabili.view.Area",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",reference:"Modello",layout:{type:"hbox",align:"stretch",pack:"center"},style:{"background-color":"#5FA2DD"},height:40,padding:"7 10 7 10",margin:"5 10 0 0",items:[{xtype:"label",html:this.cbaConfig.titoloArea,cls:"cbaCssLabelTitolo",margin:"5 5 0 0",flex:1},{xtype:"container",itemId:"CntIcona",
reference:"CntIcona",layout:{type:"hbox",align:"middle",pack:"end"},width:40}]},{xtype:"container",reference:"CntDomande",layout:{type:"vbox",align:"stretch"},modello:this.cbaConfig.idModello,hidden:!this.cbaConfig.expandArea,items:[]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.standard.schedePersonalizzabili.view.Domanda",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",reference:"Domanda",layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:1,margin:"10 0 0 0",items:[{xtype:"button",itemId:"InfoScheda",reference:"InfoScheda",iconCls:"icon-info",iconAlign:"center",width:22,height:22,style:{"background-color":"transparent",
border:"none"},nonDisabilitare:!0,hidden:!0},{xtype:"label",html:"<span style='font-size:14px'><strong>"+this.cbaConfig.testoDomanda+"</strong></span>",cls:"cbaCssLabel",margin:"2 0 0 5"},{xtype:"button",minWidth:24,maxWidth:24,maxHeight:24,hidden:"CsSchedeLibereTe"==this.cbaConfig.type?!1:!0,itemId:"ImgDescrFreq_"+this.cbaConfig.idDomanda,reference:"ImgDescrFreq_"+this.cbaConfig.idDomanda,iconCls:"icon-descrizioni-frequenti",margin:"2 0 0 0",tooltip:traduci("DESCR_FREQ"),style:{background:"transparent",
border:"none"}}]},{xtype:"container",reference:"CntRisposte",layout:{type:"vbox",align:"stretch"},domanda:this.cbaConfig.idDomanda,padding:5,items:[]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.store.Agenda",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"tipo"},{name:"idRiferimento"},{name:"dataScadenza",type:"date"},{name:"effettuato"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/agenda/getById",api:{read:"/cba/css/cs/ws/agenda/getById",update:"/cba/css/cs/ws/agenda/update",create:"/cba/css/cs/ws/agenda/save",destroy:"/cba/css/cs/ws/agenda/delete"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.CboxRisposteCSS",{extend:"Generali.data.StoreJson",proxy:{url:"/cba/css/cs/ws/risposte/cbox"}});Ext.define("GeneraliCS.store.CboxSid",{extend:"Generali.data.StoreJson",proxy:{url:"/cba/css/cs/ws/genCss/sid/cbox"}});
Ext.define("GeneraliCS.store.Farmaci",{extend:"Ext.data.Store",alias:"store.farmaci",fields:[{name:"valore"},{name:"extra"},{name:"gruppo"},{name:"codice",convert:function(a,b){var c=a;Ext.isEmpty(b.get("codice"))&&(null==c&&(c=""),c+=b.get("extra"));return c}}],proxy:{type:"ajax",url:"/cba/css/cs/ws/terapie/farmaco",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},pageSize:7,autoDestroy:!0});
Ext.define("GeneraliCS.store.FarmaciGrid",{extend:"Ext.data.Store",alias:"store.farmaciGrid",fields:[{name:"valore"},{name:"extra"},{name:"gruppo"},{name:"codice",convert:function(a,b){var c=a;Ext.isEmpty(b.get("codice"))&&(c+=b.get("extra"));return c}}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/terapie/farmacoGrid",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.Filtri",{extend:"Generali.data.StoreJson",fields:[{name:"id"},{name:"idFunzione"},{name:"compilatore"},{name:"filtro"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/tbgen/filtri/get",api:{read:"/cba/css/cs/ws/tbgen/filtri/get",create:"/cba/css/cs/ws/tbgen/filtri/new",update:"/cba/css/cs/ws/tbgen/filtri/update",destroy:"/cba/css/cs/ws/tbgen/filtri/destroy"}}});
Ext.define("GeneraliCS.store.ImpAnamnesiPers",{extend:"Ext.data.Store",fields:[],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/anamnesi/personalizzabile/imp/get",api:{read:"/cba/css/cs/ws/anamnesi/personalizzabile/imp/get",update:"/cba/css/cs/ws/anamnesi/personalizzabile/imp/update"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.ImpEsamiRicette",{extend:"Ext.data.Store",fields:[],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/esami/impostazioni/get",api:{read:"/cba/css/cs/ws/esami/impostazioni/get"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.ImpEventiAvversi",{extend:"Ext.data.Store",fields:[],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/eventi/impostazioni/get",api:{read:"/cba/css/cs/ws/eventi/impostazioni/get",update:"/cba/css/cs/ws/eventi/impostazioni/update"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.ImpPatologieProblemi",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"tipoICD"},{name:"ICPC"},{name:"tipoFamiliare"},{name:"riordinaAnamnesi"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/anamnesi/patologie/impostazioni/get",api:{read:"/cba/css/cs/ws/anamnesi/patologie/impostazioni/get",update:"/cba/css/cs/ws/anamnesi/patologie/impostazioni/update"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.Lasa",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"descrizione"},{name:"abilitato"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/farmaci/farmadati/lasa/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.PersonConsegne",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idProfilo"},{name:"cadute"},{name:"catetere"},{name:"contenzioni"},{name:"eventiAvversi"},{name:"lesioni"},{name:"nutrizioni"},{name:"skInfezioni"},{name:"skStomia"},{name:"diari"},{name:"parametri"},{name:"rivalutazione"},{name:"attivita"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/consegne/person/getByProfilo",api:{read:"/cba/css/cs/ws/consegne/person/getByProfilo",create:"/cba/css/cs/ws/consegne/person/new",
update:"/cba/css/cs/ws/consegne/person/update"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.PersonRetrodatazione",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idProfilo"},{name:"tipo"},{name:"nOre"}],proxy:{type:"ajax",method:"GET",urlGen:"/ws/genCss/retrodatazione/getbyidprofilo",url:"/cba/css/cs/ws/parametri/retrodatazione/getbyidprofilo",api:{update:"/cba/css/cs/ws/parametri/retrodatazione/update"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.RisposteCSS",{extend:"Generali.data.StoreJson",proxy:{url:"/cba/css/cs/ws/risposte/listrispostepers"}});Ext.define("GeneraliCS.store.RisposteCU",{extend:"Ext.data.Store",fields:[],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/genOsp/risposte/cbox",api:{read:"/cba/css/cs/ws/genOsp/risposte/cbox"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.store.Sintesi",{extend:"Ext.data.Store",fields:[],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/bilancio/eco/sintesi/list",api:{create:"/cba/css/cs/ws/bilancio/eco/sintesi/saveupdate/multi",update:"/cba/css/cs/ws/bilancio/eco/sintesi/saveupdate/multi"},reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});Ext.define("GeneraliCS.store.StatiMonitorCovid",{extend:"Generali.data.StoreCodiceValore",proxy:{url:"/cba/css/cs/ws/protocovid/stati/cbox"}});
Ext.define("GeneraliCS.store.VociAgenda",{extend:"Generali.data.StoreCodiceValore",proxy:{url:"/cba/css/cs/ws/agenda/vociagenda/cbox"}});
Ext.define("GeneraliCS.tabelle.controller.ArchSost",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:a+"#Form"},{ref:"BoxBottoni",selector:a+"#BoxBottoni"},{ref:"BtnNuovaPwd",selector:a+"#BtnNuovaPwd"},{ref:"TxtNuovaPwd",selector:a+"#TxtNuovaPwd"},{ref:"TxtConfermaNuovaPwd",selector:a+"#TxtConfermaNuovaPwd"}]);this.control(a+"#BtnNuovaPwd",{click:this.clickBtnNuovaPwd})},clickBtnNuovaPwd:function(a){var b=
this.getTxtNuovaPwd(),c=this.getTxtConfermaNuovaPwd();b.isHidden()?(b.show(),b.allowBlank=!1,b.validate(),a.setText(traduci("ANNULLA_PASSWORD")),c.show(),c.allowBlank=!1):(b.hide(),b.allowBlank=!0,b.setValue(""),a.setText(traduci("MODIFICA_PASSWORD")),c.hide(),c.allowBlank=!0,c.setValue(""))},aggiornaStore:function(a){var b=this,c=this.getForm().getForm();this.storeForm.load({params:{idOrg:this.idOrganizzazione},callback:function(a,e,f){f?(a=a[0],Ext.isEmpty(a)||(c.loadRecord(a),a=b.getTxtNuovaPwd(),
e=b.getTxtConfermaNuovaPwd(),a.hide(),a.allowBlank=!0,a.setValue(""),b.getBtnNuovaPwd().setText(traduci("MODIFICA_PASSWORD")),e.hide(),e.allowBlank=!0,e.setValue(""))):msgShowError("",e.getError())}})},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues(),c=convertiBool(c);controller_salvaRecord(b,c,a)&&a&&this.callbackEsci&&this.callbackEsci()},verificaCampiForm:function(){var a=[],b=this.getForm();if(!this.controllaPwd())return msgAddError(a,"Controllare la password inserita!"),
msgShow("",a);b.isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},controllaPwd:function(){if(Ext.isEmpty(this.getTxtNuovaPwd())||this.getTxtNuovaPwd().getValue()===this.getTxtConfermaNuovaPwd().getValue())return!0;this.getTxtNuovaPwd().setValue("");this.getTxtConfermaNuovaPwd().setValue("");return!1},gestioneForm:function(){var a=this,b=this.getForm();b.boxBottoni=this.getBoxBottoni();this.storeForm=b.store=Ext.create("GeneraliCS.tabelle.store.ArchSost");b.controller=this;var c=
Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(b){a.salvaForm(!1)},annulla_callback:function(){a.aggiornaStore()},verificaCampiForm_callback:function(){return a.verificaCampiForm()},classeBottoni:"cbaCssBtnFunzione",noIcon:!0}});inserisciBottoni(b.boxBottoni,c,!0);b.boxBottoni.queryById("btnEsci").hide();margineStdBtnFunzione(b.boxBottoni);b.boxBottoni.queryById("btnNuovo").hide();b.boxBottoni.queryById("btnElimina").hide();b.getForm().on("dirtychange",
function(a,c){IsolaCmp(b,c);controller_abilitaBottoni(b)})},loadCampi:function(){var a=this;this.storeForm.load({params:{idOrg:this.idOrganizzazione},callback:function(b,c,d){d?a.aggiornaStore():msgShowError("",c.getError())}})},onLaunch:function(){this.idOrganizzazione=this.cbaConfig.idOrganizzazione;this.gestioneForm();this.loadCampi()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliCS.tabelle.controller.FigureProf",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"GridTe",selector:this.selContainer+"#GridTe"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"}]);this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+
"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#GridTe",{beforeedit:this.beforeeditGridTe,edit:this.editGridTe,canceledit:this.canceleditGridTe,validateedit:this.validateeditGridTe})},clickBtnNuovo:function(a){a=this.getGridTe();a.getStore().insert(0,{});a.getSelectionModel().select(0);a.getPlugin().startEdit(0,0);this.abilitaBottoniGrid(!1)},clickBtnElimina:function(a){var b=this;a=b.getGridTe();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),
{id:c?c.get("id"):""},function(){b.aggiornaStore()})},beforeeditGridTe:function(a,b,c){if(!0===a.editing)return!1;a.getEditor().down("textfield").setReadOnly(this.figProfStandard.includes(b.record.get("codFigProf")));this.abilitaBottoniGrid(!1)},editGridTe:function(a,b,c){c=b.record.getData();var d=a.getEditor().getForm(),e=getBoolValue(c.prescrittore);delete c.prescrittore;Ext.apply(c,{prescrittore:e});d.controller=this;d.store=b.view.getStore();controller_salvaRecord(d,c,!1,!1)?this.abilitaBottoniGrid(!0):
a.startEdit(b.record,0)},canceleditGridTe:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridTe:function(a,b,c){return msgShow("",[])},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a);this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!a);IsolaCmp(this.getGridTe(),!a)},aggiornaStore:function(a){var b=this.getGridTe(),c=b.getStore();c.load({callback:function(d,e,f){f?(d=0,a&&((d=trovaRecord(c,"id",
a))||(d=0)),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d)):msgShowError("",e.getError())}})},onLaunch:function(){this.figProfStandard="M,I,O,F,C,S,Z,N,E,P,L,B,A";this.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.tabelle.controller.GestioneFrequenze",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"Grid",selector:this.selContainer+"#Grid"},{ref:"Form",selector:this.selContainer+"#Form"},{ref:"BoxBottoni",selector:this.selContainer+"#BoxBottoni"},{ref:"CbFiltro",selector:this.selContainer+"#CbFiltro"},{ref:"SommOgni",selector:this.selContainer+
"#SommOgni"},{ref:"Occorrenze",selector:this.selContainer+"#Occorrenze"},{ref:"RadioFrequenza",selector:this.selContainer+"#RadioFrequenza"},{ref:"Giorni",selector:this.selContainer+"#Giorni"}]);this.control(this.selContainer+"#Grid",{selectionchange:this.selectionchangeGrid});this.control(this.selContainer+"#CbFiltro",{change:this.changeCbFiltro});this.control(this.selContainer+"#SommOgni",{change:this.changeSommOgni});this.control(this.selContainer+"#RadioFrequenza",{change:this.changeRadioFrequenza})},
changeSommOgni:function(a,b,c){this.getGiorni().getValue()&&1===b?this.getOccorrenze().setHidden(!1):(this.getOccorrenze().setValue(null),this.getOccorrenze().setHidden(!0))},changeRadioFrequenza:function(a,b,c){"G"===b.tipo&&1===this.getSommOgni().getValue()?this.getOccorrenze().setHidden(!1):(this.getOccorrenze().setValue(null),this.getOccorrenze().setHidden(!0))},changeCbFiltro:function(a,b,c){this.aggiornaStore()},selectionchangeGrid:function(a,b){if(Ext.isEmpty(b))return this.getForm().setDisabled(!0),
!1;this.getForm().setDisabled(!1);var c=b[0],d=this.getForm();clearForm(d);d.loadRecord(c)},salvaForm:function(a){var b=this.getForm(),c=b.getForm().getFieldValues(),c=convertiBool(c);controller_salvaRecord(b,c,a)&&a&&this.callbackEsci&&this.callbackEsci()},gestioneForm:function(){var a=this,b=a.getForm();b.permesso=a.cbaConfig.permesso?a.cbaConfig.permesso:"L";b.boxBottoni=a.getBoxBottoni();a.storeForm=b.store=a.getGrid().getStore();b.controller=a;var c=Ext.create("Generali.standard.controller_PannelloBottoni",
{cbaConfig:{conferma_callback:function(b){a.salvaForm(!1)},annulla_callback:function(){a.aggiornaStore(a.getGrid().getSelectionModel().getSelection()[0].id)},nuovo_callback:function(){controller_nuovoRecord(b)},elimina_callback:function(){var c=b.getForm().findField("id").getValue();Ext.isEmpty(c)?Messaggio("ATTENZIONE","NESSUNA_FREQUENZA_SELEZIONATA","OK","QUESTION"):controller_eliminaRecord(b.store,{id:c},function(){a.aggiornaStore()})},esci_callback:function(){},verificaCampiForm_callback:function(){return a.verificaCampiForm()},
classeBottoni:"cbaCssBtnFunzione",noIcon:!0}});inserisciBottoni(b.boxBottoni,c,!0);b.boxBottoni.queryById("btnEsci").hide();margineStdBtnFunzione(b.boxBottoni);if("S"==b.permesso)b.getForm().on("dirtychange",function(c,e){controller_abilitaBottoni(b);a.getGrid().setDisabled(e);a.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(e);IsolaCmp(b,e)})},verificaCampiForm:function(){var a=[],b=this.getForm(),c=b.getForm().getFieldValues();0!=a.length||b.isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");c.terapie||
c.altro||msgAddError(a,"OBBLIGATORIO_FLAG_TERAPIE_ALTRO");c.tipo||msgAddError(a,"OBBLIGATORIO_OPZIONE_GG_SS_MM");return msgShow("",a)},aggiornaStore:function(a){var b=this.getForm(),c=this.getGrid(),d=c.getStore(),e={},f=this.getCbFiltro().getValue();f&&("T"==f?Ext.apply(e,{terapie:"T"}):Ext.apply(e,{altro:"T"}));d.load({params:e,callback:function(e,f,k){k?Ext.isEmpty(e)?clearForm(b):(a||(a=b.getForm().findField("id").getValue()),e=trovaRecord(d,"id",a),c.getSelectionModel().deselectAll(),c.getSelectionModel().select(e?
e:0)):msgShowError("",f.getError())}})},onLaunch:function(){this.getForm().controller=this;this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliCS.tabelle.controller.Nosologico",{extend:"Generali.standard.ViewController",init:function(){var a="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Form",selector:a+"#Form"},{ref:"BoxBottoni",selector:a+"#BoxBottoni"}]);this.control(a+"#GridProfiliNos",{beforeedit:this.beforeeditGridProfiliNos,edit:this.editGridProfiliNos,canceledit:this.canceleditGridProfiliNos})},canceleditGridProfiliNos:function(){this.aggiornaGridProfiliNos()},aggiornaGridProfiliNos:function(){var a=
this.getListProfiliOrg();this.lookup("GridProfiliNos").getStore().load({params:{listIdProfili:a},callback:function(a,c,d){d||msgShowError("ERRORE",c.getError())}})},getListProfiliOrg:function(){var a=this;a.listaIdProfili||(a.listaIdProfili="",a.cbaConfig.ctrlPerson.getPnlAlbero().getRootNode().cascadeBy(function(b){b.parentNode&&"rootTC"==b.parentNode.get("extra")&&b.parentNode.parentNode.getData().params[0].idOrganizzazione==a.cbaConfig.idOrganizzazione&&(a.listaIdProfili+=b.get("idServizio")+",")}));
return a.listaIdProfili},beforeeditGridProfiliNos:function(a,b,c){if(!0===a.editing)return!1},editGridProfiliNos:function(a,b,c){var d=this;a=b.newValues;b=null;b=null!=a.id?"/cba/css/cs/ws/nosologico/profili/update":"/cba/css/cs/ws/nosologico/profili/new";convertiBool(a);Ext.Ajax.request({method:"POST",url:b,jsonData:Ext.JSON.encode(a),success:function(a){a=Ext.JSON.decode(a.responseText);a.success?(msgShow("MSG_SALVATAGGIO_DATI",a.message),d.aggiornaGridProfiliNos()):msgShowError("ERRORE",a.message)}})},
salvaForm:function(){var a=this.lookup("Form"),b=a.getForm().getFieldValues(),b=convertiBool(b);controller_salvaRecord(a,b,!1)},aggiornaStore:function(){var a=this.lookup("Form");a.store.load({params:{idOrg:this.cbaConfig.idOrganizzazione},callback:function(b,c,d){d?(b=b[0],Ext.isEmpty(b)||a.loadRecord(b)):msgShowError("",c.getError())}})},gestioneForm:function(){var a=this,b=this.lookup("Form");b.boxBottoni=this.lookup("BoxBottoni");b.store=Ext.create("GeneraliCS.tabelle.store.ImpostazNosologico");
b.controller=this;var c=Ext.create("Generali.standard.controller_PannelloBottoni",{cbaConfig:{conferma_callback:function(b){a.salvaForm()},annulla_callback:function(){a.aggiornaStore()},verificaCampiForm_callback:function(){return a.verificaCampiForm()},classeBottoni:"cbaCssBtnFunzione",noIcon:!0}});inserisciBottoni(b.boxBottoni,c,!0);b.boxBottoni.queryById("btnEsci").hide();margineStdBtnFunzione(b.boxBottoni);b.boxBottoni.queryById("btnNuovo").hide();b.boxBottoni.queryById("btnElimina").hide();b.getForm().on("dirtychange",
function(a,c){IsolaCmp(b,c);controller_abilitaBottoni(b)})},verificaCampiForm:function(){var a=[];this.getForm().isValid()||msgAddError(a,"MSG_CAMPI_OBBLIGATORI");return msgShow("",a)},onLaunch:function(){this.aggiornaGridProfiliNos();this.gestioneForm();this.aggiornaStore()},destroy:function(){eliminaStore(this.storeForm);this.callParent()}});
Ext.define("GeneraliCS.tabelle.controller.UnitMisura",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"Container",selector:this.selContainer+"#Container"},{ref:"GridTe",selector:this.selContainer+"#GridTe"},{ref:"BtnNuovo",selector:this.selContainer+"#BtnNuovo"},{ref:"BtnElimina",selector:this.selContainer+"#BtnElimina"},{ref:"ComboCodicePn",selector:this.selContainer+"#ComboCodicePn"},{ref:"ColCodicePn",
selector:this.selContainer+"#ColCodicePn"}]);this.control(this.selContainer+"#BtnNuovo",{click:this.clickBtnNuovo});this.control(this.selContainer+"#BtnElimina",{click:this.clickBtnElimina});this.control(this.selContainer+"#GridTe",{beforeedit:this.beforeeditGridTe,edit:this.editGridTe,canceledit:this.canceleditGridTe,validateedit:this.validateeditGridTe})},clickBtnNuovo:function(a){a=this.getGridTe();a.getStore().insert(0,{});a.getSelectionModel().select(0);a.getPlugin().startEdit(0,0);this.abilitaBottoniGrid(!1)},
clickBtnElimina:function(a){var b=this;a=b.getGridTe();var c=a.getSelectionModel().getSelection()[0];controller_eliminaRecord(a.getStore(),{id:c?c.get("id"):""},function(){b.aggiornaStore()})},beforeeditGridTe:function(a,b,c){if(!0===a.editing)return!1;this.abilitaBottoniGrid(!1);a=a.editor.query("#ComboCodicePn");var d;Ext.each(a,function(a){d=a.getStore()});d.load({params:{idRicovero:this.idRicovero},callback:function(a,b,c){c||msgShowError("",b.getError())}})},editGridTe:function(a,b,c){c=b.newValues;
Ext.apply(c,{codEnte:101});convertiBool(c);var d=this.lookup("GridTe");controller_salvaRecord(d,c,!1,!1)?this.abilitaBottoniGrid(!0):a.startEdit(b.record,0)},canceleditGridTe:function(a,b,c){this.abilitaBottoniGrid(!0);this.aggiornaStore(b.record.get("id"))},validateeditGridTe:function(a,b,c){return msgShow("",[])},abilitaBottoniGrid:function(a){this.getBtnNuovo().setDisabled(!a);this.getBtnElimina().setDisabled(!a);this.cbaConfig.ctrlPerson&&this.cbaConfig.ctrlPerson.getPnlPerson().setDisabled(!a);
IsolaCmp(this.getGridTe(),!a)},aggiornaStore:function(a){var b=this.getGridTe(),c=b.getStore();c.load({callback:function(d,e,f){f?(d=0,a&&((d=trovaRecord(c,"id",a))||(d=0)),b.getSelectionModel().deselectAll(),b.getSelectionModel().select(d)):msgShowError("",e.getError())}})},onLaunch:function(){var a=this;this.getColCodicePn().editor.store.load({params:{idRicovero:a.idRicovero},callback:function(b,c,d){d?a.aggiornaStore():msgShowError("",c.getError())}})},destroy:function(){this.cbaConfig.callbackOnExit&&
Ext.isFunction(this.cbaConfig.callbackOnExit)&&this.cbaConfig.callbackOnExit();this.callParent()}});
Ext.define("GeneraliCS.tabelle.store.ArchSost",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idEnte"},{name:"idOrganizzazione"},{name:"dm7username"},{name:"dm7password"}],proxy:{type:"ajax",url:"/cba/gen/ws/archsost/person/getbyidorg",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/gen/ws/archsost/person/getbyidorg",update:"/cba/gen/ws/archsost/person/update"}},autoDestroy:!0});
Ext.define("GeneraliCS.tabelle.store.FigureProf",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"codFigProf"},{name:"descrizione"},{name:"prescrittore"},{name:"codEnte"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/tbgen/figprof/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/css/cs/ws/tbgen/figprof/list",create:"/cba/css/cs/ws/tbgen/figprof/new",update:"/cba/css/cs/ws/tbgen/figprof/update",destroy:"/cba/css/cs/ws/tbgen/figprof/delete"}},autoDestroy:!0});
Ext.define("GeneraliCS.tabelle.store.GestioneFrequenze",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"codEnte"},{name:"descFreq"},{name:"tipo"},{name:"numero"},{name:"terapie"},{name:"altro"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/genCss/tgen/frequenze/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/css/cs/ws/genCss/tgen/frequenze/list",create:"/cba/css/cs/ws/genCss/tgen/frequenze/new",update:"/cba/css/cs/ws/genCss/tgen/frequenze/update",destroy:"/cba/css/cs/ws/genCss/tgen/frequenze/delete"}},
autoDestroy:!0});Ext.define("GeneraliCS.tabelle.store.ImpostazNosologico",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"idOrganizzazione"},{name:"numPerTipologia"},{name:"numeroCaratteri"},{name:"annoIngresso"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/nosologico/impo/getbyidorg",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/css/cs/ws/nosologico/impo/getbyidorg",update:"/cba/css/cs/ws/nosologico/impo/update"}},autoDestroy:!0});
Ext.define("GeneraliCS.tabelle.store.ProfiliNosologico",{extend:"Ext.data.Store",fields:[],proxy:{type:"ajax",url:"/cba/css/cs/ws/nosologico/profili/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/css/cs/ws/nosologico/profili/list"}},autoDestroy:!0});
Ext.define("GeneraliCS.tabelle.store.UnitMisura",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"descrizione"},{name:"sigla"},{name:"codUniMisBDF"},{name:"armadio"}],proxy:{type:"ajax",url:"/cba/css/cs/ws/farmaci/farmadati/unimis/list",reader:{type:"json",messageProperty:"message",rootProperty:"data"},api:{read:"/cba/css/cs/ws/farmaci/farmadati/unimis/list"}},autoDestroy:!0});
Ext.define("GeneraliCS.tabelle.view.ArchSost",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox"},flex:1,items:[{xtype:"form",itemId:"Form",reference:"Form",layout:{type:"vbox"},flex:1,padding:10,border:0,trackResetOnLoad:!0,items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"textfield",name:"idEnte",hidden:!0},{xtype:"textfield",name:"idOrganizzazione",hidden:!0},{xtype:"container",
itemId:"divTitolo",reference:"divTitolo",layout:{type:"vbox",align:"stretch"},maxHeight:45,padding:10,border:0,items:[{xtype:"label",html:"CREDENZIALI",cls:"cbaCssLabel cbaGrassetto",style:{"font-size":"15px"}}]},{xtype:"container",itemId:"divCredenziali",reference:"divCredenziali",layout:{type:"vbox"},flex:1,padding:10,border:0,items:[{xtype:"textfield",name:"dm7username",fieldLabel:"USERNAME",labelClsExtra:"cbaCssLabel",labelWidth:100,maxLength:100,enforceMaxLength:!0},{xtype:"container",layout:{type:"hbox"},
flex:1,items:[{xtype:"textfield",name:"dm7password",inputType:"password",fieldLabel:"PASSWORD",labelClsExtra:"cbaCssLabel",labelWidth:100,maxLength:100,enforceMaxLength:!0,readOnly:!0},{xtype:"button",margin:"0 10 0 10",disabled:!1,itemId:"BtnNuovaPwd",reference:"BtnNuovaPwd",scale:"small",text:"MODIFICA_PASSWORD"},{xtype:"textfield",itemId:"TxtNuovaPwd",reference:"TxtNuovaPwd",fieldLabel:"NUOVA_PASSWORD",name:"pwdNew",labelWidth:115,labelClsExtra:"cbaLabel",width:360,maxLength:50,enforceMaxLength:!0,
inputType:"password",hidden:!0,minLength:8,margin:"0 10 0 0"},{xtype:"textfield",itemId:"TxtConfermaNuovaPwd",reference:"TxtConfermaNuovaPwd",fieldLabel:"CONFERMA_NUOVA_PASSWORD",labelWidth:130,labelClsExtra:"cbaLabel",width:360,maxLength:50,enforceMaxLength:!0,inputType:"password",hidden:!0,minLength:8,isFormField:!1}]}]}],dockedItems:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",dock:"bottom",margin:"5 0 0 0"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.tabelle.view.FigureProf",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox"},flex:1,items:[{xtype:"gridpanel",itemId:"GridTe",reference:"GridTe",title:"CS_FIGURE_PROF",flex:1,width:400,store:Ext.create("GeneraliCS.tabelle.store.FigureProf"),columns:[{xtype:"gridcolumn",flex:1,dataIndex:"descrizione",text:"DESCRIZIONE",editor:{xtype:"textfield",allowBlank:!1,
maxLength:50,enforceMaxLength:!0}},{xtype:"gridcolumn",text:"PRESCRITTORE",dataIndex:"prescrittore",align:"center",renderer:function(a,b,c,d,e,f,g){renderCheckColumn(b,a)},editor:{xtype:"checkboxfield",itemId:"CheckPrescrittore",reference:"CheckPrescrittore",inputValue:"T",uncheckedValue:"F"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",cbaConfig:{searchField:"descrizione"}},
{xtype:"button",itemId:"BtnNuovo",reference:"BtnNuovo",text:"NUOVO",cls:"cbaCssBtnFunzione"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",text:"ELIMINA",cls:"cbaCssBtnFunzione"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.tabelle.view.GestioneFrequenze",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"gridpanel",itemId:"Grid",reference:"Grid",width:270,store:Ext.create("GeneraliCS.tabelle.store.GestioneFrequenze"),columns:[{xtype:"gridcolumn",flex:1,dataIndex:"descFreq",text:"DESCRIZIONE"}],viewConfig:{loadMask:!1},dockedItems:[{xtype:"toolbar",
dock:"top",items:[{xtype:"combobox",itemId:"CbFiltro",reference:"CbFiltro",fieldLabel:"FILTRO",labelAlign:"left",labelWidth:70,width:250,queryMode:"local",store:new Ext.data.ArrayStore({fields:["codice","valore"],data:[["T",traduci("TERAPIE_ATTIVITA")],["A",traduci("ALTRO")]]}),valueField:"codice",displayField:"valore",emptyText:"NESSUN_FILTRO"}]}]},{xtype:"form",cls:"cbaCssForm",itemId:"Form",reference:"Form",autoScroll:!0,layout:{type:"vbox",align:"stretch"},flex:1,fieldDefaults:{},bodyPadding:5,
trackResetOnLoad:!0,items:[{xtype:"textfield",name:"id",hidden:!0},{xtype:"textfield",name:"descFreq",fieldLabel:"DESCRIZIONE",labelClsExtra:"cbaCssLabel",labelWidth:90,maxWidth:325,margin:"10 0 0 10",maxLength:30,enforceMaxLength:!0,allowBlank:!1},{xtype:"container",layout:{type:"hbox"},margin:"0 0 0 10",items:[{xtype:"container",layout:{type:"vbox"},margin:"10 0 0 0",items:[{xtype:"cssSpinnerfield",itemId:"SommOgni",reference:"SommOgni",name:"numero",fieldLabel:"SOMMINISTRAZIONE_OGNI",labelClsExtra:"cbaCssLabel",
labelWidth:140,width:215,maxValue:999,allowBlank:!1},{xtype:"cssSpinnerfield",itemId:"Occorrenze",reference:"Occorrenze",name:"nVolte",fieldLabel:"OCCORRENZE",labelClsExtra:"cbaCssLabel",labelWidth:140,width:215,value:1,maxValue:999,hidden:!0}]},{xtype:"fieldset",margin:"10 0 0 12",padding:5,items:[{xtype:"radiogroup",itemId:"RadioFrequenza",reference:"RadioFrequenza",labelClsExtra:"cbaCssLabel",labelWidth:100,maxWidth:315,columns:1,allowBlank:!1,items:[{xtype:"radiofield",itemId:"Giorni",reference:"Giorni",
boxLabel:"GIORNI",name:"tipo",inputValue:"G",cbaConfig:{deselezionabile:!1}},{xtype:"radiofield",boxLabel:"SETTIMANE",name:"tipo",inputValue:"S",cbaConfig:{deselezionabile:!1}},{xtype:"radiofield",boxLabel:"MESI",name:"tipo",inputValue:"M",cbaConfig:{deselezionabile:!1}}]}]}]},{xtype:"fieldset",title:"FREQ_VALIDA_PER",bodyPadding:5,layout:{type:"vbox",align:"stretch"},maxWidth:325,margin:"10 0 0 10",items:[{xtype:"checkbox",name:"terapie",boxLabel:"TERAPIE_ATTIVITA",inputValue:"T",uncheckedValue:"F",
maxWidth:124,margin:"0 0 0 5"},{xtype:"checkbox",name:"altro",boxLabel:"ALTRO",inputValue:"T",uncheckedValue:"F",maxWidth:124,margin:"0 0 5 5"}]}],dockedItems:[{xtype:"container",dock:"bottom",layout:{type:"hbox",pack:"end"},items:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",margin:"0 2 0 0"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.tabelle.view.Nosologico",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"vbox"},padding:20,flex:1,items:[{xtype:"gridpanel",itemId:"GridProfiliNos",reference:"GridProfiliNos",height:300,width:800,store:Ext.create("GeneraliCS.tabelle.store.ProfiliNosologico"),columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"idProfilo",
hidden:!0},{xtype:"gridcolumn",dataIndex:"descProfilo",flex:1,text:"Tipologia Cartella"},{xtype:"gridcolumn",dataIndex:"abilitato",text:"Nosologico abilitato",width:120,align:"center",editor:{xtype:"checkbox",inputValue:"T",uncheckedValue:"F"},renderer:function(a,b,c,d,e,f,g){renderCheckColumn(b,a)}},{xtype:"gridcolumn",dataIndex:"lettera",width:150,text:"Lettera",editor:{xtype:"textfield",maxLength:2,enforceMaxLength:!0}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",
{autoCancel:!1,errorSummary:!1})]},{xtype:"form",layout:"hbox",itemId:"Form",reference:"Form",flex:1,margin:"20 0 0 0",width:800,border:0,trackResetOnLoad:!0,items:[{xtype:"textfield",hidden:!0,name:"id"},{xtype:"textfield",hidden:!0,name:"idOrganizzazione"},{xtype:"checkboxfield",boxLabel:traduci("NUMER_PER_TIP"),cls:"cbaLabel",inputValue:"T",uncheckedValue:"F",name:"numPerTipologia"},{xtype:"checkboxfield",boxLabel:traduci("ANNO_INGRESSO"),cls:"cbaLabel",inputValue:"T",uncheckedValue:"F",name:"annoIngresso",
margin:"0 0 0 20"},{xtype:"numberfield",name:"numeroCaratteri",maxValue:10,minValue:1,fieldLabel:traduci("NUM_CHAR"),labelClsExtra:"cbaLabel",width:250,labelWidth:190,margin:"0 0 0 40",allowDecimals:!1}],dockedItems:[{xtype:"container",itemId:"BoxBottoni",reference:"BoxBottoni",dock:"bottom",margin:"5 0 0 0"}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.tabelle.view.UnitMisura",{extend:"Generali.standard.ControlledContainer",initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",itemId:"GridTe",reference:"GridTe",title:"UNITA_MISURA",header:Ext.isEmpty(this.cbaConfig.headerGrid)?!0:this.cbaConfig.headerGrid,flex:1,width:400,store:Ext.create("Generali.unitaMisura.store.UnitaMisura"),columns:[{xtype:"gridcolumn",
flex:1,dataIndex:"id",hidden:!0},{xtype:"gridcolumn",flex:1,dataIndex:"descrizione",text:"DESCRIZIONE",editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}},{xtype:"gridcolumn",flex:1,dataIndex:"sigla",text:"SIGLA_PTO",editor:{xtype:"textfield",allowBlank:!1,maxLength:50,enforceMaxLength:!0}},{xtype:"gridcolumn",flex:1,dataIndex:"codUniMisBDF",itemId:"ColCodicePn",reference:"ColCodicePn",text:"VALORE_PN",editor:{xtype:"combobox",itemId:"ComboCodicePn",reference:"ComboCodicePn",
labelWidth:89,maxWidth:290,margin:"0 0 5 5",displayField:"valore",queryMode:"local",valueField:"codice",editable:!0,allowBlank:!1,store:Ext.create("GeneraliCS.tabelle.store.UnitMisura"),forceSelection:!1,listConfig:{minWidth:350}},renderer:function(a,b,c){b=this.down("[dataIndex=codUniMisBDF]").getEditor().getStore();return(a=trovaRecord(b,"codice",a))?a.data.valore:""}},{xtype:"gridcolumn",flex:1,dataIndex:"armadio",text:"ARMADIO",editor:{xtype:"checkbox",name:"armadio",inputValue:"T",uncheckedValue:"F"},
renderer:function(a,b,c,d,e,f,g){a="check"+Ext.id();c='<img style="display:block;height:16px;margin-left:32px;" \n\t\t\t\t\t\t\t\t\t\t\tsrc="/cba/generali/images/svg/others/'+("T"===c.get("armadio")?"checked":"check-disabled-gray")+'.svg"></img>';return"<span id="+a+">"+c+"</span>"}}],viewConfig:{loadMask:!1},plugins:[Ext.create("Ext.grid.plugin.RowEditing",{autoCancel:!1,errorSummary:!1})],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"cercaGrid",cbaConfig:{searchField:"descrizione"}},{xtype:"button",
itemId:"BtnNuovo",reference:"BtnNuovo",text:"NUOVO",cls:"cbaCssBtnFunzione"},{xtype:"button",itemId:"BtnElimina",reference:"BtnElimina",text:"ELIMINA",cls:"cbaCssBtnFunzione"}]}]}]}]});this.callParent(arguments)}});
Ext.define("GeneraliCS.testatapopup.controller.TestataPopUp",{extend:"Generali.standard.ViewController",init:function(){this.selContainer="#"+this.containerId+" ";this.callParent(arguments);this.addRef([{ref:"CntRegistrazioni",selector:this.selContainer+"#CntRegistrazioni"},{ref:"ContainerStorico",selector:this.selContainer+"#ContainerStorico"},{ref:"BtnLeft",selector:this.selContainer+"#BtnLeft"},{ref:"BtnRight",selector:this.selContainer+"#BtnRight"},{ref:"CntDettaglio",selector:this.selContainer+
"#CntDettaglio"}]);this.control(this.selContainer+"#BtnLeft",{click:this.navigaButton});this.control(this.selContainer+"#BtnRight",{click:this.navigaButton});this.control(this.selContainer+"#CntRegistrazioni",{afterrender:this.eventoAfterRender})},eventoAfterRender:function(){this.controllerForm.eventoAfterRender&&this.controllerForm.eventoAfterRender()},navigaButton:function(a){this.naviga(a.direzione,a)},clickRegistrazioni:function(a){this.controllerForm.testataSelezionata=a.cbaConfig.idRec;this.controllerForm.aggiornaStore();
for(var b=Ext.ComponentQuery.query("[itemId=CntRegistrazioni] button"),c=1;c<=b.length;c++)b[c-1].removeCls("cbaCssBtnTestataSel"),b[c-1].removeCls("sosia-sel"),b[c-1].addCls("cbaCssBtnTestata");a.removeCls("cbaCssBtnTestata");a.addCls("cbaCssBtnTestataSel");(b=this.controllerForm.recordTestata=trovaRecord(this.storeRegistrazioni,"id",a.cbaConfig.idRec))&&cssHasBloccoSosia(b.get("tipoBlocco"))&&a.addCls("sosia-sel");this.abilitaAnnulla(b);this.abilitaConvalida(b)},selezionaBottone:function(a){var b=
Ext.ComponentQuery.query("[itemId=CntRegistrazioni] button"),c=a?a:this.controllerForm.testataSelezionata;a&&(this.controllerForm.testataSelezionata=a,this.controllerForm.bottoneTestata=b);for(var d=0;d<b.length;d++)b[d].cbaConfig.idRec==c?(b[d].removeCls("cbaCssBtnTestata"),b[d].removeCls("sosia-sel"),b[d].addCls("cbaCssBtnTestataSel")):(b[d].removeCls("cbaCssBtnTestataSel"),b[d].addCls("cbaCssBtnTestata"));a&&(a=this.controllerForm.recordTestata=trovaRecord(this.storeRegistrazioni,"id",c),this.abilitaAnnulla(a),
this.abilitaConvalida(a))},abilitaAnnulla:function(a){if(this.controllerForm.annullabile){var b=this.controllerForm.getBoxBottoni().queryById("btnElimina"),c="S"==this.controllerForm.getForm().permesso,d=a.get("tipoBlocco"),d=d&&"DEL"==cssGetBlocchi(d)[0],e=this.compilatore,f=a.get("permessiAnnulla");a=a.get("compilatore");a=f&&0<f.length?-1!=f.indexOf(e):e==a;c&&!d&&a?(b.cbaConfig.recordAnnullabile=!0,b.setDisabled(!1)):(b.cbaConfig.recordAnnullabile=!1,b.setDisabled(!0))}},abilitaConvalida:function(a){if(this.controllerForm.convalidaManuale){var b=
this.controllerForm.getBoxBottoniSpecial().queryById("btnConvalidaManuale"),c="S"==this.controllerForm.getForm().permesso,d=a.get("tipoBlocco"),e=!1,f=d&&"DEL"==cssGetBlocchi(d)[0],g=CBA.moduli.modulo49.operatore.compilatore,h=a.get("permessiAnnulla");a=a.get("compilatore");g=h&&0<h.length?-1!=h.indexOf(g):g==a;f||d&&"M"==d[0].valore?e=!1:g&&(e=!0);c&&e?(b.cbaConfig.recordConvalidabile=!0,b.setHidden(!1)):(b.cbaConfig.recordConvalidabile=!1,b.setHidden(!0))}},naviga:function(a,b){if(!b.abilitato)return!1;
var c=this,d,e="sinistra"==a,f;e?(d=c.storeRegistrazioni.getAt(0),f=c.urlNext):(d=c.storeRegistrazioni.getAt(c.storeRegistrazioni.getCount()-1),f=c.urlPrev);d={id:d.get("id"),data:d.get("data"),tipoTestata:c.controllerForm.cbaConfig.tipoTestata,idRicovero:c.anagraficaCorrente.idRicovero,idProfilo:c.idProfilo,compilatore:c.compilatore};Ext.isDefined(c.anagraficaCorrente.idRicoveroCu)&&(c.anagraficaCorrente.idRicovero||delete d.idRicovero,Ext.apply(d,{idRicoveroCu:c.anagraficaCorrente.idRicoveroCu}));
c.controllerForm.cbaConfig.sottoTipoTestata&&Ext.apply(d,{sottoTipoTestata:c.controllerForm.cbaConfig.sottoTipoTestata});if(1==c.getFiltriAttivi().getValue()){Ext.apply(d,c.winRicerca.down("form").getForm().getFieldValues());d.me=getBoolValue(d.me);d.avanzate=getBoolValue(d.avanzate);var g=Ext.clone(d.al);g.setHours(23);g.setMinutes(59);Ext.apply(d,{al:g})}Ext.Ajax.request({method:"GET",url:f,params:d,success:function(a){a=Ext.JSON.decode(a.responseText);if(a.success){if(0<a.data.length){e?(c.storeRegistrazioni.insert(0,
a.data[0]),5==c.storeRegistrazioni.getCount()&&c.storeRegistrazioni.removeAt(c.storeRegistrazioni.getCount()-1)):(c.storeRegistrazioni.removeAt(0),c.storeRegistrazioni.insert(c.storeRegistrazioni.getCount(),a.data[0]));var b=0;c.primo=!1;c.ultimo=!1;c.storeRegistrazioni.data.each(function(a){c.avvaloraCampiTestata(a,b);b++});c.selezionaBottone();c.abilitaButtonNaviga(c.getBtnLeft(),"left",!c.primo);c.abilitaButtonNaviga(c.getBtnRight(),"right",!c.ultimo)}}else msgShowError("",a.message)}})},avvaloraCampiTestata:function(a,
b){var c=this.getCntRegistrazioni().items.items[b],d=cssTrovaFormStd(this);c.cbaConfig.idRec=a.get("id");this.primaVolta&&(this.controllerForm.testataSelezionata=c.cbaConfig.idRec,this.primaVolta=!1);c.setDisabled(!1);var e=cssGetBlocchi(a.get("tipoBlocco")),f,g=cssGetWarningHours(a.get("tipoBlocco")),h="",k="";g&&(k="<b>"+g.extra+"</b>",h="-warning");f="T"==a.get("daCompletare")?'<img style="height: 16px; width: 16px; position: absolute; left: 0px; bottom: -2px;" src="/cba/css/generali/images/btnFunzione/edit-special.svg"/>':
"";f="DEL"==e[0]?'<span class="cbaCssLockTestata-annullata-testo">'+FormattaData(a.get("data"),"d M. Y")+'</span><p class="cbaCssOraRegistrazione cbaCssLockTestata-annullata-testo">'+f+FormattaData(a.get("data"),"H:i"):FormattaData(a.get("data"),"d M Y")+'<p class="cbaCssOraRegistrazione ">'+f+FormattaData(a.get("data"),"H:i");c.setText(f);c.cbabubbletip&&(c.cbabubbletip.destroy(),delete c.cbabubbletip);c.recordAnnullato=!1;d=d.permesso;"DEL"==e[0]?(c.recordAnnullato=!0,c.removeCls(c.classeLockTestata),
c.classeLockTestata="cbaCssLockTestata-annullata"+h,c.addCls(c.classeLockTestata),h="<b>"+traduci("CS_TESTATA_ANNULLATA")+":</b><br>"+e[2]+"<br>"+k,c.cbabubbletip=creaToolTipBubble(c.getId(),h,null,null,null,null,null,null,!0,"X"),c.gonzo="annullato"):"S"==d&&"SOME"==e[0]?(c.removeCls(c.classeLockTestata),c.classeLockTestata="cbaCssLockTestata-unlocked"+h,c.addCls(c.classeLockTestata),h="<b>"+traduci("CS_TESTATA_MULTICOMPILATORE")+":</b><br>"+e[2]+"<br>"+k,c.cbabubbletip=creaToolTipBubble(c.getId(),
h,null,null,null,null,null,null,!0,"W"),c.gonzo="parziale"):"L"==d||"LOCK"==e[0]?(c.removeCls(c.classeLockTestata),c.classeLockTestata="cbaCssLockTestata"+h,c.addCls(c.classeLockTestata),h="<b>"+traduci("IMPOSSIBILE_MODIFICA_DATI")+":</b>","S"==d?"LOCK"==e[0]&&(h+="<br>"+e[2]+"<br>"+k):h+="<br><b>"+traduci("CS_PERMESSI_DI_SOLA_LETTURA")+"</b><br>"+k,c.gonzo="bloccato",c.cbabubbletip=creaToolTipBubble(c.getId(),h,null,null,null,null,null,null,!0,"W")):"WR"==e[0]&&"B"==e[1]?(c.removeCls(c.classeLockTestata),
h="<b>"+traduci("BOZZA")+"</b>"+k,c.cbabubbletip=creaToolTipBubble(c.getId(),h,null,null,null,null,null,null,!0)):(c.gonzo=!1,c.removeCls(c.classeLockTestata));"WR"===e[0]&&g&&"B"!=e[1]&&(c.classeLockTestata="cbaCssWarningHours",c.addCls(c.classeLockTestata),c.cbabubbletip=creaToolTipBubble(c.getId(),"<b>"+k+"</b>",null,null,null,null,null,null,!0,"W"));cssHasBloccoSosia(a.get("tipoBlocco"))&&c.addCls("sosia");c.cbaConfig.idRec=a.get("id");this.getCntRegistrazioni();"T"==a.get("first")&&(this.primo=
!0);"T"==a.get("last")&&(this.ultimo=!0)},aggiornaStore:function(a,b){var c=this,d={al:c.controllerForm.salvataggioRecord?c.controllerForm.dataRecord:getServerTimeSync(),tipoTestata:c.controllerForm.cbaConfig.tipoTestata,idRicovero:c.anagraficaCorrente.idRicovero,idProfilo:c.idProfilo,compilatore:c.compilatore,soloUnaTestata:c.cbaConfig.controllerTestata.cbaConfig.soloUnaTestata?c.cbaConfig.controllerTestata.cbaConfig.soloUnaTestata:"F",extraParams:Ext.isEmpty(c.controllerForm.cbaConfig.extraParams)?
"":c.controllerForm.cbaConfig.extraParams};c.cbaConfig.controllerTestata.cbaConfig.importSosia&&(Ext.apply(d,{importSosia:c.cbaConfig.controllerTestata.cbaConfig.importSosia}),c.cbaConfig.controllerTestata.cbaConfig.importSosia=null);Ext.isDefined(c.anagraficaCorrente.idRicoveroCu)&&(c.anagraficaCorrente.idRicovero||delete d.idRicovero,Ext.apply(d,{idRicoveroCu:c.anagraficaCorrente.idRicoveroCu}));var e=c.cbaConfig.selezioneTestata,f="T"==d.soloUnaTestata&&a;e||f?Ext.apply(d,{idTestata:e||(f?a:null)}):
a&&Ext.apply(d,{idTestata:a});c.cbaConfig.selezioneTestata=null;c.controllerForm.cbaConfig.sottoTipoTestata&&Ext.apply(d,{sottoTipoTestata:c.controllerForm.cbaConfig.sottoTipoTestata});c.controllerForm.salvataggioRecord&&(c.controllerForm.salvataggioRecord=!1);1==c.getFiltriAttivi().getValue()&&(Ext.apply(d,c.winRicerca.down("form").getForm().getFieldValues()),d.me=getBoolValue(d.me),d.avanzate=getBoolValue(d.avanzate),e=Ext.clone(d.al),e.setHours(23),e.setMinutes(59),Ext.apply(d,{al:e}));if(c.cbaConfig.controllerTestata.cbaConfig.nuovoDefault&&
c.controllerForm.getForm().boxBottoni.queryById("btnNuovo"))return c.cbaConfig.controllerTestata.eventoNuovoScatenato=!0,c.controllerForm.getForm().boxBottoni.queryById("btnNuovo").handler(),!0;c.cbaConfig.controllerTestata.eventoNuovoScatenato&&(Ext.each(c.cbaConfig.controllerTestata.getTpVideate().getTabBar().items.items,function(a){a.show()}),c.cbaConfig.controllerTestata.eventoNuovoScatenato=!1);c.storeRegistrazioni.load({params:d,callback:function(d,e,f){if(f){var g=0,h=!1;c.primo=!1;c.ultimo=
!1;c.getCntRegistrazioni().query("button").forEach(function(a){a.setDisabled(!0);a.setText("");a.cbaConfig.idRec=!1;a.addCls("cbaCssBtnTestata");a.removeCls("sosia-sel");a.removeCls("sosia");a.removeCls(a.classeLockTestata);a.setTooltip(!1)});d.forEach(function(a){h||(h=a);c.avvaloraCampiTestata(a,g);g++});h||(c.controllerForm.testataSelezionata=!1);0<g&&(c.abilitaButtonNaviga(c.getBtnLeft(),"left",!c.primo),c.abilitaButtonNaviga(c.getBtnRight(),"right",!c.ultimo));d=c.controllerForm.getForm();(e=
d.boxBottoni.queryById("btnCopia"))&&e.setDisabled("L"==d.permesso||0==g);d=a?a:h.id;c.selezionaBottone(d);c.cbaConfig.callbackFnPortlet&&(c.controllerForm.callbackFnPortlet=c.cbaConfig.callbackFnPortlet);c.controllerForm.getForm();var k=c.controllerForm.getView();k&&(e=k.down("#PnlCompilatore"),f=k.down("#PanelRecordAnnullato"),k=k.down("cssPnlBozza"),e&&(e.setDataRegistrazione(),e.setOraRegistrazione(),e.setLabelCompilatore("")),f&&f.setHidden(!0),k&&k.setHidden(!0));c.controllerForm.aggiornaStore(d,
b);(d=c.getCntDettaglio().down("#BtnStampa"))&&!d.inattivo&&d.setHidden(0==g)}else msgShowError("",e.getError())}})},abilitaButtonNaviga:function(a,b,c){a.hide();c&&a.show();a.abilitato=c},onLaunch:function(){var a=this;a.primaVolta=!0;a.anagraficaCorrente=a.cbaConfig.anagraficaExtra||CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data;a.idProfilo=CBA.parametriGenerali.idProfiloCss;a.compilatore=Ext.isDefined(CBA.moduli.modulo49)&&Ext.isDefined(CBA.moduli.modulo49.operatore)?CBA.moduli.modulo49.operatore.id:
null;a.getCntRegistrazioni().controller=a;a.codOspite=a.cbaConfig.controllerTestata.cbaConfig.codOspitePopUp;a.nuovoDefault=a.cbaConfig.controllerTestata.cbaConfig.nuovoDefault;a.getCntDettaglio().add(Ext.create(a.cbaConfig.controllerTestata.cbaConfig.videataDettaglio,{layout:{type:"vbox",align:"stretch"},flex:1,cbaConfig:{controllerTestata:a,codVideata:this.cbaConfig.codVideata,idVoceAgenda:this.cbaConfig.idVoceAgenda,permesso:a.cbaConfig.permessoDe,anagraficaCorrente:a.anagraficaCorrente}}));a.controllerForm=
a.getCntDettaglio().down("#Form").controller;a.storeRegistrazioni=Ext.create("GeneraliCS.testatapopup.store.TestataPopUp");if(a.controllerForm.cbaConfig.testataGen){ImpostaUrl([a.storeRegistrazioni]);var b=a.storeRegistrazioni.getProxy();a.controllerForm.urlNext=b.url.substring(0,b.url.lastIndexOf("/")+1)+"next";a.controllerForm.urlPrev=b.url.substring(0,b.url.lastIndexOf("/")+1)+"prev"}a.getCntRegistrazioni().query("button").forEach(function(b){b.on("click",function(b){a.clickRegistrazioni(b)})});
b=["76","2","1","10","26"].includes(this.cbaConfig.codVideata);initRicercaAvanzataCartella(a.getContainerStorico(),a,!1,b&&addCbSosia());a.urlNext=a.controllerForm.urlNext||"/cba/css/cs/ws/testate/next";a.urlPrev=a.controllerForm.urlPrev||"/cba/css/cs/ws/testate/prev";a.controllerForm.urlList&&a.storeRegistrazioni.getProxy().setUrl(a.controllerForm.urlList);a.controllerForm.aggiornaDaTestata&&a.aggiornaStore()},destroy:function(){this.callParent()}});
Ext.define("GeneraliCS.testatapopup.store.TestataPopUp",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"data",type:"date"},{name:"compilatore"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/testate/get",urlGen:"/ws/genCss/testate/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.testatapopup.store.TestateTemporali",{extend:"Ext.data.Store",fields:[{name:"id"},{name:"data",type:"date"},{name:"fineRange",type:"date"}],proxy:{type:"ajax",method:"GET",url:"/cba/css/cs/ws/testate/temporali/get",reader:{type:"json",messageProperty:"message",rootProperty:"data"}},autoDestroy:!0});
Ext.define("GeneraliCS.testatapopup.view.TestataPopUp",{extend:"Generali.standard.ControlledContainer",layout:{align:"stretch",type:"hbox"},initComponent:function(){Ext.applyIf(this,{items:[{xtype:"container",itemId:"Container",reference:"Container",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",itemId:"ContainerStorico",reference:"ContainerStorico",layout:{type:"hbox",align:"stretch"},height:70,margin:"0 0 5 0",items:[{xtype:"fieldset",layout:{type:"hbox"},margin:"7 0 0 5",
padding:"5 0 0 5",cls:"cbaCssFieldset-dark",items:[{xtype:"label",margins:"",height:44,margin:"20 0 20 5",cls:"cbaCssLabel",text:"REGISTRAZIONI",style:{"font-weight":"bold"}},{xtype:"container",width:30,height:30,margin:"20 0 30 15",items:[{xtype:"button",itemId:"BtnLeft",reference:"BtnLeft",direzione:"sinistra",iconCls:"icon-cartella-btn-left",focusCls:"",hidden:!0,border:0,style:"background:transparent;",width:30,height:30,nonDisabilitare:!0}]},{xtype:"container",layout:{type:"hbox",pack:"start"},
defaults:{margin:"10 10 0 10"},itemId:"CntRegistrazioni",reference:"CntRegistrazioni",items:[{xtype:"button",cls:"cbaCssBtnTestata",width:110,height:40,disabled:!0},{xtype:"button",cls:"cbaCssBtnTestata",width:110,height:40,disabled:!0},{xtype:"button",cls:"cbaCssBtnTestata",width:110,height:40,disabled:!0},{xtype:"button",cls:"cbaCssBtnTestata",width:110,height:40,disabled:!0}]},{xtype:"container",width:30,height:30,margin:"20 10 30 5",items:[{xtype:"button",itemId:"BtnRight",reference:"BtnRight",
direzione:"destra",iconCls:"icon-cartella-btn-right",hidden:!0,focusCls:"",border:0,style:"background:transparent;",width:30,height:30,nonDisabilitare:!0}]}]}]},{xtype:"container",itemId:"CntDettaglio",reference:"CntDettaglio",layout:{type:"vbox",align:"stretch"},flex:1}]}]});this.callParent(arguments)}});
Ext.define("CbaUtilsCss.componenti.desktop.CBAGridLockable",{extend:"CbaUtils.componenti.desktop.CBAShortcutGrid",alias:"widget.CBAGridLockable",alternateClassName:"CBAGridLockable",initComponent:function(){this.columns.splice(0,0,Ext.create("Ext.grid.column.Column",{itemId:"ColumnLock",reference:"ColumnLock",text:"",fixed:"true",width:32,sortable:!1,resizable:!1,renderer:function(a,b,c,d,e,f){return"<span style='white-space: nowrap' id='colcanc"+Ext.id()+"'></span>"}}));this.callParent(arguments);
this.on("beforeitemmouseenter",this.onBeforeItemMouseEnter);this.on("selectionchange",this.onSelectionChange);this.on("itemmouseenter",this.onItemMouseEnter);this.on("itemmouseleave",this.onItemMouseLeave)},listeners:{beforeedit:function(a,b,c){if(this.onBeforeEdit&&Ext.isFunction(this.onBeforeEdit))this.onBeforeEdit(a,b,c);if(!0===a.editing||(a=b.record.get("tipoBlocco"))&&cssHasBloccoModifica(a))return!1}},onItemMouseEnter:function(a,b,c,d,e,f){c.recordAnnullato||Ext.each(c.getElementsByTagName("span"),
function(a){if(-1!=a.id.indexOf("colcanc")&&cssHasBloccoModifica(b.get("tipoBlocco"))){Ext.id();var c='<img id=" + idBtn + " src="/cba/css/generali/images/generali/css-lock'+(cssGetWarningHours(b.get("tipoBlocco"))?"-warning":"")+'.svg" />';a.innerHTML=c}})},onItemMouseLeave:function(a,b,c,d,e,f){c.recordAnnullato||Ext.each(c.getElementsByTagName("span"),function(a){-1!=a.id.indexOf("colcanc")&&cssHasBloccoModifica(b.get("tipoBlocco"))&&(a.innerHTML="")})},onSelectionChange:function(a,b,c,d,e,f){a=
b&&0<b.length?b[0].get("id"):!1;if(!(b&&0!=b.length&&a&&0<a))return(a=this.cbaConfig.btnElimina)&&a.setDisabled(!0),!1;var g=this;if(!g.cbaConfig.btnElimina){var h;Ext.each(this.query("button"),function(a){h=a.itemId.toUpperCase();if(-1!=h.indexOf("ELIMINA")||-1!=h.indexOf("ANNULLA"))g.cbaConfig.btnElimina=a});g.cbaConfig.btnElimina||CBA.parametriGenerali.produzione||alert("Button Elimina non trovato, inserire sul launch della videata: grid.cbaConfig.btnElimina = me.getBtnElimina();")}(a=g.cbaConfig.btnElimina)&&
!a.cbaConfig.gestAnnullabile&&a.setDisabled(cssHasBloccoModifica(b[0].get("tipoBlocco")))},onBeforeItemMouseEnter:function(a,b,c,d,e,f){c.tooltipCreato||c.recordAnnullato||!cssHasBloccoModifica(b.get("tipoBlocco"))||(c.tooltipCreato=!0,d="<b>"+traduci("IMPOSSIBILE_MODIFICA_DATI")+":</b>",d+="<br>"+cssGetBlocchi(b.get("tipoBlocco"))[2],cssGetWarningHours(b.get("tipoBlocco"))&&(d+="<br><b>"+cssGetWarningHours(b.get("tipoBlocco")).extra+"</b>"),Ext.isDefined(a.objTooltip)||(a.objTooltip={}),a.objTooltip[c.id]||
(a.objTooltip[c.id]=!0,a=creaToolTipBubble(c,d,null,null,null,null,null,null,!0,"W"),cssShowTip(a,c)))}});
Ext.define("CbaUtilsCss.componenti.desktop.CBAGridAnnullabile",{extend:"CBAGridLockable",alias:"widget.CBAGridAnnullabile",alternateClassName:"CBAGridAnnullabile",tooltip:!0,initComponent:function(){this.columns.splice(0,0,Ext.create("Ext.grid.column.Column",{text:"",dataIndex:"deletedInfo",width:32,sortable:!1,resizable:!1,renderer:function(a,b,e,f,g,h){Ext.id();var c;b=(b=(a=e.get("tipoBlocco"))?cssGetBlocchi(a):null)&&b[0]&&"DEL"==b[0];a&&b&&(c='<img id=" + idBtn + " src="/cba/css/generali/images/generali/css-lock-annullato'+
(cssGetWarningHours(e.get("tipoBlocco"))?"-warning":"")+'.svg" />');return c}}));var a=this.viewConfig.getRowClass,b=a&&Ext.isFunction(a)?a:function(a,b,e,f){return" "};this.viewConfig.getRowClass=function(){var a=b.apply(b,arguments),d=arguments[0].get("tipoBlocco"),e=d?cssGetBlocchi(d):null,e=e&&e[0]&&"DEL"==e[0];d&&e&&(a+=" cbaCssLockTestata-annullata-testo ");return a};this.callParent(arguments)},onBeforeEdit:function(a,b,c){b=(b=(a=b.record.get("tipoBlocco"))?cssGetBlocchi(a):null)&&b[0]&&"DEL"==
b[0];if(a&&(b||cssHasBloccoModifica(a)))return!1},onSelectionChange:function(a,b){var c=b&&0<b.length?b[0].get("id"):!1;if(!b||0==b.length||!cbaValidId(c))return!1;var d=this;if(!d.cbaConfig.btnAnnulla){var e;Ext.each(this.query("button"),function(a){e=a.itemId.toUpperCase();if(-1!=e.indexOf("ELIMINA")||-1!=e.indexOf("ANNULLA"))d.cbaConfig.btnAnnulla=a,d.on("beforedestroy",function(a){delete a.cbaConfig.btnAnnulla})})}if(c=d.cbaConfig.btnAnnulla){var f=b[0].get("tipoBlocco"),g=f?cssGetBlocchi(f):
null,g=g&&g[0]&&"DEL"==g[0];cssHasBloccoModifica(f);var h=CBA.moduli.modulo49.operatore.compilatore==b[0].get("compilatore");this.cbaConfig.annullaIfNotValidCompilatore&&!Ext.isEmpty(b)&&0>=b[0].get("compilatore")&&(h=!0);c.setDisabled(f&&g||!h);c.cbaConfig.gestAnnullabile=!0}this.callParent(arguments)},onBeforeItemMouseEnter:function(a,b,c,d,e,f){if(this.tooltip&&!c.tooltipCreato){var g=b.get("tipoBlocco"),h=g?cssGetBlocchi(g):null,h=h&&h[0]&&"DEL"==h[0];g&&h&&(c.tooltipCreato=!0,c.recordAnnullato=
!0,g="<b> "+traduci("CS_TESTATA_ANNULLATA")+":</b>",this.hideCompilatore?g+='<br><span style="color:#ee3442;"><b>'+traduci("CS_RECORD_ANNULLATO"):(g+='<br><span style="color:#ee3442;"><b>'+traduci("CS_RECORD_ANNULLATO_DA"),g+=" "+b.get("compilatoreNominativo")+" ( "+b.get("compilatoreFigProf")+" )"),g+=" "+traduci("IL_GIORNO"),h=b.get("deletedData"),g+=" "+Ext.Date.format(Ext.Date.parse(h,"c"),"d/m/Y"),g+=" "+traduci("ALLE").toLowerCase()+" "+Ext.Date.format(Ext.Date.parse(h,"c"),"H:i"),g+=" </span>",
cssGetWarningHours(b.get("tipoBlocco"))&&(g+="<br><b>"+cssGetWarningHours(b.get("tipoBlocco")).extra+"</b>"),g=creaToolTipBubble(c,g,null,null,null,null,null,null,!0,"X"),cssShowTip(g,c))}this.callParent(arguments)}});
Ext.define("CbaUtilsCss.componenti.desktop.CSSFromEsameToReferto",{extend:"Ext.container.Container",alias:"widget.CSSFromEsameToReferto",alternateClassName:"CSSFromEsameToReferto",layout:{type:"vbox",align:"stretch"},margin:"0 0 10 0",initComponent:function(){this.items=[{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"label",text:this.titoloEsame,cls:"cbaCssLabelTitleBlue",maxWidth:460},{xtype:"button",itemId:"BtnCollapse",reference:"BtnCollapse",text:"",margin:"0 0 0 5",
width:32,cls:"cbaCssBtnAnagrafica",iconCls:"icon-collapse-css css-icon-medium-white",cbaConfig:{collapsed:!1},handler:function(a){a.up("CSSFromEsameToReferto").collapseDetails(!a.cbaConfig.collapsed)}}]},{xtype:"gridpanel",itemId:"Grid",reference:"Grid",store:this.storeReferto,flex:1,margin:"5 0 10 0",autoScroll:!0,disableSelection:!0,columns:[{xtype:"gridcolumn",dataIndex:"id",hidden:!0},{xtype:"gridcolumn",dataIndex:"warning",width:32,sortable:!1,renderer:function(a,b,c,d,e,f){switch(a){case "R":a=
"/cba/generali/images/16/css-icon-red.png";break;case "V":a="/cba/generali/images/16/css-icon-green.png";break;default:a="/cba/generali/images/16/css-icon-light.png"}return"<img id='icona-warning-"+Ext.id()+"' src='"+a+"' style='cursor:pointer;'></img>"}},{xtype:"gridcolumn",text:traduci("DETTAGLI_ESAMI_VISITE"),dataIndex:"prestazione",flex:1,sortable:!1},{xtype:"gridcolumn",itemId:"ColumnReferto",reference:"ColumnReferto",text:traduci("REFERTO_VALORI"),dataIndex:"valore",width:110,sortable:!1,editor:{xtype:"textfield"},
renderer:function(a,b,c,d,e,f){d="background-color:#D6E7F5; cursor:pointer;";a&&(e=c.get("valoreMin"),c=c.get("valoreMax"),e&&a<e||c&&a>c)&&(d+="color:red;");b.tdStyle=d;return 0===a?"0":a||""}},{xtype:"gridcolumn",text:traduci("REFERTO_UM"),dataIndex:"uniMis",width:75,align:"center",sortable:!1},{xtype:"gridcolumn",text:traduci("REFERTO_VALORI_RIFERIMENTO"),dataIndex:"valoreRif",width:135,sortable:!1},{xtype:"gridcolumn",text:traduci("REFERTO_VALORI_PRECEDENTI"),dataIndex:"valorePrec",width:135,
sortable:!1,renderer:function(a,b,c,d,e,f){d="background-color:#D6E7F5; cursor:pointer;";a&&(e=c.get("valoreMin"),c=c.get("valoreMax"),e&&a<e||c&&a>c)&&(d+="color:red;");b.tdStyle=d;return 0===a?"0":a||""}},{xtype:"gridcolumn",text:traduci("REFERTI_PRECEDENTI"),dataIndex:"dataRefPrec",width:135,sortable:!1,renderer:function(a,b,c,d,e,f){return FormattaData(a,"d/m/Y H:i")}},{xtype:"gridcolumn",text:traduci("NOTE"),dataIndex:"note",flex:1,sortable:!1,notEsame:!0,editor:{xtype:"textareafield",flex:1,
height:100},renderer:function(a,b,c,d,e,f){return a?a.replaceAll("\n","<br/>").replaceAll("\r","<br/>"):a}}],viewConfig:{loadMask:!1,getRowClass:function(a,b,c,d){a=this.up("grid").up("CSSFromEsameToReferto").notEsame;return Ext.isDefined(a)&&a?"cbaCssRigaAlta100":"cbaCssRigaAlta40"}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],listeners:{cellclick:this.cellclickGrid,beforerender:this.beforerenderGrid}}];this.callParent(arguments)},collapseDetails:function(a){this.down("#Grid").setHidden(a);
var b=this.down("#BtnCollapse");b.setIconCls(a?"icon-expand-css css-icon-medium-white":"icon-collapse-css css-icon-medium-white");b.cbaConfig.collapsed=a},cellclickGrid:function(a,b,c,d,e,f,g){if(this.up("CSSFromEsameToReferto").solaLettura)return!1;var h=!1;Ext.each(b.childNodes,function(a){a.children&&Ext.each(a.children,function(a){a.id&&-1!=a.id.indexOf("icona-warning")&&g.target.id&&-1!=g.target.id.indexOf("icona-warning")&&(h=!0)})});h&&(a=d.get("warning"),"V"==a?d.set("warning","R"):"R"==a?
d.set("warning",null):d.set("warning","V"))},getRefData:function(){var a=this.down("grid").getStore().getData(),b=[];Ext.each(a.items,function(a){b.push(a.getData())});return b},abilitaColonneEsame:function(a){var b=this.down("#Grid");Ext.each(b.columns,function(b){var c=b.dataIndex;c&&"id"!=c&&"warning"!=c&&b.setHidden(b.notEsame?a:!a)})},beforerenderGrid:function(a){var b=a.up("CSSFromEsameToReferto");a.getStore().on("update",function(a){a=b.up("form");a.down("#CampoDirty")&&a.down("#CampoDirty").setValue("dirtyform");
a.controller&&a.controller.getBtnDettagliReferto&&a.controller.getBtnDettagliReferto().setDisabled(!0)})}});
Ext.define("cbaHtmlEditorBlur",{extend:"Ext.form.field.HtmlEditor",alias:"widget.cbaHtmlEditorBlur",fontFamilies:"Arial;Courier New;Tahoma;Times New Roman;Verdana;Oswald;Open sans".split(";"),enableLinks:!0,initEvents:function(){this.callParent(arguments);this.on({scope:this,initialize:this.onInitializeHtmlEditor})},onInitializeHtmlEditor:function(a){var b=this;a=this.getWin();var c=Ext.bind(this.onHtmlEditorBlur,this),d=Ext.bind(this.onHtmlEditorFocus,this);a.attachEvent?(a.addEventListener("blur",
this.cbaConfig.fnBlur?this.cbaConfig.fnBlur:c),a.addEventListener("focus",this.cbaConfig.fnFocus?this.cbaConfig.fnFocus:d)):(a.addEventListener("blur",this.cbaConfig.fnBlur?this.cbaConfig.fnBlur:c,!1),a.addEventListener("focus",this.cbaConfig.fnFocus?this.cbaConfig.fnFocus:d,!1));var e=this.getDoc();a=function(){return b.onKeypress(b,e)};Ext.isGecko&&e.addEventListener("keypress",a);(Ext.isIE||Ext.isWebKit||Ext.isOpera)&&e.addEventListener("keydown",a);this.getToolbar().setHidden(this.cbaConfig.showTools?
!1:!0);this.focus()},onHtmlEditorBlur:function(a){this.getToolbar().hide()},onHtmlEditorFocus:function(a){},onKeypress:function(a,b){var c=a.up("cbaFieldsetHtmlEditor");!c||c.disableSessionRefresh||a.refreshSessionInit||(a.refreshSessionInit=!0,c=Ext.Function.createBuffered(function(){return a.refreshSession(a)},2E4),Ext.isGecko&&b.addEventListener("keypress",c),(Ext.isIE||Ext.isWebKit||Ext.isOpera)&&b.addEventListener("keydown",c))},refreshSession:function(a){Ext.Ajax.request({method:"GET",url:"/cba/gen/ws/enti/get",
params:{id:CBA.parametriGenerali.codEntePwd}})}});
Ext.define("cbaFieldsetHtmlEditor",{extend:"Ext.form.FieldSet",alias:"widget.cbaFieldsetHtmlEditor",alternateClassName:"cbaFieldsetHtmlEditor",title:"NOTE",overflowY:"auto",minHeight:120,initComponent:function(){var a=this;this.items=[{xtype:"textarea",itemId:"CbaHtmlEditor_CampoTextArea",name:this.cbaConfig.name,isFormField:this.cbaConfig.notFormField?!1:!0,hidden:!0,listeners:{change:function(b,c,d){this.up("fieldset").down("#CbaHtmlEditor_PanelHtml").setHtml(this.getValue());a.cbaConfig.callBackChangeFn&&
!a.cbaConfig.suspendChange&&a.cbaConfig.callBackChangeFn(b)}}},{xtype:"panel",itemId:"CbaHtmlEditor_PanelHtml",padding:5,border:0}];this.callParent(arguments)},listeners:{beforerender:function(a){a.cbaConfig.minimal&&a.setMinHeight(40);a.cbaConfig.maximal&&a.setMaxHeight(a.cbaConfig.maximal)},afterrender:function(a){this.getEl().on("click",function(b){if("IMG"==b.target.tagName)return!1;if(!a.solaLettura&&!a.down("cbaHtmlEditorBlur")){(b=a.cbaConfig.minimal)&&a.getMinHeight()<b&&a.setMinHeight(b);
var c=Ext.create("widget.cbaHtmlEditorBlur",{isFormField:!1,height:a.cbaConfig.progetto?150:a.getHeight()-35,cbaConfig:{fnBlur:function(a){a=a.target;for(var b=a.parent,e=!1;b&&!e&&b.id!==c.id;)Ext.fly(b).hasCls("x-panel")?e=!0:b=b.parentElement;!c._combo_opened&&e?d():c._combo_opened="SELECT"==a.nodeName},fnFocus:function(b){b=a.down("cbaHtmlEditorBlur");"undefined"==b.getValue()&&b.setValue("")},showTools:!0},listeners:{change:function(a,b){var c=a.up("cbaFieldsetHtmlEditor").down("#CbaHtmlEditor_CampoTextArea");
0!=c.getValue().localeCompare(b)&&(Ext.isEmpty(b)||"undefined"==b||(b=b.replace(/[\u200B-\u200D\uFEFF]/g,"")),c.setValue("undefined"!=b?b:""))},initialize:function(b){a.callbackFnOnInit&&a.callbackFnOnInit(b)}}}),d=function(){a.cbaConfig.minimal&&a.setMinHeight(40);c.hide();Ext.defer(function(){c.destroy()},200);a.down("#CbaHtmlEditor_PanelHtml")&&a.down("#CbaHtmlEditor_PanelHtml").show()};Ext.util.Observable.capture(c,function(a,b,g){"focusenter"!=a&&"focusleave"!=a||"cbaHtmlEditorBlur"!=b.$className||
("iframe"==g.target.localName?"focusleave"==a?d():"focusenter"==a&&(0<c.cbaFocusEnter&&c.getRegion().isOutOfBound(Ext.util.Point.fromEvent(Ext.event.Event))?d():c.cbaFocusEnter++):c.focus())});c.cbaFocusEnter=0;a.add(c);a.down("#CbaHtmlEditor_PanelHtml").hide();b=a.down("#CbaHtmlEditor_CampoTextArea").getValue();c.setValue(""!=b?b:"");Ext.defer(function(){c.getEditorBody().click()},100)}})}},setSolaLettura:function(a){this.solaLettura=a},getValue:function(){return this.down("#CbaHtmlEditor_CampoTextArea").getValue()},
setValue:function(a){this.down("#CbaHtmlEditor_CampoTextArea").setValue(a);return this}});Ext.define("cbaCmpMemoPerson",{extend:"cbaFieldsetHtmlEditor",alias:"widget.cbaCmpMemoPerson",alternateClassName:"cbaCmpMemoPerson"});
Ext.define("CbaUtilsCss.componenti.desktop.CboxTreePanel",{extend:"Ext.form.field.Text",alias:"widget.cboxTreePanel",alternateClassName:"cboxTreePanel",initComponent:function(){var a=this;this.remoteSearch=Ext.isDefined(this.remoteSearch)?this.remoteSearch:!0;this.hideSearchField=Ext.isDefined(this.remoteSearch)&&!this.remoteSearch;this.listeners={render:this.render};this.callParent(arguments);this.winTree=this.creaWin();this.on("change",Ext.Function.createBuffered(function(b){var c=b.getValue();
if(b.blockBufferedChange)return b.blockBufferedChange=!1;if(a.remoteSearch){if(Ext.isEmpty(c))return!1;if(3<=c.length){if(Ext.isEmpty(a.queryParam))throw new "campo queryParam non passto al componente";b={};a.loadTree((b[a.queryParam]=c.toUpperCase(),b),function(){return a.winTree.defaultShow()});a.winTree.queryById("TxtRicerca")&&a.winTree.queryById("TxtRicerca").setValue(c)}}},400,this))},loadTree:function(a,b){var c=this;a=a||{};this.stringSearch=Ext.Object.isEmpty(a)?"":a.descAtc;this.store.load({params:a,
callback:function(a,e,f){f?(c.store.root.expand(),b&&b(),Ext.isEmpty(a)&&c.store.root.appendChild({text:'<span style="font-size: 15px; font-weight: bold;" class="cbaCssLabel">'+traduci("NESSUN_DATO_PRESENTE")+"</span>",iconCls:null,expanded:!1,leaf:!0})):msgShowError("",e.getError())}})},getStore:function(){return this.store},render:function(a){var b=this;creaToolTip(a.getId(),"DOPPIOCLIK_PER_RICERCARE","","",150);a.getEl().on("dblclick",function(){Ext.isEmpty(b.getValue())?b.loadTree(!1,function(){return b.winTree.defaultShow()}):
b.winTree.defaultShow()})},creaWin:function(){var a=this;return Ext.create("winCBA",{titolo:this.titleWin,name:"CbaUtilsCss.componenti.desktop.WinTree",larghezzaWin:this.winWidth||789,altezzaWin:this.winHeight||400,configItem:{store:this.store,cboxTreePanel:this,queryParam:this.queryParam,hideSearchField:this.hideSearchField,itemdblclick:function(b){a.fireEvent("itemdblclickCboxTreePanel",b)}},defaultShow:function(){a.winTree.showAt(a.getX(),a.getY()+a.getHeight())}})},destroy:function(){this.callParent()}});
Ext.define("CbaUtilsCss.componenti.desktop.ComboEsitiLarger",{extend:"Ext.form.field.ComboBox",alias:"widget.comboEsitiLarger",alternateClassName:"comboEsitiLarger",height:34,flex:1,matchFieldWidth:!0,nonEspandere:!1,queryMode:"local",valueField:"codice",displayField:"valore",emptyText:traduci("CLICK_INSERIRE_ESITO"),cls:"css-cb-esiti",listConfig:{tpl:new Ext.XTemplate('<tpl for=".">','<li role="option" class="x-boundlist-item" style="list-style-type: none; "> ','<div class="{[this.getColor(values.extra, true)]}" style="display: inline-block; background-size: contain; height: 24px; width: 24px; margin-top: 10px;"></div>',
'<div style="display: inline-block; margin-left:10px; color: {[this.getColor(values.extra)]}; font-size: 18px; padding-bottom: 10px;">{valore}</div>',"</li>","</tpl>",{disableFormats:!0,getColor:function(a,b){var c=b?" ":"black";switch(a){case "T":c=b?"icon-like-css":"#86C567";break;case "F":c=b?"icon-dislike-css":"#EE3442";break;case "X":c=b?"icon-denied-css":"#f9aa00"}return c},getClassOld:function(a){}})},listeners:{change:function(a,b){a.removeCls("css-cb-esiti-orange");a.removeCls("css-cb-esiti-red");
a.removeCls("css-cb-esiti-green");a.removeCls("icon-like-css-inner");a.removeCls("icon-dislike-css-inner");a.removeCls("icon-denied-css-inner");var c=trovaRecord(a.getStore(),"codice",b);if(b&&c)switch(c.get("extra")){case "T":a.addCls("css-cb-esiti-green");a.addCls("icon-like-css-inner");break;case "F":a.addCls("css-cb-esiti-red");a.addCls("icon-dislike-css-inner");break;case "X":a.addCls("css-cb-esiti-orange"),a.addCls("icon-denied-css-inner")}var d=a.up("cmpEsitiAttivita");if(c&&d&&d.onChangeCombo)d.onChangeCombo(a,
b,c.get("extra"));Ext.defer(function(){a.blur()},200)},afterrender:function(a){if(a.readOnly||a.nonEspandere)return!1;a.expand()}}});Ext.define("FakeCbaMultipleChoice",{extend:"CbaUtils.componenti.all.CbaMultipleChoice",alias:"widget.FakeCbaMultipleChoice",alternateClassName:"FakeCbaMultipleChoice",initComponent:function(){this.callParent(arguments)}});
Ext.define("CbaUtilsCss.componenti.desktop.CssAgenda",{extend:"Ext.form.FieldSet",alias:"widget.CssAgenda",alternateClassName:"CssAgenda",nameFrequenze:"",nameCbAgenda:"_tmp_agenda",hideBorder:!1,allowBlank:!0,extraItems:[],itemIdCombo:"ComboValidita",itemIdImgInfo:"InfoScadenza",labelCboxScadenza:"VALIDITA",uses:["CbaUtils.componenti.all.CbaMultipleChoice","GeneraliCS.store.Agenda","GeneraliCS.schede.store.Frequenze"],reference:"CssAgenda",layout:{type:"hbox",align:"middle"},initComponent:function(){var a=
this;this.storeAgenda=Ext.create("GeneraliCS.store.Agenda");this.items=[{xtype:"combobox",itemId:this.itemIdCombo,reference:this.itemIdCombo,fieldLabel:this.labelCboxScadenza,name:this.nameFrequenze,margin:"16 0 0 0",store:Ext.create("GeneraliCS.schede.store.Frequenze"),labelClsExtra:"cbaCssLabel",minChars:0,displayField:"descFreq",queryMode:"local",valueField:"id",listeners:{select:this.selectCboxFrequenza.bind(this),keyup:this.keyupCboxFrequenza.bind(this)},validator:function(b){var c=!0;if(!a.allowBlank){if(Ext.isEmpty(b)&&
a.down("FakeCbaMultipleChoice").down("checkbox").getValue())return traduci("VALIDITA_MANDATORY");!a.allowBlank&&Ext.isEmpty(b)&&(c=!1)}return c||traduci("CS_CAMPO_OBBLIGATORIO")}},{xtype:"FakeCbaMultipleChoice",layout:{type:"hbox",align:"middle"},nonDisabilitare:!0,style:"border: none !important",padding:"0 0 5 0",cbaConfig:{itemsCfg:[{html:traduci("AGENDA"),cls:"choice-round-unchecked-css",style:{"font-size":"12px","padding-left":"5px","text-align":"center","border-radius":"5px"},width:100,name:this.nameCbAgenda,
isFormField:!1,inputValue:"T",value:!1}],esclusivo:!1},listeners:{afterrender:function(b){b.down("checkbox").on("change",a.onChoicechange.bind(a))}}},{xtype:"label",width:16,nonDisabilitare:!0,margin:"16 0 0 0",cls:"icon-info",itemId:this.itemIdImgInfo,reference:this.itemIdImgInfo,listeners:{afterrender:function(b){b.getEl().on("click",function(){return a.onClickInfoAgenda(b)})}}}];this.extraItems&&0<this.extraItems.length&&this.items.push.apply(this.items,[].concat($jscomp.arrayFromIterable(this.extraItems)));
this.callParent(arguments);this.hideBorder&&this.setStyle({border:"none !important"})},rejectAgenda:function(){var a=this,b=this.down("FakeCbaMultipleChoice"),c=b.down("checkbox"),d=b.idAgenda;d&&this.fetchDataDelete(d).then(function(a){b.idAgenda=null;c.suspendChangeEvent=!0;c.setValue(!1);c.suspendChangeEvent=!1}).then(function(){return a.showBoxMessage(!1)})["catch"](function(a){return msgShowError("",a)})},onChangeCboxFrequenza:function(a,b,c){b||this.rejectAgenda();this.getExpirationDate()},
selectCboxFrequenza:function(a,b,c){this.getExpirationDate()},keyupCboxFrequenza:function(a,b,c){Ext.isEmpty(a.getValue())&&this.rejectAgenda()},getImageInfo:function(){return this.down("#"+this.itemIdImgInfo)},getCboxFreq:function(){return this.down("#"+this.itemIdCombo)},fetchDataInsert:function(a){var b=this.storeAgenda.getProxy().api.create;return new Promise(function(c,d){Ext.Ajax.request({method:"POST",url:b,jsonData:Ext.JSON.encode(a),success:function(a){a=Ext.JSON.decode(a.responseText);var b=
a.data,e=a.message;a.success?c(b):d(e)}})})},fetchDataDelete:function(a){var b=this.storeAgenda.getProxy().api.destroy;return new Promise(function(c,d){Ext.Ajax.request({method:"POST",url:b,jsonData:Ext.JSON.encode([a]),success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.data,e=a.message;a.success?c(b):d(e)}})})},fetchDataUpdate:function(a){var b=this.storeAgenda.getProxy().api.update;return new Promise(function(c,d){Ext.Ajax.request({method:"POST",url:b,jsonData:Ext.JSON.encode(a),success:function(a){a=
Ext.JSON.decode(a.responseText);var b=a.data,e=a.message;a.success?c(b):d(e)}})})},getExpirationDate:function(){var a=this.getPnlCompilatore();this.dateExpiration=null;if(a||this.nameDataIni){var b=null,c=this.getCboxFreq().getSelection(),d=this.getImageInfo();if(!Ext.isEmpty(this.nameDataIni)){var e=this.lookupController();(e=cssTrovaFormStd(e))&&(b=e.getForm().findField(this.nameDataIni).getValue())}null==b&&(b=a.getDataOraReg());c&&(this.dateExpiration=calcolaDataDiScadenza(b,c,d,this),Ext.isEmpty(this.dateExpiration)||
(this.dateExpiration=Ext.Date.parse(this.dateExpiration,"d/m/Y")))}},onChoicechange:function(a,b,c){var d=this;if(!a.suspendChangeEvent){var e=this.lookupController(),f=cssTrovaFormStd(e),g=this.down("FakeCbaMultipleChoice");a=Ext.isEmpty(g.idAgenda)?null:g.idAgenda;var h=e.cbaConfig;c=h.codVideata;var k=h.idVoceAgenda,h=h.funzioneAgenda,e=e.idRicovero;this.value=getBoolValue(b);this.getExpirationDate();this.getCboxFreq().isValid();f&&(null==this.getCboxFreq().getSelection()?Messaggio("ATTENZIONE",
"Campo validità non compilato","OK","WARNING"):(f=(f=f.getForm().findField("id"))&&f.getValue(),cbaValidId(f)?b?this.fetchDataInsert({idVoceAgenda:k,idRiferimento:f,tipo:this.getTipo(),funzione:h||c,dataScadenza:this.dateExpiration,idRicovero:e}).then(function(a){g.idAgenda=a.id;d.getExpirationDate()}).then(function(){return d.showBoxMessage(!0)})["catch"](function(a){return msgShowError("",a)}):a&&this.fetchDataDelete(a).then(function(a){g.idAgenda=null;d.getExpirationDate()}).then(function(){return d.showBoxMessage(!1)})["catch"](function(a){return msgShowError("",
a)}):this.showBoxMessage(b,!0)))}},showBoxMessage:function(a,b){b=void 0===b?!1:b;var c=(void 0===a?0:a)?"Il dato  "+(b?"verrà inserito in agenda":"è stato inserito in agenda")+" ":"Il dato "+(b?"<b>Non</b> verrà inserito in agenda":"è stato eliminato dall'agenda")+" ";Ext.create("cbaNotification",{iconMsg:"icon-info",timeToHide:2E3}).showNotification("ATTENZIONE",c)},getPnlCompilatore:function(){return null},getDataOra:function(){return null},getTipo:function(){return null},getIdVoceAgenda:function(){return null},
prepare:function(a){a=void 0===a?{}:a;var b=this;a&&Object.assign(this,a);if(Ext.isEmpty(this.nameDataIni)){if(a=this.getPnlCompilatore(),this.getPnlCompilatore())a.down("datefield").on("change",function(){b.getExpirationDate()})}else if(a=this.lookupController())if(a=cssTrovaFormStd(a))if(a=a.getForm().getFields(this.nameDataIni))a.on("change",function(){b.getExpirationDate()})},fetchValidita:function(a){a=void 0===a?function(){return null}:a;this.getCboxFreq().getStore().load({params:{altro:"T"},
callback:function(b,c,d){d?a(b):msgShowError("".operation.getError())}})},onClickInfoAgenda:function(a){var b=this,c=this.down("FakeCbaMultipleChoice"),d=Ext.isEmpty(c.idAgenda)?null:c.idAgenda;this.loadDataScadenzaFromIdAgenda(d).then(function(d){d&&(d=b.createPopupDataScadenza(d,c),d.showAt(a.getX()-d.larghezzaWin+a.getWidth(),a.getY()+a.getHeight()))})["catch"](function(a){return msgShowError("",a)})},loadDataScadenzaFromIdAgenda:function(a){var b=this;return new Promise(function(c,d){cbaValidId(a)?
b.storeAgenda.load({params:{id:a},callback:function(a,b,g){g?Ext.isEmpty(a)||c(a[0].getData()):d(b.getError())}}):c(!1)})},createPopupDataScadenza:function(a,b){var c=this;return Ext.create("winCBA",{titolo:"",larghezzaWin:150,altezzaWin:120,closable:!1,layout:"fit",header:!1,maximizable:!1,layout:{type:"vbox",align:"stretch"},name:[{xtype:"panel",layout:"hbox",flex:1,bodyPadding:"5 0 0 5",items:[{xtype:"datefield",width:120,value:a.dataScadenza,fieldLabel:traduci("SCADENZA_TEST"),labelAlign:"top",
editable:!1,labelClsExtra:"cbaCssLabel",allowBlank:!1}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"CSSButtonsPanel",flex:1,layout:{type:"hbox",align:"bottom",pack:"end"},items:[{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",handler:function(d){var e=d.up("window");d=e.down("datefield").getValue();Ext.apply(a,{dataScadenza:d});c.fetchDataUpdate(a).then(function(d){b.idAgenda=a.id;c.getExpirationDate()}).then(function(){c.showBoxMessage(!0);e.close()})["catch"](function(a){return msgShowError("",
a)})}},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",handler:function(a){return a.up("window").close()}}]}]}]}]})}});
Ext.define("CbaUtilsCss.componenti.desktop.CssBoxBottoniSpecial",{extend:"Ext.container.Container",alias:"widget.CSSButtonsPanel",alternateClassName:"CSSButtonsPanel",layout:{type:"hbox"},initComponent:function(){var a,b,c=getIconButtons();Ext.each(this.items,function(d){if(("button"==d.xtype||-1!=d.xtype.toLowerCase().indexOf("stampa"))&&!d.special){a=d.itemId.toLowerCase();b=traduci(d.text);b=Ext.isEmpty(b)?null:b;switch(!0){case -1!=a.indexOf("help"):Ext.apply(d,{iconCls:c.btnHelp,textHint:b||
traduci("Help")});break;case -1!=a.indexOf("nuovo"):Ext.apply(d,{iconCls:c.btnNuovo,textHint:b||traduci("Nuovo")});break;case -1!=a.indexOf("elimina")&&-1==a.indexOf("hard"):Ext.apply(d,{iconCls:c.btnElimina,textHint:b||traduci("ANNULLA")});break;case -1!=a.indexOf("elimina")&&-1!=a.indexOf("hard"):Ext.apply(d,{iconCls:c.btnEliminaX,textHint:b||traduci("ELIMINA")});break;case -1!=a.indexOf("conferma"):Ext.apply(d,{iconCls:c.btnConferma,textHint:b||traduci("Conferma")});break;case -1!=a.indexOf("annulla"):Ext.apply(d,
{iconCls:c.btnAnnulla,textHint:b||traduci("Ripristina")});break;case -1!=a.indexOf("stampa"):Ext.apply(d,{iconCls:c.BtnStampa,textHint:b||traduci("Stampa")});break;case -1!=a.indexOf("esci"):Ext.apply(d,{iconCls:c.btnEsci,textHint:b||traduci("Esci")})}Ext.apply(d,{cls:"cbaBtnFunzione-mini",width:30,margin:"0 2 0 2",text:""})}});this.callParent(arguments)},listeners:{afterrender:function(a){Ext.each(a.query("button"),function(a){a.special||(a.on("mouseover",function(a){if(!a.isDisabled()){a.cbaTip||
(a.cbaTip=Ext.create("CbaIconBtnTip",{html:a.textHint,cls:"cba-tip-button",listeners:{show:function(a){Ext.defer(function(){Ext.isDefined(a)&&(a.destroyed||a.hide())},2E3)}}}));a.cbaTip.setStyle("opacity",.1);var b=a.getPosition();a.cbaTip.showAt(b[0],b[1]+a.getHeight());a.cbaTip.showAt(b[0]-a.cbaTip.getWidth()/2+a.getWidth()/2,b[1]+a.getHeight());a.cbaTip.setStyle("opacity",1)}}),a.on("mouseout",function(a){a.isDisabled()||a.cbaTip.hide()}),a.on("destroy",function(a){a.cbaTip&&a.cbaTip.destroy()}))})}}});
Ext.define("CbaUtilsCss.componenti.desktop.CssBtnAttivita",{extend:"Ext.button.Button",alias:"widget.CssBtnAttivita",alternateClassName:"CssBtnAttivita",reference:"BtnAttivita",cls:"cbaCssBtnFunzione-special",text:traduci("PROGRAMMAZIONE_ATTIVITA"),hidden:!0,width:210,nonDisabilitare:!0,setting:{},initComponent:function(){var a=this;this.callParent(arguments);Object.assign(this.setting,{getIdRif:function(){return null},onClick:function(){return null},callbackOnCloseCalendar:function(){return null},
getAnagraficaExtra:function(){return CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).data},forceNoIdRif:!1});this.startPolicy=this.startPolicy.bind(this);this.on("click",function(){return a.onClickBtnAttivita(!1)})},getIdCollegamento:function(){return this.setting.idCollegamento},fetchSettingActivity:function(a){a=void 0===a?null:a;if(!a)throw"nessun id collegamento passato!!";var b=this.recSettingActivity;return b?Promise.resolve(b):new Promise(function(b,d){Ext.Ajax.request({method:"GET",async:!1,
url:"/cba/css/cs/ws/attivita/anagrafica/getbyidcollandpermission",params:{idProfilo:CBA.parametriGenerali.idProfiloCss,idProfiloPwdDeCss:CBA.parametriGenerali.idProfiloPwdDeCss,idCollegamento:a},success:function(a){a=Ext.JSON.decode(a.responseText);var c=a.data,e=a.message;a.success?b(c):d(e)}})})},openCalendarioUtente:function(a){a=void 0===a?{}:a;var b=this.setting,c=b.getIdRif,d=b.callbackOnCloseCalendar,b=b.getAnagraficaExtra,e={elencoVideate:[],iconaPortlet:null,videataDettaglio:"CS.attivita.plan.view.UserCalendar",
permesso:"S",nominativoPopUp:"Calendario Utente",desVideata:"Calendario Utente"},f=this.recSettingActivity.codice,c={listaAttivita:f&&0<f.length?f.split(";"):null,hideTipologie:a.hideTipologie||!0,hideAree:a.hideAree||!0,ogniQuandoObj:a.ogniQuandoObj||null,noteFasce:a.noteFasce||null,listaFreq:a.listaFreq||null,checkNoOrari:a.checkNoOrari||!1,notePerson:a.notePerson||null,idRiferimento:c(),idCollegamento:this.getIdCollegamento(),paiCcc:a.paiCcc||null,anagraficaExtra:b()};Object.assign(c,a);Object.assign(e,
c);a=Ext.create("CSS_winCBA",{name:"CS.attivita.plan.view.UserCalendar",titolo:"Calendario Attività Utente",altezzaWin:Ext.getBody().getViewSize().height,larghezzaWin:Ext.getBody().getViewSize().width,visualizzaAnagrafica:b(),configItem:e});a.cssDefaultShow();a.on("close",function(a){d()})},onClickBtnAttivita:function(a){a=void 0===a?!1:a;var b=this.setting,c=b.getIdRif,d=b.onClick;if(!b.forceNoIdRif&&Ext.isEmpty(c())||Ext.isEmpty(this.getIdCollegamento())||this.preventShow)return Messaggio("ATTENZIONE",
"NESSUNA_REGISTRAZIONE_SELEZIONATA","OK","WARNING"),!1;a=d(a);if(0==a)return!1;this.openCalendarioUtente(a||{})},obscure:function(a){var b=this.setting.getIdRif;if(this.preventShow||!b())a=!0;this.setHidden(a)},startPolicy:function(a){a=void 0===a?null:a;if(!a)throw"nessun data passato!";var b=a,c=b.codice,d=[3,4,5,10],b="N"===b.valore||Ext.isEmpty(c)&&!d.includes(this.getIdCollegamento());this.obscure(b);this.recSettingActivity=a;this.preventShow=b},launch:function(a,b){a=void 0===a?{}:a;b=void 0===
b?function(){return null}:b;this.setting=Object.assign({},this.setting,a);this.fetchSettingActivity(this.getIdCollegamento()).then(this.startPolicy).then(function(){return b()})["catch"](function(a){return msgShowError("",a)})}});Ext.define("CbaUtilsCss.componenti.desktop.CssButtonsPanel",{extend:"Ext.panel.Panel",alias:"widget.cssBoxBottoniSpecial",alternateClassName:"cssBoxBottoniSpecial",margin:"0 0 0 5",border:0,flex:1,layout:{type:"hbox",align:"begin"},itemId:"BoxBottoniSpecial",reference:"BoxBottoniSpecial"});
Ext.define("CbaUtilsCss.componenti.desktop.CssColorPanel",{extend:"Ext.container.Container",alias:"widget.cssColorPanel",alternateClassName:"cssColorPanel",margin:5,cbaConfig:{title:"",color:"#5fa2dd",items:[]},layout:{type:"vbox",align:"stretch"},style:{"box-shadow":"rgba(0, 0, 0, 0.1) 0px 4px 6px -1px, rgba(0, 0, 0, 0.06) 0px 2px 4px -1px"},initComponent:function(){var a=this,b=this.cbaConfig,c=void 0===b.color?"#5fa2dd":b.color,d=b.title,b=void 0===b.items?[]:b.items;this.setBorderPanel(c);this.items=
[{xtype:"container",layout:{type:"hbox"},padding:6,hidden:!d,itemId:"CntTitolo",style:{background:this.calcGradientBgColor(c)},items:[{xtype:"label",cls:"cbaCssLabelTitolo",itemId:"LblTitolo",text:d,style:{fontSize:"16px"}},{xtype:"tbfill"},{xtype:"image",itemId:"ImgPanel",src:"/cba/css/generali/images/generali/portlet-collapse-blu.svg",height:20,width:20,listeners:{afterrender:function(b){b.getEl().on("click",function(){var c=b.aperto;void 0==c&&(c=!0);b.aperto=!c;a.apriChiudiPanel(b.aperto)})}}}]},
{xtype:"container",margin:"0 0 0 8",layout:{type:"hbox",align:"stretch"},itemId:"PanelInfo",items:[{xtype:"container",margin:"5 5 0 5",layout:{type:"vbox",align:"stretch"},maxHeight:200,padding:8,scrollable:!0,items:[].concat($jscomp.arrayFromIterable(b))}]}];this.callParent(arguments)},getLabelTitolo:function(){return this.down("#LblTitolo")},getPanelInfo:function(){return this.down("#PanelInfo")},getCntTitolo:function(){return this.down("#CntTitolo")},getImgPanel:function(){return this.down("#ImgPanel")},
apriChiudiPanel:function(a){this.getImgPanel().setSrc("/cba/css/generali/images/generali/"+(a?"portlet-collapse-blu.svg":"portlet-expand-blu.svg"));this.getPanelInfo().setHidden(!a)},calcGradientBgColor:function(a){return"linear-gradient(to right, "+a+" 0%, rgba(255,255,255,0) 100%)"},setBorderPanel:function(a){this.setStyle({border:"2px solid "+a})},changeStylePanel:function(a){var b=a.title;a=void 0===a.color?"#5fa2dd":a.color;this.getLabelTitolo().setHtml(b);this.setBorderPanel(a);this.getCntTitolo().setStyle({background:this.calcGradientBgColor(a)});
this.getCntTitolo().setHidden(!b)}});
Ext.define("CbaUtilsCss.componenti.desktop.CssComboFarmaco",{extend:"Ext.form.field.ComboBox",alias:"widget.cssComboFarmaco",alternateClassName:"cssComboFarmaco",uses:["GeneraliCS.store.Farmaci","GeneraliCS.store.Lasa"],minChars:3,labelClsExtra:"cbaCssLabel",displayField:"valore",valueField:"codice",queryMode:"remote",queryParam:"desc",pageSize:7,verificaProntuario:!0,idOrg:getIdOrg(),listConfig:{minWidth:500},store:{type:"farmaci"},showIconInfo:!1,showAIC:!1,initComponent:function(){var a=this,b=
this;b.storeLasa=Ext.create("GeneraliCS.store.Lasa",{autoDestroy:!1});b.storeLasa.load({params:{hideInizioAttesa:!0}});b.tpl=Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="x-boundlist-item cntShortcut-css" style="height: 35px; line-height: 17px;"><span>{[this.renderRec(values)]}</span></div>',"</tpl>",{renderRec:function(a){var c=Ext.id(),d=null!=a.gruppo&&a.gruppo.startsWith("#");b.showIconInfo&&!d&&Ext.defer(function(){var d=Ext.get(c);d&&Ext.create("CbaUtils.componenti.all.Avatar",{id:"cntAvatar-"+
c,color:"#4767da",height:24,"float":"right",label:"info",extraCls:"imgShortcut-css",click:function(){var c=Ext.create("CSS_winCBA",{name:"CS.terapie.view.SchedaFarmaco",titolo:a.valore,configItem:{permesso:"S",tabPosition:"TabScheda",storeLasa:b.storeLasa,aic:a.codice}});c.show();c.on("close",function(){b.expand()})}}).render(d,c)},50);var g=a.valore,h=a.codice;null!=a.gruppo&&(g="!"==a.gruppo?g+' <span style="font-style: italic; color: red">('+a.gruppo+")</span>":a.gruppo.startsWith("#")?'<span style="font-style: italic; color: blue"> '+
g+" </span>":g+' <span style="font-style: italic; color: #808080">('+a.gruppo+")</span>");if(null!=a.extra){var k=Ext.id();d||Ext.defer(function(){var a=Ext.get(k);a&&Ext.create("CbaUtils.componenti.all.Avatar",{color:"#a0db8e",height:24,"float":"right",label:"PTO"}).render(a,k)},50);return(b.showIconInfo&&!d?"<span id='"+c+"' style='float: right; width:24px'></span>":"")+"\n\t\t\t\t\t\t\t\t\t"+g+"\t\t\t\t        \t        \n\t\t\t\t\t\t\t\t\t<span id='"+k+"' style='float: right; width:24px'></span>\n\t\t\t\t\t\t\t\t\t"+
(b.showAIC?'<span style="float: right; font-style: italic; color: #808080">AIC:'+h+" </span>":"")}return""+(b.showIconInfo?"<span id='"+c+"' style='float: right; width:24px'></span>":"")+g}});this.callParent(arguments);var c=this.getStore();c.on("beforeload",function(b,c){var d=c.getParams()||{};"soloPN"in d||c.setParams(a.impostaSoloPN(d));a.cbaConfig.controllerMain&&a.cbaConfig.controllerMain.lookupController()&&(a.cbaConfig.controllerMain.lookupController().idDeposito&&c.setParams(Object.assign(d,
{idDeposito:a.cbaConfig.controllerMain.lookupController().idDeposito})),a.cbaConfig.controllerMain.lookupController().idPreferito&&c.setParams(Object.assign(d,{idPreferito:a.cbaConfig.controllerMain.lookupController().idPreferito})));a.cbaConfig.controllerMain&&a.cbaConfig.controllerMain.cbaConfig&&a.cbaConfig.controllerMain.cbaConfig.record&&a.cbaConfig.controllerMain.cbaConfig.record.get("codGruppoEq")&&c.setParams(Object.assign(d,{codGrpEqui:a.cbaConfig.controllerMain.cbaConfig.record.get("codGruppoEq")}));
a._rawValueFarmaco=a.getRawValue()});c.on("load",function(){a._rawValueFarmaco&&a.setRawValue(a._rawValueFarmaco)})},impostaSoloPN:function(a){if(a){var b=this.abilitaRicercaSoloPN()?"T":a.ricercaPN;Object.assign(a,{ricercaPN:b,soloPN:getBoolValue(this.abilitaRicercaSoloPN())})}return a},destroy:function(){eliminaStore(this.storeLasa)},setExtraParamasFarmaco:function(a,b){var c={idOrg:this.idOrg,ricercaPN:a,ignoreFlagInTerapia:void 0===b?!1:b,idProfilo:CBA.parametriGenerali.idProfiloCss};this.getStore().getProxy().setExtraParams(c)},
abilitaRicercaSoloPN:function(){return this.verificaProntuario?"T"==CBA.moduli.modulo49.operatore.cssTerapieSoloPN:!1},listeners:{afterrender:function(a){var b=this;a.setExtraParamasFarmaco(null,this.ignoreFlagInTerapia);Ext.defer(function(){a.focus();b.cbaConfig.controllaAllergieIntolleranze&&Ext.isEmpty(b.cbaConfig.recSel)&&Ext.Ajax.request({method:"GET",url:"/cba/css/cs/ws/terapie/allergie/check",params:{idRicovero:b.cbaConfig.idRicovero||CBA.moduli.modulo49.storeAnagraficaSel.getAt(0).get("idRicovero")},
success:function(c){c=Ext.JSON.decode(c.responseText);c.success?0==c.data&&Messaggio("ATTENZIONE","UTENTE_SENZA_ALLERGIE/INTOLLERANZE","YESNO","QUESTION",!1,function(){},function(){b.cbaConfig.controllerMain.cbaConfig.superWin||b.cbaConfig.controllerMain.cbaConfig.ricognizione||b.cbaConfig.controllerMain.cbaConfig.controllerTe.aggiornaStore();a.up("window").close()}):msgShowError("",c.message)}})},1E3)},expand:function(a){var b=this,c=a.getStore(),d=a.getPicker(),e=d.down("toolbar");a.firsTime||(a.firsTime=
!0,d.pagingToolbar.items.each(function(a){"prev"!=a.itemId&&"next"!=a.itemId&&a.hide()}),e.add({xtype:"container",layout:"hbox",items:[{xtype:"checkboxfield",itemId:"CkbFiltra",cls:"cbaCssLabel",hidden:this.abilitaRicercaSoloPN()||this.soloPTO,boxLabel:traduci("TERAPIE_CERCA_PN"),listeners:{change:function(d,e){a.setExtraParamasFarmaco(e?"T":"F",this.ignoreFlagInTerapia);c.loadPage(1,{params:{desc:b._rawValueFarmaco}})}}}]}));d=e.down("#CkbFiltra");d.suspendEvent("change");d.setValue("T"==c.getProxy().getExtraParams().ricercaPN);
d.resumeEvent("change");a.getValue()&&(a.lastQuery=a.rawValue)}}});
Ext.define("CbaUtilsCss.componenti.desktop.CssComboPazienti",{extend:"Ext.form.field.ComboBox",alias:"widget.cssComboPazienti",alternateClassName:"cssComboPazienti",uses:["GeneraliCS.anagrafica.store.CercaLight"],minChars:3,labelClsExtra:"cbaCssLabel",displayField:"nominativo",valueField:"codOspite",queryMode:"remote",queryParam:"desc",pageSize:7,listConfig:{minWidth:500},cbaConfig:{},store:{type:"cercaLight"},showIconInfo:!1,initComponent:function(){var a=this,b=this;b.tpl=Ext.create("Ext.XTemplate",
'<tpl for=".">','<div class="x-boundlist-item cntShortcut-css" style="height: 35px; line-height: 17px;"><span>{[this.renderRec(values)]}</span></div>',"</tpl>",{renderRec:function(a){var c=a.cognome+" "+a.nome;b.cbaConfig.renderExtraProperty&&(c+=" ("+a[b.cbaConfig.renderExtraProperty]+")");return""+c}});this.callParent(arguments);var c=this.getStore();c.on("beforeload",function(){a._rawValueFarmaco=a.getRawValue()});c.on("load",function(){a._rawValueFarmaco&&a.setRawValue(a._rawValueFarmaco)})},
destroy:function(){eliminaStore(this.storeLasa)},setExtraParams:function(a){this.getStore().getProxy().setExtraParams(a)},listeners:{expand:function(a){var b=a.getStore(),c=a.getPicker();c.down("toolbar");a.firsTime||(a.firsTime=!0,c.pagingToolbar.items.each(function(a){"first"!=a.itemId&&"last"!=a.itemId&&"refresh"!=a.itemId&&"tbseparator"!=a.xtype||a.hide()}),b.loadPage(1,{params:{desc:this._rawValueFarmaco}}));a.getValue()&&(a.lastQuery=a.rawValue)}}});
Ext.define("CbaUtilsCss.componenti.desktop.CssComboStatiCovid",{extend:"Ext.form.field.ComboBox",alias:"widget.cssComboStatiCovid",alternateClassName:"cssComboStatiCovid",cbaConfig:{externalStore:!1},uses:["GeneraliCS.store.StatiMonitorCovid"],queryMode:"local",minChars:0,displayValue:"valore",valueField:"codice",listConfig:{tpl:'<tpl for="."><li role="option" class="x-boundlist-item" style="list-style-type: none; width: 100%;"> <tpl><center><div class="cba-css-stato-monitoraggio-covid-{codice}" style="height:20px;width:20px;"></div></center></tpl></li></tpl>'},
initComponent:function(){this.cbaConfig.externalStore||(this.store=Ext.create("GeneraliCS.store.StatiMonitorCovid",{autoDestroy:!0,autoLoad:!1}));this.callParent(arguments);this.on("change",this.onChangeCombox.bind(this))},onChangeCombox:function(a,b,c){if(b=a.getSelectedRecord())b=b.getData(),c=b.extra,0==b.codice&&(c="#fff"),a.setFieldStyle("background:"+c+"; color:"+c)}});
Ext.define("CbaUtilsCss.componenti.desktop.CssGruppiUtenti",{extend:"Ext.Container",alias:"widget.CssGruppiUtenti",alternateClassName:"CssGruppiUtenti",allowBlank:!0,idArea:null,hideAree:!1,hideGruppi:!1,soloUtentiInGruppo:!1,extraConfigCbArea:{},extraConfigCbGruppo:{},initComponent:function(){var a=this,b={xtype:"combobox",itemId:"ComboAree",emptyText:"GRUPPI_SEL_AREA",hidden:this.hideAree,labelClsExtra:"cbaCssLabel",store:Ext.create("CS.personalizzazioni.personGruppiUtenti.impostazioni.store.CboxAttivita",
{}),valueField:"codice",displayField:"valore",minChars:0,queryMode:"local",fieldLabel:"AREA",name:"idArea",allowBlank:this.allowBlank,listeners:{change:this.onChangeComboAree.bind(this)}},c={xtype:"combobox",hidden:this.hideGruppi,labelClsExtra:"cbaCssLabel",itemId:"ComboGruppi",emptyText:"GRUPPI_SEL_GRUPPO",labelWidth:55,store:Ext.create("CS.personalizzazioni.personGruppiUtenti.impostazioni.store.CboxGruppi",{}),valueField:"codice",displayField:"valore",minChars:0,queryMode:"local",fieldLabel:"GRUPPO",
name:"idGruppo",allowBlank:this.allowBlank,listeners:{change:function(b,c){a.fireEvent("changegruppo",b,c)}}};Object.assign(b,this.extraConfigCbArea);Object.assign(c,this.extraConfigCbGruppo);this.items=[b,c];this.callParent(arguments);this.idArea&&this.loadAree(CBA.parametriGenerali.idProfiloCss,this.idArea)},onChangeComboAree:function(a,b,c){this.fireEvent("changearea",a,b);this.getComboGruppo().setDisabled(Ext.isEmpty(b));SvuotaCombo(this.getComboGruppo());b&&this.loadGruppi(b)},getComboArea:function(){return this.down("#ComboAree")},
getComboGruppo:function(){return this.down("#ComboGruppi")},loadAree:function(a,b){this._idProfilo=a;var c=this.getComboArea(),d=this.getComboArea().getStore();SvuotaCombo(c);d.load({params:{idProfilo:a},callback:function(a,d,g){g?Ext.isEmpty(a)||b&&c.setValue(b):msgShowError("",d.getError())}})},loadGruppi:function(a,b){b=void 0===b?null:b;this.getComboGruppo().getStore().load({params:{codArea:a,idProfilo:b||this.getIdProfilo(),utentiInGruppo:this.soloUtentiInGruppo||!1},callback:function(a,b,e){e||
msgShowError("",b.getError())}})},getValue:function(){var a=this.getComboArea().getValue(),b=this.getComboGruppo().getValue(),c={};a&&b&&Object.assign(c,{idArea:a,idGruppo:b});return c},getIdProfilo:function(){return this._idProfilo}});
Ext.define("CbaUtilsCss.componenti.desktop.CssImgOspite",{extend:"Ext.Img",alias:"widget.cssImgOspite",alternateClassName:"cssImgOspite",initComponent:function(){var a=this;Ext.applyIf(this,{height:36,width:36,style:{border:"2px solid #305f8e","border-radius":"4px"},cbaConfig:{codOspite:null,abilitaEditFotoOspite:!1},listeners:{afterrender:function(b){var c=Ext.create("Ext.tip.ToolTip",{target:b.getId(),autoHide:!1,anchor:"left",listeners:{beforeshow:function(a){if(b.src)a.update('<img src="'+b.src+
'">');else return!1},render:function(a){a.getEl().on("mouseleave",function(){Ext.defer(function(){c.close()},300)})}}});b.getEl().on("click",function(){a.clickImgFotoUtente(b)})}}});this.loadFotoOspite(this.cbaConfig.codOspite);this.callParent(arguments)},loadFotoOspite:function(a){a&&setSrcImage(this,getUrlGen()+"/ws/genOsp/foto/get?codospite="+a+"&date="+Ext.Date.now())},clickImgFotoUtente:function(a){if(this.cbaConfig.abilitaEditFotoOspite){var b=Ext.create("winCBA",{permesso:"S",name:"GeneraliCS.anagrafica.view.ModificaPazienteImg",
titolo:"MODIFICA_IMG_PAZIENTE",clsWin:"cbaCssBordoPopup",closable:!0,maximizable:!1,maximized:!1,resizable:!1,larghezzaWin:300,altezzaWin:350,configItem:{permesso:"S",elImg:a}}),c=a.getPosition()[0]+a.getWidth();a=a.getPosition()[1]+a.getHeight();b.showAt(c,a)}}});
Ext.define("CbaUtilsCss.componenti.desktop.CssPanelCompilatore",{extend:"Ext.panel.Panel",alias:"widget.cssPanelCompilatore",alternateClassName:"cssPanelCompilatore",uses:["CbaUtilsCss.componenti.desktop.CssPnlBozza"],margin:5,layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;a.serverTime=getServerTimeSync();this.items=[{xtype:"panel",itemId:"PanelRecordBase",cls:"cbaCssPnlCompilatore",height:45,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",itemId:"CntBase",
reference:"CntBase",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"container",width:310,layout:{type:"hbox"},padding:10,items:[{xtype:"datefield",itemId:"DataRegistrazione",reference:"DataRegistrazione",labelWidth:75,name:this.cbaDataName||"dataRegAppo",fieldLabel:"DATA_REG",labelClsExtra:"labels-pnl-compilatore-css",width:190,allowBlank:this.cbaDataAllowBlank,maxValue:CBA.moduli.modulo49.serverDate,readOnly:!0,validator:function(a){return!0},listeners:{blur:function(b){var c=b.up("cssPanelCompilatore");
if(!c.stopEventDataBlur&&!(b.up("form")||c.cbaConfig.form).cbaConfig.bloccata){var c=b.up("cssPanelCompilatore").down("timefield"),d=a.serverTime,e=b.getValue(),f=!1;isValidDate(b)&&(dmyIsEqual(e)&&c.getValue()&&(c.getValue().getHours()>d.getHours()?f=!0:c.getValue().getHours()==d.getHours()&&c.getValue().getMinutes()>d.getMinutes()&&(f=!0)),f&&c.setValue(getServerTimeSync()))}},focus:function(a){a.up("cssPanelCompilatore")},validitychange:function(a){a.clearInvalid()}}},{xtype:"timefield",itemId:"OraRegistrazione",
reference:"OraRegistrazione",labelWidth:28,name:this.cbaOraName||"oraRegAppo",fieldLabel:"ORA",labelClsExtra:"labels-pnl-compilatore-css",format:"H:i",width:85,margin:"0 5 0 18",allowBlank:this.cbaOraAllowBlank,hidden:this.cbaOraHide,readOnly:!0,listeners:{blur:function(b){if(!b.up("cssPanelCompilatore").stopEventOraBlur){var c=b.up("cssPanelCompilatore").down("datefield");!c.getValue()&&b.getValue()&&c.setValue(a.serverTime);var d=!1,e=a.serverTime;(c=c.getValue())&&b.getValue()?(dmyIsEqual(c)&&
(b.getValue().getHours()>e.getHours()?d=!0:b.getValue().getHours()==e.getHours()&&b.getValue().getMinutes()>e.getMinutes()&&(d=!0)),d&&Messaggio("ATTENZIONE","CS_DATA_FUTURO","OK","WARNING",function(){b.setValue(getServerTimeSync())})):Messaggio("ATTENZIONE","CS_DATA_FUTURO","OK","WARNING",function(){b.setValue(getServerTimeSync())})}}}}]},{xtype:"container",layout:{type:"hbox",pack:"end"},flex:1,padding:10,items:[{xtype:"label",cls:"labels-pnl-compilatore-css",text:traduci("COMPILATORE")+": ",width:95,
height:25,margin:"4 0 0 0"},{xtype:"label",cls:"labels-pnl-compilatore-css",margin:"4 0 0 0",height:25,itemId:"LabelCompilatore",reference:"LabelCompilatore"}]}]}]},{xtype:"cssPnlBozza",hidden:!0},{xtype:"panel",itemId:"PanelRecordAnnullato",reference:"PanelRecordAnnullato",hidden:!0,cls:"cbaCssPnlCompilatore-annullato",layout:{type:"hbox",align:"stretch"},items:[{xtype:"label",cls:"cbaCssLabelWhite",text:"CS_RECORD_ANNULLATO_DA",margin:"5 0 5 20"},{xtype:"label",itemId:"LabelAnnullatoCompilatore",
reference:"LabelAnnullatoCompilatore",cls:"cbaCssLabelWhite",margin:"5 0 5 10"},{xtype:"label",itemId:"LabelAnnullatoData",reference:"LabelAnnullatoData",cls:"cbaCssLabelWhite",margin:"5 0 5 10"}]}];this.callParent(arguments)},setLabelCompilatore:function(a){this.down("#LabelCompilatore").setText(a);this.down("#LabelAnnullatoCompilatore").setText(a)},setDataRegistrazione:function(a){this.down("datefield").setValue(a)},setOraRegistrazione:function(a){this.down("timefield").setValue(a)},getDataOraReg:function(){var a=
this.serverTime,b=this.down("datefield"),c=this.down("timefield");b.getValue()instanceof Date&&c.getValue()instanceof Date&&(a=cssCheckDataOraRegistrazione(this,b,c));return a},setNuovoRecord:function(a,b){var c=CBA.parametriGenerali.idProfiloCss,d=this.down("datefield"),e=this.down("timefield");this.setLabelCompilatore(descNomeProfUser(b?!0:!1));cssGetPolicyRetrodatazione(this,d,e,c)},setColor:function(a,b){Ext.isEmpty(a)&&(a="#BFDAF2");var c=this.down("#CntBase"),d=c.getEl(),e=Ext.create("Ext.draw.Color",
{});e.setFromString(a);var e=e.createDarker(.3),f="black";1==b?f=e.toString():2==b&&(f="white".toString());c.setStyle("background",a);Ext.each(d.query("span"),function(a){a.style.color=f});Ext.each(c.query("label"),function(a){a.getEl().setStyle("color",f)});return this}});
Ext.define("CbaUtilsCss.componenti.desktop.CssPnlBozza",{extend:"Ext.Container",alias:"widget.cssPnlBozza",alternateClassName:"cssPnlBozza",reference:"PnlBozza",margin:5,layout:{type:"vbox",align:"stretch"},style:{boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24) !important"},initComponent:function(){var a=this;this.items=[{xtype:"container",height:43,layout:{type:"hbox",align:"middle",pack:"center"},style:{backgroundColor:"#ffe082"},items:[{xtype:"label",margin:"0 0 0 5",cls:"cbaGrassetto",
html:traduci("CSSREGTIPOBLOCCO_14"),style:{color:"#5d4037 !important"}},{xtype:"container",margin:"0 0 0 8",items:[{xtype:"button",hidden:!0,width:120,cls:"cbaCssBtnFunzione-special",itemId:"BtnBozzaEdit",nonDisabilitare:!0,text:"CONFERMA_BOZZA",handler:function(b){a.creaWinDate()}}]}]}];this.callParent(arguments)},creaWinDate:function(){var a=this;this.serverDate=getServerTimeSync();var b=Ext.create("winCBA",{titolo:"CONFERMA_BOZZA",maximizable:!1,closable:!1,name:[{xtype:"panel",padding:6,border:!1,
layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"fieldset",reference:"FieldsetDateTime",padding:10,margin:"6 0 0 0",layout:{type:"hbox"},items:[{xtype:"datefield",width:180,labelWidth:55,labelClsExtra:"cbaCssLabel",fieldLabel:traduci("DATA"),itemId:"Data",value:this.serverDate,maxValue:Ext.clone(this.serverDate),listeners:{blur:function(b){return a.isValidDate(b)}}},{xtype:"timefield",format:"H:i",margin:"0 0 0 4",width:110,labelWidth:50,labelClsExtra:"cbaCssLabel",fieldLabel:traduci("ORA"),
itemId:"Ora",value:this.serverDate,listeners:{blur:function(b){return a.isValidDate(b)}}}]},{xtype:"container",margin:"6 0 0 0",layout:{type:"vbox",align:"stretch"},flex:1,itemId:"CntDetail",reference:"CntDetail"}],listeners:{afterrender:function(){var c=a.cbaConfig;(void 0===c.callBackAfterWinRendered?function(){return null}:c.callBackAfterWinRendered)(b)}},dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnConferma",reference:"BtnConferma",iconCls:getIconButtons().btnConferma,
cls:"cbaBtnFunzione-mini",handler:function(){var c=b.down("#Data").getValue(),d=b.down("#Ora").getValue(),c=sommaDataOra(c,d);a.unLock(c)}},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",iconCls:getIconButtons().btnEsci,cls:"cbaBtnFunzione-mini",handler:function(){b.close()}}]}]}]});this.winConfermaBozza=b;b.show()},isValidDate:function(a){var b=new moment(this.serverDate),c=a.up("window").down("#Data"),d=a.up("window").down("#Ora"),e=[];dataInizio=new moment(Ext.clone(c.getValue()));oraInizio=
new moment(Ext.clone(d.getValue()));futura=!1;if(!dataInizio.isValid()||!oraInizio.isValid())return msgAddError(e,"MSG_ERROR_DATA_NON_VALIDA"),msgShow("",e,"OK",function(){a.setValue(b.toDate())}),!1;dataInizio.clone().startOf("hour").isAfter(b.clone().startOf("hour"))?futura=!0:dataInizio.isSame(b,"day")&&(oraInizio.hours()>b.hours()||oraInizio.minutes()>b.minutes())&&(futura=!0);futura&&(msgAddError(e,"MSG_ERROR_DATA_NON_VALIDA"),msgShow("",e,"OK",function(){a.setValue(b.toDate())}))},settingRequestType:function(a){var b=
"/cba/css/cs/ws/bozza/unlock";switch(a){case 1:b="/cba/css/cs/ws/pai/bozza/unlock";break;case 3:b="/cba/css/cs/ws/programma/bozza/unlock"}return{url:b}},unLock:function(a){var b=this.cbaConfig,c=b.getIdRegistrazione,d=b.callBackAfterUnLock,b=b.type,e=c(),f=this.winConfermaBozza,g=f.down("#CntDetail");if(!e)return!1;c=this.settingRequestType(b);a={idReg:e,date:a,type:b};b=g&&g.controllerRef&&g.controllerRef.getValue()||{};Object.assign(a,b);Ext.Ajax.request({method:"POST",url:c.url,params:{},jsonData:Ext.JSON.encode(a),
success:function(a){a=Ext.JSON.decode(a.responseText);var b=a.message;a.success?(msgShow("ATTENZIONE",b),d(e),f.close()):msgShowError("",b)}})},getButtonEdit:function(){return this.down("#BtnBozzaEdit")},showHideButton:function(a){this.getButtonEdit().setHidden(a)},closePanel:function(){this.hide()},setSolaLettura:function(a){a=void 0===a?!1:a;this.getButtonEdit().setHidden(a)},showPanel:function(a){a=void 0===a?!0:a;this.show();this.setSolaLettura(a)}});
Ext.define("CbaUtilsCss.componenti.desktop.CssSedeReparto",{extend:"Ext.container.Container",alias:"widget.cssSedeReparto",standAlone:!0,initComponent:function(){var a=this,b=this.layout&&this.layout.type,c=this.layout&&this.layout.align,d=this.configSede.margin,e=this.layout&&Ext.isDefined(this.layout.type)?this.layout.type:"hbox",f=this.configSede&&this.configSede.name,g=this.configSede&&Ext.isDefined(this.configSede.hideLabel),h=this.configSede&&this.configSede.width,k=this.configSede&&this.configSede.flex,
l=this.configSede&&this.configSede.labelWidth,n=this.configReparto&&this.configReparto.name,p=this.configReparto&&Ext.isDefined(this.configReparto.hideLabel),t=this.configReparto&&this.configReparto.width,q=this.configReparto&&this.configReparto.flex,r=this.configReparto&&this.configReparto.labelWidth;this.items=[];b=Ext.create("Ext.Container",{layout:{type:b||"hbox",align:c||"stretch"},margin:this.margin||null,flex:1,items:[{xtype:"combobox",itemId:"CbSede",reference:"CbSede",store:Ext.create("CS.consegne.store.Sedi"),
name:f||"sedi",hideLabel:g?g:!0,labelClsExtra:"cbaCssLabel",emptyText:"SEDE",valueField:"codice",displayField:"valore",queryMode:"local",fieldLabel:"SEDE",margin:d?d:"vbox"===e?"0 0 10 0":"0 10 0 0",width:h,isFormField:this.isFormField||!0,flex:k,labelWidth:l||60,nonDisabilitare:!0,listeners:{afterrender:function(b){a.standAlone&&a.load()["catch"](function(a){return msgShowError("",a)})},change:function(b,c){b.lookupController();var d=b.up("cssSedeReparto").query("#CbReparto")[0];SvuotaCombo(d);0<
c&&(d.getStore().getProxy().extraParams={sede:c,filtroSedRepPwd:a.filtroSedRepPwd?a.filtroSedRepPwd:"F"},d.getStore().load({params:{filtroSedRepPwd:"T"},callback:function(b,c,e){e?(c=1===b.length,d.setReadOnly(c),c&&d.setValue(b[0]),a.config.defaultReparto&&d.setValue(a.config.defaultReparto)):reject(c.getError())}}))}}},{xtype:"combobox",itemId:"CbReparto",reference:"CbReparto",store:Ext.create("CS.consegne.store.Reparti"),name:n||"reparti",hideLabel:p?p:!0,labelClsExtra:"cbaCssLabel",emptyText:"REPARTO",
valueField:"codice",displayField:"valore",queryMode:"local",fieldLabel:"REPARTO",width:t,flex:q,isFormField:this.isFormField||!0,labelWidth:r||60,nonDisabilitare:!0,listeners:{change:function(b,c){a.loadOnChange&&Ext.isFunction(a.loadOnChange)&&a.loadOnChange()}}}]});this.items.push(b);this.getValue=function(){var b=a.query("combo");return{sede:{value:b[0].getValue(),descr:b[0].getRawValue()},reparto:{value:b[1].getValue(),descr:b[1].getRawValue()}}};this.callParent(arguments)},load:function(){var a=
this;return new Promise(function(b,c){var d=a.down("#CbSede");a.down("#CbReparto");d.getStore().load({params:{filtroSedRepPwd:a.filtroSedRepPwd?a.filtroSedRepPwd:"F"},callback:function(e,f,g){g?(f=1===e.length,d.setReadOnly(f),f&&d.setValue(e[0]),a.config.defaultSede&&d.setValue(a.config.defaultSede),b(!0)):c(f.getError())}})})}});
Ext.define("CbaUtilsCss.componenti.desktop.CssSintesi",{extend:"Ext.button.Button",alias:"widget.CssSintesi",alternateClassName:"CssSintesi",itemId:"CssSintesi",reference:"CssSintesi",cls:"cbaCssBtnFunzione-special",text:traduci("SINTESI"),hidden:!0,nonDisabilitare:!0,initComponent:function(){var a=this;this.callParent(arguments);this.on("click",function(b){a.openWinSintesi(b)})},openWinSintesi:function(a){if(this.win)return this.win.show(),!1;var b=this.cbaConfig;a=b.getCodVideata;var c=b.getIdRicovero,
d=b.getIdProfilo,b=b.permesso;this.win=Ext.create("CSS_WinCBASuper",{titolo:"SINTESI",bodyPadding:4,name:"GeneraliCS.componenti.view.Sintesi",larghezzaWin:400,minHeight:360,maxHeight:600,modal:!1,resizable:!0,configItem:{superWin:!0,codVideata:a(),idRicovero:c(),idProfilo:d(),permesso:b}});(a=this.up("window"))&&this.win.showAt(a.x,a.y)}});
Ext.define("CbaUtilsCss.componenti.desktop.CssSpinnerfield",{extend:"Ext.form.field.Number",alias:"widget.cssSpinnerfield",alternateClassName:"cssSpinnerfield",vtype:"numero",maxLength:3,minValue:0,enforceMaxLength:!0,hideTrigger:!1,mouseWheelEnabled:!1,allowDecimals:!1,initComponent:function(){this.callParent(arguments)}});
Ext.define("CbaUtilsCss.componenti.desktop.CssSwitchContainer",{extend:"Ext.form.FieldSet",alias:"widget.CssSwitchContainer",alternateClassName:"CssSwitchContainer",switchConfig:[],defaultSwitch:0,_activeForm:null,_tipoFiltro:null,_tooltipInfoStep:[],title:[],tipoFiltro:null,initComponent:function(){var a=this;this._tipoFiltro=this.defaultSwitch;this._tooltipInfoStep=[];this.on("afterrender",this._onAfterrenderSwitcher.bind(this));var b=[];this.switchConfig.forEach(function(c,d){a._tooltipInfoStep.push({xtype:"label",
cls:"cbaLabel",text:d+" - "+traduci(c.tooltip)});b.push({xtype:"form",border:!1,hidden:!0,reference:"FormIndex_"+d,cbaConfig:{index:d},items:[].concat($jscomp.arrayFromIterable(c.items))})});Object.assign(this,{items:b});this.callParent(arguments)},_onAfterrenderSwitcher:function(a){var b=this;a.legend.add(Ext.create("Ext.slider.Single",{minValue:0,maxValue:this.switchConfig.length-1,increment:1,width:40,style:"float: right;",reference:"SliderView",margin:"0 0 0 5",style:"cursor: pointer",listeners:{change:this._onChangeSwitcherSlider.bind(this),
afterrender:function(a){a.setValue(b.defaultSwitch);if(!Ext.isEmpty(b._tooltipInfoStep)){var c={xtype:"container",layout:{type:"vbox"},items:[].concat($jscomp.arrayFromIterable(b._tooltipInfoStep))};b.cbaConfig.tooltip=creaToolTipBubble(a.getId(),"",traduci("TRASCINA_PER_CAMBIARE_MODALITA"),!1,210,c)}a.getValue()==b.defaultSwitch&&(b.cambiaVista(b.defaultSwitch),b.fireEvent("onchangeswitcher",b,b.defaultSwitch,null));b.fireEvent("switchercontainerrendered",b)}}}))},cambiaVista:function(a){var b=this.query("form"),
c=this.down("[reference=FormIndex_"+a+"]");b.forEach(function(b){b.cbaConfig.index!=a&&b.hide()});c.show();this._activeForm=c},_onChangeSwitcherSlider:function(a,b,c){this.cambiaVista(b);this._tipoFiltro=b;this.fireEvent("onchangeswitcher",this,b,c)},getActiveForm:function(){return this._activeForm},getTipoFiltro:function(){return this._tipoFiltro},getValoriForm:function(){return this.getActiveForm()&&this.getActiveForm().getForm().getFieldValues()},destroy:function(){this.cbaConfig.tooltip&&(this.cbaConfig.tooltip.removeAll(!0),
this.cbaConfig.tooltip.destroy(),delete this.cbaConfig.tooltip);this.switchConfig=this._activeForm=this._tooltipInfoStep=this._tipoFiltro=null;this.callParent(arguments)}});
Ext.define("CbaUtilsCss.componenti.desktop.CssWinCBA",{extend:"winCBA",alias:"widget.CSS_winCBA",alternateClassName:"CSS_winCBA",maximizable:!0,minimizable:!0,margine:20,altezzaWin:Ext.getBody().getViewSize().height-40,larghezzaWin:1024,minWidth:1024,clsWin:"cbaCssBordoPopup",titolo:" ",hideInfoUser:!1,hideDataDiNascita:!1,hideFotoOspite:!1,initComponent:function(){this.items=[];this.callParent(arguments)},listeners:{},tools:[{type:"help",hidden:!0}],callBackRenderWin:function(){initToolbarCbaCss(this,
this.visualizzaAnagrafica)},cssDefaultShow:function(){this.showAt(.5*CBA.parametriGenerali.cmpTbMenu.getWidth()-.5*this.larghezzaWin,this.margine)},impostaTitolo:function(a){this.getHeader().down("#LabelTitoloWinCss").setText(a)},toFront:function(){if(CBA.parametriGenerali.superWin)return!1;this.callParent()}});
Ext.define("CbaUtilsCss.componenti.desktop.CssWinCBASuper",{extend:"winCBA",alias:"widget.CSS_WinCBASuper",alternateClassName:"CSS_WinCBASuper",maximizable:!1,minimizable:!1,modal:!1,resizable:!1,isPortlet:!1,closable:!1,layout:"fit",callbackAfterrenderWin:Ext.emptyFn,clsWin:"cbaCssBordoPopup",initComponent:function(){this.items=[];this.callParent(arguments)},listeners:{close:function(a){this.isPortlet&&(blockDash(!1),(a=CBA.moduli.modulo49.controllerDashboard.getView().query("[superAlias="+CBA.parametriGenerali.ctrlPortletAttivo+
"]"))&&0<a.length&&a[0].lookupController().updatePortlet(),delete CBA.parametriGenerali.ctrlPortletAttivo)},afterrender:function(a){this.isPortlet&&blockDash(!0);this.callbackAfterrenderWin()}},cssDefaultShow:function(){this.show();this.alignTo(Ext.getBody(),"tr-tr")}});
Ext.define("CbaUtilsCss.componenti.desktop.RemoteSrcCss",{extend:"Ext.container.Container",alias:"widget.remoteSrcCss",alternateClassName:"remoteSrcCss",layout:{type:"hbox",align:"stretch"},emptyText:traduci("INSERIRE")+" "+traduci("CARATTERI")+" "+traduci("PER_CERCARE"),initComponent:function(){var a=this;this.items=[{xtype:"container",layout:{type:"hbox",align:"middle",pack:"center"},items:[{xtype:"image",src:"/cba/generali/images/16/find.png",margin:"0 10 0 5",height:16,width:16}]},{xtype:"textfield",
itemId:"Codice_remoteSrc",fieldLabel:traduci("CODICE"),labelClsExtra:"cbaCssLabel",labelWidth:50,hidden:!a.cbaConfig.filtroCodice,isFormField:!1,width:140,margin:"0 30 0 0",listeners:{change:Ext.Function.createBuffered(function(b){if(b=b.up("remoteSrcCss"))b.cbaConfig.lastFieldChange="C",a.cerca()},200,this)}},{xtype:"textfield",itemId:"Descrizione_remoteSrc",fieldLabel:traduci("DESCRIZIONE"),labelClsExtra:"cbaCssLabel",labelWidth:80,isFormField:!1,width:380,emptyText:this.emptyText,listeners:{change:Ext.Function.createBuffered(function(b){if(b=
b.up("remoteSrcCss"))b.cbaConfig.lastFieldChange="D",a.cerca()},200,this)}}];this.callParent(arguments)},cerca:function(){var a=this,b=a.down("#Descrizione_remoteSrc"),c=a.down("#Codice_remoteSrc").getValue(),d={desc:b.getValue(),orderBy:a.cbaConfig.lastFieldChange};a.cbaConfig.filtroCodice&&Ext.apply(d,{codice:c});var e=a.cbaConfig.controlledCnt.controller,f=e.doRemoteSrc;e.lookup("ComboChecklist")&&!Ext.isEmpty(e.lookup("ComboChecklist").getValue())?e.filtraGrid(a.cbaConfig.lastFieldChange,c,b.getValue()):
""!=c||""!=b.getValue()?(inizioAttesa(),Ext.Ajax.request({method:"GET",url:a.cbaConfig.url,params:d,async:!1,success:function(c){c=Ext.JSON.decode(c.responseText);if(c.success){if(c.data&&1==c.data.length){var d=c.data[0].descrizione;d?b.setEmptyText(d):b.setEmptyText(a.emptyText)}else b.setEmptyText(a.emptyText);f&&f(c.data,e)}else msgShowError("",c.message);Ext.defer(function(){fineAttesa()},150)}})):f&&f([],e)}});
Ext.define("CbaUtilsCss.componenti.desktop.WinTree",{extend:"Ext.container.Container",alias:"widget.winTree",alternateClassName:"winTree",layout:{type:"vbox",align:"stretch"},flex:1,initComponent:function(){var a=this;Ext.applyIf(this,{layout:{type:"vbox",align:"stretch"},flex:1,items:[{xtype:"treepanel",flex:1,border:0,itemId:"Tree",reference:"Tree",useArrows:!0,rootVisible:!1,viewConfig:{loadMask:!1},columns:[{xtype:"treecolumn",dataIndex:"text",iconCls:"hideTreeNode",hideHeader:!0,flex:1,renderer:function(b){var c=
a.cbaConfig.cboxTreePanel.stringSearch||"";return 0<c.length?a.evidenziaParole(c,b):b}}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",width:400,emptyText:traduci("MINIMO_3_PER_RICERCARE"),labelClsExtra:"cbaCssLabel",itemId:"TxtRicerca",reference:"TxtRicerca",fieldLabel:traduci("RICERCA"),listeners:{afterrender:function(b){a.cbaConfig.hideSearchField&&b.hide()},change:Ext.Function.createBuffered(function(b){b=b.getValue();if(Ext.isEmpty(b))return!1;if(3<=b.length){if(Ext.isEmpty(a.cbaConfig.queryParam))throw new "campo queryParam non passto al componente";
var c={};a.cbaConfig.cboxTreePanel.loadTree((c[a.cbaConfig.queryParam]=b.toUpperCase(),c))}},400,this)}},{xtype:"tbfill"},{xtype:"CSSButtonsPanel",itemId:"BoxBottoni",reference:"BoxBottoni",flex:1,items:[{xtype:"tbfill"},{xtype:"button",itemId:"BtnEsci",reference:"BtnEsci",nonDisabilitare:!0,handler:function(a){return a.up("window").hide()}}]}]}],listeners:{afterrender:function(b){return b.bindStore(a.cbaConfig.store)},itemdblclick:function(b,c){a.cbaConfig.itemdblclick&&a.cbaConfig.itemdblclick(c);
a.up("window").hide()}}}]});this.callParent(arguments)},evidenziaParole:function(a,b){return b.replace(new RegExp("("+a+")","gi"),"<span style='color: orange;'><b>$1</b></span>")}});